function tF(r,t){for(var s=0;s<t.length;s++){const l=t[s];if(typeof l!="string"&&!Array.isArray(l)){for(const h in l)if(h!=="default"&&!(h in r)){const m=Object.getOwnPropertyDescriptor(l,h);m&&Object.defineProperty(r,h,m.get?m:{enumerable:!0,get:()=>l[h]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const v of m.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&l(v)}).observe(document,{childList:!0,subtree:!0});function s(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(h){if(h.ep)return;h.ep=!0;const m=s(h);fetch(h.href,m)}})();function c1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var tw={exports:{}},M_={},rw={exports:{}},Li={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nI;function rF(){if(nI)return Li;nI=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),v=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),F=Symbol.iterator;function $(qe){return qe===null||typeof qe!="object"?null:(qe=F&&qe[F]||qe["@@iterator"],typeof qe=="function"?qe:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J=Object.assign,W={};function ie(qe,Ct,kr){this.props=qe,this.context=Ct,this.refs=W,this.updater=kr||K}ie.prototype.isReactComponent={},ie.prototype.setState=function(qe,Ct){if(typeof qe!="object"&&typeof qe!="function"&&qe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,qe,Ct,"setState")},ie.prototype.forceUpdate=function(qe){this.updater.enqueueForceUpdate(this,qe,"forceUpdate")};function fe(){}fe.prototype=ie.prototype;function Pe(qe,Ct,kr){this.props=qe,this.context=Ct,this.refs=W,this.updater=kr||K}var Fe=Pe.prototype=new fe;Fe.constructor=Pe,J(Fe,ie.prototype),Fe.isPureReactComponent=!0;var ht=Array.isArray,at=Object.prototype.hasOwnProperty,Dt={current:null},kt={key:!0,ref:!0,__self:!0,__source:!0};function Rt(qe,Ct,kr){var Zr,Rr={},ar=null,lr=null;if(Ct!=null)for(Zr in Ct.ref!==void 0&&(lr=Ct.ref),Ct.key!==void 0&&(ar=""+Ct.key),Ct)at.call(Ct,Zr)&&!kt.hasOwnProperty(Zr)&&(Rr[Zr]=Ct[Zr]);var $r=arguments.length-2;if($r===1)Rr.children=kr;else if(1<$r){for(var Cr=Array($r),Fr=0;Fr<$r;Fr++)Cr[Fr]=arguments[Fr+2];Rr.children=Cr}if(qe&&qe.defaultProps)for(Zr in $r=qe.defaultProps,$r)Rr[Zr]===void 0&&(Rr[Zr]=$r[Zr]);return{$$typeof:r,type:qe,key:ar,ref:lr,props:Rr,_owner:Dt.current}}function hr(qe,Ct){return{$$typeof:r,type:qe.type,key:Ct,ref:qe.ref,props:qe.props,_owner:qe._owner}}function Tr(qe){return typeof qe=="object"&&qe!==null&&qe.$$typeof===r}function _r(qe){var Ct={"=":"=0",":":"=2"};return"$"+qe.replace(/[=:]/g,function(kr){return Ct[kr]})}var Sr=/\/+/g;function Br(qe,Ct){return typeof qe=="object"&&qe!==null&&qe.key!=null?_r(""+qe.key):Ct.toString(36)}function Ft(qe,Ct,kr,Zr,Rr){var ar=typeof qe;(ar==="undefined"||ar==="boolean")&&(qe=null);var lr=!1;if(qe===null)lr=!0;else switch(ar){case"string":case"number":lr=!0;break;case"object":switch(qe.$$typeof){case r:case t:lr=!0}}if(lr)return lr=qe,Rr=Rr(lr),qe=Zr===""?"."+Br(lr,0):Zr,ht(Rr)?(kr="",qe!=null&&(kr=qe.replace(Sr,"$&/")+"/"),Ft(Rr,Ct,kr,"",function(Fr){return Fr})):Rr!=null&&(Tr(Rr)&&(Rr=hr(Rr,kr+(!Rr.key||lr&&lr.key===Rr.key?"":(""+Rr.key).replace(Sr,"$&/")+"/")+qe)),Ct.push(Rr)),1;if(lr=0,Zr=Zr===""?".":Zr+":",ht(qe))for(var $r=0;$r<qe.length;$r++){ar=qe[$r];var Cr=Zr+Br(ar,$r);lr+=Ft(ar,Ct,kr,Cr,Rr)}else if(Cr=$(qe),typeof Cr=="function")for(qe=Cr.call(qe),$r=0;!(ar=qe.next()).done;)ar=ar.value,Cr=Zr+Br(ar,$r++),lr+=Ft(ar,Ct,kr,Cr,Rr);else if(ar==="object")throw Ct=String(qe),Error("Objects are not valid as a React child (found: "+(Ct==="[object Object]"?"object with keys {"+Object.keys(qe).join(", ")+"}":Ct)+"). If you meant to render a collection of children, use an array instead.");return lr}function br(qe,Ct,kr){if(qe==null)return qe;var Zr=[],Rr=0;return Ft(qe,Zr,"","",function(ar){return Ct.call(kr,ar,Rr++)}),Zr}function Yt(qe){if(qe._status===-1){var Ct=qe._result;Ct=Ct(),Ct.then(function(kr){(qe._status===0||qe._status===-1)&&(qe._status=1,qe._result=kr)},function(kr){(qe._status===0||qe._status===-1)&&(qe._status=2,qe._result=kr)}),qe._status===-1&&(qe._status=0,qe._result=Ct)}if(qe._status===1)return qe._result.default;throw qe._result}var Er={current:null},gt={transition:null},Jt={ReactCurrentDispatcher:Er,ReactCurrentBatchConfig:gt,ReactCurrentOwner:Dt};function Ht(){throw Error("act(...) is not supported in production builds of React.")}return Li.Children={map:br,forEach:function(qe,Ct,kr){br(qe,function(){Ct.apply(this,arguments)},kr)},count:function(qe){var Ct=0;return br(qe,function(){Ct++}),Ct},toArray:function(qe){return br(qe,function(Ct){return Ct})||[]},only:function(qe){if(!Tr(qe))throw Error("React.Children.only expected to receive a single React element child.");return qe}},Li.Component=ie,Li.Fragment=s,Li.Profiler=h,Li.PureComponent=Pe,Li.StrictMode=l,Li.Suspense=A,Li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jt,Li.act=Ht,Li.cloneElement=function(qe,Ct,kr){if(qe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+qe+".");var Zr=J({},qe.props),Rr=qe.key,ar=qe.ref,lr=qe._owner;if(Ct!=null){if(Ct.ref!==void 0&&(ar=Ct.ref,lr=Dt.current),Ct.key!==void 0&&(Rr=""+Ct.key),qe.type&&qe.type.defaultProps)var $r=qe.type.defaultProps;for(Cr in Ct)at.call(Ct,Cr)&&!kt.hasOwnProperty(Cr)&&(Zr[Cr]=Ct[Cr]===void 0&&$r!==void 0?$r[Cr]:Ct[Cr])}var Cr=arguments.length-2;if(Cr===1)Zr.children=kr;else if(1<Cr){$r=Array(Cr);for(var Fr=0;Fr<Cr;Fr++)$r[Fr]=arguments[Fr+2];Zr.children=$r}return{$$typeof:r,type:qe.type,key:Rr,ref:ar,props:Zr,_owner:lr}},Li.createContext=function(qe){return qe={$$typeof:v,_currentValue:qe,_currentValue2:qe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},qe.Provider={$$typeof:m,_context:qe},qe.Consumer=qe},Li.createElement=Rt,Li.createFactory=function(qe){var Ct=Rt.bind(null,qe);return Ct.type=qe,Ct},Li.createRef=function(){return{current:null}},Li.forwardRef=function(qe){return{$$typeof:i,render:qe}},Li.isValidElement=Tr,Li.lazy=function(qe){return{$$typeof:D,_payload:{_status:-1,_result:qe},_init:Yt}},Li.memo=function(qe,Ct){return{$$typeof:P,type:qe,compare:Ct===void 0?null:Ct}},Li.startTransition=function(qe){var Ct=gt.transition;gt.transition={};try{qe()}finally{gt.transition=Ct}},Li.unstable_act=Ht,Li.useCallback=function(qe,Ct){return Er.current.useCallback(qe,Ct)},Li.useContext=function(qe){return Er.current.useContext(qe)},Li.useDebugValue=function(){},Li.useDeferredValue=function(qe){return Er.current.useDeferredValue(qe)},Li.useEffect=function(qe,Ct){return Er.current.useEffect(qe,Ct)},Li.useId=function(){return Er.current.useId()},Li.useImperativeHandle=function(qe,Ct,kr){return Er.current.useImperativeHandle(qe,Ct,kr)},Li.useInsertionEffect=function(qe,Ct){return Er.current.useInsertionEffect(qe,Ct)},Li.useLayoutEffect=function(qe,Ct){return Er.current.useLayoutEffect(qe,Ct)},Li.useMemo=function(qe,Ct){return Er.current.useMemo(qe,Ct)},Li.useReducer=function(qe,Ct,kr){return Er.current.useReducer(qe,Ct,kr)},Li.useRef=function(qe){return Er.current.useRef(qe)},Li.useState=function(qe){return Er.current.useState(qe)},Li.useSyncExternalStore=function(qe,Ct,kr){return Er.current.useSyncExternalStore(qe,Ct,kr)},Li.useTransition=function(){return Er.current.useTransition()},Li.version="18.3.1",Li}var iI;function fx(){return iI||(iI=1,rw.exports=rF()),rw.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sI;function nF(){if(sI)return M_;sI=1;var r=fx(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,h=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function v(i,A,P){var D,F={},$=null,K=null;P!==void 0&&($=""+P),A.key!==void 0&&($=""+A.key),A.ref!==void 0&&(K=A.ref);for(D in A)l.call(A,D)&&!m.hasOwnProperty(D)&&(F[D]=A[D]);if(i&&i.defaultProps)for(D in A=i.defaultProps,A)F[D]===void 0&&(F[D]=A[D]);return{$$typeof:t,type:i,key:$,ref:K,props:F,_owner:h.current}}return M_.Fragment=s,M_.jsx=v,M_.jsxs=v,M_}var oI;function iF(){return oI||(oI=1,tw.exports=nF()),tw.exports}var b=iF(),pv={},nw={exports:{}},Xl={},iw={exports:{}},sw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aI;function sF(){return aI||(aI=1,function(r){function t(gt,Jt){var Ht=gt.length;gt.push(Jt);e:for(;0<Ht;){var qe=Ht-1>>>1,Ct=gt[qe];if(0<h(Ct,Jt))gt[qe]=Jt,gt[Ht]=Ct,Ht=qe;else break e}}function s(gt){return gt.length===0?null:gt[0]}function l(gt){if(gt.length===0)return null;var Jt=gt[0],Ht=gt.pop();if(Ht!==Jt){gt[0]=Ht;e:for(var qe=0,Ct=gt.length,kr=Ct>>>1;qe<kr;){var Zr=2*(qe+1)-1,Rr=gt[Zr],ar=Zr+1,lr=gt[ar];if(0>h(Rr,Ht))ar<Ct&&0>h(lr,Rr)?(gt[qe]=lr,gt[ar]=Ht,qe=ar):(gt[qe]=Rr,gt[Zr]=Ht,qe=Zr);else if(ar<Ct&&0>h(lr,Ht))gt[qe]=lr,gt[ar]=Ht,qe=ar;else break e}}return Jt}function h(gt,Jt){var Ht=gt.sortIndex-Jt.sortIndex;return Ht!==0?Ht:gt.id-Jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var v=Date,i=v.now();r.unstable_now=function(){return v.now()-i}}var A=[],P=[],D=1,F=null,$=3,K=!1,J=!1,W=!1,ie=typeof setTimeout=="function"?setTimeout:null,fe=typeof clearTimeout=="function"?clearTimeout:null,Pe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Fe(gt){for(var Jt=s(P);Jt!==null;){if(Jt.callback===null)l(P);else if(Jt.startTime<=gt)l(P),Jt.sortIndex=Jt.expirationTime,t(A,Jt);else break;Jt=s(P)}}function ht(gt){if(W=!1,Fe(gt),!J)if(s(A)!==null)J=!0,Yt(at);else{var Jt=s(P);Jt!==null&&Er(ht,Jt.startTime-gt)}}function at(gt,Jt){J=!1,W&&(W=!1,fe(Rt),Rt=-1),K=!0;var Ht=$;try{for(Fe(Jt),F=s(A);F!==null&&(!(F.expirationTime>Jt)||gt&&!_r());){var qe=F.callback;if(typeof qe=="function"){F.callback=null,$=F.priorityLevel;var Ct=qe(F.expirationTime<=Jt);Jt=r.unstable_now(),typeof Ct=="function"?F.callback=Ct:F===s(A)&&l(A),Fe(Jt)}else l(A);F=s(A)}if(F!==null)var kr=!0;else{var Zr=s(P);Zr!==null&&Er(ht,Zr.startTime-Jt),kr=!1}return kr}finally{F=null,$=Ht,K=!1}}var Dt=!1,kt=null,Rt=-1,hr=5,Tr=-1;function _r(){return!(r.unstable_now()-Tr<hr)}function Sr(){if(kt!==null){var gt=r.unstable_now();Tr=gt;var Jt=!0;try{Jt=kt(!0,gt)}finally{Jt?Br():(Dt=!1,kt=null)}}else Dt=!1}var Br;if(typeof Pe=="function")Br=function(){Pe(Sr)};else if(typeof MessageChannel<"u"){var Ft=new MessageChannel,br=Ft.port2;Ft.port1.onmessage=Sr,Br=function(){br.postMessage(null)}}else Br=function(){ie(Sr,0)};function Yt(gt){kt=gt,Dt||(Dt=!0,Br())}function Er(gt,Jt){Rt=ie(function(){gt(r.unstable_now())},Jt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(gt){gt.callback=null},r.unstable_continueExecution=function(){J||K||(J=!0,Yt(at))},r.unstable_forceFrameRate=function(gt){0>gt||125<gt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):hr=0<gt?Math.floor(1e3/gt):5},r.unstable_getCurrentPriorityLevel=function(){return $},r.unstable_getFirstCallbackNode=function(){return s(A)},r.unstable_next=function(gt){switch($){case 1:case 2:case 3:var Jt=3;break;default:Jt=$}var Ht=$;$=Jt;try{return gt()}finally{$=Ht}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(gt,Jt){switch(gt){case 1:case 2:case 3:case 4:case 5:break;default:gt=3}var Ht=$;$=gt;try{return Jt()}finally{$=Ht}},r.unstable_scheduleCallback=function(gt,Jt,Ht){var qe=r.unstable_now();switch(typeof Ht=="object"&&Ht!==null?(Ht=Ht.delay,Ht=typeof Ht=="number"&&0<Ht?qe+Ht:qe):Ht=qe,gt){case 1:var Ct=-1;break;case 2:Ct=250;break;case 5:Ct=1073741823;break;case 4:Ct=1e4;break;default:Ct=5e3}return Ct=Ht+Ct,gt={id:D++,callback:Jt,priorityLevel:gt,startTime:Ht,expirationTime:Ct,sortIndex:-1},Ht>qe?(gt.sortIndex=Ht,t(P,gt),s(A)===null&&gt===s(P)&&(W?(fe(Rt),Rt=-1):W=!0,Er(ht,Ht-qe))):(gt.sortIndex=Ct,t(A,gt),J||K||(J=!0,Yt(at))),gt},r.unstable_shouldYield=_r,r.unstable_wrapCallback=function(gt){var Jt=$;return function(){var Ht=$;$=Jt;try{return gt.apply(this,arguments)}finally{$=Ht}}}}(sw)),sw}var lI;function oF(){return lI||(lI=1,iw.exports=sF()),iw.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cI;function aF(){if(cI)return Xl;cI=1;var r=fx(),t=oF();function s(_){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+_,k=1;k<arguments.length;k++)w+="&args[]="+encodeURIComponent(arguments[k]);return"Minified React error #"+_+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,h={};function m(_,w){v(_,w),v(_+"Capture",w)}function v(_,w){for(h[_]=w,_=0;_<w.length;_++)l.add(w[_])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),A=Object.prototype.hasOwnProperty,P=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,D={},F={};function $(_){return A.call(F,_)?!0:A.call(D,_)?!1:P.test(_)?F[_]=!0:(D[_]=!0,!1)}function K(_,w,k,B){if(k!==null&&k.type===0)return!1;switch(typeof w){case"function":case"symbol":return!0;case"boolean":return B?!1:k!==null?!k.acceptsBooleans:(_=_.toLowerCase().slice(0,5),_!=="data-"&&_!=="aria-");default:return!1}}function J(_,w,k,B){if(w===null||typeof w>"u"||K(_,w,k,B))return!0;if(B)return!1;if(k!==null)switch(k.type){case 3:return!w;case 4:return w===!1;case 5:return isNaN(w);case 6:return isNaN(w)||1>w}return!1}function W(_,w,k,B,Z,se,we){this.acceptsBooleans=w===2||w===3||w===4,this.attributeName=B,this.attributeNamespace=Z,this.mustUseProperty=k,this.propertyName=_,this.type=w,this.sanitizeURL=se,this.removeEmptyString=we}var ie={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_){ie[_]=new W(_,0,!1,_,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_){var w=_[0];ie[w]=new W(w,1,!1,_[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(_){ie[_]=new W(_,2,!1,_.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_){ie[_]=new W(_,2,!1,_,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_){ie[_]=new W(_,3,!1,_.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(_){ie[_]=new W(_,3,!0,_,null,!1,!1)}),["capture","download"].forEach(function(_){ie[_]=new W(_,4,!1,_,null,!1,!1)}),["cols","rows","size","span"].forEach(function(_){ie[_]=new W(_,6,!1,_,null,!1,!1)}),["rowSpan","start"].forEach(function(_){ie[_]=new W(_,5,!1,_.toLowerCase(),null,!1,!1)});var fe=/[\-:]([a-z])/g;function Pe(_){return _[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_){var w=_.replace(fe,Pe);ie[w]=new W(w,1,!1,_,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_){var w=_.replace(fe,Pe);ie[w]=new W(w,1,!1,_,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(_){var w=_.replace(fe,Pe);ie[w]=new W(w,1,!1,_,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(_){ie[_]=new W(_,1,!1,_.toLowerCase(),null,!1,!1)}),ie.xlinkHref=new W("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(_){ie[_]=new W(_,1,!1,_.toLowerCase(),null,!0,!0)});function Fe(_,w,k,B){var Z=ie.hasOwnProperty(w)?ie[w]:null;(Z!==null?Z.type!==0:B||!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(J(w,k,Z,B)&&(k=null),B||Z===null?$(w)&&(k===null?_.removeAttribute(w):_.setAttribute(w,""+k)):Z.mustUseProperty?_[Z.propertyName]=k===null?Z.type===3?!1:"":k:(w=Z.attributeName,B=Z.attributeNamespace,k===null?_.removeAttribute(w):(Z=Z.type,k=Z===3||Z===4&&k===!0?"":""+k,B?_.setAttributeNS(B,w,k):_.setAttribute(w,k))))}var ht=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,at=Symbol.for("react.element"),Dt=Symbol.for("react.portal"),kt=Symbol.for("react.fragment"),Rt=Symbol.for("react.strict_mode"),hr=Symbol.for("react.profiler"),Tr=Symbol.for("react.provider"),_r=Symbol.for("react.context"),Sr=Symbol.for("react.forward_ref"),Br=Symbol.for("react.suspense"),Ft=Symbol.for("react.suspense_list"),br=Symbol.for("react.memo"),Yt=Symbol.for("react.lazy"),Er=Symbol.for("react.offscreen"),gt=Symbol.iterator;function Jt(_){return _===null||typeof _!="object"?null:(_=gt&&_[gt]||_["@@iterator"],typeof _=="function"?_:null)}var Ht=Object.assign,qe;function Ct(_){if(qe===void 0)try{throw Error()}catch(k){var w=k.stack.trim().match(/\n( *(at )?)/);qe=w&&w[1]||""}return`
`+qe+_}var kr=!1;function Zr(_,w){if(!_||kr)return"";kr=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(Et){var B=Et}Reflect.construct(_,[],w)}else{try{w.call()}catch(Et){B=Et}_.call(w.prototype)}else{try{throw Error()}catch(Et){B=Et}_()}}catch(Et){if(Et&&B&&typeof Et.stack=="string"){for(var Z=Et.stack.split(`
`),se=B.stack.split(`
`),we=Z.length-1,He=se.length-1;1<=we&&0<=He&&Z[we]!==se[He];)He--;for(;1<=we&&0<=He;we--,He--)if(Z[we]!==se[He]){if(we!==1||He!==1)do if(we--,He--,0>He||Z[we]!==se[He]){var Qe=`
`+Z[we].replace(" at new "," at ");return _.displayName&&Qe.includes("<anonymous>")&&(Qe=Qe.replace("<anonymous>",_.displayName)),Qe}while(1<=we&&0<=He);break}}}finally{kr=!1,Error.prepareStackTrace=k}return(_=_?_.displayName||_.name:"")?Ct(_):""}function Rr(_){switch(_.tag){case 5:return Ct(_.type);case 16:return Ct("Lazy");case 13:return Ct("Suspense");case 19:return Ct("SuspenseList");case 0:case 2:case 15:return _=Zr(_.type,!1),_;case 11:return _=Zr(_.type.render,!1),_;case 1:return _=Zr(_.type,!0),_;default:return""}}function ar(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case kt:return"Fragment";case Dt:return"Portal";case hr:return"Profiler";case Rt:return"StrictMode";case Br:return"Suspense";case Ft:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case _r:return(_.displayName||"Context")+".Consumer";case Tr:return(_._context.displayName||"Context")+".Provider";case Sr:var w=_.render;return _=_.displayName,_||(_=w.displayName||w.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case br:return w=_.displayName||null,w!==null?w:ar(_.type)||"Memo";case Yt:w=_._payload,_=_._init;try{return ar(_(w))}catch{}}return null}function lr(_){var w=_.type;switch(_.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=w.render,_=_.displayName||_.name||"",w.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ar(w);case 8:return w===Rt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function $r(_){switch(typeof _){case"boolean":case"number":case"string":case"undefined":return _;case"object":return _;default:return""}}function Cr(_){var w=_.type;return(_=_.nodeName)&&_.toLowerCase()==="input"&&(w==="checkbox"||w==="radio")}function Fr(_){var w=Cr(_)?"checked":"value",k=Object.getOwnPropertyDescriptor(_.constructor.prototype,w),B=""+_[w];if(!_.hasOwnProperty(w)&&typeof k<"u"&&typeof k.get=="function"&&typeof k.set=="function"){var Z=k.get,se=k.set;return Object.defineProperty(_,w,{configurable:!0,get:function(){return Z.call(this)},set:function(we){B=""+we,se.call(this,we)}}),Object.defineProperty(_,w,{enumerable:k.enumerable}),{getValue:function(){return B},setValue:function(we){B=""+we},stopTracking:function(){_._valueTracker=null,delete _[w]}}}}function Zn(_){_._valueTracker||(_._valueTracker=Fr(_))}function ri(_){if(!_)return!1;var w=_._valueTracker;if(!w)return!0;var k=w.getValue(),B="";return _&&(B=Cr(_)?_.checked?"true":"false":_.value),_=B,_!==k?(w.setValue(_),!0):!1}function On(_){if(_=_||(typeof document<"u"?document:void 0),typeof _>"u")return null;try{return _.activeElement||_.body}catch{return _.body}}function vs(_,w){var k=w.checked;return Ht({},w,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:k??_._wrapperState.initialChecked})}function $s(_,w){var k=w.defaultValue==null?"":w.defaultValue,B=w.checked!=null?w.checked:w.defaultChecked;k=$r(w.value!=null?w.value:k),_._wrapperState={initialChecked:B,initialValue:k,controlled:w.type==="checkbox"||w.type==="radio"?w.checked!=null:w.value!=null}}function Hi(_,w){w=w.checked,w!=null&&Fe(_,"checked",w,!1)}function mo(_,w){Hi(_,w);var k=$r(w.value),B=w.type;if(k!=null)B==="number"?(k===0&&_.value===""||_.value!=k)&&(_.value=""+k):_.value!==""+k&&(_.value=""+k);else if(B==="submit"||B==="reset"){_.removeAttribute("value");return}w.hasOwnProperty("value")?zi(_,w.type,k):w.hasOwnProperty("defaultValue")&&zi(_,w.type,$r(w.defaultValue)),w.checked==null&&w.defaultChecked!=null&&(_.defaultChecked=!!w.defaultChecked)}function El(_,w,k){if(w.hasOwnProperty("value")||w.hasOwnProperty("defaultValue")){var B=w.type;if(!(B!=="submit"&&B!=="reset"||w.value!==void 0&&w.value!==null))return;w=""+_._wrapperState.initialValue,k||w===_.value||(_.value=w),_.defaultValue=w}k=_.name,k!==""&&(_.name=""),_.defaultChecked=!!_._wrapperState.initialChecked,k!==""&&(_.name=k)}function zi(_,w,k){(w!=="number"||On(_.ownerDocument)!==_)&&(k==null?_.defaultValue=""+_._wrapperState.initialValue:_.defaultValue!==""+k&&(_.defaultValue=""+k))}var Ki=Array.isArray;function to(_,w,k,B){if(_=_.options,w){w={};for(var Z=0;Z<k.length;Z++)w["$"+k[Z]]=!0;for(k=0;k<_.length;k++)Z=w.hasOwnProperty("$"+_[k].value),_[k].selected!==Z&&(_[k].selected=Z),Z&&B&&(_[k].defaultSelected=!0)}else{for(k=""+$r(k),w=null,Z=0;Z<_.length;Z++){if(_[Z].value===k){_[Z].selected=!0,B&&(_[Z].defaultSelected=!0);return}w!==null||_[Z].disabled||(w=_[Z])}w!==null&&(w.selected=!0)}}function Qo(_,w){if(w.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ht({},w,{value:void 0,defaultValue:void 0,children:""+_._wrapperState.initialValue})}function To(_,w){var k=w.value;if(k==null){if(k=w.children,w=w.defaultValue,k!=null){if(w!=null)throw Error(s(92));if(Ki(k)){if(1<k.length)throw Error(s(93));k=k[0]}w=k}w==null&&(w=""),k=w}_._wrapperState={initialValue:$r(k)}}function Cs(_,w){var k=$r(w.value),B=$r(w.defaultValue);k!=null&&(k=""+k,k!==_.value&&(_.value=k),w.defaultValue==null&&_.defaultValue!==k&&(_.defaultValue=k)),B!=null&&(_.defaultValue=""+B)}function Ua(_){var w=_.textContent;w===_._wrapperState.initialValue&&w!==""&&w!==null&&(_.value=w)}function wa(_){switch(_){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function is(_,w){return _==null||_==="http://www.w3.org/1999/xhtml"?wa(w):_==="http://www.w3.org/2000/svg"&&w==="foreignObject"?"http://www.w3.org/1999/xhtml":_}var Sa,Hs=function(_){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(w,k,B,Z){MSApp.execUnsafeLocalFunction(function(){return _(w,k,B,Z)})}:_}(function(_,w){if(_.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _)_.innerHTML=w;else{for(Sa=Sa||document.createElement("div"),Sa.innerHTML="<svg>"+w.valueOf().toString()+"</svg>",w=Sa.firstChild;_.firstChild;)_.removeChild(_.firstChild);for(;w.firstChild;)_.appendChild(w.firstChild)}});function Fo(_,w){if(w){var k=_.firstChild;if(k&&k===_.lastChild&&k.nodeType===3){k.nodeValue=w;return}}_.textContent=w}var ss={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},go=["Webkit","ms","Moz","O"];Object.keys(ss).forEach(function(_){go.forEach(function(w){w=w+_.charAt(0).toUpperCase()+_.substring(1),ss[w]=ss[_]})});function Ta(_,w,k){return w==null||typeof w=="boolean"||w===""?"":k||typeof w!="number"||w===0||ss.hasOwnProperty(_)&&ss[_]?(""+w).trim():w+"px"}function Ea(_,w){_=_.style;for(var k in w)if(w.hasOwnProperty(k)){var B=k.indexOf("--")===0,Z=Ta(k,w[k],B);k==="float"&&(k="cssFloat"),B?_.setProperty(k,Z):_[k]=Z}}var Ca=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function As(_,w){if(w){if(Ca[_]&&(w.children!=null||w.dangerouslySetInnerHTML!=null))throw Error(s(137,_));if(w.dangerouslySetInnerHTML!=null){if(w.children!=null)throw Error(s(60));if(typeof w.dangerouslySetInnerHTML!="object"||!("__html"in w.dangerouslySetInnerHTML))throw Error(s(61))}if(w.style!=null&&typeof w.style!="object")throw Error(s(62))}}function $a(_,w){if(_.indexOf("-")===-1)return typeof w.is=="string";switch(_){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dr=null;function ci(_){return _=_.target||_.srcElement||window,_.correspondingUseElement&&(_=_.correspondingUseElement),_.nodeType===3?_.parentNode:_}var di=null,Vi=null,Is=null;function Ha(_){if(_=Vd(_)){if(typeof di!="function")throw Error(s(280));var w=_.stateNode;w&&(w=Lu(w),di(_.stateNode,_.type,w))}}function Ga(_){Vi?Is?Is.push(_):Is=[_]:Vi=_}function Ot(){if(Vi){var _=Vi,w=Is;if(Is=Vi=null,Ha(_),w)for(_=0;_<w.length;_++)Ha(w[_])}}function qa(_,w){return _(w)}function gh(){}var Ql=!1;function Sn(_,w,k){if(Ql)return _(w,k);Ql=!0;try{return qa(_,w,k)}finally{Ql=!1,(Vi!==null||Is!==null)&&(gh(),Ot())}}function Ke(_,w){var k=_.stateNode;if(k===null)return null;var B=Lu(k);if(B===null)return null;k=B[w];e:switch(w){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(B=!B.disabled)||(_=_.type,B=!(_==="button"||_==="input"||_==="select"||_==="textarea")),_=!B;break e;default:_=!1}if(_)return null;if(k&&typeof k!="function")throw Error(s(231,w,typeof k));return k}var le=!1;if(i)try{var ue={};Object.defineProperty(ue,"passive",{get:function(){le=!0}}),window.addEventListener("test",ue,ue),window.removeEventListener("test",ue,ue)}catch{le=!1}function ve(_,w,k,B,Z,se,we,He,Qe){var Et=Array.prototype.slice.call(arguments,3);try{w.apply(k,Et)}catch(ur){this.onError(ur)}}var Ne=!1,Ee=null,ze=!1,We=null,je={onError:function(_){Ne=!0,Ee=_}};function Xe(_,w,k,B,Z,se,we,He,Qe){Ne=!1,Ee=null,ve.apply(je,arguments)}function dt(_,w,k,B,Z,se,we,He,Qe){if(Xe.apply(this,arguments),Ne){if(Ne){var Et=Ee;Ne=!1,Ee=null}else throw Error(s(198));ze||(ze=!0,We=Et)}}function Ze(_){var w=_,k=_;if(_.alternate)for(;w.return;)w=w.return;else{_=w;do w=_,(w.flags&4098)!==0&&(k=w.return),_=w.return;while(_)}return w.tag===3?k:null}function Nt(_){if(_.tag===13){var w=_.memoizedState;if(w===null&&(_=_.alternate,_!==null&&(w=_.memoizedState)),w!==null)return w.dehydrated}return null}function Qt(_){if(Ze(_)!==_)throw Error(s(188))}function Me(_){var w=_.alternate;if(!w){if(w=Ze(_),w===null)throw Error(s(188));return w!==_?null:_}for(var k=_,B=w;;){var Z=k.return;if(Z===null)break;var se=Z.alternate;if(se===null){if(B=Z.return,B!==null){k=B;continue}break}if(Z.child===se.child){for(se=Z.child;se;){if(se===k)return Qt(Z),_;if(se===B)return Qt(Z),w;se=se.sibling}throw Error(s(188))}if(k.return!==B.return)k=Z,B=se;else{for(var we=!1,He=Z.child;He;){if(He===k){we=!0,k=Z,B=se;break}if(He===B){we=!0,B=Z,k=se;break}He=He.sibling}if(!we){for(He=se.child;He;){if(He===k){we=!0,k=se,B=Z;break}if(He===B){we=!0,B=se,k=Z;break}He=He.sibling}if(!we)throw Error(s(189))}}if(k.alternate!==B)throw Error(s(190))}if(k.tag!==3)throw Error(s(188));return k.stateNode.current===k?_:w}function Wt(_){return _=Me(_),_!==null?mr(_):null}function mr(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var w=mr(_);if(w!==null)return w;_=_.sibling}return null}var Ur=t.unstable_scheduleCallback,nn=t.unstable_cancelCallback,Hr=t.unstable_shouldYield,ni=t.unstable_requestPaint,gn=t.unstable_now,bi=t.unstable_getCurrentPriorityLevel,Fn=t.unstable_ImmediatePriority,Nn=t.unstable_UserBlockingPriority,ji=t.unstable_NormalPriority,Ui=t.unstable_LowPriority,Ri=t.unstable_IdlePriority,ms=null,us=null;function yo(_){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(ms,_,void 0,(_.current.flags&128)===128)}catch{}}var Bo=Math.clz32?Math.clz32:kf,Gs=Math.log,kc=Math.LN2;function kf(_){return _>>>=0,_===0?32:31-(Gs(_)/kc|0)|0}var Pc=64,Rc=4194304;function Nc(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function yu(_,w){var k=_.pendingLanes;if(k===0)return 0;var B=0,Z=_.suspendedLanes,se=_.pingedLanes,we=k&268435455;if(we!==0){var He=we&~Z;He!==0?B=Nc(He):(se&=we,se!==0&&(B=Nc(se)))}else we=k&~Z,we!==0?B=Nc(we):se!==0&&(B=Nc(se));if(B===0)return 0;if(w!==0&&w!==B&&(w&Z)===0&&(Z=B&-B,se=w&-w,Z>=se||Z===16&&(se&4194240)!==0))return w;if((B&4)!==0&&(B|=k&16),w=_.entangledLanes,w!==0)for(_=_.entanglements,w&=B;0<w;)k=31-Bo(w),Z=1<<k,B|=_[k],w&=~Z;return B}function _u(_,w){switch(_){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bd(_,w){for(var k=_.suspendedLanes,B=_.pingedLanes,Z=_.expirationTimes,se=_.pendingLanes;0<se;){var we=31-Bo(se),He=1<<we,Qe=Z[we];Qe===-1?((He&k)===0||(He&B)!==0)&&(Z[we]=_u(He,w)):Qe<=w&&(_.expiredLanes|=He),se&=~He}}function yh(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function Wa(){var _=Pc;return Pc<<=1,(Pc&4194240)===0&&(Pc=64),_}function Vo(_){for(var w=[],k=0;31>k;k++)w.push(_);return w}function Eo(_,w,k){_.pendingLanes|=w,w!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,w=31-Bo(w),_[w]=k}function ec(_,w){var k=_.pendingLanes&~w;_.pendingLanes=w,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=w,_.mutableReadLanes&=w,_.entangledLanes&=w,w=_.entanglements;var B=_.eventTimes;for(_=_.expirationTimes;0<k;){var Z=31-Bo(k),se=1<<Z;w[Z]=0,B[Z]=-1,_[Z]=-1,k&=~se}}function Aa(_,w){var k=_.entangledLanes|=w;for(_=_.entanglements;k;){var B=31-Bo(k),Z=1<<B;Z&w|_[B]&w&&(_[B]|=w),k&=~Z}}var fi=0;function _h(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var ll,xu,Dc,vu,Pf,wd=!1,ro=[],ea=null,Za=null,Ia=null,xh=new Map,vh=new Map,Xa=[],An="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sd(_,w){switch(_){case"focusin":case"focusout":ea=null;break;case"dragenter":case"dragleave":Za=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":xh.delete(w.pointerId);break;case"gotpointercapture":case"lostpointercapture":vh.delete(w.pointerId)}}function Cl(_,w,k,B,Z,se){return _===null||_.nativeEvent!==se?(_={blockedOn:w,domEventName:k,eventSystemFlags:B,nativeEvent:se,targetContainers:[Z]},w!==null&&(w=Vd(w),w!==null&&xu(w)),_):(_.eventSystemFlags|=B,w=_.targetContainers,Z!==null&&w.indexOf(Z)===-1&&w.push(Z),_)}function Td(_,w,k,B,Z){switch(w){case"focusin":return ea=Cl(ea,_,w,k,B,Z),!0;case"dragenter":return Za=Cl(Za,_,w,k,B,Z),!0;case"mouseover":return Ia=Cl(Ia,_,w,k,B,Z),!0;case"pointerover":var se=Z.pointerId;return xh.set(se,Cl(xh.get(se)||null,_,w,k,B,Z)),!0;case"gotpointercapture":return se=Z.pointerId,vh.set(se,Cl(vh.get(se)||null,_,w,k,B,Z)),!0}return!1}function Eg(_){var w=Ou(_.target);if(w!==null){var k=Ze(w);if(k!==null){if(w=k.tag,w===13){if(w=Nt(k),w!==null){_.blockedOn=w,Pf(_.priority,function(){Dc(k)});return}}else if(w===3&&k.stateNode.current.memoizedState.isDehydrated){_.blockedOn=k.tag===3?k.stateNode.containerInfo:null;return}}}_.blockedOn=null}function Oc(_){if(_.blockedOn!==null)return!1;for(var w=_.targetContainers;0<w.length;){var k=Su(_.domEventName,_.eventSystemFlags,w[0],_.nativeEvent);if(k===null){k=_.nativeEvent;var B=new k.constructor(k.type,k);Dr=B,k.target.dispatchEvent(B),Dr=null}else return w=Vd(k),w!==null&&xu(w),_.blockedOn=k,!1;w.shift()}return!0}function Lc(_,w,k){Oc(_)&&k.delete(w)}function zc(){wd=!1,ea!==null&&Oc(ea)&&(ea=null),Za!==null&&Oc(Za)&&(Za=null),Ia!==null&&Oc(Ia)&&(Ia=null),xh.forEach(Lc),vh.forEach(Lc)}function bu(_,w){_.blockedOn===w&&(_.blockedOn=null,wd||(wd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zc)))}function wu(_){function w(Z){return bu(Z,_)}if(0<ro.length){bu(ro[0],_);for(var k=1;k<ro.length;k++){var B=ro[k];B.blockedOn===_&&(B.blockedOn=null)}}for(ea!==null&&bu(ea,_),Za!==null&&bu(Za,_),Ia!==null&&bu(Ia,_),xh.forEach(w),vh.forEach(w),k=0;k<Xa.length;k++)B=Xa[k],B.blockedOn===_&&(B.blockedOn=null);for(;0<Xa.length&&(k=Xa[0],k.blockedOn===null);)Eg(k),k.blockedOn===null&&Xa.shift()}var Ka=ht.ReactCurrentBatchConfig,Ed=!0;function tc(_,w,k,B){var Z=fi,se=Ka.transition;Ka.transition=null;try{fi=1,bh(_,w,k,B)}finally{fi=Z,Ka.transition=se}}function Rf(_,w,k,B){var Z=fi,se=Ka.transition;Ka.transition=null;try{fi=4,bh(_,w,k,B)}finally{fi=Z,Ka.transition=se}}function bh(_,w,k,B){if(Ed){var Z=Su(_,w,k,B);if(Z===null)Uf(_,w,B,ta,k),Sd(_,B);else if(Td(Z,_,w,k,B))B.stopPropagation();else if(Sd(_,B),w&4&&-1<An.indexOf(_)){for(;Z!==null;){var se=Vd(Z);if(se!==null&&ll(se),se=Su(_,w,k,B),se===null&&Uf(_,w,B,ta,k),se===Z)break;Z=se}Z!==null&&B.stopPropagation()}else Uf(_,w,B,null,k)}}var ta=null;function Su(_,w,k,B){if(ta=null,_=ci(B),_=Ou(_),_!==null)if(w=Ze(_),w===null)_=null;else if(k=w.tag,k===13){if(_=Nt(w),_!==null)return _;_=null}else if(k===3){if(w.stateNode.current.memoizedState.isDehydrated)return w.tag===3?w.stateNode.containerInfo:null;_=null}else w!==_&&(_=null);return ta=_,null}function jc(_){switch(_){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bi()){case Fn:return 1;case Nn:return 4;case ji:case Ui:return 16;case Ri:return 536870912;default:return 16}default:return 16}}var cl=null,Cd=null,Tu=null;function Fc(){if(Tu)return Tu;var _,w=Cd,k=w.length,B,Z="value"in cl?cl.value:cl.textContent,se=Z.length;for(_=0;_<k&&w[_]===Z[_];_++);var we=k-_;for(B=1;B<=we&&w[k-B]===Z[se-B];B++);return Tu=Z.slice(_,1<B?1-B:void 0)}function _o(_){var w=_.keyCode;return"charCode"in _?(_=_.charCode,_===0&&w===13&&(_=13)):_=w,_===10&&(_=13),32<=_||_===13?_:0}function wh(){return!0}function Eu(){return!1}function qs(_){function w(k,B,Z,se,we){this._reactName=k,this._targetInst=Z,this.type=B,this.nativeEvent=se,this.target=we,this.currentTarget=null;for(var He in _)_.hasOwnProperty(He)&&(k=_[He],this[He]=k?k(se):se[He]);return this.isDefaultPrevented=(se.defaultPrevented!=null?se.defaultPrevented:se.returnValue===!1)?wh:Eu,this.isPropagationStopped=Eu,this}return Ht(w.prototype,{preventDefault:function(){this.defaultPrevented=!0;var k=this.nativeEvent;k&&(k.preventDefault?k.preventDefault():typeof k.returnValue!="unknown"&&(k.returnValue=!1),this.isDefaultPrevented=wh)},stopPropagation:function(){var k=this.nativeEvent;k&&(k.stopPropagation?k.stopPropagation():typeof k.cancelBubble!="unknown"&&(k.cancelBubble=!0),this.isPropagationStopped=wh)},persist:function(){},isPersistent:wh}),w}var In={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_){return _.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ma=qs(In),Ad=Ht({},In,{view:0,detail:0}),cm=qs(Ad),Ir,Sh,rc,Al=Ht({},Ad,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bc,button:0,buttons:0,relatedTarget:function(_){return _.relatedTarget===void 0?_.fromElement===_.srcElement?_.toElement:_.fromElement:_.relatedTarget},movementX:function(_){return"movementX"in _?_.movementX:(_!==rc&&(rc&&_.type==="mousemove"?(Ir=_.screenX-rc.screenX,Sh=_.screenY-rc.screenY):Sh=Ir=0,rc=_),Ir)},movementY:function(_){return"movementY"in _?_.movementY:Sh}}),ra=qs(Al),um=Ht({},Al,{dataTransfer:0}),Th=qs(um),or=Ht({},Ad,{relatedTarget:0}),Un=qs(or),Bn=Ht({},In,{animationName:0,elapsedTime:0,pseudoElement:0}),na=qs(Bn),nc=Ht({},In,{clipboardData:function(_){return"clipboardData"in _?_.clipboardData:window.clipboardData}}),$n=qs(nc),Nf=Ht({},In,{data:0}),Eh=qs(Nf),Id={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Co={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hs={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function By(_){var w=this.nativeEvent;return w.getModifierState?w.getModifierState(_):(_=hs[_])?!!w[_]:!1}function Bc(){return By}var Vc=Ht({},Ad,{key:function(_){if(_.key){var w=Id[_.key]||_.key;if(w!=="Unidentified")return w}return _.type==="keypress"?(_=_o(_),_===13?"Enter":String.fromCharCode(_)):_.type==="keydown"||_.type==="keyup"?Co[_.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bc,charCode:function(_){return _.type==="keypress"?_o(_):0},keyCode:function(_){return _.type==="keydown"||_.type==="keyup"?_.keyCode:0},which:function(_){return _.type==="keypress"?_o(_):_.type==="keydown"||_.type==="keyup"?_.keyCode:0}}),Md=qs(Vc),Df=Ht({},Al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ch=qs(Df),Of=Ht({},Ad,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bc}),Ao=qs(Of),ic=Ht({},In,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uo=qs(ic),Cu=Ht({},Al,{deltaX:function(_){return"deltaX"in _?_.deltaX:"wheelDeltaX"in _?-_.wheelDeltaX:0},deltaY:function(_){return"deltaY"in _?_.deltaY:"wheelDeltaY"in _?-_.wheelDeltaY:"wheelDelta"in _?-_.wheelDelta:0},deltaZ:0,deltaMode:0}),ln=qs(Cu),Kt=[9,13,27,32],ia=i&&"CompositionEvent"in window,Nr=null;i&&"documentMode"in document&&(Nr=document.documentMode);var as=i&&"TextEvent"in window&&!Nr,Ah=i&&(!ia||Nr&&8<Nr&&11>=Nr),Ar=" ",Au=!1;function Iu(_,w){switch(_){case"keyup":return Kt.indexOf(w.keyCode)!==-1;case"keydown":return w.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sc(_){return _=_.detail,typeof _=="object"&&"data"in _?_.data:null}var Mu=!1;function Ya(_,w){switch(_){case"compositionend":return sc(w);case"keypress":return w.which!==32?null:(Au=!0,Ar);case"textInput":return _=w.data,_===Ar&&Au?null:_;default:return null}}function Io(_,w){if(Mu)return _==="compositionend"||!ia&&Iu(_,w)?(_=Fc(),Tu=Cd=cl=null,Mu=!1,_):null;switch(_){case"paste":return null;case"keypress":if(!(w.ctrlKey||w.altKey||w.metaKey)||w.ctrlKey&&w.altKey){if(w.char&&1<w.char.length)return w.char;if(w.which)return String.fromCharCode(w.which)}return null;case"compositionend":return Ah&&w.locale!=="ko"?null:w.data;default:return null}}var kd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ms(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w==="input"?!!kd[_.type]:w==="textarea"}function Lf(_,w,k,B){Ga(B),w=Du(w,"onChange"),0<w.length&&(k=new Ma("onChange","change",null,k,B),_.push({event:k,listeners:w}))}var sa=null,ks=null;function Pd(_){pm(_,0)}function zf(_){var w=Zc(_);if(ri(w))return _}function Vy(_,w){if(_==="change")return w}var oc=!1;if(i){var Uc;if(i){var ac="oninput"in document;if(!ac){var ku=document.createElement("div");ku.setAttribute("oninput","return;"),ac=typeof ku.oninput=="function"}Uc=ac}else Uc=!1;oc=Uc&&(!document.documentMode||9<document.documentMode)}function hm(){sa&&(sa.detachEvent("onpropertychange",Rd),ks=sa=null)}function Rd(_){if(_.propertyName==="value"&&zf(ks)){var w=[];Lf(w,ks,_,ci(_)),Sn(Pd,w)}}function dm(_,w,k){_==="focusin"?(hm(),sa=w,ks=k,sa.attachEvent("onpropertychange",Rd)):_==="focusout"&&hm()}function lc(_){if(_==="selectionchange"||_==="keyup"||_==="keydown")return zf(ks)}function Uy(_,w){if(_==="click")return zf(w)}function $y(_,w){if(_==="input"||_==="change")return zf(w)}function Cg(_,w){return _===w&&(_!==0||1/_===1/w)||_!==_&&w!==w}var Ja=typeof Object.is=="function"?Object.is:Cg;function ul(_,w){if(Ja(_,w))return!0;if(typeof _!="object"||_===null||typeof w!="object"||w===null)return!1;var k=Object.keys(_),B=Object.keys(w);if(k.length!==B.length)return!1;for(B=0;B<k.length;B++){var Z=k[B];if(!A.call(w,Z)||!Ja(_[Z],w[Z]))return!1}return!0}function jf(_){for(;_&&_.firstChild;)_=_.firstChild;return _}function fm(_,w){var k=jf(_);_=0;for(var B;k;){if(k.nodeType===3){if(B=_+k.textContent.length,_<=w&&B>=w)return{node:k,offset:w-_};_=B}e:{for(;k;){if(k.nextSibling){k=k.nextSibling;break e}k=k.parentNode}k=void 0}k=jf(k)}}function Nd(_,w){return _&&w?_===w?!0:_&&_.nodeType===3?!1:w&&w.nodeType===3?Nd(_,w.parentNode):"contains"in _?_.contains(w):_.compareDocumentPosition?!!(_.compareDocumentPosition(w)&16):!1:!1}function Ff(){for(var _=window,w=On();w instanceof _.HTMLIFrameElement;){try{var k=typeof w.contentWindow.location.href=="string"}catch{k=!1}if(k)_=w.contentWindow;else break;w=On(_.document)}return w}function Dd(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w&&(w==="input"&&(_.type==="text"||_.type==="search"||_.type==="tel"||_.type==="url"||_.type==="password")||w==="textarea"||_.contentEditable==="true")}function xo(_){var w=Ff(),k=_.focusedElem,B=_.selectionRange;if(w!==k&&k&&k.ownerDocument&&Nd(k.ownerDocument.documentElement,k)){if(B!==null&&Dd(k)){if(w=B.start,_=B.end,_===void 0&&(_=w),"selectionStart"in k)k.selectionStart=w,k.selectionEnd=Math.min(_,k.value.length);else if(_=(w=k.ownerDocument||document)&&w.defaultView||window,_.getSelection){_=_.getSelection();var Z=k.textContent.length,se=Math.min(B.start,Z);B=B.end===void 0?se:Math.min(B.end,Z),!_.extend&&se>B&&(Z=B,B=se,se=Z),Z=fm(k,se);var we=fm(k,B);Z&&we&&(_.rangeCount!==1||_.anchorNode!==Z.node||_.anchorOffset!==Z.offset||_.focusNode!==we.node||_.focusOffset!==we.offset)&&(w=w.createRange(),w.setStart(Z.node,Z.offset),_.removeAllRanges(),se>B?(_.addRange(w),_.extend(we.node,we.offset)):(w.setEnd(we.node,we.offset),_.addRange(w)))}}for(w=[],_=k;_=_.parentNode;)_.nodeType===1&&w.push({element:_,left:_.scrollLeft,top:_.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<w.length;k++)_=w[k],_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}var Od=i&&"documentMode"in document&&11>=document.documentMode,$c=null,Ld=null,Il=null,Hc=!1;function Bf(_,w,k){var B=k.window===k?k.document:k.nodeType===9?k:k.ownerDocument;Hc||$c==null||$c!==On(B)||(B=$c,"selectionStart"in B&&Dd(B)?B={start:B.selectionStart,end:B.selectionEnd}:(B=(B.ownerDocument&&B.ownerDocument.defaultView||window).getSelection(),B={anchorNode:B.anchorNode,anchorOffset:B.anchorOffset,focusNode:B.focusNode,focusOffset:B.focusOffset}),Il&&ul(Il,B)||(Il=B,B=Du(Ld,"onSelect"),0<B.length&&(w=new Ma("onSelect","select",null,w,k),_.push({event:w,listeners:B}),w.target=$c)))}function Pu(_,w){var k={};return k[_.toLowerCase()]=w.toLowerCase(),k["Webkit"+_]="webkit"+w,k["Moz"+_]="moz"+w,k}var no={animationend:Pu("Animation","AnimationEnd"),animationiteration:Pu("Animation","AnimationIteration"),animationstart:Pu("Animation","AnimationStart"),transitionend:Pu("Transition","TransitionEnd")},Ih={},jt={};i&&(jt=document.createElement("div").style,"AnimationEvent"in window||(delete no.animationend.animation,delete no.animationiteration.animation,delete no.animationstart.animation),"TransitionEvent"in window||delete no.transitionend.transition);function Mh(_){if(Ih[_])return Ih[_];if(!no[_])return _;var w=no[_],k;for(k in w)if(w.hasOwnProperty(k)&&k in jt)return Ih[_]=w[k];return _}var Ru=Mh("animationend"),Nu=Mh("animationiteration"),kh=Mh("animationstart"),Ph=Mh("transitionend"),hl=new Map,zd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ws(_,w){hl.set(_,w),m(w,[_])}for(var pn=0;pn<zd.length;pn++){var Gc=zd[pn],Hy=Gc.toLowerCase(),Gy=Gc[0].toUpperCase()+Gc.slice(1);Ws(Hy,"on"+Gy)}Ws(Ru,"onAnimationEnd"),Ws(Nu,"onAnimationIteration"),Ws(kh,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(Ph,"onTransitionEnd"),v("onMouseEnter",["mouseout","mouseover"]),v("onMouseLeave",["mouseout","mouseover"]),v("onPointerEnter",["pointerout","pointerover"]),v("onPointerLeave",["pointerout","pointerover"]),m("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),m("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),m("onBeforeInput",["compositionend","keypress","textInput","paste"]),m("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qy=new Set("cancel close invalid load scroll toggle".split(" ").concat(qc));function Ni(_,w,k){var B=_.type||"unknown-event";_.currentTarget=k,dt(B,w,void 0,_),_.currentTarget=null}function pm(_,w){w=(w&4)!==0;for(var k=0;k<_.length;k++){var B=_[k],Z=B.event;B=B.listeners;e:{var se=void 0;if(w)for(var we=B.length-1;0<=we;we--){var He=B[we],Qe=He.instance,Et=He.currentTarget;if(He=He.listener,Qe!==se&&Z.isPropagationStopped())break e;Ni(Z,He,Et),se=Qe}else for(we=0;we<B.length;we++){if(He=B[we],Qe=He.instance,Et=He.currentTarget,He=He.listener,Qe!==se&&Z.isPropagationStopped())break e;Ni(Z,He,Et),se=Qe}}}if(ze)throw _=We,ze=!1,We=null,_}function es(_,w){var k=w[Nl];k===void 0&&(k=w[Nl]=new Set);var B=_+"__bubble";k.has(B)||(Ag(w,_,2,!1),k.add(B))}function mm(_,w,k){var B=0;w&&(B|=4),Ag(k,_,B,w)}var Vf="_reactListening"+Math.random().toString(36).slice(2);function jd(_){if(!_[Vf]){_[Vf]=!0,l.forEach(function(k){k!=="selectionchange"&&(qy.has(k)||mm(k,!1,_),mm(k,!0,_))});var w=_.nodeType===9?_:_.ownerDocument;w===null||w[Vf]||(w[Vf]=!0,mm("selectionchange",!1,w))}}function Ag(_,w,k,B){switch(jc(w)){case 1:var Z=tc;break;case 4:Z=Rf;break;default:Z=bh}k=Z.bind(null,w,k,_),Z=void 0,!le||w!=="touchstart"&&w!=="touchmove"&&w!=="wheel"||(Z=!0),B?Z!==void 0?_.addEventListener(w,k,{capture:!0,passive:Z}):_.addEventListener(w,k,!0):Z!==void 0?_.addEventListener(w,k,{passive:Z}):_.addEventListener(w,k,!1)}function Uf(_,w,k,B,Z){var se=B;if((w&1)===0&&(w&2)===0&&B!==null)e:for(;;){if(B===null)return;var we=B.tag;if(we===3||we===4){var He=B.stateNode.containerInfo;if(He===Z||He.nodeType===8&&He.parentNode===Z)break;if(we===4)for(we=B.return;we!==null;){var Qe=we.tag;if((Qe===3||Qe===4)&&(Qe=we.stateNode.containerInfo,Qe===Z||Qe.nodeType===8&&Qe.parentNode===Z))return;we=we.return}for(;He!==null;){if(we=Ou(He),we===null)return;if(Qe=we.tag,Qe===5||Qe===6){B=se=we;continue e}He=He.parentNode}}B=B.return}Sn(function(){var Et=se,ur=ci(k),pr=[];e:{var sr=hl.get(_);if(sr!==void 0){var Wr=Ma,tn=_;switch(_){case"keypress":if(_o(k)===0)break e;case"keydown":case"keyup":Wr=Md;break;case"focusin":tn="focus",Wr=Un;break;case"focusout":tn="blur",Wr=Un;break;case"beforeblur":case"afterblur":Wr=Un;break;case"click":if(k.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Wr=ra;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Wr=Th;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Wr=Ao;break;case Ru:case Nu:case kh:Wr=na;break;case Ph:Wr=Uo;break;case"scroll":Wr=cm;break;case"wheel":Wr=ln;break;case"copy":case"cut":case"paste":Wr=$n;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Wr=Ch}var an=(w&4)!==0,Vs=!an&&_==="scroll",yt=an?sr!==null?sr+"Capture":null:sr;an=[];for(var ut=Et,bt;ut!==null;){bt=ut;var wr=bt.stateNode;if(bt.tag===5&&wr!==null&&(bt=wr,yt!==null&&(wr=Ke(ut,yt),wr!=null&&an.push(Fd(ut,wr,bt)))),Vs)break;ut=ut.return}0<an.length&&(sr=new Wr(sr,tn,null,k,ur),pr.push({event:sr,listeners:an}))}}if((w&7)===0){e:{if(sr=_==="mouseover"||_==="pointerover",Wr=_==="mouseout"||_==="pointerout",sr&&k!==Dr&&(tn=k.relatedTarget||k.fromElement)&&(Ou(tn)||tn[Rl]))break e;if((Wr||sr)&&(sr=ur.window===ur?ur:(sr=ur.ownerDocument)?sr.defaultView||sr.parentWindow:window,Wr?(tn=k.relatedTarget||k.toElement,Wr=Et,tn=tn?Ou(tn):null,tn!==null&&(Vs=Ze(tn),tn!==Vs||tn.tag!==5&&tn.tag!==6)&&(tn=null)):(Wr=null,tn=Et),Wr!==tn)){if(an=ra,wr="onMouseLeave",yt="onMouseEnter",ut="mouse",(_==="pointerout"||_==="pointerover")&&(an=Ch,wr="onPointerLeave",yt="onPointerEnter",ut="pointer"),Vs=Wr==null?sr:Zc(Wr),bt=tn==null?sr:Zc(tn),sr=new an(wr,ut+"leave",Wr,k,ur),sr.target=Vs,sr.relatedTarget=bt,wr=null,Ou(ur)===Et&&(an=new an(yt,ut+"enter",tn,k,ur),an.target=bt,an.relatedTarget=Vs,wr=an),Vs=wr,Wr&&tn)t:{for(an=Wr,yt=tn,ut=0,bt=an;bt;bt=Rh(bt))ut++;for(bt=0,wr=yt;wr;wr=Rh(wr))bt++;for(;0<ut-bt;)an=Rh(an),ut--;for(;0<bt-ut;)yt=Rh(yt),bt--;for(;ut--;){if(an===yt||yt!==null&&an===yt.alternate)break t;an=Rh(an),yt=Rh(yt)}an=null}else an=null;Wr!==null&&gm(pr,sr,Wr,an,!1),tn!==null&&Vs!==null&&gm(pr,Vs,tn,an,!0)}}e:{if(sr=Et?Zc(Et):window,Wr=sr.nodeName&&sr.nodeName.toLowerCase(),Wr==="select"||Wr==="input"&&sr.type==="file")var fn=Vy;else if(Ms(sr))if(oc)fn=$y;else{fn=lc;var mn=dm}else(Wr=sr.nodeName)&&Wr.toLowerCase()==="input"&&(sr.type==="checkbox"||sr.type==="radio")&&(fn=Uy);if(fn&&(fn=fn(_,Et))){Lf(pr,fn,k,ur);break e}mn&&mn(_,sr,Et),_==="focusout"&&(mn=sr._wrapperState)&&mn.controlled&&sr.type==="number"&&zi(sr,"number",sr.value)}switch(mn=Et?Zc(Et):window,_){case"focusin":(Ms(mn)||mn.contentEditable==="true")&&($c=mn,Ld=Et,Il=null);break;case"focusout":Il=Ld=$c=null;break;case"mousedown":Hc=!0;break;case"contextmenu":case"mouseup":case"dragend":Hc=!1,Bf(pr,k,ur);break;case"selectionchange":if(Od)break;case"keydown":case"keyup":Bf(pr,k,ur)}var En;if(ia)e:{switch(_){case"compositionstart":var zn="onCompositionStart";break e;case"compositionend":zn="onCompositionEnd";break e;case"compositionupdate":zn="onCompositionUpdate";break e}zn=void 0}else Mu?Iu(_,k)&&(zn="onCompositionEnd"):_==="keydown"&&k.keyCode===229&&(zn="onCompositionStart");zn&&(Ah&&k.locale!=="ko"&&(Mu||zn!=="onCompositionStart"?zn==="onCompositionEnd"&&Mu&&(En=Fc()):(cl=ur,Cd="value"in cl?cl.value:cl.textContent,Mu=!0)),mn=Du(Et,zn),0<mn.length&&(zn=new Eh(zn,_,null,k,ur),pr.push({event:zn,listeners:mn}),En?zn.data=En:(En=sc(k),En!==null&&(zn.data=En)))),(En=as?Ya(_,k):Io(_,k))&&(Et=Du(Et,"onBeforeInput"),0<Et.length&&(ur=new Eh("onBeforeInput","beforeinput",null,k,ur),pr.push({event:ur,listeners:Et}),ur.data=En))}pm(pr,w)})}function Fd(_,w,k){return{instance:_,listener:w,currentTarget:k}}function Du(_,w){for(var k=w+"Capture",B=[];_!==null;){var Z=_,se=Z.stateNode;Z.tag===5&&se!==null&&(Z=se,se=Ke(_,k),se!=null&&B.unshift(Fd(_,se,Z)),se=Ke(_,w),se!=null&&B.push(Fd(_,se,Z))),_=_.return}return B}function Rh(_){if(_===null)return null;do _=_.return;while(_&&_.tag!==5);return _||null}function gm(_,w,k,B,Z){for(var se=w._reactName,we=[];k!==null&&k!==B;){var He=k,Qe=He.alternate,Et=He.stateNode;if(Qe!==null&&Qe===B)break;He.tag===5&&Et!==null&&(He=Et,Z?(Qe=Ke(k,se),Qe!=null&&we.unshift(Fd(k,Qe,He))):Z||(Qe=Ke(k,se),Qe!=null&&we.push(Fd(k,Qe,He)))),k=k.return}we.length!==0&&_.push({event:w,listeners:we})}var ym=/\r\n?/g,$f=/\u0000|\uFFFD/g;function Hf(_){return(typeof _=="string"?_:""+_).replace(ym,`
`).replace($f,"")}function Ml(_,w,k){if(w=Hf(w),Hf(_)!==w&&k)throw Error(s(425))}function cc(){}var Nh=null,Dh=null;function Wc(_,w){return _==="textarea"||_==="noscript"||typeof w.children=="string"||typeof w.children=="number"||typeof w.dangerouslySetInnerHTML=="object"&&w.dangerouslySetInnerHTML!==null&&w.dangerouslySetInnerHTML.__html!=null}var Gf=typeof setTimeout=="function"?setTimeout:void 0,_m=typeof clearTimeout=="function"?clearTimeout:void 0,xm=typeof Promise=="function"?Promise:void 0,Oh=typeof queueMicrotask=="function"?queueMicrotask:typeof xm<"u"?function(_){return xm.resolve(null).then(_).catch(qf)}:Gf;function qf(_){setTimeout(function(){throw _})}function Lh(_,w){var k=w,B=0;do{var Z=k.nextSibling;if(_.removeChild(k),Z&&Z.nodeType===8)if(k=Z.data,k==="/$"){if(B===0){_.removeChild(Z),wu(w);return}B--}else k!=="$"&&k!=="$?"&&k!=="$!"||B++;k=Z}while(k);wu(w)}function kl(_){for(;_!=null;_=_.nextSibling){var w=_.nodeType;if(w===1||w===3)break;if(w===8){if(w=_.data,w==="$"||w==="$!"||w==="$?")break;if(w==="/$")return null}}return _}function Bd(_){_=_.previousSibling;for(var w=0;_;){if(_.nodeType===8){var k=_.data;if(k==="$"||k==="$!"||k==="$?"){if(w===0)return _;w--}else k==="/$"&&w++}_=_.previousSibling}return null}var Pl=Math.random().toString(36).slice(2),dl="__reactFiber$"+Pl,zh="__reactProps$"+Pl,Rl="__reactContainer$"+Pl,Nl="__reactEvents$"+Pl,Ig="__reactListeners$"+Pl,Mg="__reactHandles$"+Pl;function Ou(_){var w=_[dl];if(w)return w;for(var k=_.parentNode;k;){if(w=k[Rl]||k[dl]){if(k=w.alternate,w.child!==null||k!==null&&k.child!==null)for(_=Bd(_);_!==null;){if(k=_[dl])return k;_=Bd(_)}return w}_=k,k=_.parentNode}return null}function Vd(_){return _=_[dl]||_[Rl],!_||_.tag!==5&&_.tag!==6&&_.tag!==13&&_.tag!==3?null:_}function Zc(_){if(_.tag===5||_.tag===6)return _.stateNode;throw Error(s(33))}function Lu(_){return _[zh]||null}var jh=[],ka=-1;function Dl(_){return{current:_}}function ts(_){0>ka||(_.current=jh[ka],jh[ka]=null,ka--)}function rs(_,w){ka++,jh[ka]=_.current,_.current=w}var oa={},bs=Dl(oa),$o=Dl(!1),Zs=oa;function uc(_,w){var k=_.type.contextTypes;if(!k)return oa;var B=_.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===w)return B.__reactInternalMemoizedMaskedChildContext;var Z={},se;for(se in k)Z[se]=w[se];return B&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=w,_.__reactInternalMemoizedMaskedChildContext=Z),Z}function io(_){return _=_.childContextTypes,_!=null}function zu(){ts($o),ts(bs)}function Wf(_,w,k){if(bs.current!==oa)throw Error(s(168));rs(bs,w),rs($o,k)}function Zf(_,w,k){var B=_.stateNode;if(w=w.childContextTypes,typeof B.getChildContext!="function")return k;B=B.getChildContext();for(var Z in B)if(!(Z in w))throw Error(s(108,lr(_)||"Unknown",Z));return Ht({},k,B)}function ju(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||oa,Zs=bs.current,rs(bs,_),rs($o,$o.current),!0}function Fh(_,w,k){var B=_.stateNode;if(!B)throw Error(s(169));k?(_=Zf(_,w,Zs),B.__reactInternalMemoizedMergedChildContext=_,ts($o),ts(bs),rs(bs,_)):ts($o),rs($o,k)}var aa=null,Bh=!1,Fu=!1;function vm(_){aa===null?aa=[_]:aa.push(_)}function kg(_){Bh=!0,vm(_)}function la(){if(!Fu&&aa!==null){Fu=!0;var _=0,w=fi;try{var k=aa;for(fi=1;_<k.length;_++){var B=k[_];do B=B(!0);while(B!==null)}aa=null,Bh=!1}catch(Z){throw aa!==null&&(aa=aa.slice(_+1)),Ur(Fn,la),Z}finally{fi=w,Fu=!1}}return null}var Bu=[],Vh=0,Xf=null,Kf=0,Ho=[],Qa=0,Ol=null,fl=1,Ll="";function Pa(_,w){Bu[Vh++]=Kf,Bu[Vh++]=Xf,Xf=_,Kf=w}function Yf(_,w,k){Ho[Qa++]=fl,Ho[Qa++]=Ll,Ho[Qa++]=Ol,Ol=_;var B=fl;_=Ll;var Z=32-Bo(B)-1;B&=~(1<<Z),k+=1;var se=32-Bo(w)+Z;if(30<se){var we=Z-Z%5;se=(B&(1<<we)-1).toString(32),B>>=we,Z-=we,fl=1<<32-Bo(w)+Z|k<<Z|B,Ll=se+_}else fl=1<<se|k<<Z|B,Ll=_}function Ud(_){_.return!==null&&(Pa(_,1),Yf(_,1,0))}function Jf(_){for(;_===Xf;)Xf=Bu[--Vh],Bu[Vh]=null,Kf=Bu[--Vh],Bu[Vh]=null;for(;_===Ol;)Ol=Ho[--Qa],Ho[Qa]=null,Ll=Ho[--Qa],Ho[Qa]=null,fl=Ho[--Qa],Ho[Qa]=null}var Ls=null,Xs=null,ls=!1,so=null;function $d(_,w){var k=ws(5,null,null,0);k.elementType="DELETED",k.stateNode=w,k.return=_,w=_.deletions,w===null?(_.deletions=[k],_.flags|=16):w.push(k)}function Uh(_,w){switch(_.tag){case 5:var k=_.type;return w=w.nodeType!==1||k.toLowerCase()!==w.nodeName.toLowerCase()?null:w,w!==null?(_.stateNode=w,Ls=_,Xs=kl(w.firstChild),!0):!1;case 6:return w=_.pendingProps===""||w.nodeType!==3?null:w,w!==null?(_.stateNode=w,Ls=_,Xs=null,!0):!1;case 13:return w=w.nodeType!==8?null:w,w!==null?(k=Ol!==null?{id:fl,overflow:Ll}:null,_.memoizedState={dehydrated:w,treeContext:k,retryLane:1073741824},k=ws(18,null,null,0),k.stateNode=w,k.return=_,_.child=k,Ls=_,Xs=null,!0):!1;default:return!1}}function Hd(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Gd(_){if(ls){var w=Xs;if(w){var k=w;if(!Uh(_,w)){if(Hd(_))throw Error(s(418));w=kl(k.nextSibling);var B=Ls;w&&Uh(_,w)?$d(B,k):(_.flags=_.flags&-4097|2,ls=!1,Ls=_)}}else{if(Hd(_))throw Error(s(418));_.flags=_.flags&-4097|2,ls=!1,Ls=_}}}function $h(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;Ls=_}function Xc(_){if(_!==Ls)return!1;if(!ls)return $h(_),ls=!0,!1;var w;if((w=_.tag!==3)&&!(w=_.tag!==5)&&(w=_.type,w=w!=="head"&&w!=="body"&&!Wc(_.type,_.memoizedProps)),w&&(w=Xs)){if(Hd(_))throw bm(),Error(s(418));for(;w;)$d(_,w),w=kl(w.nextSibling)}if($h(_),_.tag===13){if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));e:{for(_=_.nextSibling,w=0;_;){if(_.nodeType===8){var k=_.data;if(k==="/$"){if(w===0){Xs=kl(_.nextSibling);break e}w--}else k!=="$"&&k!=="$!"&&k!=="$?"||w++}_=_.nextSibling}Xs=null}}else Xs=Ls?kl(_.stateNode.nextSibling):null;return!0}function bm(){for(var _=Xs;_;)_=kl(_.nextSibling)}function Vu(){Xs=Ls=null,ls=!1}function ca(_){so===null?so=[_]:so.push(_)}var Wy=ht.ReactCurrentBatchConfig;function qd(_,w,k){if(_=k.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(k._owner){if(k=k._owner,k){if(k.tag!==1)throw Error(s(309));var B=k.stateNode}if(!B)throw Error(s(147,_));var Z=B,se=""+_;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===se?w.ref:(w=function(we){var He=Z.refs;we===null?delete He[se]:He[se]=we},w._stringRef=se,w)}if(typeof _!="string")throw Error(s(284));if(!k._owner)throw Error(s(290,_))}return _}function Hh(_,w){throw _=Object.prototype.toString.call(w),Error(s(31,_==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":_))}function Pg(_){var w=_._init;return w(_._payload)}function Uu(_){function w(yt,ut){if(_){var bt=yt.deletions;bt===null?(yt.deletions=[ut],yt.flags|=16):bt.push(ut)}}function k(yt,ut){if(!_)return null;for(;ut!==null;)w(yt,ut),ut=ut.sibling;return null}function B(yt,ut){for(yt=new Map;ut!==null;)ut.key!==null?yt.set(ut.key,ut):yt.set(ut.index,ut),ut=ut.sibling;return yt}function Z(yt,ut){return yt=Ko(yt,ut),yt.index=0,yt.sibling=null,yt}function se(yt,ut,bt){return yt.index=bt,_?(bt=yt.alternate,bt!==null?(bt=bt.index,bt<ut?(yt.flags|=2,ut):bt):(yt.flags|=2,ut)):(yt.flags|=1048576,ut)}function we(yt){return _&&yt.alternate===null&&(yt.flags|=2),yt}function He(yt,ut,bt,wr){return ut===null||ut.tag!==6?(ut=uf(bt,yt.mode,wr),ut.return=yt,ut):(ut=Z(ut,bt),ut.return=yt,ut)}function Qe(yt,ut,bt,wr){var fn=bt.type;return fn===kt?ur(yt,ut,bt.props.children,wr,bt.key):ut!==null&&(ut.elementType===fn||typeof fn=="object"&&fn!==null&&fn.$$typeof===Yt&&Pg(fn)===ut.type)?(wr=Z(ut,bt.props),wr.ref=qd(yt,ut,bt),wr.return=yt,wr):(wr=fa(bt.type,bt.key,bt.props,null,yt.mode,wr),wr.ref=qd(yt,ut,bt),wr.return=yt,wr)}function Et(yt,ut,bt,wr){return ut===null||ut.tag!==4||ut.stateNode.containerInfo!==bt.containerInfo||ut.stateNode.implementation!==bt.implementation?(ut=ou(bt,yt.mode,wr),ut.return=yt,ut):(ut=Z(ut,bt.children||[]),ut.return=yt,ut)}function ur(yt,ut,bt,wr,fn){return ut===null||ut.tag!==7?(ut=pa(bt,yt.mode,wr,fn),ut.return=yt,ut):(ut=Z(ut,bt),ut.return=yt,ut)}function pr(yt,ut,bt){if(typeof ut=="string"&&ut!==""||typeof ut=="number")return ut=uf(""+ut,yt.mode,bt),ut.return=yt,ut;if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case at:return bt=fa(ut.type,ut.key,ut.props,null,yt.mode,bt),bt.ref=qd(yt,null,ut),bt.return=yt,bt;case Dt:return ut=ou(ut,yt.mode,bt),ut.return=yt,ut;case Yt:var wr=ut._init;return pr(yt,wr(ut._payload),bt)}if(Ki(ut)||Jt(ut))return ut=pa(ut,yt.mode,bt,null),ut.return=yt,ut;Hh(yt,ut)}return null}function sr(yt,ut,bt,wr){var fn=ut!==null?ut.key:null;if(typeof bt=="string"&&bt!==""||typeof bt=="number")return fn!==null?null:He(yt,ut,""+bt,wr);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case at:return bt.key===fn?Qe(yt,ut,bt,wr):null;case Dt:return bt.key===fn?Et(yt,ut,bt,wr):null;case Yt:return fn=bt._init,sr(yt,ut,fn(bt._payload),wr)}if(Ki(bt)||Jt(bt))return fn!==null?null:ur(yt,ut,bt,wr,null);Hh(yt,bt)}return null}function Wr(yt,ut,bt,wr,fn){if(typeof wr=="string"&&wr!==""||typeof wr=="number")return yt=yt.get(bt)||null,He(ut,yt,""+wr,fn);if(typeof wr=="object"&&wr!==null){switch(wr.$$typeof){case at:return yt=yt.get(wr.key===null?bt:wr.key)||null,Qe(ut,yt,wr,fn);case Dt:return yt=yt.get(wr.key===null?bt:wr.key)||null,Et(ut,yt,wr,fn);case Yt:var mn=wr._init;return Wr(yt,ut,bt,mn(wr._payload),fn)}if(Ki(wr)||Jt(wr))return yt=yt.get(bt)||null,ur(ut,yt,wr,fn,null);Hh(ut,wr)}return null}function tn(yt,ut,bt,wr){for(var fn=null,mn=null,En=ut,zn=ut=0,vo=null;En!==null&&zn<bt.length;zn++){En.index>zn?(vo=En,En=null):vo=En.sibling;var Zi=sr(yt,En,bt[zn],wr);if(Zi===null){En===null&&(En=vo);break}_&&En&&Zi.alternate===null&&w(yt,En),ut=se(Zi,ut,zn),mn===null?fn=Zi:mn.sibling=Zi,mn=Zi,En=vo}if(zn===bt.length)return k(yt,En),ls&&Pa(yt,zn),fn;if(En===null){for(;zn<bt.length;zn++)En=pr(yt,bt[zn],wr),En!==null&&(ut=se(En,ut,zn),mn===null?fn=En:mn.sibling=En,mn=En);return ls&&Pa(yt,zn),fn}for(En=B(yt,En);zn<bt.length;zn++)vo=Wr(En,yt,zn,bt[zn],wr),vo!==null&&(_&&vo.alternate!==null&&En.delete(vo.key===null?zn:vo.key),ut=se(vo,ut,zn),mn===null?fn=vo:mn.sibling=vo,mn=vo);return _&&En.forEach(function(sd){return w(yt,sd)}),ls&&Pa(yt,zn),fn}function an(yt,ut,bt,wr){var fn=Jt(bt);if(typeof fn!="function")throw Error(s(150));if(bt=fn.call(bt),bt==null)throw Error(s(151));for(var mn=fn=null,En=ut,zn=ut=0,vo=null,Zi=bt.next();En!==null&&!Zi.done;zn++,Zi=bt.next()){En.index>zn?(vo=En,En=null):vo=En.sibling;var sd=sr(yt,En,Zi.value,wr);if(sd===null){En===null&&(En=vo);break}_&&En&&sd.alternate===null&&w(yt,En),ut=se(sd,ut,zn),mn===null?fn=sd:mn.sibling=sd,mn=sd,En=vo}if(Zi.done)return k(yt,En),ls&&Pa(yt,zn),fn;if(En===null){for(;!Zi.done;zn++,Zi=bt.next())Zi=pr(yt,Zi.value,wr),Zi!==null&&(ut=se(Zi,ut,zn),mn===null?fn=Zi:mn.sibling=Zi,mn=Zi);return ls&&Pa(yt,zn),fn}for(En=B(yt,En);!Zi.done;zn++,Zi=bt.next())Zi=Wr(En,yt,zn,Zi.value,wr),Zi!==null&&(_&&Zi.alternate!==null&&En.delete(Zi.key===null?zn:Zi.key),ut=se(Zi,ut,zn),mn===null?fn=Zi:mn.sibling=Zi,mn=Zi);return _&&En.forEach(function(H1){return w(yt,H1)}),ls&&Pa(yt,zn),fn}function Vs(yt,ut,bt,wr){if(typeof bt=="object"&&bt!==null&&bt.type===kt&&bt.key===null&&(bt=bt.props.children),typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case at:e:{for(var fn=bt.key,mn=ut;mn!==null;){if(mn.key===fn){if(fn=bt.type,fn===kt){if(mn.tag===7){k(yt,mn.sibling),ut=Z(mn,bt.props.children),ut.return=yt,yt=ut;break e}}else if(mn.elementType===fn||typeof fn=="object"&&fn!==null&&fn.$$typeof===Yt&&Pg(fn)===mn.type){k(yt,mn.sibling),ut=Z(mn,bt.props),ut.ref=qd(yt,mn,bt),ut.return=yt,yt=ut;break e}k(yt,mn);break}else w(yt,mn);mn=mn.sibling}bt.type===kt?(ut=pa(bt.props.children,yt.mode,wr,bt.key),ut.return=yt,yt=ut):(wr=fa(bt.type,bt.key,bt.props,null,yt.mode,wr),wr.ref=qd(yt,ut,bt),wr.return=yt,yt=wr)}return we(yt);case Dt:e:{for(mn=bt.key;ut!==null;){if(ut.key===mn)if(ut.tag===4&&ut.stateNode.containerInfo===bt.containerInfo&&ut.stateNode.implementation===bt.implementation){k(yt,ut.sibling),ut=Z(ut,bt.children||[]),ut.return=yt,yt=ut;break e}else{k(yt,ut);break}else w(yt,ut);ut=ut.sibling}ut=ou(bt,yt.mode,wr),ut.return=yt,yt=ut}return we(yt);case Yt:return mn=bt._init,Vs(yt,ut,mn(bt._payload),wr)}if(Ki(bt))return tn(yt,ut,bt,wr);if(Jt(bt))return an(yt,ut,bt,wr);Hh(yt,bt)}return typeof bt=="string"&&bt!==""||typeof bt=="number"?(bt=""+bt,ut!==null&&ut.tag===6?(k(yt,ut.sibling),ut=Z(ut,bt),ut.return=yt,yt=ut):(k(yt,ut),ut=uf(bt,yt.mode,wr),ut.return=yt,yt=ut),we(yt)):k(yt,ut)}return Vs}var hc=Uu(!0),zl=Uu(!1),Kc=Dl(null),Yc=null,$u=null,Jc=null;function Qc(){Jc=$u=Yc=null}function Gh(_){var w=Kc.current;ts(Kc),_._currentValue=w}function Wd(_,w,k){for(;_!==null;){var B=_.alternate;if((_.childLanes&w)!==w?(_.childLanes|=w,B!==null&&(B.childLanes|=w)):B!==null&&(B.childLanes&w)!==w&&(B.childLanes|=w),_===k)break;_=_.return}}function eu(_,w){Yc=_,Jc=$u=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&w)!==0&&(ko=!0),_.firstContext=null)}function zs(_){var w=_._currentValue;if(Jc!==_)if(_={context:_,memoizedValue:w,next:null},$u===null){if(Yc===null)throw Error(s(308));$u=_,Yc.dependencies={lanes:0,firstContext:_}}else $u=$u.next=_;return w}var Go=null;function Zt(_){Go===null?Go=[_]:Go.push(_)}function wm(_,w,k,B){var Z=w.interleaved;return Z===null?(k.next=k,Zt(w)):(k.next=Z.next,Z.next=k),w.interleaved=k,jl(_,B)}function jl(_,w){_.lanes|=w;var k=_.alternate;for(k!==null&&(k.lanes|=w),k=_,_=_.return;_!==null;)_.childLanes|=w,k=_.alternate,k!==null&&(k.childLanes|=w),k=_,_=_.return;return k.tag===3?k.stateNode:null}var qo=!1;function Fl(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xr(_,w){_=_.updateQueue,w.updateQueue===_&&(w.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Ra(_,w){return{eventTime:_,lane:w,tag:0,payload:null,callback:null,next:null}}function tu(_,w,k){var B=_.updateQueue;if(B===null)return null;if(B=B.shared,(Y&2)!==0){var Z=B.pending;return Z===null?w.next=w:(w.next=Z.next,Z.next=w),B.pending=w,jl(_,k)}return Z=B.interleaved,Z===null?(w.next=w,Zt(B)):(w.next=Z.next,Z.next=w),B.interleaved=w,jl(_,k)}function Qf(_,w,k){if(w=w.updateQueue,w!==null&&(w=w.shared,(k&4194240)!==0)){var B=w.lanes;B&=_.pendingLanes,k|=B,w.lanes=k,Aa(_,k)}}function ep(_,w){var k=_.updateQueue,B=_.alternate;if(B!==null&&(B=B.updateQueue,k===B)){var Z=null,se=null;if(k=k.firstBaseUpdate,k!==null){do{var we={eventTime:k.eventTime,lane:k.lane,tag:k.tag,payload:k.payload,callback:k.callback,next:null};se===null?Z=se=we:se=se.next=we,k=k.next}while(k!==null);se===null?Z=se=w:se=se.next=w}else Z=se=w;k={baseState:B.baseState,firstBaseUpdate:Z,lastBaseUpdate:se,shared:B.shared,effects:B.effects},_.updateQueue=k;return}_=k.lastBaseUpdate,_===null?k.firstBaseUpdate=w:_.next=w,k.lastBaseUpdate=w}function Zd(_,w,k,B){var Z=_.updateQueue;qo=!1;var se=Z.firstBaseUpdate,we=Z.lastBaseUpdate,He=Z.shared.pending;if(He!==null){Z.shared.pending=null;var Qe=He,Et=Qe.next;Qe.next=null,we===null?se=Et:we.next=Et,we=Qe;var ur=_.alternate;ur!==null&&(ur=ur.updateQueue,He=ur.lastBaseUpdate,He!==we&&(He===null?ur.firstBaseUpdate=Et:He.next=Et,ur.lastBaseUpdate=Qe))}if(se!==null){var pr=Z.baseState;we=0,ur=Et=Qe=null,He=se;do{var sr=He.lane,Wr=He.eventTime;if((B&sr)===sr){ur!==null&&(ur=ur.next={eventTime:Wr,lane:0,tag:He.tag,payload:He.payload,callback:He.callback,next:null});e:{var tn=_,an=He;switch(sr=w,Wr=k,an.tag){case 1:if(tn=an.payload,typeof tn=="function"){pr=tn.call(Wr,pr,sr);break e}pr=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=an.payload,sr=typeof tn=="function"?tn.call(Wr,pr,sr):tn,sr==null)break e;pr=Ht({},pr,sr);break e;case 2:qo=!0}}He.callback!==null&&He.lane!==0&&(_.flags|=64,sr=Z.effects,sr===null?Z.effects=[He]:sr.push(He))}else Wr={eventTime:Wr,lane:sr,tag:He.tag,payload:He.payload,callback:He.callback,next:null},ur===null?(Et=ur=Wr,Qe=pr):ur=ur.next=Wr,we|=sr;if(He=He.next,He===null){if(He=Z.shared.pending,He===null)break;sr=He,He=sr.next,sr.next=null,Z.lastBaseUpdate=sr,Z.shared.pending=null}}while(!0);if(ur===null&&(Qe=pr),Z.baseState=Qe,Z.firstBaseUpdate=Et,Z.lastBaseUpdate=ur,w=Z.shared.interleaved,w!==null){Z=w;do we|=Z.lane,Z=Z.next;while(Z!==w)}else se===null&&(Z.shared.lanes=0);Te|=we,_.lanes=we,_.memoizedState=pr}}function Rg(_,w,k){if(_=w.effects,w.effects=null,_!==null)for(w=0;w<_.length;w++){var B=_[w],Z=B.callback;if(Z!==null){if(B.callback=null,B=k,typeof Z!="function")throw Error(s(191,Z));Z.call(B)}}}var qh={},Bl=Dl(qh),Xd=Dl(qh),oo=Dl(qh);function dc(_){if(_===qh)throw Error(s(174));return _}function ao(_,w){switch(rs(oo,w),rs(Xd,_),rs(Bl,qh),_=w.nodeType,_){case 9:case 11:w=(w=w.documentElement)?w.namespaceURI:is(null,"");break;default:_=_===8?w.parentNode:w,w=_.namespaceURI||null,_=_.tagName,w=is(w,_)}ts(Bl),rs(Bl,w)}function ua(){ts(Bl),ts(Xd),ts(oo)}function ru(_){dc(oo.current);var w=dc(Bl.current),k=is(w,_.type);w!==k&&(rs(Xd,_),rs(Bl,k))}function Wh(_){Xd.current===_&&(ts(Bl),ts(Xd))}var ns=Dl(0);function fc(_){for(var w=_;w!==null;){if(w.tag===13){var k=w.memoizedState;if(k!==null&&(k=k.dehydrated,k===null||k.data==="$?"||k.data==="$!"))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if((w.flags&128)!==0)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var tp=[];function pl(){for(var _=0;_<tp.length;_++)tp[_]._workInProgressVersionPrimary=null;tp.length=0}var Hn=ht.ReactCurrentDispatcher,Hu=ht.ReactCurrentBatchConfig,ha=0,ds=null,js=null,Ks=null,rp=!1,Vl=!1,ml=0,Tt=0;function zt(){throw Error(s(321))}function pc(_,w){if(w===null)return!1;for(var k=0;k<w.length&&k<_.length;k++)if(!Ja(_[k],w[k]))return!1;return!0}function Di(_,w,k,B,Z,se){if(ha=se,ds=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,Hn.current=_===null||_.memoizedState===null?Qd:up,_=k(B,Z),Vl){se=0;do{if(Vl=!1,ml=0,25<=se)throw Error(s(301));se+=1,Ks=js=null,w.updateQueue=null,Hn.current=Jh,_=k(B,Z)}while(Vl)}if(Hn.current=yl,w=js!==null&&js.next!==null,ha=0,Ks=js=ds=null,rp=!1,w)throw Error(s(300));return _}function $e(){var _=ml!==0;return ml=0,_}function Fs(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?ds.memoizedState=Ks=_:Ks=Ks.next=_,Ks}function Wo(){if(js===null){var _=ds.alternate;_=_!==null?_.memoizedState:null}else _=js.next;var w=Ks===null?ds.memoizedState:Ks.next;if(w!==null)Ks=w,js=_;else{if(_===null)throw Error(s(310));js=_,_={memoizedState:js.memoizedState,baseState:js.baseState,baseQueue:js.baseQueue,queue:js.queue,next:null},Ks===null?ds.memoizedState=Ks=_:Ks=Ks.next=_}return Ks}function nu(_,w){return typeof w=="function"?w(_):w}function Kd(_){var w=Wo(),k=w.queue;if(k===null)throw Error(s(311));k.lastRenderedReducer=_;var B=js,Z=B.baseQueue,se=k.pending;if(se!==null){if(Z!==null){var we=Z.next;Z.next=se.next,se.next=we}B.baseQueue=Z=se,k.pending=null}if(Z!==null){se=Z.next,B=B.baseState;var He=we=null,Qe=null,Et=se;do{var ur=Et.lane;if((ha&ur)===ur)Qe!==null&&(Qe=Qe.next={lane:0,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null}),B=Et.hasEagerState?Et.eagerState:_(B,Et.action);else{var pr={lane:ur,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null};Qe===null?(He=Qe=pr,we=B):Qe=Qe.next=pr,ds.lanes|=ur,Te|=ur}Et=Et.next}while(Et!==null&&Et!==se);Qe===null?we=B:Qe.next=He,Ja(B,w.memoizedState)||(ko=!0),w.memoizedState=B,w.baseState=we,w.baseQueue=Qe,k.lastRenderedState=B}if(_=k.interleaved,_!==null){Z=_;do se=Z.lane,ds.lanes|=se,Te|=se,Z=Z.next;while(Z!==_)}else Z===null&&(k.lanes=0);return[w.memoizedState,k.dispatch]}function np(_){var w=Wo(),k=w.queue;if(k===null)throw Error(s(311));k.lastRenderedReducer=_;var B=k.dispatch,Z=k.pending,se=w.memoizedState;if(Z!==null){k.pending=null;var we=Z=Z.next;do se=_(se,we.action),we=we.next;while(we!==Z);Ja(se,w.memoizedState)||(ko=!0),w.memoizedState=se,w.baseQueue===null&&(w.baseState=se),k.lastRenderedState=se}return[se,B]}function Sm(){}function Gu(_,w){var k=ds,B=Wo(),Z=w(),se=!Ja(B.memoizedState,Z);if(se&&(B.memoizedState=Z,ko=!0),B=B.queue,$l(Tm.bind(null,k,B,_),[_]),B.getSnapshot!==w||se||Ks!==null&&Ks.memoizedState.tag&1){if(k.flags|=2048,Zh(9,Dg.bind(null,k,B,Z,w),void 0,null),ne===null)throw Error(s(349));(ha&30)!==0||Ng(k,w,Z)}return Z}function Ng(_,w,k){_.flags|=16384,_={getSnapshot:w,value:k},w=ds.updateQueue,w===null?(w={lastEffect:null,stores:null},ds.updateQueue=w,w.stores=[_]):(k=w.stores,k===null?w.stores=[_]:k.push(_))}function Dg(_,w,k,B){w.value=k,w.getSnapshot=B,Yd(w)&&ip(_)}function Tm(_,w,k){return k(function(){Yd(w)&&ip(_)})}function Yd(_){var w=_.getSnapshot;_=_.value;try{var k=w();return!Ja(_,k)}catch{return!0}}function ip(_){var w=jl(_,1);w!==null&&Bt(w,_,1,-1)}function sp(_){var w=Fs();return typeof _=="function"&&(_=_()),w.memoizedState=w.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nu,lastRenderedState:_},w.queue=_,_=_.dispatch=lp.bind(null,ds,_),[w.memoizedState,_]}function Zh(_,w,k,B){return _={tag:_,create:w,destroy:k,deps:B,next:null},w=ds.updateQueue,w===null?(w={lastEffect:null,stores:null},ds.updateQueue=w,w.lastEffect=_.next=_):(k=w.lastEffect,k===null?w.lastEffect=_.next=_:(B=k.next,k.next=_,_.next=B,w.lastEffect=_)),_}function Jd(){return Wo().memoizedState}function iu(_,w,k,B){var Z=Fs();ds.flags|=_,Z.memoizedState=Zh(1|w,k,void 0,B===void 0?null:B)}function Ul(_,w,k,B){var Z=Wo();B=B===void 0?null:B;var se=void 0;if(js!==null){var we=js.memoizedState;if(se=we.destroy,B!==null&&pc(B,we.deps)){Z.memoizedState=Zh(w,k,se,B);return}}ds.flags|=_,Z.memoizedState=Zh(1|w,k,se,B)}function op(_,w){return iu(8390656,8,_,w)}function $l(_,w){return Ul(2048,8,_,w)}function lo(_,w){return Ul(4,2,_,w)}function Og(_,w){return Ul(4,4,_,w)}function Xh(_,w){if(typeof w=="function")return _=_(),w(_),function(){w(null)};if(w!=null)return _=_(),w.current=_,function(){w.current=null}}function pi(_,w,k){return k=k!=null?k.concat([_]):null,Ul(4,4,Xh.bind(null,w,_),k)}function Tn(){}function ap(_,w){var k=Wo();w=w===void 0?null:w;var B=k.memoizedState;return B!==null&&w!==null&&pc(w,B[1])?B[0]:(k.memoizedState=[_,w],_)}function Hl(_,w){var k=Wo();w=w===void 0?null:w;var B=k.memoizedState;return B!==null&&w!==null&&pc(w,B[1])?B[0]:(_=_(),k.memoizedState=[_,w],_)}function Kh(_,w,k){return(ha&21)===0?(_.baseState&&(_.baseState=!1,ko=!0),_.memoizedState=k):(Ja(k,w)||(k=Wa(),ds.lanes|=k,Te|=k,_.baseState=!0),w)}function Yh(_,w){var k=fi;fi=k!==0&&4>k?k:4,_(!0);var B=Hu.transition;Hu.transition={};try{_(!1),w()}finally{fi=k,Hu.transition=B}}function mc(){return Wo().memoizedState}function Em(_,w,k){var B=qt(_);if(k={lane:B,action:k,hasEagerState:!1,eagerState:null,next:null},qu(_))cp(w,k);else if(k=wm(_,w,k,B),k!==null){var Z=Vt();Bt(k,_,B,Z),gl(k,w,B)}}function lp(_,w,k){var B=qt(_),Z={lane:B,action:k,hasEagerState:!1,eagerState:null,next:null};if(qu(_))cp(w,Z);else{var se=_.alternate;if(_.lanes===0&&(se===null||se.lanes===0)&&(se=w.lastRenderedReducer,se!==null))try{var we=w.lastRenderedState,He=se(we,k);if(Z.hasEagerState=!0,Z.eagerState=He,Ja(He,we)){var Qe=w.interleaved;Qe===null?(Z.next=Z,Zt(w)):(Z.next=Qe.next,Qe.next=Z),w.interleaved=Z;return}}catch{}finally{}k=wm(_,w,Z,B),k!==null&&(Z=Vt(),Bt(k,_,B,Z),gl(k,w,B))}}function qu(_){var w=_.alternate;return _===ds||w!==null&&w===ds}function cp(_,w){Vl=rp=!0;var k=_.pending;k===null?w.next=w:(w.next=k.next,k.next=w),_.pending=w}function gl(_,w,k){if((k&4194240)!==0){var B=w.lanes;B&=_.pendingLanes,k|=B,w.lanes=k,Aa(_,k)}}var yl={readContext:zs,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},Qd={readContext:zs,useCallback:function(_,w){return Fs().memoizedState=[_,w===void 0?null:w],_},useContext:zs,useEffect:op,useImperativeHandle:function(_,w,k){return k=k!=null?k.concat([_]):null,iu(4194308,4,Xh.bind(null,w,_),k)},useLayoutEffect:function(_,w){return iu(4194308,4,_,w)},useInsertionEffect:function(_,w){return iu(4,2,_,w)},useMemo:function(_,w){var k=Fs();return w=w===void 0?null:w,_=_(),k.memoizedState=[_,w],_},useReducer:function(_,w,k){var B=Fs();return w=k!==void 0?k(w):w,B.memoizedState=B.baseState=w,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:w},B.queue=_,_=_.dispatch=Em.bind(null,ds,_),[B.memoizedState,_]},useRef:function(_){var w=Fs();return _={current:_},w.memoizedState=_},useState:sp,useDebugValue:Tn,useDeferredValue:function(_){return Fs().memoizedState=_},useTransition:function(){var _=sp(!1),w=_[0];return _=Yh.bind(null,_[1]),Fs().memoizedState=_,[w,_]},useMutableSource:function(){},useSyncExternalStore:function(_,w,k){var B=ds,Z=Fs();if(ls){if(k===void 0)throw Error(s(407));k=k()}else{if(k=w(),ne===null)throw Error(s(349));(ha&30)!==0||Ng(B,w,k)}Z.memoizedState=k;var se={value:k,getSnapshot:w};return Z.queue=se,op(Tm.bind(null,B,se,_),[_]),B.flags|=2048,Zh(9,Dg.bind(null,B,se,k,w),void 0,null),k},useId:function(){var _=Fs(),w=ne.identifierPrefix;if(ls){var k=Ll,B=fl;k=(B&~(1<<32-Bo(B)-1)).toString(32)+k,w=":"+w+"R"+k,k=ml++,0<k&&(w+="H"+k.toString(32)),w+=":"}else k=Tt++,w=":"+w+"r"+k.toString(32)+":";return _.memoizedState=w},unstable_isNewReconciler:!1},up={readContext:zs,useCallback:ap,useContext:zs,useEffect:$l,useImperativeHandle:pi,useInsertionEffect:lo,useLayoutEffect:Og,useMemo:Hl,useReducer:Kd,useRef:Jd,useState:function(){return Kd(nu)},useDebugValue:Tn,useDeferredValue:function(_){var w=Wo();return Kh(w,js.memoizedState,_)},useTransition:function(){var _=Kd(nu)[0],w=Wo().memoizedState;return[_,w]},useMutableSource:Sm,useSyncExternalStore:Gu,useId:mc,unstable_isNewReconciler:!1},Jh={readContext:zs,useCallback:ap,useContext:zs,useEffect:$l,useImperativeHandle:pi,useInsertionEffect:lo,useLayoutEffect:Og,useMemo:Hl,useReducer:np,useRef:Jd,useState:function(){return np(nu)},useDebugValue:Tn,useDeferredValue:function(_){var w=Wo();return js===null?w.memoizedState=_:Kh(w,js.memoizedState,_)},useTransition:function(){var _=np(nu)[0],w=Wo().memoizedState;return[_,w]},useMutableSource:Sm,useSyncExternalStore:Gu,useId:mc,unstable_isNewReconciler:!1};function Mo(_,w){if(_&&_.defaultProps){w=Ht({},w),_=_.defaultProps;for(var k in _)w[k]===void 0&&(w[k]=_[k]);return w}return w}function Ps(_,w,k,B){w=_.memoizedState,k=k(B,w),k=k==null?w:Ht({},w,k),_.memoizedState=k,_.lanes===0&&(_.updateQueue.baseState=k)}var gc={isMounted:function(_){return(_=_._reactInternals)?Ze(_)===_:!1},enqueueSetState:function(_,w,k){_=_._reactInternals;var B=Vt(),Z=qt(_),se=Ra(B,Z);se.payload=w,k!=null&&(se.callback=k),w=tu(_,se,Z),w!==null&&(Bt(w,_,Z,B),Qf(w,_,Z))},enqueueReplaceState:function(_,w,k){_=_._reactInternals;var B=Vt(),Z=qt(_),se=Ra(B,Z);se.tag=1,se.payload=w,k!=null&&(se.callback=k),w=tu(_,se,Z),w!==null&&(Bt(w,_,Z,B),Qf(w,_,Z))},enqueueForceUpdate:function(_,w){_=_._reactInternals;var k=Vt(),B=qt(_),Z=Ra(k,B);Z.tag=2,w!=null&&(Z.callback=w),w=tu(_,Z,B),w!==null&&(Bt(w,_,B,k),Qf(w,_,B))}};function yc(_,w,k,B,Z,se,we){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(B,se,we):w.prototype&&w.prototype.isPureReactComponent?!ul(k,B)||!ul(Z,se):!0}function hp(_,w,k){var B=!1,Z=oa,se=w.contextType;return typeof se=="object"&&se!==null?se=zs(se):(Z=io(w)?Zs:bs.current,B=w.contextTypes,se=(B=B!=null)?uc(_,Z):oa),w=new w(k,se),_.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=gc,_.stateNode=w,w._reactInternals=_,B&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=Z,_.__reactInternalMemoizedMaskedChildContext=se),w}function ef(_,w,k,B){_=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(k,B),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(k,B),w.state!==_&&gc.enqueueReplaceState(w,w.state,null)}function tf(_,w,k,B){var Z=_.stateNode;Z.props=k,Z.state=_.memoizedState,Z.refs={},Fl(_);var se=w.contextType;typeof se=="object"&&se!==null?Z.context=zs(se):(se=io(w)?Zs:bs.current,Z.context=uc(_,se)),Z.state=_.memoizedState,se=w.getDerivedStateFromProps,typeof se=="function"&&(Ps(_,w,se,k),Z.state=_.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof Z.getSnapshotBeforeUpdate=="function"||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(w=Z.state,typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount(),w!==Z.state&&gc.enqueueReplaceState(Z,Z.state,null),Zd(_,k,Z,B),Z.state=_.memoizedState),typeof Z.componentDidMount=="function"&&(_.flags|=4194308)}function Gl(_,w){try{var k="",B=w;do k+=Rr(B),B=B.return;while(B);var Z=k}catch(se){Z=`
Error generating stack: `+se.message+`
`+se.stack}return{value:_,source:w,stack:Z,digest:null}}function Rs(_,w,k){return{value:_,source:null,stack:k??null,digest:w??null}}function Wu(_,w){try{console.error(w.value)}catch(k){setTimeout(function(){throw k})}}var Cm=typeof WeakMap=="function"?WeakMap:Map;function dp(_,w,k){k=Ra(-1,k),k.tag=3,k.payload={element:null};var B=w.value;return k.callback=function(){mt||(mt=!0,Ue=B),Wu(_,w)},k}function _c(_,w,k){k=Ra(-1,k),k.tag=3;var B=_.type.getDerivedStateFromError;if(typeof B=="function"){var Z=w.value;k.payload=function(){return B(Z)},k.callback=function(){Wu(_,w)}}var se=_.stateNode;return se!==null&&typeof se.componentDidCatch=="function"&&(k.callback=function(){Wu(_,w),typeof B!="function"&&(Je===null?Je=new Set([this]):Je.add(this));var we=w.stack;this.componentDidCatch(w.value,{componentStack:we!==null?we:""})}),k}function Qh(_,w,k){var B=_.pingCache;if(B===null){B=_.pingCache=new Cm;var Z=new Set;B.set(w,Z)}else Z=B.get(w),Z===void 0&&(Z=new Set,B.set(w,Z));Z.has(k)||(Z.add(k),_=Gi.bind(null,_,w,k),w.then(_,_))}function fp(_){do{var w;if((w=_.tag===13)&&(w=_.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return _;_=_.return}while(_!==null);return null}function rf(_,w,k,B,Z){return(_.mode&1)===0?(_===w?_.flags|=65536:(_.flags|=128,k.flags|=131072,k.flags&=-52805,k.tag===1&&(k.alternate===null?k.tag=17:(w=Ra(-1,1),w.tag=2,tu(k,w,1))),k.lanes|=1),_):(_.flags|=65536,_.lanes=Z,_)}var Zu=ht.ReactCurrentOwner,ko=!1;function Ys(_,w,k,B){w.child=_===null?zl(w,null,k,B):hc(w,_.child,k,B)}function Xu(_,w,k,B,Z){k=k.render;var se=w.ref;return eu(w,Z),B=Di(_,w,k,B,se,Z),k=$e(),_!==null&&!ko?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,si(_,w,Z)):(ls&&k&&Ud(w),w.flags|=1,Ys(_,w,B,Z),w.child)}function ed(_,w,k,B,Z){if(_===null){var se=k.type;return typeof se=="function"&&!da(se)&&se.defaultProps===void 0&&k.compare===null&&k.defaultProps===void 0?(w.tag=15,w.type=se,pp(_,w,se,B,Z)):(_=fa(k.type,null,B,w,w.mode,Z),_.ref=w.ref,_.return=w,w.child=_)}if(se=_.child,(_.lanes&Z)===0){var we=se.memoizedProps;if(k=k.compare,k=k!==null?k:ul,k(we,B)&&_.ref===w.ref)return si(_,w,Z)}return w.flags|=1,_=Ko(se,B),_.ref=w.ref,_.return=w,w.child=_}function pp(_,w,k,B,Z){if(_!==null){var se=_.memoizedProps;if(ul(se,B)&&_.ref===w.ref)if(ko=!1,w.pendingProps=B=se,(_.lanes&Z)!==0)(_.flags&131072)!==0&&(ko=!0);else return w.lanes=_.lanes,si(_,w,Z)}return td(_,w,k,B,Z)}function nf(_,w,k){var B=w.pendingProps,Z=B.children,se=_!==null?_.memoizedState:null;if(B.mode==="hidden")if((w.mode&1)===0)w.memoizedState={baseLanes:0,cachePool:null,transitions:null},rs(xe,ge),ge|=k;else{if((k&1073741824)===0)return _=se!==null?se.baseLanes|k:k,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:_,cachePool:null,transitions:null},w.updateQueue=null,rs(xe,ge),ge|=_,null;w.memoizedState={baseLanes:0,cachePool:null,transitions:null},B=se!==null?se.baseLanes:k,rs(xe,ge),ge|=B}else se!==null?(B=se.baseLanes|k,w.memoizedState=null):B=k,rs(xe,ge),ge|=B;return Ys(_,w,Z,k),w.child}function Am(_,w){var k=w.ref;(_===null&&k!==null||_!==null&&_.ref!==k)&&(w.flags|=512,w.flags|=2097152)}function td(_,w,k,B,Z){var se=io(k)?Zs:bs.current;return se=uc(w,se),eu(w,Z),k=Di(_,w,k,B,se,Z),B=$e(),_!==null&&!ko?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,si(_,w,Z)):(ls&&B&&Ud(w),w.flags|=1,Ys(_,w,k,Z),w.child)}function Im(_,w,k,B,Z){if(io(k)){var se=!0;ju(w)}else se=!1;if(eu(w,Z),w.stateNode===null)Ku(_,w),hp(w,k,B),tf(w,k,B,Z),B=!0;else if(_===null){var we=w.stateNode,He=w.memoizedProps;we.props=He;var Qe=we.context,Et=k.contextType;typeof Et=="object"&&Et!==null?Et=zs(Et):(Et=io(k)?Zs:bs.current,Et=uc(w,Et));var ur=k.getDerivedStateFromProps,pr=typeof ur=="function"||typeof we.getSnapshotBeforeUpdate=="function";pr||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(He!==B||Qe!==Et)&&ef(w,we,B,Et),qo=!1;var sr=w.memoizedState;we.state=sr,Zd(w,B,we,Z),Qe=w.memoizedState,He!==B||sr!==Qe||$o.current||qo?(typeof ur=="function"&&(Ps(w,k,ur,B),Qe=w.memoizedState),(He=qo||yc(w,k,He,B,sr,Qe,Et))?(pr||typeof we.UNSAFE_componentWillMount!="function"&&typeof we.componentWillMount!="function"||(typeof we.componentWillMount=="function"&&we.componentWillMount(),typeof we.UNSAFE_componentWillMount=="function"&&we.UNSAFE_componentWillMount()),typeof we.componentDidMount=="function"&&(w.flags|=4194308)):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=B,w.memoizedState=Qe),we.props=B,we.state=Qe,we.context=Et,B=He):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),B=!1)}else{we=w.stateNode,xr(_,w),He=w.memoizedProps,Et=w.type===w.elementType?He:Mo(w.type,He),we.props=Et,pr=w.pendingProps,sr=we.context,Qe=k.contextType,typeof Qe=="object"&&Qe!==null?Qe=zs(Qe):(Qe=io(k)?Zs:bs.current,Qe=uc(w,Qe));var Wr=k.getDerivedStateFromProps;(ur=typeof Wr=="function"||typeof we.getSnapshotBeforeUpdate=="function")||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(He!==pr||sr!==Qe)&&ef(w,we,B,Qe),qo=!1,sr=w.memoizedState,we.state=sr,Zd(w,B,we,Z);var tn=w.memoizedState;He!==pr||sr!==tn||$o.current||qo?(typeof Wr=="function"&&(Ps(w,k,Wr,B),tn=w.memoizedState),(Et=qo||yc(w,k,Et,B,sr,tn,Qe)||!1)?(ur||typeof we.UNSAFE_componentWillUpdate!="function"&&typeof we.componentWillUpdate!="function"||(typeof we.componentWillUpdate=="function"&&we.componentWillUpdate(B,tn,Qe),typeof we.UNSAFE_componentWillUpdate=="function"&&we.UNSAFE_componentWillUpdate(B,tn,Qe)),typeof we.componentDidUpdate=="function"&&(w.flags|=4),typeof we.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof we.componentDidUpdate!="function"||He===_.memoizedProps&&sr===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||He===_.memoizedProps&&sr===_.memoizedState||(w.flags|=1024),w.memoizedProps=B,w.memoizedState=tn),we.props=B,we.state=tn,we.context=Qe,B=Et):(typeof we.componentDidUpdate!="function"||He===_.memoizedProps&&sr===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||He===_.memoizedProps&&sr===_.memoizedState||(w.flags|=1024),B=!1)}return mp(_,w,k,B,se,Z)}function mp(_,w,k,B,Z,se){Am(_,w);var we=(w.flags&128)!==0;if(!B&&!we)return Z&&Fh(w,k,!1),si(_,w,se);B=w.stateNode,Zu.current=w;var He=we&&typeof k.getDerivedStateFromError!="function"?null:B.render();return w.flags|=1,_!==null&&we?(w.child=hc(w,_.child,null,se),w.child=hc(w,null,He,se)):Ys(_,w,He,se),w.memoizedState=B.state,Z&&Fh(w,k,!0),w.child}function Mm(_){var w=_.stateNode;w.pendingContext?Wf(_,w.pendingContext,w.pendingContext!==w.context):w.context&&Wf(_,w.context,!1),ao(_,w.containerInfo)}function km(_,w,k,B,Z){return Vu(),ca(Z),w.flags|=256,Ys(_,w,k,B),w.child}var sf={dehydrated:null,treeContext:null,retryLane:0};function gp(_){return{baseLanes:_,cachePool:null,transitions:null}}function Pm(_,w,k){var B=w.pendingProps,Z=ns.current,se=!1,we=(w.flags&128)!==0,He;if((He=we)||(He=_!==null&&_.memoizedState===null?!1:(Z&2)!==0),He?(se=!0,w.flags&=-129):(_===null||_.memoizedState!==null)&&(Z|=1),rs(ns,Z&1),_===null)return Gd(w),_=w.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((w.mode&1)===0?w.lanes=1:_.data==="$!"?w.lanes=8:w.lanes=1073741824,null):(we=B.children,_=B.fallback,se?(B=w.mode,se=w.child,we={mode:"hidden",children:we},(B&1)===0&&se!==null?(se.childLanes=0,se.pendingProps=we):se=su(we,B,0,null),_=pa(_,B,k,null),se.return=w,_.return=w,se.sibling=_,w.child=se,w.child.memoizedState=gp(k),w.memoizedState=sf,_):yp(w,we));if(Z=_.memoizedState,Z!==null&&(He=Z.dehydrated,He!==null))return Lg(_,w,we,B,He,Z,k);if(se){se=B.fallback,we=w.mode,Z=_.child,He=Z.sibling;var Qe={mode:"hidden",children:B.children};return(we&1)===0&&w.child!==Z?(B=w.child,B.childLanes=0,B.pendingProps=Qe,w.deletions=null):(B=Ko(Z,Qe),B.subtreeFlags=Z.subtreeFlags&14680064),He!==null?se=Ko(He,se):(se=pa(se,we,k,null),se.flags|=2),se.return=w,B.return=w,B.sibling=se,w.child=B,B=se,se=w.child,we=_.child.memoizedState,we=we===null?gp(k):{baseLanes:we.baseLanes|k,cachePool:null,transitions:we.transitions},se.memoizedState=we,se.childLanes=_.childLanes&~k,w.memoizedState=sf,B}return se=_.child,_=se.sibling,B=Ko(se,{mode:"visible",children:B.children}),(w.mode&1)===0&&(B.lanes=k),B.return=w,B.sibling=null,_!==null&&(k=w.deletions,k===null?(w.deletions=[_],w.flags|=16):k.push(_)),w.child=B,w.memoizedState=null,B}function yp(_,w){return w=su({mode:"visible",children:w},_.mode,0,null),w.return=_,_.child=w}function of(_,w,k,B){return B!==null&&ca(B),hc(w,_.child,null,k),_=yp(w,w.pendingProps.children),_.flags|=2,w.memoizedState=null,_}function Lg(_,w,k,B,Z,se,we){if(k)return w.flags&256?(w.flags&=-257,B=Rs(Error(s(422))),of(_,w,we,B)):w.memoizedState!==null?(w.child=_.child,w.flags|=128,null):(se=B.fallback,Z=w.mode,B=su({mode:"visible",children:B.children},Z,0,null),se=pa(se,Z,we,null),se.flags|=2,B.return=w,se.return=w,B.sibling=se,w.child=B,(w.mode&1)!==0&&hc(w,_.child,null,we),w.child.memoizedState=gp(we),w.memoizedState=sf,se);if((w.mode&1)===0)return of(_,w,we,null);if(Z.data==="$!"){if(B=Z.nextSibling&&Z.nextSibling.dataset,B)var He=B.dgst;return B=He,se=Error(s(419)),B=Rs(se,B,void 0),of(_,w,we,B)}if(He=(we&_.childLanes)!==0,ko||He){if(B=ne,B!==null){switch(we&-we){case 4:Z=2;break;case 16:Z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Z=32;break;case 536870912:Z=268435456;break;default:Z=0}Z=(Z&(B.suspendedLanes|we))!==0?0:Z,Z!==0&&Z!==se.retryLane&&(se.retryLane=Z,jl(_,Z),Bt(B,_,Z,-1))}return ai(),B=Rs(Error(s(421))),of(_,w,we,B)}return Z.data==="$?"?(w.flags|=128,w.child=_.child,w=wi.bind(null,_),Z._reactRetry=w,null):(_=se.treeContext,Xs=kl(Z.nextSibling),Ls=w,ls=!0,so=null,_!==null&&(Ho[Qa++]=fl,Ho[Qa++]=Ll,Ho[Qa++]=Ol,fl=_.id,Ll=_.overflow,Ol=w),w=yp(w,B.children),w.flags|=4096,w)}function Rm(_,w,k){_.lanes|=w;var B=_.alternate;B!==null&&(B.lanes|=w),Wd(_.return,w,k)}function Nm(_,w,k,B,Z){var se=_.memoizedState;se===null?_.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:B,tail:k,tailMode:Z}:(se.isBackwards=w,se.rendering=null,se.renderingStartTime=0,se.last=B,se.tail=k,se.tailMode=Z)}function zg(_,w,k){var B=w.pendingProps,Z=B.revealOrder,se=B.tail;if(Ys(_,w,B.children,k),B=ns.current,(B&2)!==0)B=B&1|2,w.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=w.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&Rm(_,k,w);else if(_.tag===19)Rm(_,k,w);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===w)break e;for(;_.sibling===null;){if(_.return===null||_.return===w)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}B&=1}if(rs(ns,B),(w.mode&1)===0)w.memoizedState=null;else switch(Z){case"forwards":for(k=w.child,Z=null;k!==null;)_=k.alternate,_!==null&&fc(_)===null&&(Z=k),k=k.sibling;k=Z,k===null?(Z=w.child,w.child=null):(Z=k.sibling,k.sibling=null),Nm(w,!1,Z,k,se);break;case"backwards":for(k=null,Z=w.child,w.child=null;Z!==null;){if(_=Z.alternate,_!==null&&fc(_)===null){w.child=Z;break}_=Z.sibling,Z.sibling=k,k=Z,Z=_}Nm(w,!0,k,null,se);break;case"together":Nm(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function Ku(_,w){(w.mode&1)===0&&_!==null&&(_.alternate=null,w.alternate=null,w.flags|=2)}function si(_,w,k){if(_!==null&&(w.dependencies=_.dependencies),Te|=w.lanes,(k&w.childLanes)===0)return null;if(_!==null&&w.child!==_.child)throw Error(s(153));if(w.child!==null){for(_=w.child,k=Ko(_,_.pendingProps),w.child=k,k.return=w;_.sibling!==null;)_=_.sibling,k=k.sibling=Ko(_,_.pendingProps),k.return=w;k.sibling=null}return w.child}function jg(_,w,k){switch(w.tag){case 3:Mm(w),Vu();break;case 5:ru(w);break;case 1:io(w.type)&&ju(w);break;case 4:ao(w,w.stateNode.containerInfo);break;case 10:var B=w.type._context,Z=w.memoizedProps.value;rs(Kc,B._currentValue),B._currentValue=Z;break;case 13:if(B=w.memoizedState,B!==null)return B.dehydrated!==null?(rs(ns,ns.current&1),w.flags|=128,null):(k&w.child.childLanes)!==0?Pm(_,w,k):(rs(ns,ns.current&1),_=si(_,w,k),_!==null?_.sibling:null);rs(ns,ns.current&1);break;case 19:if(B=(k&w.childLanes)!==0,(_.flags&128)!==0){if(B)return zg(_,w,k);w.flags|=128}if(Z=w.memoizedState,Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),rs(ns,ns.current),B)break;return null;case 22:case 23:return w.lanes=0,nf(_,w,k)}return si(_,w,k)}var af,lf,Dm,rd;af=function(_,w){for(var k=w.child;k!==null;){if(k.tag===5||k.tag===6)_.appendChild(k.stateNode);else if(k.tag!==4&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===w)break;for(;k.sibling===null;){if(k.return===null||k.return===w)return;k=k.return}k.sibling.return=k.return,k=k.sibling}},lf=function(){},Dm=function(_,w,k,B){var Z=_.memoizedProps;if(Z!==B){_=w.stateNode,dc(Bl.current);var se=null;switch(k){case"input":Z=vs(_,Z),B=vs(_,B),se=[];break;case"select":Z=Ht({},Z,{value:void 0}),B=Ht({},B,{value:void 0}),se=[];break;case"textarea":Z=Qo(_,Z),B=Qo(_,B),se=[];break;default:typeof Z.onClick!="function"&&typeof B.onClick=="function"&&(_.onclick=cc)}As(k,B);var we;k=null;for(Et in Z)if(!B.hasOwnProperty(Et)&&Z.hasOwnProperty(Et)&&Z[Et]!=null)if(Et==="style"){var He=Z[Et];for(we in He)He.hasOwnProperty(we)&&(k||(k={}),k[we]="")}else Et!=="dangerouslySetInnerHTML"&&Et!=="children"&&Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(h.hasOwnProperty(Et)?se||(se=[]):(se=se||[]).push(Et,null));for(Et in B){var Qe=B[Et];if(He=Z?.[Et],B.hasOwnProperty(Et)&&Qe!==He&&(Qe!=null||He!=null))if(Et==="style")if(He){for(we in He)!He.hasOwnProperty(we)||Qe&&Qe.hasOwnProperty(we)||(k||(k={}),k[we]="");for(we in Qe)Qe.hasOwnProperty(we)&&He[we]!==Qe[we]&&(k||(k={}),k[we]=Qe[we])}else k||(se||(se=[]),se.push(Et,k)),k=Qe;else Et==="dangerouslySetInnerHTML"?(Qe=Qe?Qe.__html:void 0,He=He?He.__html:void 0,Qe!=null&&He!==Qe&&(se=se||[]).push(Et,Qe)):Et==="children"?typeof Qe!="string"&&typeof Qe!="number"||(se=se||[]).push(Et,""+Qe):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&(h.hasOwnProperty(Et)?(Qe!=null&&Et==="onScroll"&&es("scroll",_),se||He===Qe||(se=[])):(se=se||[]).push(Et,Qe))}k&&(se=se||[]).push("style",k);var Et=se;(w.updateQueue=Et)&&(w.flags|=4)}},rd=function(_,w,k,B){k!==B&&(w.flags|=4)};function Yu(_,w){if(!ls)switch(_.tailMode){case"hidden":w=_.tail;for(var k=null;w!==null;)w.alternate!==null&&(k=w),w=w.sibling;k===null?_.tail=null:k.sibling=null;break;case"collapsed":k=_.tail;for(var B=null;k!==null;)k.alternate!==null&&(B=k),k=k.sibling;B===null?w||_.tail===null?_.tail=null:_.tail.sibling=null:B.sibling=null}}function Js(_){var w=_.alternate!==null&&_.alternate.child===_.child,k=0,B=0;if(w)for(var Z=_.child;Z!==null;)k|=Z.lanes|Z.childLanes,B|=Z.subtreeFlags&14680064,B|=Z.flags&14680064,Z.return=_,Z=Z.sibling;else for(Z=_.child;Z!==null;)k|=Z.lanes|Z.childLanes,B|=Z.subtreeFlags,B|=Z.flags,Z.return=_,Z=Z.sibling;return _.subtreeFlags|=B,_.childLanes=k,w}function cf(_,w,k){var B=w.pendingProps;switch(Jf(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Js(w),null;case 1:return io(w.type)&&zu(),Js(w),null;case 3:return B=w.stateNode,ua(),ts($o),ts(bs),pl(),B.pendingContext&&(B.context=B.pendingContext,B.pendingContext=null),(_===null||_.child===null)&&(Xc(w)?w.flags|=4:_===null||_.memoizedState.isDehydrated&&(w.flags&256)===0||(w.flags|=1024,so!==null&&(Or(so),so=null))),lf(_,w),Js(w),null;case 5:Wh(w);var Z=dc(oo.current);if(k=w.type,_!==null&&w.stateNode!=null)Dm(_,w,k,B,Z),_.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!B){if(w.stateNode===null)throw Error(s(166));return Js(w),null}if(_=dc(Bl.current),Xc(w)){B=w.stateNode,k=w.type;var se=w.memoizedProps;switch(B[dl]=w,B[zh]=se,_=(w.mode&1)!==0,k){case"dialog":es("cancel",B),es("close",B);break;case"iframe":case"object":case"embed":es("load",B);break;case"video":case"audio":for(Z=0;Z<qc.length;Z++)es(qc[Z],B);break;case"source":es("error",B);break;case"img":case"image":case"link":es("error",B),es("load",B);break;case"details":es("toggle",B);break;case"input":$s(B,se),es("invalid",B);break;case"select":B._wrapperState={wasMultiple:!!se.multiple},es("invalid",B);break;case"textarea":To(B,se),es("invalid",B)}As(k,se),Z=null;for(var we in se)if(se.hasOwnProperty(we)){var He=se[we];we==="children"?typeof He=="string"?B.textContent!==He&&(se.suppressHydrationWarning!==!0&&Ml(B.textContent,He,_),Z=["children",He]):typeof He=="number"&&B.textContent!==""+He&&(se.suppressHydrationWarning!==!0&&Ml(B.textContent,He,_),Z=["children",""+He]):h.hasOwnProperty(we)&&He!=null&&we==="onScroll"&&es("scroll",B)}switch(k){case"input":Zn(B),El(B,se,!0);break;case"textarea":Zn(B),Ua(B);break;case"select":case"option":break;default:typeof se.onClick=="function"&&(B.onclick=cc)}B=Z,w.updateQueue=B,B!==null&&(w.flags|=4)}else{we=Z.nodeType===9?Z:Z.ownerDocument,_==="http://www.w3.org/1999/xhtml"&&(_=wa(k)),_==="http://www.w3.org/1999/xhtml"?k==="script"?(_=we.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild)):typeof B.is=="string"?_=we.createElement(k,{is:B.is}):(_=we.createElement(k),k==="select"&&(we=_,B.multiple?we.multiple=!0:B.size&&(we.size=B.size))):_=we.createElementNS(_,k),_[dl]=w,_[zh]=B,af(_,w,!1,!1),w.stateNode=_;e:{switch(we=$a(k,B),k){case"dialog":es("cancel",_),es("close",_),Z=B;break;case"iframe":case"object":case"embed":es("load",_),Z=B;break;case"video":case"audio":for(Z=0;Z<qc.length;Z++)es(qc[Z],_);Z=B;break;case"source":es("error",_),Z=B;break;case"img":case"image":case"link":es("error",_),es("load",_),Z=B;break;case"details":es("toggle",_),Z=B;break;case"input":$s(_,B),Z=vs(_,B),es("invalid",_);break;case"option":Z=B;break;case"select":_._wrapperState={wasMultiple:!!B.multiple},Z=Ht({},B,{value:void 0}),es("invalid",_);break;case"textarea":To(_,B),Z=Qo(_,B),es("invalid",_);break;default:Z=B}As(k,Z),He=Z;for(se in He)if(He.hasOwnProperty(se)){var Qe=He[se];se==="style"?Ea(_,Qe):se==="dangerouslySetInnerHTML"?(Qe=Qe?Qe.__html:void 0,Qe!=null&&Hs(_,Qe)):se==="children"?typeof Qe=="string"?(k!=="textarea"||Qe!=="")&&Fo(_,Qe):typeof Qe=="number"&&Fo(_,""+Qe):se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&se!=="autoFocus"&&(h.hasOwnProperty(se)?Qe!=null&&se==="onScroll"&&es("scroll",_):Qe!=null&&Fe(_,se,Qe,we))}switch(k){case"input":Zn(_),El(_,B,!1);break;case"textarea":Zn(_),Ua(_);break;case"option":B.value!=null&&_.setAttribute("value",""+$r(B.value));break;case"select":_.multiple=!!B.multiple,se=B.value,se!=null?to(_,!!B.multiple,se,!1):B.defaultValue!=null&&to(_,!!B.multiple,B.defaultValue,!0);break;default:typeof Z.onClick=="function"&&(_.onclick=cc)}switch(k){case"button":case"input":case"select":case"textarea":B=!!B.autoFocus;break e;case"img":B=!0;break e;default:B=!1}}B&&(w.flags|=4)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return Js(w),null;case 6:if(_&&w.stateNode!=null)rd(_,w,_.memoizedProps,B);else{if(typeof B!="string"&&w.stateNode===null)throw Error(s(166));if(k=dc(oo.current),dc(Bl.current),Xc(w)){if(B=w.stateNode,k=w.memoizedProps,B[dl]=w,(se=B.nodeValue!==k)&&(_=Ls,_!==null))switch(_.tag){case 3:Ml(B.nodeValue,k,(_.mode&1)!==0);break;case 5:_.memoizedProps.suppressHydrationWarning!==!0&&Ml(B.nodeValue,k,(_.mode&1)!==0)}se&&(w.flags|=4)}else B=(k.nodeType===9?k:k.ownerDocument).createTextNode(B),B[dl]=w,w.stateNode=B}return Js(w),null;case 13:if(ts(ns),B=w.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(ls&&Xs!==null&&(w.mode&1)!==0&&(w.flags&128)===0)bm(),Vu(),w.flags|=98560,se=!1;else if(se=Xc(w),B!==null&&B.dehydrated!==null){if(_===null){if(!se)throw Error(s(318));if(se=w.memoizedState,se=se!==null?se.dehydrated:null,!se)throw Error(s(317));se[dl]=w}else Vu(),(w.flags&128)===0&&(w.memoizedState=null),w.flags|=4;Js(w),se=!1}else so!==null&&(Or(so),so=null),se=!0;if(!se)return w.flags&65536?w:null}return(w.flags&128)!==0?(w.lanes=k,w):(B=B!==null,B!==(_!==null&&_.memoizedState!==null)&&B&&(w.child.flags|=8192,(w.mode&1)!==0&&(_===null||(ns.current&1)!==0?Ce===0&&(Ce=3):ai())),w.updateQueue!==null&&(w.flags|=4),Js(w),null);case 4:return ua(),lf(_,w),_===null&&jd(w.stateNode.containerInfo),Js(w),null;case 10:return Gh(w.type._context),Js(w),null;case 17:return io(w.type)&&zu(),Js(w),null;case 19:if(ts(ns),se=w.memoizedState,se===null)return Js(w),null;if(B=(w.flags&128)!==0,we=se.rendering,we===null)if(B)Yu(se,!1);else{if(Ce!==0||_!==null&&(_.flags&128)!==0)for(_=w.child;_!==null;){if(we=fc(_),we!==null){for(w.flags|=128,Yu(se,!1),B=we.updateQueue,B!==null&&(w.updateQueue=B,w.flags|=4),w.subtreeFlags=0,B=k,k=w.child;k!==null;)se=k,_=B,se.flags&=14680066,we=se.alternate,we===null?(se.childLanes=0,se.lanes=_,se.child=null,se.subtreeFlags=0,se.memoizedProps=null,se.memoizedState=null,se.updateQueue=null,se.dependencies=null,se.stateNode=null):(se.childLanes=we.childLanes,se.lanes=we.lanes,se.child=we.child,se.subtreeFlags=0,se.deletions=null,se.memoizedProps=we.memoizedProps,se.memoizedState=we.memoizedState,se.updateQueue=we.updateQueue,se.type=we.type,_=we.dependencies,se.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),k=k.sibling;return rs(ns,ns.current&1|2),w.child}_=_.sibling}se.tail!==null&&gn()>st&&(w.flags|=128,B=!0,Yu(se,!1),w.lanes=4194304)}else{if(!B)if(_=fc(we),_!==null){if(w.flags|=128,B=!0,k=_.updateQueue,k!==null&&(w.updateQueue=k,w.flags|=4),Yu(se,!0),se.tail===null&&se.tailMode==="hidden"&&!we.alternate&&!ls)return Js(w),null}else 2*gn()-se.renderingStartTime>st&&k!==1073741824&&(w.flags|=128,B=!0,Yu(se,!1),w.lanes=4194304);se.isBackwards?(we.sibling=w.child,w.child=we):(k=se.last,k!==null?k.sibling=we:w.child=we,se.last=we)}return se.tail!==null?(w=se.tail,se.rendering=w,se.tail=w.sibling,se.renderingStartTime=gn(),w.sibling=null,k=ns.current,rs(ns,B?k&1|2:k&1),w):(Js(w),null);case 22:case 23:return $i(),B=w.memoizedState!==null,_!==null&&_.memoizedState!==null!==B&&(w.flags|=8192),B&&(w.mode&1)!==0?(ge&1073741824)!==0&&(Js(w),w.subtreeFlags&6&&(w.flags|=8192)):Js(w),null;case 24:return null;case 25:return null}throw Error(s(156,w.tag))}function xc(_,w){switch(Jf(w),w.tag){case 1:return io(w.type)&&zu(),_=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 3:return ua(),ts($o),ts(bs),pl(),_=w.flags,(_&65536)!==0&&(_&128)===0?(w.flags=_&-65537|128,w):null;case 5:return Wh(w),null;case 13:if(ts(ns),_=w.memoizedState,_!==null&&_.dehydrated!==null){if(w.alternate===null)throw Error(s(340));Vu()}return _=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 19:return ts(ns),null;case 4:return ua(),null;case 10:return Gh(w.type._context),null;case 22:case 23:return $i(),null;case 24:return null;default:return null}}var Ju=!1,Xn=!1,ql=typeof WeakSet=="function"?WeakSet:Set,qr=null;function vc(_,w){var k=_.ref;if(k!==null)if(typeof k=="function")try{k(null)}catch(B){Xr(_,w,B)}else k.current=null}function _p(_,w,k){try{k()}catch(B){Xr(_,w,B)}}var Fg=!1;function nd(_,w){if(Nh=Ed,_=Ff(),Dd(_)){if("selectionStart"in _)var k={start:_.selectionStart,end:_.selectionEnd};else e:{k=(k=_.ownerDocument)&&k.defaultView||window;var B=k.getSelection&&k.getSelection();if(B&&B.rangeCount!==0){k=B.anchorNode;var Z=B.anchorOffset,se=B.focusNode;B=B.focusOffset;try{k.nodeType,se.nodeType}catch{k=null;break e}var we=0,He=-1,Qe=-1,Et=0,ur=0,pr=_,sr=null;t:for(;;){for(var Wr;pr!==k||Z!==0&&pr.nodeType!==3||(He=we+Z),pr!==se||B!==0&&pr.nodeType!==3||(Qe=we+B),pr.nodeType===3&&(we+=pr.nodeValue.length),(Wr=pr.firstChild)!==null;)sr=pr,pr=Wr;for(;;){if(pr===_)break t;if(sr===k&&++Et===Z&&(He=we),sr===se&&++ur===B&&(Qe=we),(Wr=pr.nextSibling)!==null)break;pr=sr,sr=pr.parentNode}pr=Wr}k=He===-1||Qe===-1?null:{start:He,end:Qe}}else k=null}k=k||{start:0,end:0}}else k=null;for(Dh={focusedElem:_,selectionRange:k},Ed=!1,qr=w;qr!==null;)if(w=qr,_=w.child,(w.subtreeFlags&1028)!==0&&_!==null)_.return=w,qr=_;else for(;qr!==null;){w=qr;try{var tn=w.alternate;if((w.flags&1024)!==0)switch(w.tag){case 0:case 11:case 15:break;case 1:if(tn!==null){var an=tn.memoizedProps,Vs=tn.memoizedState,yt=w.stateNode,ut=yt.getSnapshotBeforeUpdate(w.elementType===w.type?an:Mo(w.type,an),Vs);yt.__reactInternalSnapshotBeforeUpdate=ut}break;case 3:var bt=w.stateNode.containerInfo;bt.nodeType===1?bt.textContent="":bt.nodeType===9&&bt.documentElement&&bt.removeChild(bt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(wr){Xr(w,w.return,wr)}if(_=w.sibling,_!==null){_.return=w.return,qr=_;break}qr=w.return}return tn=Fg,Fg=!1,tn}function Qu(_,w,k){var B=w.updateQueue;if(B=B!==null?B.lastEffect:null,B!==null){var Z=B=B.next;do{if((Z.tag&_)===_){var se=Z.destroy;Z.destroy=void 0,se!==void 0&&_p(w,k,se)}Z=Z.next}while(Z!==B)}}function Na(_,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var k=w=w.next;do{if((k.tag&_)===_){var B=k.create;k.destroy=B()}k=k.next}while(k!==w)}}function eh(_){var w=_.ref;if(w!==null){var k=_.stateNode;switch(_.tag){case 5:_=k;break;default:_=k}typeof w=="function"?w(_):w.current=_}}function xp(_){var w=_.alternate;w!==null&&(_.alternate=null,xp(w)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(w=_.stateNode,w!==null&&(delete w[dl],delete w[zh],delete w[Nl],delete w[Ig],delete w[Mg])),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function id(_){return _.tag===5||_.tag===3||_.tag===4}function th(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||id(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function _l(_,w,k){var B=_.tag;if(B===5||B===6)_=_.stateNode,w?k.nodeType===8?k.parentNode.insertBefore(_,w):k.insertBefore(_,w):(k.nodeType===8?(w=k.parentNode,w.insertBefore(_,k)):(w=k,w.appendChild(_)),k=k._reactRootContainer,k!=null||w.onclick!==null||(w.onclick=cc));else if(B!==4&&(_=_.child,_!==null))for(_l(_,w,k),_=_.sibling;_!==null;)_l(_,w,k),_=_.sibling}function Da(_,w,k){var B=_.tag;if(B===5||B===6)_=_.stateNode,w?k.insertBefore(_,w):k.appendChild(_);else if(B!==4&&(_=_.child,_!==null))for(Da(_,w,k),_=_.sibling;_!==null;)Da(_,w,k),_=_.sibling}var Yi=null,Po=!1;function f(_,w,k){for(k=k.child;k!==null;)n(_,w,k),k=k.sibling}function n(_,w,k){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(ms,k)}catch{}switch(k.tag){case 5:Xn||vc(k,w);case 6:var B=Yi,Z=Po;Yi=null,f(_,w,k),Yi=B,Po=Z,Yi!==null&&(Po?(_=Yi,k=k.stateNode,_.nodeType===8?_.parentNode.removeChild(k):_.removeChild(k)):Yi.removeChild(k.stateNode));break;case 18:Yi!==null&&(Po?(_=Yi,k=k.stateNode,_.nodeType===8?Lh(_.parentNode,k):_.nodeType===1&&Lh(_,k),wu(_)):Lh(Yi,k.stateNode));break;case 4:B=Yi,Z=Po,Yi=k.stateNode.containerInfo,Po=!0,f(_,w,k),Yi=B,Po=Z;break;case 0:case 11:case 14:case 15:if(!Xn&&(B=k.updateQueue,B!==null&&(B=B.lastEffect,B!==null))){Z=B=B.next;do{var se=Z,we=se.destroy;se=se.tag,we!==void 0&&((se&2)!==0||(se&4)!==0)&&_p(k,w,we),Z=Z.next}while(Z!==B)}f(_,w,k);break;case 1:if(!Xn&&(vc(k,w),B=k.stateNode,typeof B.componentWillUnmount=="function"))try{B.props=k.memoizedProps,B.state=k.memoizedState,B.componentWillUnmount()}catch(He){Xr(k,w,He)}f(_,w,k);break;case 21:f(_,w,k);break;case 22:k.mode&1?(Xn=(B=Xn)||k.memoizedState!==null,f(_,w,k),Xn=B):f(_,w,k);break;default:f(_,w,k)}}function c(_){var w=_.updateQueue;if(w!==null){_.updateQueue=null;var k=_.stateNode;k===null&&(k=_.stateNode=new ql),w.forEach(function(B){var Z=Dn.bind(null,_,B);k.has(B)||(k.add(B),B.then(Z,Z))})}}function p(_,w){var k=w.deletions;if(k!==null)for(var B=0;B<k.length;B++){var Z=k[B];try{var se=_,we=w,He=we;e:for(;He!==null;){switch(He.tag){case 5:Yi=He.stateNode,Po=!1;break e;case 3:Yi=He.stateNode.containerInfo,Po=!0;break e;case 4:Yi=He.stateNode.containerInfo,Po=!0;break e}He=He.return}if(Yi===null)throw Error(s(160));n(se,we,Z),Yi=null,Po=!1;var Qe=Z.alternate;Qe!==null&&(Qe.return=null),Z.return=null}catch(Et){Xr(Z,w,Et)}}if(w.subtreeFlags&12854)for(w=w.child;w!==null;)x(w,_),w=w.sibling}function x(_,w){var k=_.alternate,B=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:if(p(w,_),S(_),B&4){try{Qu(3,_,_.return),Na(3,_)}catch(an){Xr(_,_.return,an)}try{Qu(5,_,_.return)}catch(an){Xr(_,_.return,an)}}break;case 1:p(w,_),S(_),B&512&&k!==null&&vc(k,k.return);break;case 5:if(p(w,_),S(_),B&512&&k!==null&&vc(k,k.return),_.flags&32){var Z=_.stateNode;try{Fo(Z,"")}catch(an){Xr(_,_.return,an)}}if(B&4&&(Z=_.stateNode,Z!=null)){var se=_.memoizedProps,we=k!==null?k.memoizedProps:se,He=_.type,Qe=_.updateQueue;if(_.updateQueue=null,Qe!==null)try{He==="input"&&se.type==="radio"&&se.name!=null&&Hi(Z,se),$a(He,we);var Et=$a(He,se);for(we=0;we<Qe.length;we+=2){var ur=Qe[we],pr=Qe[we+1];ur==="style"?Ea(Z,pr):ur==="dangerouslySetInnerHTML"?Hs(Z,pr):ur==="children"?Fo(Z,pr):Fe(Z,ur,pr,Et)}switch(He){case"input":mo(Z,se);break;case"textarea":Cs(Z,se);break;case"select":var sr=Z._wrapperState.wasMultiple;Z._wrapperState.wasMultiple=!!se.multiple;var Wr=se.value;Wr!=null?to(Z,!!se.multiple,Wr,!1):sr!==!!se.multiple&&(se.defaultValue!=null?to(Z,!!se.multiple,se.defaultValue,!0):to(Z,!!se.multiple,se.multiple?[]:"",!1))}Z[zh]=se}catch(an){Xr(_,_.return,an)}}break;case 6:if(p(w,_),S(_),B&4){if(_.stateNode===null)throw Error(s(162));Z=_.stateNode,se=_.memoizedProps;try{Z.nodeValue=se}catch(an){Xr(_,_.return,an)}}break;case 3:if(p(w,_),S(_),B&4&&k!==null&&k.memoizedState.isDehydrated)try{wu(w.containerInfo)}catch(an){Xr(_,_.return,an)}break;case 4:p(w,_),S(_);break;case 13:p(w,_),S(_),Z=_.child,Z.flags&8192&&(se=Z.memoizedState!==null,Z.stateNode.isHidden=se,!se||Z.alternate!==null&&Z.alternate.memoizedState!==null||(Ge=gn())),B&4&&c(_);break;case 22:if(ur=k!==null&&k.memoizedState!==null,_.mode&1?(Xn=(Et=Xn)||ur,p(w,_),Xn=Et):p(w,_),S(_),B&8192){if(Et=_.memoizedState!==null,(_.stateNode.isHidden=Et)&&!ur&&(_.mode&1)!==0)for(qr=_,ur=_.child;ur!==null;){for(pr=qr=ur;qr!==null;){switch(sr=qr,Wr=sr.child,sr.tag){case 0:case 11:case 14:case 15:Qu(4,sr,sr.return);break;case 1:vc(sr,sr.return);var tn=sr.stateNode;if(typeof tn.componentWillUnmount=="function"){B=sr,k=sr.return;try{w=B,tn.props=w.memoizedProps,tn.state=w.memoizedState,tn.componentWillUnmount()}catch(an){Xr(B,k,an)}}break;case 5:vc(sr,sr.return);break;case 22:if(sr.memoizedState!==null){z(pr);continue}}Wr!==null?(Wr.return=sr,qr=Wr):z(pr)}ur=ur.sibling}e:for(ur=null,pr=_;;){if(pr.tag===5){if(ur===null){ur=pr;try{Z=pr.stateNode,Et?(se=Z.style,typeof se.setProperty=="function"?se.setProperty("display","none","important"):se.display="none"):(He=pr.stateNode,Qe=pr.memoizedProps.style,we=Qe!=null&&Qe.hasOwnProperty("display")?Qe.display:null,He.style.display=Ta("display",we))}catch(an){Xr(_,_.return,an)}}}else if(pr.tag===6){if(ur===null)try{pr.stateNode.nodeValue=Et?"":pr.memoizedProps}catch(an){Xr(_,_.return,an)}}else if((pr.tag!==22&&pr.tag!==23||pr.memoizedState===null||pr===_)&&pr.child!==null){pr.child.return=pr,pr=pr.child;continue}if(pr===_)break e;for(;pr.sibling===null;){if(pr.return===null||pr.return===_)break e;ur===pr&&(ur=null),pr=pr.return}ur===pr&&(ur=null),pr.sibling.return=pr.return,pr=pr.sibling}}break;case 19:p(w,_),S(_),B&4&&c(_);break;case 21:break;default:p(w,_),S(_)}}function S(_){var w=_.flags;if(w&2){try{e:{for(var k=_.return;k!==null;){if(id(k)){var B=k;break e}k=k.return}throw Error(s(160))}switch(B.tag){case 5:var Z=B.stateNode;B.flags&32&&(Fo(Z,""),B.flags&=-33);var se=th(_);Da(_,se,Z);break;case 3:case 4:var we=B.stateNode.containerInfo,He=th(_);_l(_,He,we);break;default:throw Error(s(161))}}catch(Qe){Xr(_,_.return,Qe)}_.flags&=-3}w&4096&&(_.flags&=-4097)}function E(_,w,k){qr=_,M(_)}function M(_,w,k){for(var B=(_.mode&1)!==0;qr!==null;){var Z=qr,se=Z.child;if(Z.tag===22&&B){var we=Z.memoizedState!==null||Ju;if(!we){var He=Z.alternate,Qe=He!==null&&He.memoizedState!==null||Xn;He=Ju;var Et=Xn;if(Ju=we,(Xn=Qe)&&!Et)for(qr=Z;qr!==null;)we=qr,Qe=we.child,we.tag===22&&we.memoizedState!==null?j(Z):Qe!==null?(Qe.return=we,qr=Qe):j(Z);for(;se!==null;)qr=se,M(se),se=se.sibling;qr=Z,Ju=He,Xn=Et}R(_)}else(Z.subtreeFlags&8772)!==0&&se!==null?(se.return=Z,qr=se):R(_)}}function R(_){for(;qr!==null;){var w=qr;if((w.flags&8772)!==0){var k=w.alternate;try{if((w.flags&8772)!==0)switch(w.tag){case 0:case 11:case 15:Xn||Na(5,w);break;case 1:var B=w.stateNode;if(w.flags&4&&!Xn)if(k===null)B.componentDidMount();else{var Z=w.elementType===w.type?k.memoizedProps:Mo(w.type,k.memoizedProps);B.componentDidUpdate(Z,k.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var se=w.updateQueue;se!==null&&Rg(w,se,B);break;case 3:var we=w.updateQueue;if(we!==null){if(k=null,w.child!==null)switch(w.child.tag){case 5:k=w.child.stateNode;break;case 1:k=w.child.stateNode}Rg(w,we,k)}break;case 5:var He=w.stateNode;if(k===null&&w.flags&4){k=He;var Qe=w.memoizedProps;switch(w.type){case"button":case"input":case"select":case"textarea":Qe.autoFocus&&k.focus();break;case"img":Qe.src&&(k.src=Qe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(w.memoizedState===null){var Et=w.alternate;if(Et!==null){var ur=Et.memoizedState;if(ur!==null){var pr=ur.dehydrated;pr!==null&&wu(pr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Xn||w.flags&512&&eh(w)}catch(sr){Xr(w,w.return,sr)}}if(w===_){qr=null;break}if(k=w.sibling,k!==null){k.return=w.return,qr=k;break}qr=w.return}}function z(_){for(;qr!==null;){var w=qr;if(w===_){qr=null;break}var k=w.sibling;if(k!==null){k.return=w.return,qr=k;break}qr=w.return}}function j(_){for(;qr!==null;){var w=qr;try{switch(w.tag){case 0:case 11:case 15:var k=w.return;try{Na(4,w)}catch(Qe){Xr(w,k,Qe)}break;case 1:var B=w.stateNode;if(typeof B.componentDidMount=="function"){var Z=w.return;try{B.componentDidMount()}catch(Qe){Xr(w,Z,Qe)}}var se=w.return;try{eh(w)}catch(Qe){Xr(w,se,Qe)}break;case 5:var we=w.return;try{eh(w)}catch(Qe){Xr(w,we,Qe)}}}catch(Qe){Xr(w,w.return,Qe)}if(w===_){qr=null;break}var He=w.sibling;if(He!==null){He.return=w.return,qr=He;break}qr=w.return}}var G=Math.ceil,U=ht.ReactCurrentDispatcher,q=ht.ReactCurrentOwner,re=ht.ReactCurrentBatchConfig,Y=0,ne=null,oe=null,ce=0,ge=0,xe=Dl(0),Ce=0,Ae=null,Te=0,be=0,Ie=0,Re=null,Be=null,Ge=0,st=1/0,it=null,mt=!1,Ue=null,Je=null,Le=!1,lt=null,Ye=0,pt=0,It=null,ct=-1,wt=0;function Vt(){return(Y&6)!==0?gn():ct!==-1?ct:ct=gn()}function qt(_){return(_.mode&1)===0?1:(Y&2)!==0&&ce!==0?ce&-ce:Wy.transition!==null?(wt===0&&(wt=Wa()),wt):(_=fi,_!==0||(_=window.event,_=_===void 0?16:jc(_.type)),_)}function Bt(_,w,k,B){if(50<pt)throw pt=0,It=null,Error(s(185));Eo(_,k,B),((Y&2)===0||_!==ne)&&(_===ne&&((Y&2)===0&&(be|=k),Ce===4&&wn(_,ce)),Xt(_,B),k===1&&Y===0&&(w.mode&1)===0&&(st=gn()+500,Bh&&la()))}function Xt(_,w){var k=_.callbackNode;bd(_,w);var B=yu(_,_===ne?ce:0);if(B===0)k!==null&&nn(k),_.callbackNode=null,_.callbackPriority=0;else if(w=B&-B,_.callbackPriority!==w){if(k!=null&&nn(k),w===1)_.tag===0?kg(oi.bind(null,_)):vm(oi.bind(null,_)),Oh(function(){(Y&6)===0&&la()}),k=null;else{switch(_h(B)){case 1:k=Fn;break;case 4:k=Nn;break;case 16:k=ji;break;case 536870912:k=Ri;break;default:k=ji}k=Ro(k,cr.bind(null,_))}_.callbackPriority=w,_.callbackNode=k}}function cr(_,w){if(ct=-1,wt=0,(Y&6)!==0)throw Error(s(327));var k=_.callbackNode;if(Gn()&&_.callbackNode!==k)return null;var B=yu(_,_===ne?ce:0);if(B===0)return null;if((B&30)!==0||(B&_.expiredLanes)!==0||w)w=Ji(_,B);else{w=B;var Z=Y;Y|=2;var se=un();(ne!==_||ce!==w)&&(it=null,st=gn()+500,Vr(_,w));do try{Ln();break}catch(He){en(_,He)}while(!0);Qc(),U.current=se,Y=Z,oe!==null?w=0:(ne=null,ce=0,w=Ce)}if(w!==0){if(w===2&&(Z=yh(_),Z!==0&&(B=Z,w=gr(_,Z))),w===1)throw k=Ae,Vr(_,0),wn(_,B),Xt(_,gn()),k;if(w===6)wn(_,B);else{if(Z=_.current.alternate,(B&30)===0&&!Qr(Z)&&(w=Ji(_,B),w===2&&(se=yh(_),se!==0&&(B=se,w=gr(_,se))),w===1))throw k=Ae,Vr(_,0),wn(_,B),Xt(_,gn()),k;switch(_.finishedWork=Z,_.finishedLanes=B,w){case 0:case 1:throw Error(s(345));case 2:Bi(_,Be,it);break;case 3:if(wn(_,B),(B&130023424)===B&&(w=Ge+500-gn(),10<w)){if(yu(_,0)!==0)break;if(Z=_.suspendedLanes,(Z&B)!==B){Vt(),_.pingedLanes|=_.suspendedLanes&Z;break}_.timeoutHandle=Gf(Bi.bind(null,_,Be,it),w);break}Bi(_,Be,it);break;case 4:if(wn(_,B),(B&4194240)===B)break;for(w=_.eventTimes,Z=-1;0<B;){var we=31-Bo(B);se=1<<we,we=w[we],we>Z&&(Z=we),B&=~se}if(B=Z,B=gn()-B,B=(120>B?120:480>B?480:1080>B?1080:1920>B?1920:3e3>B?3e3:4320>B?4320:1960*G(B/1960))-B,10<B){_.timeoutHandle=Gf(Bi.bind(null,_,Be,it),B);break}Bi(_,Be,it);break;case 5:Bi(_,Be,it);break;default:throw Error(s(329))}}}return Xt(_,gn()),_.callbackNode===k?cr.bind(null,_):null}function gr(_,w){var k=Re;return _.current.memoizedState.isDehydrated&&(Vr(_,w).flags|=256),_=Ji(_,w),_!==2&&(w=Be,Be=k,w!==null&&Or(w)),_}function Or(_){Be===null?Be=_:Be.push.apply(Be,_)}function Qr(_){for(var w=_;;){if(w.flags&16384){var k=w.updateQueue;if(k!==null&&(k=k.stores,k!==null))for(var B=0;B<k.length;B++){var Z=k[B],se=Z.getSnapshot;Z=Z.value;try{if(!Ja(se(),Z))return!1}catch{return!1}}}if(k=w.child,w.subtreeFlags&16384&&k!==null)k.return=w,w=k;else{if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function wn(_,w){for(w&=~Ie,w&=~be,_.suspendedLanes|=w,_.pingedLanes&=~w,_=_.expirationTimes;0<w;){var k=31-Bo(w),B=1<<k;_[k]=-1,w&=~B}}function oi(_){if((Y&6)!==0)throw Error(s(327));Gn();var w=yu(_,0);if((w&1)===0)return Xt(_,gn()),null;var k=Ji(_,w);if(_.tag!==0&&k===2){var B=yh(_);B!==0&&(w=B,k=gr(_,B))}if(k===1)throw k=Ae,Vr(_,0),wn(_,w),Xt(_,gn()),k;if(k===6)throw Error(s(345));return _.finishedWork=_.current.alternate,_.finishedLanes=w,Bi(_,Be,it),Xt(_,gn()),null}function Vn(_,w){var k=Y;Y|=1;try{return _(w)}finally{Y=k,Y===0&&(st=gn()+500,Bh&&la())}}function Pn(_){lt!==null&&lt.tag===0&&(Y&6)===0&&Gn();var w=Y;Y|=1;var k=re.transition,B=fi;try{if(re.transition=null,fi=1,_)return _()}finally{fi=B,re.transition=k,Y=w,(Y&6)===0&&la()}}function $i(){ge=xe.current,ts(xe)}function Vr(_,w){_.finishedWork=null,_.finishedLanes=0;var k=_.timeoutHandle;if(k!==-1&&(_.timeoutHandle=-1,_m(k)),oe!==null)for(k=oe.return;k!==null;){var B=k;switch(Jf(B),B.tag){case 1:B=B.type.childContextTypes,B!=null&&zu();break;case 3:ua(),ts($o),ts(bs),pl();break;case 5:Wh(B);break;case 4:ua();break;case 13:ts(ns);break;case 19:ts(ns);break;case 10:Gh(B.type._context);break;case 22:case 23:$i()}k=k.return}if(ne=_,oe=_=Ko(_.current,null),ce=ge=w,Ce=0,Ae=null,Ie=be=Te=0,Be=Re=null,Go!==null){for(w=0;w<Go.length;w++)if(k=Go[w],B=k.interleaved,B!==null){k.interleaved=null;var Z=B.next,se=k.pending;if(se!==null){var we=se.next;se.next=Z,B.next=we}k.pending=B}Go=null}return _}function en(_,w){do{var k=oe;try{if(Qc(),Hn.current=yl,rp){for(var B=ds.memoizedState;B!==null;){var Z=B.queue;Z!==null&&(Z.pending=null),B=B.next}rp=!1}if(ha=0,Ks=js=ds=null,Vl=!1,ml=0,q.current=null,k===null||k.return===null){Ce=1,Ae=w,oe=null;break}e:{var se=_,we=k.return,He=k,Qe=w;if(w=ce,He.flags|=32768,Qe!==null&&typeof Qe=="object"&&typeof Qe.then=="function"){var Et=Qe,ur=He,pr=ur.tag;if((ur.mode&1)===0&&(pr===0||pr===11||pr===15)){var sr=ur.alternate;sr?(ur.updateQueue=sr.updateQueue,ur.memoizedState=sr.memoizedState,ur.lanes=sr.lanes):(ur.updateQueue=null,ur.memoizedState=null)}var Wr=fp(we);if(Wr!==null){Wr.flags&=-257,rf(Wr,we,He,se,w),Wr.mode&1&&Qh(se,Et,w),w=Wr,Qe=Et;var tn=w.updateQueue;if(tn===null){var an=new Set;an.add(Qe),w.updateQueue=an}else tn.add(Qe);break e}else{if((w&1)===0){Qh(se,Et,w),ai();break e}Qe=Error(s(426))}}else if(ls&&He.mode&1){var Vs=fp(we);if(Vs!==null){(Vs.flags&65536)===0&&(Vs.flags|=256),rf(Vs,we,He,se,w),ca(Gl(Qe,He));break e}}se=Qe=Gl(Qe,He),Ce!==4&&(Ce=2),Re===null?Re=[se]:Re.push(se),se=we;do{switch(se.tag){case 3:se.flags|=65536,w&=-w,se.lanes|=w;var yt=dp(se,Qe,w);ep(se,yt);break e;case 1:He=Qe;var ut=se.type,bt=se.stateNode;if((se.flags&128)===0&&(typeof ut.getDerivedStateFromError=="function"||bt!==null&&typeof bt.componentDidCatch=="function"&&(Je===null||!Je.has(bt)))){se.flags|=65536,w&=-w,se.lanes|=w;var wr=_c(se,He,w);ep(se,wr);break e}}se=se.return}while(se!==null)}bn(k)}catch(fn){w=fn,oe===k&&k!==null&&(oe=k=k.return);continue}break}while(!0)}function un(){var _=U.current;return U.current=yl,_===null?yl:_}function ai(){(Ce===0||Ce===3||Ce===2)&&(Ce=4),ne===null||(Te&268435455)===0&&(be&268435455)===0||wn(ne,ce)}function Ji(_,w){var k=Y;Y|=2;var B=un();(ne!==_||ce!==w)&&(it=null,Vr(_,w));do try{ui();break}catch(Z){en(_,Z)}while(!0);if(Qc(),Y=k,U.current=B,oe!==null)throw Error(s(261));return ne=null,ce=0,Ce}function ui(){for(;oe!==null;)Fi(oe)}function Ln(){for(;oe!==null&&!Hr();)Fi(oe)}function Fi(_){var w=Zo(_.alternate,_,ge);_.memoizedProps=_.pendingProps,w===null?bn(_):oe=w,q.current=null}function bn(_){var w=_;do{var k=w.alternate;if(_=w.return,(w.flags&32768)===0){if(k=cf(k,w,ge),k!==null){oe=k;return}}else{if(k=xc(k,w),k!==null){k.flags&=32767,oe=k;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{Ce=6,oe=null;return}}if(w=w.sibling,w!==null){oe=w;return}oe=w=_}while(w!==null);Ce===0&&(Ce=5)}function Bi(_,w,k){var B=fi,Z=re.transition;try{re.transition=null,fi=1,mi(_,w,k,B)}finally{re.transition=Z,fi=B}return null}function mi(_,w,k,B){do Gn();while(lt!==null);if((Y&6)!==0)throw Error(s(327));k=_.finishedWork;var Z=_.finishedLanes;if(k===null)return null;if(_.finishedWork=null,_.finishedLanes=0,k===_.current)throw Error(s(177));_.callbackNode=null,_.callbackPriority=0;var se=k.lanes|k.childLanes;if(ec(_,se),_===ne&&(oe=ne=null,ce=0),(k.subtreeFlags&2064)===0&&(k.flags&2064)===0||Le||(Le=!0,Ro(ji,function(){return Gn(),null})),se=(k.flags&15990)!==0,(k.subtreeFlags&15990)!==0||se){se=re.transition,re.transition=null;var we=fi;fi=1;var He=Y;Y|=4,q.current=null,nd(_,k),x(k,_),xo(Dh),Ed=!!Nh,Dh=Nh=null,_.current=k,E(k),ni(),Y=He,fi=we,re.transition=se}else _.current=k;if(Le&&(Le=!1,lt=_,Ye=Z),se=_.pendingLanes,se===0&&(Je=null),yo(k.stateNode),Xt(_,gn()),w!==null)for(B=_.onRecoverableError,k=0;k<w.length;k++)Z=w[k],B(Z.value,{componentStack:Z.stack,digest:Z.digest});if(mt)throw mt=!1,_=Ue,Ue=null,_;return(Ye&1)!==0&&_.tag!==0&&Gn(),se=_.pendingLanes,(se&1)!==0?_===It?pt++:(pt=0,It=_):pt=0,la(),null}function Gn(){if(lt!==null){var _=_h(Ye),w=re.transition,k=fi;try{if(re.transition=null,fi=16>_?16:_,lt===null)var B=!1;else{if(_=lt,lt=null,Ye=0,(Y&6)!==0)throw Error(s(331));var Z=Y;for(Y|=4,qr=_.current;qr!==null;){var se=qr,we=se.child;if((qr.flags&16)!==0){var He=se.deletions;if(He!==null){for(var Qe=0;Qe<He.length;Qe++){var Et=He[Qe];for(qr=Et;qr!==null;){var ur=qr;switch(ur.tag){case 0:case 11:case 15:Qu(8,ur,se)}var pr=ur.child;if(pr!==null)pr.return=ur,qr=pr;else for(;qr!==null;){ur=qr;var sr=ur.sibling,Wr=ur.return;if(xp(ur),ur===Et){qr=null;break}if(sr!==null){sr.return=Wr,qr=sr;break}qr=Wr}}}var tn=se.alternate;if(tn!==null){var an=tn.child;if(an!==null){tn.child=null;do{var Vs=an.sibling;an.sibling=null,an=Vs}while(an!==null)}}qr=se}}if((se.subtreeFlags&2064)!==0&&we!==null)we.return=se,qr=we;else e:for(;qr!==null;){if(se=qr,(se.flags&2048)!==0)switch(se.tag){case 0:case 11:case 15:Qu(9,se,se.return)}var yt=se.sibling;if(yt!==null){yt.return=se.return,qr=yt;break e}qr=se.return}}var ut=_.current;for(qr=ut;qr!==null;){we=qr;var bt=we.child;if((we.subtreeFlags&2064)!==0&&bt!==null)bt.return=we,qr=bt;else e:for(we=ut;qr!==null;){if(He=qr,(He.flags&2048)!==0)try{switch(He.tag){case 0:case 11:case 15:Na(9,He)}}catch(fn){Xr(He,He.return,fn)}if(He===we){qr=null;break e}var wr=He.sibling;if(wr!==null){wr.return=He.return,qr=wr;break e}qr=He.return}}if(Y=Z,la(),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(ms,_)}catch{}B=!0}return B}finally{fi=k,re.transition=w}}return!1}function hi(_,w,k){w=Gl(k,w),w=dp(_,w,1),_=tu(_,w,1),w=Vt(),_!==null&&(Eo(_,1,w),Xt(_,w))}function Xr(_,w,k){if(_.tag===3)hi(_,_,k);else for(;w!==null;){if(w.tag===3){hi(w,_,k);break}else if(w.tag===1){var B=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(Je===null||!Je.has(B))){_=Gl(k,_),_=_c(w,_,1),w=tu(w,_,1),_=Vt(),w!==null&&(Eo(w,1,_),Xt(w,_));break}}w=w.return}}function Gi(_,w,k){var B=_.pingCache;B!==null&&B.delete(w),w=Vt(),_.pingedLanes|=_.suspendedLanes&k,ne===_&&(ce&k)===k&&(Ce===4||Ce===3&&(ce&130023424)===ce&&500>gn()-Ge?Vr(_,0):Ie|=k),Xt(_,w)}function Bs(_,w){w===0&&((_.mode&1)===0?w=1:(w=Rc,Rc<<=1,(Rc&130023424)===0&&(Rc=4194304)));var k=Vt();_=jl(_,w),_!==null&&(Eo(_,w,k),Xt(_,k))}function wi(_){var w=_.memoizedState,k=0;w!==null&&(k=w.retryLane),Bs(_,k)}function Dn(_,w){var k=0;switch(_.tag){case 13:var B=_.stateNode,Z=_.memoizedState;Z!==null&&(k=Z.retryLane);break;case 19:B=_.stateNode;break;default:throw Error(s(314))}B!==null&&B.delete(w),Bs(_,k)}var Zo;Zo=function(_,w,k){if(_!==null)if(_.memoizedProps!==w.pendingProps||$o.current)ko=!0;else{if((_.lanes&k)===0&&(w.flags&128)===0)return ko=!1,jg(_,w,k);ko=(_.flags&131072)!==0}else ko=!1,ls&&(w.flags&1048576)!==0&&Yf(w,Kf,w.index);switch(w.lanes=0,w.tag){case 2:var B=w.type;Ku(_,w),_=w.pendingProps;var Z=uc(w,bs.current);eu(w,k),Z=Di(null,w,B,_,Z,k);var se=$e();return w.flags|=1,typeof Z=="object"&&Z!==null&&typeof Z.render=="function"&&Z.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,io(B)?(se=!0,ju(w)):se=!1,w.memoizedState=Z.state!==null&&Z.state!==void 0?Z.state:null,Fl(w),Z.updater=gc,w.stateNode=Z,Z._reactInternals=w,tf(w,B,_,k),w=mp(null,w,B,!0,se,k)):(w.tag=0,ls&&se&&Ud(w),Ys(null,w,Z,k),w=w.child),w;case 16:B=w.elementType;e:{switch(Ku(_,w),_=w.pendingProps,Z=B._init,B=Z(B._payload),w.type=B,Z=w.tag=Xo(B),_=Mo(B,_),Z){case 0:w=td(null,w,B,_,k);break e;case 1:w=Im(null,w,B,_,k);break e;case 11:w=Xu(null,w,B,_,k);break e;case 14:w=ed(null,w,B,Mo(B.type,_),k);break e}throw Error(s(306,B,""))}return w;case 0:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),td(_,w,B,Z,k);case 1:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Im(_,w,B,Z,k);case 3:e:{if(Mm(w),_===null)throw Error(s(387));B=w.pendingProps,se=w.memoizedState,Z=se.element,xr(_,w),Zd(w,B,null,k);var we=w.memoizedState;if(B=we.element,se.isDehydrated)if(se={element:B,isDehydrated:!1,cache:we.cache,pendingSuspenseBoundaries:we.pendingSuspenseBoundaries,transitions:we.transitions},w.updateQueue.baseState=se,w.memoizedState=se,w.flags&256){Z=Gl(Error(s(423)),w),w=km(_,w,B,k,Z);break e}else if(B!==Z){Z=Gl(Error(s(424)),w),w=km(_,w,B,k,Z);break e}else for(Xs=kl(w.stateNode.containerInfo.firstChild),Ls=w,ls=!0,so=null,k=zl(w,null,B,k),w.child=k;k;)k.flags=k.flags&-3|4096,k=k.sibling;else{if(Vu(),B===Z){w=si(_,w,k);break e}Ys(_,w,B,k)}w=w.child}return w;case 5:return ru(w),_===null&&Gd(w),B=w.type,Z=w.pendingProps,se=_!==null?_.memoizedProps:null,we=Z.children,Wc(B,Z)?we=null:se!==null&&Wc(B,se)&&(w.flags|=32),Am(_,w),Ys(_,w,we,k),w.child;case 6:return _===null&&Gd(w),null;case 13:return Pm(_,w,k);case 4:return ao(w,w.stateNode.containerInfo),B=w.pendingProps,_===null?w.child=hc(w,null,B,k):Ys(_,w,B,k),w.child;case 11:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Xu(_,w,B,Z,k);case 7:return Ys(_,w,w.pendingProps,k),w.child;case 8:return Ys(_,w,w.pendingProps.children,k),w.child;case 12:return Ys(_,w,w.pendingProps.children,k),w.child;case 10:e:{if(B=w.type._context,Z=w.pendingProps,se=w.memoizedProps,we=Z.value,rs(Kc,B._currentValue),B._currentValue=we,se!==null)if(Ja(se.value,we)){if(se.children===Z.children&&!$o.current){w=si(_,w,k);break e}}else for(se=w.child,se!==null&&(se.return=w);se!==null;){var He=se.dependencies;if(He!==null){we=se.child;for(var Qe=He.firstContext;Qe!==null;){if(Qe.context===B){if(se.tag===1){Qe=Ra(-1,k&-k),Qe.tag=2;var Et=se.updateQueue;if(Et!==null){Et=Et.shared;var ur=Et.pending;ur===null?Qe.next=Qe:(Qe.next=ur.next,ur.next=Qe),Et.pending=Qe}}se.lanes|=k,Qe=se.alternate,Qe!==null&&(Qe.lanes|=k),Wd(se.return,k,w),He.lanes|=k;break}Qe=Qe.next}}else if(se.tag===10)we=se.type===w.type?null:se.child;else if(se.tag===18){if(we=se.return,we===null)throw Error(s(341));we.lanes|=k,He=we.alternate,He!==null&&(He.lanes|=k),Wd(we,k,w),we=se.sibling}else we=se.child;if(we!==null)we.return=se;else for(we=se;we!==null;){if(we===w){we=null;break}if(se=we.sibling,se!==null){se.return=we.return,we=se;break}we=we.return}se=we}Ys(_,w,Z.children,k),w=w.child}return w;case 9:return Z=w.type,B=w.pendingProps.children,eu(w,k),Z=zs(Z),B=B(Z),w.flags|=1,Ys(_,w,B,k),w.child;case 14:return B=w.type,Z=Mo(B,w.pendingProps),Z=Mo(B.type,Z),ed(_,w,B,Z,k);case 15:return pp(_,w,w.type,w.pendingProps,k);case 17:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Ku(_,w),w.tag=1,io(B)?(_=!0,ju(w)):_=!1,eu(w,k),hp(w,B,Z),tf(w,B,Z,k),mp(null,w,B,!0,_,k);case 19:return zg(_,w,k);case 22:return nf(_,w,k)}throw Error(s(156,w.tag))};function Ro(_,w){return Ur(_,w)}function Oa(_,w,k,B){this.tag=_,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ws(_,w,k,B){return new Oa(_,w,k,B)}function da(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Xo(_){if(typeof _=="function")return da(_)?1:0;if(_!=null){if(_=_.$$typeof,_===Sr)return 11;if(_===br)return 14}return 2}function Ko(_,w){var k=_.alternate;return k===null?(k=ws(_.tag,w,_.key,_.mode),k.elementType=_.elementType,k.type=_.type,k.stateNode=_.stateNode,k.alternate=_,_.alternate=k):(k.pendingProps=w,k.type=_.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=_.flags&14680064,k.childLanes=_.childLanes,k.lanes=_.lanes,k.child=_.child,k.memoizedProps=_.memoizedProps,k.memoizedState=_.memoizedState,k.updateQueue=_.updateQueue,w=_.dependencies,k.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},k.sibling=_.sibling,k.index=_.index,k.ref=_.ref,k}function fa(_,w,k,B,Z,se){var we=2;if(B=_,typeof _=="function")da(_)&&(we=1);else if(typeof _=="string")we=5;else e:switch(_){case kt:return pa(k.children,Z,se,w);case Rt:we=8,Z|=8;break;case hr:return _=ws(12,k,w,Z|2),_.elementType=hr,_.lanes=se,_;case Br:return _=ws(13,k,w,Z),_.elementType=Br,_.lanes=se,_;case Ft:return _=ws(19,k,w,Z),_.elementType=Ft,_.lanes=se,_;case Er:return su(k,Z,se,w);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case Tr:we=10;break e;case _r:we=9;break e;case Sr:we=11;break e;case br:we=14;break e;case Yt:we=16,B=null;break e}throw Error(s(130,_==null?_:typeof _,""))}return w=ws(we,k,w,Z),w.elementType=_,w.type=B,w.lanes=se,w}function pa(_,w,k,B){return _=ws(7,_,B,w),_.lanes=k,_}function su(_,w,k,B){return _=ws(22,_,B,w),_.elementType=Er,_.lanes=k,_.stateNode={isHidden:!1},_}function uf(_,w,k){return _=ws(6,_,null,w),_.lanes=k,_}function ou(_,w,k){return w=ws(4,_.children!==null?_.children:[],_.key,w),w.lanes=k,w.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},w}function Om(_,w,k,B,Z){this.tag=w,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vo(0),this.expirationTimes=Vo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vo(0),this.identifierPrefix=B,this.onRecoverableError=Z,this.mutableSourceEagerHydrationData=null}function rh(_,w,k,B,Z,se,we,He,Qe){return _=new Om(_,w,k,He,Qe),w===1?(w=1,se===!0&&(w|=8)):w=0,se=ws(3,null,null,w),_.current=se,se.stateNode=_,se.memoizedState={element:B,isDehydrated:k,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fl(se),_}function vp(_,w,k){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dt,key:B==null?null:""+B,children:_,containerInfo:w,implementation:k}}function hf(_){if(!_)return oa;_=_._reactInternals;e:{if(Ze(_)!==_||_.tag!==1)throw Error(s(170));var w=_;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(io(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(s(171))}if(_.tag===1){var k=_.type;if(io(k))return Zf(_,k,w)}return w}function xl(_,w,k,B,Z,se,we,He,Qe){return _=rh(k,B,!0,_,Z,se,we,He,Qe),_.context=hf(null),k=_.current,B=Vt(),Z=qt(k),se=Ra(B,Z),se.callback=w??null,tu(k,se,Z),_.current.lanes=Z,Eo(_,Z,B),Xt(_,B),_}function bc(_,w,k,B){var Z=w.current,se=Vt(),we=qt(Z);return k=hf(k),w.context===null?w.context=k:w.pendingContext=k,w=Ra(se,we),w.payload={element:_},B=B===void 0?null:B,B!==null&&(w.callback=B),_=tu(Z,w,we),_!==null&&(Bt(_,Z,we,se),Qf(_,Z,we)),we}function Wl(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return _.child.stateNode;default:return _.child.stateNode}}function wc(_,w){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var k=_.retryLane;_.retryLane=k!==0&&k<w?k:w}}function Lm(_,w){wc(_,w),(_=_.alternate)&&wc(_,w)}function bp(){return null}var zm=typeof reportError=="function"?reportError:function(_){console.error(_)};function Bg(_){this._internalRoot=_}jm.prototype.render=Bg.prototype.render=function(_){var w=this._internalRoot;if(w===null)throw Error(s(409));bc(_,w,null,null)},jm.prototype.unmount=Bg.prototype.unmount=function(){var _=this._internalRoot;if(_!==null){this._internalRoot=null;var w=_.containerInfo;Pn(function(){bc(null,_,null,null)}),w[Rl]=null}};function jm(_){this._internalRoot=_}jm.prototype.unstable_scheduleHydration=function(_){if(_){var w=vu();_={blockedOn:null,target:_,priority:w};for(var k=0;k<Xa.length&&w!==0&&w<Xa[k].priority;k++);Xa.splice(k,0,_),k===0&&Eg(_)}};function Vg(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)}function Fm(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11&&(_.nodeType!==8||_.nodeValue!==" react-mount-point-unstable "))}function Zy(){}function df(_,w,k,B,Z){if(Z){if(typeof B=="function"){var se=B;B=function(){var Et=Wl(we);se.call(Et)}}var we=xl(w,B,_,0,null,!1,!1,"",Zy);return _._reactRootContainer=we,_[Rl]=we.current,jd(_.nodeType===8?_.parentNode:_),Pn(),we}for(;Z=_.lastChild;)_.removeChild(Z);if(typeof B=="function"){var He=B;B=function(){var Et=Wl(Qe);He.call(Et)}}var Qe=rh(_,0,!1,null,null,!1,!1,"",Zy);return _._reactRootContainer=Qe,_[Rl]=Qe.current,jd(_.nodeType===8?_.parentNode:_),Pn(function(){bc(w,Qe,k,B)}),Qe}function Bm(_,w,k,B,Z){var se=k._reactRootContainer;if(se){var we=se;if(typeof Z=="function"){var He=Z;Z=function(){var Qe=Wl(we);He.call(Qe)}}bc(w,we,_,Z)}else we=df(k,w,_,Z,B);return Wl(we)}ll=function(_){switch(_.tag){case 3:var w=_.stateNode;if(w.current.memoizedState.isDehydrated){var k=Nc(w.pendingLanes);k!==0&&(Aa(w,k|1),Xt(w,gn()),(Y&6)===0&&(st=gn()+500,la()))}break;case 13:Pn(function(){var B=jl(_,1);if(B!==null){var Z=Vt();Bt(B,_,1,Z)}}),Lm(_,1)}},xu=function(_){if(_.tag===13){var w=jl(_,134217728);if(w!==null){var k=Vt();Bt(w,_,134217728,k)}Lm(_,134217728)}},Dc=function(_){if(_.tag===13){var w=qt(_),k=jl(_,w);if(k!==null){var B=Vt();Bt(k,_,w,B)}Lm(_,w)}},vu=function(){return fi},Pf=function(_,w){var k=fi;try{return fi=_,w()}finally{fi=k}},di=function(_,w,k){switch(w){case"input":if(mo(_,k),w=k.name,k.type==="radio"&&w!=null){for(k=_;k.parentNode;)k=k.parentNode;for(k=k.querySelectorAll("input[name="+JSON.stringify(""+w)+'][type="radio"]'),w=0;w<k.length;w++){var B=k[w];if(B!==_&&B.form===_.form){var Z=Lu(B);if(!Z)throw Error(s(90));ri(B),mo(B,Z)}}}break;case"textarea":Cs(_,k);break;case"select":w=k.value,w!=null&&to(_,!!k.multiple,w,!1)}},qa=Vn,gh=Pn;var No={usingClientEntryPoint:!1,Events:[Vd,Zc,Lu,Ga,Ot,Vn]},au={findFiberByHostInstance:Ou,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$1={bundleType:au.bundleType,version:au.version,rendererPackageName:au.rendererPackageName,rendererConfig:au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ht.ReactCurrentDispatcher,findHostInstanceByFiber:function(_){return _=Wt(_),_===null?null:_.stateNode},findFiberByHostInstance:au.findFiberByHostInstance||bp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ug=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ug.isDisabled&&Ug.supportsFiber)try{ms=Ug.inject($1),us=Ug}catch{}}return Xl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=No,Xl.createPortal=function(_,w){var k=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vg(w))throw Error(s(200));return vp(_,w,null,k)},Xl.createRoot=function(_,w){if(!Vg(_))throw Error(s(299));var k=!1,B="",Z=zm;return w!=null&&(w.unstable_strictMode===!0&&(k=!0),w.identifierPrefix!==void 0&&(B=w.identifierPrefix),w.onRecoverableError!==void 0&&(Z=w.onRecoverableError)),w=rh(_,1,!1,null,null,k,!1,B,Z),_[Rl]=w.current,jd(_.nodeType===8?_.parentNode:_),new Bg(w)},Xl.findDOMNode=function(_){if(_==null)return null;if(_.nodeType===1)return _;var w=_._reactInternals;if(w===void 0)throw typeof _.render=="function"?Error(s(188)):(_=Object.keys(_).join(","),Error(s(268,_)));return _=Wt(w),_=_===null?null:_.stateNode,_},Xl.flushSync=function(_){return Pn(_)},Xl.hydrate=function(_,w,k){if(!Fm(w))throw Error(s(200));return Bm(null,_,w,!0,k)},Xl.hydrateRoot=function(_,w,k){if(!Vg(_))throw Error(s(405));var B=k!=null&&k.hydratedSources||null,Z=!1,se="",we=zm;if(k!=null&&(k.unstable_strictMode===!0&&(Z=!0),k.identifierPrefix!==void 0&&(se=k.identifierPrefix),k.onRecoverableError!==void 0&&(we=k.onRecoverableError)),w=xl(w,null,_,1,k??null,Z,!1,se,we),_[Rl]=w.current,jd(_),B)for(_=0;_<B.length;_++)k=B[_],Z=k._getVersion,Z=Z(k._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[k,Z]:w.mutableSourceEagerHydrationData.push(k,Z);return new jm(w)},Xl.render=function(_,w,k){if(!Fm(w))throw Error(s(200));return Bm(null,_,w,!1,k)},Xl.unmountComponentAtNode=function(_){if(!Fm(_))throw Error(s(40));return _._reactRootContainer?(Pn(function(){Bm(null,null,_,!1,function(){_._reactRootContainer=null,_[Rl]=null})}),!0):!1},Xl.unstable_batchedUpdates=Vn,Xl.unstable_renderSubtreeIntoContainer=function(_,w,k,B){if(!Fm(k))throw Error(s(200));if(_==null||_._reactInternals===void 0)throw Error(s(38));return Bm(_,w,k,!1,B)},Xl.version="18.3.1-next-f1338f8080-20240426",Xl}var uI;function Dk(){if(uI)return nw.exports;uI=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),nw.exports=aF(),nw.exports}var hI;function lF(){if(hI)return pv;hI=1;var r=Dk();return pv.createRoot=r.createRoot,pv.hydrateRoot=r.hydrateRoot,pv}var cF=lF(),ee=fx();const Mr=c1(ee),Ok=tF({__proto__:null,default:Mr},[ee]),uF=1,hF=1e6;let ow=0;function dF(){return ow=(ow+1)%Number.MAX_SAFE_INTEGER,ow.toString()}const aw=new Map,dI=r=>{if(aw.has(r))return;const t=setTimeout(()=>{aw.delete(r),B_({type:"REMOVE_TOAST",toastId:r})},hF);aw.set(r,t)},fF=(r,t)=>{switch(t.type){case"ADD_TOAST":return{...r,toasts:[t.toast,...r.toasts].slice(0,uF)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?dI(s):r.toasts.forEach(l=>{dI(l.id)}),{...r,toasts:r.toasts.map(l=>l.id===s||s===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(s=>s.id!==t.toastId)}}},Lv=[];let zv={toasts:[]};function B_(r){zv=fF(zv,r),Lv.forEach(t=>{t(zv)})}function vn({...r}){const t=dF(),s=h=>B_({type:"UPDATE_TOAST",toast:{...h,id:t}}),l=()=>B_({type:"DISMISS_TOAST",toastId:t});return B_({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:h=>{h||l()}}}),{id:t,dismiss:l,update:s}}function ky(){const[r,t]=ee.useState(zv);return ee.useEffect(()=>(Lv.push(t),()=>{const s=Lv.indexOf(t);s>-1&&Lv.splice(s,1)}),[r]),{...r,toast:vn,dismiss:s=>B_({type:"DISMISS_TOAST",toastId:s})}}var Py=Dk();const sT=c1(Py);function jn(r,t,{checkForDefaultPrevented:s=!0}={}){return function(h){if(r?.(h),s===!1||!h.defaultPrevented)return t?.(h)}}function pF(r,t){typeof r=="function"?r(t):r!=null&&(r.current=t)}function Lk(...r){return t=>r.forEach(s=>pF(s,t))}function xs(...r){return ee.useCallback(Lk(...r),r)}function mF(r,t=[]){let s=[];function l(m,v){const i=ee.createContext(v),A=s.length;s=[...s,v];function P(F){const{scope:$,children:K,...J}=F,W=$?.[r][A]||i,ie=ee.useMemo(()=>J,Object.values(J));return b.jsx(W.Provider,{value:ie,children:K})}function D(F,$){const K=$?.[r][A]||i,J=ee.useContext(K);if(J)return J;if(v!==void 0)return v;throw new Error(`\`${F}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(v=>ee.createContext(v));return function(i){const A=i?.[r]||m;return ee.useMemo(()=>({[`__scope${r}`]:{...i,[r]:A}}),[i,A])}};return h.scopeName=r,[l,gF(h,...t)]}function gF(...r){const t=r[0];if(r.length===1)return t;const s=()=>{const l=r.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const v=l.reduce((i,{useScope:A,scopeName:P})=>{const F=A(m)[`__scope${P}`];return{...i,...F}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return s.scopeName=t.scopeName,s}var ug=ee.forwardRef((r,t)=>{const{children:s,...l}=r,h=ee.Children.toArray(s),m=h.find(yF);if(m){const v=m.props.children,i=h.map(A=>A===m?ee.Children.count(v)>1?ee.Children.only(null):ee.isValidElement(v)?v.props.children:null:A);return b.jsx(Qw,{...l,ref:t,children:ee.isValidElement(v)?ee.cloneElement(v,void 0,i):null})}return b.jsx(Qw,{...l,ref:t,children:s})});ug.displayName="Slot";var Qw=ee.forwardRef((r,t)=>{const{children:s,...l}=r;if(ee.isValidElement(s)){const h=xF(s);return ee.cloneElement(s,{..._F(l,s.props),ref:t?Lk(t,h):h})}return ee.Children.count(s)>1?ee.Children.only(null):null});Qw.displayName="SlotClone";var zk=({children:r})=>b.jsx(b.Fragment,{children:r});function yF(r){return ee.isValidElement(r)&&r.type===zk}function _F(r,t){const s={...t};for(const l in t){const h=r[l],m=t[l];/^on[A-Z]/.test(l)?h&&m?s[l]=(...i)=>{m(...i),h(...i)}:h&&(s[l]=h):l==="style"?s[l]={...h,...m}:l==="className"&&(s[l]=[h,m].filter(Boolean).join(" "))}return{...r,...s}}function xF(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?r.props.ref:r.props.ref||r.ref)}function oT(r){const t=r+"CollectionProvider",[s,l]=mF(t),[h,m]=s(t,{collectionRef:{current:null},itemMap:new Map}),v=K=>{const{scope:J,children:W}=K,ie=Mr.useRef(null),fe=Mr.useRef(new Map).current;return b.jsx(h,{scope:J,itemMap:fe,collectionRef:ie,children:W})};v.displayName=t;const i=r+"CollectionSlot",A=Mr.forwardRef((K,J)=>{const{scope:W,children:ie}=K,fe=m(i,W),Pe=xs(J,fe.collectionRef);return b.jsx(ug,{ref:Pe,children:ie})});A.displayName=i;const P=r+"CollectionItemSlot",D="data-radix-collection-item",F=Mr.forwardRef((K,J)=>{const{scope:W,children:ie,...fe}=K,Pe=Mr.useRef(null),Fe=xs(J,Pe),ht=m(P,W);return Mr.useEffect(()=>(ht.itemMap.set(Pe,{ref:Pe,...fe}),()=>void ht.itemMap.delete(Pe))),b.jsx(ug,{[D]:"",ref:Fe,children:ie})});F.displayName=P;function $(K){const J=m(r+"CollectionConsumer",K);return Mr.useCallback(()=>{const ie=J.collectionRef.current;if(!ie)return[];const fe=Array.from(ie.querySelectorAll(`[${D}]`));return Array.from(J.itemMap.values()).sort((ht,at)=>fe.indexOf(ht.ref.current)-fe.indexOf(at.ref.current))},[J.collectionRef,J.itemMap])}return[{Provider:v,Slot:A,ItemSlot:F},$,l]}function vF(r,t){const s=ee.createContext(t),l=m=>{const{children:v,...i}=m,A=ee.useMemo(()=>i,Object.values(i));return b.jsx(s.Provider,{value:A,children:v})};l.displayName=r+"Provider";function h(m){const v=ee.useContext(s);if(v)return v;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${r}\``)}return[l,h]}function Ry(r,t=[]){let s=[];function l(m,v){const i=ee.createContext(v),A=s.length;s=[...s,v];const P=F=>{const{scope:$,children:K,...J}=F,W=$?.[r]?.[A]||i,ie=ee.useMemo(()=>J,Object.values(J));return b.jsx(W.Provider,{value:ie,children:K})};P.displayName=m+"Provider";function D(F,$){const K=$?.[r]?.[A]||i,J=ee.useContext(K);if(J)return J;if(v!==void 0)return v;throw new Error(`\`${F}\` must be used within \`${m}\``)}return[P,D]}const h=()=>{const m=s.map(v=>ee.createContext(v));return function(i){const A=i?.[r]||m;return ee.useMemo(()=>({[`__scope${r}`]:{...i,[r]:A}}),[i,A])}};return h.scopeName=r,[l,bF(h,...t)]}function bF(...r){const t=r[0];if(r.length===1)return t;const s=()=>{const l=r.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const v=l.reduce((i,{useScope:A,scopeName:P})=>{const F=A(m)[`__scope${P}`];return{...i,...F}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return s.scopeName=t.scopeName,s}var wF=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],vi=wF.reduce((r,t)=>{const s=ee.forwardRef((l,h)=>{const{asChild:m,...v}=l,i=m?ug:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),b.jsx(i,{...v,ref:h})});return s.displayName=`Primitive.${t}`,{...r,[t]:s}},{});function jk(r,t){r&&Py.flushSync(()=>r.dispatchEvent(t))}function Jl(r){const t=ee.useRef(r);return ee.useEffect(()=>{t.current=r}),ee.useMemo(()=>(...s)=>t.current?.(...s),[])}function SF(r,t=globalThis?.document){const s=Jl(r);ee.useEffect(()=>{const l=h=>{h.key==="Escape"&&s(h)};return t.addEventListener("keydown",l,{capture:!0}),()=>t.removeEventListener("keydown",l,{capture:!0})},[s,t])}var TF="DismissableLayer",eS="dismissableLayer.update",EF="dismissableLayer.pointerDownOutside",CF="dismissableLayer.focusOutside",fI,Fk=ee.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),px=ee.forwardRef((r,t)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:m,onInteractOutside:v,onDismiss:i,...A}=r,P=ee.useContext(Fk),[D,F]=ee.useState(null),$=D?.ownerDocument??globalThis?.document,[,K]=ee.useState({}),J=xs(t,kt=>F(kt)),W=Array.from(P.layers),[ie]=[...P.layersWithOutsidePointerEventsDisabled].slice(-1),fe=W.indexOf(ie),Pe=D?W.indexOf(D):-1,Fe=P.layersWithOutsidePointerEventsDisabled.size>0,ht=Pe>=fe,at=IF(kt=>{const Rt=kt.target,hr=[...P.branches].some(Tr=>Tr.contains(Rt));!ht||hr||(h?.(kt),v?.(kt),kt.defaultPrevented||i?.())},$),Dt=MF(kt=>{const Rt=kt.target;[...P.branches].some(Tr=>Tr.contains(Rt))||(m?.(kt),v?.(kt),kt.defaultPrevented||i?.())},$);return SF(kt=>{Pe===P.layers.size-1&&(l?.(kt),!kt.defaultPrevented&&i&&(kt.preventDefault(),i()))},$),ee.useEffect(()=>{if(D)return s&&(P.layersWithOutsidePointerEventsDisabled.size===0&&(fI=$.body.style.pointerEvents,$.body.style.pointerEvents="none"),P.layersWithOutsidePointerEventsDisabled.add(D)),P.layers.add(D),pI(),()=>{s&&P.layersWithOutsidePointerEventsDisabled.size===1&&($.body.style.pointerEvents=fI)}},[D,$,s,P]),ee.useEffect(()=>()=>{D&&(P.layers.delete(D),P.layersWithOutsidePointerEventsDisabled.delete(D),pI())},[D,P]),ee.useEffect(()=>{const kt=()=>K({});return document.addEventListener(eS,kt),()=>document.removeEventListener(eS,kt)},[]),b.jsx(vi.div,{...A,ref:J,style:{pointerEvents:Fe?ht?"auto":"none":void 0,...r.style},onFocusCapture:jn(r.onFocusCapture,Dt.onFocusCapture),onBlurCapture:jn(r.onBlurCapture,Dt.onBlurCapture),onPointerDownCapture:jn(r.onPointerDownCapture,at.onPointerDownCapture)})});px.displayName=TF;var AF="DismissableLayerBranch",Bk=ee.forwardRef((r,t)=>{const s=ee.useContext(Fk),l=ee.useRef(null),h=xs(t,l);return ee.useEffect(()=>{const m=l.current;if(m)return s.branches.add(m),()=>{s.branches.delete(m)}},[s.branches]),b.jsx(vi.div,{...r,ref:h})});Bk.displayName=AF;function IF(r,t=globalThis?.document){const s=Jl(r),l=ee.useRef(!1),h=ee.useRef(()=>{});return ee.useEffect(()=>{const m=i=>{if(i.target&&!l.current){let A=function(){Vk(EF,s,P,{discrete:!0})};const P={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",h.current),h.current=A,t.addEventListener("click",h.current,{once:!0})):A()}else t.removeEventListener("click",h.current);l.current=!1},v=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(v),t.removeEventListener("pointerdown",m),t.removeEventListener("click",h.current)}},[t,s]),{onPointerDownCapture:()=>l.current=!0}}function MF(r,t=globalThis?.document){const s=Jl(r),l=ee.useRef(!1);return ee.useEffect(()=>{const h=m=>{m.target&&!l.current&&Vk(CF,s,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",h),()=>t.removeEventListener("focusin",h)},[t,s]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function pI(){const r=new CustomEvent(eS);document.dispatchEvent(r)}function Vk(r,t,s,{discrete:l}){const h=s.originalEvent.target,m=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:s});t&&h.addEventListener(r,t,{once:!0}),l?jk(h,m):h.dispatchEvent(m)}var kF=px,PF=Bk,sl=globalThis?.document?ee.useLayoutEffect:()=>{},RF="Portal",u1=ee.forwardRef((r,t)=>{const{container:s,...l}=r,[h,m]=ee.useState(!1);sl(()=>m(!0),[]);const v=s||h&&globalThis?.document?.body;return v?sT.createPortal(b.jsx(vi.div,{...l,ref:t}),v):null});u1.displayName=RF;function NF(r,t){return ee.useReducer((s,l)=>t[s][l]??s,r)}var wg=r=>{const{present:t,children:s}=r,l=DF(t),h=typeof s=="function"?s({present:l.isPresent}):ee.Children.only(s),m=xs(l.ref,OF(h));return typeof s=="function"||l.isPresent?ee.cloneElement(h,{ref:m}):null};wg.displayName="Presence";function DF(r){const[t,s]=ee.useState(),l=ee.useRef({}),h=ee.useRef(r),m=ee.useRef("none"),v=r?"mounted":"unmounted",[i,A]=NF(v,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ee.useEffect(()=>{const P=mv(l.current);m.current=i==="mounted"?P:"none"},[i]),sl(()=>{const P=l.current,D=h.current;if(D!==r){const $=m.current,K=mv(P);r?A("MOUNT"):K==="none"||P?.display==="none"?A("UNMOUNT"):A(D&&$!==K?"ANIMATION_OUT":"UNMOUNT"),h.current=r}},[r,A]),sl(()=>{if(t){let P;const D=t.ownerDocument.defaultView??window,F=K=>{const W=mv(l.current).includes(K.animationName);if(K.target===t&&W&&(A("ANIMATION_END"),!h.current)){const ie=t.style.animationFillMode;t.style.animationFillMode="forwards",P=D.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=ie)})}},$=K=>{K.target===t&&(m.current=mv(l.current))};return t.addEventListener("animationstart",$),t.addEventListener("animationcancel",F),t.addEventListener("animationend",F),()=>{D.clearTimeout(P),t.removeEventListener("animationstart",$),t.removeEventListener("animationcancel",F),t.removeEventListener("animationend",F)}}else A("ANIMATION_END")},[t,A]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:ee.useCallback(P=>{P&&(l.current=getComputedStyle(P)),s(P)},[])}}function mv(r){return r?.animationName||"none"}function OF(r){let t=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?r.ref:(t=Object.getOwnPropertyDescriptor(r,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?r.props.ref:r.props.ref||r.ref)}function hg({prop:r,defaultProp:t,onChange:s=()=>{}}){const[l,h]=LF({defaultProp:t,onChange:s}),m=r!==void 0,v=m?r:l,i=Jl(s),A=ee.useCallback(P=>{if(m){const F=typeof P=="function"?P(r):P;F!==r&&i(F)}else h(P)},[m,r,h,i]);return[v,A]}function LF({defaultProp:r,onChange:t}){const s=ee.useState(r),[l]=s,h=ee.useRef(l),m=Jl(t);return ee.useEffect(()=>{h.current!==l&&(m(l),h.current=l)},[l,h,m]),s}var zF="VisuallyHidden",mx=ee.forwardRef((r,t)=>b.jsx(vi.span,{...r,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...r.style}}));mx.displayName=zF;var jF=mx,aT="ToastProvider",[lT,FF,BF]=oT("Toast"),[Uk,cX]=Ry("Toast",[BF]),[VF,h1]=Uk(aT),$k=r=>{const{__scopeToast:t,label:s="Notification",duration:l=5e3,swipeDirection:h="right",swipeThreshold:m=50,children:v}=r,[i,A]=ee.useState(null),[P,D]=ee.useState(0),F=ee.useRef(!1),$=ee.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${aT}\`. Expected non-empty \`string\`.`),b.jsx(lT.Provider,{scope:t,children:b.jsx(VF,{scope:t,label:s,duration:l,swipeDirection:h,swipeThreshold:m,toastCount:P,viewport:i,onViewportChange:A,onToastAdd:ee.useCallback(()=>D(K=>K+1),[]),onToastRemove:ee.useCallback(()=>D(K=>K-1),[]),isFocusedToastEscapeKeyDownRef:F,isClosePausedRef:$,children:v})})};$k.displayName=aT;var Hk="ToastViewport",UF=["F8"],tS="toast.viewportPause",rS="toast.viewportResume",Gk=ee.forwardRef((r,t)=>{const{__scopeToast:s,hotkey:l=UF,label:h="Notifications ({hotkey})",...m}=r,v=h1(Hk,s),i=FF(s),A=ee.useRef(null),P=ee.useRef(null),D=ee.useRef(null),F=ee.useRef(null),$=xs(t,F,v.onViewportChange),K=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),J=v.toastCount>0;ee.useEffect(()=>{const ie=fe=>{l.length!==0&&l.every(Fe=>fe[Fe]||fe.code===Fe)&&F.current?.focus()};return document.addEventListener("keydown",ie),()=>document.removeEventListener("keydown",ie)},[l]),ee.useEffect(()=>{const ie=A.current,fe=F.current;if(J&&ie&&fe){const Pe=()=>{if(!v.isClosePausedRef.current){const Dt=new CustomEvent(tS);fe.dispatchEvent(Dt),v.isClosePausedRef.current=!0}},Fe=()=>{if(v.isClosePausedRef.current){const Dt=new CustomEvent(rS);fe.dispatchEvent(Dt),v.isClosePausedRef.current=!1}},ht=Dt=>{!ie.contains(Dt.relatedTarget)&&Fe()},at=()=>{ie.contains(document.activeElement)||Fe()};return ie.addEventListener("focusin",Pe),ie.addEventListener("focusout",ht),ie.addEventListener("pointermove",Pe),ie.addEventListener("pointerleave",at),window.addEventListener("blur",Pe),window.addEventListener("focus",Fe),()=>{ie.removeEventListener("focusin",Pe),ie.removeEventListener("focusout",ht),ie.removeEventListener("pointermove",Pe),ie.removeEventListener("pointerleave",at),window.removeEventListener("blur",Pe),window.removeEventListener("focus",Fe)}}},[J,v.isClosePausedRef]);const W=ee.useCallback(({tabbingDirection:ie})=>{const Pe=i().map(Fe=>{const ht=Fe.ref.current,at=[ht,...tB(ht)];return ie==="forwards"?at:at.reverse()});return(ie==="forwards"?Pe.reverse():Pe).flat()},[i]);return ee.useEffect(()=>{const ie=F.current;if(ie){const fe=Pe=>{const Fe=Pe.altKey||Pe.ctrlKey||Pe.metaKey;if(Pe.key==="Tab"&&!Fe){const at=document.activeElement,Dt=Pe.shiftKey;if(Pe.target===ie&&Dt){P.current?.focus();return}const hr=W({tabbingDirection:Dt?"backwards":"forwards"}),Tr=hr.findIndex(_r=>_r===at);lw(hr.slice(Tr+1))?Pe.preventDefault():Dt?P.current?.focus():D.current?.focus()}};return ie.addEventListener("keydown",fe),()=>ie.removeEventListener("keydown",fe)}},[i,W]),b.jsxs(PF,{ref:A,role:"region","aria-label":h.replace("{hotkey}",K),tabIndex:-1,style:{pointerEvents:J?void 0:"none"},children:[J&&b.jsx(nS,{ref:P,onFocusFromOutsideViewport:()=>{const ie=W({tabbingDirection:"forwards"});lw(ie)}}),b.jsx(lT.Slot,{scope:s,children:b.jsx(vi.ol,{tabIndex:-1,...m,ref:$})}),J&&b.jsx(nS,{ref:D,onFocusFromOutsideViewport:()=>{const ie=W({tabbingDirection:"backwards"});lw(ie)}})]})});Gk.displayName=Hk;var qk="ToastFocusProxy",nS=ee.forwardRef((r,t)=>{const{__scopeToast:s,onFocusFromOutsideViewport:l,...h}=r,m=h1(qk,s);return b.jsx(mx,{"aria-hidden":!0,tabIndex:0,...h,ref:t,style:{position:"fixed"},onFocus:v=>{const i=v.relatedTarget;!m.viewport?.contains(i)&&l()}})});nS.displayName=qk;var d1="Toast",$F="toast.swipeStart",HF="toast.swipeMove",GF="toast.swipeCancel",qF="toast.swipeEnd",Wk=ee.forwardRef((r,t)=>{const{forceMount:s,open:l,defaultOpen:h,onOpenChange:m,...v}=r,[i=!0,A]=hg({prop:l,defaultProp:h,onChange:m});return b.jsx(wg,{present:s||i,children:b.jsx(XF,{open:i,...v,ref:t,onClose:()=>A(!1),onPause:Jl(r.onPause),onResume:Jl(r.onResume),onSwipeStart:jn(r.onSwipeStart,P=>{P.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:jn(r.onSwipeMove,P=>{const{x:D,y:F}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","move"),P.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${D}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${F}px`)}),onSwipeCancel:jn(r.onSwipeCancel,P=>{P.currentTarget.setAttribute("data-swipe","cancel"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:jn(r.onSwipeEnd,P=>{const{x:D,y:F}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","end"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${D}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${F}px`),A(!1)})})})});Wk.displayName=d1;var[WF,ZF]=Uk(d1,{onClose(){}}),XF=ee.forwardRef((r,t)=>{const{__scopeToast:s,type:l="foreground",duration:h,open:m,onClose:v,onEscapeKeyDown:i,onPause:A,onResume:P,onSwipeStart:D,onSwipeMove:F,onSwipeCancel:$,onSwipeEnd:K,...J}=r,W=h1(d1,s),[ie,fe]=ee.useState(null),Pe=xs(t,Ft=>fe(Ft)),Fe=ee.useRef(null),ht=ee.useRef(null),at=h||W.duration,Dt=ee.useRef(0),kt=ee.useRef(at),Rt=ee.useRef(0),{onToastAdd:hr,onToastRemove:Tr}=W,_r=Jl(()=>{ie?.contains(document.activeElement)&&W.viewport?.focus(),v()}),Sr=ee.useCallback(Ft=>{!Ft||Ft===1/0||(window.clearTimeout(Rt.current),Dt.current=new Date().getTime(),Rt.current=window.setTimeout(_r,Ft))},[_r]);ee.useEffect(()=>{const Ft=W.viewport;if(Ft){const br=()=>{Sr(kt.current),P?.()},Yt=()=>{const Er=new Date().getTime()-Dt.current;kt.current=kt.current-Er,window.clearTimeout(Rt.current),A?.()};return Ft.addEventListener(tS,Yt),Ft.addEventListener(rS,br),()=>{Ft.removeEventListener(tS,Yt),Ft.removeEventListener(rS,br)}}},[W.viewport,at,A,P,Sr]),ee.useEffect(()=>{m&&!W.isClosePausedRef.current&&Sr(at)},[m,at,W.isClosePausedRef,Sr]),ee.useEffect(()=>(hr(),()=>Tr()),[hr,Tr]);const Br=ee.useMemo(()=>ie?eP(ie):null,[ie]);return W.viewport?b.jsxs(b.Fragment,{children:[Br&&b.jsx(KF,{__scopeToast:s,role:"status","aria-live":l==="foreground"?"assertive":"polite","aria-atomic":!0,children:Br}),b.jsx(WF,{scope:s,onClose:_r,children:Py.createPortal(b.jsx(lT.ItemSlot,{scope:s,children:b.jsx(kF,{asChild:!0,onEscapeKeyDown:jn(i,()=>{W.isFocusedToastEscapeKeyDownRef.current||_r(),W.isFocusedToastEscapeKeyDownRef.current=!1}),children:b.jsx(vi.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":m?"open":"closed","data-swipe-direction":W.swipeDirection,...J,ref:Pe,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:jn(r.onKeyDown,Ft=>{Ft.key==="Escape"&&(i?.(Ft.nativeEvent),Ft.nativeEvent.defaultPrevented||(W.isFocusedToastEscapeKeyDownRef.current=!0,_r()))}),onPointerDown:jn(r.onPointerDown,Ft=>{Ft.button===0&&(Fe.current={x:Ft.clientX,y:Ft.clientY})}),onPointerMove:jn(r.onPointerMove,Ft=>{if(!Fe.current)return;const br=Ft.clientX-Fe.current.x,Yt=Ft.clientY-Fe.current.y,Er=!!ht.current,gt=["left","right"].includes(W.swipeDirection),Jt=["left","up"].includes(W.swipeDirection)?Math.min:Math.max,Ht=gt?Jt(0,br):0,qe=gt?0:Jt(0,Yt),Ct=Ft.pointerType==="touch"?10:2,kr={x:Ht,y:qe},Zr={originalEvent:Ft,delta:kr};Er?(ht.current=kr,gv(HF,F,Zr,{discrete:!1})):mI(kr,W.swipeDirection,Ct)?(ht.current=kr,gv($F,D,Zr,{discrete:!1}),Ft.target.setPointerCapture(Ft.pointerId)):(Math.abs(br)>Ct||Math.abs(Yt)>Ct)&&(Fe.current=null)}),onPointerUp:jn(r.onPointerUp,Ft=>{const br=ht.current,Yt=Ft.target;if(Yt.hasPointerCapture(Ft.pointerId)&&Yt.releasePointerCapture(Ft.pointerId),ht.current=null,Fe.current=null,br){const Er=Ft.currentTarget,gt={originalEvent:Ft,delta:br};mI(br,W.swipeDirection,W.swipeThreshold)?gv(qF,K,gt,{discrete:!0}):gv(GF,$,gt,{discrete:!0}),Er.addEventListener("click",Jt=>Jt.preventDefault(),{once:!0})}})})})}),W.viewport)})]}):null}),KF=r=>{const{__scopeToast:t,children:s,...l}=r,h=h1(d1,t),[m,v]=ee.useState(!1),[i,A]=ee.useState(!1);return QF(()=>v(!0)),ee.useEffect(()=>{const P=window.setTimeout(()=>A(!0),1e3);return()=>window.clearTimeout(P)},[]),i?null:b.jsx(u1,{asChild:!0,children:b.jsx(mx,{...l,children:m&&b.jsxs(b.Fragment,{children:[h.label," ",s]})})})},YF="ToastTitle",Zk=ee.forwardRef((r,t)=>{const{__scopeToast:s,...l}=r;return b.jsx(vi.div,{...l,ref:t})});Zk.displayName=YF;var JF="ToastDescription",Xk=ee.forwardRef((r,t)=>{const{__scopeToast:s,...l}=r;return b.jsx(vi.div,{...l,ref:t})});Xk.displayName=JF;var Kk="ToastAction",Yk=ee.forwardRef((r,t)=>{const{altText:s,...l}=r;return s.trim()?b.jsx(Qk,{altText:s,asChild:!0,children:b.jsx(cT,{...l,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Kk}\`. Expected non-empty \`string\`.`),null)});Yk.displayName=Kk;var Jk="ToastClose",cT=ee.forwardRef((r,t)=>{const{__scopeToast:s,...l}=r,h=ZF(Jk,s);return b.jsx(Qk,{asChild:!0,children:b.jsx(vi.button,{type:"button",...l,ref:t,onClick:jn(r.onClick,h.onClose)})})});cT.displayName=Jk;var Qk=ee.forwardRef((r,t)=>{const{__scopeToast:s,altText:l,...h}=r;return b.jsx(vi.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...h,ref:t})});function eP(r){const t=[];return Array.from(r.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&t.push(l.textContent),eB(l)){const h=l.ariaHidden||l.hidden||l.style.display==="none",m=l.dataset.radixToastAnnounceExclude==="";if(!h)if(m){const v=l.dataset.radixToastAnnounceAlt;v&&t.push(v)}else t.push(...eP(l))}}),t}function gv(r,t,s,{discrete:l}){const h=s.originalEvent.currentTarget,m=new CustomEvent(r,{bubbles:!0,cancelable:!0,detail:s});t&&h.addEventListener(r,t,{once:!0}),l?jk(h,m):h.dispatchEvent(m)}var mI=(r,t,s=0)=>{const l=Math.abs(r.x),h=Math.abs(r.y),m=l>h;return t==="left"||t==="right"?m&&l>s:!m&&h>s};function QF(r=()=>{}){const t=Jl(r);sl(()=>{let s=0,l=0;return s=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(l)}},[t])}function eB(r){return r.nodeType===r.ELEMENT_NODE}function tB(r){const t=[],s=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const h=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||h?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function lw(r){const t=document.activeElement;return r.some(s=>s===t?!0:(s.focus(),document.activeElement!==t))}var rB=$k,tP=Gk,rP=Wk,nP=Zk,iP=Xk,sP=Yk,oP=cT;function aP(r){var t,s,l="";if(typeof r=="string"||typeof r=="number")l+=r;else if(typeof r=="object")if(Array.isArray(r)){var h=r.length;for(t=0;t<h;t++)r[t]&&(s=aP(r[t]))&&(l&&(l+=" "),l+=s)}else for(s in r)r[s]&&(l&&(l+=" "),l+=s);return l}function lP(){for(var r,t,s=0,l="",h=arguments.length;s<h;s++)(r=arguments[s])&&(t=aP(r))&&(l&&(l+=" "),l+=t);return l}const gI=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,yI=lP,gx=(r,t)=>s=>{var l;if(t?.variants==null)return yI(r,s?.class,s?.className);const{variants:h,defaultVariants:m}=t,v=Object.keys(h).map(P=>{const D=s?.[P],F=m?.[P];if(D===null)return null;const $=gI(D)||gI(F);return h[P][$]}),i=s&&Object.entries(s).reduce((P,D)=>{let[F,$]=D;return $===void 0||(P[F]=$),P},{}),A=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((P,D)=>{let{class:F,className:$,...K}=D;return Object.entries(K).every(J=>{let[W,ie]=J;return Array.isArray(ie)?ie.includes({...m,...i}[W]):{...m,...i}[W]===ie})?[...P,F,$]:P},[]);return yI(r,v,A,s?.class,s?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nB=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cP=(...r)=>r.filter((t,s,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var iB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sB=ee.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:l,className:h="",children:m,iconNode:v,...i},A)=>ee.createElement("svg",{ref:A,...iB,width:t,height:t,stroke:r,strokeWidth:l?Number(s)*24/Number(t):s,className:cP("lucide",h),...i},[...v.map(([P,D])=>ee.createElement(P,D)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=(r,t)=>{const s=ee.forwardRef(({className:l,...h},m)=>ee.createElement(sB,{ref:m,iconNode:t,className:cP(`lucide-${nB(r)}`,l),...h}));return s.displayName=`${r}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=Pi("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r0=Pi("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f1=Pi("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oB=Pi("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aB=Pi("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=Pi("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lB=Pi("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=Pi("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uP=Pi("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uB=Pi("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hB=Pi("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hP=Pi("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dP=Pi("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=Pi("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dB=Pi("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=Pi("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pB=Pi("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ng=Pi("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mB=Pi("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=Pi("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=Pi("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=Pi("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _B=Pi("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xB=Pi("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pf=Pi("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xI=Pi("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=Pi("Recycle",[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=Pi("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bB=Pi("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wB=Pi("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=Pi("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=Pi("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=Pi("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=Pi("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=Pi("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=Pi("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ig=Pi("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1=Pi("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=Pi("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),uT="-",IB=r=>{const t=kB(r),{conflictingClassGroups:s,conflictingClassGroupModifiers:l}=r;return{getClassGroupId:v=>{const i=v.split(uT);return i[0]===""&&i.length!==1&&i.shift(),mP(i,t)||MB(v)},getConflictingClassGroupIds:(v,i)=>{const A=s[v]||[];return i&&l[v]?[...A,...l[v]]:A}}},mP=(r,t)=>{if(r.length===0)return t.classGroupId;const s=r[0],l=t.nextPart.get(s),h=l?mP(r.slice(1),l):void 0;if(h)return h;if(t.validators.length===0)return;const m=r.join(uT);return t.validators.find(({validator:v})=>v(m))?.classGroupId},vI=/^\[(.+)\]$/,MB=r=>{if(vI.test(r)){const t=vI.exec(r)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},kB=r=>{const{theme:t,prefix:s}=r,l={nextPart:new Map,validators:[]};return RB(Object.entries(r.classGroups),s).forEach(([m,v])=>{aS(v,l,m,t)}),l},aS=(r,t,s,l)=>{r.forEach(h=>{if(typeof h=="string"){const m=h===""?t:bI(t,h);m.classGroupId=s;return}if(typeof h=="function"){if(PB(h)){aS(h(l),t,s,l);return}t.validators.push({validator:h,classGroupId:s});return}Object.entries(h).forEach(([m,v])=>{aS(v,bI(t,m),s,l)})})},bI=(r,t)=>{let s=r;return t.split(uT).forEach(l=>{s.nextPart.has(l)||s.nextPart.set(l,{nextPart:new Map,validators:[]}),s=s.nextPart.get(l)}),s},PB=r=>r.isThemeGetter,RB=(r,t)=>t?r.map(([s,l])=>{const h=l.map(m=>typeof m=="string"?t+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([v,i])=>[t+v,i])):m);return[s,h]}):r,NB=r=>{if(r<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,l=new Map;const h=(m,v)=>{s.set(m,v),t++,t>r&&(t=0,l=s,s=new Map)};return{get(m){let v=s.get(m);if(v!==void 0)return v;if((v=l.get(m))!==void 0)return h(m,v),v},set(m,v){s.has(m)?s.set(m,v):h(m,v)}}},gP="!",DB=r=>{const{separator:t,experimentalParseClassName:s}=r,l=t.length===1,h=t[0],m=t.length,v=i=>{const A=[];let P=0,D=0,F;for(let ie=0;ie<i.length;ie++){let fe=i[ie];if(P===0){if(fe===h&&(l||i.slice(ie,ie+m)===t)){A.push(i.slice(D,ie)),D=ie+m;continue}if(fe==="/"){F=ie;continue}}fe==="["?P++:fe==="]"&&P--}const $=A.length===0?i:i.substring(D),K=$.startsWith(gP),J=K?$.substring(1):$,W=F&&F>D?F-D:void 0;return{modifiers:A,hasImportantModifier:K,baseClassName:J,maybePostfixModifierPosition:W}};return s?i=>s({className:i,parseClassName:v}):v},OB=r=>{if(r.length<=1)return r;const t=[];let s=[];return r.forEach(l=>{l[0]==="["?(t.push(...s.sort(),l),s=[]):s.push(l)}),t.push(...s.sort()),t},LB=r=>({cache:NB(r.cacheSize),parseClassName:DB(r),...IB(r)}),zB=/\s+/,jB=(r,t)=>{const{parseClassName:s,getClassGroupId:l,getConflictingClassGroupIds:h}=t,m=[],v=r.trim().split(zB);let i="";for(let A=v.length-1;A>=0;A-=1){const P=v[A],{modifiers:D,hasImportantModifier:F,baseClassName:$,maybePostfixModifierPosition:K}=s(P);let J=!!K,W=l(J?$.substring(0,K):$);if(!W){if(!J){i=P+(i.length>0?" "+i:i);continue}if(W=l($),!W){i=P+(i.length>0?" "+i:i);continue}J=!1}const ie=OB(D).join(":"),fe=F?ie+gP:ie,Pe=fe+W;if(m.includes(Pe))continue;m.push(Pe);const Fe=h(W,J);for(let ht=0;ht<Fe.length;++ht){const at=Fe[ht];m.push(fe+at)}i=P+(i.length>0?" "+i:i)}return i};function FB(){let r=0,t,s,l="";for(;r<arguments.length;)(t=arguments[r++])&&(s=yP(t))&&(l&&(l+=" "),l+=s);return l}const yP=r=>{if(typeof r=="string")return r;let t,s="";for(let l=0;l<r.length;l++)r[l]&&(t=yP(r[l]))&&(s&&(s+=" "),s+=t);return s};function BB(r,...t){let s,l,h,m=v;function v(A){const P=t.reduce((D,F)=>F(D),r());return s=LB(P),l=s.cache.get,h=s.cache.set,m=i,i(A)}function i(A){const P=l(A);if(P)return P;const D=jB(A,s);return h(A,D),D}return function(){return m(FB.apply(null,arguments))}}const Ds=r=>{const t=s=>s[r]||[];return t.isThemeGetter=!0,t},_P=/^\[(?:([a-z-]+):)?(.+)\]$/i,VB=/^\d+\/\d+$/,UB=new Set(["px","full","screen"]),$B=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,HB=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,GB=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,qB=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,WB=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,mf=r=>py(r)||UB.has(r)||VB.test(r),Mp=r=>Ny(r,"length",t4),py=r=>!!r&&!Number.isNaN(Number(r)),cw=r=>Ny(r,"number",py),k_=r=>!!r&&Number.isInteger(Number(r)),ZB=r=>r.endsWith("%")&&py(r.slice(0,-1)),_i=r=>_P.test(r),kp=r=>$B.test(r),XB=new Set(["length","size","percentage"]),KB=r=>Ny(r,XB,xP),YB=r=>Ny(r,"position",xP),JB=new Set(["image","url"]),QB=r=>Ny(r,JB,n4),e4=r=>Ny(r,"",r4),P_=()=>!0,Ny=(r,t,s)=>{const l=_P.exec(r);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):s(l[2]):!1},t4=r=>HB.test(r)&&!GB.test(r),xP=()=>!1,r4=r=>qB.test(r),n4=r=>WB.test(r),i4=()=>{const r=Ds("colors"),t=Ds("spacing"),s=Ds("blur"),l=Ds("brightness"),h=Ds("borderColor"),m=Ds("borderRadius"),v=Ds("borderSpacing"),i=Ds("borderWidth"),A=Ds("contrast"),P=Ds("grayscale"),D=Ds("hueRotate"),F=Ds("invert"),$=Ds("gap"),K=Ds("gradientColorStops"),J=Ds("gradientColorStopPositions"),W=Ds("inset"),ie=Ds("margin"),fe=Ds("opacity"),Pe=Ds("padding"),Fe=Ds("saturate"),ht=Ds("scale"),at=Ds("sepia"),Dt=Ds("skew"),kt=Ds("space"),Rt=Ds("translate"),hr=()=>["auto","contain","none"],Tr=()=>["auto","hidden","clip","visible","scroll"],_r=()=>["auto",_i,t],Sr=()=>[_i,t],Br=()=>["",mf,Mp],Ft=()=>["auto",py,_i],br=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Yt=()=>["solid","dashed","dotted","double","none"],Er=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],gt=()=>["start","end","center","between","around","evenly","stretch"],Jt=()=>["","0",_i],Ht=()=>["auto","avoid","all","avoid-page","page","left","right","column"],qe=()=>[py,_i];return{cacheSize:500,separator:":",theme:{colors:[P_],spacing:[mf,Mp],blur:["none","",kp,_i],brightness:qe(),borderColor:[r],borderRadius:["none","","full",kp,_i],borderSpacing:Sr(),borderWidth:Br(),contrast:qe(),grayscale:Jt(),hueRotate:qe(),invert:Jt(),gap:Sr(),gradientColorStops:[r],gradientColorStopPositions:[ZB,Mp],inset:_r(),margin:_r(),opacity:qe(),padding:Sr(),saturate:qe(),scale:qe(),sepia:Jt(),skew:qe(),space:Sr(),translate:Sr()},classGroups:{aspect:[{aspect:["auto","square","video",_i]}],container:["container"],columns:[{columns:[kp]}],"break-after":[{"break-after":Ht()}],"break-before":[{"break-before":Ht()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...br(),_i]}],overflow:[{overflow:Tr()}],"overflow-x":[{"overflow-x":Tr()}],"overflow-y":[{"overflow-y":Tr()}],overscroll:[{overscroll:hr()}],"overscroll-x":[{"overscroll-x":hr()}],"overscroll-y":[{"overscroll-y":hr()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[W]}],"inset-x":[{"inset-x":[W]}],"inset-y":[{"inset-y":[W]}],start:[{start:[W]}],end:[{end:[W]}],top:[{top:[W]}],right:[{right:[W]}],bottom:[{bottom:[W]}],left:[{left:[W]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",k_,_i]}],basis:[{basis:_r()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",_i]}],grow:[{grow:Jt()}],shrink:[{shrink:Jt()}],order:[{order:["first","last","none",k_,_i]}],"grid-cols":[{"grid-cols":[P_]}],"col-start-end":[{col:["auto",{span:["full",k_,_i]},_i]}],"col-start":[{"col-start":Ft()}],"col-end":[{"col-end":Ft()}],"grid-rows":[{"grid-rows":[P_]}],"row-start-end":[{row:["auto",{span:[k_,_i]},_i]}],"row-start":[{"row-start":Ft()}],"row-end":[{"row-end":Ft()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",_i]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",_i]}],gap:[{gap:[$]}],"gap-x":[{"gap-x":[$]}],"gap-y":[{"gap-y":[$]}],"justify-content":[{justify:["normal",...gt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...gt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...gt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Pe]}],px:[{px:[Pe]}],py:[{py:[Pe]}],ps:[{ps:[Pe]}],pe:[{pe:[Pe]}],pt:[{pt:[Pe]}],pr:[{pr:[Pe]}],pb:[{pb:[Pe]}],pl:[{pl:[Pe]}],m:[{m:[ie]}],mx:[{mx:[ie]}],my:[{my:[ie]}],ms:[{ms:[ie]}],me:[{me:[ie]}],mt:[{mt:[ie]}],mr:[{mr:[ie]}],mb:[{mb:[ie]}],ml:[{ml:[ie]}],"space-x":[{"space-x":[kt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[kt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",_i,t]}],"min-w":[{"min-w":[_i,t,"min","max","fit"]}],"max-w":[{"max-w":[_i,t,"none","full","min","max","fit","prose",{screen:[kp]},kp]}],h:[{h:[_i,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[_i,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[_i,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[_i,t,"auto","min","max","fit"]}],"font-size":[{text:["base",kp,Mp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",cw]}],"font-family":[{font:[P_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",_i]}],"line-clamp":[{"line-clamp":["none",py,cw]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",mf,_i]}],"list-image":[{"list-image":["none",_i]}],"list-style-type":[{list:["none","disc","decimal",_i]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[r]}],"placeholder-opacity":[{"placeholder-opacity":[fe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[r]}],"text-opacity":[{"text-opacity":[fe]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Yt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",mf,Mp]}],"underline-offset":[{"underline-offset":["auto",mf,_i]}],"text-decoration-color":[{decoration:[r]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Sr()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",_i]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",_i]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[fe]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...br(),YB]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",KB]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},QB]}],"bg-color":[{bg:[r]}],"gradient-from-pos":[{from:[J]}],"gradient-via-pos":[{via:[J]}],"gradient-to-pos":[{to:[J]}],"gradient-from":[{from:[K]}],"gradient-via":[{via:[K]}],"gradient-to":[{to:[K]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[fe]}],"border-style":[{border:[...Yt(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[fe]}],"divide-style":[{divide:Yt()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-s":[{"border-s":[h]}],"border-color-e":[{"border-e":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...Yt()]}],"outline-offset":[{"outline-offset":[mf,_i]}],"outline-w":[{outline:[mf,Mp]}],"outline-color":[{outline:[r]}],"ring-w":[{ring:Br()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[r]}],"ring-opacity":[{"ring-opacity":[fe]}],"ring-offset-w":[{"ring-offset":[mf,Mp]}],"ring-offset-color":[{"ring-offset":[r]}],shadow:[{shadow:["","inner","none",kp,e4]}],"shadow-color":[{shadow:[P_]}],opacity:[{opacity:[fe]}],"mix-blend":[{"mix-blend":[...Er(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Er()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[l]}],contrast:[{contrast:[A]}],"drop-shadow":[{"drop-shadow":["","none",kp,_i]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[D]}],invert:[{invert:[F]}],saturate:[{saturate:[Fe]}],sepia:[{sepia:[at]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[A]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[D]}],"backdrop-invert":[{"backdrop-invert":[F]}],"backdrop-opacity":[{"backdrop-opacity":[fe]}],"backdrop-saturate":[{"backdrop-saturate":[Fe]}],"backdrop-sepia":[{"backdrop-sepia":[at]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[v]}],"border-spacing-x":[{"border-spacing-x":[v]}],"border-spacing-y":[{"border-spacing-y":[v]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",_i]}],duration:[{duration:qe()}],ease:[{ease:["linear","in","out","in-out",_i]}],delay:[{delay:qe()}],animate:[{animate:["none","spin","ping","pulse","bounce",_i]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ht]}],"scale-x":[{"scale-x":[ht]}],"scale-y":[{"scale-y":[ht]}],rotate:[{rotate:[k_,_i]}],"translate-x":[{"translate-x":[Rt]}],"translate-y":[{"translate-y":[Rt]}],"skew-x":[{"skew-x":[Dt]}],"skew-y":[{"skew-y":[Dt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",_i]}],accent:[{accent:["auto",r]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",_i]}],"caret-color":[{caret:[r]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Sr()}],"scroll-mx":[{"scroll-mx":Sr()}],"scroll-my":[{"scroll-my":Sr()}],"scroll-ms":[{"scroll-ms":Sr()}],"scroll-me":[{"scroll-me":Sr()}],"scroll-mt":[{"scroll-mt":Sr()}],"scroll-mr":[{"scroll-mr":Sr()}],"scroll-mb":[{"scroll-mb":Sr()}],"scroll-ml":[{"scroll-ml":Sr()}],"scroll-p":[{"scroll-p":Sr()}],"scroll-px":[{"scroll-px":Sr()}],"scroll-py":[{"scroll-py":Sr()}],"scroll-ps":[{"scroll-ps":Sr()}],"scroll-pe":[{"scroll-pe":Sr()}],"scroll-pt":[{"scroll-pt":Sr()}],"scroll-pr":[{"scroll-pr":Sr()}],"scroll-pb":[{"scroll-pb":Sr()}],"scroll-pl":[{"scroll-pl":Sr()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",_i]}],fill:[{fill:[r,"none"]}],"stroke-w":[{stroke:[mf,Mp,cw]}],stroke:[{stroke:[r,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},s4=BB(i4);function ki(...r){return s4(lP(r))}const o4=rB,vP=ee.forwardRef(({className:r,...t},s)=>b.jsx(tP,{ref:s,className:ki("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",r),...t}));vP.displayName=tP.displayName;const a4=gx("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),bP=ee.forwardRef(({className:r,variant:t,...s},l)=>b.jsx(rP,{ref:l,className:ki(a4({variant:t}),r),...s}));bP.displayName=rP.displayName;const l4=ee.forwardRef(({className:r,...t},s)=>b.jsx(sP,{ref:s,className:ki("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",r),...t}));l4.displayName=sP.displayName;const wP=ee.forwardRef(({className:r,...t},s)=>b.jsx(oP,{ref:s,className:ki("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",r),"toast-close":"",...t,children:b.jsx(p1,{className:"h-4 w-4"})}));wP.displayName=oP.displayName;const SP=ee.forwardRef(({className:r,...t},s)=>b.jsx(nP,{ref:s,className:ki("text-sm font-semibold",r),...t}));SP.displayName=nP.displayName;const TP=ee.forwardRef(({className:r,...t},s)=>b.jsx(iP,{ref:s,className:ki("text-sm opacity-90",r),...t}));TP.displayName=iP.displayName;function c4(){const{toasts:r}=ky();return b.jsxs(o4,{children:[r.map(function({id:t,title:s,description:l,action:h,...m}){return b.jsxs(bP,{...m,children:[b.jsxs("div",{className:"grid gap-1",children:[s&&b.jsx(SP,{children:s}),l&&b.jsx(TP,{children:l})]}),h,b.jsx(wP,{})]},t)}),b.jsx(vP,{})]})}var wI=["light","dark"],u4="(prefers-color-scheme: dark)",h4=ee.createContext(void 0),d4={setTheme:r=>{},themes:[]},f4=()=>{var r;return(r=ee.useContext(h4))!=null?r:d4};ee.memo(({forcedTheme:r,storageKey:t,attribute:s,enableSystem:l,enableColorScheme:h,defaultTheme:m,value:v,attrs:i,nonce:A})=>{let P=m==="system",D=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(J=>`'${J}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,F=h?wI.includes(m)&&m?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${m}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",$=(J,W=!1,ie=!0)=>{let fe=v?v[J]:J,Pe=W?J+"|| ''":`'${fe}'`,Fe="";return h&&ie&&!W&&wI.includes(J)&&(Fe+=`d.style.colorScheme = '${J}';`),s==="class"?W||fe?Fe+=`c.add(${Pe})`:Fe+="null":fe&&(Fe+=`d[s](n,${Pe})`),Fe},K=r?`!function(){${D}${$(r)}}()`:l?`!function(){try{${D}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${P})){var t='${u4}',m=window.matchMedia(t);if(m.media!==t||m.matches){${$("dark")}}else{${$("light")}}}else if(e){${v?`var x=${JSON.stringify(v)};`:""}${$(v?"x[e]":"e",!0)}}${P?"":"else{"+$(m,!1,!1)+"}"}${F}}catch(e){}}()`:`!function(){try{${D}var e=localStorage.getItem('${t}');if(e){${v?`var x=${JSON.stringify(v)};`:""}${$(v?"x[e]":"e",!0)}}else{${$(m,!1,!1)};}${F}}catch(t){}}();`;return ee.createElement("script",{nonce:A,dangerouslySetInnerHTML:{__html:K}})});var p4=r=>{switch(r){case"success":return y4;case"info":return x4;case"warning":return _4;case"error":return v4;default:return null}},m4=Array(12).fill(0),g4=({visible:r})=>Mr.createElement("div",{className:"sonner-loading-wrapper","data-visible":r},Mr.createElement("div",{className:"sonner-spinner"},m4.map((t,s)=>Mr.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),y4=Mr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Mr.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),_4=Mr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Mr.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),x4=Mr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Mr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),v4=Mr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Mr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),b4=()=>{let[r,t]=Mr.useState(document.hidden);return Mr.useEffect(()=>{let s=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),r},lS=1,w4=class{constructor(){this.subscribe=r=>(this.subscribers.push(r),()=>{let t=this.subscribers.indexOf(r);this.subscribers.splice(t,1)}),this.publish=r=>{this.subscribers.forEach(t=>t(r))},this.addToast=r=>{this.publish(r),this.toasts=[...this.toasts,r]},this.create=r=>{var t;let{message:s,...l}=r,h=typeof r?.id=="number"||((t=r.id)==null?void 0:t.length)>0?r.id:lS++,m=this.toasts.find(i=>i.id===h),v=r.dismissible===void 0?!0:r.dismissible;return m?this.toasts=this.toasts.map(i=>i.id===h?(this.publish({...i,...r,id:h,title:s}),{...i,...r,id:h,dismissible:v,title:s}):i):this.addToast({title:s,...l,dismissible:v,id:h}),h},this.dismiss=r=>(r||this.toasts.forEach(t=>{this.subscribers.forEach(s=>s({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:r,dismiss:!0})),r),this.message=(r,t)=>this.create({...t,message:r}),this.error=(r,t)=>this.create({...t,message:r,type:"error"}),this.success=(r,t)=>this.create({...t,type:"success",message:r}),this.info=(r,t)=>this.create({...t,type:"info",message:r}),this.warning=(r,t)=>this.create({...t,type:"warning",message:r}),this.loading=(r,t)=>this.create({...t,type:"loading",message:r}),this.promise=(r,t)=>{if(!t)return;let s;t.loading!==void 0&&(s=this.create({...t,promise:r,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let l=r instanceof Promise?r:r(),h=s!==void 0;return l.then(async m=>{if(T4(m)&&!m.ok){h=!1;let v=typeof t.error=="function"?await t.error(`HTTP error! status: ${m.status}`):t.error,i=typeof t.description=="function"?await t.description(`HTTP error! status: ${m.status}`):t.description;this.create({id:s,type:"error",message:v,description:i})}else if(t.success!==void 0){h=!1;let v=typeof t.success=="function"?await t.success(m):t.success,i=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"success",message:v,description:i})}}).catch(async m=>{if(t.error!==void 0){h=!1;let v=typeof t.error=="function"?await t.error(m):t.error,i=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"error",message:v,description:i})}}).finally(()=>{var m;h&&(this.dismiss(s),s=void 0),(m=t.finally)==null||m.call(t)}),s},this.custom=(r,t)=>{let s=t?.id||lS++;return this.create({jsx:r(s),id:s,...t}),s},this.subscribers=[],this.toasts=[]}},Tc=new w4,S4=(r,t)=>{let s=t?.id||lS++;return Tc.addToast({title:r,...t,id:s}),s},T4=r=>r&&typeof r=="object"&&"ok"in r&&typeof r.ok=="boolean"&&"status"in r&&typeof r.status=="number",E4=S4,C4=()=>Tc.toasts;Object.assign(E4,{success:Tc.success,info:Tc.info,warning:Tc.warning,error:Tc.error,custom:Tc.custom,message:Tc.message,promise:Tc.promise,dismiss:Tc.dismiss,loading:Tc.loading},{getHistory:C4});function A4(r,{insertAt:t}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",t==="top"&&s.firstChild?s.insertBefore(l,s.firstChild):s.appendChild(l),l.styleSheet?l.styleSheet.cssText=r:l.appendChild(document.createTextNode(r))}A4(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function yv(r){return r.label!==void 0}var I4=3,M4="32px",k4=4e3,P4=356,R4=14,N4=20,D4=200;function O4(...r){return r.filter(Boolean).join(" ")}var L4=r=>{var t,s,l,h,m,v,i,A,P,D;let{invert:F,toast:$,unstyled:K,interacting:J,setHeights:W,visibleToasts:ie,heights:fe,index:Pe,toasts:Fe,expanded:ht,removeToast:at,defaultRichColors:Dt,closeButton:kt,style:Rt,cancelButtonStyle:hr,actionButtonStyle:Tr,className:_r="",descriptionClassName:Sr="",duration:Br,position:Ft,gap:br,loadingIcon:Yt,expandByDefault:Er,classNames:gt,icons:Jt,closeButtonAriaLabel:Ht="Close toast",pauseWhenPageIsHidden:qe,cn:Ct}=r,[kr,Zr]=Mr.useState(!1),[Rr,ar]=Mr.useState(!1),[lr,$r]=Mr.useState(!1),[Cr,Fr]=Mr.useState(!1),[Zn,ri]=Mr.useState(0),[On,vs]=Mr.useState(0),$s=Mr.useRef(null),Hi=Mr.useRef(null),mo=Pe===0,El=Pe+1<=ie,zi=$.type,Ki=$.dismissible!==!1,to=$.className||"",Qo=$.descriptionClassName||"",To=Mr.useMemo(()=>fe.findIndex(Dr=>Dr.toastId===$.id)||0,[fe,$.id]),Cs=Mr.useMemo(()=>{var Dr;return(Dr=$.closeButton)!=null?Dr:kt},[$.closeButton,kt]),Ua=Mr.useMemo(()=>$.duration||Br||k4,[$.duration,Br]),wa=Mr.useRef(0),is=Mr.useRef(0),Sa=Mr.useRef(0),Hs=Mr.useRef(null),[Fo,ss]=Ft.split("-"),go=Mr.useMemo(()=>fe.reduce((Dr,ci,di)=>di>=To?Dr:Dr+ci.height,0),[fe,To]),Ta=b4(),Ea=$.invert||F,Ca=zi==="loading";is.current=Mr.useMemo(()=>To*br+go,[To,go]),Mr.useEffect(()=>{Zr(!0)},[]),Mr.useLayoutEffect(()=>{if(!kr)return;let Dr=Hi.current,ci=Dr.style.height;Dr.style.height="auto";let di=Dr.getBoundingClientRect().height;Dr.style.height=ci,vs(di),W(Vi=>Vi.find(Is=>Is.toastId===$.id)?Vi.map(Is=>Is.toastId===$.id?{...Is,height:di}:Is):[{toastId:$.id,height:di,position:$.position},...Vi])},[kr,$.title,$.description,W,$.id]);let As=Mr.useCallback(()=>{ar(!0),ri(is.current),W(Dr=>Dr.filter(ci=>ci.toastId!==$.id)),setTimeout(()=>{at($)},D4)},[$,at,W,is]);Mr.useEffect(()=>{if($.promise&&zi==="loading"||$.duration===1/0||$.type==="loading")return;let Dr,ci=Ua;return ht||J||qe&&Ta?(()=>{if(Sa.current<wa.current){let di=new Date().getTime()-wa.current;ci=ci-di}Sa.current=new Date().getTime()})():ci!==1/0&&(wa.current=new Date().getTime(),Dr=setTimeout(()=>{var di;(di=$.onAutoClose)==null||di.call($,$),As()},ci)),()=>clearTimeout(Dr)},[ht,J,Er,$,Ua,As,$.promise,zi,qe,Ta]),Mr.useEffect(()=>{let Dr=Hi.current;if(Dr){let ci=Dr.getBoundingClientRect().height;return vs(ci),W(di=>[{toastId:$.id,height:ci,position:$.position},...di]),()=>W(di=>di.filter(Vi=>Vi.toastId!==$.id))}},[W,$.id]),Mr.useEffect(()=>{$.delete&&As()},[As,$.delete]);function $a(){return Jt!=null&&Jt.loading?Mr.createElement("div",{className:"sonner-loader","data-visible":zi==="loading"},Jt.loading):Yt?Mr.createElement("div",{className:"sonner-loader","data-visible":zi==="loading"},Yt):Mr.createElement(g4,{visible:zi==="loading"})}return Mr.createElement("li",{"aria-live":$.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Hi,className:Ct(_r,to,gt?.toast,(t=$?.classNames)==null?void 0:t.toast,gt?.default,gt?.[zi],(s=$?.classNames)==null?void 0:s[zi]),"data-sonner-toast":"","data-rich-colors":(l=$.richColors)!=null?l:Dt,"data-styled":!($.jsx||$.unstyled||K),"data-mounted":kr,"data-promise":!!$.promise,"data-removed":Rr,"data-visible":El,"data-y-position":Fo,"data-x-position":ss,"data-index":Pe,"data-front":mo,"data-swiping":lr,"data-dismissible":Ki,"data-type":zi,"data-invert":Ea,"data-swipe-out":Cr,"data-expanded":!!(ht||Er&&kr),style:{"--index":Pe,"--toasts-before":Pe,"--z-index":Fe.length-Pe,"--offset":`${Rr?Zn:is.current}px`,"--initial-height":Er?"auto":`${On}px`,...Rt,...$.style},onPointerDown:Dr=>{Ca||!Ki||($s.current=new Date,ri(is.current),Dr.target.setPointerCapture(Dr.pointerId),Dr.target.tagName!=="BUTTON"&&($r(!0),Hs.current={x:Dr.clientX,y:Dr.clientY}))},onPointerUp:()=>{var Dr,ci,di,Vi;if(Cr||!Ki)return;Hs.current=null;let Is=Number(((Dr=Hi.current)==null?void 0:Dr.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Ha=new Date().getTime()-((ci=$s.current)==null?void 0:ci.getTime()),Ga=Math.abs(Is)/Ha;if(Math.abs(Is)>=N4||Ga>.11){ri(is.current),(di=$.onDismiss)==null||di.call($,$),As(),Fr(!0);return}(Vi=Hi.current)==null||Vi.style.setProperty("--swipe-amount","0px"),$r(!1)},onPointerMove:Dr=>{var ci;if(!Hs.current||!Ki)return;let di=Dr.clientY-Hs.current.y,Vi=Dr.clientX-Hs.current.x,Is=(Fo==="top"?Math.min:Math.max)(0,di),Ha=Dr.pointerType==="touch"?10:2;Math.abs(Is)>Ha?(ci=Hi.current)==null||ci.style.setProperty("--swipe-amount",`${di}px`):Math.abs(Vi)>Ha&&(Hs.current=null)}},Cs&&!$.jsx?Mr.createElement("button",{"aria-label":Ht,"data-disabled":Ca,"data-close-button":!0,onClick:Ca||!Ki?()=>{}:()=>{var Dr;As(),(Dr=$.onDismiss)==null||Dr.call($,$)},className:Ct(gt?.closeButton,(h=$?.classNames)==null?void 0:h.closeButton)},Mr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Mr.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Mr.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,$.jsx||Mr.isValidElement($.title)?$.jsx||$.title:Mr.createElement(Mr.Fragment,null,zi||$.icon||$.promise?Mr.createElement("div",{"data-icon":"",className:Ct(gt?.icon,(m=$?.classNames)==null?void 0:m.icon)},$.promise||$.type==="loading"&&!$.icon?$.icon||$a():null,$.type!=="loading"?$.icon||Jt?.[zi]||p4(zi):null):null,Mr.createElement("div",{"data-content":"",className:Ct(gt?.content,(v=$?.classNames)==null?void 0:v.content)},Mr.createElement("div",{"data-title":"",className:Ct(gt?.title,(i=$?.classNames)==null?void 0:i.title)},$.title),$.description?Mr.createElement("div",{"data-description":"",className:Ct(Sr,Qo,gt?.description,(A=$?.classNames)==null?void 0:A.description)},$.description):null),Mr.isValidElement($.cancel)?$.cancel:$.cancel&&yv($.cancel)?Mr.createElement("button",{"data-button":!0,"data-cancel":!0,style:$.cancelButtonStyle||hr,onClick:Dr=>{var ci,di;yv($.cancel)&&Ki&&((di=(ci=$.cancel).onClick)==null||di.call(ci,Dr),As())},className:Ct(gt?.cancelButton,(P=$?.classNames)==null?void 0:P.cancelButton)},$.cancel.label):null,Mr.isValidElement($.action)?$.action:$.action&&yv($.action)?Mr.createElement("button",{"data-button":!0,"data-action":!0,style:$.actionButtonStyle||Tr,onClick:Dr=>{var ci,di;yv($.action)&&(Dr.defaultPrevented||((di=(ci=$.action).onClick)==null||di.call(ci,Dr),As()))},className:Ct(gt?.actionButton,(D=$?.classNames)==null?void 0:D.actionButton)},$.action.label):null))};function SI(){if(typeof window>"u"||typeof document>"u")return"ltr";let r=document.documentElement.getAttribute("dir");return r==="auto"||!r?window.getComputedStyle(document.documentElement).direction:r}var z4=r=>{let{invert:t,position:s="bottom-right",hotkey:l=["altKey","KeyT"],expand:h,closeButton:m,className:v,offset:i,theme:A="light",richColors:P,duration:D,style:F,visibleToasts:$=I4,toastOptions:K,dir:J=SI(),gap:W=R4,loadingIcon:ie,icons:fe,containerAriaLabel:Pe="Notifications",pauseWhenPageIsHidden:Fe,cn:ht=O4}=r,[at,Dt]=Mr.useState([]),kt=Mr.useMemo(()=>Array.from(new Set([s].concat(at.filter(qe=>qe.position).map(qe=>qe.position)))),[at,s]),[Rt,hr]=Mr.useState([]),[Tr,_r]=Mr.useState(!1),[Sr,Br]=Mr.useState(!1),[Ft,br]=Mr.useState(A!=="system"?A:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Yt=Mr.useRef(null),Er=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),gt=Mr.useRef(null),Jt=Mr.useRef(!1),Ht=Mr.useCallback(qe=>{var Ct;(Ct=at.find(kr=>kr.id===qe.id))!=null&&Ct.delete||Tc.dismiss(qe.id),Dt(kr=>kr.filter(({id:Zr})=>Zr!==qe.id))},[at]);return Mr.useEffect(()=>Tc.subscribe(qe=>{if(qe.dismiss){Dt(Ct=>Ct.map(kr=>kr.id===qe.id?{...kr,delete:!0}:kr));return}setTimeout(()=>{sT.flushSync(()=>{Dt(Ct=>{let kr=Ct.findIndex(Zr=>Zr.id===qe.id);return kr!==-1?[...Ct.slice(0,kr),{...Ct[kr],...qe},...Ct.slice(kr+1)]:[qe,...Ct]})})})}),[]),Mr.useEffect(()=>{if(A!=="system"){br(A);return}A==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?br("dark"):br("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:qe})=>{br(qe?"dark":"light")})},[A]),Mr.useEffect(()=>{at.length<=1&&_r(!1)},[at]),Mr.useEffect(()=>{let qe=Ct=>{var kr,Zr;l.every(Rr=>Ct[Rr]||Ct.code===Rr)&&(_r(!0),(kr=Yt.current)==null||kr.focus()),Ct.code==="Escape"&&(document.activeElement===Yt.current||(Zr=Yt.current)!=null&&Zr.contains(document.activeElement))&&_r(!1)};return document.addEventListener("keydown",qe),()=>document.removeEventListener("keydown",qe)},[l]),Mr.useEffect(()=>{if(Yt.current)return()=>{gt.current&&(gt.current.focus({preventScroll:!0}),gt.current=null,Jt.current=!1)}},[Yt.current]),at.length?Mr.createElement("section",{"aria-label":`${Pe} ${Er}`,tabIndex:-1},kt.map((qe,Ct)=>{var kr;let[Zr,Rr]=qe.split("-");return Mr.createElement("ol",{key:qe,dir:J==="auto"?SI():J,tabIndex:-1,ref:Yt,className:v,"data-sonner-toaster":!0,"data-theme":Ft,"data-y-position":Zr,"data-x-position":Rr,style:{"--front-toast-height":`${((kr=Rt[0])==null?void 0:kr.height)||0}px`,"--offset":typeof i=="number"?`${i}px`:i||M4,"--width":`${P4}px`,"--gap":`${W}px`,...F},onBlur:ar=>{Jt.current&&!ar.currentTarget.contains(ar.relatedTarget)&&(Jt.current=!1,gt.current&&(gt.current.focus({preventScroll:!0}),gt.current=null))},onFocus:ar=>{ar.target instanceof HTMLElement&&ar.target.dataset.dismissible==="false"||Jt.current||(Jt.current=!0,gt.current=ar.relatedTarget)},onMouseEnter:()=>_r(!0),onMouseMove:()=>_r(!0),onMouseLeave:()=>{Sr||_r(!1)},onPointerDown:ar=>{ar.target instanceof HTMLElement&&ar.target.dataset.dismissible==="false"||Br(!0)},onPointerUp:()=>Br(!1)},at.filter(ar=>!ar.position&&Ct===0||ar.position===qe).map((ar,lr)=>{var $r,Cr;return Mr.createElement(L4,{key:ar.id,icons:fe,index:lr,toast:ar,defaultRichColors:P,duration:($r=K?.duration)!=null?$r:D,className:K?.className,descriptionClassName:K?.descriptionClassName,invert:t,visibleToasts:$,closeButton:(Cr=K?.closeButton)!=null?Cr:m,interacting:Sr,position:qe,style:K?.style,unstyled:K?.unstyled,classNames:K?.classNames,cancelButtonStyle:K?.cancelButtonStyle,actionButtonStyle:K?.actionButtonStyle,removeToast:Ht,toasts:at.filter(Fr=>Fr.position==ar.position),heights:Rt.filter(Fr=>Fr.position==ar.position),setHeights:hr,expandByDefault:h,gap:W,loadingIcon:ie,expanded:Tr,pauseWhenPageIsHidden:Fe,cn:ht})}))})):null};const j4=({...r})=>{const{theme:t="system"}=f4();return b.jsx(z4,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...r})};var F4=Ok.useId||(()=>{}),B4=0;function $p(r){const[t,s]=ee.useState(F4());return sl(()=>{s(l=>l??String(B4++))},[r]),t?`radix-${t}`:""}const V4=["top","right","bottom","left"],Kp=Math.min,Ec=Math.max,n0=Math.round,_v=Math.floor,Yp=r=>({x:r,y:r}),U4={left:"right",right:"left",bottom:"top",top:"bottom"},$4={start:"end",end:"start"};function cS(r,t,s){return Ec(r,Kp(t,s))}function Tf(r,t){return typeof r=="function"?r(t):r}function Ef(r){return r.split("-")[0]}function Dy(r){return r.split("-")[1]}function hT(r){return r==="x"?"y":"x"}function dT(r){return r==="y"?"height":"width"}function Jp(r){return["top","bottom"].includes(Ef(r))?"y":"x"}function fT(r){return hT(Jp(r))}function H4(r,t,s){s===void 0&&(s=!1);const l=Dy(r),h=fT(r),m=dT(h);let v=h==="x"?l===(s?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[m]>t.floating[m]&&(v=i0(v)),[v,i0(v)]}function G4(r){const t=i0(r);return[uS(r),t,uS(t)]}function uS(r){return r.replace(/start|end/g,t=>$4[t])}function q4(r,t,s){const l=["left","right"],h=["right","left"],m=["top","bottom"],v=["bottom","top"];switch(r){case"top":case"bottom":return s?t?h:l:t?l:h;case"left":case"right":return t?m:v;default:return[]}}function W4(r,t,s,l){const h=Dy(r);let m=q4(Ef(r),s==="start",l);return h&&(m=m.map(v=>v+"-"+h),t&&(m=m.concat(m.map(uS)))),m}function i0(r){return r.replace(/left|right|bottom|top/g,t=>U4[t])}function Z4(r){return{top:0,right:0,bottom:0,left:0,...r}}function EP(r){return typeof r!="number"?Z4(r):{top:r,right:r,bottom:r,left:r}}function s0(r){const{x:t,y:s,width:l,height:h}=r;return{width:l,height:h,top:s,left:t,right:t+l,bottom:s+h,x:t,y:s}}function TI(r,t,s){let{reference:l,floating:h}=r;const m=Jp(t),v=fT(t),i=dT(v),A=Ef(t),P=m==="y",D=l.x+l.width/2-h.width/2,F=l.y+l.height/2-h.height/2,$=l[i]/2-h[i]/2;let K;switch(A){case"top":K={x:D,y:l.y-h.height};break;case"bottom":K={x:D,y:l.y+l.height};break;case"right":K={x:l.x+l.width,y:F};break;case"left":K={x:l.x-h.width,y:F};break;default:K={x:l.x,y:l.y}}switch(Dy(t)){case"start":K[v]-=$*(s&&P?-1:1);break;case"end":K[v]+=$*(s&&P?-1:1);break}return K}const X4=async(r,t,s)=>{const{placement:l="bottom",strategy:h="absolute",middleware:m=[],platform:v}=s,i=m.filter(Boolean),A=await(v.isRTL==null?void 0:v.isRTL(t));let P=await v.getElementRects({reference:r,floating:t,strategy:h}),{x:D,y:F}=TI(P,l,A),$=l,K={},J=0;for(let W=0;W<i.length;W++){const{name:ie,fn:fe}=i[W],{x:Pe,y:Fe,data:ht,reset:at}=await fe({x:D,y:F,initialPlacement:l,placement:$,strategy:h,middlewareData:K,rects:P,platform:v,elements:{reference:r,floating:t}});D=Pe??D,F=Fe??F,K={...K,[ie]:{...K[ie],...ht}},at&&J<=50&&(J++,typeof at=="object"&&(at.placement&&($=at.placement),at.rects&&(P=at.rects===!0?await v.getElementRects({reference:r,floating:t,strategy:h}):at.rects),{x:D,y:F}=TI(P,$,A)),W=-1)}return{x:D,y:F,placement:$,strategy:h,middlewareData:K}};async function Y_(r,t){var s;t===void 0&&(t={});const{x:l,y:h,platform:m,rects:v,elements:i,strategy:A}=r,{boundary:P="clippingAncestors",rootBoundary:D="viewport",elementContext:F="floating",altBoundary:$=!1,padding:K=0}=Tf(t,r),J=EP(K),ie=i[$?F==="floating"?"reference":"floating":F],fe=s0(await m.getClippingRect({element:(s=await(m.isElement==null?void 0:m.isElement(ie)))==null||s?ie:ie.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(i.floating)),boundary:P,rootBoundary:D,strategy:A})),Pe=F==="floating"?{x:l,y:h,width:v.floating.width,height:v.floating.height}:v.reference,Fe=await(m.getOffsetParent==null?void 0:m.getOffsetParent(i.floating)),ht=await(m.isElement==null?void 0:m.isElement(Fe))?await(m.getScale==null?void 0:m.getScale(Fe))||{x:1,y:1}:{x:1,y:1},at=s0(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:Pe,offsetParent:Fe,strategy:A}):Pe);return{top:(fe.top-at.top+J.top)/ht.y,bottom:(at.bottom-fe.bottom+J.bottom)/ht.y,left:(fe.left-at.left+J.left)/ht.x,right:(at.right-fe.right+J.right)/ht.x}}const K4=r=>({name:"arrow",options:r,async fn(t){const{x:s,y:l,placement:h,rects:m,platform:v,elements:i,middlewareData:A}=t,{element:P,padding:D=0}=Tf(r,t)||{};if(P==null)return{};const F=EP(D),$={x:s,y:l},K=fT(h),J=dT(K),W=await v.getDimensions(P),ie=K==="y",fe=ie?"top":"left",Pe=ie?"bottom":"right",Fe=ie?"clientHeight":"clientWidth",ht=m.reference[J]+m.reference[K]-$[K]-m.floating[J],at=$[K]-m.reference[K],Dt=await(v.getOffsetParent==null?void 0:v.getOffsetParent(P));let kt=Dt?Dt[Fe]:0;(!kt||!await(v.isElement==null?void 0:v.isElement(Dt)))&&(kt=i.floating[Fe]||m.floating[J]);const Rt=ht/2-at/2,hr=kt/2-W[J]/2-1,Tr=Kp(F[fe],hr),_r=Kp(F[Pe],hr),Sr=Tr,Br=kt-W[J]-_r,Ft=kt/2-W[J]/2+Rt,br=cS(Sr,Ft,Br),Yt=!A.arrow&&Dy(h)!=null&&Ft!==br&&m.reference[J]/2-(Ft<Sr?Tr:_r)-W[J]/2<0,Er=Yt?Ft<Sr?Ft-Sr:Ft-Br:0;return{[K]:$[K]+Er,data:{[K]:br,centerOffset:Ft-br-Er,...Yt&&{alignmentOffset:Er}},reset:Yt}}}),Y4=function(r){return r===void 0&&(r={}),{name:"flip",options:r,async fn(t){var s,l;const{placement:h,middlewareData:m,rects:v,initialPlacement:i,platform:A,elements:P}=t,{mainAxis:D=!0,crossAxis:F=!0,fallbackPlacements:$,fallbackStrategy:K="bestFit",fallbackAxisSideDirection:J="none",flipAlignment:W=!0,...ie}=Tf(r,t);if((s=m.arrow)!=null&&s.alignmentOffset)return{};const fe=Ef(h),Pe=Jp(i),Fe=Ef(i)===i,ht=await(A.isRTL==null?void 0:A.isRTL(P.floating)),at=$||(Fe||!W?[i0(i)]:G4(i)),Dt=J!=="none";!$&&Dt&&at.push(...W4(i,W,J,ht));const kt=[i,...at],Rt=await Y_(t,ie),hr=[];let Tr=((l=m.flip)==null?void 0:l.overflows)||[];if(D&&hr.push(Rt[fe]),F){const Ft=H4(h,v,ht);hr.push(Rt[Ft[0]],Rt[Ft[1]])}if(Tr=[...Tr,{placement:h,overflows:hr}],!hr.every(Ft=>Ft<=0)){var _r,Sr;const Ft=(((_r=m.flip)==null?void 0:_r.index)||0)+1,br=kt[Ft];if(br)return{data:{index:Ft,overflows:Tr},reset:{placement:br}};let Yt=(Sr=Tr.filter(Er=>Er.overflows[0]<=0).sort((Er,gt)=>Er.overflows[1]-gt.overflows[1])[0])==null?void 0:Sr.placement;if(!Yt)switch(K){case"bestFit":{var Br;const Er=(Br=Tr.filter(gt=>{if(Dt){const Jt=Jp(gt.placement);return Jt===Pe||Jt==="y"}return!0}).map(gt=>[gt.placement,gt.overflows.filter(Jt=>Jt>0).reduce((Jt,Ht)=>Jt+Ht,0)]).sort((gt,Jt)=>gt[1]-Jt[1])[0])==null?void 0:Br[0];Er&&(Yt=Er);break}case"initialPlacement":Yt=i;break}if(h!==Yt)return{reset:{placement:Yt}}}return{}}}};function EI(r,t){return{top:r.top-t.height,right:r.right-t.width,bottom:r.bottom-t.height,left:r.left-t.width}}function CI(r){return V4.some(t=>r[t]>=0)}const J4=function(r){return r===void 0&&(r={}),{name:"hide",options:r,async fn(t){const{rects:s}=t,{strategy:l="referenceHidden",...h}=Tf(r,t);switch(l){case"referenceHidden":{const m=await Y_(t,{...h,elementContext:"reference"}),v=EI(m,s.reference);return{data:{referenceHiddenOffsets:v,referenceHidden:CI(v)}}}case"escaped":{const m=await Y_(t,{...h,altBoundary:!0}),v=EI(m,s.floating);return{data:{escapedOffsets:v,escaped:CI(v)}}}default:return{}}}}};async function Q4(r,t){const{placement:s,platform:l,elements:h}=r,m=await(l.isRTL==null?void 0:l.isRTL(h.floating)),v=Ef(s),i=Dy(s),A=Jp(s)==="y",P=["left","top"].includes(v)?-1:1,D=m&&A?-1:1,F=Tf(t,r);let{mainAxis:$,crossAxis:K,alignmentAxis:J}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return i&&typeof J=="number"&&(K=i==="end"?J*-1:J),A?{x:K*D,y:$*P}:{x:$*P,y:K*D}}const e5=function(r){return r===void 0&&(r=0),{name:"offset",options:r,async fn(t){var s,l;const{x:h,y:m,placement:v,middlewareData:i}=t,A=await Q4(t,r);return v===((s=i.offset)==null?void 0:s.placement)&&(l=i.arrow)!=null&&l.alignmentOffset?{}:{x:h+A.x,y:m+A.y,data:{...A,placement:v}}}}},t5=function(r){return r===void 0&&(r={}),{name:"shift",options:r,async fn(t){const{x:s,y:l,placement:h}=t,{mainAxis:m=!0,crossAxis:v=!1,limiter:i={fn:ie=>{let{x:fe,y:Pe}=ie;return{x:fe,y:Pe}}},...A}=Tf(r,t),P={x:s,y:l},D=await Y_(t,A),F=Jp(Ef(h)),$=hT(F);let K=P[$],J=P[F];if(m){const ie=$==="y"?"top":"left",fe=$==="y"?"bottom":"right",Pe=K+D[ie],Fe=K-D[fe];K=cS(Pe,K,Fe)}if(v){const ie=F==="y"?"top":"left",fe=F==="y"?"bottom":"right",Pe=J+D[ie],Fe=J-D[fe];J=cS(Pe,J,Fe)}const W=i.fn({...t,[$]:K,[F]:J});return{...W,data:{x:W.x-s,y:W.y-l,enabled:{[$]:m,[F]:v}}}}}},r5=function(r){return r===void 0&&(r={}),{options:r,fn(t){const{x:s,y:l,placement:h,rects:m,middlewareData:v}=t,{offset:i=0,mainAxis:A=!0,crossAxis:P=!0}=Tf(r,t),D={x:s,y:l},F=Jp(h),$=hT(F);let K=D[$],J=D[F];const W=Tf(i,t),ie=typeof W=="number"?{mainAxis:W,crossAxis:0}:{mainAxis:0,crossAxis:0,...W};if(A){const Fe=$==="y"?"height":"width",ht=m.reference[$]-m.floating[Fe]+ie.mainAxis,at=m.reference[$]+m.reference[Fe]-ie.mainAxis;K<ht?K=ht:K>at&&(K=at)}if(P){var fe,Pe;const Fe=$==="y"?"width":"height",ht=["top","left"].includes(Ef(h)),at=m.reference[F]-m.floating[Fe]+(ht&&((fe=v.offset)==null?void 0:fe[F])||0)+(ht?0:ie.crossAxis),Dt=m.reference[F]+m.reference[Fe]+(ht?0:((Pe=v.offset)==null?void 0:Pe[F])||0)-(ht?ie.crossAxis:0);J<at?J=at:J>Dt&&(J=Dt)}return{[$]:K,[F]:J}}}},n5=function(r){return r===void 0&&(r={}),{name:"size",options:r,async fn(t){var s,l;const{placement:h,rects:m,platform:v,elements:i}=t,{apply:A=()=>{},...P}=Tf(r,t),D=await Y_(t,P),F=Ef(h),$=Dy(h),K=Jp(h)==="y",{width:J,height:W}=m.floating;let ie,fe;F==="top"||F==="bottom"?(ie=F,fe=$===(await(v.isRTL==null?void 0:v.isRTL(i.floating))?"start":"end")?"left":"right"):(fe=F,ie=$==="end"?"top":"bottom");const Pe=W-D.top-D.bottom,Fe=J-D.left-D.right,ht=Kp(W-D[ie],Pe),at=Kp(J-D[fe],Fe),Dt=!t.middlewareData.shift;let kt=ht,Rt=at;if((s=t.middlewareData.shift)!=null&&s.enabled.x&&(Rt=Fe),(l=t.middlewareData.shift)!=null&&l.enabled.y&&(kt=Pe),Dt&&!$){const Tr=Ec(D.left,0),_r=Ec(D.right,0),Sr=Ec(D.top,0),Br=Ec(D.bottom,0);K?Rt=J-2*(Tr!==0||_r!==0?Tr+_r:Ec(D.left,D.right)):kt=W-2*(Sr!==0||Br!==0?Sr+Br:Ec(D.top,D.bottom))}await A({...t,availableWidth:Rt,availableHeight:kt});const hr=await v.getDimensions(i.floating);return J!==hr.width||W!==hr.height?{reset:{rects:!0}}:{}}}};function m1(){return typeof window<"u"}function Oy(r){return CP(r)?(r.nodeName||"").toLowerCase():"#document"}function Ac(r){var t;return(r==null||(t=r.ownerDocument)==null?void 0:t.defaultView)||window}function vd(r){var t;return(t=(CP(r)?r.ownerDocument:r.document)||window.document)==null?void 0:t.documentElement}function CP(r){return m1()?r instanceof Node||r instanceof Ac(r).Node:!1}function dh(r){return m1()?r instanceof Element||r instanceof Ac(r).Element:!1}function md(r){return m1()?r instanceof HTMLElement||r instanceof Ac(r).HTMLElement:!1}function AI(r){return!m1()||typeof ShadowRoot>"u"?!1:r instanceof ShadowRoot||r instanceof Ac(r).ShadowRoot}function yx(r){const{overflow:t,overflowX:s,overflowY:l,display:h}=fh(r);return/auto|scroll|overlay|hidden|clip/.test(t+l+s)&&!["inline","contents"].includes(h)}function i5(r){return["table","td","th"].includes(Oy(r))}function g1(r){return[":popover-open",":modal"].some(t=>{try{return r.matches(t)}catch{return!1}})}function pT(r){const t=mT(),s=dh(r)?fh(r):r;return s.transform!=="none"||s.perspective!=="none"||(s.containerType?s.containerType!=="normal":!1)||!t&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!t&&(s.filter?s.filter!=="none":!1)||["transform","perspective","filter"].some(l=>(s.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(s.contain||"").includes(l))}function s5(r){let t=Qp(r);for(;md(t)&&!by(t);){if(pT(t))return t;if(g1(t))return null;t=Qp(t)}return null}function mT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function by(r){return["html","body","#document"].includes(Oy(r))}function fh(r){return Ac(r).getComputedStyle(r)}function y1(r){return dh(r)?{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}:{scrollLeft:r.scrollX,scrollTop:r.scrollY}}function Qp(r){if(Oy(r)==="html")return r;const t=r.assignedSlot||r.parentNode||AI(r)&&r.host||vd(r);return AI(t)?t.host:t}function AP(r){const t=Qp(r);return by(t)?r.ownerDocument?r.ownerDocument.body:r.body:md(t)&&yx(t)?t:AP(t)}function J_(r,t,s){var l;t===void 0&&(t=[]),s===void 0&&(s=!0);const h=AP(r),m=h===((l=r.ownerDocument)==null?void 0:l.body),v=Ac(h);if(m){const i=hS(v);return t.concat(v,v.visualViewport||[],yx(h)?h:[],i&&s?J_(i):[])}return t.concat(h,J_(h,[],s))}function hS(r){return r.parent&&Object.getPrototypeOf(r.parent)?r.frameElement:null}function IP(r){const t=fh(r);let s=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const h=md(r),m=h?r.offsetWidth:s,v=h?r.offsetHeight:l,i=n0(s)!==m||n0(l)!==v;return i&&(s=m,l=v),{width:s,height:l,$:i}}function gT(r){return dh(r)?r:r.contextElement}function my(r){const t=gT(r);if(!md(t))return Yp(1);const s=t.getBoundingClientRect(),{width:l,height:h,$:m}=IP(t);let v=(m?n0(s.width):s.width)/l,i=(m?n0(s.height):s.height)/h;return(!v||!Number.isFinite(v))&&(v=1),(!i||!Number.isFinite(i))&&(i=1),{x:v,y:i}}const o5=Yp(0);function MP(r){const t=Ac(r);return!mT()||!t.visualViewport?o5:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function a5(r,t,s){return t===void 0&&(t=!1),!s||t&&s!==Ac(r)?!1:t}function dg(r,t,s,l){t===void 0&&(t=!1),s===void 0&&(s=!1);const h=r.getBoundingClientRect(),m=gT(r);let v=Yp(1);t&&(l?dh(l)&&(v=my(l)):v=my(r));const i=a5(m,s,l)?MP(m):Yp(0);let A=(h.left+i.x)/v.x,P=(h.top+i.y)/v.y,D=h.width/v.x,F=h.height/v.y;if(m){const $=Ac(m),K=l&&dh(l)?Ac(l):l;let J=$,W=hS(J);for(;W&&l&&K!==J;){const ie=my(W),fe=W.getBoundingClientRect(),Pe=fh(W),Fe=fe.left+(W.clientLeft+parseFloat(Pe.paddingLeft))*ie.x,ht=fe.top+(W.clientTop+parseFloat(Pe.paddingTop))*ie.y;A*=ie.x,P*=ie.y,D*=ie.x,F*=ie.y,A+=Fe,P+=ht,J=Ac(W),W=hS(J)}}return s0({width:D,height:F,x:A,y:P})}function l5(r){let{elements:t,rect:s,offsetParent:l,strategy:h}=r;const m=h==="fixed",v=vd(l),i=t?g1(t.floating):!1;if(l===v||i&&m)return s;let A={scrollLeft:0,scrollTop:0},P=Yp(1);const D=Yp(0),F=md(l);if((F||!F&&!m)&&((Oy(l)!=="body"||yx(v))&&(A=y1(l)),md(l))){const $=dg(l);P=my(l),D.x=$.x+l.clientLeft,D.y=$.y+l.clientTop}return{width:s.width*P.x,height:s.height*P.y,x:s.x*P.x-A.scrollLeft*P.x+D.x,y:s.y*P.y-A.scrollTop*P.y+D.y}}function c5(r){return Array.from(r.getClientRects())}function dS(r,t){const s=y1(r).scrollLeft;return t?t.left+s:dg(vd(r)).left+s}function u5(r){const t=vd(r),s=y1(r),l=r.ownerDocument.body,h=Ec(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),m=Ec(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let v=-s.scrollLeft+dS(r);const i=-s.scrollTop;return fh(l).direction==="rtl"&&(v+=Ec(t.clientWidth,l.clientWidth)-h),{width:h,height:m,x:v,y:i}}function h5(r,t){const s=Ac(r),l=vd(r),h=s.visualViewport;let m=l.clientWidth,v=l.clientHeight,i=0,A=0;if(h){m=h.width,v=h.height;const P=mT();(!P||P&&t==="fixed")&&(i=h.offsetLeft,A=h.offsetTop)}return{width:m,height:v,x:i,y:A}}function d5(r,t){const s=dg(r,!0,t==="fixed"),l=s.top+r.clientTop,h=s.left+r.clientLeft,m=md(r)?my(r):Yp(1),v=r.clientWidth*m.x,i=r.clientHeight*m.y,A=h*m.x,P=l*m.y;return{width:v,height:i,x:A,y:P}}function II(r,t,s){let l;if(t==="viewport")l=h5(r,s);else if(t==="document")l=u5(vd(r));else if(dh(t))l=d5(t,s);else{const h=MP(r);l={...t,x:t.x-h.x,y:t.y-h.y}}return s0(l)}function kP(r,t){const s=Qp(r);return s===t||!dh(s)||by(s)?!1:fh(s).position==="fixed"||kP(s,t)}function f5(r,t){const s=t.get(r);if(s)return s;let l=J_(r,[],!1).filter(i=>dh(i)&&Oy(i)!=="body"),h=null;const m=fh(r).position==="fixed";let v=m?Qp(r):r;for(;dh(v)&&!by(v);){const i=fh(v),A=pT(v);!A&&i.position==="fixed"&&(h=null),(m?!A&&!h:!A&&i.position==="static"&&!!h&&["absolute","fixed"].includes(h.position)||yx(v)&&!A&&kP(r,v))?l=l.filter(D=>D!==v):h=i,v=Qp(v)}return t.set(r,l),l}function p5(r){let{element:t,boundary:s,rootBoundary:l,strategy:h}=r;const v=[...s==="clippingAncestors"?g1(t)?[]:f5(t,this._c):[].concat(s),l],i=v[0],A=v.reduce((P,D)=>{const F=II(t,D,h);return P.top=Ec(F.top,P.top),P.right=Kp(F.right,P.right),P.bottom=Kp(F.bottom,P.bottom),P.left=Ec(F.left,P.left),P},II(t,i,h));return{width:A.right-A.left,height:A.bottom-A.top,x:A.left,y:A.top}}function m5(r){const{width:t,height:s}=IP(r);return{width:t,height:s}}function g5(r,t,s){const l=md(t),h=vd(t),m=s==="fixed",v=dg(r,!0,m,t);let i={scrollLeft:0,scrollTop:0};const A=Yp(0);if(l||!l&&!m)if((Oy(t)!=="body"||yx(h))&&(i=y1(t)),l){const K=dg(t,!0,m,t);A.x=K.x+t.clientLeft,A.y=K.y+t.clientTop}else h&&(A.x=dS(h));let P=0,D=0;if(h&&!l&&!m){const K=h.getBoundingClientRect();D=K.top+i.scrollTop,P=K.left+i.scrollLeft-dS(h,K)}const F=v.left+i.scrollLeft-A.x-P,$=v.top+i.scrollTop-A.y-D;return{x:F,y:$,width:v.width,height:v.height}}function uw(r){return fh(r).position==="static"}function MI(r,t){if(!md(r)||fh(r).position==="fixed")return null;if(t)return t(r);let s=r.offsetParent;return vd(r)===s&&(s=s.ownerDocument.body),s}function PP(r,t){const s=Ac(r);if(g1(r))return s;if(!md(r)){let h=Qp(r);for(;h&&!by(h);){if(dh(h)&&!uw(h))return h;h=Qp(h)}return s}let l=MI(r,t);for(;l&&i5(l)&&uw(l);)l=MI(l,t);return l&&by(l)&&uw(l)&&!pT(l)?s:l||s5(r)||s}const y5=async function(r){const t=this.getOffsetParent||PP,s=this.getDimensions,l=await s(r.floating);return{reference:g5(r.reference,await t(r.floating),r.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function _5(r){return fh(r).direction==="rtl"}const x5={convertOffsetParentRelativeRectToViewportRelativeRect:l5,getDocumentElement:vd,getClippingRect:p5,getOffsetParent:PP,getElementRects:y5,getClientRects:c5,getDimensions:m5,getScale:my,isElement:dh,isRTL:_5};function v5(r,t){let s=null,l;const h=vd(r);function m(){var i;clearTimeout(l),(i=s)==null||i.disconnect(),s=null}function v(i,A){i===void 0&&(i=!1),A===void 0&&(A=1),m();const{left:P,top:D,width:F,height:$}=r.getBoundingClientRect();if(i||t(),!F||!$)return;const K=_v(D),J=_v(h.clientWidth-(P+F)),W=_v(h.clientHeight-(D+$)),ie=_v(P),Pe={rootMargin:-K+"px "+-J+"px "+-W+"px "+-ie+"px",threshold:Ec(0,Kp(1,A))||1};let Fe=!0;function ht(at){const Dt=at[0].intersectionRatio;if(Dt!==A){if(!Fe)return v();Dt?v(!1,Dt):l=setTimeout(()=>{v(!1,1e-7)},1e3)}Fe=!1}try{s=new IntersectionObserver(ht,{...Pe,root:h.ownerDocument})}catch{s=new IntersectionObserver(ht,Pe)}s.observe(r)}return v(!0),m}function b5(r,t,s,l){l===void 0&&(l={});const{ancestorScroll:h=!0,ancestorResize:m=!0,elementResize:v=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:A=!1}=l,P=gT(r),D=h||m?[...P?J_(P):[],...J_(t)]:[];D.forEach(fe=>{h&&fe.addEventListener("scroll",s,{passive:!0}),m&&fe.addEventListener("resize",s)});const F=P&&i?v5(P,s):null;let $=-1,K=null;v&&(K=new ResizeObserver(fe=>{let[Pe]=fe;Pe&&Pe.target===P&&K&&(K.unobserve(t),cancelAnimationFrame($),$=requestAnimationFrame(()=>{var Fe;(Fe=K)==null||Fe.observe(t)})),s()}),P&&!A&&K.observe(P),K.observe(t));let J,W=A?dg(r):null;A&&ie();function ie(){const fe=dg(r);W&&(fe.x!==W.x||fe.y!==W.y||fe.width!==W.width||fe.height!==W.height)&&s(),W=fe,J=requestAnimationFrame(ie)}return s(),()=>{var fe;D.forEach(Pe=>{h&&Pe.removeEventListener("scroll",s),m&&Pe.removeEventListener("resize",s)}),F?.(),(fe=K)==null||fe.disconnect(),K=null,A&&cancelAnimationFrame(J)}}const w5=e5,S5=t5,T5=Y4,E5=n5,C5=J4,kI=K4,A5=r5,I5=(r,t,s)=>{const l=new Map,h={platform:x5,...s},m={...h.platform,_c:l};return X4(r,t,{...h,platform:m})};var jv=typeof document<"u"?ee.useLayoutEffect:ee.useEffect;function o0(r,t){if(r===t)return!0;if(typeof r!=typeof t)return!1;if(typeof r=="function"&&r.toString()===t.toString())return!0;let s,l,h;if(r&&t&&typeof r=="object"){if(Array.isArray(r)){if(s=r.length,s!==t.length)return!1;for(l=s;l--!==0;)if(!o0(r[l],t[l]))return!1;return!0}if(h=Object.keys(r),s=h.length,s!==Object.keys(t).length)return!1;for(l=s;l--!==0;)if(!{}.hasOwnProperty.call(t,h[l]))return!1;for(l=s;l--!==0;){const m=h[l];if(!(m==="_owner"&&r.$$typeof)&&!o0(r[m],t[m]))return!1}return!0}return r!==r&&t!==t}function RP(r){return typeof window>"u"?1:(r.ownerDocument.defaultView||window).devicePixelRatio||1}function PI(r,t){const s=RP(r);return Math.round(t*s)/s}function hw(r){const t=ee.useRef(r);return jv(()=>{t.current=r}),t}function M5(r){r===void 0&&(r={});const{placement:t="bottom",strategy:s="absolute",middleware:l=[],platform:h,elements:{reference:m,floating:v}={},transform:i=!0,whileElementsMounted:A,open:P}=r,[D,F]=ee.useState({x:0,y:0,strategy:s,placement:t,middlewareData:{},isPositioned:!1}),[$,K]=ee.useState(l);o0($,l)||K(l);const[J,W]=ee.useState(null),[ie,fe]=ee.useState(null),Pe=ee.useCallback(gt=>{gt!==Dt.current&&(Dt.current=gt,W(gt))},[]),Fe=ee.useCallback(gt=>{gt!==kt.current&&(kt.current=gt,fe(gt))},[]),ht=m||J,at=v||ie,Dt=ee.useRef(null),kt=ee.useRef(null),Rt=ee.useRef(D),hr=A!=null,Tr=hw(A),_r=hw(h),Sr=hw(P),Br=ee.useCallback(()=>{if(!Dt.current||!kt.current)return;const gt={placement:t,strategy:s,middleware:$};_r.current&&(gt.platform=_r.current),I5(Dt.current,kt.current,gt).then(Jt=>{const Ht={...Jt,isPositioned:Sr.current!==!1};Ft.current&&!o0(Rt.current,Ht)&&(Rt.current=Ht,Py.flushSync(()=>{F(Ht)}))})},[$,t,s,_r,Sr]);jv(()=>{P===!1&&Rt.current.isPositioned&&(Rt.current.isPositioned=!1,F(gt=>({...gt,isPositioned:!1})))},[P]);const Ft=ee.useRef(!1);jv(()=>(Ft.current=!0,()=>{Ft.current=!1}),[]),jv(()=>{if(ht&&(Dt.current=ht),at&&(kt.current=at),ht&&at){if(Tr.current)return Tr.current(ht,at,Br);Br()}},[ht,at,Br,Tr,hr]);const br=ee.useMemo(()=>({reference:Dt,floating:kt,setReference:Pe,setFloating:Fe}),[Pe,Fe]),Yt=ee.useMemo(()=>({reference:ht,floating:at}),[ht,at]),Er=ee.useMemo(()=>{const gt={position:s,left:0,top:0};if(!Yt.floating)return gt;const Jt=PI(Yt.floating,D.x),Ht=PI(Yt.floating,D.y);return i?{...gt,transform:"translate("+Jt+"px, "+Ht+"px)",...RP(Yt.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:Jt,top:Ht}},[s,i,Yt.floating,D.x,D.y]);return ee.useMemo(()=>({...D,update:Br,refs:br,elements:Yt,floatingStyles:Er}),[D,Br,br,Yt,Er])}const k5=r=>{function t(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:r,fn(s){const{element:l,padding:h}=typeof r=="function"?r(s):r;return l&&t(l)?l.current!=null?kI({element:l.current,padding:h}).fn(s):{}:l?kI({element:l,padding:h}).fn(s):{}}}},P5=(r,t)=>({...w5(r),options:[r,t]}),R5=(r,t)=>({...S5(r),options:[r,t]}),N5=(r,t)=>({...A5(r),options:[r,t]}),D5=(r,t)=>({...T5(r),options:[r,t]}),O5=(r,t)=>({...E5(r),options:[r,t]}),L5=(r,t)=>({...C5(r),options:[r,t]}),z5=(r,t)=>({...k5(r),options:[r,t]});var j5="Arrow",NP=ee.forwardRef((r,t)=>{const{children:s,width:l=10,height:h=5,...m}=r;return b.jsx(vi.svg,{...m,ref:t,width:l,height:h,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:r.asChild?s:b.jsx("polygon",{points:"0,0 30,0 15,10"})})});NP.displayName=j5;var F5=NP;function B5(r,t=[]){let s=[];function l(m,v){const i=ee.createContext(v),A=s.length;s=[...s,v];function P(F){const{scope:$,children:K,...J}=F,W=$?.[r][A]||i,ie=ee.useMemo(()=>J,Object.values(J));return b.jsx(W.Provider,{value:ie,children:K})}function D(F,$){const K=$?.[r][A]||i,J=ee.useContext(K);if(J)return J;if(v!==void 0)return v;throw new Error(`\`${F}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(v=>ee.createContext(v));return function(i){const A=i?.[r]||m;return ee.useMemo(()=>({[`__scope${r}`]:{...i,[r]:A}}),[i,A])}};return h.scopeName=r,[l,V5(h,...t)]}function V5(...r){const t=r[0];if(r.length===1)return t;const s=()=>{const l=r.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const v=l.reduce((i,{useScope:A,scopeName:P})=>{const F=A(m)[`__scope${P}`];return{...i,...F}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return s.scopeName=t.scopeName,s}function DP(r){const[t,s]=ee.useState(void 0);return sl(()=>{if(r){s({width:r.offsetWidth,height:r.offsetHeight});const l=new ResizeObserver(h=>{if(!Array.isArray(h)||!h.length)return;const m=h[0];let v,i;if("borderBoxSize"in m){const A=m.borderBoxSize,P=Array.isArray(A)?A[0]:A;v=P.inlineSize,i=P.blockSize}else v=r.offsetWidth,i=r.offsetHeight;s({width:v,height:i})});return l.observe(r,{box:"border-box"}),()=>l.unobserve(r)}else s(void 0)},[r]),t}var yT="Popper",[OP,_1]=B5(yT),[U5,LP]=OP(yT),zP=r=>{const{__scopePopper:t,children:s}=r,[l,h]=ee.useState(null);return b.jsx(U5,{scope:t,anchor:l,onAnchorChange:h,children:s})};zP.displayName=yT;var jP="PopperAnchor",FP=ee.forwardRef((r,t)=>{const{__scopePopper:s,virtualRef:l,...h}=r,m=LP(jP,s),v=ee.useRef(null),i=xs(t,v);return ee.useEffect(()=>{m.onAnchorChange(l?.current||v.current)}),l?null:b.jsx(vi.div,{...h,ref:i})});FP.displayName=jP;var _T="PopperContent",[$5,H5]=OP(_T),BP=ee.forwardRef((r,t)=>{const{__scopePopper:s,side:l="bottom",sideOffset:h=0,align:m="center",alignOffset:v=0,arrowPadding:i=0,avoidCollisions:A=!0,collisionBoundary:P=[],collisionPadding:D=0,sticky:F="partial",hideWhenDetached:$=!1,updatePositionStrategy:K="optimized",onPlaced:J,...W}=r,ie=LP(_T,s),[fe,Pe]=ee.useState(null),Fe=xs(t,lr=>Pe(lr)),[ht,at]=ee.useState(null),Dt=DP(ht),kt=Dt?.width??0,Rt=Dt?.height??0,hr=l+(m!=="center"?"-"+m:""),Tr=typeof D=="number"?D:{top:0,right:0,bottom:0,left:0,...D},_r=Array.isArray(P)?P:[P],Sr=_r.length>0,Br={padding:Tr,boundary:_r.filter(q5),altBoundary:Sr},{refs:Ft,floatingStyles:br,placement:Yt,isPositioned:Er,middlewareData:gt}=M5({strategy:"fixed",placement:hr,whileElementsMounted:(...lr)=>b5(...lr,{animationFrame:K==="always"}),elements:{reference:ie.anchor},middleware:[P5({mainAxis:h+Rt,alignmentAxis:v}),A&&R5({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?N5():void 0,...Br}),A&&D5({...Br}),O5({...Br,apply:({elements:lr,rects:$r,availableWidth:Cr,availableHeight:Fr})=>{const{width:Zn,height:ri}=$r.reference,On=lr.floating.style;On.setProperty("--radix-popper-available-width",`${Cr}px`),On.setProperty("--radix-popper-available-height",`${Fr}px`),On.setProperty("--radix-popper-anchor-width",`${Zn}px`),On.setProperty("--radix-popper-anchor-height",`${ri}px`)}}),ht&&z5({element:ht,padding:i}),W5({arrowWidth:kt,arrowHeight:Rt}),$&&L5({strategy:"referenceHidden",...Br})]}),[Jt,Ht]=$P(Yt),qe=Jl(J);sl(()=>{Er&&qe?.()},[Er,qe]);const Ct=gt.arrow?.x,kr=gt.arrow?.y,Zr=gt.arrow?.centerOffset!==0,[Rr,ar]=ee.useState();return sl(()=>{fe&&ar(window.getComputedStyle(fe).zIndex)},[fe]),b.jsx("div",{ref:Ft.setFloating,"data-radix-popper-content-wrapper":"",style:{...br,transform:Er?br.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Rr,"--radix-popper-transform-origin":[gt.transformOrigin?.x,gt.transformOrigin?.y].join(" "),...gt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:r.dir,children:b.jsx($5,{scope:s,placedSide:Jt,onArrowChange:at,arrowX:Ct,arrowY:kr,shouldHideArrow:Zr,children:b.jsx(vi.div,{"data-side":Jt,"data-align":Ht,...W,ref:Fe,style:{...W.style,animation:Er?void 0:"none"}})})})});BP.displayName=_T;var VP="PopperArrow",G5={top:"bottom",right:"left",bottom:"top",left:"right"},UP=ee.forwardRef(function(t,s){const{__scopePopper:l,...h}=t,m=H5(VP,l),v=G5[m.placedSide];return b.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[v]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:b.jsx(F5,{...h,ref:s,style:{...h.style,display:"block"}})})});UP.displayName=VP;function q5(r){return r!==null}var W5=r=>({name:"transformOrigin",options:r,fn(t){const{placement:s,rects:l,middlewareData:h}=t,v=h.arrow?.centerOffset!==0,i=v?0:r.arrowWidth,A=v?0:r.arrowHeight,[P,D]=$P(s),F={start:"0%",center:"50%",end:"100%"}[D],$=(h.arrow?.x??0)+i/2,K=(h.arrow?.y??0)+A/2;let J="",W="";return P==="bottom"?(J=v?F:`${$}px`,W=`${-A}px`):P==="top"?(J=v?F:`${$}px`,W=`${l.floating.height+A}px`):P==="right"?(J=`${-A}px`,W=v?F:`${K}px`):P==="left"&&(J=`${l.floating.width+A}px`,W=v?F:`${K}px`),{data:{x:J,y:W}}}});function $P(r){const[t,s="center"]=r.split("-");return[t,s]}var Z5=zP,HP=FP,GP=BP,qP=UP,[x1,uX]=Ry("Tooltip",[_1]),xT=_1(),WP="TooltipProvider",X5=700,RI="tooltip.open",[K5,ZP]=x1(WP),XP=r=>{const{__scopeTooltip:t,delayDuration:s=X5,skipDelayDuration:l=300,disableHoverableContent:h=!1,children:m}=r,[v,i]=ee.useState(!0),A=ee.useRef(!1),P=ee.useRef(0);return ee.useEffect(()=>{const D=P.current;return()=>window.clearTimeout(D)},[]),b.jsx(K5,{scope:t,isOpenDelayed:v,delayDuration:s,onOpen:ee.useCallback(()=>{window.clearTimeout(P.current),i(!1)},[]),onClose:ee.useCallback(()=>{window.clearTimeout(P.current),P.current=window.setTimeout(()=>i(!0),l)},[l]),isPointerInTransitRef:A,onPointerInTransitChange:ee.useCallback(D=>{A.current=D},[]),disableHoverableContent:h,children:m})};XP.displayName=WP;var KP="Tooltip",[hX,v1]=x1(KP),fS="TooltipTrigger",Y5=ee.forwardRef((r,t)=>{const{__scopeTooltip:s,...l}=r,h=v1(fS,s),m=ZP(fS,s),v=xT(s),i=ee.useRef(null),A=xs(t,i,h.onTriggerChange),P=ee.useRef(!1),D=ee.useRef(!1),F=ee.useCallback(()=>P.current=!1,[]);return ee.useEffect(()=>()=>document.removeEventListener("pointerup",F),[F]),b.jsx(HP,{asChild:!0,...v,children:b.jsx(vi.button,{"aria-describedby":h.open?h.contentId:void 0,"data-state":h.stateAttribute,...l,ref:A,onPointerMove:jn(r.onPointerMove,$=>{$.pointerType!=="touch"&&!D.current&&!m.isPointerInTransitRef.current&&(h.onTriggerEnter(),D.current=!0)}),onPointerLeave:jn(r.onPointerLeave,()=>{h.onTriggerLeave(),D.current=!1}),onPointerDown:jn(r.onPointerDown,()=>{P.current=!0,document.addEventListener("pointerup",F,{once:!0})}),onFocus:jn(r.onFocus,()=>{P.current||h.onOpen()}),onBlur:jn(r.onBlur,h.onClose),onClick:jn(r.onClick,h.onClose)})})});Y5.displayName=fS;var J5="TooltipPortal",[dX,Q5]=x1(J5,{forceMount:void 0}),wy="TooltipContent",YP=ee.forwardRef((r,t)=>{const s=Q5(wy,r.__scopeTooltip),{forceMount:l=s.forceMount,side:h="top",...m}=r,v=v1(wy,r.__scopeTooltip);return b.jsx(wg,{present:l||v.open,children:v.disableHoverableContent?b.jsx(JP,{side:h,...m,ref:t}):b.jsx(eV,{side:h,...m,ref:t})})}),eV=ee.forwardRef((r,t)=>{const s=v1(wy,r.__scopeTooltip),l=ZP(wy,r.__scopeTooltip),h=ee.useRef(null),m=xs(t,h),[v,i]=ee.useState(null),{trigger:A,onClose:P}=s,D=h.current,{onPointerInTransitChange:F}=l,$=ee.useCallback(()=>{i(null),F(!1)},[F]),K=ee.useCallback((J,W)=>{const ie=J.currentTarget,fe={x:J.clientX,y:J.clientY},Pe=iV(fe,ie.getBoundingClientRect()),Fe=sV(fe,Pe),ht=oV(W.getBoundingClientRect()),at=lV([...Fe,...ht]);i(at),F(!0)},[F]);return ee.useEffect(()=>()=>$(),[$]),ee.useEffect(()=>{if(A&&D){const J=ie=>K(ie,D),W=ie=>K(ie,A);return A.addEventListener("pointerleave",J),D.addEventListener("pointerleave",W),()=>{A.removeEventListener("pointerleave",J),D.removeEventListener("pointerleave",W)}}},[A,D,K,$]),ee.useEffect(()=>{if(v){const J=W=>{const ie=W.target,fe={x:W.clientX,y:W.clientY},Pe=A?.contains(ie)||D?.contains(ie),Fe=!aV(fe,v);Pe?$():Fe&&($(),P())};return document.addEventListener("pointermove",J),()=>document.removeEventListener("pointermove",J)}},[A,D,v,P,$]),b.jsx(JP,{...r,ref:m})}),[tV,rV]=x1(KP,{isInside:!1}),JP=ee.forwardRef((r,t)=>{const{__scopeTooltip:s,children:l,"aria-label":h,onEscapeKeyDown:m,onPointerDownOutside:v,...i}=r,A=v1(wy,s),P=xT(s),{onClose:D}=A;return ee.useEffect(()=>(document.addEventListener(RI,D),()=>document.removeEventListener(RI,D)),[D]),ee.useEffect(()=>{if(A.trigger){const F=$=>{$.target?.contains(A.trigger)&&D()};return window.addEventListener("scroll",F,{capture:!0}),()=>window.removeEventListener("scroll",F,{capture:!0})}},[A.trigger,D]),b.jsx(px,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:v,onFocusOutside:F=>F.preventDefault(),onDismiss:D,children:b.jsxs(GP,{"data-state":A.stateAttribute,...P,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[b.jsx(zk,{children:l}),b.jsx(tV,{scope:s,isInside:!0,children:b.jsx(jF,{id:A.contentId,role:"tooltip",children:h||l})})]})})});YP.displayName=wy;var QP="TooltipArrow",nV=ee.forwardRef((r,t)=>{const{__scopeTooltip:s,...l}=r,h=xT(s);return rV(QP,s).isInside?null:b.jsx(qP,{...h,...l,ref:t})});nV.displayName=QP;function iV(r,t){const s=Math.abs(t.top-r.y),l=Math.abs(t.bottom-r.y),h=Math.abs(t.right-r.x),m=Math.abs(t.left-r.x);switch(Math.min(s,l,h,m)){case m:return"left";case h:return"right";case s:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function sV(r,t,s=5){const l=[];switch(t){case"top":l.push({x:r.x-s,y:r.y+s},{x:r.x+s,y:r.y+s});break;case"bottom":l.push({x:r.x-s,y:r.y-s},{x:r.x+s,y:r.y-s});break;case"left":l.push({x:r.x+s,y:r.y-s},{x:r.x+s,y:r.y+s});break;case"right":l.push({x:r.x-s,y:r.y-s},{x:r.x-s,y:r.y+s});break}return l}function oV(r){const{top:t,right:s,bottom:l,left:h}=r;return[{x:h,y:t},{x:s,y:t},{x:s,y:l},{x:h,y:l}]}function aV(r,t){const{x:s,y:l}=r;let h=!1;for(let m=0,v=t.length-1;m<t.length;v=m++){const i=t[m].x,A=t[m].y,P=t[v].x,D=t[v].y;A>l!=D>l&&s<(P-i)*(l-A)/(D-A)+i&&(h=!h)}return h}function lV(r){const t=r.slice();return t.sort((s,l)=>s.x<l.x?-1:s.x>l.x?1:s.y<l.y?-1:s.y>l.y?1:0),cV(t)}function cV(r){if(r.length<=1)return r.slice();const t=[];for(let l=0;l<r.length;l++){const h=r[l];for(;t.length>=2;){const m=t[t.length-1],v=t[t.length-2];if((m.x-v.x)*(h.y-v.y)>=(m.y-v.y)*(h.x-v.x))t.pop();else break}t.push(h)}t.pop();const s=[];for(let l=r.length-1;l>=0;l--){const h=r[l];for(;s.length>=2;){const m=s[s.length-1],v=s[s.length-2];if((m.x-v.x)*(h.y-v.y)>=(m.y-v.y)*(h.x-v.x))s.pop();else break}s.push(h)}return s.pop(),t.length===1&&s.length===1&&t[0].x===s[0].x&&t[0].y===s[0].y?t:t.concat(s)}var uV=XP,eR=YP;const hV=uV,dV=ee.forwardRef(({className:r,sideOffset:t=4,...s},l)=>b.jsx(eR,{ref:l,sideOffset:t,className:ki("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s}));dV.displayName=eR.displayName;var Ly=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},fg=typeof window>"u"||"Deno"in globalThis;function fu(){}function fV(r,t){return typeof r=="function"?r(t):r}function pS(r){return typeof r=="number"&&r>=0&&r!==1/0}function tR(r,t){return Math.max(r+(t||0)-Date.now(),0)}function gy(r,t){return typeof r=="function"?r(t):r}function ch(r,t){return typeof r=="function"?r(t):r}function NI(r,t){const{type:s="all",exact:l,fetchStatus:h,predicate:m,queryKey:v,stale:i}=r;if(v){if(l){if(t.queryHash!==vT(v,t.options))return!1}else if(!Q_(t.queryKey,v))return!1}if(s!=="all"){const A=t.isActive();if(s==="active"&&!A||s==="inactive"&&A)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||h&&h!==t.state.fetchStatus||m&&!m(t))}function DI(r,t){const{exact:s,status:l,predicate:h,mutationKey:m}=r;if(m){if(!t.options.mutationKey)return!1;if(s){if(pg(t.options.mutationKey)!==pg(m))return!1}else if(!Q_(t.options.mutationKey,m))return!1}return!(l&&t.state.status!==l||h&&!h(t))}function vT(r,t){return(t?.queryKeyHashFn||pg)(r)}function pg(r){return JSON.stringify(r,(t,s)=>mS(s)?Object.keys(s).sort().reduce((l,h)=>(l[h]=s[h],l),{}):s)}function Q_(r,t){return r===t?!0:typeof r!=typeof t?!1:r&&t&&typeof r=="object"&&typeof t=="object"?!Object.keys(t).some(s=>!Q_(r[s],t[s])):!1}function rR(r,t){if(r===t)return r;const s=OI(r)&&OI(t);if(s||mS(r)&&mS(t)){const l=s?r:Object.keys(r),h=l.length,m=s?t:Object.keys(t),v=m.length,i=s?[]:{};let A=0;for(let P=0;P<v;P++){const D=s?P:m[P];(!s&&l.includes(D)||s)&&r[D]===void 0&&t[D]===void 0?(i[D]=void 0,A++):(i[D]=rR(r[D],t[D]),i[D]===r[D]&&r[D]!==void 0&&A++)}return h===v&&A===h?r:i}return t}function a0(r,t){if(!t||Object.keys(r).length!==Object.keys(t).length)return!1;for(const s in r)if(r[s]!==t[s])return!1;return!0}function OI(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function mS(r){if(!LI(r))return!1;const t=r.constructor;if(t===void 0)return!0;const s=t.prototype;return!(!LI(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function LI(r){return Object.prototype.toString.call(r)==="[object Object]"}function pV(r){return new Promise(t=>{setTimeout(t,r)})}function gS(r,t,s){return typeof s.structuralSharing=="function"?s.structuralSharing(r,t):s.structuralSharing!==!1?rR(r,t):t}function mV(r,t,s=0){const l=[...r,t];return s&&l.length>s?l.slice(1):l}function gV(r,t,s=0){const l=[t,...r];return s&&l.length>s?l.slice(0,-1):l}var bT=Symbol();function nR(r,t){return!r.queryFn&&t?.initialPromise?()=>t.initialPromise:!r.queryFn||r.queryFn===bT?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}var yV=class extends Ly{#e;#t;#n;constructor(){super(),this.#n=r=>{if(!fg&&window.addEventListener){const t=()=>r();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#n=r,this.#t?.(),this.#t=r(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(r){this.#e!==r&&(this.#e=r,this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(t=>{t(r)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},wT=new yV,_V=class extends Ly{#e=!0;#t;#n;constructor(){super(),this.#n=r=>{if(!fg&&window.addEventListener){const t=()=>r(!0),s=()=>r(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#n=r,this.#t?.(),this.#t=r(this.setOnline.bind(this))}setOnline(r){this.#e!==r&&(this.#e=r,this.listeners.forEach(s=>{s(r)}))}isOnline(){return this.#e}},l0=new _V;function yS(){let r,t;const s=new Promise((h,m)=>{r=h,t=m});s.status="pending",s.catch(()=>{});function l(h){Object.assign(s,h),delete s.resolve,delete s.reject}return s.resolve=h=>{l({status:"fulfilled",value:h}),r(h)},s.reject=h=>{l({status:"rejected",reason:h}),t(h)},s}function xV(r){return Math.min(1e3*2**r,3e4)}function iR(r){return(r??"online")==="online"?l0.isOnline():!0}var sR=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent}};function dw(r){return r instanceof sR}function oR(r){let t=!1,s=0,l=!1,h;const m=yS(),v=W=>{l||($(new sR(W)),r.abort?.())},i=()=>{t=!0},A=()=>{t=!1},P=()=>wT.isFocused()&&(r.networkMode==="always"||l0.isOnline())&&r.canRun(),D=()=>iR(r.networkMode)&&r.canRun(),F=W=>{l||(l=!0,r.onSuccess?.(W),h?.(),m.resolve(W))},$=W=>{l||(l=!0,r.onError?.(W),h?.(),m.reject(W))},K=()=>new Promise(W=>{h=ie=>{(l||P())&&W(ie)},r.onPause?.()}).then(()=>{h=void 0,l||r.onContinue?.()}),J=()=>{if(l)return;let W;const ie=s===0?r.initialPromise:void 0;try{W=ie??r.fn()}catch(fe){W=Promise.reject(fe)}Promise.resolve(W).then(F).catch(fe=>{if(l)return;const Pe=r.retry??(fg?0:3),Fe=r.retryDelay??xV,ht=typeof Fe=="function"?Fe(s,fe):Fe,at=Pe===!0||typeof Pe=="number"&&s<Pe||typeof Pe=="function"&&Pe(s,fe);if(t||!at){$(fe);return}s++,r.onFail?.(s,fe),pV(ht).then(()=>P()?void 0:K()).then(()=>{t?$(fe):J()})})};return{promise:m,cancel:v,continue:()=>(h?.(),m),cancelRetry:i,continueRetry:A,canStart:D,start:()=>(D()?J():K().then(J),m)}}function vV(){let r=[],t=0,s=i=>{i()},l=i=>{i()},h=i=>setTimeout(i,0);const m=i=>{t?r.push(i):h(()=>{s(i)})},v=()=>{const i=r;r=[],i.length&&h(()=>{l(()=>{i.forEach(A=>{s(A)})})})};return{batch:i=>{let A;t++;try{A=i()}finally{t--,t||v()}return A},batchCalls:i=>(...A)=>{m(()=>{i(...A)})},schedule:m,setNotifyFunction:i=>{s=i},setBatchNotifyFunction:i=>{l=i},setScheduler:i=>{h=i}}}var Jo=vV(),aR=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),pS(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(fg?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},bV=class extends aR{#e;#t;#n;#r;#o;#s;constructor(r){super(),this.#s=!1,this.#o=r.defaultOptions,this.setOptions(r.options),this.observers=[],this.#n=r.cache,this.queryKey=r.queryKey,this.queryHash=r.queryHash,this.#e=wV(this.options),this.state=r.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(r){this.options={...this.#o,...r},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(r,t){const s=gS(this.state.data,r,this.options);return this.#i({data:s,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),s}setState(r,t){this.#i({type:"setState",state:r,setStateOptions:t})}cancel(r){const t=this.#r?.promise;return this.#r?.cancel(r),t?t.then(fu).catch(fu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(r=>ch(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===bT||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(r=0){return this.state.isInvalidated||this.state.data===void 0||!tR(this.state.dataUpdatedAt,r)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(t=>t!==r),this.observers.length||(this.#r&&(this.#s?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}fetch(r,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(r&&this.setOptions(r),!this.options.queryFn){const i=this.observers.find(A=>A.options.queryFn);i&&this.setOptions(i.options)}const s=new AbortController,l=i=>{Object.defineProperty(i,"signal",{enumerable:!0,get:()=>(this.#s=!0,s.signal)})},h=()=>{const i=nR(this.options,t),A={queryKey:this.queryKey,meta:this.meta};return l(A),this.#s=!1,this.options.persister?this.options.persister(i,A,this):i(A)},m={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:h};l(m),this.options.behavior?.onFetch(m,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==m.fetchOptions?.meta)&&this.#i({type:"fetch",meta:m.fetchOptions?.meta});const v=i=>{dw(i)&&i.silent||this.#i({type:"error",error:i}),dw(i)||(this.#n.config.onError?.(i,this),this.#n.config.onSettled?.(this.state.data,i,this)),this.scheduleGc()};return this.#r=oR({initialPromise:t?.initialPromise,fn:m.fetchFn,abort:s.abort.bind(s),onSuccess:i=>{if(i===void 0){v(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(i)}catch(A){v(A);return}this.#n.config.onSuccess?.(i,this),this.#n.config.onSettled?.(i,this.state.error,this),this.scheduleGc()},onError:v,onFail:(i,A)=>{this.#i({type:"failed",failureCount:i,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:m.options.retry,retryDelay:m.options.retryDelay,networkMode:m.options.networkMode,canRun:()=>!0}),this.#r.start()}#i(r){const t=s=>{switch(r.type){case"failed":return{...s,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...lR(s.data,this.options),fetchMeta:r.meta??null};case"success":return{...s,data:r.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=r.error;return dw(l)&&l.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...s,error:l,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...r.state}}};this.state=t(this.state),Jo.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:r})})}};function lR(r,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:iR(t.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function wV(r){const t=typeof r.initialData=="function"?r.initialData():r.initialData,s=t!==void 0,l=s?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var SV=class extends Ly{constructor(r={}){super(),this.config=r,this.#e=new Map}#e;build(r,t,s){const l=t.queryKey,h=t.queryHash??vT(l,t);let m=this.get(h);return m||(m=new bV({cache:this,queryKey:l,queryHash:h,options:r.defaultQueryOptions(t),state:s,defaultOptions:r.getQueryDefaults(l)}),this.add(m)),m}add(r){this.#e.has(r.queryHash)||(this.#e.set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const t=this.#e.get(r.queryHash);t&&(r.destroy(),t===r&&this.#e.delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){Jo.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return this.#e.get(r)}getAll(){return[...this.#e.values()]}find(r){const t={exact:!0,...r};return this.getAll().find(s=>NI(t,s))}findAll(r={}){const t=this.getAll();return Object.keys(r).length>0?t.filter(s=>NI(r,s)):t}notify(r){Jo.batch(()=>{this.listeners.forEach(t=>{t(r)})})}onFocus(){Jo.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){Jo.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},TV=class extends aR{#e;#t;#n;constructor(r){super(),this.mutationId=r.mutationId,this.#t=r.mutationCache,this.#e=[],this.state=r.state||cR(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){this.#e.includes(r)||(this.#e.push(r),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){this.#e=this.#e.filter(t=>t!==r),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(r){this.#n=oR({fn:()=>this.options.mutationFn?this.options.mutationFn(r):Promise.reject(new Error("No mutationFn found")),onFail:(l,h)=>{this.#r({type:"failed",failureCount:l,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:()=>{this.#r({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const t=this.state.status==="pending",s=!this.#n.canStart();try{if(!t){this.#r({type:"pending",variables:r,isPaused:s}),await this.#t.config.onMutate?.(r,this);const h=await this.options.onMutate?.(r);h!==this.state.context&&this.#r({type:"pending",context:h,variables:r,isPaused:s})}const l=await this.#n.start();return await this.#t.config.onSuccess?.(l,r,this.state.context,this),await this.options.onSuccess?.(l,r,this.state.context),await this.#t.config.onSettled?.(l,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(l,null,r,this.state.context),this.#r({type:"success",data:l}),l}catch(l){try{throw await this.#t.config.onError?.(l,r,this.state.context,this),await this.options.onError?.(l,r,this.state.context),await this.#t.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,l,r,this.state.context),l}finally{this.#r({type:"error",error:l})}}finally{this.#t.runNext(this)}}#r(r){const t=s=>{switch(r.type){case"failed":return{...s,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...s,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:r.error,failureCount:s.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Jo.batch(()=>{this.#e.forEach(s=>{s.onMutationUpdate(r)}),this.#t.notify({mutation:this,type:"updated",action:r})})}};function cR(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var EV=class extends Ly{constructor(r={}){super(),this.config=r,this.#e=new Map,this.#t=Date.now()}#e;#t;build(r,t,s){const l=new TV({mutationCache:this,mutationId:++this.#t,options:r.defaultMutationOptions(t),state:s});return this.add(l),l}add(r){const t=xv(r),s=this.#e.get(t)??[];s.push(r),this.#e.set(t,s),this.notify({type:"added",mutation:r})}remove(r){const t=xv(r);if(this.#e.has(t)){const s=this.#e.get(t)?.filter(l=>l!==r);s&&(s.length===0?this.#e.delete(t):this.#e.set(t,s))}this.notify({type:"removed",mutation:r})}canRun(r){const t=this.#e.get(xv(r))?.find(s=>s.state.status==="pending");return!t||t===r}runNext(r){return this.#e.get(xv(r))?.find(s=>s!==r&&s.state.isPaused)?.continue()??Promise.resolve()}clear(){Jo.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}getAll(){return[...this.#e.values()].flat()}find(r){const t={exact:!0,...r};return this.getAll().find(s=>DI(t,s))}findAll(r={}){return this.getAll().filter(t=>DI(r,t))}notify(r){Jo.batch(()=>{this.listeners.forEach(t=>{t(r)})})}resumePausedMutations(){const r=this.getAll().filter(t=>t.state.isPaused);return Jo.batch(()=>Promise.all(r.map(t=>t.continue().catch(fu))))}};function xv(r){return r.options.scope?.id??String(r.mutationId)}function zI(r){return{onFetch:(t,s)=>{const l=t.options,h=t.fetchOptions?.meta?.fetchMore?.direction,m=t.state.data?.pages||[],v=t.state.data?.pageParams||[];let i={pages:[],pageParams:[]},A=0;const P=async()=>{let D=!1;const F=J=>{Object.defineProperty(J,"signal",{enumerable:!0,get:()=>(t.signal.aborted?D=!0:t.signal.addEventListener("abort",()=>{D=!0}),t.signal)})},$=nR(t.options,t.fetchOptions),K=async(J,W,ie)=>{if(D)return Promise.reject();if(W==null&&J.pages.length)return Promise.resolve(J);const fe={queryKey:t.queryKey,pageParam:W,direction:ie?"backward":"forward",meta:t.options.meta};F(fe);const Pe=await $(fe),{maxPages:Fe}=t.options,ht=ie?gV:mV;return{pages:ht(J.pages,Pe,Fe),pageParams:ht(J.pageParams,W,Fe)}};if(h&&m.length){const J=h==="backward",W=J?CV:jI,ie={pages:m,pageParams:v},fe=W(l,ie);i=await K(ie,fe,J)}else{const J=r??m.length;do{const W=A===0?v[0]??l.initialPageParam:jI(l,i);if(A>0&&W==null)break;i=await K(i,W),A++}while(A<J)}return i};t.options.persister?t.fetchFn=()=>t.options.persister?.(P,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},s):t.fetchFn=P}}}function jI(r,{pages:t,pageParams:s}){const l=t.length-1;return t.length>0?r.getNextPageParam(t[l],t,s[l],s):void 0}function CV(r,{pages:t,pageParams:s}){return t.length>0?r.getPreviousPageParam?.(t[0],t,s[0],s):void 0}var AV=class{#e;#t;#n;#r;#o;#s;#i;#a;constructor(r={}){this.#e=r.queryCache||new SV,this.#t=r.mutationCache||new EV,this.#n=r.defaultOptions||{},this.#r=new Map,this.#o=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#i=wT.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=l0.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#i?.(),this.#i=void 0,this.#a?.(),this.#a=void 0)}isFetching(r){return this.#e.findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return this.#t.findAll({...r,status:"pending"}).length}getQueryData(r){const t=this.defaultQueryOptions({queryKey:r});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(r){const t=this.getQueryData(r.queryKey);if(t===void 0)return this.fetchQuery(r);{const s=this.defaultQueryOptions(r),l=this.#e.build(this,s);return r.revalidateIfStale&&l.isStaleByTime(gy(s.staleTime,l))&&this.prefetchQuery(s),Promise.resolve(t)}}getQueriesData(r){return this.#e.findAll(r).map(({queryKey:t,state:s})=>{const l=s.data;return[t,l]})}setQueryData(r,t,s){const l=this.defaultQueryOptions({queryKey:r}),m=this.#e.get(l.queryHash)?.state.data,v=fV(t,m);if(v!==void 0)return this.#e.build(this,l).setData(v,{...s,manual:!0})}setQueriesData(r,t,s){return Jo.batch(()=>this.#e.findAll(r).map(({queryKey:l})=>[l,this.setQueryData(l,t,s)]))}getQueryState(r){const t=this.defaultQueryOptions({queryKey:r});return this.#e.get(t.queryHash)?.state}removeQueries(r){const t=this.#e;Jo.batch(()=>{t.findAll(r).forEach(s=>{t.remove(s)})})}resetQueries(r,t){const s=this.#e,l={type:"active",...r};return Jo.batch(()=>(s.findAll(r).forEach(h=>{h.reset()}),this.refetchQueries(l,t)))}cancelQueries(r={},t={}){const s={revert:!0,...t},l=Jo.batch(()=>this.#e.findAll(r).map(h=>h.cancel(s)));return Promise.all(l).then(fu).catch(fu)}invalidateQueries(r={},t={}){return Jo.batch(()=>{if(this.#e.findAll(r).forEach(l=>{l.invalidate()}),r.refetchType==="none")return Promise.resolve();const s={...r,type:r.refetchType??r.type??"active"};return this.refetchQueries(s,t)})}refetchQueries(r={},t){const s={...t,cancelRefetch:t?.cancelRefetch??!0},l=Jo.batch(()=>this.#e.findAll(r).filter(h=>!h.isDisabled()).map(h=>{let m=h.fetch(void 0,s);return s.throwOnError||(m=m.catch(fu)),h.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(fu)}fetchQuery(r){const t=this.defaultQueryOptions(r);t.retry===void 0&&(t.retry=!1);const s=this.#e.build(this,t);return s.isStaleByTime(gy(t.staleTime,s))?s.fetch(t):Promise.resolve(s.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(fu).catch(fu)}fetchInfiniteQuery(r){return r.behavior=zI(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(fu).catch(fu)}ensureInfiniteQueryData(r){return r.behavior=zI(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return l0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(r){this.#n=r}setQueryDefaults(r,t){this.#r.set(pg(r),{queryKey:r,defaultOptions:t})}getQueryDefaults(r){const t=[...this.#r.values()];let s={};return t.forEach(l=>{Q_(r,l.queryKey)&&(s={...s,...l.defaultOptions})}),s}setMutationDefaults(r,t){this.#o.set(pg(r),{mutationKey:r,defaultOptions:t})}getMutationDefaults(r){const t=[...this.#o.values()];let s={};return t.forEach(l=>{Q_(r,l.mutationKey)&&(s={...s,...l.defaultOptions})}),s}defaultQueryOptions(r){if(r._defaulted)return r;const t={...this.#n.queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return t.queryHash||(t.queryHash=vT(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===bT&&(t.enabled=!1),t}defaultMutationOptions(r){return r?._defaulted?r:{...this.#n.mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},IV=class extends Ly{constructor(r,t){super(),this.options=t,this.#e=r,this.#a=null,this.#i=yS(),this.options.experimental_prefetchInRender||this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#n=void 0;#r=void 0;#o;#s;#i;#a;#m;#d;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),FI(this.#t,this.options)?this.#h():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return _S(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return _S(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#b(),this.#t.removeObserver(this)}setOptions(r,t){const s=this.options,l=this.#t;if(this.options=this.#e.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ch(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),s._defaulted&&!a0(this.options,s)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const h=this.hasListeners();h&&BI(this.#t,l,this.options,s)&&this.#h(),this.updateResult(t),h&&(this.#t!==l||ch(this.options.enabled,this.#t)!==ch(s.enabled,this.#t)||gy(this.options.staleTime,this.#t)!==gy(s.staleTime,this.#t))&&this.#g();const m=this.#y();h&&(this.#t!==l||ch(this.options.enabled,this.#t)!==ch(s.enabled,this.#t)||m!==this.#l)&&this.#_(m)}getOptimisticResult(r){const t=this.#e.getQueryCache().build(this.#e,r),s=this.createResult(t,r);return kV(this,s)&&(this.#r=s,this.#s=this.options,this.#o=this.#t.state),s}getCurrentResult(){return this.#r}trackResult(r,t){const s={};return Object.keys(r).forEach(l=>{Object.defineProperty(s,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),t?.(l),r[l])})}),s}trackProp(r){this.#p.add(r)}getCurrentQuery(){return this.#t}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const t=this.#e.defaultQueryOptions(r),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(r){return this.#h({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#r))}#h(r){this.#w();let t=this.#t.fetch(this.options,r);return r?.throwOnError||(t=t.catch(fu)),t}#g(){this.#v();const r=gy(this.options.staleTime,this.#t);if(fg||this.#r.isStale||!pS(r))return;const s=tR(this.#r.dataUpdatedAt,r)+1;this.#c=setTimeout(()=>{this.#r.isStale||this.updateResult()},s)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(r){this.#b(),this.#l=r,!(fg||ch(this.options.enabled,this.#t)===!1||!pS(this.#l)||this.#l===0)&&(this.#u=setInterval(()=>{(this.options.refetchIntervalInBackground||wT.isFocused())&&this.#h()},this.#l))}#x(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(clearInterval(this.#u),this.#u=void 0)}createResult(r,t){const s=this.#t,l=this.options,h=this.#r,m=this.#o,v=this.#s,A=r!==s?r.state:this.#n,{state:P}=r;let D={...P},F=!1,$;if(t._optimisticResults){const kt=this.hasListeners(),Rt=!kt&&FI(r,t),hr=kt&&BI(r,s,t,l);(Rt||hr)&&(D={...D,...lR(P.data,r.options)}),t._optimisticResults==="isRestoring"&&(D.fetchStatus="idle")}let{error:K,errorUpdatedAt:J,status:W}=D;if(t.select&&D.data!==void 0)if(h&&D.data===m?.data&&t.select===this.#m)$=this.#d;else try{this.#m=t.select,$=t.select(D.data),$=gS(h?.data,$,t),this.#d=$,this.#a=null}catch(kt){this.#a=kt}else $=D.data;if(t.placeholderData!==void 0&&$===void 0&&W==="pending"){let kt;if(h?.isPlaceholderData&&t.placeholderData===v?.placeholderData)kt=h.data;else if(kt=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,t.select&&kt!==void 0)try{kt=t.select(kt),this.#a=null}catch(Rt){this.#a=Rt}kt!==void 0&&(W="success",$=gS(h?.data,kt,t),F=!0)}this.#a&&(K=this.#a,$=this.#d,J=Date.now(),W="error");const ie=D.fetchStatus==="fetching",fe=W==="pending",Pe=W==="error",Fe=fe&&ie,ht=$!==void 0,Dt={status:W,fetchStatus:D.fetchStatus,isPending:fe,isSuccess:W==="success",isError:Pe,isInitialLoading:Fe,isLoading:Fe,data:$,dataUpdatedAt:D.dataUpdatedAt,error:K,errorUpdatedAt:J,failureCount:D.fetchFailureCount,failureReason:D.fetchFailureReason,errorUpdateCount:D.errorUpdateCount,isFetched:D.dataUpdateCount>0||D.errorUpdateCount>0,isFetchedAfterMount:D.dataUpdateCount>A.dataUpdateCount||D.errorUpdateCount>A.errorUpdateCount,isFetching:ie,isRefetching:ie&&!fe,isLoadingError:Pe&&!ht,isPaused:D.fetchStatus==="paused",isPlaceholderData:F,isRefetchError:Pe&&ht,isStale:ST(r,t),refetch:this.refetch,promise:this.#i};if(this.options.experimental_prefetchInRender){const kt=Tr=>{Dt.status==="error"?Tr.reject(Dt.error):Dt.data!==void 0&&Tr.resolve(Dt.data)},Rt=()=>{const Tr=this.#i=Dt.promise=yS();kt(Tr)},hr=this.#i;switch(hr.status){case"pending":r.queryHash===s.queryHash&&kt(hr);break;case"fulfilled":(Dt.status==="error"||Dt.data!==hr.value)&&Rt();break;case"rejected":(Dt.status!=="error"||Dt.error!==hr.reason)&&Rt();break}}return Dt}updateResult(r){const t=this.#r,s=this.createResult(this.#t,this.options);if(this.#o=this.#t.state,this.#s=this.options,this.#o.data!==void 0&&(this.#f=this.#t),a0(s,t))return;this.#r=s;const l={},h=()=>{if(!t)return!0;const{notifyOnChangeProps:m}=this.options,v=typeof m=="function"?m():m;if(v==="all"||!v&&!this.#p.size)return!0;const i=new Set(v??this.#p);return this.options.throwOnError&&i.add("error"),Object.keys(this.#r).some(A=>{const P=A;return this.#r[P]!==t[P]&&i.has(P)})};r?.listeners!==!1&&h()&&(l.listeners=!0),this.#S({...l,...r})}#w(){const r=this.#e.getQueryCache().build(this.#e,this.options);if(r===this.#t)return;const t=this.#t;this.#t=r,this.#n=r.state,this.hasListeners()&&(t?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(r){Jo.batch(()=>{r.listeners&&this.listeners.forEach(t=>{t(this.#r)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function MV(r,t){return ch(t.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&t.retryOnMount===!1)}function FI(r,t){return MV(r,t)||r.state.data!==void 0&&_S(r,t,t.refetchOnMount)}function _S(r,t,s){if(ch(t.enabled,r)!==!1){const l=typeof s=="function"?s(r):s;return l==="always"||l!==!1&&ST(r,t)}return!1}function BI(r,t,s,l){return(r!==t||ch(l.enabled,r)===!1)&&(!s.suspense||r.state.status!=="error")&&ST(r,s)}function ST(r,t){return ch(t.enabled,r)!==!1&&r.isStaleByTime(gy(t.staleTime,r))}function kV(r,t){return!a0(r.getCurrentResult(),t)}var PV=class extends Ly{#e;#t=void 0;#n;#r;constructor(t,s){super(),this.#e=t,this.setOptions(s),this.bindMethods(),this.#o()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#e.defaultMutationOptions(t),a0(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),s?.mutationKey&&this.options.mutationKey&&pg(s.mutationKey)!==pg(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#o(),this.#s(t)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#o(),this.#s()}mutate(t,s){return this.#r=s,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(t)}#o(){const t=this.#n?.state??cR();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#s(t){Jo.batch(()=>{if(this.#r&&this.hasListeners()){const s=this.#t.variables,l=this.#t.context;t?.type==="success"?(this.#r.onSuccess?.(t.data,s,l),this.#r.onSettled?.(t.data,null,s,l)):t?.type==="error"&&(this.#r.onError?.(t.error,s,l),this.#r.onSettled?.(void 0,t.error,s,l))}this.listeners.forEach(s=>{s(this.#t)})})}},uR=ee.createContext(void 0),TT=r=>{const t=ee.useContext(uR);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},RV=({client:r,children:t})=>(ee.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),b.jsx(uR.Provider,{value:r,children:t})),hR=ee.createContext(!1),NV=()=>ee.useContext(hR);hR.Provider;function DV(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var OV=ee.createContext(DV()),LV=()=>ee.useContext(OV);function dR(r,t){return typeof r=="function"?r(...t):!!r}function fR(){}var zV=(r,t)=>{(r.suspense||r.throwOnError)&&(t.isReset()||(r.retryOnMount=!1))},jV=r=>{ee.useEffect(()=>{r.clearReset()},[r])},FV=({result:r,errorResetBoundary:t,throwOnError:s,query:l})=>r.isError&&!t.isReset()&&!r.isFetching&&l&&dR(s,[r.error,l]),BV=r=>{r.suspense&&(r.staleTime===void 0&&(r.staleTime=1e3),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3)))},VV=(r,t)=>r.isLoading&&r.isFetching&&!t,UV=(r,t)=>r?.suspense&&t.isPending,VI=(r,t,s)=>t.fetchOptimistic(r).catch(()=>{s.clearReset()});function $V(r,t,s){const l=TT(),h=NV(),m=LV(),v=l.defaultQueryOptions(r);l.getDefaultOptions().queries?._experimental_beforeQuery?.(v),v._optimisticResults=h?"isRestoring":"optimistic",BV(v),zV(v,m),jV(m);const i=!l.getQueryCache().get(v.queryHash),[A]=ee.useState(()=>new t(l,v)),P=A.getOptimisticResult(v);if(ee.useSyncExternalStore(ee.useCallback(D=>{const F=h?()=>{}:A.subscribe(Jo.batchCalls(D));return A.updateResult(),F},[A,h]),()=>A.getCurrentResult(),()=>A.getCurrentResult()),ee.useEffect(()=>{A.setOptions(v,{listeners:!1})},[v,A]),UV(v,P))throw VI(v,A,m);if(FV({result:P,errorResetBoundary:m,throwOnError:v.throwOnError,query:l.getQueryCache().get(v.queryHash)}))throw P.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(v,P),v.experimental_prefetchInRender&&!fg&&VV(P,h)&&(i?VI(v,A,m):l.getQueryCache().get(v.queryHash)?.promise)?.catch(fR).finally(()=>{A.updateResult()}),v.notifyOnChangeProps?P:A.trackResult(P)}function ah(r,t){return $V(r,IV)}function fs(r,t){const s=TT(),[l]=ee.useState(()=>new PV(s,r));ee.useEffect(()=>{l.setOptions(r)},[l,r]);const h=ee.useSyncExternalStore(ee.useCallback(v=>l.subscribe(Jo.batchCalls(v)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),m=ee.useCallback((v,i)=>{l.mutate(v,i).catch(fR)},[l]);if(h.error&&dR(l.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:m,mutateAsync:h.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ex(){return ex=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(r[l]=s[l])}return r},ex.apply(this,arguments)}var Fp;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Fp||(Fp={}));const UI="popstate";function HV(r){r===void 0&&(r={});function t(h,m){let{pathname:v="/",search:i="",hash:A=""}=Sg(h.location.hash.substr(1));return!v.startsWith("/")&&!v.startsWith(".")&&(v="/"+v),xS("",{pathname:v,search:i,hash:A},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function s(h,m){let v=h.document.querySelector("base"),i="";if(v&&v.getAttribute("href")){let A=h.location.href,P=A.indexOf("#");i=P===-1?A:A.slice(0,P)}return i+"#"+(typeof m=="string"?m:c0(m))}function l(h,m){ET(h.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(m)+")")}return qV(t,s,l,r)}function wo(r,t){if(r===!1||r===null||typeof r>"u")throw new Error(t)}function ET(r,t){if(!r){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function GV(){return Math.random().toString(36).substr(2,8)}function $I(r,t){return{usr:r.state,key:r.key,idx:t}}function xS(r,t,s,l){return s===void 0&&(s=null),ex({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof t=="string"?Sg(t):t,{state:s,key:t&&t.key||l||GV()})}function c0(r){let{pathname:t="/",search:s="",hash:l=""}=r;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),l&&l!=="#"&&(t+=l.charAt(0)==="#"?l:"#"+l),t}function Sg(r){let t={};if(r){let s=r.indexOf("#");s>=0&&(t.hash=r.substr(s),r=r.substr(0,s));let l=r.indexOf("?");l>=0&&(t.search=r.substr(l),r=r.substr(0,l)),r&&(t.pathname=r)}return t}function qV(r,t,s,l){l===void 0&&(l={});let{window:h=document.defaultView,v5Compat:m=!1}=l,v=h.history,i=Fp.Pop,A=null,P=D();P==null&&(P=0,v.replaceState(ex({},v.state,{idx:P}),""));function D(){return(v.state||{idx:null}).idx}function F(){i=Fp.Pop;let ie=D(),fe=ie==null?null:ie-P;P=ie,A&&A({action:i,location:W.location,delta:fe})}function $(ie,fe){i=Fp.Push;let Pe=xS(W.location,ie,fe);s&&s(Pe,ie),P=D()+1;let Fe=$I(Pe,P),ht=W.createHref(Pe);try{v.pushState(Fe,"",ht)}catch(at){if(at instanceof DOMException&&at.name==="DataCloneError")throw at;h.location.assign(ht)}m&&A&&A({action:i,location:W.location,delta:1})}function K(ie,fe){i=Fp.Replace;let Pe=xS(W.location,ie,fe);s&&s(Pe,ie),P=D();let Fe=$I(Pe,P),ht=W.createHref(Pe);v.replaceState(Fe,"",ht),m&&A&&A({action:i,location:W.location,delta:0})}function J(ie){let fe=h.location.origin!=="null"?h.location.origin:h.location.href,Pe=typeof ie=="string"?ie:c0(ie);return Pe=Pe.replace(/ $/,"%20"),wo(fe,"No window.location.(origin|href) available to create URL for href: "+Pe),new URL(Pe,fe)}let W={get action(){return i},get location(){return r(h,v)},listen(ie){if(A)throw new Error("A history only accepts one active listener");return h.addEventListener(UI,F),A=ie,()=>{h.removeEventListener(UI,F),A=null}},createHref(ie){return t(h,ie)},createURL:J,encodeLocation(ie){let fe=J(ie);return{pathname:fe.pathname,search:fe.search,hash:fe.hash}},push:$,replace:K,go(ie){return v.go(ie)}};return W}var HI;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(HI||(HI={}));function WV(r,t,s){return s===void 0&&(s="/"),ZV(r,t,s)}function ZV(r,t,s,l){let h=typeof t=="string"?Sg(t):t,m=CT(h.pathname||"/",s);if(m==null)return null;let v=pR(r);XV(v);let i=null;for(let A=0;i==null&&A<v.length;++A){let P=a6(m);i=i6(v[A],P)}return i}function pR(r,t,s,l){t===void 0&&(t=[]),s===void 0&&(s=[]),l===void 0&&(l="");let h=(m,v,i)=>{let A={relativePath:i===void 0?m.path||"":i,caseSensitive:m.caseSensitive===!0,childrenIndex:v,route:m};A.relativePath.startsWith("/")&&(wo(A.relativePath.startsWith(l),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(l.length));let P=Hp([l,A.relativePath]),D=s.concat(A);m.children&&m.children.length>0&&(wo(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+P+'".')),pR(m.children,t,D,P)),!(m.path==null&&!m.index)&&t.push({path:P,score:r6(P,m.index),routesMeta:D})};return r.forEach((m,v)=>{var i;if(m.path===""||!((i=m.path)!=null&&i.includes("?")))h(m,v);else for(let A of mR(m.path))h(m,v,A)}),t}function mR(r){let t=r.split("/");if(t.length===0)return[];let[s,...l]=t,h=s.endsWith("?"),m=s.replace(/\?$/,"");if(l.length===0)return h?[m,""]:[m];let v=mR(l.join("/")),i=[];return i.push(...v.map(A=>A===""?m:[m,A].join("/"))),h&&i.push(...v),i.map(A=>r.startsWith("/")&&A===""?"/":A)}function XV(r){r.sort((t,s)=>t.score!==s.score?s.score-t.score:n6(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}const KV=/^:[\w-]+$/,YV=3,JV=2,QV=1,e6=10,t6=-2,GI=r=>r==="*";function r6(r,t){let s=r.split("/"),l=s.length;return s.some(GI)&&(l+=t6),t&&(l+=JV),s.filter(h=>!GI(h)).reduce((h,m)=>h+(KV.test(m)?YV:m===""?QV:e6),l)}function n6(r,t){return r.length===t.length&&r.slice(0,-1).every((l,h)=>l===t[h])?r[r.length-1]-t[t.length-1]:0}function i6(r,t,s){let{routesMeta:l}=r,h={},m="/",v=[];for(let i=0;i<l.length;++i){let A=l[i],P=i===l.length-1,D=m==="/"?t:t.slice(m.length)||"/",F=s6({path:A.relativePath,caseSensitive:A.caseSensitive,end:P},D),$=A.route;if(!F)return null;Object.assign(h,F.params),v.push({params:h,pathname:Hp([m,F.pathname]),pathnameBase:h6(Hp([m,F.pathnameBase])),route:$}),F.pathnameBase!=="/"&&(m=Hp([m,F.pathnameBase]))}return v}function s6(r,t){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[s,l]=o6(r.path,r.caseSensitive,r.end),h=t.match(s);if(!h)return null;let m=h[0],v=m.replace(/(.)\/+$/,"$1"),i=h.slice(1);return{params:l.reduce((P,D,F)=>{let{paramName:$,isOptional:K}=D;if($==="*"){let W=i[F]||"";v=m.slice(0,m.length-W.length).replace(/(.)\/+$/,"$1")}const J=i[F];return K&&!J?P[$]=void 0:P[$]=(J||"").replace(/%2F/g,"/"),P},{}),pathname:m,pathnameBase:v,pattern:r}}function o6(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!0),ET(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let l=[],h="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(v,i,A)=>(l.push({paramName:i,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(l.push({paramName:"*"}),h+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?h+="\\/*$":r!==""&&r!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,t?void 0:"i"),l]}function a6(r){try{return r.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return ET(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),r}}function CT(r,t){if(t==="/")return r;if(!r.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=r.charAt(s);return l&&l!=="/"?null:r.slice(s)||"/"}function l6(r,t){t===void 0&&(t="/");let{pathname:s,search:l="",hash:h=""}=typeof r=="string"?Sg(r):r;return{pathname:s?s.startsWith("/")?s:c6(s,t):t,search:d6(l),hash:f6(h)}}function c6(r,t){let s=t.replace(/\/+$/,"").split("/");return r.split("/").forEach(h=>{h===".."?s.length>1&&s.pop():h!=="."&&s.push(h)}),s.length>1?s.join("/"):"/"}function fw(r,t,s,l){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function u6(r){return r.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function AT(r,t){let s=u6(r);return t?s.map((l,h)=>h===s.length-1?l.pathname:l.pathnameBase):s.map(l=>l.pathnameBase)}function IT(r,t,s,l){l===void 0&&(l=!1);let h;typeof r=="string"?h=Sg(r):(h=ex({},r),wo(!h.pathname||!h.pathname.includes("?"),fw("?","pathname","search",h)),wo(!h.pathname||!h.pathname.includes("#"),fw("#","pathname","hash",h)),wo(!h.search||!h.search.includes("#"),fw("#","search","hash",h)));let m=r===""||h.pathname==="",v=m?"/":h.pathname,i;if(v==null)i=s;else{let F=t.length-1;if(!l&&v.startsWith("..")){let $=v.split("/");for(;$[0]==="..";)$.shift(),F-=1;h.pathname=$.join("/")}i=F>=0?t[F]:"/"}let A=l6(h,i),P=v&&v!=="/"&&v.endsWith("/"),D=(m||v===".")&&s.endsWith("/");return!A.pathname.endsWith("/")&&(P||D)&&(A.pathname+="/"),A}const Hp=r=>r.join("/").replace(/\/\/+/g,"/"),h6=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),d6=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,f6=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function p6(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const gR=["post","put","patch","delete"];new Set(gR);const m6=["get",...gR];new Set(m6);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tx(){return tx=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(r[l]=s[l])}return r},tx.apply(this,arguments)}const MT=ee.createContext(null),g6=ee.createContext(null),rm=ee.createContext(null),b1=ee.createContext(null),If=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),yR=ee.createContext(null);function y6(r,t){let{relative:s}=t===void 0?{}:t;zy()||wo(!1);let{basename:l,navigator:h}=ee.useContext(rm),{hash:m,pathname:v,search:i}=xR(r,{relative:s}),A=v;return l!=="/"&&(A=v==="/"?l:Hp([l,v])),h.createHref({pathname:A,search:i,hash:m})}function zy(){return ee.useContext(b1)!=null}function nm(){return zy()||wo(!1),ee.useContext(b1).location}function _R(r){ee.useContext(rm).static||ee.useLayoutEffect(r)}function w1(){let{isDataRoute:r}=ee.useContext(If);return r?P6():_6()}function _6(){zy()||wo(!1);let r=ee.useContext(MT),{basename:t,future:s,navigator:l}=ee.useContext(rm),{matches:h}=ee.useContext(If),{pathname:m}=nm(),v=JSON.stringify(AT(h,s.v7_relativeSplatPath)),i=ee.useRef(!1);return _R(()=>{i.current=!0}),ee.useCallback(function(P,D){if(D===void 0&&(D={}),!i.current)return;if(typeof P=="number"){l.go(P);return}let F=IT(P,JSON.parse(v),m,D.relative==="path");r==null&&t!=="/"&&(F.pathname=F.pathname==="/"?t:Hp([t,F.pathname])),(D.replace?l.replace:l.push)(F,D.state,D)},[t,l,v,m,r])}function x6(){let{matches:r}=ee.useContext(If),t=r[r.length-1];return t?t.params:{}}function xR(r,t){let{relative:s}=t===void 0?{}:t,{future:l}=ee.useContext(rm),{matches:h}=ee.useContext(If),{pathname:m}=nm(),v=JSON.stringify(AT(h,l.v7_relativeSplatPath));return ee.useMemo(()=>IT(r,JSON.parse(v),m,s==="path"),[r,v,m,s])}function v6(r,t){return b6(r,t)}function b6(r,t,s,l){zy()||wo(!1);let{navigator:h}=ee.useContext(rm),{matches:m}=ee.useContext(If),v=m[m.length-1],i=v?v.params:{};v&&v.pathname;let A=v?v.pathnameBase:"/";v&&v.route;let P=nm(),D;if(t){var F;let ie=typeof t=="string"?Sg(t):t;A==="/"||(F=ie.pathname)!=null&&F.startsWith(A)||wo(!1),D=ie}else D=P;let $=D.pathname||"/",K=$;if(A!=="/"){let ie=A.replace(/^\//,"").split("/");K="/"+$.replace(/^\//,"").split("/").slice(ie.length).join("/")}let J=WV(r,{pathname:K}),W=C6(J&&J.map(ie=>Object.assign({},ie,{params:Object.assign({},i,ie.params),pathname:Hp([A,h.encodeLocation?h.encodeLocation(ie.pathname).pathname:ie.pathname]),pathnameBase:ie.pathnameBase==="/"?A:Hp([A,h.encodeLocation?h.encodeLocation(ie.pathnameBase).pathname:ie.pathnameBase])})),m,s,l);return t&&W?ee.createElement(b1.Provider,{value:{location:tx({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:Fp.Pop}},W):W}function w6(){let r=k6(),t=p6(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),s=r instanceof Error?r.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},t),s?ee.createElement("pre",{style:h},s):null,null)}const S6=ee.createElement(w6,null);class T6 extends ee.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?ee.createElement(If.Provider,{value:this.props.routeContext},ee.createElement(yR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function E6(r){let{routeContext:t,match:s,children:l}=r,h=ee.useContext(MT);return h&&h.static&&h.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=s.route.id),ee.createElement(If.Provider,{value:t},l)}function C6(r,t,s,l){var h;if(t===void 0&&(t=[]),s===void 0&&(s=null),l===void 0&&(l=null),r==null){var m;if(!s)return null;if(s.errors)r=s.matches;else if((m=l)!=null&&m.v7_partialHydration&&t.length===0&&!s.initialized&&s.matches.length>0)r=s.matches;else return null}let v=r,i=(h=s)==null?void 0:h.errors;if(i!=null){let D=v.findIndex(F=>F.route.id&&i?.[F.route.id]!==void 0);D>=0||wo(!1),v=v.slice(0,Math.min(v.length,D+1))}let A=!1,P=-1;if(s&&l&&l.v7_partialHydration)for(let D=0;D<v.length;D++){let F=v[D];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(P=D),F.route.id){let{loaderData:$,errors:K}=s,J=F.route.loader&&$[F.route.id]===void 0&&(!K||K[F.route.id]===void 0);if(F.route.lazy||J){A=!0,P>=0?v=v.slice(0,P+1):v=[v[0]];break}}}return v.reduceRight((D,F,$)=>{let K,J=!1,W=null,ie=null;s&&(K=i&&F.route.id?i[F.route.id]:void 0,W=F.route.errorElement||S6,A&&(P<0&&$===0?(R6("route-fallback"),J=!0,ie=null):P===$&&(J=!0,ie=F.route.hydrateFallbackElement||null)));let fe=t.concat(v.slice(0,$+1)),Pe=()=>{let Fe;return K?Fe=W:J?Fe=ie:F.route.Component?Fe=ee.createElement(F.route.Component,null):F.route.element?Fe=F.route.element:Fe=D,ee.createElement(E6,{match:F,routeContext:{outlet:D,matches:fe,isDataRoute:s!=null},children:Fe})};return s&&(F.route.ErrorBoundary||F.route.errorElement||$===0)?ee.createElement(T6,{location:s.location,revalidation:s.revalidation,component:W,error:K,children:Pe(),routeContext:{outlet:null,matches:fe,isDataRoute:!0}}):Pe()},null)}var vR=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(vR||{}),bR=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(bR||{});function A6(r){let t=ee.useContext(MT);return t||wo(!1),t}function I6(r){let t=ee.useContext(g6);return t||wo(!1),t}function M6(r){let t=ee.useContext(If);return t||wo(!1),t}function wR(r){let t=M6(),s=t.matches[t.matches.length-1];return s.route.id||wo(!1),s.route.id}function k6(){var r;let t=ee.useContext(yR),s=I6(),l=wR();return t!==void 0?t:(r=s.errors)==null?void 0:r[l]}function P6(){let{router:r}=A6(vR.UseNavigateStable),t=wR(bR.UseNavigateStable),s=ee.useRef(!1);return _R(()=>{s.current=!0}),ee.useCallback(function(h,m){m===void 0&&(m={}),s.current&&(typeof h=="number"?r.navigate(h):r.navigate(h,tx({fromRouteId:t},m)))},[r,t])}const qI={};function R6(r,t,s){qI[r]||(qI[r]=!0)}function N6(r,t){r?.v7_startTransition,r?.v7_relativeSplatPath}function D6(r){let{to:t,replace:s,state:l,relative:h}=r;zy()||wo(!1);let{future:m,static:v}=ee.useContext(rm),{matches:i}=ee.useContext(If),{pathname:A}=nm(),P=w1(),D=IT(t,AT(i,m.v7_relativeSplatPath),A,h==="path"),F=JSON.stringify(D);return ee.useEffect(()=>P(JSON.parse(F),{replace:s,state:l,relative:h}),[P,F,h,s,l]),null}function ga(r){wo(!1)}function O6(r){let{basename:t="/",children:s=null,location:l,navigationType:h=Fp.Pop,navigator:m,static:v=!1,future:i}=r;zy()&&wo(!1);let A=t.replace(/^\/*/,"/"),P=ee.useMemo(()=>({basename:A,navigator:m,static:v,future:tx({v7_relativeSplatPath:!1},i)}),[A,i,m,v]);typeof l=="string"&&(l=Sg(l));let{pathname:D="/",search:F="",hash:$="",state:K=null,key:J="default"}=l,W=ee.useMemo(()=>{let ie=CT(D,A);return ie==null?null:{location:{pathname:ie,search:F,hash:$,state:K,key:J},navigationType:h}},[A,D,F,$,K,J,h]);return W==null?null:ee.createElement(rm.Provider,{value:P},ee.createElement(b1.Provider,{children:s,value:W}))}function L6(r){let{children:t,location:s}=r;return v6(vS(t),s)}new Promise(()=>{});function vS(r,t){t===void 0&&(t=[]);let s=[];return ee.Children.forEach(r,(l,h)=>{if(!ee.isValidElement(l))return;let m=[...t,h];if(l.type===ee.Fragment){s.push.apply(s,vS(l.props.children,m));return}l.type!==ga&&wo(!1),!l.props.index||!l.props.children||wo(!1);let v={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(v.children=vS(l.props.children,m)),s.push(v)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bS(){return bS=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(r[l]=s[l])}return r},bS.apply(this,arguments)}function z6(r,t){if(r==null)return{};var s={},l=Object.keys(r),h,m;for(m=0;m<l.length;m++)h=l[m],!(t.indexOf(h)>=0)&&(s[h]=r[h]);return s}function j6(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function F6(r,t){return r.button===0&&(!t||t==="_self")&&!j6(r)}const B6=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],V6="6";try{window.__reactRouterVersion=V6}catch{}const U6="startTransition",WI=Ok[U6];function $6(r){let{basename:t,children:s,future:l,window:h}=r,m=ee.useRef();m.current==null&&(m.current=HV({window:h,v5Compat:!0}));let v=m.current,[i,A]=ee.useState({action:v.action,location:v.location}),{v7_startTransition:P}=l||{},D=ee.useCallback(F=>{P&&WI?WI(()=>A(F)):A(F)},[A,P]);return ee.useLayoutEffect(()=>v.listen(D),[v,D]),ee.useEffect(()=>N6(l),[l]),ee.createElement(O6,{basename:t,children:s,location:i.location,navigationType:i.action,navigator:v,future:l})}const H6=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",G6=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Mi=ee.forwardRef(function(t,s){let{onClick:l,relative:h,reloadDocument:m,replace:v,state:i,target:A,to:P,preventScrollReset:D,viewTransition:F}=t,$=z6(t,B6),{basename:K}=ee.useContext(rm),J,W=!1;if(typeof P=="string"&&G6.test(P)&&(J=P,H6))try{let Fe=new URL(window.location.href),ht=P.startsWith("//")?new URL(Fe.protocol+P):new URL(P),at=CT(ht.pathname,K);ht.origin===Fe.origin&&at!=null?P=at+ht.search+ht.hash:W=!0}catch{}let ie=y6(P,{relative:h}),fe=q6(P,{replace:v,state:i,target:A,preventScrollReset:D,relative:h,viewTransition:F});function Pe(Fe){l&&l(Fe),Fe.defaultPrevented||fe(Fe)}return ee.createElement("a",bS({},$,{href:J||ie,onClick:W||m?l:Pe,ref:s,target:A}))});var ZI;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(ZI||(ZI={}));var XI;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(XI||(XI={}));function q6(r,t){let{target:s,replace:l,state:h,preventScrollReset:m,relative:v,viewTransition:i}=t===void 0?{}:t,A=w1(),P=nm(),D=xR(r,{relative:v});return ee.useCallback(F=>{if(F6(F,s)){F.preventDefault();let $=l!==void 0?l:c0(P)===c0(D);A(r,{replace:$,state:h,preventScrollReset:m,relative:v,viewTransition:i})}},[P,A,D,l,h,s,r,m,v,i])}const SR=ee.createContext(void 0),W6=({children:r})=>{const[t,s]=ee.useState(!1),[l,h]=ee.useState(null),[m,v]=ee.useState([]),[i,A]=ee.useState(!0);ee.useEffect(()=>{const J=localStorage.getItem("admin_session"),W=localStorage.getItem("admin_info");J==="logged_in"&&W&&(s(!0),h(JSON.parse(W))),P(),A(!1)},[]);const P=async()=>{try{const W=await(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins")).json();v(W)}catch(J){console.error("Error fetching admins:",J)}},D=async(J,W)=>{try{const ie=await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:J,password:W})});if(!ie.ok)return!1;const fe=await ie.json();return localStorage.setItem("admin_session","logged_in"),localStorage.setItem("admin_info",JSON.stringify(fe.admin)),s(!0),h(fe.admin),!0}catch{return!1}},F=()=>{s(!1),h(null),localStorage.removeItem("admin_session"),localStorage.removeItem("admin_info")},$=async(J,W,ie)=>{try{return(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:J,email:W,password:ie})})).ok?(await P(),!0):!1}catch{return!1}},K=async J=>{if(J===l?.id)return!1;try{return(await fetch(`https://betawaves-back.4bzwio.easypanel.host/api/admins/${J}`,{method:"DELETE"})).ok?(await P(),!0):!1}catch{return!1}};return b.jsx(SR.Provider,{value:{isAdminLoggedIn:t,currentAdmin:l,admins:m,login:D,logout:F,loading:i,createAdmin:$,deleteAdmin:K},children:r})},_x=()=>{const r=ee.useContext(SR);if(!r)throw new Error("useAdmin must be used within AdminProvider");return r},Z6=gx("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),fr=ee.forwardRef(({className:r,variant:t,size:s,asChild:l=!1,...h},m)=>{const v=l?ug:"button";return b.jsx(v,{className:ki(Z6({variant:t,size:s,className:r})),ref:m,...h})});fr.displayName="Button";const X6=()=>{const[r,t]=ee.useState(!1),s=nm(),{isAdminLoggedIn:l}=_x(),h=[{name:"Home",path:"/"},{name:"Consulting",path:"/consultings"},{name:"Products",path:"/products"},{name:"Resources",path:"/resources"},{name:"Investment",path:"/fund"},{name:"Portfolio",path:"/case-studies"},{name:"Blog",path:"/blog"}],m=v=>s.pathname===v||v!=="/"&&s.pathname.startsWith(v);return b.jsx("nav",{className:"bg-white shadow-sm sticky top-0 z-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"flex justify-between items-center h-16",children:[b.jsx(Mi,{to:"/",className:"flex items-center space-x-2",children:b.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-Black.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),b.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[h.map(v=>b.jsx(Mi,{to:v.path,className:`text-sm font-medium transition-colors duration-200 ${m(v.path)?"text-primary border-b-2 border-primary pb-1":"text-gray-600 hover:text-primary"}`,children:v.name},v.name)),b.jsx(fr,{asChild:!0,className:"ml-2",children:b.jsx(Mi,{to:"/contact",children:"Contact"})})]}),b.jsx("button",{className:"md:hidden flex items-center justify-center w-8 h-8",onClick:()=>t(!r),"aria-label":"Toggle menu",children:b.jsxs("div",{className:"space-y-1",children:[b.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${r?"rotate-45 translate-y-1.5":""}`}),b.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-opacity ${r?"opacity-0":""}`}),b.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${r?"-rotate-45 -translate-y-1.5":""}`})]})})]}),r&&b.jsx("div",{className:"md:hidden border-t border-gray-200 py-4",children:b.jsxs("div",{className:"flex flex-col space-y-4",children:[h.map(v=>b.jsx(Mi,{to:v.path,className:`text-sm font-medium px-2 py-1 rounded transition-colors ${m(v.path)?"text-primary bg-primary/10":"text-gray-600 hover:text-primary hover:bg-gray-50"}`,onClick:()=>t(!1),children:v.name},v.name)),b.jsx(fr,{asChild:!0,className:"mt-4 w-fit",children:b.jsx(Mi,{to:"/contact",onClick:()=>t(!1),children:"Contact"})})]})})]})})},K6=()=>{const[r,t]=ee.useState(""),[s,l]=ee.useState(!1),[h,m]=ee.useState(!1),v=async i=>{if(i.preventDefault(),!!r){l(!0);try{(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:r,subject:"Newsletter",message:"",status:"unread"})})).ok&&(m(!0),t(""),setTimeout(()=>m(!1),3e3))}catch(A){console.error("Newsletter subscription error:",A)}finally{l(!1)}}};return b.jsx("footer",{className:"bg-gray-900 text-white",children:b.jsxs("div",{className:"container-width section-padding py-12",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[b.jsxs("div",{className:"col-span-1 md:col-span-2",children:[b.jsx(Mi,{to:"/",className:"flex items-center space-x-2",children:b.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-White.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),b.jsx("br",{}),b.jsx("p",{className:"text-gray-400 mb-4 max-w-md",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and marketsconnect."}),b.jsx("div",{className:"flex space-x-4",children:b.jsx("a",{href:"https://www.linkedin.com/company/betawavesstudio/",className:"text-gray-400 hover:text-white transition-colors",children:"LinkedIn"})})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),b.jsxs("ul",{className:"space-y-2 text-gray-400",children:[b.jsx("li",{children:b.jsx(Mi,{to:"/consultings",className:"hover:text-white transition-colors",children:"Innovation Consultings"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/case-studies",className:"hover:text-white transition-colors",children:"Portfolio"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/blog",className:"hover:text-white transition-colors",children:"Blog"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/fund",className:"hover:text-white transition-colors",children:"Investment"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/contact",className:"hover:text-white transition-colors",children:"Contact"})})]})]}),b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-2xl font-semibold mb-4",children:"Stay Updated"}),b.jsx("p",{className:"text-1xl mb-8 opacity-50 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),b.jsxs("form",{onSubmit:v,className:"flex flex-col gap-4 max-w-md mx-auto",children:[b.jsx("input",{type:"email",placeholder:"Enter your email",className:"px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:r,onChange:i=>t(i.target.value),required:!0}),b.jsx("button",{type:"submit",disabled:s,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:s?"Subscribing...":"Subscribe"})]}),h&&b.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]}),b.jsxs("div",{className:"border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center",children:[b.jsx("p",{className:"text-gray-400 text-sm",children:" 2025 Betawaves. All rights reserved."}),b.jsxs("div",{className:"flex space-x-6 mt-4 md:mt-0",children:[b.jsx("li",{children:b.jsx(Mi,{to:"/privacy-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Privacy Policy"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/terms-of-service",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Terms of Service"})}),b.jsx("li",{children:b.jsx(Mi,{to:"/cookie-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Cookie Policy"})})]})]})]})})},Rn=ee.forwardRef(({className:r,...t},s)=>b.jsx("div",{ref:s,className:ki("rounded-lg border bg-card text-card-foreground shadow-sm",r),...t}));Rn.displayName="Card";const Yn=ee.forwardRef(({className:r,...t},s)=>b.jsx("div",{ref:s,className:ki("flex flex-col space-y-1.5 p-6",r),...t}));Yn.displayName="CardHeader";const Jn=ee.forwardRef(({className:r,...t},s)=>b.jsx("h3",{ref:s,className:ki("text-2xl font-semibold leading-none tracking-tight",r),...t}));Jn.displayName="CardTitle";const ys=ee.forwardRef(({className:r,...t},s)=>b.jsx("p",{ref:s,className:ki("text-sm text-muted-foreground",r),...t}));ys.displayName="CardDescription";const Qn=ee.forwardRef(({className:r,...t},s)=>b.jsx("div",{ref:s,className:ki("p-6 pt-0",r),...t}));Qn.displayName="CardContent";const Y6=ee.forwardRef(({className:r,...t},s)=>b.jsx("div",{ref:s,className:ki("flex items-center p-6 pt-0",r),...t}));Y6.displayName="CardFooter";const vv="https://betawaves-back.4bzwio.easypanel.host/api";class cu extends Error{constructor(t,s){super(t),this.status=s,this.name="APIError"}}const zr={async get(r){try{const t=await fetch(`${vv}${r}`);if(!t.ok)throw new cu(`HTTP error! status: ${t.status}`,t.status);return await t.json()}catch(t){throw t instanceof cu?t:new cu("Network error occurred")}},async post(r,t){try{const s=await fetch(`${vv}${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new cu(`HTTP error! status: ${s.status}`,s.status);return await s.json()}catch(s){throw s instanceof cu?s:new cu("Network error occurred")}},async put(r,t){try{const s=await fetch(`${vv}${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new cu(`HTTP error! status: ${s.status}`,s.status);return await s.json()}catch(s){throw s instanceof cu?s:new cu("Network error occurred")}},async delete(r){try{const t=await fetch(`${vv}${r}`,{method:"DELETE"});if(!t.ok)throw new cu(`HTTP error! status: ${t.status}`,t.status);return await t.json()}catch(t){throw t instanceof cu?t:new cu("Network error occurred")}}},D_=r=>({id:r.id.toString(),title:r.title,description:r.description,features:typeof r.features=="string"?JSON.parse(r.features):r.features,icon:r.icon,eligibility:r.eligibility,category:r.category,directUrl:r.direct_url||void 0}),u0=r=>({title:r.title,description:r.description,features:JSON.stringify(r.features),icon:r.icon,eligibility:r.eligibility,category:r.category,directUrl:r.directUrl??null}),Fv=r=>({id:r.id.toString(),title:r.title,description:r.description,features:typeof r.features=="string"?JSON.parse(r.features):r.features,icon:r.icon,duration:r.duration,eligibility:r.eligibility,category:r.category,presentationUrl:r.presentation_url||void 0}),h0=r=>({title:r.title,description:r.description,features:JSON.stringify(r.features),icon:r.icon,duration:r.duration,eligibility:r.eligibility,category:r.category,presentation_url:r.presentationUrl||null}),Bv=r=>({id:r.id.toString(),name:r.name,description:r.description,category:r.category,price:r.price,features:typeof r.features=="string"?JSON.parse(r.features):r.features,image:r.image,status:r.status}),d0=r=>({name:r.name,description:r.description,category:r.category,price:r.price,features:JSON.stringify(r.features),image:r.image,status:r.status}),Vv=r=>({id:r.id.toString(),name:r.name,description:r.description,totalSize:r.total_size,currentRaise:r.current_raise,targetCompanies:r.target_companies,stage:r.stage,sectors:typeof r.sectors=="string"?JSON.parse(r.sectors):r.sectors,status:r.status}),f0=r=>({name:r.name,description:r.description,total_size:r.totalSize,current_raise:r.currentRaise,target_companies:r.targetCompanies,stage:r.stage,sectors:JSON.stringify(r.sectors),status:r.status}),Uv=r=>({id:r.id.toString(),companyName:r.company_name,industry:r.industry,description:r.description,challenge:r.challenge,solution:r.solution,results:typeof r.results=="string"?JSON.parse(r.results):r.results,image:r.image,testimonial:typeof r.testimonial=="string"?JSON.parse(r.testimonial):r.testimonial,tags:typeof r.tags=="string"?JSON.parse(r.tags):r.tags}),p0=r=>({company_name:r.companyName,industry:r.industry,description:r.description,challenge:r.challenge,solution:r.solution,results:JSON.stringify(r.results),image:r.image,testimonial:JSON.stringify(r.testimonial),tags:JSON.stringify(r.tags)}),$v=r=>({id:r.id.toString(),title:r.title,excerpt:r.excerpt,content:r.content,author:r.author,publishDate:r.publish_date,image:r.image,category:r.category,tags:typeof r.tags=="string"?JSON.parse(r.tags):r.tags}),m0=r=>({title:r.title,excerpt:r.excerpt,content:r.content,author:r.author,publish_date:r.publishDate,image:r.image,category:r.category,tags:JSON.stringify(r.tags)}),Hv=r=>({id:r.id.toString(),title:r.title,description:r.description,type:r.type,category:r.category,downloadUrl:r.download_url,image:r.image,tags:typeof r.tags=="string"?JSON.parse(r.tags):r.tags}),g0=r=>({title:r.title,description:r.description,type:r.type,category:r.category,download_url:r.downloadUrl,image:r.image,tags:JSON.stringify(r.tags)}),Gv=r=>({id:r.id.toString(),title:r.title,description:r.description,date:r.date,time:r.time,location:r.location,type:r.type,image:r.image,registrationUrl:r.registration_url}),y0=r=>({title:r.title,description:r.description,date:r.date,time:r.time,location:r.location,type:r.type,image:r.image,registration_url:r.registrationUrl}),qv=r=>({id:r.id.toString(),name:r.name,email:r.email,subject:r.subject,message:r.message,timestamp:r.timestamp,status:r.status}),KI=r=>({name:r.name,email:r.email,subject:r.subject,message:r.message,timestamp:r.timestamp,status:r.status}),Wv=r=>({id:r.id.toString(),name:r.name,position:r.position,bio:r.bio,image:r.image,linkedin_url:r.linkedin_url||void 0}),_0=r=>({name:r.name,position:r.position,bio:r.bio,image:r.image,linkedin_url:r.linkedin_url||null}),J6=[{id:"1",title:"Startup Incubation",description:"Transform your innovative idea into a viable business with our comprehensive incubation program.",features:["Mentorship from industry experts","Access to funding networks","Product development support","Business model validation","Legal and compliance guidance"],icon:"home",duration:"6-12 months",eligibility:"Early-stage startups with innovative ideas",category:"incubation",presentationUrl:"/presentations/startup-incubation.pdf"},{id:"2",title:"Acceleration Program",description:"Scale your startup rapidly with our intensive acceleration program designed for growth-ready companies.",features:["Growth strategy development","Market expansion support","Investor connections","Partnership facilitation","Performance tracking"],icon:"arrow-up",duration:"3-6 months",eligibility:"Startups with proven traction and revenue",category:"acceleration",presentationUrl:"/presentations/acceleration-program.pdf"},{id:"3",title:"Bootcamp Programs",description:"Intensive skill-building bootcamps covering essential startup competencies and technologies.",features:["Technical skill development","Business fundamentals","Pitch training","Team building workshops","Industry-specific training"],icon:"book",duration:"2-8 weeks",eligibility:"Entrepreneurs and startup team members",category:"mentorship"},{id:"4",title:"CXO Academy",description:"Executive leadership development program for startup founders and C-level executives.",features:["Leadership coaching","Strategic planning","Board management","Investor relations","Crisis management"],icon:"users",duration:"3-4 months",eligibility:"Startup founders and senior executives",category:"mentorship"}],Q6=[{id:"1",name:"StartupOS Platform",description:"All-in-one platform for managing your startup operations, from funding to team management.",category:"Software",price:"$99/month",features:["Investor dashboard","Team collaboration tools","Financial tracking","Milestone management","Document storage"],image:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=600&h=400&fit=crop",status:"active"},{id:"2",name:"Mentorship Marketplace",description:"Connect with experienced mentors and industry experts for personalized guidance.",category:"Service",price:"$149/month",features:["1-on-1 mentorship sessions","Industry expert network","Goal tracking","Progress analytics","Resource library"],image:"https://images.unsplash.com/photo-1600880292203-757bb62b4baf?w=600&h=400&fit=crop",status:"active"},{id:"3",name:"AI Analytics Suite",description:"Advanced AI-powered analytics and insights for data-driven decision making.",category:"Analytics",price:"$199/month",features:["Predictive analytics","Real-time dashboards","Custom reports","Data visualization","API integration"],image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=600&h=400&fit=crop",status:"coming-soon"}],eU=[{id:"1",name:"Betawaves Seed Fund I",description:"Early-stage fund focused on pre-seed and seed investments in innovative startups.",totalSize:"$50M",currentRaise:"$35M",targetCompanies:"25-30",stage:"Pre-seed to Seed",sectors:["FinTech","HealthTech","AI/ML","SaaS"],status:"fundraising"},{id:"2",name:"Betawaves Growth Fund",description:"Growth-stage fund for scaling proven startups with strong market traction.",totalSize:"$100M",currentRaise:"$100M",targetCompanies:"15-20",stage:"Series A to B",sectors:["Enterprise Software","CleanTech","E-commerce","EdTech"],status:"deployed"}],tU=[{id:"1",companyName:"TechFlow AI",industry:"Artificial Intelligence",description:"An AI-powered workflow automation platform for small businesses.",challenge:"TechFlow AI needed to validate their product-market fit and secure Series A funding.",solution:"Through our acceleration program, we helped them refine their go-to-market strategy and connect with key investors.",results:["Secured $2.5M Series A funding","Grew from 50 to 500+ enterprise customers","Expanded to 3 new markets","Built strategic partnerships with major tech companies"],image:"https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=600&h=400&fit=crop",testimonial:{quote:"Betawaves didn't just provide funding - they gave us the strategic guidance and network access that transformed our startup into a market leader.",author:"Sarah Chen",position:"CEO & Founder"},tags:["AI","B2B","Series A","Acceleration"]},{id:"2",companyName:"GreenEnergy Solutions",industry:"Clean Technology",description:"Sustainable energy solutions for residential and commercial properties.",challenge:"Needed technical expertise and regulatory guidance to bring their solar technology to market.",solution:"Our incubation program provided technical mentorship and helped navigate complex energy regulations.",results:["Successfully launched in 5 states","Achieved 40% cost reduction in manufacturing","Installed 1000+ solar systems","Won 3 industry innovation awards"],image:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=600&h=400&fit=crop",testimonial:{quote:"The technical mentorship and industry connections from Betawaves were crucial in helping us overcome regulatory hurdles and scale our operations.",author:"Michael Rodriguez",position:"CTO & Co-founder"},tags:["CleanTech","B2C","Incubation","Sustainability"]},{id:"3",companyName:"HealthTrack Pro",industry:"Healthcare Technology",description:"Digital health platform connecting patients with healthcare providers.",challenge:"Required HIPAA compliance expertise and healthcare industry partnerships.",solution:"Our CXO Academy helped the founders develop healthcare industry expertise and regulatory compliance.",results:["Achieved HIPAA compliance certification","Partnered with 50+ healthcare providers","Served 10,000+ patients","Reduced patient wait times by 60%"],image:"https://images.unsplash.com/photo-1649972904349-6e44c42644a7?w=600&h=400&fit=crop",testimonial:{quote:"The CXO Academy gave us the leadership skills and industry knowledge needed to navigate the complex healthcare landscape successfully.",author:"Dr. Emily Watson",position:"CEO & Founder"},tags:["HealthTech","B2B2C","CXO Academy","Compliance"]}],rU=[{id:"1",title:"The Future of Startup Funding: Trends to Watch in 2024",excerpt:"Explore the emerging trends in startup funding, from AI-driven due diligence to sustainable investing.",content:"The startup funding landscape is evolving rapidly...",author:"Alex Johnson",publishDate:"2024-01-15",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",category:"Funding",tags:["Funding","Trends","Investment","Startups"]},{id:"2",title:"Building a Winning Pitch Deck: A Comprehensive Guide",excerpt:"Learn how to create compelling pitch decks that capture investor attention and secure funding.",content:"A great pitch deck tells a story...",author:"Maria Santos",publishDate:"2024-01-10",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",category:"Resources",tags:["Pitch Deck","Investment","Presentation","Fundraising"]},{id:"3",title:"The Rise of AI in Startup Operations",excerpt:"How artificial intelligence is transforming startup operations and creating new opportunities.",content:"Artificial intelligence is no longer just a buzzword...",author:"David Kim",publishDate:"2024-01-05",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",category:"Technology",tags:["AI","Operations","Automation","Innovation"]}],nU=[{id:"1",title:"Startup Pitch Night",description:"Join us for an evening of innovative pitches from emerging startups seeking funding and partnerships.",date:"2024-02-15",time:"18:00",location:"Betawaves Innovation Hub, San Francisco",type:"pitch",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"2",title:"AI for Startups Workshop",description:"Learn how to integrate AI technologies into your startup to drive growth and efficiency.",date:"2024-02-20",time:"14:00",location:"Virtual Event",type:"workshop",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"3",title:"Founder Networking Mixer",description:"Connect with fellow entrepreneurs, investors, and industry experts in a relaxed networking environment.",date:"2024-02-25",time:"17:30",location:"TechHub Downtown, Austin",type:"networking",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",registrationUrl:"#"}],iU=[{id:"1",title:"Startup Pitch Deck Template",description:"Professional pitch deck template with 15 essential slides for fundraising success.",type:"pitch-deck",category:"Fundraising",downloadUrl:"/resources/pitch-deck-template.pdf",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",tags:["Pitch Deck","Template","Fundraising"]},{id:"2",title:"Financial Model Template",description:"Complete financial modeling spreadsheet with 3-year projections and scenario analysis.",type:"financial-model",category:"Finance",downloadUrl:"/resources/financial-model.xlsx",image:"https://images.unsplash.com/photo-1554224155-6726b3ff858f?w=600&h=400&fit=crop",tags:["Financial Model","Excel","Planning"]},{id:"3",title:"Market Research Guide",description:"Step-by-step guide to conducting effective market research for your startup.",type:"guide",category:"Research",downloadUrl:"/resources/market-research-guide.pdf",image:"https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=600&h=400&fit=crop",tags:["Market Research","Guide","Strategy"]}],sU=[{id:"1",name:"Sarah Johnson",position:"CEO & Founder",bio:"Former VP at Google Ventures with 15+ years in startup ecosystem. Led 50+ successful exits.",image:"https://images.unsplash.com/photo-1494790108755-2616b612b786?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/sarahjohnson"},{id:"2",name:"Michael Chen",position:"CTO & Co-founder",bio:"Tech veteran from Meta and Uber. Expert in scaling tech teams and building innovative products.",image:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/michaelchen"},{id:"3",name:"Emily Rodriguez",position:"Head of Programs",bio:"MBA from Stanford. Previously at Y Combinator, managed over 200 startup accelerations.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/emilyrodriguez"},{id:"4",name:"David Park",position:"Investment Director",bio:"Former Goldman Sachs analyst. Specialized in early-stage funding and venture capital.",image:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=400&fit=crop&crop=face",linkedin_url:"https://linkedin.com/in/davidpark"}],oU=[{id:"1",name:"Sarah Johnson",email:"sarah.johnson@techstartup.com",subject:"Inquiry about Incubation Program",message:"Hi, I'm interested in learning more about your incubation program. My startup is in the fintech space and we're looking for mentorship and funding opportunities.",timestamp:"2024-01-15T10:30:00Z",status:"unread"},{id:"2",name:"Michael Chen",email:"mike@innovativeai.com",subject:"Partnership Opportunity",message:"Hello, I represent an AI startup that has developed a revolutionary machine learning platform. We'd like to explore potential partnership opportunities with Betawaves.",timestamp:"2024-01-14T14:20:00Z",status:"read"},{id:"3",name:"Emily Rodriguez",email:"emily.r@greentech.io",subject:"Application Status Follow-up",message:"I submitted an application for the Acceleration Program last week and wanted to follow up on the status. Could you please provide an update?",timestamp:"2024-01-13T09:15:00Z",status:"replied"},{id:"4",name:"David Park",email:"david@healthinnovate.com",subject:"Speaking Opportunity",message:"I'd like to propose speaking at one of your upcoming events. I'm the founder of a successful healthtech startup and would love to share our journey.",timestamp:"2024-01-12T16:45:00Z",status:"unread"}],aU=[{id:"1",programId:"1",name:"John Smith",email:"john@startup.com",company:"TechFlow Solutions",phone:"+1234567890",message:"We are an early-stage fintech startup looking for incubation support.",timestamp:"2024-01-15T10:30:00Z",status:"pending"}],nl={async getServices(){try{return(await zr.get("/services")).map(Fv)}catch(r){return console.error("Error fetching services:",r),J6}},async createService(r){try{const t=h0(r),s=await zr.post("/services",t);return Fv(s)}catch(t){throw console.error("Error creating service:",t),new Error("Failed to create service")}},async updateService(r,t){try{const s=h0(t),l=await zr.put(`/services/${r}`,s);return Fv(l)}catch(s){throw console.error("Error updating service:",s),new Error("Failed to update service")}},async deleteService(r){try{await zr.delete(`/services/${r}`)}catch(t){throw console.error("Error deleting service:",t),new Error("Failed to delete service")}},async getConsulting(){try{return(await zr.get("/consulting")).map(D_)}catch(r){return console.error("Error fetching consulting:",r),[]}},async getConsultings(){return(await zr.get("/consultings")).map(D_)},async createConsulting(r){try{const t=u0(r),s=await zr.post("/consulting",t);return D_(s)}catch(t){throw console.error("Error creating consulting entry:",t),new Error("Failed to create consulting")}},async updateConsulting(r,t){try{const s=u0(t),l=await zr.put(`/consulting/${r}`,s);return D_(l)}catch(s){throw console.error("Error updating consulting entry:",s),new Error("Failed to update consulting")}},async deleteConsulting(r){try{await zr.delete(`/consulting/${r}`)}catch(t){throw console.error("Error deleting consulting entry:",t),new Error("Failed to delete consulting")}},async getProducts(){try{return(await zr.get("/products")).map(Bv)}catch(r){return console.error("Error fetching products:",r),Q6}},async createProduct(r){try{const t=d0(r),s=await zr.post("/products",t);return Bv(s)}catch(t){throw console.error("Error creating product:",t),new Error("Failed to create product")}},async updateProduct(r,t){try{const s=d0(t),l=await zr.put(`/products/${r}`,s);return Bv(l)}catch(s){throw console.error("Error updating product:",s),new Error("Failed to update product")}},async deleteProduct(r){try{await zr.delete(`/products/${r}`)}catch(t){throw console.error("Error deleting product:",t),new Error("Failed to delete product")}},async getFunds(){try{return(await zr.get("/funds")).map(Vv)}catch(r){return console.error("Error fetching funds:",r),eU}},async createFund(r){try{const t=f0(r),s=await zr.post("/funds",t);return Vv(s)}catch(t){throw console.error("Error creating fund:",t),new Error("Failed to create fund")}},async updateFund(r,t){try{const s=f0(t),l=await zr.put(`/funds/${r}`,s);return Vv(l)}catch(s){throw console.error("Error updating fund:",s),new Error("Failed to update fund")}},async deleteFund(r){try{await zr.delete(`/funds/${r}`)}catch(t){throw console.error("Error deleting fund:",t),new Error("Failed to delete fund")}},async getCaseStudies(){try{return(await zr.get("/case-studies")).map(Uv)}catch(r){return console.error("Error fetching case studies:",r),tU}},async createCaseStudy(r){try{const t=p0(r),s=await zr.post("/case-studies",t);return Uv(s)}catch(t){throw console.error("Error creating case study:",t),new Error("Failed to create case study")}},async updateCaseStudy(r,t){try{const s=p0(t),l=await zr.put(`/case-studies/${r}`,s);return Uv(l)}catch(s){throw console.error("Error updating case study:",s),new Error("Failed to update case study")}},async deleteCaseStudy(r){try{await zr.delete(`/case-studies/${r}`)}catch(t){throw console.error("Error deleting case study:",t),new Error("Failed to delete case study")}},async getBlogPosts(){try{return(await zr.get("/blog-posts")).map($v)}catch(r){return console.error("Error fetching blog posts:",r),rU}},async createBlogPost(r){try{const t=m0(r),s=await zr.post("/blog-posts",t);return $v(s)}catch(t){throw console.error("Error creating blog post:",t),new Error("Failed to create blog post")}},async updateBlogPost(r,t){try{const s=m0(t),l=await zr.put(`/blog-posts/${r}`,s);return $v(l)}catch(s){throw console.error("Error updating blog post:",s),new Error("Failed to update blog post")}},async deleteBlogPost(r){try{await zr.delete(`/blog-posts/${r}`)}catch(t){throw console.error("Error deleting blog post:",t),new Error("Failed to delete blog post")}},async getEvents(){try{return(await zr.get("/events")).map(Gv)}catch(r){return console.error("Error fetching events:",r),nU}},async createEvent(r){try{const t=y0(r),s=await zr.post("/events",t);return Gv(s)}catch(t){throw console.error("Error creating event:",t),new Error("Failed to create event")}},async updateEvent(r,t){try{const s=y0(t),l=await zr.put(`/events/${r}`,s);return Gv(l)}catch(s){throw console.error("Error updating event:",s),new Error("Failed to update event")}},async deleteEvent(r){try{await zr.delete(`/events/${r}`)}catch(t){throw console.error("Error deleting event:",t),new Error("Failed to delete event")}},async getContactMessages(){try{return(await zr.get("/contact-messages")).map(qv)}catch(r){return console.error("Error fetching contact messages:",r),oU}},async createContactMessage(r){try{const t=KI(r),s=await zr.post("/contact-messages",t);return qv(s)}catch(t){throw console.error("Error creating contact message:",t),new Error("Failed to create contact message")}},async updateContactMessage(r,t){try{const s=KI(t),l=await zr.put(`/contact-messages/${r}`,s);return qv(l)}catch(s){throw console.error("Error updating contact message:",s),new Error("Failed to update contact message")}},async deleteContactMessage(r){try{await zr.delete(`/contact-messages/${r}`)}catch(t){throw console.error("Error deleting contact message:",t),new Error("Failed to delete contact message")}},async getResources(){try{return(await zr.get("/resources")).map(Hv)}catch(r){return console.error("Error fetching resources:",r),iU}},async createResource(r){try{const t=g0(r),s=await zr.post("/resources",t);return Hv(s)}catch(t){throw console.error("Error creating resource:",t),new Error("Failed to create resource")}},async updateResource(r,t){try{const s=g0(t),l=await zr.put(`/resources/${r}`,s);return Hv(l)}catch(s){throw console.error("Error updating resource:",s),new Error("Failed to update resource")}},async deleteResource(r){try{await zr.delete(`/resources/${r}`)}catch(t){throw console.error("Error deleting resource:",t),new Error("Failed to delete resource")}},async getTeamMembers(){try{return(await zr.get("/team-members")).map(Wv)}catch(r){return console.error("Error fetching team members:",r),sU}},async createTeamMember(r){try{const t=_0(r),s=await zr.post("/team-members",t);return Wv(s)}catch(t){throw console.error("Error creating team member:",t),new Error("Failed to create team member")}},async updateTeamMember(r,t){try{const s=_0(t),l=await zr.put(`/team-members/${r}`,s);return Wv(l)}catch(s){throw console.error("Error updating team member:",s),new Error("Failed to update team member")}},async deleteTeamMember(r){try{await zr.delete(`/team-members/${r}`)}catch(t){throw console.error("Error deleting team member:",t),new Error("Failed to delete team member")}},async getProgramApplications(){try{return(await zr.get("/program-applications")).map(t=>({id:t.id.toString(),programId:t.program_id.toString(),name:t.name,email:t.email,company:t.company,phone:t.phone,message:t.message,timestamp:t.timestamp,status:t.status}))}catch(r){return console.error("Error fetching program applications:",r),aU}},async createProgramApplication(r){try{const t={program_id:parseInt(r.programId),name:r.name,email:r.email,company:r.company,phone:r.phone,message:r.message,timestamp:r.timestamp,status:r.status},s=await zr.post("/program-applications",t);return{id:s.id.toString(),programId:s.program_id.toString(),name:s.name,email:s.email,company:s.company,phone:s.phone,message:s.message,timestamp:s.timestamp,status:s.status}}catch(t){throw console.error("Error creating program application:",t),new Error("Failed to create program application")}},async updateProgramApplication(r,t){try{const s={program_id:parseInt(t.programId),name:t.name,email:t.email,company:t.company,phone:t.phone,message:t.message,timestamp:t.timestamp,status:t.status},l=await zr.put(`/program-applications/${r}`,s);return{id:l.id.toString(),programId:l.program_id.toString(),name:l.name,email:l.email,company:l.company,phone:l.phone,message:l.message,timestamp:l.timestamp,status:l.status}}catch(s){throw console.error("Error updating program application:",s),new Error("Failed to update program application")}},async deleteProgramApplication(r){try{await zr.delete(`/program-applications/${r}`)}catch(t){throw console.error("Error deleting program application:",t),new Error("Failed to delete program application")}},async getPopup(){try{return await zr.get("/popup")}catch(r){return console.error("Error fetching popup:",r),null}},updatePopup:async r=>{const t=new FormData;Object.entries(r).forEach(([s,l])=>{s==="image"&&l instanceof File?t.append("image",l):t.append(s,String(l))}),await fetch("https://betawaves-back.4bzwio.easypanel.host/api/popup/update",{method:"POST",body:t})}},lU=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState(!1),h=ee.useRef(null);ee.useEffect(()=>{(async()=>{try{const A=(await nl.getTeamMembers()).map(P=>({...P,linkedIn:P.linkedin_url}));t(A)}catch(i){console.error("Error fetching team members:",i)}})()},[]),ee.useEffect(()=>{const v=setInterval(()=>{if(h.current){const i=h.current,A=i.scrollWidth-i.clientWidth;i.scrollLeft>=A?i.scrollTo({left:0,behavior:"smooth"}):i.scrollBy({left:300,behavior:"smooth"})}},5e3);return()=>clearInterval(v)},[]);const m=s?r:r.slice(0,4);return b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:["Meet Our ",b.jsx("span",{className:"gradient-text",children:"Team"})]}),b.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our experienced team of entrepreneurs, investors, and industry experts are dedicated to your startup's success"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:m.map(v=>b.jsx(Rn,{className:"text-center flex flex-col justify-between hover:shadow-lg transition-shadow group",children:b.jsxs(Qn,{className:"p-6 flex flex-col flex-grow justify-between",children:[b.jsx("div",{className:"relative mb-6",children:b.jsx("img",{src:v.image,alt:v.name,className:"w-24 h-24 rounded-full mx-auto object-cover group-hover:scale-105 transition-transform"})}),b.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:v.name}),b.jsx("p",{className:"text-primary font-medium mb-3",children:v.position}),b.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:v.bio}),v.linkedin_url&&b.jsx("div",{className:"mt-4",children:b.jsx("a",{href:v.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Connect on LinkedIn "})})]})},v.id))}),r.length>4&&b.jsx("div",{className:"text-center mt-8",children:b.jsx("button",{onClick:()=>l(v=>!v),className:"text-primary hover:text-primary/80 font-medium text-sm",children:s?"See Less ":"See More "})})]})})},cU=({companies:r})=>b.jsxs("div",{className:"bg-[#1872f2] py-4 overflow-hidden",children:[b.jsx("div",{className:"relative w-full",children:b.jsx("div",{className:"marquee-content flex animate-marquee",children:[...r,...r].map((t,s)=>b.jsx("span",{className:"text-lg font-medium text-white mx-8 whitespace-nowrap",children:t},`${t}-${s}`))})}),b.jsx("style",{children:`
          @keyframes marquee {
            0% {
              transform: translateX(0%);
            }
            100% {
              transform: translateX(-50%);
            }
          }

          .marquee-content {
            width: max-content;
          }

          .animate-marquee {
            animation: marquee 15s linear infinite;
            display: flex;
          }
        `})]}),uU=({collaborators:r})=>b.jsx("div",{className:"bg-gray-50 py-6",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-6",children:"Our Partners"}),b.jsx("div",{className:"flex flex-wrap justify-center items-center gap-4",children:r.map(t=>b.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"w-32",children:b.jsx("div",{className:"bg-white rounded-lg shadow p-3 h-24 flex items-center justify-center hover:shadow-md transition-shadow",children:b.jsx("img",{src:t.logo,alt:t.name,className:"max-h-full max-w-full object-contain"})})},t.id))})]})})});var pw="focusScope.autoFocusOnMount",mw="focusScope.autoFocusOnUnmount",YI={bubbles:!1,cancelable:!0},hU="FocusScope",kT=ee.forwardRef((r,t)=>{const{loop:s=!1,trapped:l=!1,onMountAutoFocus:h,onUnmountAutoFocus:m,...v}=r,[i,A]=ee.useState(null),P=Jl(h),D=Jl(m),F=ee.useRef(null),$=xs(t,W=>A(W)),K=ee.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;ee.useEffect(()=>{if(l){let W=function(Fe){if(K.paused||!i)return;const ht=Fe.target;i.contains(ht)?F.current=ht:Rp(F.current,{select:!0})},ie=function(Fe){if(K.paused||!i)return;const ht=Fe.relatedTarget;ht!==null&&(i.contains(ht)||Rp(F.current,{select:!0}))},fe=function(Fe){if(document.activeElement===document.body)for(const at of Fe)at.removedNodes.length>0&&Rp(i)};document.addEventListener("focusin",W),document.addEventListener("focusout",ie);const Pe=new MutationObserver(fe);return i&&Pe.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",W),document.removeEventListener("focusout",ie),Pe.disconnect()}}},[l,i,K.paused]),ee.useEffect(()=>{if(i){QI.add(K);const W=document.activeElement;if(!i.contains(W)){const fe=new CustomEvent(pw,YI);i.addEventListener(pw,P),i.dispatchEvent(fe),fe.defaultPrevented||(dU(yU(TR(i)),{select:!0}),document.activeElement===W&&Rp(i))}return()=>{i.removeEventListener(pw,P),setTimeout(()=>{const fe=new CustomEvent(mw,YI);i.addEventListener(mw,D),i.dispatchEvent(fe),fe.defaultPrevented||Rp(W??document.body,{select:!0}),i.removeEventListener(mw,D),QI.remove(K)},0)}}},[i,P,D,K]);const J=ee.useCallback(W=>{if(!s&&!l||K.paused)return;const ie=W.key==="Tab"&&!W.altKey&&!W.ctrlKey&&!W.metaKey,fe=document.activeElement;if(ie&&fe){const Pe=W.currentTarget,[Fe,ht]=fU(Pe);Fe&&ht?!W.shiftKey&&fe===ht?(W.preventDefault(),s&&Rp(Fe,{select:!0})):W.shiftKey&&fe===Fe&&(W.preventDefault(),s&&Rp(ht,{select:!0})):fe===Pe&&W.preventDefault()}},[s,l,K.paused]);return b.jsx(vi.div,{tabIndex:-1,...v,ref:$,onKeyDown:J})});kT.displayName=hU;function dU(r,{select:t=!1}={}){const s=document.activeElement;for(const l of r)if(Rp(l,{select:t}),document.activeElement!==s)return}function fU(r){const t=TR(r),s=JI(t,r),l=JI(t.reverse(),r);return[s,l]}function TR(r){const t=[],s=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const h=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||h?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function JI(r,t){for(const s of r)if(!pU(s,{upTo:t}))return s}function pU(r,{upTo:t}){if(getComputedStyle(r).visibility==="hidden")return!0;for(;r;){if(t!==void 0&&r===t)return!1;if(getComputedStyle(r).display==="none")return!0;r=r.parentElement}return!1}function mU(r){return r instanceof HTMLInputElement&&"select"in r}function Rp(r,{select:t=!1}={}){if(r&&r.focus){const s=document.activeElement;r.focus({preventScroll:!0}),r!==s&&mU(r)&&t&&r.select()}}var QI=gU();function gU(){let r=[];return{add(t){const s=r[0];t!==s&&s?.pause(),r=eM(r,t),r.unshift(t)},remove(t){r=eM(r,t),r[0]?.resume()}}}function eM(r,t){const s=[...r],l=s.indexOf(t);return l!==-1&&s.splice(l,1),s}function yU(r){return r.filter(t=>t.tagName!=="A")}var gw=0;function ER(){ee.useEffect(()=>{const r=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",r[0]??tM()),document.body.insertAdjacentElement("beforeend",r[1]??tM()),gw++,()=>{gw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),gw--}},[])}function tM(){const r=document.createElement("span");return r.setAttribute("data-radix-focus-guard",""),r.tabIndex=0,r.style.outline="none",r.style.opacity="0",r.style.position="fixed",r.style.pointerEvents="none",r}var fd=function(){return fd=Object.assign||function(t){for(var s,l=1,h=arguments.length;l<h;l++){s=arguments[l];for(var m in s)Object.prototype.hasOwnProperty.call(s,m)&&(t[m]=s[m])}return t},fd.apply(this,arguments)};function CR(r,t){var s={};for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&t.indexOf(l)<0&&(s[l]=r[l]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,l=Object.getOwnPropertySymbols(r);h<l.length;h++)t.indexOf(l[h])<0&&Object.prototype.propertyIsEnumerable.call(r,l[h])&&(s[l[h]]=r[l[h]]);return s}function _U(r,t,s){if(s||arguments.length===2)for(var l=0,h=t.length,m;l<h;l++)(m||!(l in t))&&(m||(m=Array.prototype.slice.call(t,0,l)),m[l]=t[l]);return r.concat(m||Array.prototype.slice.call(t))}var Zv="right-scroll-bar-position",Xv="width-before-scroll-bar",xU="with-scroll-bars-hidden",vU="--removed-body-scroll-bar-size";function yw(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function bU(r,t){var s=ee.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(l){var h=s.value;h!==l&&(s.value=l,s.callback(l,h))}}}})[0];return s.callback=t,s.facade}var wU=typeof window<"u"?ee.useLayoutEffect:ee.useEffect,rM=new WeakMap;function SU(r,t){var s=bU(null,function(l){return r.forEach(function(h){return yw(h,l)})});return wU(function(){var l=rM.get(s);if(l){var h=new Set(l),m=new Set(r),v=s.current;h.forEach(function(i){m.has(i)||yw(i,null)}),m.forEach(function(i){h.has(i)||yw(i,v)})}rM.set(s,r)},[r]),s}function TU(r){return r}function EU(r,t){t===void 0&&(t=TU);var s=[],l=!1,h={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(m){var v=t(m,l);return s.push(v),function(){s=s.filter(function(i){return i!==v})}},assignSyncMedium:function(m){for(l=!0;s.length;){var v=s;s=[],v.forEach(m)}s={push:function(i){return m(i)},filter:function(){return s}}},assignMedium:function(m){l=!0;var v=[];if(s.length){var i=s;s=[],i.forEach(m),v=s}var A=function(){var D=v;v=[],D.forEach(m)},P=function(){return Promise.resolve().then(A)};P(),s={push:function(D){v.push(D),P()},filter:function(D){return v=v.filter(D),s}}}};return h}function CU(r){r===void 0&&(r={});var t=EU(null);return t.options=fd({async:!0,ssr:!1},r),t}var AR=function(r){var t=r.sideCar,s=CR(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=t.read();if(!l)throw new Error("Sidecar medium not found");return ee.createElement(l,fd({},s))};AR.isSideCarExport=!0;function AU(r,t){return r.useMedium(t),AR}var IR=CU(),_w=function(){},S1=ee.forwardRef(function(r,t){var s=ee.useRef(null),l=ee.useState({onScrollCapture:_w,onWheelCapture:_w,onTouchMoveCapture:_w}),h=l[0],m=l[1],v=r.forwardProps,i=r.children,A=r.className,P=r.removeScrollBar,D=r.enabled,F=r.shards,$=r.sideCar,K=r.noIsolation,J=r.inert,W=r.allowPinchZoom,ie=r.as,fe=ie===void 0?"div":ie,Pe=r.gapMode,Fe=CR(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ht=$,at=SU([s,t]),Dt=fd(fd({},Fe),h);return ee.createElement(ee.Fragment,null,D&&ee.createElement(ht,{sideCar:IR,removeScrollBar:P,shards:F,noIsolation:K,inert:J,setCallbacks:m,allowPinchZoom:!!W,lockRef:s,gapMode:Pe}),v?ee.cloneElement(ee.Children.only(i),fd(fd({},Dt),{ref:at})):ee.createElement(fe,fd({},Dt,{className:A,ref:at}),i))});S1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};S1.classNames={fullWidth:Xv,zeroRight:Zv};var IU=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function MU(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=IU();return t&&r.setAttribute("nonce",t),r}function kU(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function PU(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var RU=function(){var r=0,t=null;return{add:function(s){r==0&&(t=MU())&&(kU(t,s),PU(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},NU=function(){var r=RU();return function(t,s){ee.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},MR=function(){var r=NU(),t=function(s){var l=s.styles,h=s.dynamic;return r(l,h),null};return t},DU={left:0,top:0,right:0,gap:0},xw=function(r){return parseInt(r||"",10)||0},OU=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],l=t[r==="padding"?"paddingTop":"marginTop"],h=t[r==="padding"?"paddingRight":"marginRight"];return[xw(s),xw(l),xw(h)]},LU=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return DU;var t=OU(r),s=document.documentElement.clientWidth,l=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,l-s+t[2]-t[0])}},zU=MR(),yy="data-scroll-locked",jU=function(r,t,s,l){var h=r.left,m=r.top,v=r.right,i=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(xU,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(i,"px ").concat(l,`;
  }
  body[`).concat(yy,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(l,";"),s==="margin"&&`
    padding-left: `.concat(h,`px;
    padding-top: `).concat(m,`px;
    padding-right: `).concat(v,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(l,`;
    `),s==="padding"&&"padding-right: ".concat(i,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Zv,` {
    right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(Xv,` {
    margin-right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(Zv," .").concat(Zv,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(Xv," .").concat(Xv,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(yy,`] {
    `).concat(vU,": ").concat(i,`px;
  }
`)},nM=function(){var r=parseInt(document.body.getAttribute(yy)||"0",10);return isFinite(r)?r:0},FU=function(){ee.useEffect(function(){return document.body.setAttribute(yy,(nM()+1).toString()),function(){var r=nM()-1;r<=0?document.body.removeAttribute(yy):document.body.setAttribute(yy,r.toString())}},[])},BU=function(r){var t=r.noRelative,s=r.noImportant,l=r.gapMode,h=l===void 0?"margin":l;FU();var m=ee.useMemo(function(){return LU(h)},[h]);return ee.createElement(zU,{styles:jU(m,!t,h,s?"":"!important")})},wS=!1;if(typeof window<"u")try{var bv=Object.defineProperty({},"passive",{get:function(){return wS=!0,!0}});window.addEventListener("test",bv,bv),window.removeEventListener("test",bv,bv)}catch{wS=!1}var iy=wS?{passive:!1}:!1,VU=function(r){return r.tagName==="TEXTAREA"},kR=function(r,t){if(!(r instanceof Element))return!1;var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!VU(r)&&s[t]==="visible")},UU=function(r){return kR(r,"overflowY")},$U=function(r){return kR(r,"overflowX")},iM=function(r,t){var s=t.ownerDocument,l=t;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var h=PR(r,l);if(h){var m=RR(r,l),v=m[1],i=m[2];if(v>i)return!0}l=l.parentNode}while(l&&l!==s.body);return!1},HU=function(r){var t=r.scrollTop,s=r.scrollHeight,l=r.clientHeight;return[t,s,l]},GU=function(r){var t=r.scrollLeft,s=r.scrollWidth,l=r.clientWidth;return[t,s,l]},PR=function(r,t){return r==="v"?UU(t):$U(t)},RR=function(r,t){return r==="v"?HU(t):GU(t)},qU=function(r,t){return r==="h"&&t==="rtl"?-1:1},WU=function(r,t,s,l,h){var m=qU(r,window.getComputedStyle(t).direction),v=m*l,i=s.target,A=t.contains(i),P=!1,D=v>0,F=0,$=0;do{var K=RR(r,i),J=K[0],W=K[1],ie=K[2],fe=W-ie-m*J;(J||fe)&&PR(r,i)&&(F+=fe,$+=J),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!A&&i!==document.body||A&&(t.contains(i)||t===i));return(D&&Math.abs(F)<1||!D&&Math.abs($)<1)&&(P=!0),P},wv=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},sM=function(r){return[r.deltaX,r.deltaY]},oM=function(r){return r&&"current"in r?r.current:r},ZU=function(r,t){return r[0]===t[0]&&r[1]===t[1]},XU=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},KU=0,sy=[];function YU(r){var t=ee.useRef([]),s=ee.useRef([0,0]),l=ee.useRef(),h=ee.useState(KU++)[0],m=ee.useState(MR)[0],v=ee.useRef(r);ee.useEffect(function(){v.current=r},[r]),ee.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(h));var W=_U([r.lockRef.current],(r.shards||[]).map(oM),!0).filter(Boolean);return W.forEach(function(ie){return ie.classList.add("allow-interactivity-".concat(h))}),function(){document.body.classList.remove("block-interactivity-".concat(h)),W.forEach(function(ie){return ie.classList.remove("allow-interactivity-".concat(h))})}}},[r.inert,r.lockRef.current,r.shards]);var i=ee.useCallback(function(W,ie){if("touches"in W&&W.touches.length===2||W.type==="wheel"&&W.ctrlKey)return!v.current.allowPinchZoom;var fe=wv(W),Pe=s.current,Fe="deltaX"in W?W.deltaX:Pe[0]-fe[0],ht="deltaY"in W?W.deltaY:Pe[1]-fe[1],at,Dt=W.target,kt=Math.abs(Fe)>Math.abs(ht)?"h":"v";if("touches"in W&&kt==="h"&&Dt.type==="range")return!1;var Rt=iM(kt,Dt);if(!Rt)return!0;if(Rt?at=kt:(at=kt==="v"?"h":"v",Rt=iM(kt,Dt)),!Rt)return!1;if(!l.current&&"changedTouches"in W&&(Fe||ht)&&(l.current=at),!at)return!0;var hr=l.current||at;return WU(hr,ie,W,hr==="h"?Fe:ht)},[]),A=ee.useCallback(function(W){var ie=W;if(!(!sy.length||sy[sy.length-1]!==m)){var fe="deltaY"in ie?sM(ie):wv(ie),Pe=t.current.filter(function(at){return at.name===ie.type&&(at.target===ie.target||ie.target===at.shadowParent)&&ZU(at.delta,fe)})[0];if(Pe&&Pe.should){ie.cancelable&&ie.preventDefault();return}if(!Pe){var Fe=(v.current.shards||[]).map(oM).filter(Boolean).filter(function(at){return at.contains(ie.target)}),ht=Fe.length>0?i(ie,Fe[0]):!v.current.noIsolation;ht&&ie.cancelable&&ie.preventDefault()}}},[]),P=ee.useCallback(function(W,ie,fe,Pe){var Fe={name:W,delta:ie,target:fe,should:Pe,shadowParent:JU(fe)};t.current.push(Fe),setTimeout(function(){t.current=t.current.filter(function(ht){return ht!==Fe})},1)},[]),D=ee.useCallback(function(W){s.current=wv(W),l.current=void 0},[]),F=ee.useCallback(function(W){P(W.type,sM(W),W.target,i(W,r.lockRef.current))},[]),$=ee.useCallback(function(W){P(W.type,wv(W),W.target,i(W,r.lockRef.current))},[]);ee.useEffect(function(){return sy.push(m),r.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:$}),document.addEventListener("wheel",A,iy),document.addEventListener("touchmove",A,iy),document.addEventListener("touchstart",D,iy),function(){sy=sy.filter(function(W){return W!==m}),document.removeEventListener("wheel",A,iy),document.removeEventListener("touchmove",A,iy),document.removeEventListener("touchstart",D,iy)}},[]);var K=r.removeScrollBar,J=r.inert;return ee.createElement(ee.Fragment,null,J?ee.createElement(m,{styles:XU(h)}):null,K?ee.createElement(BU,{gapMode:r.gapMode}):null)}function JU(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const QU=AU(IR,YU);var PT=ee.forwardRef(function(r,t){return ee.createElement(S1,fd({},r,{ref:t,sideCar:QU}))});PT.classNames=S1.classNames;var e8=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},oy=new WeakMap,Sv=new WeakMap,Tv={},vw=0,NR=function(r){return r&&(r.host||NR(r.parentNode))},t8=function(r,t){return t.map(function(s){if(r.contains(s))return s;var l=NR(s);return l&&r.contains(l)?l:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},r8=function(r,t,s,l){var h=t8(t,Array.isArray(r)?r:[r]);Tv[s]||(Tv[s]=new WeakMap);var m=Tv[s],v=[],i=new Set,A=new Set(h),P=function(F){!F||i.has(F)||(i.add(F),P(F.parentNode))};h.forEach(P);var D=function(F){!F||A.has(F)||Array.prototype.forEach.call(F.children,function($){if(i.has($))D($);else try{var K=$.getAttribute(l),J=K!==null&&K!=="false",W=(oy.get($)||0)+1,ie=(m.get($)||0)+1;oy.set($,W),m.set($,ie),v.push($),W===1&&J&&Sv.set($,!0),ie===1&&$.setAttribute(s,"true"),J||$.setAttribute(l,"true")}catch(fe){console.error("aria-hidden: cannot operate on ",$,fe)}})};return D(t),i.clear(),vw++,function(){v.forEach(function(F){var $=oy.get(F)-1,K=m.get(F)-1;oy.set(F,$),m.set(F,K),$||(Sv.has(F)||F.removeAttribute(l),Sv.delete(F)),K||F.removeAttribute(s)}),vw--,vw||(oy=new WeakMap,oy=new WeakMap,Sv=new WeakMap,Tv={})}},DR=function(r,t,s){s===void 0&&(s="data-aria-hidden");var l=Array.from(Array.isArray(r)?r:[r]),h=e8(r);return h?(l.push.apply(l,Array.from(h.querySelectorAll("[aria-live]"))),r8(l,h,s,"aria-hidden")):function(){return null}},RT="Dialog",[OR,pX]=Ry(RT),[n8,mh]=OR(RT),LR=r=>{const{__scopeDialog:t,children:s,open:l,defaultOpen:h,onOpenChange:m,modal:v=!0}=r,i=ee.useRef(null),A=ee.useRef(null),[P=!1,D]=hg({prop:l,defaultProp:h,onChange:m});return b.jsx(n8,{scope:t,triggerRef:i,contentRef:A,contentId:$p(),titleId:$p(),descriptionId:$p(),open:P,onOpenChange:D,onOpenToggle:ee.useCallback(()=>D(F=>!F),[D]),modal:v,children:s})};LR.displayName=RT;var zR="DialogTrigger",jR=ee.forwardRef((r,t)=>{const{__scopeDialog:s,...l}=r,h=mh(zR,s),m=xs(t,h.triggerRef);return b.jsx(vi.button,{type:"button","aria-haspopup":"dialog","aria-expanded":h.open,"aria-controls":h.contentId,"data-state":OT(h.open),...l,ref:m,onClick:jn(r.onClick,h.onOpenToggle)})});jR.displayName=zR;var NT="DialogPortal",[i8,FR]=OR(NT,{forceMount:void 0}),BR=r=>{const{__scopeDialog:t,forceMount:s,children:l,container:h}=r,m=mh(NT,t);return b.jsx(i8,{scope:t,forceMount:s,children:ee.Children.map(l,v=>b.jsx(wg,{present:s||m.open,children:b.jsx(u1,{asChild:!0,container:h,children:v})}))})};BR.displayName=NT;var x0="DialogOverlay",VR=ee.forwardRef((r,t)=>{const s=FR(x0,r.__scopeDialog),{forceMount:l=s.forceMount,...h}=r,m=mh(x0,r.__scopeDialog);return m.modal?b.jsx(wg,{present:l||m.open,children:b.jsx(s8,{...h,ref:t})}):null});VR.displayName=x0;var s8=ee.forwardRef((r,t)=>{const{__scopeDialog:s,...l}=r,h=mh(x0,s);return b.jsx(PT,{as:ug,allowPinchZoom:!0,shards:[h.contentRef],children:b.jsx(vi.div,{"data-state":OT(h.open),...l,ref:t,style:{pointerEvents:"auto",...l.style}})})}),mg="DialogContent",UR=ee.forwardRef((r,t)=>{const s=FR(mg,r.__scopeDialog),{forceMount:l=s.forceMount,...h}=r,m=mh(mg,r.__scopeDialog);return b.jsx(wg,{present:l||m.open,children:m.modal?b.jsx(o8,{...h,ref:t}):b.jsx(a8,{...h,ref:t})})});UR.displayName=mg;var o8=ee.forwardRef((r,t)=>{const s=mh(mg,r.__scopeDialog),l=ee.useRef(null),h=xs(t,s.contentRef,l);return ee.useEffect(()=>{const m=l.current;if(m)return DR(m)},[]),b.jsx($R,{...r,ref:h,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:jn(r.onCloseAutoFocus,m=>{m.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:jn(r.onPointerDownOutside,m=>{const v=m.detail.originalEvent,i=v.button===0&&v.ctrlKey===!0;(v.button===2||i)&&m.preventDefault()}),onFocusOutside:jn(r.onFocusOutside,m=>m.preventDefault())})}),a8=ee.forwardRef((r,t)=>{const s=mh(mg,r.__scopeDialog),l=ee.useRef(!1),h=ee.useRef(!1);return b.jsx($R,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{r.onCloseAutoFocus?.(m),m.defaultPrevented||(l.current||s.triggerRef.current?.focus(),m.preventDefault()),l.current=!1,h.current=!1},onInteractOutside:m=>{r.onInteractOutside?.(m),m.defaultPrevented||(l.current=!0,m.detail.originalEvent.type==="pointerdown"&&(h.current=!0));const v=m.target;s.triggerRef.current?.contains(v)&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&h.current&&m.preventDefault()}})}),$R=ee.forwardRef((r,t)=>{const{__scopeDialog:s,trapFocus:l,onOpenAutoFocus:h,onCloseAutoFocus:m,...v}=r,i=mh(mg,s),A=ee.useRef(null),P=xs(t,A);return ER(),b.jsxs(b.Fragment,{children:[b.jsx(kT,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:h,onUnmountAutoFocus:m,children:b.jsx(px,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":OT(i.open),...v,ref:P,onDismiss:()=>i.onOpenChange(!1)})}),b.jsxs(b.Fragment,{children:[b.jsx(l8,{titleId:i.titleId}),b.jsx(u8,{contentRef:A,descriptionId:i.descriptionId})]})]})}),DT="DialogTitle",HR=ee.forwardRef((r,t)=>{const{__scopeDialog:s,...l}=r,h=mh(DT,s);return b.jsx(vi.h2,{id:h.titleId,...l,ref:t})});HR.displayName=DT;var GR="DialogDescription",qR=ee.forwardRef((r,t)=>{const{__scopeDialog:s,...l}=r,h=mh(GR,s);return b.jsx(vi.p,{id:h.descriptionId,...l,ref:t})});qR.displayName=GR;var WR="DialogClose",ZR=ee.forwardRef((r,t)=>{const{__scopeDialog:s,...l}=r,h=mh(WR,s);return b.jsx(vi.button,{type:"button",...l,ref:t,onClick:jn(r.onClick,()=>h.onOpenChange(!1))})});ZR.displayName=WR;function OT(r){return r?"open":"closed"}var XR="DialogTitleWarning",[mX,KR]=vF(XR,{contentName:mg,titleName:DT,docsSlug:"dialog"}),l8=({titleId:r})=>{const t=KR(XR),s=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return ee.useEffect(()=>{r&&(document.getElementById(r)||console.error(s))},[s,r]),null},c8="DialogDescriptionWarning",u8=({contentRef:r,descriptionId:t})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${KR(c8).contentName}}.`;return ee.useEffect(()=>{const h=r.current?.getAttribute("aria-describedby");t&&h&&(document.getElementById(t)||console.warn(l))},[l,r,t]),null},h8=LR,d8=jR,f8=BR,YR=VR,JR=UR,QR=HR,eN=qR,p8=ZR;const ol=h8,LT=d8,m8=f8,tN=ee.forwardRef(({className:r,...t},s)=>b.jsx(YR,{ref:s,className:ki("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));tN.displayName=YR.displayName;const Fa=ee.forwardRef(({className:r,children:t,...s},l)=>b.jsxs(m8,{children:[b.jsx(tN,{}),b.jsxs(JR,{ref:l,className:ki("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...s,children:[t,b.jsxs(p8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[b.jsx(p1,{className:"h-4 w-4"}),b.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Fa.displayName=JR.displayName;const Ba=({className:r,...t})=>b.jsx("div",{className:ki("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});Ba.displayName="DialogHeader";const Va=ee.forwardRef(({className:r,...t},s)=>b.jsx(QR,{ref:s,className:ki("text-lg font-semibold leading-none tracking-tight",r),...t}));Va.displayName=QR.displayName;const zT=ee.forwardRef(({className:r,...t},s)=>b.jsx(eN,{ref:s,className:ki("text-sm text-muted-foreground",r),...t}));zT.displayName=eN.displayName;const g8=()=>{const[r,t]=ee.useState(null),[s,l]=ee.useState(!1),[h,m]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const P=await nl.getPopup();if(P&&P.isActive){t(P);const D=localStorage.getItem("welcomePopupLastShown"),F=new Date().toDateString();D!==F&&l(!0)}}catch(P){console.error("Error fetching popup:",P)}finally{m(!1)}})()},[]);const v=()=>{l(!1),localStorage.setItem("welcomePopupLastShown",new Date().toDateString())},i=()=>{r?.link&&window.open(r.link,"_blank"),v()};return h||!r?null:b.jsx(ol,{open:s,onOpenChange:v,children:b.jsx(Fa,{className:"max-w-md p-0 overflow-hidden ",children:b.jsxs("div",{className:"relative",children:[b.jsx(fr,{variant:"ghost",size:"icon",className:"absolute right-4 top-4 z-10 bg-white/80 hover:bg-white/90",onClick:v,children:b.jsx(p1,{className:"h-4 w-4"})}),b.jsx("div",{className:"aspect-video w-full overflow-hidden",children:b.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover"})}),b.jsxs("div",{className:"p-8",children:[b.jsxs(Ba,{className:"space-y-4 text-center",children:[b.jsx(Va,{className:"text-3xl font-bold text-gray-900",children:r.title}),b.jsx(zT,{className:"text-xl font-semibold text-primary",children:r.subject}),b.jsx("p",{className:"text-gray-600 text-lg leading-relaxed max-w-xl mx-auto",children:r.description})]}),b.jsx("div",{className:"flex justify-center mt-8",children:b.jsx(fr,{onClick:i,size:"lg",children:"Get Started"})})]})]})})})},y8=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState([]),[v,i]=ee.useState([]),[A,P]=ee.useState(!0),[D,F]=ee.useState(!1),[$,K]=ee.useState({heroType:"video",heroImage:"",heroVideoUrl:"https://www.youtube.com/embed/UtmSyNOdUYQ?si=EB0xgcBK1vQWyBi2",runningTextCompanies:["Sustainable-Investment","Startup-Support","Innovation-Consulting","Emerging-Tech","Ventuer-Studio","Ecosystem-Building","Worldwide-Connections","Emerging-Markets"],collaborators:[{id:"1",name:"Tunisian Startups",logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbWdZXtT-buPHs52zpna3LpGtG4VSj1gmRzQ&s",website:"https://startup.gov.tn/fr/home"},{id:"2",name:"InvestForJobs",logo:"https://eina4jobs.org/sites/default/files/styles/large/public/2022-04/313d09e5-6952-4a8a-9e8f-a289e2851be1_1.png?itok=KYfs2tOF",website:"https://invest-for-jobs.com/en/"},{id:"3",name:"GIZ",logo:"https://www.cocoainitiative.org/sites/default/files/logos/gizlogo-unternehmen-de-rgb-300-min.jpg",website:"https://www.giz.de/en/worldwide/22600.html"},{id:"4",name:"INNOVI",logo:"https://innovi.tn/wp-content/uploads/2019/11/Logo300x150-300x150.png",website:"https://innovi.tn/"},{id:"5",name:"USAID",logo:"https://tn.usembassy.gov/wp-content/uploads/sites/59/2017/05/USAID-Logo-1.jpg",website:"https://tn.usembassy.gov/fr/embassy-fr/ambassade-des-etats-unis-tunis/usaid-en-tunisie/"},{id:"6",name:"TBS",logo:"https://tunis-business-school.tn/media/logo_hu3d8e5f27ad81de36e24c8e7a513aea7c_89571_300x300_fit_lanczos_3.png",website:"https://tunis-business-school.tn/"},{id:"7",name:"Beta-i",logo:"https://beta-i.com/wp-content/uploads/2024/10/Logo-Positivo-Color_1-8.png",website:"https://beta-i.com/"},{id:"8",name:"TNW",logo:"https://images.app.goo.gl/q4wLsZC6j2R1ZDbE7",website:"https://thenextwomentunisie.com/"},{id:"9",name:"Finastra",logo:"https://upload.wikimedia.org/wikipedia/fr/2/2f/Finastra.png",website:"https://www.finastra.com/"},{id:"10",name:"216Capital",logo:"https://216capital.vc/assets/images/logo-216Capital-black.png",website:"https://216capital.vc/"},{id:"11",name:"GPP",logo:"https://www.global-project-partners.de/media/site/88b0f29413-1612944747/gpp-logo-1200x630-crop-1.png",website:"https://www.global-project-partners.de/"},{id:"12",name:"Gnt",logo:"https://landportal.org/sites/default/files/2023-05/lrQMWH3.png",website:"https://www.government.nl/"},{id:"13",name:"ExpertiseFrance",logo:"https://www.cdc.tn/sites/default/files/2024-07/ef-logo22%20%281%29.png",website:"https://www.expertisefrance.fr/fr/accueil"},{id:"14",name:"StartupAct",logo:"https://www.expert-comptable-tunisie.net/wp-content/uploads/2020/03/startup-act-Tunisie.png",website:"https://startup.gov.tn/fr/home"},{id:"15",name:"UNECA",logo:"https://msme-resurgence.unctad.org/sites/smesurge/files/2021-07/uneca%20main%20logo.png",website:"https://www.uneca.org/fr"},{id:"16",name:"STB",logo:"https://upload.wikimedia.org/wikipedia/commons/0/06/Logo_STB.png",website:"https://www.stb.com.tn/fr/"},{id:"17",name:"BH",logo:"https://upload.wikimedia.org/wikipedia/fr/4/44/BH-Bank.png",website:"https://www.bhbank.tn/"},{id:"18",name:"Attijari",logo:"https://www.attijaribank.com.tn/sites/default/files/inline-images/logoAttijari.png",website:"https://www.attijaribank.com.tn/fr"},{id:"19",name:"Segal",logo:"https://www.segalfamilyfoundation.org/wp-content/uploads/SFF-Mobile-Logo.svg",website:"https://www.segalfamilyfoundation.org/"},{id:"20",name:"Beta",logo:"https://aspban.eu/portnetworks/wp-content/uploads/2021/11/Beta-i.png",website:"https://beta-i.com/"},{id:"21",name:"Gitex",logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRH5MTbHcGnfFOqRrlHTA0e7fktBnhboTBroA&s",website:"https://www.gitexnigeria.ng/"}]});ee.useEffect(()=>{const W=localStorage.getItem("styleSettings");W&&K(JSON.parse(W)),(async()=>{try{const[fe,Pe,Fe,ht,at]=await Promise.all([nl.getServices(),nl.getCaseStudies(),nl.getProducts(),nl.getPopup(),nl.getConsulting()]);t(fe.slice(0,3)),l(at.slice(0,3)),m(Pe.slice(0,2)),i(Fe.slice(0,3)),ht?.isActive&&F(!0)}catch(fe){console.error("Error fetching data:",fe)}finally{P(!1)}})()},[]);const J=W=>({home:ng,"arrow-up":r0,book:f1,users:ig})[W]||ng;return A?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx(g8,{}),b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[b.jsxs("div",{children:[b.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-6 md:text-4xl",children:["Driving Innovation, Investment, and Ecosystem Growth",b.jsx("span",{className:"gradient-text block",children:"In Emerging Markets"})]}),b.jsx("p",{className:"text-xl  text-gray-600 mb-8 leading-relaxed",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and marketsconnect."}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[b.jsx(fr,{size:"lg",asChild:!0,children:b.jsx(Mi,{to:"/contact",children:"Start Your Journey"})}),b.jsx(fr,{variant:"outline",size:"lg",asChild:!0,children:b.jsx("a",{href:"https://www.hubspot.fr/",target:"_blank",rel:"noopener noreferrer",children:"Download Our Brochure"})})]}),b.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-12 pt-8 border-t border-gray-200",children:[b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-primary",children:"250+"}),b.jsx("div",{className:"text-sm text-gray-600",children:"Startups Supported"})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-primary",children:"10+"}),b.jsx("div",{className:"text-sm text-gray-600",children:"Innovation Programs"})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-primary",children:"12"}),b.jsx("div",{className:"text-sm text-gray-600",children:"Startups Built"})]})]})]}),b.jsxs("div",{className:"rounded-md shadow-xl overflow-hidden transform transition-all duration-500 group-hover:scale-[1.02] group-hover:shadow-2xl",children:[$.heroType==="video"?b.jsx("div",{className:"aspect-video w-full",children:b.jsx("iframe",{src:$.heroVideoUrl.replace("watch?v=","embed/"),title:"Hero Video",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):b.jsx("img",{src:$.heroImage,alt:"Hero",className:"w-full h-72 object-cover"}),b.jsxs("div",{className:"p-6 bg-white",children:[b.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Innovation in Action"}),b.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Where ideas meet execution"})]})]})]})})}),b.jsx(cU,{companies:$.runningTextCompanies}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Mission"}),b.jsx("p",{className:"text-xl text-gray-600 max-w-4xl mx-auto",children:"At Betawaves, we empower nations and industries to thrive by activating three core forces:"})]}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(ig,{className:"h-8 w-8 text-primary"})}),b.jsx("h3",{className:"text-xl font-semibold mb-4",children:"People"}),b.jsx("p",{className:"text-gray-600",children:"We cultivate talent and strengthen human capital through tailored training, mentorship, and workforce developmentbuilding the next generation of tech leaders, innovators, and change-makers."})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(r0,{className:"h-8 w-8 text-primary"})}),b.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Technology"}),b.jsx("p",{className:"text-gray-600",children:"We harness the power of emerging technologies to help startups and enterprises build scalable, efficient, and future-proof solutions across key sectors."})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx(ng,{className:"h-8 w-8 text-primary"})}),b.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Innovation"}),b.jsx("p",{className:"text-gray-600",children:"We design and drive innovation ecosystems, launch ventures, and enable strategic transformationworking with governments, corporates, and startups to turn bold ideas intorealimpact."})]})]})]})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Innovation Consulting"}),b.jsx("p",{className:"text-xl text-gray-600",children:"Comprehensive Consultings designed to address every aspect of startup development"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map(W=>{const ie=J(W.icon);return b.jsxs(Rn,{className:"h-full hover:shadow-lg transition-shadow",children:[b.jsxs(Yn,{children:[b.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:b.jsx(ie,{className:"h-6 w-6 text-primary"})}),b.jsx(Jn,{className:"text-xl",children:W.title}),b.jsx(ys,{className:"text-base",children:W.description})]}),b.jsx(Qn,{children:b.jsx("ul",{className:"space-y-2 mb-6",children:W.features.slice(0,3).map((fe,Pe)=>b.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[b.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),fe]},Pe))})})]},W.id)})}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(fr,{asChild:!0,children:b.jsx(Mi,{to:"/consultings",children:"View All Consultings"})})})]})}),b.jsx("section",{className:"py-20 bg-gray-900 text-white",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Products"}),b.jsx("p",{className:"text-xl text-gray-300",children:"Innovative tools and platforms designed to empower your startup journey"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:v.map(W=>b.jsxs(Rn,{className:"h-full hover:shadow-lg transition-shadow bg-gray-800 border-gray-700 text-white",children:[b.jsxs(Yn,{children:[b.jsxs("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center mb-4",children:[b.jsx(oB,{className:"h-6 w-6 text-primary"})," "]}),b.jsx(Jn,{className:"text-xl text-white",children:W.name}),b.jsx(ys,{className:"text-base text-gray-300",children:W.description})]}),b.jsx(Qn,{children:b.jsx("ul",{className:"space-y-2 text-sm text-gray-300",children:W.features.slice(0,3).map((ie,fe)=>b.jsxs("li",{className:"flex items-center",children:[b.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),ie]},fe))})})]},W.id))}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(fr,{asChild:!0,variant:"secondary",children:b.jsx(Mi,{to:"/products",children:"View All Products"})})})]})}),b.jsxs("section",{className:"py-20 bg-gradient-to-br from-blue-600 via-primary to-cyan-500 text-white relative overflow-hidden",children:[b.jsxs("div",{className:"absolute inset-0 opacity-20",children:[b.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-white/10 rounded-full -translate-x-48 -translate-y-48"}),b.jsx("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-white/5 rounded-full translate-x-40 translate-y-40"}),b.jsxs("svg",{className:"w-full h-full absolute inset-0",viewBox:"0 0 1200 600",preserveAspectRatio:"none",children:[b.jsx("defs",{children:b.jsx("pattern",{id:"wave-pattern",x:"0",y:"0",width:"100",height:"20",patternUnits:"userSpaceOnUse",children:b.jsx("path",{d:"M0,10 Q25,0 50,10 T100,10",stroke:"currentColor",strokeWidth:"0.5",fill:"none",opacity:"0.3"})})}),b.jsx("rect",{width:"100%",height:"100%",fill:"url(#wave-pattern)"})]})]}),b.jsx("div",{className:"container-width section-padding relative z-10",children:b.jsxs("div",{className:"max-w-5xl mx-auto",children:[b.jsxs(Rn,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-500 hover:scale-[1.02] hover:shadow-2xl",children:[b.jsxs(Yn,{className:"text-center pb-8",children:[b.jsx("div",{className:"mb-6",children:b.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-white/20 rounded-full text-sm font-medium mb-4",children:[b.jsx(oS,{className:"h-4 w-4 mr-2"}),"Impact Investment Fund"]})}),b.jsxs(Jn,{className:"text-3xl md:text-4xl font-bold text-white mb-6 leading-tight",children:["Powering the Future of Sustainability and Climate Tech",b.jsx("span",{className:"block bg-gradient-to-r from-cyan-200 to-white bg-clip-text text-transparent",children:"Across MENA+"})]}),b.jsx(ys,{className:"text-2xl text-white/95 mb-6 font-medium"}),b.jsx("p",{className:"text-lg text-white/85 max-w-4xl mx-auto leading-relaxed",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges. We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]}),b.jsxs(Qn,{children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[b.jsxs("div",{className:"text-center group",children:[b.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:b.jsx(dP,{className:"h-5 w-5 text-white"})}),b.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"$40M Fund Size"}),b.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Targeting sustainability and climate tech startups from ideation to series A"})]}),b.jsxs("div",{className:"text-center group",children:[b.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:b.jsx(pB,{className:"h-5 w-5 text-white"})}),b.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Regional Focus"}),b.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan"})]}),b.jsxs("div",{className:"text-center group",children:[b.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:b.jsx(oS,{className:"h-5 w-5 text-white"})}),b.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Beyond Capital"}),b.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Venture building, expert guidance, and globalnetworkaccess"})]})]}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[b.jsxs("div",{className:"text-center",children:[b.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Startups"}),b.jsx(fr,{size:"lg",variant:"secondary",className:"bg-white text-primary hover:bg-white/90 font-semibold px-8 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all",asChild:!0,children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})]}),b.jsxs("div",{className:"text-center",children:[b.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Investors"}),b.jsx(fr,{size:"lg",variant:"outline",className:"border-2 border-white text-primary hover:bg-white hover:text-primary font-semibold px-8 py-3 rounded-xl transition-all",asChild:!0,children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})]})]})]})]}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(fr,{asChild:!0,variant:"secondary",size:"lg",className:"bg-white/20 backdrop-blur border-white/30 text-white hover:bg-white hover:text-primary font-semibold rounded-xl",children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/",target:"_blank",rel:"noopener noreferrer",children:"Learn More About Betaventures"})})})]})})]}),b.jsx("section",{className:"py-20 ",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Portfolio"}),b.jsx("p",{className:"text-xl text-gray-600",children:"See how we've helped startups achieve remarkable growth and success"})]}),b.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:h.map(W=>b.jsxs(Rn,{className:"overflow-hidden",children:[b.jsx("div",{className:"aspect-video",children:b.jsx("img",{src:W.image,alt:W.companyName,className:"w-full h-full object-cover"})}),b.jsxs(Yn,{children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx(Jn,{className:"text-xl",children:W.companyName}),b.jsx("span",{className:"text-sm text-gray-500",children:W.industry})]}),b.jsx(ys,{children:W.description})]}),b.jsx(Qn,{children:W.testimonial?.quote?.trim()&&b.jsxs(b.Fragment,{children:[b.jsxs("blockquote",{className:"border-l-4 border-primary pl-4 italic text-gray-600 mb-4",children:['"',W.testimonial.quote,'"']}),b.jsxs("div",{className:"text-sm",children:[b.jsx("strong",{children:W.testimonial.author}),b.jsx("div",{className:"text-gray-500",children:W.testimonial.position})]})]})})]},W.id))}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(fr,{asChild:!0,children:b.jsx(Mi,{to:"/case-studies",children:"View All Portfolio"})})})]})}),b.jsx(lU,{}),b.jsx(uU,{collaborators:$.collaborators}),b.jsx("section",{className:"py-20 bg-primary text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Transform Your Startup?"}),b.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Join hundreds of successful startups who have accelerated their growth with Betawaves. Your journey to success starts here."}),b.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:b.jsx(fr,{size:"lg",variant:"secondary",asChild:!0,children:b.jsx(Mi,{to:"/contact",children:"Download Brochure"})})})]})})]})},_8=gx("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function _a({className:r,variant:t,...s}){return b.jsx("div",{className:ki(_8({variant:t}),r),...s})}const Jr=ee.forwardRef(({className:r,type:t,...s},l)=>b.jsx("input",{type:t,className:ki("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:l,...s}));Jr.displayName="Input";var x8="Label",rN=ee.forwardRef((r,t)=>b.jsx(vi.label,{...r,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(r.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));rN.displayName=x8;var nN=rN;const v8=gx("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ir=ee.forwardRef(({className:r,...t},s)=>b.jsx(nN,{ref:s,className:ki(v8(),r),...t}));ir.displayName=nN.displayName;const fo=ee.forwardRef(({className:r,...t},s)=>b.jsx("textarea",{className:ki("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:s,...t}));fo.displayName="Textarea";function aM(r,[t,s]){return Math.min(s,Math.max(t,r))}var b8=ee.createContext(void 0);function jT(r){const t=ee.useContext(b8);return r||t||"ltr"}function iN(r){const t=ee.useRef({value:r,previous:r});return ee.useMemo(()=>(t.current.value!==r&&(t.current.previous=t.current.value,t.current.value=r),t.current.previous),[r])}var w8=[" ","Enter","ArrowUp","ArrowDown"],S8=[" ","Enter"],xx="Select",[T1,E1,T8]=oT(xx),[jy,gX]=Ry(xx,[T8,_1]),C1=_1(),[E8,im]=jy(xx),[C8,A8]=jy(xx),sN=r=>{const{__scopeSelect:t,children:s,open:l,defaultOpen:h,onOpenChange:m,value:v,defaultValue:i,onValueChange:A,dir:P,name:D,autoComplete:F,disabled:$,required:K,form:J}=r,W=C1(t),[ie,fe]=ee.useState(null),[Pe,Fe]=ee.useState(null),[ht,at]=ee.useState(!1),Dt=jT(P),[kt=!1,Rt]=hg({prop:l,defaultProp:h,onChange:m}),[hr,Tr]=hg({prop:v,defaultProp:i,onChange:A}),_r=ee.useRef(null),Sr=ie?J||!!ie.closest("form"):!0,[Br,Ft]=ee.useState(new Set),br=Array.from(Br).map(Yt=>Yt.props.value).join(";");return b.jsx(Z5,{...W,children:b.jsxs(E8,{required:K,scope:t,trigger:ie,onTriggerChange:fe,valueNode:Pe,onValueNodeChange:Fe,valueNodeHasChildren:ht,onValueNodeHasChildrenChange:at,contentId:$p(),value:hr,onValueChange:Tr,open:kt,onOpenChange:Rt,dir:Dt,triggerPointerDownPosRef:_r,disabled:$,children:[b.jsx(T1.Provider,{scope:t,children:b.jsx(C8,{scope:r.__scopeSelect,onNativeOptionAdd:ee.useCallback(Yt=>{Ft(Er=>new Set(Er).add(Yt))},[]),onNativeOptionRemove:ee.useCallback(Yt=>{Ft(Er=>{const gt=new Set(Er);return gt.delete(Yt),gt})},[]),children:s})}),Sr?b.jsxs(kN,{"aria-hidden":!0,required:K,tabIndex:-1,name:D,autoComplete:F,value:hr,onChange:Yt=>Tr(Yt.target.value),disabled:$,form:J,children:[hr===void 0?b.jsx("option",{value:""}):null,Array.from(Br)]},br):null]})})};sN.displayName=xx;var oN="SelectTrigger",aN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,disabled:l=!1,...h}=r,m=C1(s),v=im(oN,s),i=v.disabled||l,A=xs(t,v.onTriggerChange),P=E1(s),D=ee.useRef("touch"),[F,$,K]=PN(W=>{const ie=P().filter(Fe=>!Fe.disabled),fe=ie.find(Fe=>Fe.value===v.value),Pe=RN(ie,W,fe);Pe!==void 0&&v.onValueChange(Pe.value)}),J=W=>{i||(v.onOpenChange(!0),K()),W&&(v.triggerPointerDownPosRef.current={x:Math.round(W.pageX),y:Math.round(W.pageY)})};return b.jsx(HP,{asChild:!0,...m,children:b.jsx(vi.button,{type:"button",role:"combobox","aria-controls":v.contentId,"aria-expanded":v.open,"aria-required":v.required,"aria-autocomplete":"none",dir:v.dir,"data-state":v.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":MN(v.value)?"":void 0,...h,ref:A,onClick:jn(h.onClick,W=>{W.currentTarget.focus(),D.current!=="mouse"&&J(W)}),onPointerDown:jn(h.onPointerDown,W=>{D.current=W.pointerType;const ie=W.target;ie.hasPointerCapture(W.pointerId)&&ie.releasePointerCapture(W.pointerId),W.button===0&&W.ctrlKey===!1&&W.pointerType==="mouse"&&(J(W),W.preventDefault())}),onKeyDown:jn(h.onKeyDown,W=>{const ie=F.current!=="";!(W.ctrlKey||W.altKey||W.metaKey)&&W.key.length===1&&$(W.key),!(ie&&W.key===" ")&&w8.includes(W.key)&&(J(),W.preventDefault())})})})});aN.displayName=oN;var lN="SelectValue",cN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,className:l,style:h,children:m,placeholder:v="",...i}=r,A=im(lN,s),{onValueNodeHasChildrenChange:P}=A,D=m!==void 0,F=xs(t,A.onValueNodeChange);return sl(()=>{P(D)},[P,D]),b.jsx(vi.span,{...i,ref:F,style:{pointerEvents:"none"},children:MN(A.value)?b.jsx(b.Fragment,{children:v}):m})});cN.displayName=lN;var I8="SelectIcon",uN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,children:l,...h}=r;return b.jsx(vi.span,{"aria-hidden":!0,...h,ref:t,children:l||""})});uN.displayName=I8;var M8="SelectPortal",hN=r=>b.jsx(u1,{asChild:!0,...r});hN.displayName=M8;var gg="SelectContent",dN=ee.forwardRef((r,t)=>{const s=im(gg,r.__scopeSelect),[l,h]=ee.useState();if(sl(()=>{h(new DocumentFragment)},[]),!s.open){const m=l;return m?Py.createPortal(b.jsx(fN,{scope:r.__scopeSelect,children:b.jsx(T1.Slot,{scope:r.__scopeSelect,children:b.jsx("div",{children:r.children})})}),m):null}return b.jsx(pN,{...r,ref:t})});dN.displayName=gg;var lh=10,[fN,sm]=jy(gg),k8="SelectContentImpl",pN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,position:l="item-aligned",onCloseAutoFocus:h,onEscapeKeyDown:m,onPointerDownOutside:v,side:i,sideOffset:A,align:P,alignOffset:D,arrowPadding:F,collisionBoundary:$,collisionPadding:K,sticky:J,hideWhenDetached:W,avoidCollisions:ie,...fe}=r,Pe=im(gg,s),[Fe,ht]=ee.useState(null),[at,Dt]=ee.useState(null),kt=xs(t,lr=>ht(lr)),[Rt,hr]=ee.useState(null),[Tr,_r]=ee.useState(null),Sr=E1(s),[Br,Ft]=ee.useState(!1),br=ee.useRef(!1);ee.useEffect(()=>{if(Fe)return DR(Fe)},[Fe]),ER();const Yt=ee.useCallback(lr=>{const[$r,...Cr]=Sr().map(ri=>ri.ref.current),[Fr]=Cr.slice(-1),Zn=document.activeElement;for(const ri of lr)if(ri===Zn||(ri?.scrollIntoView({block:"nearest"}),ri===$r&&at&&(at.scrollTop=0),ri===Fr&&at&&(at.scrollTop=at.scrollHeight),ri?.focus(),document.activeElement!==Zn))return},[Sr,at]),Er=ee.useCallback(()=>Yt([Rt,Fe]),[Yt,Rt,Fe]);ee.useEffect(()=>{Br&&Er()},[Br,Er]);const{onOpenChange:gt,triggerPointerDownPosRef:Jt}=Pe;ee.useEffect(()=>{if(Fe){let lr={x:0,y:0};const $r=Fr=>{lr={x:Math.abs(Math.round(Fr.pageX)-(Jt.current?.x??0)),y:Math.abs(Math.round(Fr.pageY)-(Jt.current?.y??0))}},Cr=Fr=>{lr.x<=10&&lr.y<=10?Fr.preventDefault():Fe.contains(Fr.target)||gt(!1),document.removeEventListener("pointermove",$r),Jt.current=null};return Jt.current!==null&&(document.addEventListener("pointermove",$r),document.addEventListener("pointerup",Cr,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",$r),document.removeEventListener("pointerup",Cr,{capture:!0})}}},[Fe,gt,Jt]),ee.useEffect(()=>{const lr=()=>gt(!1);return window.addEventListener("blur",lr),window.addEventListener("resize",lr),()=>{window.removeEventListener("blur",lr),window.removeEventListener("resize",lr)}},[gt]);const[Ht,qe]=PN(lr=>{const $r=Sr().filter(Zn=>!Zn.disabled),Cr=$r.find(Zn=>Zn.ref.current===document.activeElement),Fr=RN($r,lr,Cr);Fr&&setTimeout(()=>Fr.ref.current.focus())}),Ct=ee.useCallback((lr,$r,Cr)=>{const Fr=!br.current&&!Cr;(Pe.value!==void 0&&Pe.value===$r||Fr)&&(hr(lr),Fr&&(br.current=!0))},[Pe.value]),kr=ee.useCallback(()=>Fe?.focus(),[Fe]),Zr=ee.useCallback((lr,$r,Cr)=>{const Fr=!br.current&&!Cr;(Pe.value!==void 0&&Pe.value===$r||Fr)&&_r(lr)},[Pe.value]),Rr=l==="popper"?SS:mN,ar=Rr===SS?{side:i,sideOffset:A,align:P,alignOffset:D,arrowPadding:F,collisionBoundary:$,collisionPadding:K,sticky:J,hideWhenDetached:W,avoidCollisions:ie}:{};return b.jsx(fN,{scope:s,content:Fe,viewport:at,onViewportChange:Dt,itemRefCallback:Ct,selectedItem:Rt,onItemLeave:kr,itemTextRefCallback:Zr,focusSelectedItem:Er,selectedItemText:Tr,position:l,isPositioned:Br,searchRef:Ht,children:b.jsx(PT,{as:ug,allowPinchZoom:!0,children:b.jsx(kT,{asChild:!0,trapped:Pe.open,onMountAutoFocus:lr=>{lr.preventDefault()},onUnmountAutoFocus:jn(h,lr=>{Pe.trigger?.focus({preventScroll:!0}),lr.preventDefault()}),children:b.jsx(px,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:v,onFocusOutside:lr=>lr.preventDefault(),onDismiss:()=>Pe.onOpenChange(!1),children:b.jsx(Rr,{role:"listbox",id:Pe.contentId,"data-state":Pe.open?"open":"closed",dir:Pe.dir,onContextMenu:lr=>lr.preventDefault(),...fe,...ar,onPlaced:()=>Ft(!0),ref:kt,style:{display:"flex",flexDirection:"column",outline:"none",...fe.style},onKeyDown:jn(fe.onKeyDown,lr=>{const $r=lr.ctrlKey||lr.altKey||lr.metaKey;if(lr.key==="Tab"&&lr.preventDefault(),!$r&&lr.key.length===1&&qe(lr.key),["ArrowUp","ArrowDown","Home","End"].includes(lr.key)){let Fr=Sr().filter(Zn=>!Zn.disabled).map(Zn=>Zn.ref.current);if(["ArrowUp","End"].includes(lr.key)&&(Fr=Fr.slice().reverse()),["ArrowUp","ArrowDown"].includes(lr.key)){const Zn=lr.target,ri=Fr.indexOf(Zn);Fr=Fr.slice(ri+1)}setTimeout(()=>Yt(Fr)),lr.preventDefault()}})})})})})})});pN.displayName=k8;var P8="SelectItemAlignedPosition",mN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,onPlaced:l,...h}=r,m=im(gg,s),v=sm(gg,s),[i,A]=ee.useState(null),[P,D]=ee.useState(null),F=xs(t,kt=>D(kt)),$=E1(s),K=ee.useRef(!1),J=ee.useRef(!0),{viewport:W,selectedItem:ie,selectedItemText:fe,focusSelectedItem:Pe}=v,Fe=ee.useCallback(()=>{if(m.trigger&&m.valueNode&&i&&P&&W&&ie&&fe){const kt=m.trigger.getBoundingClientRect(),Rt=P.getBoundingClientRect(),hr=m.valueNode.getBoundingClientRect(),Tr=fe.getBoundingClientRect();if(m.dir!=="rtl"){const Zn=Tr.left-Rt.left,ri=hr.left-Zn,On=kt.left-ri,vs=kt.width+On,$s=Math.max(vs,Rt.width),Hi=window.innerWidth-lh,mo=aM(ri,[lh,Math.max(lh,Hi-$s)]);i.style.minWidth=vs+"px",i.style.left=mo+"px"}else{const Zn=Rt.right-Tr.right,ri=window.innerWidth-hr.right-Zn,On=window.innerWidth-kt.right-ri,vs=kt.width+On,$s=Math.max(vs,Rt.width),Hi=window.innerWidth-lh,mo=aM(ri,[lh,Math.max(lh,Hi-$s)]);i.style.minWidth=vs+"px",i.style.right=mo+"px"}const _r=$(),Sr=window.innerHeight-lh*2,Br=W.scrollHeight,Ft=window.getComputedStyle(P),br=parseInt(Ft.borderTopWidth,10),Yt=parseInt(Ft.paddingTop,10),Er=parseInt(Ft.borderBottomWidth,10),gt=parseInt(Ft.paddingBottom,10),Jt=br+Yt+Br+gt+Er,Ht=Math.min(ie.offsetHeight*5,Jt),qe=window.getComputedStyle(W),Ct=parseInt(qe.paddingTop,10),kr=parseInt(qe.paddingBottom,10),Zr=kt.top+kt.height/2-lh,Rr=Sr-Zr,ar=ie.offsetHeight/2,lr=ie.offsetTop+ar,$r=br+Yt+lr,Cr=Jt-$r;if($r<=Zr){const Zn=_r.length>0&&ie===_r[_r.length-1].ref.current;i.style.bottom="0px";const ri=P.clientHeight-W.offsetTop-W.offsetHeight,On=Math.max(Rr,ar+(Zn?kr:0)+ri+Er),vs=$r+On;i.style.height=vs+"px"}else{const Zn=_r.length>0&&ie===_r[0].ref.current;i.style.top="0px";const On=Math.max(Zr,br+W.offsetTop+(Zn?Ct:0)+ar)+Cr;i.style.height=On+"px",W.scrollTop=$r-Zr+W.offsetTop}i.style.margin=`${lh}px 0`,i.style.minHeight=Ht+"px",i.style.maxHeight=Sr+"px",l?.(),requestAnimationFrame(()=>K.current=!0)}},[$,m.trigger,m.valueNode,i,P,W,ie,fe,m.dir,l]);sl(()=>Fe(),[Fe]);const[ht,at]=ee.useState();sl(()=>{P&&at(window.getComputedStyle(P).zIndex)},[P]);const Dt=ee.useCallback(kt=>{kt&&J.current===!0&&(Fe(),Pe?.(),J.current=!1)},[Fe,Pe]);return b.jsx(N8,{scope:s,contentWrapper:i,shouldExpandOnScrollRef:K,onScrollButtonChange:Dt,children:b.jsx("div",{ref:A,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ht},children:b.jsx(vi.div,{...h,ref:F,style:{boxSizing:"border-box",maxHeight:"100%",...h.style}})})})});mN.displayName=P8;var R8="SelectPopperPosition",SS=ee.forwardRef((r,t)=>{const{__scopeSelect:s,align:l="start",collisionPadding:h=lh,...m}=r,v=C1(s);return b.jsx(GP,{...v,...m,ref:t,align:l,collisionPadding:h,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});SS.displayName=R8;var[N8,FT]=jy(gg,{}),TS="SelectViewport",gN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,nonce:l,...h}=r,m=sm(TS,s),v=FT(TS,s),i=xs(t,m.onViewportChange),A=ee.useRef(0);return b.jsxs(b.Fragment,{children:[b.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),b.jsx(T1.Slot,{scope:s,children:b.jsx(vi.div,{"data-radix-select-viewport":"",role:"presentation",...h,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...h.style},onScroll:jn(h.onScroll,P=>{const D=P.currentTarget,{contentWrapper:F,shouldExpandOnScrollRef:$}=v;if($?.current&&F){const K=Math.abs(A.current-D.scrollTop);if(K>0){const J=window.innerHeight-lh*2,W=parseFloat(F.style.minHeight),ie=parseFloat(F.style.height),fe=Math.max(W,ie);if(fe<J){const Pe=fe+K,Fe=Math.min(J,Pe),ht=Pe-Fe;F.style.height=Fe+"px",F.style.bottom==="0px"&&(D.scrollTop=ht>0?ht:0,F.style.justifyContent="flex-end")}}}A.current=D.scrollTop})})})]})});gN.displayName=TS;var yN="SelectGroup",[D8,O8]=jy(yN),L8=ee.forwardRef((r,t)=>{const{__scopeSelect:s,...l}=r,h=$p();return b.jsx(D8,{scope:s,id:h,children:b.jsx(vi.div,{role:"group","aria-labelledby":h,...l,ref:t})})});L8.displayName=yN;var _N="SelectLabel",xN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,...l}=r,h=O8(_N,s);return b.jsx(vi.div,{id:h.id,...l,ref:t})});xN.displayName=_N;var v0="SelectItem",[z8,vN]=jy(v0),bN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,value:l,disabled:h=!1,textValue:m,...v}=r,i=im(v0,s),A=sm(v0,s),P=i.value===l,[D,F]=ee.useState(m??""),[$,K]=ee.useState(!1),J=xs(t,Pe=>A.itemRefCallback?.(Pe,l,h)),W=$p(),ie=ee.useRef("touch"),fe=()=>{h||(i.onValueChange(l),i.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return b.jsx(z8,{scope:s,value:l,disabled:h,textId:W,isSelected:P,onItemTextChange:ee.useCallback(Pe=>{F(Fe=>Fe||(Pe?.textContent??"").trim())},[]),children:b.jsx(T1.ItemSlot,{scope:s,value:l,disabled:h,textValue:D,children:b.jsx(vi.div,{role:"option","aria-labelledby":W,"data-highlighted":$?"":void 0,"aria-selected":P&&$,"data-state":P?"checked":"unchecked","aria-disabled":h||void 0,"data-disabled":h?"":void 0,tabIndex:h?void 0:-1,...v,ref:J,onFocus:jn(v.onFocus,()=>K(!0)),onBlur:jn(v.onBlur,()=>K(!1)),onClick:jn(v.onClick,()=>{ie.current!=="mouse"&&fe()}),onPointerUp:jn(v.onPointerUp,()=>{ie.current==="mouse"&&fe()}),onPointerDown:jn(v.onPointerDown,Pe=>{ie.current=Pe.pointerType}),onPointerMove:jn(v.onPointerMove,Pe=>{ie.current=Pe.pointerType,h?A.onItemLeave?.():ie.current==="mouse"&&Pe.currentTarget.focus({preventScroll:!0})}),onPointerLeave:jn(v.onPointerLeave,Pe=>{Pe.currentTarget===document.activeElement&&A.onItemLeave?.()}),onKeyDown:jn(v.onKeyDown,Pe=>{A.searchRef?.current!==""&&Pe.key===" "||(S8.includes(Pe.key)&&fe(),Pe.key===" "&&Pe.preventDefault())})})})})});bN.displayName=v0;var O_="SelectItemText",wN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,className:l,style:h,...m}=r,v=im(O_,s),i=sm(O_,s),A=vN(O_,s),P=A8(O_,s),[D,F]=ee.useState(null),$=xs(t,fe=>F(fe),A.onItemTextChange,fe=>i.itemTextRefCallback?.(fe,A.value,A.disabled)),K=D?.textContent,J=ee.useMemo(()=>b.jsx("option",{value:A.value,disabled:A.disabled,children:K},A.value),[A.disabled,A.value,K]),{onNativeOptionAdd:W,onNativeOptionRemove:ie}=P;return sl(()=>(W(J),()=>ie(J)),[W,ie,J]),b.jsxs(b.Fragment,{children:[b.jsx(vi.span,{id:A.textId,...m,ref:$}),A.isSelected&&v.valueNode&&!v.valueNodeHasChildren?Py.createPortal(m.children,v.valueNode):null]})});wN.displayName=O_;var SN="SelectItemIndicator",TN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,...l}=r;return vN(SN,s).isSelected?b.jsx(vi.span,{"aria-hidden":!0,...l,ref:t}):null});TN.displayName=SN;var ES="SelectScrollUpButton",EN=ee.forwardRef((r,t)=>{const s=sm(ES,r.__scopeSelect),l=FT(ES,r.__scopeSelect),[h,m]=ee.useState(!1),v=xs(t,l.onScrollButtonChange);return sl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const P=A.scrollTop>0;m(P)};const A=s.viewport;return i(),A.addEventListener("scroll",i),()=>A.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),h?b.jsx(AN,{...r,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:A}=s;i&&A&&(i.scrollTop=i.scrollTop-A.offsetHeight)}}):null});EN.displayName=ES;var CS="SelectScrollDownButton",CN=ee.forwardRef((r,t)=>{const s=sm(CS,r.__scopeSelect),l=FT(CS,r.__scopeSelect),[h,m]=ee.useState(!1),v=xs(t,l.onScrollButtonChange);return sl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const P=A.scrollHeight-A.clientHeight,D=Math.ceil(A.scrollTop)<P;m(D)};const A=s.viewport;return i(),A.addEventListener("scroll",i),()=>A.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),h?b.jsx(AN,{...r,ref:v,onAutoScroll:()=>{const{viewport:i,selectedItem:A}=s;i&&A&&(i.scrollTop=i.scrollTop+A.offsetHeight)}}):null});CN.displayName=CS;var AN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,onAutoScroll:l,...h}=r,m=sm("SelectScrollButton",s),v=ee.useRef(null),i=E1(s),A=ee.useCallback(()=>{v.current!==null&&(window.clearInterval(v.current),v.current=null)},[]);return ee.useEffect(()=>()=>A(),[A]),sl(()=>{i().find(D=>D.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),b.jsx(vi.div,{"aria-hidden":!0,...h,ref:t,style:{flexShrink:0,...h.style},onPointerDown:jn(h.onPointerDown,()=>{v.current===null&&(v.current=window.setInterval(l,50))}),onPointerMove:jn(h.onPointerMove,()=>{m.onItemLeave?.(),v.current===null&&(v.current=window.setInterval(l,50))}),onPointerLeave:jn(h.onPointerLeave,()=>{A()})})}),j8="SelectSeparator",IN=ee.forwardRef((r,t)=>{const{__scopeSelect:s,...l}=r;return b.jsx(vi.div,{"aria-hidden":!0,...l,ref:t})});IN.displayName=j8;var AS="SelectArrow",F8=ee.forwardRef((r,t)=>{const{__scopeSelect:s,...l}=r,h=C1(s),m=im(AS,s),v=sm(AS,s);return m.open&&v.position==="popper"?b.jsx(qP,{...h,...l,ref:t}):null});F8.displayName=AS;function MN(r){return r===""||r===void 0}var kN=ee.forwardRef((r,t)=>{const{value:s,...l}=r,h=ee.useRef(null),m=xs(t,h),v=iN(s);return ee.useEffect(()=>{const i=h.current,A=window.HTMLSelectElement.prototype,D=Object.getOwnPropertyDescriptor(A,"value").set;if(v!==s&&D){const F=new Event("change",{bubbles:!0});D.call(i,s),i.dispatchEvent(F)}},[v,s]),b.jsx(mx,{asChild:!0,children:b.jsx("select",{...l,ref:m,defaultValue:s})})});kN.displayName="BubbleSelect";function PN(r){const t=Jl(r),s=ee.useRef(""),l=ee.useRef(0),h=ee.useCallback(v=>{const i=s.current+v;t(i),function A(P){s.current=P,window.clearTimeout(l.current),P!==""&&(l.current=window.setTimeout(()=>A(""),1e3))}(i)},[t]),m=ee.useCallback(()=>{s.current="",window.clearTimeout(l.current)},[]);return ee.useEffect(()=>()=>window.clearTimeout(l.current),[]),[s,h,m]}function RN(r,t,s){const h=t.length>1&&Array.from(t).every(P=>P===t[0])?t[0]:t,m=s?r.indexOf(s):-1;let v=B8(r,Math.max(m,0));h.length===1&&(v=v.filter(P=>P!==s));const A=v.find(P=>P.textValue.toLowerCase().startsWith(h.toLowerCase()));return A!==s?A:void 0}function B8(r,t){return r.map((s,l)=>r[(t+l)%r.length])}var V8=sN,NN=aN,U8=cN,$8=uN,H8=hN,DN=dN,G8=gN,ON=xN,LN=bN,q8=wN,W8=TN,zN=EN,jN=CN,FN=IN;const Cf=V8,Af=U8,gd=ee.forwardRef(({className:r,children:t,...s},l)=>b.jsxs(NN,{ref:l,className:ki("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...s,children:[t,b.jsx($8,{asChild:!0,children:b.jsx(uP,{className:"h-4 w-4 opacity-50"})})]}));gd.displayName=NN.displayName;const BN=ee.forwardRef(({className:r,...t},s)=>b.jsx(zN,{ref:s,className:ki("flex cursor-default items-center justify-center py-1",r),...t,children:b.jsx(uB,{className:"h-4 w-4"})}));BN.displayName=zN.displayName;const VN=ee.forwardRef(({className:r,...t},s)=>b.jsx(jN,{ref:s,className:ki("flex cursor-default items-center justify-center py-1",r),...t,children:b.jsx(uP,{className:"h-4 w-4"})}));VN.displayName=jN.displayName;const yd=ee.forwardRef(({className:r,children:t,position:s="popper",...l},h)=>b.jsx(H8,{children:b.jsxs(DN,{ref:h,className:ki("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:s,...l,children:[b.jsx(BN,{}),b.jsx(G8,{className:ki("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),b.jsx(VN,{})]})}));yd.displayName=DN.displayName;const Z8=ee.forwardRef(({className:r,...t},s)=>b.jsx(ON,{ref:s,className:ki("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));Z8.displayName=ON.displayName;const ps=ee.forwardRef(({className:r,children:t,...s},l)=>b.jsxs(LN,{ref:l,className:ki("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...s,children:[b.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:b.jsx(W8,{children:b.jsx(cB,{className:"h-4 w-4"})})}),b.jsx(q8,{children:t})]}));ps.displayName=LN.displayName;const X8=ee.forwardRef(({className:r,...t},s)=>b.jsx(FN,{ref:s,className:ki("-mx-1 my-1 h-px bg-muted",r),...t}));X8.displayName=FN.displayName;const K8=({serviceName:r})=>{const[t,s]=ee.useState(!1),[l,h]=ee.useState({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""}),{toast:m}=ky(),v=A=>{A.preventDefault(),console.log("Service application submitted:",{serviceName:r,...l}),m({title:"Application Submitted",description:`Your application for ${r} has been submitted successfully. We'll contact you soon.`}),s(!1),h({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""})},i=(A,P)=>{h(D=>({...D,[A]:P}))};return b.jsxs(ol,{open:t,onOpenChange:s,children:[b.jsx(LT,{asChild:!0,children:b.jsxs(fr,{className:"w-full",children:["Apply for ",r]})}),b.jsxs(Fa,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[b.jsxs(Ba,{children:[b.jsxs(Va,{children:["Apply for ",r]}),b.jsxs(zT,{children:["Fill out this form to apply for our ",r," program. We'll review your application and get back to you within 48 hours."]})]}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"email",children:"Professional Email *"}),b.jsx(Jr,{id:"email",type:"email",value:l.email,onChange:A=>i("email",A.target.value),placeholder:"your@company.com",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"fullName",children:"Full Name *"}),b.jsx(Jr,{id:"fullName",value:l.fullName,onChange:A=>i("fullName",A.target.value),placeholder:"John Doe",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"company",children:"Company/Startup Name"}),b.jsx(Jr,{id:"company",value:l.company,onChange:A=>i("company",A.target.value),placeholder:"Your Company Name"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"position",children:"Position/Role *"}),b.jsxs(Cf,{onValueChange:A=>i("position",A),required:!0,children:[b.jsx(gd,{children:b.jsx(Af,{placeholder:"Select your role"})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"founder",children:"Founder/Co-founder"}),b.jsx(ps,{value:"ceo",children:"CEO"}),b.jsx(ps,{value:"cto",children:"CTO"}),b.jsx(ps,{value:"entrepreneur",children:"Entrepreneur"}),b.jsx(ps,{value:"business-owner",children:"Business Owner"}),b.jsx(ps,{value:"other",children:"Other"})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"phoneNumber",children:"Phone Number"}),b.jsx(Jr,{id:"phoneNumber",type:"tel",value:l.phoneNumber,onChange:A=>i("phoneNumber",A.target.value),placeholder:"+1 (555) 123-4567"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"experience",children:"Years of Experience *"}),b.jsxs(Cf,{onValueChange:A=>i("experience",A),required:!0,children:[b.jsx(gd,{children:b.jsx(Af,{placeholder:"Select experience level"})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"0-1",children:"0-1 years"}),b.jsx(ps,{value:"2-5",children:"2-5 years"}),b.jsx(ps,{value:"6-10",children:"6-10 years"}),b.jsx(ps,{value:"10+",children:"10+ years"})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"motivation",children:"Why are you interested in this program? *"}),b.jsx(fo,{id:"motivation",value:l.motivation,onChange:A=>i("motivation",A.target.value),placeholder:"Tell us about your goals and how this program fits into your plans...",className:"min-h-[80px]",required:!0})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"button",variant:"outline",onClick:()=>s(!1),className:"flex-1",children:"Cancel"}),b.jsx(fr,{type:"submit",className:"flex-1",children:"Submit Application"})]})]})]})]})},Y8=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const v=await nl.getServices();t(v)}catch(v){console.error("Error fetching services:",v)}finally{l(!1)}})()},[]);const h=m=>({home:ng,"arrow-up":r0,book:f1,users:ig})[m]||ng;return s?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",b.jsx("span",{className:"gradient-text",children:"Programs"})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Comprehensive support programs designed to accelerate your startup's growth at every stage. From ideation to scaling, we provide the resources, mentorship, and networks you need to succeed."})]})})}),b.jsx("section",{className:"py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"grid grid-cols-1 gap-12",children:r.map((m,v)=>{const i=h(m.icon);return b.jsx(Rn,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 ${v%2===1?"lg:flex-row-reverse":""}`,children:b.jsxs("div",{className:"lg:flex",children:[b.jsx("div",{className:"lg:w-1/3 bg-primary/5 flex items-center justify-center p-12",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-2xl flex items-center justify-center mx-auto mb-6",children:b.jsx(i,{className:"h-12 w-12 text-primary"})}),b.jsx(_a,{variant:"secondary",className:"text-sm",children:m.duration})]})}),b.jsxs("div",{className:"lg:w-2/3 p-8",children:[b.jsxs(Yn,{className:"p-0 mb-6",children:[b.jsx(Jn,{className:"text-2xl mb-2",children:m.title}),b.jsx(ys,{className:"text-base text-gray-600",children:m.description})]}),b.jsxs(Qn,{className:"p-0 space-y-6",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"What You'll Get:"}),b.jsx("ul",{className:"space-y-2",children:m.features.map((A,P)=>b.jsxs("li",{className:"flex items-start text-gray-600",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{className:"text-sm",children:A})]},P))})]}),b.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Ideal For:"}),b.jsx("p",{className:"text-sm text-gray-600",children:m.eligibility})]}),b.jsx("div",{className:"pt-4 border-t border-gray-100",children:b.jsx(K8,{serviceName:m.title})})]})]})]})},m.id)})})})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Process"}),b.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"A proven methodology that takes your startup from concept to success"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[{step:"01",title:"Application",description:"Submit your application with your startup idea and current stage"},{step:"02",title:"Assessment",description:"Our experts evaluate your potential and fit for our programs"},{step:"03",title:"Matching",description:"We connect you with the right program, mentors, and resources"},{step:"04",title:"Growth",description:"Execute your growth plan with continuous support and guidance"}].map((m,v)=>b.jsxs("div",{className:"text-center relative",children:[b.jsx("div",{className:"w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold",children:m.step}),b.jsx("h3",{className:"text-lg font-semibold mb-2",children:m.title}),b.jsx("p",{className:"text-gray-600 text-sm",children:m.description}),v<3&&b.jsx("div",{className:"hidden md:block absolute top-8 left-full w-full h-0.5 bg-gray-300 transform -translate-x-1/2"})]},v))})]})}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsx("div",{className:"text-center mb-16",children:b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Frequently Asked Questions"})}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[{question:"What stage startups do you work with?",answer:"We support startups at all stages, from pre-seed ideas to Series A companies looking to scale."},{question:"Do you take equity in startups?",answer:"Our equity requirements vary by program. Some programs are equity-free, while others involve small equity stakes in exchange for funding."},{question:"How long are the programs?",answer:"Program duration varies from 2 weeks for intensive bootcamps to 12 months for comprehensive incubation programs."},{question:"What kind of support do you provide?",answer:"We provide mentorship, funding connections, technical resources, legal guidance, and access to our extensive network of partners and investors."}].map((m,v)=>b.jsxs(Rn,{className:"p-6",children:[b.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:m.question}),b.jsx("p",{className:"text-gray-600 text-sm",children:m.answer})]},v))})]})}),b.jsx("section",{className:"py-20 bg-primary text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Get Started?"}),b.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Take the first step towards transforming your startup. Apply to our programs today."}),b.jsx(fr,{size:"lg",variant:"secondary",children:"Apply Now"})]})})]})},J8=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[v,i]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const F=await nl.getConsulting();t(F),l(F)}catch(F){console.error("Error fetching consultings:",F)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?r:r.filter(D=>D.category===h))},[h,r]);const A=D=>({home:ng,"arrow-up":r0,book:f1,users:ig})[D]||ng,P=[{value:"all",label:"All Categories"},{value:"strategy",label:"Strategy"},{value:"product",label:"Product"},{value:"marketing",label:"Marketing"},{value:"funding",label:"Funding"}];return v?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen bg-gray-50",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",b.jsx("span",{className:"gradient-text",children:"Consulting Services"})]}),b.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8",children:"Tailored innovation consulting designed to help your startup tackle strategic, product, marketing, or funding challenges."})]})}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"flex justify-between items-center mb-8",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Consultings"}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),b.jsxs(Cf,{value:h,onValueChange:m,children:[b.jsx(gd,{className:"w-48",children:b.jsx(Af,{placeholder:"Select category"})}),b.jsx(yd,{children:P.map(D=>b.jsx(ps,{value:D.value,children:D.label},D.value))})]})]})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map(D=>{const F=A(D.icon);return b.jsxs(Rn,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[b.jsxs(Yn,{children:[b.jsxs("div",{className:"flex items-start justify-between mb-4",children:[b.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:b.jsx(F,{className:"h-6 w-6 text-primary"})}),b.jsx(_a,{variant:"secondary",className:"capitalize",children:D.category})]}),b.jsx(Jn,{className:"text-xl",children:D.title}),b.jsx(ys,{className:"text-base",children:D.description})]}),b.jsxs(Qn,{className:"flex flex-col flex-grow justify-between",children:[b.jsxs("div",{children:[b.jsx("ul",{className:"space-y-2 mb-6",children:D.features.map(($,K)=>b.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[b.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),$]},K))}),b.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:[b.jsx("strong",{children:"Eligibility:"})," ",D.eligibility]})]}),b.jsx(Mi,{to:"/contact",className:"w-full mt-auto",children:b.jsx(fr,{className:"w-full",children:"Contact Us"})})]})]},D.id)})}),s.length===0&&b.jsx("div",{className:"text-center py-12",children:b.jsx("p",{className:"text-gray-500",children:"No consulting services found for the selected category."})})]})}),b.jsx("section",{className:"py-20 bg-primary text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Need Strategic Support?"}),b.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Book a consulting session with our experts and take the next step in your startup's innovation journey."}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[b.jsx(fr,{size:"lg",variant:"secondary",children:b.jsx(Mi,{to:"/contact",children:"Book a session"})}),b.jsx(fr,{size:"lg",variant:"secondary",children:b.jsx(Mi,{to:"/case-studies",children:"Download our brochure"})})]})]})})]})},Q8=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[v,i]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const F=await nl.getProducts();t(F),l(F)}catch(F){console.error("Error fetching products:",F)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?r:r.filter(D=>D.category===h))},[h,r]);const A=[{value:"all",label:"All Categories"},{value:"Software",label:"Software"},{value:"Service",label:"Service"},{value:"Analytics",label:"Analytics"}],P=D=>{switch(D){case"active":return b.jsx(_a,{className:"bg-green-100 text-green-800",children:"Available"});case"coming-soon":return b.jsx(_a,{className:"bg-blue-100 text-blue-800",children:"Coming Soon"});case"inactive":return b.jsx(_a,{className:"bg-gray-100 text-gray-800",children:"Inactive"});default:return null}};return v?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",b.jsx("span",{className:"gradient-text",children:"Products"})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Innovative tools and platforms designed to empower startups, investors, and organizations with data-driven insights and comprehensive evaluation frameworks."})]})})}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"flex justify-between items-center mb-8",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Products"}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),b.jsxs(Cf,{value:h,onValueChange:m,children:[b.jsx(gd,{className:"w-48",children:b.jsx(Af,{placeholder:"Select category"})}),b.jsx(yd,{children:A.map(D=>b.jsx(ps,{value:D.value,children:D.label},D.value))})]})]})]}),b.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:s.map(D=>b.jsxs(Rn,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[b.jsxs(Yn,{children:[b.jsxs("div",{className:"flex justify-between items-start mb-4",children:[b.jsx(_a,{variant:"outline",children:D.category}),P(D.status)]}),b.jsx(Jn,{className:"text-2xl",children:D.name}),b.jsx(ys,{className:"text-base leading-relaxed",children:D.description}),b.jsx("div",{className:"text-xl font-bold text-primary mt-2",children:D.price})]}),b.jsxs(Qn,{className:"flex flex-col flex-grow justify-between",children:[b.jsxs("div",{className:"mb-6",children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Features:"}),b.jsx("ul",{className:"space-y-2",children:D.features.map((F,$)=>b.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[b.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),F]},$))})]}),b.jsx(fr,{className:"w-full mt-auto",disabled:D.status!=="active",onClick:()=>{D.status==="active"&&D.image&&window.open(D.image,"_blank")},children:D.status==="coming-soon"?"Coming Soon":"Get Started"})]})]},D.id))}),s.length===0&&b.jsx("div",{className:"text-center py-12",children:b.jsx("p",{className:"text-gray-500",children:"No products found for the selected category."})})]})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Ready to Explore Our Products?"}),b.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Get in touch with our team to learn more about how our products can support your startup journey or investment decisions."}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[b.jsx(fr,{size:"lg",asChild:!0,children:b.jsx(Mi,{to:"/contact",children:"Contact Us"})}),b.jsx(fr,{size:"lg",variant:"outline",asChild:!0,children:b.jsx(Mi,{to:"/resources",children:"View Resources"})})]})]})})]})},e$=({isOpen:r,onClose:t,resource:s})=>{const{toast:l}=ky(),[h,m]=ee.useState({name:"",email:"",company:"",phone:"",message:""}),[v,i]=ee.useState(!1),A=F=>{F.preventDefault(),console.log("Download request submitted:",{...h,resourceId:s?.id}),i(!0),l({title:"Information submitted",description:"Thank you for your information! You can now download the resource."})},P=()=>{const F=document.createElement("a");F.href=s?.downloadUrl||"#",F.download=`${s?.title}.pdf`,F.click(),l({title:"Download started",description:"The resource is being downloaded."})},D=()=>{m({name:"",email:"",company:"",phone:"",message:""}),i(!1),t()};return s?b.jsx(ol,{open:r,onOpenChange:D,children:b.jsxs(Fa,{className:"max-w-md",children:[b.jsx(Ba,{children:b.jsx(Va,{children:v?"Download Ready!":`Download ${s.title}`})}),v?b.jsxs("div",{className:"space-y-4 text-center",children:[b.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[b.jsx("p",{className:"text-green-800 mb-4",children:"Thank you for providing your information! Your download is ready."}),b.jsxs("p",{className:"text-sm text-green-600 mb-4",children:["Click the button below to download ",s.title,"."]})]}),b.jsxs(fr,{onClick:P,className:"w-full flex items-center gap-2",children:[b.jsx(fP,{size:16}),"Download ",s.title]}),b.jsx(fr,{variant:"outline",onClick:D,className:"w-full",children:"Close"})]}):b.jsxs("form",{onSubmit:A,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"name",children:"Full Name *"}),b.jsx(Jr,{id:"name",value:h.name,onChange:F=>m($=>({...$,name:F.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"email",children:"Email Address *"}),b.jsx(Jr,{id:"email",type:"email",value:h.email,onChange:F=>m($=>({...$,email:F.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"company",children:"Company/Organization *"}),b.jsx(Jr,{id:"company",value:h.company,onChange:F=>m($=>({...$,company:F.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"phone",children:"Phone Number"}),b.jsx(Jr,{id:"phone",type:"tel",value:h.phone,onChange:F=>m($=>({...$,phone:F.target.value}))})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"message",children:"How will you use this resource? *"}),b.jsx(fo,{id:"message",value:h.message,onChange:F=>m($=>({...$,message:F.target.value})),placeholder:"Brief description of your intended use...",rows:3,required:!0})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:"Submit & Download"}),b.jsx(fr,{type:"button",variant:"outline",onClick:D,children:"Cancel"})]})]})]})}):null},t$=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[v,i]=ee.useState(!0),[A,P]=ee.useState(null),[D,F]=ee.useState(!1);ee.useEffect(()=>{(async()=>{try{const ie=await nl.getResources();t(ie),l(ie)}catch(ie){console.error("Error fetching resources:",ie)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?r:r.filter(W=>W.type===h))},[h,r]);const $=W=>{W.downloadUrl?window.open(W.downloadUrl,"_blank"):console.warn("No download URL for this resource.")},K=W=>({"pitch-deck":xI,"financial-model":aB,presentation:xI,guide:f1})[W]||fB,J=[{value:"all",label:"All Types"},{value:"pitch-deck",label:"Pitch Decks"},{value:"financial-model",label:"Financial Models"},{value:"presentation",label:"Presentations"},{value:"guide",label:"Guides"}];return v?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",b.jsx("span",{className:"gradient-text",children:"Resources"})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Access essential templates, guides, and tools to accelerate your startup journey. From pitch decks to financial models, everything you need to succeed."})]})})}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"flex justify-between items-center mb-8",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Resources"}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsx("span",{className:"text-sm text-gray-600",children:"Filter by type:"}),b.jsxs(Cf,{value:h,onValueChange:m,children:[b.jsx(gd,{className:"w-48",children:b.jsx(Af,{placeholder:"Select type"})}),b.jsx(yd,{children:J.map(W=>b.jsx(ps,{value:W.value,children:W.label},W.value))})]})]})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map(W=>{const ie=K(W.type);return b.jsxs(Rn,{className:"h-full hover:shadow-lg transition-shadow",children:[b.jsxs(Yn,{children:[b.jsxs("div",{className:"flex items-start justify-between mb-4",children:[b.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:b.jsx(ie,{className:"h-6 w-6 text-primary"})}),b.jsx(_a,{variant:"secondary",className:"capitalize",children:W.category})]}),b.jsx(Jn,{className:"text-xl",children:W.title}),b.jsx(ys,{className:"text-base",children:W.description})]}),b.jsxs(Qn,{children:[b.jsx("div",{className:"flex flex-wrap gap-1 mb-6",children:W.tags.map((fe,Pe)=>b.jsx(_a,{variant:"outline",className:"text-xs",children:fe},Pe))}),b.jsxs(fr,{className:"w-full",onClick:()=>$(W),children:[b.jsx(fP,{size:16,className:"mr-2"}),"Get Resource"]})]})]},W.id)})}),s.length===0&&b.jsx("div",{className:"text-center py-12",children:b.jsx("p",{className:"text-gray-500",children:"No resources found for the selected type."})})]})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Need More Support?"}),b.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Our resources are just the beginning. Join our programs for personalized guidance and expert mentorship to take your startup to the next level."}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[b.jsx(fr,{size:"lg",asChild:!0,children:b.jsx(Mi,{to:"/fund",children:"View Investment"})}),b.jsx(fr,{size:"lg",variant:"outline",asChild:!0,children:b.jsx(Mi,{to:"/contact",children:"Contact Us"})})]})]})}),b.jsx(e$,{isOpen:D,onClose:()=>F(!1),resource:A})]})};var Kv={exports:{}},r$=Kv.exports,lM;function n$(){return lM||(lM=1,function(r,t){(function(s,l){r.exports=l()})(r$,function(){var s,l,h;function m(i,A){if(!s)s=A;else if(!l)l=A;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",D={};s(D),h=A(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}m(["exports"],function(i){var A=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function D(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o*g-d*u;return y?(a[0]=g*(y=1/y),a[1]=-u*y,a[2]=-d*y,a[3]=o*y,a):null}function F(){var a=new P(9);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function $(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8];return a[0]=y*N-T*I,a[1]=d*I-u*N,a[2]=u*T-d*y,a[3]=T*C-g*N,a[4]=o*N-d*C,a[5]=d*g-o*T,a[6]=g*I-y*C,a[7]=u*C-o*I,a[8]=o*y-u*g,a}function K(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=o[0],V=o[1],H=o[2],X=o[3],te=o[4],ae=o[5],de=o[6],pe=o[7],Q=o[8];return a[0]=L*u+V*y+H*I,a[1]=L*d+V*T+H*N,a[2]=L*g+V*C+H*O,a[3]=X*u+te*y+ae*I,a[4]=X*d+te*T+ae*N,a[5]=X*g+te*C+ae*O,a[6]=de*u+pe*y+Q*I,a[7]=de*d+pe*T+Q*N,a[8]=de*g+pe*C+Q*O,a}function J(){var a=new P(16);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function W(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function ie(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8],O=e[9],L=e[10],V=e[11],H=e[12],X=e[13],te=e[14],ae=e[15],de=o*T-u*y,pe=o*C-d*y,Q=o*I-g*y,he=u*C-d*T,me=u*I-g*T,_e=d*I-g*C,De=N*X-O*H,ke=N*te-L*H,Oe=N*ae-V*H,Ve=O*te-L*X,tt=O*ae-V*X,vt=L*ae-V*te,ft=de*vt-pe*tt+Q*Ve+he*Oe-me*ke+_e*De;return ft?(a[0]=(T*vt-C*tt+I*Ve)*(ft=1/ft),a[1]=(d*tt-u*vt-g*Ve)*ft,a[2]=(X*_e-te*me+ae*he)*ft,a[3]=(L*me-O*_e-V*he)*ft,a[4]=(C*Oe-y*vt-I*ke)*ft,a[5]=(o*vt-d*Oe+g*ke)*ft,a[6]=(te*Q-H*_e-ae*pe)*ft,a[7]=(N*_e-L*Q+V*pe)*ft,a[8]=(y*tt-T*Oe+I*De)*ft,a[9]=(u*Oe-o*tt-g*De)*ft,a[10]=(H*me-X*Q+ae*de)*ft,a[11]=(O*Q-N*me-V*de)*ft,a[12]=(T*ke-y*Ve-C*De)*ft,a[13]=(o*Ve-u*ke+d*De)*ft,a[14]=(X*pe-H*he-te*de)*ft,a[15]=(N*he-O*pe+L*de)*ft,a):null}function fe(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=e[9],V=e[10],H=e[11],X=e[12],te=e[13],ae=e[14],de=e[15],pe=o[0],Q=o[1],he=o[2],me=o[3];return a[0]=pe*u+Q*T+he*O+me*X,a[1]=pe*d+Q*C+he*L+me*te,a[2]=pe*g+Q*I+he*V+me*ae,a[3]=pe*y+Q*N+he*H+me*de,a[4]=(pe=o[4])*u+(Q=o[5])*T+(he=o[6])*O+(me=o[7])*X,a[5]=pe*d+Q*C+he*L+me*te,a[6]=pe*g+Q*I+he*V+me*ae,a[7]=pe*y+Q*N+he*H+me*de,a[8]=(pe=o[8])*u+(Q=o[9])*T+(he=o[10])*O+(me=o[11])*X,a[9]=pe*d+Q*C+he*L+me*te,a[10]=pe*g+Q*I+he*V+me*ae,a[11]=pe*y+Q*N+he*H+me*de,a[12]=(pe=o[12])*u+(Q=o[13])*T+(he=o[14])*O+(me=o[15])*X,a[13]=pe*d+Q*C+he*L+me*te,a[14]=pe*g+Q*I+he*V+me*ae,a[15]=pe*y+Q*N+he*H+me*de,a}function Pe(a,e,o){var u,d,g,y,T,C,I,N,O,L,V,H,X=o[0],te=o[1],ae=o[2];return e===a?(a[12]=e[0]*X+e[4]*te+e[8]*ae+e[12],a[13]=e[1]*X+e[5]*te+e[9]*ae+e[13],a[14]=e[2]*X+e[6]*te+e[10]*ae+e[14],a[15]=e[3]*X+e[7]*te+e[11]*ae+e[15]):(d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=e[9],V=e[10],H=e[11],a[0]=u=e[0],a[1]=d,a[2]=g,a[3]=y,a[4]=T,a[5]=C,a[6]=I,a[7]=N,a[8]=O,a[9]=L,a[10]=V,a[11]=H,a[12]=u*X+T*te+O*ae+e[12],a[13]=d*X+C*te+L*ae+e[13],a[14]=g*X+I*te+V*ae+e[14],a[15]=y*X+N*te+H*ae+e[15]),a}function Fe(a,e,o){var u=o[0],d=o[1],g=o[2];return a[0]=e[0]*u,a[1]=e[1]*u,a[2]=e[2]*u,a[3]=e[3]*u,a[4]=e[4]*d,a[5]=e[5]*d,a[6]=e[6]*d,a[7]=e[7]*d,a[8]=e[8]*g,a[9]=e[9]*g,a[10]=e[10]*g,a[11]=e[11]*g,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function ht(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[4],y=e[5],T=e[6],C=e[7],I=e[8],N=e[9],O=e[10],L=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=g*d+I*u,a[5]=y*d+N*u,a[6]=T*d+O*u,a[7]=C*d+L*u,a[8]=I*d-g*u,a[9]=N*d-y*u,a[10]=O*d-T*u,a[11]=L*d-C*u,a}function at(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[0],y=e[1],T=e[2],C=e[3],I=e[8],N=e[9],O=e[10],L=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*d-I*u,a[1]=y*d-N*u,a[2]=T*d-O*u,a[3]=C*d-L*u,a[8]=g*u+I*d,a[9]=y*u+N*d,a[10]=T*u+O*d,a[11]=C*u+L*d,a}function Dt(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[0],y=e[1],T=e[2],C=e[3],I=e[4],N=e[5],O=e[6],L=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*d+I*u,a[1]=y*d+N*u,a[2]=T*d+O*u,a[3]=C*d+L*u,a[4]=I*d-g*u,a[5]=N*d-y*u,a[6]=O*d-T*u,a[7]=L*d-C*u,a}function kt(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Rt(a,e,o){var u,d,g,y=o[0],T=o[1],C=o[2],I=Math.hypot(y,T,C);return I<A?null:(y*=I=1/I,T*=I,C*=I,u=Math.sin(e),d=Math.cos(e),a[0]=y*y*(g=1-d)+d,a[1]=T*y*g+C*u,a[2]=C*y*g-T*u,a[3]=0,a[4]=y*T*g-C*u,a[5]=T*T*g+d,a[6]=C*T*g+y*u,a[7]=0,a[8]=y*C*g+T*u,a[9]=T*C*g-y*u,a[10]=C*C*g+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function hr(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o+o,T=u+u,C=d+d,I=o*y,N=u*y,O=u*T,L=d*y,V=d*T,H=d*C,X=g*y,te=g*T,ae=g*C;return a[0]=1-O-H,a[1]=N+ae,a[2]=L-te,a[3]=0,a[4]=N-ae,a[5]=1-I-H,a[6]=V+X,a[7]=0,a[8]=L+te,a[9]=V-X,a[10]=1-I-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)});var Tr=fe;function _r(){var a=new P(3);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Sr(a){var e=new P(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function Br(a){return Math.hypot(a[0],a[1],a[2])}function Ft(a,e,o){var u=new P(3);return u[0]=a,u[1]=e,u[2]=o,u}function br(a,e,o){return a[0]=e[0]+o[0],a[1]=e[1]+o[1],a[2]=e[2]+o[2],a}function Yt(a,e,o){return a[0]=e[0]-o[0],a[1]=e[1]-o[1],a[2]=e[2]-o[2],a}function Er(a,e,o){return a[0]=e[0]*o[0],a[1]=e[1]*o[1],a[2]=e[2]*o[2],a}function gt(a,e,o){return a[0]=Math.min(e[0],o[0]),a[1]=Math.min(e[1],o[1]),a[2]=Math.min(e[2],o[2]),a}function Jt(a,e,o){return a[0]=Math.max(e[0],o[0]),a[1]=Math.max(e[1],o[1]),a[2]=Math.max(e[2],o[2]),a}function Ht(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a[2]=e[2]*o,a}function qe(a,e,o,u){return a[0]=e[0]+o[0]*u,a[1]=e[1]+o[1]*u,a[2]=e[2]+o[2]*u,a}function Ct(a,e){var o=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return o*o+u*u+d*d}function kr(a){var e=a[0],o=a[1],u=a[2];return e*e+o*o+u*u}function Zr(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function Rr(a,e){var o=e[0],u=e[1],d=e[2],g=o*o+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=e[0]*g,a[1]=e[1]*g,a[2]=e[2]*g,a}function ar(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function lr(a,e,o){var u=e[0],d=e[1],g=e[2],y=o[0],T=o[1],C=o[2];return a[0]=d*C-g*T,a[1]=g*y-u*C,a[2]=u*T-d*y,a}function $r(a,e,o,u){var d=e[0],g=e[1],y=e[2];return a[0]=d+u*(o[0]-d),a[1]=g+u*(o[1]-g),a[2]=y+u*(o[2]-y),a}function Cr(a,e,o){var u=e[0],d=e[1],g=e[2],y=o[3]*u+o[7]*d+o[11]*g+o[15];return a[0]=(o[0]*u+o[4]*d+o[8]*g+o[12])/(y=y||1),a[1]=(o[1]*u+o[5]*d+o[9]*g+o[13])/y,a[2]=(o[2]*u+o[6]*d+o[10]*g+o[14])/y,a}function Fr(a,e,o){var u=e[0],d=e[1],g=e[2];return a[0]=u*o[0]+d*o[3]+g*o[6],a[1]=u*o[1]+d*o[4]+g*o[7],a[2]=u*o[2]+d*o[5]+g*o[8],a}function Zn(a,e,o){var u=o[0],d=o[1],g=o[2],y=e[0],T=e[1],C=e[2],I=d*C-g*T,N=g*y-u*C,O=u*T-d*y,L=d*O-g*N,V=g*I-u*O,H=u*N-d*I,X=2*o[3];return N*=X,O*=X,V*=2,H*=2,a[0]=y+(I*=X)+(L*=2),a[1]=T+N+V,a[2]=C+O+H,a}function ri(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var On=Yt,vs=Er,$s=Br;function Hi(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function mo(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a[2]=e[2]*o,a[3]=e[3]*o,a}function El(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o*o+u*u+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=o*y,a[1]=u*y,a[2]=d*y,a[3]=g*y,a}function zi(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3];return a[0]=o[0]*u+o[4]*d+o[8]*g+o[12]*y,a[1]=o[1]*u+o[5]*d+o[9]*g+o[13]*y,a[2]=o[2]*u+o[6]*d+o[10]*g+o[14]*y,a[3]=o[3]*u+o[7]*d+o[11]*g+o[15]*y,a}function Ki(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function to(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qo(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+y*T,a[1]=d*C+g*T,a[2]=g*C-d*T,a[3]=y*C-u*T,a}function To(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C-g*T,a[1]=d*C+y*T,a[2]=g*C+u*T,a[3]=y*C-d*T,a}_r(),Hi();var Cs,Ua,wa,is,Sa,Hs=El,Fo=(Cs=_r(),Ua=Ft(1,0,0),wa=Ft(0,1,0),function(a,e,o){var u=ar(e,o);return u<-.999999?(lr(Cs,Ua,e),$s(Cs)<1e-6&&lr(Cs,wa,e),Rr(Cs,Cs),function(d,g,y){y*=.5;var T=Math.sin(y);d[0]=T*g[0],d[1]=T*g[1],d[2]=T*g[2],d[3]=Math.cos(y)}(a,Cs,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(lr(Cs,e,o),a[0]=Cs[0],a[1]=Cs[1],a[2]=Cs[2],a[3]=1+u,Hs(a,a))});function ss(){var a=new P(2);return P!=Float32Array&&(a[0]=0,a[1]=0),a}function go(a,e){var o=new P(2);return o[0]=a,o[1]=e,o}function Ta(a,e,o){return a[0]=e[0]+o[0],a[1]=e[1]+o[1],a}function Ea(a,e,o){return a[0]=e[0]-o[0],a[1]=e[1]-o[1],a}function Ca(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a}function As(a){return Math.hypot(a[0],a[1])}function $a(a,e){var o=e[0],u=e[1],d=o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),a[0]=e[0]*d,a[1]=e[1]*d,a}function Dr(a,e){return a[0]*e[0]+a[1]*e[1]}function ci(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Ki(),Ki(),F(),ss();var di,Vi,Is=function(){if(Sa)return is;function a(e,o,u,d){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=o,this.p2x=u,this.p2y=d}return Sa=1,is=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,o){if(o===void 0&&(o=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,d=0;d<8;d++){var g=this.sampleCurveX(u)-e;if(Math.abs(g)<o)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var T=0,C=1;for(u=e,d=0;d<20&&(g=this.sampleCurveX(u),!(Math.abs(g-e)<o));d++)e>g?T=u:C=u,u=.5*(C-T)+T;return u},solve:function(e,o){return this.sampleCurveY(this.solveCurveX(e,o))}},is}(),Ha=ci(Is);function Ga(){if(Vi)return di;function a(e,o){this.x=e,this.y=o}return Vi=1,di=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,o){return this.clone()._rotateAround(e,o)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var o=e.x-this.x,u=e.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,o){return Math.atan2(this.x*o-this.y*e,this.x*e+this.y*o)},_matMult:function(e){var o=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=o,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var o=Math.cos(e),u=Math.sin(e),d=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=d,this},_rotateAround:function(e,o){var u=Math.cos(e),d=Math.sin(e),g=o.y+d*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-d*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e},di}var Ot=ci(Ga());function qa(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let o=0;o<a.length;o++)if(!qa(a[o],e[o]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const o in a)if(!qa(a[o],e[o]))return!1;return!0}return a===e}const gh=Math.PI/180,Ql=180/Math.PI;function Sn(a){return a*gh}function Ke(a){return a*Ql}const le=[[0,0],[1,0],[1,1],[0,1]];function ue(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,o=e*a;return 4*(a<.5?o:3*(a-e)+o-.75)}function ve(a,e,o,u){const d=new Ha(a,e,o,u);return function(g){return d.solve(g)}}const Ne=ve(.25,.1,.25,1);function Ee(a,e,o){return Math.min(o,Math.max(e,a))}function ze(a,e,o){return(o=Ee((o-a)/(e-a),0,1))*o*(3-2*o)}function We(a,e,o){const u=o-e,d=((a-e)%u+u)%u+e;return d===e?o:d}function je(a,e,o){if(!a.length)return o(null,[]);let u=a.length;const d=new Array(a.length);let g=null;a.forEach((y,T)=>{e(y,(C,I)=>{C&&(g=C),d[T]=I,--u==0&&o(g,d)})})}function Xe(a,...e){for(const o of e)for(const u in o)a[u]=o[u];return a}let dt=1;function Ze(){return dt++}function Nt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Qt(a,e){a.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function Me(a,e,o){const u={};for(const d in a)u[d]=e.call(this,a[d],d,a);return u}function Wt(a,e,o){const u={};for(const d in a)e.call(this,a[d],d,a)&&(u[d]=a[d]);return u}function mr(a){return Array.isArray(a)?a.map(mr):typeof a=="object"&&a?Me(a,mr):a}function Ur(a,e){for(let o=0;o<a.length;o++)if(e.indexOf(a[o])>=0)return!0;return!1}const nn={};function Hr(a){nn[a]||(typeof console<"u"&&console.warn(a),nn[a]=!0)}function ni(a,e,o){return(o.y-a.y)*(e.x-a.x)>(e.y-a.y)*(o.x-a.x)}function gn(a){let e=0;for(let o,u,d=0,g=a.length,y=g-1;d<g;y=d++)o=a[d],u=a[y],e+=(u.x-o.x)*(o.y+u.y);return e}function bi([a,e,o]){const u=Sn(e+90),d=Sn(o);return{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d),azimuthal:e,polar:o}}function Fn(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Nn(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,d,g)=>{const y=d||g;return e[u]=!y||y.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let ji=null;function Ui(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function Ri(a,e,o,u){for(;e<o;){const d=e+o>>1;a[d]<u?e=d+1:o=d}return e}function ms(a,e,o,u){for(;e<o;){const d=e+o>>1;a[d]<=u?e=d+1:o=d}return e}function us(a){return a>0?1/(1.001-a):1+a}function yo(a){return a>0?1-1/(1.001-a):-a}function Bo(a,e,o){return(a-e.min)*(o.max-o.min)/(e.max-e.min)+o.min}const Gs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gs.API_URL)return null;try{const a=new URL(Gs.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function kc(a){return Gs.API_URL_REGEX.test(a)}function kf(a){return Gs.API_SPRITE_REGEX.test(a)}let Pc,Rc,Nc,yu,_u,bd;function yh(){return Pc==null&&(Pc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Pc}const Wa={now:()=>yu!==void 0?yu:performance.now(),setNow(a){yu=a},restoreNow(){yu=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:o,height:u}=a;_u||(_u=document.createElement("canvas"));const d=_u.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(o>_u.width||u>_u.height)&&(_u.width=o,_u.height=u),d.clearRect(-e,-e,o+2*e,u+2*e),d.drawImage(a,0,0,o,u),d.getImageData(-e,-e,o+2*e,u+2*e)},resolveURL:a=>(Rc||(Rc=document.createElement("a")),Rc.href=a,Rc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Nc==null&&(Nc=window.matchMedia("(prefers-reduced-motion: reduce)")),Nc.matches)},hasCanvasFingerprintNoise(){if(bd!==void 0)return bd;if(!yh())return bd=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let o=0;for(let d=0;d<a.width;++d)e.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,e.fillRect(d,0,1,1);const u=e.getImageData(0,0,a.width,a.height);o=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&o++!==u.data[d])return bd=!0,!0;return bd=!1,!1}};function Vo(a,e){const o=a.indexOf("?");if(o<0)return`${a}?${new URLSearchParams(e).toString()}`;const u=new URLSearchParams(a.slice(o));for(const d in e)u.set(d,e[d]);return`${a.slice(0,o)}?${u.toString()}`}function Eo(a,e={persistentParams:[]}){const o=a.indexOf("?");if(o<0)return a;const u=new URLSearchParams,d=new URLSearchParams(a.slice(o));for(const y of e.persistentParams){const T=d.get(y);T&&u.set(y,T)}const g=u.toString();return`${a.slice(0,o)}${g.length>0?`?${g}`:""}`}const ec="mapbox-tiles";let Aa=500,fi=50;const _h=["language","worldview","jobid"];let ll,xu;function Dc(){try{return caches}catch{}}function vu(){const a=Dc();a&&ll==null&&(ll=a.open(ec))}let Pf=1/0;const wd={supported:!1,testSupport:function(a){!Za&&ea&&(Ia?vh(a):ro=a)}};let ro,ea,Za=!1,Ia=!1;const xh=typeof self<"u"?self:{};function vh(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ea),a.isContextLost())return;wd.supported=!0}catch{}a.deleteTexture(e),Za=!0}xh.document&&(ea=xh.document.createElement("img"),ea.onload=function(){ro&&vh(ro),ro=null,Ia=!0},ea.onerror=function(){Za=!0,ro=null},ea.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Xa);class An extends Error{constructor(e,o,u){o===401&&kc(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sd=Fn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Cl=function(a,e){if(!(/^file:/.test(o=a.url)||/^file:/.test(Sd())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Sd(),referrerPolicy:u.referrerPolicy,signal:g.signal});let T=!1,C=!1;const I=(N=y.url).indexOf("sku=")>0&&kc(N);var N;u.type==="json"&&y.headers.set("Accept","application/json");const O=(V,H,X)=>{if(C)return;if(V&&V.message!=="SecurityError"&&Hr(V.toString()),H&&X)return L(H);const te=Date.now();fetch(y).then(ae=>{if(ae.ok){const de=I?ae.clone():null;return L(ae,de,te)}return d(new An(ae.statusText,ae.status,u.url))}).catch(ae=>{ae.name!=="AbortError"&&d(new Error(`${ae.message} ${u.url}`))})},L=(V,H,X)=>{(u.type==="arrayBuffer"?V.arrayBuffer():u.type==="json"?V.json():V.text()).then(te=>{C||(H&&X&&function(ae,de,pe){if(vu(),ll==null)return;const Q=Nn(de.headers.get("Cache-Control")||"");if(Q["no-store"])return;const he={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((De,ke)=>he.headers.set(ke,De)),Q["max-age"]&&he.headers.set("Expires",new Date(pe+1e3*Q["max-age"]).toUTCString());const me=he.headers.get("Expires");if(!me||new Date(me).getTime()-pe<42e4)return;let _e=Eo(ae.url,{persistentParams:_h});if(de.status===206){const De=ae.headers.get("Range");if(!De)return;he.status=200,_e=Vo(_e,{range:De})}(function(De,ke){if(xu===void 0)try{new Response(new ReadableStream),xu=!0}catch{xu=!1}xu?ke(De.body):De.blob().then(ke).catch(Oe=>Hr(Oe.message))})(de,De=>{const ke=new Response((Oe=de.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:De,he);var Oe;vu(),ll?.then(Ve=>Ve.put(_e,ke)).catch(Ve=>Hr(Ve.message))})}(y,H,X),T=!0,d(null,te,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(te=>{C||d(new Error(te.message))})};return I?function(V,H){if(vu(),ll==null)return H(null);ll.then(X=>{let te=Eo(V.url,{persistentParams:_h});const ae=V.headers.get("Range");ae&&(te=Vo(te,{range:ae})),X.match(te).then(de=>{const pe=function(Q){if(!Q)return!1;const he=new Date(Q.headers.get("Expires")||0),me=Nn(Q.headers.get("Cache-Control")||"");return Number(he)>Date.now()&&!me["no-cache"]}(de);X.delete(te).catch(H),pe&&X.put(te,de.clone()).catch(H),H(null,de,pe)}).catch(H)}).catch(H)}(y,O):O(null,null),{cancel:()=>{C=!0,T||g.abort()}}}(a,e);if(Fn(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var o;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(T){return d(T)}d(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else d(new An(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,e)},Td=function(a,e){return Cl(Xe(a,{type:"arrayBuffer"}),e)};function Eg(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const Oc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lc,zc;Lc=[],zc=0;const bu=function(a,e){if(wd.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),zc>=Gs.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Lc.push(g),g}zc++;let o=!1;const u=()=>{if(!o)for(o=!0,zc--;Lc.length&&zc<Gs.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Lc.shift(),{requestParameters:y,callback:T,cancelled:C}=g;C||(g.cancel=bu(y,T).cancel)}},d=Td(a,(g,y,T,C)=>{u(),g?e(g):y&&(self.createImageBitmap?function(I,N){const O=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(O).then(L=>{N(null,L)}).catch(L=>{N(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(I,N)=>e(I,N,T,C)):function(I,N){const O=new Image;O.onload=()=>{N(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Oc})},O.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(I)],{type:"image/png"});O.src=I.byteLength?URL.createObjectURL(L):Oc}(y,(I,N)=>e(I,N,T,C)))});return{cancel:()=>{d.cancel(),u()}}};var wu,Ka,Ed,tc={exports:{}},Rf={exports:{}},bh={exports:{}},ta=function(){if(Ed)return tc.exports;Ed=1;var a=(wu||(wu=1,Rf.exports=function(o,u){var d,g,y,T,C,I,N,O;for(g=o.length-(d=3&o.length),y=u,C=3432918353,I=461845907,O=0;O<g;)N=255&o.charCodeAt(O)|(255&o.charCodeAt(++O))<<8|(255&o.charCodeAt(++O))<<16|(255&o.charCodeAt(++O))<<24,++O,y=27492+(65535&(T=5*(65535&(y=(y^=N=(65535&(N=(N=(65535&N)*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(N=0,d){case 3:N^=(255&o.charCodeAt(O+2))<<16;case 2:N^=(255&o.charCodeAt(O+1))<<8;case 1:y^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(O)))*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*I+(((N>>>16)*I&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Rf.exports),e=(Ka||(Ka=1,bh.exports=function(o,u){for(var d,g=o.length,y=u^g,T=0;g>=4;)d=1540483477*(65535&(d=255&o.charCodeAt(T)|(255&o.charCodeAt(++T))<<8|(255&o.charCodeAt(++T))<<16|(255&o.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++T;switch(g){case 3:y^=(255&o.charCodeAt(T+2))<<16;case 2:y^=(255&o.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),bh.exports);return tc.exports=a,tc.exports.murmur3=a,tc.exports.murmur2=e,tc.exports}(),Su=ci(ta);class jc{constructor(e,...o){Xe(this,o[0]||{}),this.type=e}}class cl extends jc{constructor(e,o={}){super("error",Xe({error:e},o))}}function Cd(a,e,o){o[a]&&o[a].indexOf(e)!==-1||(o[a]=o[a]||[],o[a].push(e))}function Tu(a,e,o){if(o&&o[a]){const u=o[a].indexOf(e);u!==-1&&o[a].splice(u,1)}}class Fc{on(e,o){return this._listeners=this._listeners||{},Cd(e,o,this._listeners),this}off(e,o){return Tu(e,o,this._listeners),Tu(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Cd(e,o,this._oneTimeListeners),this):new Promise(u=>{this.once(e,u)})}fire(e,o){const u=typeof e=="string"?new jc(e,o):e,d=u.type;if(this.listens(d)){u.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const C of g)C.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const C of y)Tu(d,C,this._oneTimeListeners),C.call(this,u);const T=this._eventedParent;T&&(Xe(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(u))}else u instanceof cl&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}class _o{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new _o(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[o,u]=e.split("");return new _o({name:o,iconsetId:u})}static isEqual(e,o){return e.name===o.name&&e.iconsetId===o.iconsetId}toString(){return _o.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var wh,Eu={},qs=function(){if(wh)return Eu;wh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(g){return(g=Math.round(g))<0?0:g>255?255:g}function o(g){return e(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function d(g,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?g+(y-g)*T*6:2*T<1?y:3*T<2?g+(y-g)*(2/3-T)*6:g}try{Eu.parseCSSColor=function(g){var y,T=g.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var C=T.indexOf("("),I=T.indexOf(")");if(C!==-1&&I+1===T.length){var N=T.substr(0,C),O=T.substr(C+1,I-(C+1)).split(","),L=1;switch(N){case"rgba":if(O.length!==4)return null;L=u(O.pop());case"rgb":return O.length!==3?null:[o(O[0]),o(O[1]),o(O[2]),L];case"hsla":if(O.length!==4)return null;L=u(O.pop());case"hsl":if(O.length!==3)return null;var V=(parseFloat(O[0])%360+360)%360/360,H=u(O[1]),X=u(O[2]),te=X<=.5?X*(H+1):X+H-X*H,ae=2*X-te;return[e(255*d(ae,te,V+1/3)),e(255*d(ae,te,V)),e(255*d(ae,te,V-1/3)),L];default:return null}}return null}}catch{}return Eu}();class In{constructor(e,o,u,d=1){this.r=e,this.g=o,this.b=u,this.a=d}static parse(e){if(!e)return;if(e instanceof In)return e;if(typeof e!="string")return;const o=qs.parseCSSColor(e);return o?new In(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[e,o,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*o)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(e){const{r:o,g:u,b:d,a:g}=this;return new Ad(e,o,u,d,g)}toPremultipliedRenderColor(e){const{r:o,g:u,b:d,a:g}=this;return new cm(e,o*g,u*g,d*g,g)}clone(){return new In(this.r,this.g,this.b,this.a)}}class Ma{constructor(e,o,u,d,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,e){const T=e.image.height,C=T*T;this.premultiplied?(o=g===0?0:o/g*(T-1),u=g===0?0:u/g*(T-1),d=g===0?0:d/g*(T-1)):(o*=T-1,u*=T-1,d*=T-1);const I=Math.floor(o),N=Math.floor(u),O=Math.floor(d),L=Math.ceil(o),V=Math.ceil(u),H=Math.ceil(d),X=o-I,te=u-N,ae=d-O,de=e.image.data,pe=4*(I+N*C+O*T),Q=4*(I+N*C+H*T),he=4*(I+V*C+O*T),me=4*(I+V*C+H*T),_e=4*(L+N*C+O*T),De=4*(L+N*C+H*T),ke=4*(L+V*C+O*T),Oe=4*(L+V*C+H*T);if(pe<0||Oe>=de.length)throw new Error("out of range");this.r=Ir(Ir(Ir(de[pe],de[Q],ae),Ir(de[he],de[me],ae),te),Ir(Ir(de[_e],de[De],ae),Ir(de[ke],de[Oe],ae),te),X)/255*(this.premultiplied?g:1),this.g=Ir(Ir(Ir(de[pe+1],de[Q+1],ae),Ir(de[he+1],de[me+1],ae),te),Ir(Ir(de[_e+1],de[De+1],ae),Ir(de[ke+1],de[Oe+1],ae),te),X)/255*(this.premultiplied?g:1),this.b=Ir(Ir(Ir(de[pe+2],de[Q+2],ae),Ir(de[he+2],de[me+2],ae),te),Ir(Ir(de[_e+2],de[De+2],ae),Ir(de[ke+2],de[Oe+2],ae),te),X)/255*(this.premultiplied?g:1),this.a=g}else this.r=o,this.g=u,this.b=d,this.a=g}toArray(){const{r:e,g:o,b:u,a:d}=this;return[255*e,255*o,255*u,d]}toHslaArray(){let{r:e,g:o,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];e/=d,o/=d,u/=d}const g=Math.min(Math.max(e,0),1),y=Math.min(Math.max(o,0),1),T=Math.min(Math.max(u,0),1),C=Math.min(g,y,T),I=Math.max(g,y,T),N=(C+I)/2;if(C===I)return[0,0,100*N,d];const O=I-C,L=N>.5?O/(2-I-C):O/(I+C);let V=0;return I===g?V=(y-T)/O+(y<T?6:0):I===y?V=(T-g)/O+2:I===T&&(V=(g-y)/O+4),V*=60,[Math.min(Math.max(V,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*N,0),100),d]}toArray01(){const{r:e,g:o,b:u,a:d}=this;return[e,o,u,d]}toArray01Scaled(e){const{r:o,g:u,b:d}=this;return[o*e,u*e,d*e]}toArray01Linear(){const{r:e,g:o,b:u,a:d}=this;return[Math.pow(e,2.2),Math.pow(o,2.2),Math.pow(u,2.2),d]}}class Ad extends Ma{constructor(e,o,u,d,g){super(e,o,u,d,g,!1)}}class cm extends Ma{constructor(e,o,u,d,g){super(e,o,u,d,g,!0)}}function Ir(a,e,o){return a*(1-o)+e*o}function Sh(a,e,o){return a.map((u,d)=>Ir(u,e[d],o))}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1),In.blue=new In(0,0,1,1);var rc=Object.freeze({__proto__:null,array:Sh,color:function(a,e,o){return new In(Ir(a.r,e.r,o),Ir(a.g,e.g,o),Ir(a.b,e.b,o),Ir(a.a,e.a,o))},number:Ir});function Al(a,...e){for(const o of e)for(const u in o)a[u]=o[u];return a}class ra extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class um{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[u,d]of o)this.bindings[u]=d}concat(e){return new um(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Th={kind:"null"},or={kind:"number"},Un={kind:"string"},Bn={kind:"boolean"},na={kind:"color"},nc={kind:"object"},$n={kind:"value"},Nf={kind:"collator"},Eh={kind:"formatted"},Id={kind:"resolvedImage"};function Co(a,e){return{kind:"array",itemType:a,N:e}}function hs(a){if(a.kind==="array"){const e=hs(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const By=[Th,or,Un,Bn,na,Eh,nc,Co($n),Id];function Bc(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bc(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const o of By)if(!Bc(o,e))return null}}return`Expected ${hs(a)} but found ${hs(e)} instead.`}function Vc(a,e){return e.some(o=>o.kind===a.kind)}function Md(a,e){return e.some(o=>o==="null"?a===null:o==="array"?Array.isArray(a):o==="object"?a&&!Array.isArray(a)&&typeof a=="object":o===typeof a)}function Df(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&Df(a.itemType,e.itemType):a.kind===e.kind}class Ch{constructor(e,o,u){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Of{constructor(e,o,u,d,g){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=u,this.fontStack=d,this.textColor=g}}class Ao{constructor(e){this.sections=e}static fromString(e){return new Ao([new Of(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ao?e:Ao.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){const d=o.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class ic{constructor(e,o={}){if(this.id=_o.from(e),this.options=Object.assign({},o),o.transform){const{a:u,b:d,c:g,d:y,e:T,f:C}=o.transform;this.options.transform=new DOMMatrix([u,d,g,y,T,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:o,c:u,d,e:g,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:o,c:u,d,e:g,f:y}})}static parse(e){let o,u,d,g;try{({name:o,iconsetId:u,params:d,transform:g}=JSON.parse(e)||{})}catch{return null}if(!o)return null;const{a:y,b:T,c:C,d:I,e:N,f:O}=g||{};return new ic({name:o,iconsetId:u},{params:d,transform:new DOMMatrix([y,T,C,I,N,O])})}scaleSelf(e,o){return this.options.transform.scaleSelf(e,o),this}}class Uo{constructor(e,o,u,d,g=!1){this.primaryId=_o.from(e),this.primaryOptions=o,u&&(this.secondaryId=_o.from(u)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ic(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ic(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Uo.build({name:e}):e}static build(e,o,u,d){return!e||typeof e=="object"&&!("name"in e)?null:new Uo(e,u,o,d)}}function Cu(a,e,o,u){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,e,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,e,o,u]:[a,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ln(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof In||a instanceof Ch||a instanceof Ao||a instanceof Uo)return!0;if(Array.isArray(a)){for(const e of a)if(!ln(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!ln(a[e]))return!1;return!0}return!1}function Kt(a){if(a===null)return Th;if(typeof a=="string")return Un;if(typeof a=="boolean")return Bn;if(typeof a=="number")return or;if(a instanceof In)return na;if(a instanceof Ch)return Nf;if(a instanceof Ao)return Eh;if(a instanceof Uo)return Id;if(Array.isArray(a)){const e=a.length;let o;for(const u of a){const d=Kt(u);if(o){if(o===d)continue;o=$n;break}o=d}return Co(o||$n,e)}return nc}function ia(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof Ao||a instanceof Uo||a instanceof In?a.toString():JSON.stringify(a)}class Nr{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ln(e[1]))return o.error("invalid value");const u=e[1];let d=Kt(u);const g=o.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Nr(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof In?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ao?this.value.serialize():this.value}}class as{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ah={string:Un,number:or,boolean:Bn,object:nc};class Ar{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let u,d=1;const g=e[0];if(g==="array"){let T,C;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in Ah)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);T=Ah[I],d++}else T=$n;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=e[2],d++}u=Co(T,C)}else u=Ah[g];const y=[];for(;d<e.length;d++){const T=o.parse(e[d],d,$n);if(!T)return null;y.push(T)}return new Ar(u,y)}evaluate(e){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(e);if(!Bc(this.type,Kt(u)))return u;if(o===this.args.length-1)throw new as(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${hs(Kt(u))} but was expected to be of type ${hs(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if(e.kind==="array"){const u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&o.push(d)}}return o.concat(this.args.map(u=>u.serialize()))}}class Au{constructor(e){this.type=Eh,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=e.length-1;++y){const T=e[y];if(g&&typeof T=="object"&&!Array.isArray(T)){g=!1;let C=null;if(T["font-scale"]&&(C=o.parseObjectValue(T["font-scale"],y,"font-scale",or),!C))return null;let I=null;if(T["text-font"]&&(I=o.parseObjectValue(T["text-font"],y,"text-font",Co(Un)),!I))return null;let N=null;if(T["text-color"]&&(N=o.parseObjectValue(T["text-color"],y,"text-color",na),!N))return null;const O=d[d.length-1];O.scale=C,O.font=I,O.textColor=N}else{const C=o.parse(e[y],y,$n);if(!C)return null;const I=C.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:C,scale:null,font:null,textColor:null})}}return new Au(d)}evaluate(e){return new Ao(this.sections.map(o=>{const u=o.content.evaluate(e);return Df(Kt(u),Id)?new Of("",u,null,null,null):new Of(ia(u),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),e.push(u)}return e}}class Iu{constructor(e,o,u,d){this._imageWarnHistory={},this.type=Id,this.namePrimary=e,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,o){if(e.length<2)return o.error("Expected two or more arguments.");let u=1;const d=[];function g(){if(u<e.length){const T=o.parse(e[u],u++,Un);return T?(d.push({image:T,options:{}}),!0):(o.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<e.length){const C=e[u];if((T=C)===null||typeof T!="object"||Array.isArray(T))return!0;const I=C.params,N=C.iconset,O=o.concat(u);if(!I&&!N)return u++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const L={},V=O.concat(void 0,"params");for(const H in I){if(!H)return V.error("Image parameter name should be non-empty"),!1;const X=V.concat(void 0,H).parse(I[H],void 0,na,void 0,{typeAnnotation:"coerce"});if(!X)return!1;L[H]=X}d[d.length-1].options.params=L}if(N){if(typeof N!="object"||N.constructor!==Object)return O.error('Image options "iconset" should be an object'),!1;if(!N.id)return O.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=N}return u++,!0}var T;return!0}for(let T=0;T<2;T++)if(!g()||!y())return;return new Iu(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,o){const u={};if(o){for(const d in o)if(o[d])try{u[d]=o[d].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){const o={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=Uo.build(o,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){const g=d.getPrimary().id;if(d.available=e.availableImages.some(y=>_o.isEqual(y,g)),d.available){const y=d.getSecondary()?d.getSecondary().id:null;y&&(d.available=e.availableImages.some(T=>_o.isEqual(T,y)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&e(this.paramsPrimary[o]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&e(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(e,o){const u={};if(o&&(u.iconset={id:o}),e){u.params={};for(const d in e)e[d]&&(u.params[d]=e[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&e.push(o)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&e.push(o)}return e}}function sc(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const Mu={"to-boolean":Bn,"to-color":na,"to-number":or,"to-string":Un};class Ya{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[0],d=[];let g=Th;if(u==="to-array"){if(!Array.isArray(e[1]))return null;const y=e[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);g=Co(o.expectedType.itemType,y)}else{if(!(y>0&&ln(e[1][0])))return null;g=Co(Kt(e[1][0]),y)}for(let T=0;T<y;T++){const C=e[1][T];let I;if(sc(C)==="array")I=o.parse(C,void 0,g.itemType);else{const N=sc(C);if(N!==g.itemType.kind)return o.error(`Expected ${g.itemType.kind} but found ${N}.`);I=o.registry.literal.parse(["literal",C===void 0?null:C],o)}if(!I)return null;d.push(I)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return o.error("Expected one argument.");g=Mu[u];for(let y=1;y<e.length;y++){const T=o.parse(e[y],y,$n);if(!T)return null;d.push(T)}}return new Ya(g,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let o,u;for(const d of this.args){if(o=d.evaluate(e),u=null,o instanceof In)return o;if(typeof o=="string"){const g=e.parseColor(o);if(g)return g}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Cu(o[0],o[1],o[2],o[3]),!u))return new In(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new as(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(e),o===null)return 0;const d=Number(o);if(!isNaN(d))return d}throw new as(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Ao.fromString(ia(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Uo.build(ia(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(o=>o.evaluate(e)):ia(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Au([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Iu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}const Io=["Unknown","Point","LineString","Polygon"];class kd{constructor(e,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-e[0])+this.featureDistanceData.bearing[1]*(d*o-e[1])}return 0}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=In.parse(e)),o}getConfig(e){return this.options?this.options.get(e):null}}class Ms{constructor(e,o,u,d,g){this.name=e,this.type=o,this._evaluate=u,this.args=d,this._overloadIndex=g}evaluate(e){if(!this._evaluate){const o=Ms.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const u=e[0],d=Ms.definitions[u];if(!d)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,T=[];let C=null,I=-1;for(const[N,O]of y){if(Array.isArray(N)&&N.length!==e.length-1)continue;T.push(N),I++,C=new Lh(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const L=[];let V=!1;for(let H=1;H<e.length;H++){const X=e[H],te=Array.isArray(N)?N[H-1]:N.type,ae=C.parse(X,1+L.length,te);if(!ae){V=!0;break}L.push(ae)}if(!V)if(Array.isArray(N)&&N.length!==L.length)C.error(`Expected ${N.length} arguments, but found ${L.length} instead.`);else{for(let H=0;H<L.length;H++){const X=Array.isArray(N)?N[H]:N.type,te=L[H];C.concat(H+1).checkSubtype(X,te.type)}if(C.errors.length===0)return new Ms(u,g,O,L,I)}}if(T.length===1)o.errors.push(...C.errors);else{const N=(T.length?T:y.map(([L])=>L)).map(Lf).join(" | "),O=[];for(let L=1;L<e.length;L++){const V=o.parse(e[L],1+O.length);if(!V)return null;O.push(hs(V.type))}o.error(`Expected arguments of type ${N}, but found (${O.join(", ")}) instead.`)}return null}static register(e,o){Ms.definitions=o;for(const u in o)e[u]=Ms}}function Lf(a){return Array.isArray(a)?`(${a.map(hs).join(", ")})`:`(${hs(a.type)}...)`}class sa{constructor(e,o,u){this.type=Nf,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?o.parse(!1,1,Bn):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Bn);if(!d)return null;const g=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Bn):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Bn);if(!g)return null;let y=null;return u.locale&&(y=o.parseObjectValue(u.locale,1,"locale",Un),!y)?null:new sa(d,g,y)}evaluate(e){return new Ch(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ks(a,e,o=0,u=a.length-1,d=zf){for(;u>o;){if(u-o>600){const C=u-o+1,I=e-o+1,N=Math.log(C),O=.5*Math.exp(2*N/3),L=.5*Math.sqrt(N*O*(C-O)/C)*(I-C/2<0?-1:1);ks(a,e,Math.max(o,Math.floor(e-I*O/C+L)),Math.min(u,Math.floor(e+(C-I)*O/C+L)),d)}const g=a[e];let y=o,T=u;for(Pd(a,o,e),d(a[u],g)>0&&Pd(a,o,u);y<T;){for(Pd(a,y,T),y++,T--;d(a[y],g)<0;)y++;for(;d(a[T],g)>0;)T--}d(a[o],g)===0?Pd(a,o,T):(T++,Pd(a,T,u)),T<=e&&(o=T+1),e<=T&&(u=T-1)}}function Pd(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}function zf(a,e){return a<e?-1:a>e?1:0}function Vy(a){let e=0;for(let o,u,d=0,g=a.length,y=g-1;d<g;y=d++)o=a[d],u=a[y],e+=(u.x-o.x)*(o.y+u.y);return e}function oc(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function Uc(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function ac(a,e,o){const u=a[0]-e[0],d=a[1]-e[1],g=a[0]-o[0],y=a[1]-o[1];return u*y-g*d==0&&u*g<=0&&d*y<=0}function ku(a,e,o=!1){let u=!1;for(let T=0,C=e.length;T<C;T++){const I=e[T];for(let N=0,O=I.length,L=O-1;N<O;L=N++){const V=I[L],H=I[N];if(ac(a,V,H))return o;(g=V)[1]>(d=a)[1]!=(y=H)[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var d,g,y;return u}function hm(a,e,o,u){const d=u[0]-o[0],g=u[1]-o[1],y=(a[0]-o[0])*g-d*(a[1]-o[1]),T=(e[0]-o[0])*g-d*(e[1]-o[1]);return y>0&&T<0||y<0&&T>0}function Rd(a,e,o,u){return(d=[u[0]-o[0],u[1]-o[1]])[0]*(g=[e[0]-a[0],e[1]-a[1]])[1]-d[1]*g[0]!=0&&!(!hm(a,e,o,u)||!hm(o,u,a,e));var d,g}function dm(a){const e=new Ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new Ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),o.x<u.x&&(o.x=u.x),o.y<u.y&&(o.y=u.y);return{min:e,max:o}}const lc=8192;function Uy(a,e){const o=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(o*d*lc),Math.round(u*d*lc)]}function $y(a,e){for(let o=0;o<e.length;o++)if(ku(a,e[o]))return!0;return!1}function Cg(a,e,o){for(const u of o)for(let d=0,g=u.length,y=g-1;d<g;y=d++)if(Rd(a,e,u[y],u[d]))return!0;return!1}function Ja(a,e){for(let o=0;o<a.length;++o)if(!ku(a[o],e))return!1;for(let o=0;o<a.length-1;++o)if(Cg(a[o],a[o+1],e))return!1;return!0}function ul(a,e){for(let o=0;o<e.length;o++)if(Ja(a,e[o]))return!0;return!1}function jf(a,e,o){const u=[];for(let d=0;d<a.length;d++){const g=[];for(let y=0;y<a[d].length;y++){const T=Uy(a[d][y],o);oc(e,T),g.push(T)}u.push(g)}return u}function fm(a,e,o){const u=[];for(let d=0;d<a.length;d++){const g=jf(a[d],e,o);u.push(g)}return u}function Nd(a,e,o,u){if(a[0]<o[0]||a[0]>o[2]){const d=.5*u;let g=a[0]-o[0]>d?-u:o[0]-a[0]>d?u:0;g===0&&(g=a[0]-o[2]>d?-u:o[2]-a[0]>d?u:0),a[0]+=g}oc(e,a)}function Ff(a,e,o,u){const d=Math.pow(2,u.z)*lc,g=[u.x*lc,u.y*lc],y=[];if(!a)return y;for(const T of a)for(const C of T){const I=[C.x+g[0],C.y+g[1]];Nd(I,e,o,d),y.push(I)}return y}function Dd(a,e,o,u){const d=Math.pow(2,u.z)*lc,g=[u.x*lc,u.y*lc],y=[];if(!a)return y;for(const C of a){const I=[];for(const N of C){const O=[N.x+g[0],N.y+g[1]];oc(e,O),I.push(O)}y.push(I)}if(e[2]-e[0]<=d/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of y)for(const I of C)Nd(I,e,o,d)}var T;return y}class xo{constructor(e,o){this.type=Bn,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ln(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new xo(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new xo(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xo(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const T=jf(u.coordinates,g,y),C=Ff(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!ku(I,T))return!1}if(u.type==="MultiPolygon"){const T=fm(u.coordinates,g,y),C=Ff(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!$y(I,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const T=jf(u.coordinates,g,y),C=Dd(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!Ja(I,T))return!1}if(u.type==="MultiPolygon"){const T=fm(u.coordinates,g,y),C=Dd(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!ul(I,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Od={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$c=1/298.257223563,Ld=$c*(2-$c),Il=Math.PI/180;class Hc{static fromTile(e,o,u){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,o)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Il;return new Hc(g,u)}static get units(){return Od}constructor(e,o){if(e===void 0)throw new Error("No latitude given.");if(o&&!Od[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Od).join(", ")}`);const u=6378.137*Il*(o?Od[o]:1),d=Math.cos(e*Il),g=1/(1-Ld*(1-d*d)),y=Math.sqrt(g);this.kx=u*y*d,this.ky=u*y*g*(1-Ld)}distance(e,o){const u=no(e[0]-o[0])*this.kx,d=(e[1]-o[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(e,o){const u=no(o[0]-e[0])*this.kx;return Math.atan2(u,(o[1]-e[1])*this.ky)/Il}destination(e,o,u){const d=u*Il;return this.offset(e,Math.sin(d)*o,Math.cos(d)*o)}offset(e,o,u){return[e[0]+o/this.kx,e[1]+u/this.ky]}lineDistance(e){let o=0;for(let u=0;u<e.length-1;u++)o+=this.distance(e[u],e[u+1]);return o}area(e){let o=0;for(let u=0;u<e.length;u++){const d=e[u];for(let g=0,y=d.length,T=y-1;g<y;T=g++)o+=no(d[g][0]-d[T][0])*(d[g][1]+d[T][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(e,o){let u=0;if(o<=0)return e[0];for(let d=0;d<e.length-1;d++){const g=e[d],y=e[d+1],T=this.distance(g,y);if(u+=T,u>o)return Pu(g,y,(o-(u-T))/T)}return e[e.length-1]}pointToSegmentDistance(e,o,u){let[d,g]=o,y=no(u[0]-d)*this.kx,T=(u[1]-g)*this.ky;if(y!==0||T!==0){const C=(no(e[0]-d)*this.kx*y+(e[1]-g)*this.ky*T)/(y*y+T*T);C>1?(d=u[0],g=u[1]):C>0&&(d+=y/this.kx*C,g+=T/this.ky*C)}return y=no(e[0]-d)*this.kx,T=(e[1]-g)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(e,o){let u=1/0,d=e[0][0],g=e[0][1],y=0,T=0;for(let C=0;C<e.length-1;C++){let I=e[C][0],N=e[C][1],O=no(e[C+1][0]-I)*this.kx,L=(e[C+1][1]-N)*this.ky,V=0;O===0&&L===0||(V=(no(o[0]-I)*this.kx*O+(o[1]-N)*this.ky*L)/(O*O+L*L),V>1?(I=e[C+1][0],N=e[C+1][1]):V>0&&(I+=O/this.kx*V,N+=L/this.ky*V)),O=no(o[0]-I)*this.kx,L=(o[1]-N)*this.ky;const H=O*O+L*L;H<u&&(u=H,d=I,g=N,y=C,T=V)}return{point:[d,g],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(e,o,u){let d=this.pointOnLine(u,e),g=this.pointOnLine(u,o);if(d.index>g.index||d.index===g.index&&d.t>g.t){const I=d;d=g,g=I}const y=[d.point],T=d.index+1,C=g.index;!Bf(u[T],y[0])&&T<=C&&y.push(u[T]);for(let I=T+1;I<=C;I++)y.push(u[I]);return Bf(u[C],g.point)||y.push(g.point),y}lineSliceAlong(e,o,u){let d=0;const g=[];for(let y=0;y<u.length-1;y++){const T=u[y],C=u[y+1],I=this.distance(T,C);if(d+=I,d>e&&g.length===0&&g.push(Pu(T,C,(e-(d-I))/I)),d>=o)return g.push(Pu(T,C,(o-(d-I))/I)),g;d>e&&g.push(C)}return g}bufferPoint(e,o){const u=o/this.ky,d=o/this.kx;return[e[0]-d,e[1]-u,e[0]+d,e[1]+u]}bufferBBox(e,o){const u=o/this.ky,d=o/this.kx;return[e[0]-d,e[1]-u,e[2]+d,e[3]+u]}insideBBox(e,o){return no(e[0]-o[0])>=0&&no(e[0]-o[2])<=0&&e[1]>=o[1]&&e[1]<=o[3]}}function Bf(a,e){return a[0]===e[0]&&a[1]===e[1]}function Pu(a,e,o){const u=no(e[0]-a[0]);return[a[0]+u*o,a[1]+(e[1]-a[1])*o]}function no(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Ih{constructor(e=[],o=(u,d)=>u<d?-1:u>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:u}=this,d=o[e];for(;e>0;){const g=e-1>>1,y=o[g];if(u(d,y)>=0)break;o[e]=y,e=g}o[e]=d}_down(e){const{data:o,compare:u}=this,d=this.length>>1,g=o[e];for(;e<d;){let y=1+(e<<1);const T=y+1;if(T<this.length&&u(o[T],o[y])<0&&(y=T),u(o[y],g)>=0)break;o[e]=o[y],e=y}o[e]=g}}var jt=8192;function Mh(a,e){return e.dist-a.dist}const Ru=100,Nu=50;function kh(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==a[o])return!1;return!0}function Ph(a){return a[1]-a[0]+1}function hl(a,e){const o=a[1]>=a[0]&&a[1]<e;return o||console.warn("Distance Expression: Index is out of range"),o}function zd(a,e){if(a[0]>a[1])return[null,null];const o=Ph(a);if(e){if(o===2)return[a,null];const u=Math.floor(o/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(o===1)return[a,null];const u=Math.floor(o/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function Ws(a,e){const o=[1/0,1/0,-1/0,-1/0];if(!hl(e,a.length))return o;for(let u=e[0];u<=e[1];++u)oc(o,a[u]);return o}function pn(a){const e=[1/0,1/0,-1/0,-1/0];for(let o=0;o<a.length;++o)for(let u=0;u<a[o].length;++u)oc(e,a[o][u]);return e}function Gc(a,e,o){if(kh(a)||kh(e))return NaN;let u=0,d=0;return a[2]<e[0]&&(u=e[0]-a[2]),a[0]>e[2]&&(u=a[0]-e[2]),a[1]>e[3]&&(d=a[1]-e[3]),a[3]<e[1]&&(d=e[1]-a[3]),o.distance([0,0],[u,d])}function Hy(a){return 360*a-180}function Gy(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function qc(a,e){const o=Math.pow(2,e.z),u=(a.y/jt+e.y)/o;return[Hy((a.x/jt+e.x)/o),Gy(u)]}function qy(a,e){const o=[];for(let u=0;u<a.length;++u)o.push(qc(a[u],e));return o}function Ni(a,e,o){const u=o.pointOnLine(e,a).point;return o.distance(a,u)}function pm(a,e,o,u,d){const g=o.slice(u[0],u[1]+1);let y=1/0;for(let T=e[0];T<=e[1];++T)if((y=Math.min(y,Ni(a[T],g,d)))===0)return 0;return y}function es(a,e,o,u,d){const g=Math.min(d.pointToSegmentDistance(a,o,u),d.pointToSegmentDistance(e,o,u)),y=Math.min(d.pointToSegmentDistance(o,a,e),d.pointToSegmentDistance(u,a,e));return Math.min(g,y)}function mm(a,e,o,u,d){if(!hl(e,a.length)||!hl(u,o.length))return NaN;let g=1/0;for(let y=e[0];y<e[1];++y)for(let T=u[0];T<u[1];++T){if(Rd(a[y],a[y+1],o[T],o[T+1]))return 0;g=Math.min(g,es(a[y],a[y+1],o[T],o[T+1],d))}return g}function Vf(a,e,o,u,d){if(!hl(e,a.length)||!hl(u,o.length))return NaN;let g=1/0;for(let y=e[0];y<=e[1];++y)for(let T=u[0];T<=u[1];++T)if((g=Math.min(g,d.distance(a[y],o[T])))===0)return g;return g}function jd(a,e,o){if(ku(a,e,!0))return 0;let u=1/0;for(const d of e){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(u=Math.min(u,o.pointToSegmentDistance(a,d[g-1],d[0])))===0||(u=Math.min(u,Ni(a,d,o)))===0)return u}return u}function Ag(a,e,o,u){if(!hl(e,a.length))return NaN;for(let g=e[0];g<=e[1];++g)if(ku(a[g],o,!0))return 0;let d=1/0;for(let g=e[0];g<e[1];++g)for(const y of o)for(let T=0,C=y.length,I=C-1;T<C;I=T++){if(Rd(a[g],a[g+1],y[I],y[T]))return 0;d=Math.min(d,es(a[g],a[g+1],y[I],y[T],u))}return d}function Uf(a,e){for(const o of a)for(let u=0;u<=o.length-1;++u)if(ku(o[u],e,!0))return!0;return!1}function Fd(a,e,o,u=1/0){const d=pn(a),g=pn(e);if(u!==1/0&&Gc(d,g,o)>=u)return u;if(Uc(d,g)){if(Uf(a,e))return 0}else if(Uf(e,a))return 0;let y=u;for(const T of a)for(let C=0,I=T.length,N=I-1;C<I;N=C++)for(const O of e)for(let L=0,V=O.length,H=V-1;L<V;H=L++){if(Rd(T[N],T[C],O[H],O[L]))return 0;y=Math.min(y,es(T[N],T[C],O[H],O[L],o))}return y}function Du(a,e,o,u,d,g,y){if(g===null||y===null)return;const T=Gc(Ws(u,g),Ws(d,y),o);T<e&&a.push({dist:T,range1:g,range2:y})}function Rh(a,e,o,u,d=1/0){let g=Math.min(u.distance(a[0],o[0][0]),d);if(g===0)return g;const y=new Ih([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Mh),T=e?Nu:Ru,C=pn(o);for(;y.length;){const I=y.pop();if(I.dist>=g)continue;const N=I.range1;if(Ph(N)<=T){if(!hl(N,a.length))return NaN;if(e){const O=Ag(a,N,o,u);if((g=Math.min(g,O))===0)return g}else for(let O=N[0];O<=N[1];++O){const L=jd(a[O],o,u);if((g=Math.min(g,L))===0)return g}}else{const O=zd(N,e);if(O[0]!==null){const L=Gc(Ws(a,O[0]),C,u);L<g&&y.push({dist:L,range1:O[0],range2:[0,0]})}if(O[1]!==null){const L=Gc(Ws(a,O[1]),C,u);L<g&&y.push({dist:L,range1:O[1],range2:[0,0]})}}}return g}function gm(a,e,o,u,d,g=1/0){let y=Math.min(g,d.distance(a[0],o[0]));if(y===0)return y;const T=new Ih([{dist:0,range1:[0,a.length-1],range2:[0,o.length-1]}],Mh),C=e?Nu:Ru,I=u?Nu:Ru;for(;T.length;){const N=T.pop();if(N.dist>=y)continue;const O=N.range1,L=N.range2;if(Ph(O)<=C&&Ph(L)<=I){if(!hl(O,a.length)||!hl(L,o.length))return NaN;if(e&&u?y=Math.min(y,mm(a,O,o,L,d)):e||u?e&&!u?y=Math.min(y,pm(o,L,a,O,d)):!e&&u&&(y=Math.min(y,pm(a,O,o,L,d))):y=Math.min(y,Vf(a,O,o,L,d)),y===0)return y}else{const V=zd(O,e),H=zd(L,u);Du(T,y,d,a,o,V[0],H[0]),Du(T,y,d,a,o,V[0],H[1]),Du(T,y,d,a,o,V[1],H[0]),Du(T,y,d,a,o,V[1],H[1])}}return y}function ym(a,e,o,u,d=1/0){let g=d;const y=Ws(a,[0,a.length-1]);for(const T of o)if(!(g!==1/0&&Gc(y,Ws(T,[0,T.length-1]),u)>=g)&&(g=Math.min(g,gm(a,e,T,!0,u,g)),g===0))return g;return g}function $f(a,e,o,u,d=1/0){let g=d;const y=Ws(a,[0,a.length-1]);for(const T of o){if(g!==1/0&&Gc(y,pn(T),u)>=g)continue;const C=Rh(a,e,T,u,g);if(isNaN(C))return C;if((g=Math.min(g,C))===0)return g}return g}function Hf(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Ml{constructor(e,o){this.type=or,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ln(e[1])){const u=e[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(Hf(u.features[d].geometry.type))return new Ml(u,u.features[d].geometry)}else if(u.type==="Feature"){if(Hf(u.geometry.type))return new Ml(u,u.geometry)}else if(Hf(u.type))return new Ml(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const o=e.geometry(),u=e.canonicalID();if(o!=null&&u!=null){if(e.geometryType()==="Point")return function(d,g,y){const T=[];for(const I of d)for(const N of I)T.push(qc(N,g));const C=new Hc(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?gm(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",C):y.type==="MultiLineString"?ym(T,!1,y.coordinates,C):y.type==="Polygon"||y.type==="MultiPolygon"?$f(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,C):null}(o,u,this.geometries);if(e.geometryType()==="LineString")return function(d,g,y){const T=[];for(const I of d){const N=[];for(const O of I)N.push(qc(O,g));T.push(N)}const C=new Hc(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return ym(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let I=1/0;for(let N=0;N<y.coordinates.length;N++){const O=ym(y.coordinates[N],!0,T,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}if(y.type==="Polygon"||y.type==="MultiPolygon"){let I=1/0;for(let N=0;N<T.length;N++){const O=$f(T[N],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}return null}(o,u,this.geometries);if(e.geometryType()==="Polygon")return function(d,g,y){const T=[];for(const I of function(N,O){const L=N.length;if(L<=1)return[N];const V=[];let H,X;for(let te=0;te<L;te++){const ae=Vy(N[te]);ae!==0&&(N[te].area=Math.abs(ae),X===void 0&&(X=ae<0),X===ae<0?(H&&V.push(H),H=[N[te]]):H.push(N[te]))}return H&&V.push(H),V}(d)){const N=[];for(let O=0;O<I.length;++O)N.push(qy(I[O],g));T.push(N)}const C=new Hc(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return $f(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let I=1/0;for(let N=0;N<y.coordinates.length;N++){const O=$f(y.coordinates[N],!0,T,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}return y.type==="Polygon"||y.type==="MultiPolygon"?function(I,N,O){let L=1/0;for(const V of I)for(const H of N){const X=Fd(V,H,O,L);if(isNaN(X))return X;if((L=Math.min(L,X))===0)return L}return L}(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,C):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function cc(a){if(a instanceof Ms&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof xo||a instanceof Ml)return!1;if(a instanceof Oh)return a.featureConstant;let e=!0;return a.eachChild(o=>{e&&!cc(o)&&(e=!1)}),e}function Nh(a){if(a instanceof Ms&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(o=>{e&&!Nh(o)&&(e=!1)}),e}function Dh(a){if(a instanceof Oh)return new Set([a.key]);let e=new Set;return a.eachChild(o=>{e=new Set([...e,...Dh(o)])}),e}function Wc(a,e){if(a instanceof Ms&&e.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild(u=>{o&&!Wc(u,e)&&(o=!1)}),o}function Gf(a,e,o){return[a,e,o].filter(Boolean).join("")}function _m(a,e){switch(a){case"string":return ia(e);case"number":return+e;case"boolean":return!!e;case"color":return In.parse(e);case"formatted":return Ao.fromString(ia(e));case"resolvedImage":return Uo.build(ia(e))}return e}function xm(a,e,o,u){return u!==void 0&&(a=u*Math.round(a/u)),e!==void 0&&a<e&&(a=e),o!==void 0&&a>o&&(a=o),a}class Oh{constructor(e,o,u,d=!1){this.type=e,this.key=o,this.scope=u,this.featureConstant=d}static parse(e,o){let u=o.expectedType;if(u==null&&(u=$n),e.length<2||e.length>3)return o.error("Invalid number of arguments for 'config' expression.");const d=o.parse(e[1],1);if(!(d instanceof Nr))return o.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const T=ia(d.value);if(e.length>=3){const C=o.parse(e[2],2);if(!(C instanceof Nr))return o.error("Scope of 'config' expression must be a string literal.");g=ia(C.value)}if(o.options){const C=Gf(T,g,o._scope),I=o.options.get(C);I&&(y=cc(I.value||I.default))}return new Oh(u,T,g,y)}evaluate(e){const o=Gf(this.key,this.scope,e.scope),u=e.getConfig(o);if(!u)return null;const{type:d,value:g,values:y,minValue:T,maxValue:C,stepValue:I}=u,N=u.default.evaluate(e);let O=N;if(g){const L=e.scope;e.scope=(L||"").split("").slice(1).join(""),O=g.evaluate(e),e.scope=L}return d&&(O=_m(d,O)),O===void 0||T===void 0&&C===void 0&&I===void 0||(typeof O=="number"?O=xm(O,T,C,I):Array.isArray(O)&&(O=O.map(L=>typeof L=="number"?xm(L,T,C,I):L))),g!==void 0&&O!==void 0&&y&&!y.includes(O)&&(O=N,d&&(O=_m(d,O))),(d&&d!==this.type||O!==void 0&&!Df(Kt(O),this.type))&&(O=_m(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class qf{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=e[1];return o.scope.has(u)?new qf(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lh{constructor(e,o=[],u,d=new um,g=[],y,T){this.registry=e,this.path=o,this.key=o.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u,this._scope=y,this.options=T}parse(e,o,u,d,g={}){return o||u?this.concat(o,null,u,d)._parse(e,g):this._parse(e,g)}parseObjectValue(e,o,u,d,g,y={}){return this.concat(o,u,d,g)._parse(e,y)}_parse(e,o){function u(d,g,y){return y==="assert"?new Ar(g,[d]):y==="coerce"?new Ya(g,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let g=d.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,T=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else g=u(g,y,o.typeAnnotation||"coerce");else g=u(g,y,o.typeAnnotation||"assert")}if(!(g instanceof Nr)&&g.type.kind!=="resolvedImage"&&kl(g)){const y=new kd(this._scope,this.options);try{g=new Nr(g.type,g.evaluate(y))}catch(T){return this.error(T.message),null}}return g}return Ya.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,u,d){let g=typeof e=="number"?this.path.concat(e):this.path;g=typeof o=="string"?g.concat(o):g;const y=d?this.scope.concat(d):this.scope;return new Lh(this.registry,g,u||null,y,this.errors,this._scope,this.options)}error(e,...o){const u=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new ra(u,e))}checkSubtype(e,o){const u=Bc(e,o);return u&&this.error(u),u}}function kl(a){if(a instanceof qf)return kl(a.boundExpression);if(a instanceof Ms&&a.name==="error"||a instanceof sa||a instanceof xo||a instanceof Ml||a instanceof Oh)return!1;const e=a instanceof Ya||a instanceof Ar;let o=!0;return a.eachChild(u=>{o=e?o&&kl(u):o&&u instanceof Nr}),!!o&&cc(a)&&Wc(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bd(a,e){const o=a.length-1;let u,d,g=0,y=o,T=0;for(;g<=y;)if(T=Math.floor((g+y)/2),u=a[T],d=a[T+1],u<=e){if(T===o||e<d)return T;g=T+1}else{if(!(u>e))throw new as("Input is not a number.");y=T-1}return 0}class Pl{constructor(e,o,u){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(e[1],1,or);if(!u)return null;const d=[];let g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(let y=1;y<e.length;y+=2){const T=y===1?-1/0:e[y],C=e[y+1],I=y,N=y+1;if(typeof T!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=T)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=o.parse(C,N,g);if(!O)return null;g=g||O.type,d.push([T,O])}return new Pl(g,u,d)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return u[0].evaluate(e);const g=o.length;return d>=o[g-1]?u[g-1].evaluate(e):u[Bd(o,d)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}const dl=.95047,zh=1.08883,Rl=4/29,Nl=6/29,Ig=3*Nl*Nl,Mg=Nl*Nl*Nl,Ou=Math.PI/180,Vd=180/Math.PI;function Zc(a){return a>Mg?Math.pow(a,1/3):a/Ig+Rl}function Lu(a){return a>Nl?a*a*a:Ig*(a-Rl)}function jh(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ka(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Dl(a){const e=ka(a.r),o=ka(a.g),u=ka(a.b),d=Zc((.4124564*e+.3575761*o+.1804375*u)/dl),g=Zc((.2126729*e+.7151522*o+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-Zc((.0193339*e+.119192*o+.9503041*u)/zh)),alpha:a.a}}function ts(a){let e=(a.l+16)/116,o=isNaN(a.a)?e:e+a.a/500,u=isNaN(a.b)?e:e-a.b/200;return e=1*Lu(e),o=dl*Lu(o),u=zh*Lu(u),new In(jh(3.2404542*o-1.5371385*e-.4985314*u),jh(-.969266*o+1.8760108*e+.041556*u),jh(.0556434*o-.2040259*e+1.0572252*u),a.alpha)}function rs(a,e,o){const u=e-a;return a+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const oa={forward:Dl,reverse:ts,interpolate:function(a,e,o){return{l:Ir(a.l,e.l,o),a:Ir(a.a,e.a,o),b:Ir(a.b,e.b,o),alpha:Ir(a.alpha,e.alpha,o)}}},bs={forward:function(a){const{l:e,a:o,b:u}=Dl(a),d=Math.atan2(u,o)*Vd;return{h:d<0?d+360:d,c:Math.sqrt(o*o+u*u),l:e,alpha:a.a}},reverse:function(a){const e=a.h*Ou,o=a.c;return ts({l:a.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:a.alpha})},interpolate:function(a,e,o){return{h:rs(a.h,e.h,o),c:Ir(a.c,e.c,o),l:Ir(a.l,e.l,o),alpha:Ir(a.alpha,e.alpha,o)}}};var $o=Object.freeze({__proto__:null,hcl:bs,lab:oa});class Zs{constructor(e,o,u,d,g){this.type=e,this.operator=o,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[y,T]of g)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(e,o,u,d){let g=0;if(e.name==="exponential")g=uc(o,e.base,u,d);else if(e.name==="linear")g=uc(o,1,u,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;g=new Ha(y[0],y[1],y[2],y[3]).solve(uc(o,1,u,d))}return g}static parse(e,o){let[u,d,g,...y]=e;if(!Array.isArray(d)||d.length===0)return o.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(N=>typeof N!="number"||N<0||N>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(g=o.parse(g,2,or),!g)return null;const T=[];let C=null;u==="interpolate-hcl"||u==="interpolate-lab"?C=na:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let I=0;I<y.length;I+=2){const N=y[I],O=y[I+1],L=I+3,V=I+4;if(typeof N!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(T.length&&T[T.length-1][0]>=N)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const H=o.parse(O,V,C);if(!H)return null;C=C||H.type,T.push([N,H])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Zs(C,u,d,g,T):o.error(`Type ${hs(C)} is not interpolatable.`)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return u[0].evaluate(e);const g=o.length;if(d>=o[g-1])return u[g-1].evaluate(e);const y=Bd(o,d),T=Zs.interpolationFactor(this.interpolation,d,o[y],o[y+1]),C=u[y].evaluate(e),I=u[y+1].evaluate(e);return this.operator==="interpolate"?rc[this.type.kind.toLowerCase()](C,I,T):this.operator==="interpolate-hcl"?bs.reverse(bs.interpolate(bs.forward(C),bs.forward(I),T)):oa.reverse(oa.interpolate(oa.forward(C),oa.forward(I),T))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function uc(a,e,o,u){const d=u-o,g=a-o;return d===0?0:e===1?g/d:(Math.pow(e,g)-1)/(Math.pow(e,d)-1)}class io{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let u=null;const d=o.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const T of e.slice(1)){const C=o.parse(T,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,g.push(C)}const y=d&&g.some(T=>Bc(d,T.type));return new io(y?$n:u,g)}evaluate(e){let o,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(e),u&&u instanceof Uo&&!u.available&&(o||(o=u),u=null,d===this.args.length))return o;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class zu{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",g);const T=o.parse(e[g+1],g+1);if(!T)return null;u.push([y,T])}const d=o.parse(e[e.length-1],e.length-1,o.expectedType,u);return d?new zu(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,u]of this.bindings)e.push(o,u.serialize());return e.push(this.result.serialize()),e}}class Wf{constructor(e,o,u){this.type=e,this.index=o,this.input=u}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,or),d=o.parse(e[2],2,Co(o.expectedType||$n));return u&&d?new Wf(d.type.itemType,u,d):null}evaluate(e){const o=this.index.evaluate(e),u=this.input.evaluate(e);if(o<0)throw new as(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new as(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new as(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zf{constructor(e,o,u){this.type=e,this.index=o,this.input=u}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,or),d=o.parse(e[2],2,Co(o.expectedType||$n));return u&&d?new Zf(d.type.itemType,u,d):null}evaluate(e){const o=this.index.evaluate(e),u=this.input.evaluate(e);if(o<0)throw new as(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new as(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const d=Math.floor(o),g=Math.ceil(o),y=u[d],T=u[g];if(typeof y!="number"||typeof T!="number")throw new as(`Cannot interpolate between non-number values at index ${o}.`);const C=o-d;return y*(1-C)+T*C}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ju{constructor(e,o){this.type=Bn,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$n),d=o.parse(e[2],2,$n);return u&&d?Vc(u.type,[Bn,Un,or,Th,$n])?new ju(u,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${hs(u.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!Md(o,["boolean","string","number","null"]))throw new as(`Expected first argument to be of type boolean, string, number or null, but found ${hs(Kt(o))} instead.`);if(!Md(u,["string","array"]))throw new as(`Expected second argument to be of type array or string, but found ${hs(Kt(u))} instead.`);return u.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fh{constructor(e,o,u){this.type=or,this.needle=e,this.haystack=o,this.fromIndex=u}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$n),d=o.parse(e[2],2,$n);if(!u||!d)return null;if(!Vc(u.type,[Bn,Un,or,Th,$n]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${hs(u.type)} instead`);if(e.length===4){const g=o.parse(e[3],3,or);return g?new Fh(u,d,g):null}return new Fh(u,d)}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Md(o,["boolean","string","number","null"]))throw new as(`Expected first argument to be of type boolean, string, number or null, but found ${hs(Kt(o))} instead.`);if(!Md(u,["string","array"]))throw new as(`Expected second argument to be of type array or string, but found ${hs(Kt(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return u.indexOf(o,d)}return u.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class aa{constructor(e,o,u,d,g,y){this.inputType=e,this.type=o,this.input=u,this.cases=d,this.outputs=g,this.otherwise=y}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let u,d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const g={},y=[];for(let I=2;I<e.length-1;I+=2){let N=e[I];const O=e[I+1];Array.isArray(N)||(N=[N]);const L=o.concat(I);if(N.length===0)return L.error("Expected at least one branch label.");for(const H of N){if(typeof H!="number"&&typeof H!="string")return L.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,Kt(H)))return null}else u=Kt(H);if(g[String(H)]!==void 0)return L.error("Branch labels must be unique.");g[String(H)]=y.length}const V=o.parse(O,I,d);if(!V)return null;d=d||V.type,y.push(V)}const T=o.parse(e[1],1,$n);if(!T)return null;const C=o.parse(e[e.length-1],e.length-1,d);return C?T.type.kind!=="value"&&o.concat(1).checkSubtype(u,T.type)?null:new aa(u,d,T,g,y,C):null}evaluate(e){const o=this.input.evaluate(e);return(Df(Kt(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],d={};for(const y of o){const T=d[this.cases[y]];T===void 0?(d[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[T][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of u)e.push(T.length===1?g(T[0]):T.map(g)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}class Bh{constructor(e,o,u){this.type=e,this.branches=o,this.otherwise=u}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const T=o.parse(e[y],y,Bn);if(!T)return null;const C=o.parse(e[y+1],y+1,u);if(!C)return null;d.push([T,C]),u=u||C.type}const g=o.parse(e[e.length-1],e.length-1,u);return g?new Bh(u,d,g):null}evaluate(e){for(const[o,u]of this.branches)if(o.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,u]of this.branches)e(o),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class Fu{constructor(e,o,u,d){this.type=e,this.input=o,this.beginIndex=u,this.endIndex=d}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$n),d=o.parse(e[2],2,or);if(!u||!d)return null;if(!Vc(u.type,[Co($n),Un,$n]))return o.error(`Expected first argument to be of type array or string, but found ${hs(u.type)} instead`);if(e.length===4){const g=o.parse(e[3],3,or);return g?new Fu(u.type,u,d,g):null}return new Fu(u.type,u,d)}evaluate(e){const o=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Md(o,["string","array"]))throw new as(`Expected first argument to be of type array or string, but found ${hs(Kt(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return o.slice(u,d)}return o.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function vm(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function kg(a,e,o,u){return u.compare(e,o)===0}function la(a,e,o){const u=a!=="=="&&a!=="!=";return class UN{constructor(g,y,T){this.type=Bn,this.lhs=g,this.rhs=y,this.collator=T,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const T=g[0];let C=y.parse(g[1],1,$n);if(!C)return null;if(!vm(T,C.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${hs(C.type)}'.`);let I=y.parse(g[2],2,$n);if(!I)return null;if(!vm(T,I.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${hs(I.type)}'.`);if(C.type.kind!==I.type.kind&&C.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${hs(C.type)}' and '${hs(I.type)}'.`);u&&(C.type.kind==="value"&&I.type.kind!=="value"?C=new Ar(I.type,[C]):C.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ar(C.type,[I])));let N=null;if(g.length===4){if(C.type.kind!=="string"&&I.type.kind!=="string"&&C.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(N=y.parse(g[3],3,Nf),!N)return null}return new UN(C,I,N)}evaluate(g){const y=this.lhs.evaluate(g),T=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const C=Kt(y),I=Kt(T);if(C.kind!==I.kind||C.kind!=="string"&&C.kind!=="number")throw new as(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=Kt(y),I=Kt(T);if(C.kind!=="string"||I.kind!=="string")return e(g,y,T)}return this.collator?o(g,y,T,this.collator.evaluate(g)):e(g,y,T)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Bu=la("==",function(a,e,o){return e===o},kg),Vh=la("!=",function(a,e,o){return e!==o},function(a,e,o,u){return!kg(0,e,o,u)}),Xf=la("<",function(a,e,o){return e<o},function(a,e,o,u){return u.compare(e,o)<0}),Kf=la(">",function(a,e,o){return e>o},function(a,e,o,u){return u.compare(e,o)>0}),Ho=la("<=",function(a,e,o){return e<=o},function(a,e,o,u){return u.compare(e,o)<=0}),Qa=la(">=",function(a,e,o){return e>=o},function(a,e,o,u){return u.compare(e,o)>=0});class Ol{constructor(e,o,u,d,g,y){this.type=Un,this.number=e,this.locale=o,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");const u=o.parse(e[1],1,or);if(!u)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=o.parseObjectValue(d.locale,2,"locale",Un),!g))return null;let y=null;if(d.currency&&(y=o.parseObjectValue(d.currency,2,"currency",Un),!y))return null;let T=null;if(d.unit&&(T=o.parseObjectValue(d.unit,2,"unit",Un),!T))return null;let C=null;if(d["min-fraction-digits"]&&(C=o.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",or),!C))return null;let I=null;return d["max-fraction-digits"]&&(I=o.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",or),!I)?null:new Ol(u,g,y,T,C,I)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fl{constructor(e){this.type=or,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=o.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${hs(u.type)} instead.`):new fl(u):null}evaluate(e){const o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new as(`Expected value to be of type string or array, but found ${hs(Kt(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}function Ll(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Pa={"==":Bu,"!=":Vh,">":Kf,"<":Xf,">=":Qa,"<=":Ho,array:Ar,at:Wf,"at-interpolated":Zf,boolean:Ar,case:Bh,coalesce:io,collator:sa,format:Au,image:Iu,in:ju,"index-of":Fh,interpolate:Zs,"interpolate-hcl":Zs,"interpolate-lab":Zs,length:fl,let:zu,literal:Nr,match:aa,number:Ar,"number-format":Ol,object:Ar,slice:Fu,step:Pl,string:Ar,"to-boolean":Ya,"to-color":Ya,"to-number":Ya,"to-string":Ya,var:qf,within:xo,distance:Ml,config:Oh};function Yf(a,[e,o,u,d]){e=e.evaluate(a),o=o.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=Cu(e,o,u,g);if(y)throw new as(y);return new In(e/255,o/255,u/255,g)}function Ud(a,[e,o,u,d]){e=e.evaluate(a),o=o.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=function(I,N,O,L){return typeof I=="number"&&I>=0&&I<=360?typeof N=="number"&&N>=0&&N<=100&&typeof O=="number"&&O>=0&&O<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[I,N,O,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[I,N,O,L]:[I,N,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[I,N,O,L]:[I,N,O]).join(", ")}]: 'h' must be between 0 and 360.`}(e,o,u,g);if(y)throw new as(y);const T=`hsla(${e}, ${o}%, ${u}%, ${g})`,C=In.parse(T);if(!C)throw new as(`Failed to parse HSLA color: ${T}`);return C}function Jf(a,e){return a in e}function Ls(a,e){const o=e[a];return o===void 0?null:o}function Xs(a){return{type:a}}function ls(a){return{result:"success",value:a}}function so(a){return{result:"error",value:a}}function $d(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Uh(a){return a["property-type"]==="data-driven"}function Hd(a){return $d(a.expression,"measure-light")}function Gd(a){return $d(a.expression,"zoom")}function $h(a){return!!a.expression&&a.expression.interpolated}function Xc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function bm(a){return a}function Vu(a,e){const o=e.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),g=a.type||($h(e)?"exponential":"interval");if(o&&((a=Al({},a)).stops&&(a.stops=a.stops.map(I=>[I[0],In.parse(I[1])])),a.default=In.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!$o[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,T,C;if(g==="exponential")y=Hh;else if(g==="interval")y=qd;else if(g==="categorical"){y=Wy,T=Object.create(null);for(const I of a.stops)T[I[0]]=I[1];C=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=Pg}if(u){const I={},N=[];for(let V=0;V<a.stops.length;V++){const H=a.stops[V],X=H[0].zoom;I[X]===void 0&&(I[X]={zoom:X,type:a.type,property:a.property,default:a.default,stops:[]},N.push(X)),I[X].stops.push([H[0].value,H[1]])}const O=[];for(const V of N)O.push([I[V].zoom,Vu(I[V],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Zs.interpolationFactor.bind(void 0,L),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},H)=>Hh({stops:O,base:a.base},e,V).evaluate(V,H)}}if(d){const I=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Zs.interpolationFactor.bind(void 0,I),zoomStops:a.stops.map(N=>N[0]),evaluate:({zoom:N})=>y(a,e,N,T,C)}}return{kind:"source",evaluate(I,N){const O=N&&N.properties?N.properties[a.property]:void 0;return O===void 0?ca(a.default,e.default):y(a,e,O,T,C)}}}function ca(a,e,o){return a!==void 0?a:e!==void 0?e:o!==void 0?o:void 0}function Wy(a,e,o,u,d){return ca(typeof o===d?u[o]:void 0,a.default,e.default)}function qd(a,e,o){if(sc(o)!=="number")return ca(a.default,e.default);const u=a.stops.length;if(u===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[u-1][0])return a.stops[u-1][1];const d=Bd(a.stops.map(g=>g[0]),o);return a.stops[d][1]}function Hh(a,e,o){const u=a.base!==void 0?a.base:1;if(sc(o)!=="number")return ca(a.default,e.default);const d=a.stops.length;if(d===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[d-1][0])return a.stops[d-1][1];const g=Bd(a.stops.map(N=>N[0]),o),y=function(N,O,L,V){const H=V-L,X=N-L;return H===0?0:O===1?X/H:(Math.pow(O,X)-1)/(Math.pow(O,H)-1)}(o,u,a.stops[g][0],a.stops[g+1][0]),T=a.stops[g][1],C=a.stops[g+1][1];let I=rc[e.type]||bm;if(a.colorSpace&&a.colorSpace!=="rgb"){const N=$o[a.colorSpace];I=(O,L)=>N.reverse(N.interpolate(N.forward(O),N.forward(L),y))}return typeof T.evaluate=="function"?{evaluate(...N){const O=T.evaluate.apply(void 0,N),L=C.evaluate.apply(void 0,N);if(O!==void 0&&L!==void 0)return I(O,L,y)}}:I(T,C,y)}function Pg(a,e,o){return e.type==="color"?o=In.parse(o):e.type==="formatted"?o=Ao.fromString(o.toString()):e.type==="resolvedImage"?o=Uo.build(o.toString()):sc(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0),ca(o,a.default,e.default)}Ms.register(Pa,{error:[{kind:"error"},[Un],(a,[e])=>{throw new as(e.evaluate(a))}],typeof:[Un,[$n],(a,[e])=>hs(Kt(e.evaluate(a)))],"to-rgba":[Co(or,4),[na],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Co(or,4),[na],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[na,[or,or,or],Yf],rgba:[na,[or,or,or,or],Yf],hsl:[na,[or,or,or],Ud],hsla:[na,[or,or,or,or],Ud],has:{type:Bn,overloads:[[[Un],(a,[e])=>Jf(e.evaluate(a),a.properties())],[[Un,nc],(a,[e,o])=>Jf(e.evaluate(a),o.evaluate(a))]]},get:{type:$n,overloads:[[[Un],(a,[e])=>Ls(e.evaluate(a),a.properties())],[[Un,nc],(a,[e,o])=>Ls(e.evaluate(a),o.evaluate(a))]]},"feature-state":[$n,[Un],(a,[e])=>Ls(e.evaluate(a),a.featureState||{})],properties:[nc,[],a=>a.properties()],"geometry-type":[Un,[],a=>a.geometryType()],worldview:[Un,[],a=>a.globals.worldview||""],id:[$n,[],a=>a.id()],zoom:[or,[],a=>a.globals.zoom],pitch:[or,[],a=>a.globals.pitch||0],"distance-from-center":[or,[],a=>a.distanceFromCenter()],"measure-light":[or,[Un],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[or,[],a=>a.globals.heatmapDensity||0],"line-progress":[or,[],a=>a.globals.lineProgress||0],"raster-value":[or,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[or,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[or,[],a=>a.globals.skyRadialProgress||0],accumulated:[$n,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[or,Xs(or),(a,e)=>{let o=0;for(const u of e)o+=u.evaluate(a);return o}],"*":[or,Xs(or),(a,e)=>{let o=1;for(const u of e)o*=u.evaluate(a);return o}],"-":{type:or,overloads:[[[or,or],(a,[e,o])=>e.evaluate(a)-o.evaluate(a)],[[or],(a,[e])=>-e.evaluate(a)]]},"/":[or,[or,or],(a,[e,o])=>e.evaluate(a)/o.evaluate(a)],"%":[or,[or,or],(a,[e,o])=>e.evaluate(a)%o.evaluate(a)],ln2:[or,[],()=>Math.LN2],pi:[or,[],()=>Math.PI],e:[or,[],()=>Math.E],"^":[or,[or,or],(a,[e,o])=>Math.pow(e.evaluate(a),o.evaluate(a))],sqrt:[or,[or],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[or,[or],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[or,[or],(a,[e])=>Math.log(e.evaluate(a))],log2:[or,[or],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[or,[or],(a,[e])=>Math.sin(e.evaluate(a))],cos:[or,[or],(a,[e])=>Math.cos(e.evaluate(a))],tan:[or,[or],(a,[e])=>Math.tan(e.evaluate(a))],asin:[or,[or],(a,[e])=>Math.asin(e.evaluate(a))],acos:[or,[or],(a,[e])=>Math.acos(e.evaluate(a))],atan:[or,[or],(a,[e])=>Math.atan(e.evaluate(a))],min:[or,Xs(or),(a,e)=>Math.min(...e.map(o=>o.evaluate(a)))],max:[or,Xs(or),(a,e)=>Math.max(...e.map(o=>o.evaluate(a)))],abs:[or,[or],(a,[e])=>Math.abs(e.evaluate(a))],round:[or,[or],(a,[e])=>{const o=e.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[or,[or],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[or,[or],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[Bn,[Un,$n],(a,[e,o])=>a.properties()[e.value]===o.value],"filter-id-==":[Bn,[$n],(a,[e])=>a.id()===e.value],"filter-type-==":[Bn,[Un],(a,[e])=>a.geometryType()===e.value],"filter-<":[Bn,[Un,$n],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Bn,[$n],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o<u}],"filter->":[Bn,[Un,$n],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u>d}],"filter-id->":[Bn,[$n],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o>u}],"filter-<=":[Bn,[Un,$n],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Bn,[$n],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o<=u}],"filter->=":[Bn,[Un,$n],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Bn,[$n],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o>=u}],"filter-has":[Bn,[$n],(a,[e])=>e.value in a.properties()],"filter-has-id":[Bn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Bn,[Co(Un)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[Bn,[Co($n)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[Bn,[Un,Co($n)],(a,[e,o])=>o.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[Bn,[Un,Co($n)],(a,[e,o])=>function(u,d,g,y){for(;g<=y;){const T=g+y>>1;if(d[T]===u)return!0;d[T]>u?y=T-1:g=T+1}return!1}(a.properties()[e.value],o.value,0,o.value.length-1)],all:{type:Bn,overloads:[[[Bn,Bn],(a,[e,o])=>e.evaluate(a)&&o.evaluate(a)],[Xs(Bn),(a,e)=>{for(const o of e)if(!o.evaluate(a))return!1;return!0}]]},any:{type:Bn,overloads:[[[Bn,Bn],(a,[e,o])=>e.evaluate(a)||o.evaluate(a)],[Xs(Bn),(a,e)=>{for(const o of e)if(o.evaluate(a))return!0;return!1}]]},"!":[Bn,[Bn],(a,[e])=>!e.evaluate(a)],"is-supported-script":[Bn,[Un],(a,[e])=>{const o=a.globals&&a.globals.isSupportedScript;return!o||o(e.evaluate(a))}],upcase:[Un,[Un],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[Un,[Un],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[Un,Xs($n),(a,e)=>e.map(o=>ia(o.evaluate(a))).join("")],"resolved-locale":[Un,[Nf],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[or,[or,or,$n],(a,e)=>{const[o,u,d]=e.map(y=>y.evaluate(a));if(o>u||o===u)return o;let g;if(typeof d=="string")g=function(y){let T=0;if(y.length===0)return T;for(let C=0;C<y.length;C++)T=(T<<5)-T+y.charCodeAt(C),T|=0;return T}(d);else{if(typeof d!="number")throw new as(`Invalid seed input: ${d}`);g=d}return o+Ll(g)()*(u-o)}]});class Uu{constructor(e,o,u,d){this.expression=e,this._warningHistory={},this._evaluator=new kd(u,d),this._defaultValue=o?function(g){return g.type==="color"&&(Xc(g.default)||Array.isArray(g.default))?new In(0,0,0,0):g.type==="color"?In.parse(g.default)||null:g.default===void 0?null:g.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=Dh(e)}evaluateWithoutErrorHandling(e,o,u,d,g,y,T,C){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,u,d,g,y,T,C){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new as(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function hc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Pa}function zl(a,e,o,u){const d=new Lh(Pa,[],e?function(y){const T={color:na,string:Un,number:or,enum:Un,boolean:Bn,formatted:Eh,resolvedImage:Id};return y.type==="array"?Co(T[y.value]||$n,y.length):T[y.type]}(e):void 0,void 0,void 0,o,u),g=d.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?ls(new Uu(g,e,o,u)):so(d.errors)}class Kc{constructor(e,o,u,d){this.kind=e,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!Nh(o.expression),this.configDependencies=Dh(o.expression)}evaluateWithoutErrorHandling(e,o,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,d,g,y)}evaluate(e,o,u,d,g,y){return this._styleExpression.evaluate(e,o,u,d,g,y)}}class Yc{constructor(e,o,u,d,g,y){this.kind=e,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!Nh(o.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=Dh(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,o,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,d,g,y)}evaluate(e,o,u,d,g,y){return this._styleExpression.evaluate(e,o,u,d,g,y)}interpolationFactor(e,o,u){return this.interpolationType?Zs.interpolationFactor(this.interpolationType,e,o,u):0}}function $u(a,e,o,u){if((a=zl(a,e,o,u)).result==="error")return a;const d=a.value.expression,g=cc(d);if(!g&&!Uh(e))return so([new ra("","data expressions not supported")]);const y=Wc(d,["zoom","pitch","distance-from-center"]);if(!y&&!Gd(e))return so([new ra("","zoom expressions not supported")]);const T=Wc(d,["measure-light"]);if(!T&&!Hd(e))return so([new ra("","measure-light expression not supported")]);const C=Wc(d,["line-progress"]);if(!C&&!function(O){return $d(O.expression,"line-progress")}(e))return so([new ra("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,N=Qc(d);return N||y||I?N instanceof ra?so([N]):N instanceof Zs&&!$h(e)?so([new ra("",'"interpolate" expressions cannot be used with this property')]):ls(N?new Yc(g&&C?"camera":"composite",a.value,N.labels,N instanceof Zs?N.interpolation:void 0,T,C):new Kc(g&&C?"constant":"source",a.value,T,C)):so([new ra("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Jc{constructor(e,o){this._parameters=e,this._specification=o,Al(this,Vu(this._parameters,this._specification))}static deserialize(e){return new Jc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qc(a){let e=null;if(a instanceof zu)e=Qc(a.result);else if(a instanceof io){for(const o of a.args)if(e=Qc(o),e)break}else(a instanceof Pl||a instanceof Zs)&&a.input instanceof Ms&&a.input.name==="zoom"&&(e=a);return e instanceof ra||a.eachChild(o=>{const u=Qc(o);u instanceof ra?e=u:e&&u&&e!==u&&(e=new ra("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Gh,Wd,eu=function(){if(Wd)return Gh;Wd=1,Gh=e;var a=3;function e(o,u,d){var g=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var y=new Int32Array(this.arrayBuffer);o=y[0],this.d=(u=y[1])+2*(d=y[2]);for(var T=0;T<this.d*this.d;T++){var C=y[a+T],I=y[a+T+1];g.push(C===I?null:y.subarray(C,I))}var N=y[a+g.length+1];this.keys=y.subarray(y[a+g.length],N),this.bboxes=y.subarray(N),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var O=0;O<this.d*this.d;O++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=d,this.scale=u/o,this.uid=0;var L=d/u*o;this.min=-L,this.max=o+L}return e.prototype.insert=function(o,u,d,g,y){this._forEachCell(u,d,g,y,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(o,u,d,g,y,T){this.cells[y].push(T)},e.prototype.query=function(o,u,d,g,y){var T=this.min,C=this.max;if(o<=T&&u<=T&&C<=d&&C<=g&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(o,u,d,g,this._queryCell,I,{},y),I},e.prototype._queryCell=function(o,u,d,g,y,T,C,I){var N=this.cells[y];if(N!==null)for(var O=this.keys,L=this.bboxes,V=0;V<N.length;V++){var H=N[V];if(C[H]===void 0){var X=4*H;(I?I(L[X+0],L[X+1],L[X+2],L[X+3]):o<=L[X+2]&&u<=L[X+3]&&d>=L[X+0]&&g>=L[X+1])?(C[H]=!0,T.push(O[H])):C[H]=!1}}},e.prototype._forEachCell=function(o,u,d,g,y,T,C,I){for(var N=this._convertToCellCoord(o),O=this._convertToCellCoord(u),L=this._convertToCellCoord(d),V=this._convertToCellCoord(g),H=N;H<=L;H++)for(var X=O;X<=V;X++){var te=this.d*X+H;if((!I||I(this._convertFromCellCoord(H),this._convertFromCellCoord(X),this._convertFromCellCoord(H+1),this._convertFromCellCoord(X+1)))&&y.call(this,o,u,d,g,te,T,C,I))return}},e.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},e.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=a+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var y=new Int32Array(u+d+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=u,C=0;C<o.length;C++){var I=o[C];y[a+C]=T,y.set(I,T),T+=I.length}return y[a+o.length]=T,y.set(this.keys,T),y[a+o.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Gh}(),zs=ci(eu);const Go={};function Zt(a,e,o={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Go[e]={klass:a,omit:o.omit||[]}}Zt(Object,"Object"),zs.serialize=function(a,e){const o=a.toArrayBuffer();return e&&e.add(o),{buffer:o}},zs.deserialize=function(a){return new zs(a.buffer)},Object.defineProperty(zs,"name",{value:"Grid"}),Zt(zs,"Grid"),typeof DOMMatrix<"u"&&Zt(DOMMatrix,"DOMMatrix"),Zt(In,"Color"),Zt(Error,"Error"),Zt(Ao,"Formatted"),Zt(Of,"FormattedSection"),Zt(An,"AJAXError"),Zt(Uo,"ResolvedImage"),Zt(Jc,"StylePropertyFunction"),Zt(Uu,"StyleExpression",{omit:["_evaluator"]}),Zt(_o,"ImageId"),Zt(ic,"ImageVariant"),Zt(Yc,"ZoomDependentExpression"),Zt(Kc,"ZoomConstantExpression"),Zt(Ms,"CompoundExpression",{omit:["_evaluate"]});for(const a in Pa)Go[Pa[a]._classRegistryKey]||Zt(Pa[a],`Expression${a}`);function wm(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function jl(a){return self.ImageBitmap&&a instanceof ImageBitmap}function qo(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(wm(a)||jl(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const o=[];for(const u of a)o.push(qo(u,e));return o}if(a instanceof Map){const o={$name:"Map",entries:[]};for(const[u,d]of a.entries())o.entries.push(qo(u),qo(d,e));return o}if(a instanceof Set){const o={$name:"Set"};let u=0;for(const d of a.values())o[++u]=qo(d);return o}if(a instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of u)o[d]=a[d];return o}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const o=a.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const d=o.serialize?o.serialize(a,e):{};if(!o.serialize){for(const g in a)a.hasOwnProperty(g)&&(Go[u].omit.indexOf(g)>=0||(d[g]=qo(a[g],e)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function Fl(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||wm(a)||jl(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Fl);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const d=a.entries||[],g=new Map;for(let y=0;y<d.length;y+=2)g.set(Fl(d[y]),Fl(d[y+1]));return g}if(e==="Set"){const d=new Set;for(const g of Object.keys(a))g!=="$name"&&d.add(Fl(a[g]));return d}if(e==="DOMMatrix"){let d;return d=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(d)}if(e==="BigInt")return BigInt(a.value);const{klass:o}=Go[e];if(!o)throw new Error(`Can't deserialize unregistered class "${e}".`);if(o.deserialize)return o.deserialize(a);const u=Object.create(o.prototype);for(const d of Object.keys(a))d!=="$name"&&(u[d]=Fl(a[d]));return u}throw new Error("can't deserialize object of type "+typeof a)}const xr={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Ra(a){for(const e of a)if(ep(e.charCodeAt(0)))return!0;return!1}function tu(a){for(const e of a)if(!Qf(e.charCodeAt(0)))return!1;return!0}function Qf(a){return!(xr.Arabic(a)||xr["Arabic Supplement"](a)||xr["Arabic Extended-A"](a)||xr["Arabic Presentation Forms-A"](a)||xr["Arabic Presentation Forms-B"](a))}function ep(a){return!(a!==746&&a!==747&&(a<4352||!(xr["Bopomofo Extended"](a)||xr.Bopomofo(a)||xr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||xr["CJK Compatibility Ideographs"](a)||xr["CJK Compatibility"](a)||xr["CJK Radicals Supplement"](a)||xr["CJK Strokes"](a)||!(!xr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||xr["CJK Unified Ideographs Extension A"](a)||xr["CJK Unified Ideographs"](a)||xr["Enclosed CJK Letters and Months"](a)||xr["Hangul Compatibility Jamo"](a)||xr["Hangul Jamo Extended-A"](a)||xr["Hangul Jamo Extended-B"](a)||xr["Hangul Jamo"](a)||xr["Hangul Syllables"](a)||xr.Hiragana(a)||xr["Ideographic Description Characters"](a)||xr.Kanbun(a)||xr["Kangxi Radicals"](a)||xr["Katakana Phonetic Extensions"](a)||xr.Katakana(a)&&a!==12540||!(!xr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!xr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||xr["Unified Canadian Aboriginal Syllabics"](a)||xr["Unified Canadian Aboriginal Syllabics Extended"](a)||xr["Vertical Forms"](a)||xr["Yijing Hexagram Symbols"](a)||xr["Yi Syllables"](a)||xr["Yi Radicals"](a))))}function Zd(a){return!(ep(a)||function(e){return!!(xr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||xr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||xr["Letterlike Symbols"](e)||xr["Number Forms"](e)||xr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||xr["Control Pictures"](e)&&e!==9251||xr["Optical Character Recognition"](e)||xr["Enclosed Alphanumerics"](e)||xr["Geometric Shapes"](e)||xr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||xr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||xr["CJK Symbols and Punctuation"](e)||xr.Katakana(e)||xr["Private Use Area"](e)||xr["CJK Compatibility Forms"](e)||xr["Small Form Variants"](e)||xr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(a))}function Rg(a){return xr.Arabic(a)||xr["Arabic Supplement"](a)||xr["Arabic Extended-A"](a)||xr["Arabic Presentation Forms-A"](a)||xr["Arabic Presentation Forms-B"](a)}function qh(a){return a>=1424&&a<=2303||xr["Arabic Presentation Forms-A"](a)||xr["Arabic Presentation Forms-B"](a)}function Bl(a,e){return!(!e&&qh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||xr.Khmer(a))}function Xd(a){for(const e of a)if(qh(e.charCodeAt(0)))return!0;return!1}const oo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let dc=null,ao=oo.unavailable,ua=null;const ru=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ao=oo.error),dc&&dc(a)};function Wh(){ns.fire(new jc("pluginStateChange",{pluginStatus:ao,pluginURL:ua}))}const ns=new Fc,fc=function(){return ao},tp=function(){if(ao!==oo.deferred||!ua)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ao=oo.loading,Wh(),ua&&Td({url:ua},a=>{a?ru(a):(ao=oo.loaded,Wh())})},pl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ao===oo.loaded||pl.applyArabicShaping!=null,isLoading:()=>ao===oo.loading,setState(a){ao=a.pluginStatus,ua=a.pluginURL},isParsing:()=>ao===oo.parsing,isParsed:()=>ao===oo.parsed,getPluginURL:()=>ua};class Hn{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(o,u){for(const d of o)if(!Bl(d.charCodeAt(0),u))return!1;return!0}(e,pl.isLoaded())}}class Hu{constructor(e,o,u,d){this.property=e,this.value=o,this.expression=function(g,y,T,C){if(Xc(g))return new Jc(g,y);if(hc(g)||Array.isArray(g)&&g.length>0){const I=$u(g,y,T,C);if(I.result==="error")throw new Error(I.value.map(N=>`${N.key}: ${N.message}`).join(", "));return I.value}{let I=g;return typeof g=="string"&&y.type==="color"&&(I=In.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(o===void 0?e.specification.default:o,e.specification,u,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,u){return this.property.possiblyEvaluate(this,e,o,u)}}class ha{constructor(e,o,u){this.property=e,this.value=new Hu(e,void 0,o,u)}transitioned(e,o){return new js(this.property,this.value,o,Xe({},e.transition,this.transition),e.now)}untransitioned(){return new js(this.property,this.value,null,{},0)}}class ds{constructor(e,o,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(e){return mr(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property,this._scope,this._options)),this._values[e].value=new Hu(this._values[e].property,o===null?void 0:mr(o),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,o){o&&(this._options=o);const u=this._properties.properties;if(e)for(const d in e){const g=e[d];if(d.endsWith("-transition")){const y=d.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(e){return mr(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property)),this._values[e].transition=mr(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u);const d=this.getTransition(o);d!==void 0&&(e[`${o}-transition`]=d)}return e}transitioned(e,o){const u=new Ks(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(e,o._values[d]);return u}untransitioned(){const e=new Ks(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class js{constructor(e,o,u,d,g){const y=d.delay||0,T=d.duration||0;g=g||0,this.property=e,this.value=o,this.begin=g+y,this.end=this.begin+T,e.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(e,o,u){const d=e.now||0,g=this.value.possiblyEvaluate(e,o,u),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(e,o,u);{const T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,o,u),g,ue(T))}}return g}}class Ks{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,u){const d=new ml(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,o,u);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class rp{constructor(e,o,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(e){return mr(this._values[e].value)}setValue(e,o){this._values[e]=new Hu(this._values[e].property,o===null?void 0:mr(o),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u)}return e}possiblyEvaluate(e,o,u){const d=new ml(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,o,u);return d}}class Vl{constructor(e,o,u){this.property=e,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,u,d){return this.property.evaluate(this.value,this.parameters,e,o,u,d)}}class ml{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,u){const d=rc[this.specification.type];return d?d(e,o,u):e}}class zt{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,u,d){return new Vl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},u,d)}:e.expression,o)}interpolate(e,o,u){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new Vl(this,{kind:"constant",value:void 0},e.parameters);const d=rc[this.specification.type];return d?new Vl(this,{kind:"constant",value:d(e.value.value,o.value.value,u)},e.parameters):e}evaluate(e,o,u,d,g,y){return e.kind==="constant"?e.value:e.evaluate(o,u,d,g,y)}}class pc{constructor(e){this.specification=e}possiblyEvaluate(e,o,u,d){return!!e.expression.evaluate(o,null,{},u,d)}interpolate(){return!1}}class Di{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Hn(0,{});for(const u in e){const d=e[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Hu(d,void 0),y=this.defaultTransitionablePropertyValues[u]=new ha(d);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(o)}}}Zt(zt,"DataDrivenProperty"),Zt(Tt,"DataConstantProperty"),Zt(pc,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Fs(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Wo(a){if(Array.isArray(a))return a.map(Wo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const o in a)e[o]=Wo(a[o]);return e}return Fs(a)}function nu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!nu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Kd(a,e="",o=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nu(a)||(a=Yd(a));const d=a;let g=!0;try{g=function(N){if(!Gu(N))return N;let O=Wo(N);return Sm(O),O=np(O),O}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let y=null,T=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){T=$e[`filter_${u}`];const N=zl(g,T,e,o);if(N.result==="error")throw new Error(N.value.map(O=>`${O.key}: ${O.message}`).join(", "));y=(O,L,V)=>N.value.evaluate(O,L,{},V)}let C=null,I=null;if(g!==d){const N=zl(d,T,e,o);if(N.result==="error")throw new Error(N.value.map(O=>`${O.key}: ${O.message}`).join(", "));C=(O,L,V,H,X)=>N.value.evaluate(O,L,{},V,void 0,void 0,H,X),I=!cc(N.value.expression)}return{filter:y,dynamicFilter:C||void 0,needGeometry:Tm(g),needFeature:!!I}}function np(a){if(!Array.isArray(a))return a;const e=function(o){if(Ng.has(o[0])){for(let u=1;u<o.length;u++)if(Gu(o[u]))return!0}return o}(a);return e===!0?e:e.map(o=>np(o))}function Sm(a){let e=!1;const o=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)e=e||Gu(a[u]),o.push(a[u+1]);o.push(a[a.length-1])}else if(a[0]==="match"){e=e||Gu(a[1]);for(let u=2;u<a.length-1;u+=2)o.push(a[u+1]);o.push(a[a.length-1])}else if(a[0]==="step"){e=e||Gu(a[1]);for(let u=1;u<a.length-1;u+=2)o.push(a[u+1])}e&&(a.length=0,a.push("any",...o));for(let u=1;u<a.length;u++)Sm(a[u])}function Gu(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let o=1;o<a.length;o++)if(Gu(a[o]))return!0;return!1}const Ng=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Dg(a,e){return a<e?-1:a>e?1:0}function Tm(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(Tm(a[e]))return!0;return!1}function Yd(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?ip(a[1],a[2],"=="):e==="!="?Jd(ip(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ip(a[1],a[2],e):e==="any"?(o=a.slice(1),["any"].concat(o.map(Yd))):e==="all"?["all"].concat(a.slice(1).map(Yd)):e==="none"?["all"].concat(a.slice(1).map(Yd).map(Jd)):e==="in"?sp(a[1],a.slice(2)):e==="!in"?Jd(sp(a[1],a.slice(2))):e==="has"?Zh(a[1]):e!=="!has"||Jd(Zh(a[1]));var o}function ip(a,e,o){switch(a){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,a,e]}}function sp(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",a,["literal",e.sort(Dg)]]:["filter-in-small",a,["literal",e]]}}function Zh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Jd(a){return["!",a]}const iu="";function Ul(a,e){return e?`${a}${iu}${e}`:a}const op="-transition",$l=new Set(["fill","line","background","hillshade","raster"]);class lo extends Fc{constructor(e,o,u,d,g){if(super(),this.id=e.id,this.fqid=Ul(this.id,u),this.type=e.type,this.scope=u,this.lut=d,this.options=g,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const y=zl(this.filter,$e[`filter_${e.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),o.layout&&(this._unevaluatedLayout=new rp(o.layout,this.scope,g),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new ds(o.paint,this.scope,g);for(const y in e.paint)this.setPaintProperty(y,e.paint[y]);for(const y in e.layout)this.setLayoutProperty(y,e.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ml(o.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&$l.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o){if(this.type==="custom"&&e==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(op)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o){const u=this._transitionablePaint,d=u._properties.properties;if(e.endsWith(op)){const O=e.slice(0,-11);return d[O]&&u.setTransition(O,o||void 0),!1}if(!d[e])return!1;const g=u._values[e],y=g.value.isDataDriven(),T=g.value;u.setValue(e,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const C=u._values[e].value,I=C.isDataDriven(),N=e.endsWith("pattern")||e==="line-dasharray";return I||y||N||this._handleOverridablePaintPropertyUpdate(e,T,C)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,o,u){return null}_handleOverridablePaintPropertyUpdate(e,o,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){return Wt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,o)=>!(e===void 0||o==="layout"&&!Object.keys(e).length||o==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof Vl&&Uh(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Kd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,o,u,d,g,y,T,C,I){}}const Og={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xh{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pi{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&o.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tn(a,e=1){let o=0,u=0;return{members:a.map(d=>{const g=Og[d.type].BYTES_PER_ELEMENT,y=o=ap(o,Math.max(e,g)),T=d.components||1;return u=Math.max(u,g),o+=g*T,{name:d.name,type:d.type,components:T,offset:y}}),size:ap(o,Math.max(u,e)),alignment:e}}function ap(a,e){return Math.ceil(a/e)*e}class Hl extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.int16[d+0]=o,this.int16[d+1]=u,e}}Hl.prototype.bytesPerElement=4,Zt(Hl,"StructArrayLayout2i4");class Kh extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=d,e}}Kh.prototype.bytesPerElement=6,Zt(Kh,"StructArrayLayout3i6");class Yh extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.int16[y+0]=o,this.int16[y+1]=u,this.int16[y+2]=d,this.int16[y+3]=g,e}}Yh.prototype.bytesPerElement=8,Zt(Yh,"StructArrayLayout4i8");class mc extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}mc.prototype.bytesPerElement=4,Zt(mc,"StructArrayLayout1f4");class Em extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=4*e,y=2*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.float32[y+1]=d,e}}Em.prototype.bytesPerElement=8,Zt(Em,"StructArrayLayout2i1f8");class lp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=4*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=d,e}}lp.prototype.bytesPerElement=8,Zt(lp,"StructArrayLayout3i8");class qu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=5*e;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=y,e}}qu.prototype.bytesPerElement=10,Zt(qu,"StructArrayLayout5i10");class cp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=6*e,N=12*e,O=3*e;return this.int16[I+0]=o,this.int16[I+1]=u,this.uint8[N+4]=d,this.uint8[N+5]=g,this.uint8[N+6]=y,this.uint8[N+7]=T,this.float32[O+2]=C,e}}cp.prototype.bytesPerElement=12,Zt(cp,"StructArrayLayout2i4ub1f12");class gl extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.float32[g+0]=o,this.float32[g+1]=u,this.float32[g+2]=d,e}}gl.prototype.bytesPerElement=12,Zt(gl,"StructArrayLayout3f12");class yl extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=6*e,C=3*e;return this.uint16[T+0]=o,this.uint16[T+1]=u,this.uint16[T+2]=d,this.uint16[T+3]=g,this.float32[C+2]=y,e}}yl.prototype.bytesPerElement=12,Zt(yl,"StructArrayLayout4ui1f12");class Qd extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.uint16[y+0]=o,this.uint16[y+1]=u,this.uint16[y+2]=d,this.uint16[y+3]=g,e}}Qd.prototype.bytesPerElement=8,Zt(Qd,"StructArrayLayout4ui8");class up extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=6*e;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+3]=g,this.int16[C+4]=y,this.int16[C+5]=T,e}}up.prototype.bytesPerElement=12,Zt(up,"StructArrayLayout6i12");class Jh extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L){const V=this.length;return this.resize(V+1),this.emplace(V,e,o,u,d,g,y,T,C,I,N,O,L)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V){const H=12*e;return this.int16[H+0]=o,this.int16[H+1]=u,this.int16[H+2]=d,this.int16[H+3]=g,this.uint16[H+4]=y,this.uint16[H+5]=T,this.uint16[H+6]=C,this.uint16[H+7]=I,this.int16[H+8]=N,this.int16[H+9]=O,this.int16[H+10]=L,this.int16[H+11]=V,e}}Jh.prototype.bytesPerElement=24,Zt(Jh,"StructArrayLayout4i4ui4i24");class Mo extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=10*e,I=5*e;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=d,this.float32[I+2]=g,this.float32[I+3]=y,this.float32[I+4]=T,e}}Mo.prototype.bytesPerElement=20,Zt(Mo,"StructArrayLayout3i3f20");class Ps extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.float32[y+0]=o,this.float32[y+1]=u,this.float32[y+2]=d,this.float32[y+3]=g,e}}Ps.prototype.bytesPerElement=16,Zt(Ps,"StructArrayLayout4f16");class gc extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}gc.prototype.bytesPerElement=4,Zt(gc,"StructArrayLayout1ul4");class yc extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.uint16[d+0]=o,this.uint16[d+1]=u,e}}yc.prototype.bytesPerElement=4,Zt(yc,"StructArrayLayout2ui4");class hp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V){const H=this.length;return this.resize(H+1),this.emplace(H,e,o,u,d,g,y,T,C,I,N,O,L,V)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H){const X=20*e,te=10*e;return this.int16[X+0]=o,this.int16[X+1]=u,this.int16[X+2]=d,this.int16[X+3]=g,this.int16[X+4]=y,this.float32[te+3]=T,this.float32[te+4]=C,this.float32[te+5]=I,this.float32[te+6]=N,this.int16[X+14]=O,this.uint32[te+8]=L,this.uint16[X+18]=V,this.uint16[X+19]=H,e}}hp.prototype.bytesPerElement=40,Zt(hp,"StructArrayLayout5i4f1i1ul2ui40");class ef extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=8*e;return this.int16[I+0]=o,this.int16[I+1]=u,this.int16[I+2]=d,this.int16[I+4]=g,this.int16[I+5]=y,this.int16[I+6]=T,this.int16[I+7]=C,e}}ef.prototype.bytesPerElement=16,Zt(ef,"StructArrayLayout3i2i2i16");class tf extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=4*e,C=8*e;return this.float32[T+0]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.int16[C+6]=g,this.int16[C+7]=y,e}}tf.prototype.bytesPerElement=16,Zt(tf,"StructArrayLayout2f1f2i16");class Gl extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=20*e,I=5*e;return this.uint8[C+0]=o,this.uint8[C+1]=u,this.float32[I+1]=d,this.float32[I+2]=g,this.float32[I+3]=y,this.float32[I+4]=T,e}}Gl.prototype.bytesPerElement=20,Zt(Gl,"StructArrayLayout2ub4f20");class Rs extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.uint16[g+0]=o,this.uint16[g+1]=u,this.uint16[g+2]=d,e}}Rs.prototype.bytesPerElement=6,Zt(Rs,"StructArrayLayout3ui6");class Wu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he){const me=this.length;return this.resize(me+1),this.emplace(me,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he,me){const _e=30*e,De=15*e,ke=60*e;return this.int16[_e+0]=o,this.int16[_e+1]=u,this.int16[_e+2]=d,this.float32[De+2]=g,this.float32[De+3]=y,this.uint16[_e+8]=T,this.uint16[_e+9]=C,this.uint32[De+5]=I,this.uint32[De+6]=N,this.uint32[De+7]=O,this.uint16[_e+16]=L,this.uint16[_e+17]=V,this.uint16[_e+18]=H,this.float32[De+10]=X,this.float32[De+11]=te,this.uint8[ke+48]=ae,this.uint8[ke+49]=de,this.uint8[ke+50]=pe,this.uint32[De+13]=Q,this.int16[_e+28]=he,this.uint8[ke+58]=me,e}}Wu.prototype.bytesPerElement=60,Zt(Wu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cm extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he,me,_e,De,ke,Oe,Ve,tt,vt,ft,xt,St,nt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he,me,_e,De,ke,Oe,Ve,tt,vt,ft,xt,St,nt)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe,Q,he,me,_e,De,ke,Oe,Ve,tt,vt,ft,xt,St,nt,_t){const et=20*e,rt=40*e,Mt=80*e;return this.float32[et+0]=o,this.float32[et+1]=u,this.int16[rt+4]=d,this.int16[rt+5]=g,this.int16[rt+6]=y,this.int16[rt+7]=T,this.int16[rt+8]=C,this.int16[rt+9]=I,this.int16[rt+10]=N,this.int16[rt+11]=O,this.int16[rt+12]=L,this.uint16[rt+13]=V,this.uint16[rt+14]=H,this.uint16[rt+15]=X,this.uint16[rt+16]=te,this.uint16[rt+17]=ae,this.uint16[rt+18]=de,this.uint16[rt+19]=pe,this.uint16[rt+20]=Q,this.uint16[rt+21]=he,this.uint16[rt+22]=me,this.uint16[rt+23]=_e,this.uint16[rt+24]=De,this.uint16[rt+25]=ke,this.uint16[rt+26]=Oe,this.uint16[rt+27]=Ve,this.uint32[et+14]=tt,this.float32[et+15]=vt,this.float32[et+16]=ft,this.float32[et+17]=xt,this.float32[et+18]=St,this.uint8[Mt+76]=nt,this.uint16[rt+39]=_t,e}}Cm.prototype.bytesPerElement=80,Zt(Cm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class dp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=6*e;return this.float32[C+0]=o,this.float32[C+1]=u,this.float32[C+2]=d,this.float32[C+3]=g,this.float32[C+4]=y,this.float32[C+5]=T,e}}dp.prototype.bytesPerElement=24,Zt(dp,"StructArrayLayout6f24");class _c extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=5*e;return this.float32[T+0]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=y,e}}_c.prototype.bytesPerElement=20,Zt(_c,"StructArrayLayout5f20");class Qh extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=7*e;return this.float32[I+0]=o,this.float32[I+1]=u,this.float32[I+2]=d,this.float32[I+3]=g,this.float32[I+4]=y,this.float32[I+5]=T,this.float32[I+6]=C,e}}Qh.prototype.bytesPerElement=28,Zt(Qh,"StructArrayLayout7f28");class fp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O){const L=this.length;return this.resize(L+1),this.emplace(L,e,o,u,d,g,y,T,C,I,N,O)}emplace(e,o,u,d,g,y,T,C,I,N,O,L){const V=11*e;return this.float32[V+0]=o,this.float32[V+1]=u,this.float32[V+2]=d,this.float32[V+3]=g,this.float32[V+4]=y,this.float32[V+5]=T,this.float32[V+6]=C,this.float32[V+7]=I,this.float32[V+8]=N,this.float32[V+9]=O,this.float32[V+10]=L,e}}fp.prototype.bytesPerElement=44,Zt(fp,"StructArrayLayout11f44");class rf extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I){const N=this.length;return this.resize(N+1),this.emplace(N,e,o,u,d,g,y,T,C,I)}emplace(e,o,u,d,g,y,T,C,I,N){const O=9*e;return this.float32[O+0]=o,this.float32[O+1]=u,this.float32[O+2]=d,this.float32[O+3]=g,this.float32[O+4]=y,this.float32[O+5]=T,this.float32[O+6]=C,this.float32[O+7]=I,this.float32[O+8]=N,e}}rf.prototype.bytesPerElement=36,Zt(rf,"StructArrayLayout9f36");class Zu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.float32[d+0]=o,this.float32[d+1]=u,e}}Zu.prototype.bytesPerElement=8,Zt(Zu,"StructArrayLayout2f8");class ko extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=6*e;return this.uint32[3*e+0]=o,this.uint16[y+2]=u,this.uint16[y+3]=d,this.uint16[y+4]=g,e}}ko.prototype.bytesPerElement=12,Zt(ko,"StructArrayLayout1ul3ui12");class Ys extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}Ys.prototype.bytesPerElement=2,Zt(Ys,"StructArrayLayout1ui2");class Xu extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae){const de=16*e;return this.float32[de+0]=o,this.float32[de+1]=u,this.float32[de+2]=d,this.float32[de+3]=g,this.float32[de+4]=y,this.float32[de+5]=T,this.float32[de+6]=C,this.float32[de+7]=I,this.float32[de+8]=N,this.float32[de+9]=O,this.float32[de+10]=L,this.float32[de+11]=V,this.float32[de+12]=H,this.float32[de+13]=X,this.float32[de+14]=te,this.float32[de+15]=ae,e}}Xu.prototype.bytesPerElement=64,Zt(Xu,"StructArrayLayout16f64");class ed extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=10*e,N=5*e;return this.uint16[I+0]=o,this.uint16[I+1]=u,this.uint16[I+2]=d,this.uint16[I+3]=g,this.float32[N+2]=y,this.float32[N+3]=T,this.float32[N+4]=C,e}}ed.prototype.bytesPerElement=20,Zt(ed,"StructArrayLayout4ui3f20");class pp extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.int16[1*e+0]=o,e}}pp.prototype.bytesPerElement=2,Zt(pp,"StructArrayLayout1i2");class nf extends pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint8[1*e+0]=o,e}}nf.prototype.bytesPerElement=1,Zt(nf,"StructArrayLayout1ub1");class Am extends Xh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Am.prototype.size=40;class td extends hp{get(e){return new Am(this,e)}}Zt(td,"CollisionBoxArray");class Im extends Xh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Im.prototype.size=60;class mp extends Wu{get(e){return new Im(this,e)}}Zt(mp,"PlacedSymbolArray");class Mm extends Xh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Mm.prototype.size=80;class km extends Cm{get(e){return new Mm(this,e)}}Zt(km,"SymbolInstanceArray");class sf extends mc{getoffsetX(e){return this.float32[1*e+0]}}Zt(sf,"GlyphOffsetArray");class gp extends Hl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(gp,"SymbolLineVertexArray");class Pm extends Xh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Pm.prototype.size=12;class yp extends ko{get(e){return new Pm(this,e)}}Zt(yp,"FeatureIndexArray");class of extends yc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(of,"FillExtrusionCentroidArray");class Lg extends Xh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Lg.prototype.size=6;class Rm extends Kh{get(e){return new Lg(this,e)}}Zt(Rm,"FillExtrusionWallArray");const Nm=Tn([{name:"a_pos",components:2,type:"Int16"}],4),zg=Tn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ku=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class si{constructor(e=[]){this.segments=e}_prepareSegment(e,o,u,d){let g=this.segments[this.segments.length-1];return e>si.MAX_VERTEX_ARRAY_LENGTH&&Hr(`Max vertices per segment is ${si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>si.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(e,o,u,d){return this._prepareSegment(e,o.length,u.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,u,d){return new si([{vertexOffset:e,primitiveOffset:o,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function jg(a,e){return 256*(a=Ee(Math.floor(a),0,255))+Ee(Math.floor(e),0,255)}si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(si,"SegmentVector");const af=Tn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lf=Tn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Dm=Tn([{name:"a_dash",components:4,type:"Uint16"}]);class rd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,o,u,d){this.ids.push(Yu(e)),this.positions.push(o,u,d)}eachPosition(e,o){const u=Yu(e);let d=0,g=this.ids.length-1;for(;d<g;){const y=d+g>>1;this.ids[y]>=u?g=y:d=y+1}for(;this.ids[d]===u;)o(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,o){const u=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Js(u,d,0,u.length-1),o&&(o.add(u.buffer),o.add(d.buffer)),{ids:u,positions:d}}static deserialize(e){const o=new rd;let u;o.ids=e.ids,o.positions=e.positions;for(const d of o.ids)d!==u&&o.uniqueIds.push(d),u=d;return o.indexed=!0,o}}function Yu(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Su(String(a))}function Js(a,e,o,u){for(;o<u;){const d=a[o+u>>1];let g=o-1,y=u+1;for(;;){do g++;while(a[g]<d);do y--;while(a[y]>d);if(g>=y)break;cf(a,g,y),cf(e,3*g,3*y),cf(e,3*g+1,3*y+1),cf(e,3*g+2,3*y+2)}y-o<u-y?(Js(a,e,o,y),o=y+1):(Js(a,e,y+1,u),u=y)}}function cf(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}Zt(rd,"FeaturePositionMap");class xc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,o),this.initialized=!0),!!this.location}set(e,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ju extends xc{constructor(e){super(e),this.current=0}set(e,o,u){this.fetchUniformLocation(e,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Xn extends xc{constructor(e){super(e),this.current=0}set(e,o,u){this.fetchUniformLocation(e,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ql extends xc{constructor(e){super(e),this.current=[0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class qr extends xc{constructor(e){super(e),this.current=[0,0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class vc extends xc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class _p extends xc{constructor(e){super(e),this.current=In.transparent.toPremultipliedRenderColor(null)}set(e,o,u){this.fetchUniformLocation(e,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Fg=new Float32Array(16);class nd extends xc{constructor(e){super(e),this.current=Fg}set(e,o,u){if(this.fetchUniformLocation(e,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Qu=new Float32Array(9),Na=new Float32Array(4);class eh extends xc{constructor(e){super(e),this.current=Na}set(e,o,u){if(this.fetchUniformLocation(e,o)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function xp(a){return[jg(255*a.r,255*a.g),jg(255*a.b,255*a.a)]}class id{constructor(e,o,u,d){this.value=e,this.uniformNames=o.map(g=>`u_${g}`),this.type=u,this.context=d}setUniform(e,o,u,d,g){const y=d.constantOr(this.value);o.set(e,g,y instanceof In?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(e,o){return this.type==="color"?new _p(e):new Xn(e)}}class th{constructor(e,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,o){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(e,o,u,d,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&o.set(e,g,y)}getBinding(e,o){return o==="u_pattern"||o==="u_pattern_b"||o==="u_dash"?new vc(e):new Xn(e)}}class _l{constructor(e,o,u,d){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,o,u,d,g,y,T,C){const I=this.paintVertexArray.length,N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Hn(0,{brightness:y,worldview:C}),o,{},g,d,T):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hn(0,{brightness:y,worldview:C}),o,{},g,d,T):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(I,e,N,O?null:this.context.lut)}updatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T,worldview:C},u,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,N=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hn(0,{brightness:T,worldview:C}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,o,I,N?null:this.context.lut)}_setPaintValue(e,o,u,d){if(this.type==="color"){const g=xp(u.toPremultipliedRenderColor(d));for(let y=e;y<o;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=e;g<o;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(e,o,u,d,g,y){this.expression=e,this.uniformNames=o.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=o.map(T=>({name:`a_${T}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.evaluate(new Hn(this.context.zoom,{brightness:y,worldview:C}),o,{},g,d,T),N=this.expression.evaluate(new Hn(this.context.zoom+1,{brightness:y,worldview:C}),o,{},g,d,T),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hn(0,{brightness:y,worldview:C}),o,{},g,d,T):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,I,N,O?null:this.context.lut)}updatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:T,worldview:C},u,d,void 0,g),N=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T,worldview:C},u,d,void 0,g),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hn(0,{brightness:T,worldview:C}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,o,I,N,O?null:this.context.lut)}_setPaintValue(e,o,u,d,g){if(this.type==="color"){const y=xp(u.toPremultipliedRenderColor(g)),T=xp(u.toPremultipliedRenderColor(g));for(let C=e;C<o;C++)this.paintVertexArray.emplace(C,y[0],y[1],T[0],T[1])}else{for(let y=e;y<o;y++)this.paintVertexArray.emplace(y,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o,u,d,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,T=Ee(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);o.set(e,g,T)}getBinding(e,o){return new Xn(e)}}class Yi{constructor(e,o,u,d,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(u==="array"?Dm:af).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Qd}populatePaintArray(e,o,u,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(g,e,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(e,o,u,d,g,y,T){this._setPaintValues(e,o,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(e,o,u,d){if(!d||!u)return;const g=d[u[0]],y=d[u[1]];if(g){if(g){const{tl:T,br:C,pixelRatio:I}=g;for(let N=e;N<o;N++)this.paintVertexArray.emplace(N,T[0],T[1],C[0],C[1],I)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:C}=y;for(let I=e;I<o;I++)this.paintTransitionVertexArray.emplace(I,T[0],T[1],C[0],C[1])}}}upload(e){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,lf.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Po{constructor(e,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const d=[];for(const g in e.paint._values){const y=e.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof Vl&&Uh(y.property.specification)))continue;const T=c(g,e.type),C=y.value,I=y.property.specification.type,N=!!y.property.useIntegerZoom,O=g==="line-dasharray"||g.endsWith("pattern"),L=e.paint.get(`${g}-use-theme`),V=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(C.kind!=="constant"||V)if(C.kind==="source"||V||O){const H=S(g,I,"source");this.binders[g]=O?new Yi(C,T,I,H,e.id):new _l(C,T,I,H),d.push(`/a_${g}`)}else{const H=S(g,I,"composite");this.binders[g]=new Da(C,T,I,N,o,H),d.push(`/z_${g}`)}else this.binders[g]=O?new th(C.value,T):new id(C.value,T,I,o),d.push(`/u_${g}`);L&&(this.binders[g].lutExpression=L.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof _l||o instanceof Da?o.maxValue:0}populatePaintArrays(e,o,u,d,g,y,T,C){for(const I in this.binders){const N=this.binders[I];N.context=this.context,(N instanceof _l||N instanceof Da||N instanceof Yi)&&N.populatePaintArray(e,o,u,d,g,y,T,C)}}setConstantPatternPositions(e,o){for(const u in this.binders){const d=this.binders[u];d instanceof th&&d.setConstantPatternPositions(e,o)}}getPatternTransitionVertexBuffer(e){const o=this.binders[e];return o instanceof Yi?o.paintTransitionVertexBuffer:null}updatePaintArrays(e,o,u,d,g,y,T,C,I,N){let O=!1;const L=Object.keys(e),V=L.length!==0&&!C,H=V?L:o.uniqueIds;this.context.lut=g.lut;for(const X in this.binders){const te=this.binders[X];if(te.context=this.context,(te instanceof _l||te instanceof Da||te instanceof Yi)&&te.expression&&te.expression.kind&&te.expression.kind!=="constant"&&(te.expression.isStateDependent===!0||te.expression.isLightConstant===!1)){const ae=g.paint.get(X);te.expression=ae.value;for(const de of H){const pe=e[de.toString()];o.eachPosition(de,(Q,he,me)=>{const _e=d.feature(Q);te.updatePaintArray(he,me,_e,pe,y,T,I,N)})}if(!V)for(const de of u.uniqueIds){const pe=e[de.toString()];u.eachPosition(de,(Q,he,me)=>{const _e=d.feature(Q);te.updatePaintArray(he,me,_e,pe,y,T,I,N)})}O=!0}}return O}defines(){const e=[];for(const o in this.binders){const u=this.binders[o];(u instanceof id||u instanceof th)&&e.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof _l||u instanceof Da||u instanceof Yi)for(let d=0;d<u.paintVertexAttributes.length;d++)e.push(u.paintVertexAttributes[d].name);if(u instanceof Yi)for(let d=0;d<lf.members.length;d++)e.push(lf.members[d].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof id||u instanceof th||u instanceof Da)for(const d of u.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof id||d instanceof th||d instanceof Da)for(const g of d.uniformNames)o.push({name:g,property:u,binding:d.getBinding(e,g)})}return o}setUniforms(e,o,u,d,g){for(const{name:y,property:T,binding:C}of u)this.binders[T].setUniform(e,C,g,d.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const o=this.binders[e];(o instanceof _l||o instanceof Da||o instanceof Yi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof Yi&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(e){for(const o in this.binders){const u=this.binders[o];(u instanceof _l||u instanceof Da||u instanceof Yi)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof _l||o instanceof Da||o instanceof Yi)&&o.destroy()}}}class f{constructor(e,o,u=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Po(d,o,u);this.needsUpload=!1,this._featureMap=new rd,this._featureMapWithoutIds=new rd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,o,u,d,g,y,T,C,I){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(e,o,d,g,y,T,C,I);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,u,d,g,y,T,C){for(const I of u)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,o,I,d,g,y,T||0,C)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const n={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function c(a,e){return n[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const p={"line-pattern":{source:yl,composite:yl},"fill-pattern":{source:yl,composite:yl},"fill-extrusion-pattern":{source:yl,composite:yl},"line-dasharray":{source:Qd,composite:Qd}},x={color:{source:Zu,composite:Ps},number:{source:mc,composite:Zu}};function S(a,e,o){const u=p[a];return u&&u[o]||x[e][o]}Zt(id,"ConstantBinder"),Zt(th,"PatternConstantBinder"),Zt(_l,"SourceExpressionBinder"),Zt(Yi,"PatternCompositeBinder"),Zt(Da,"CompositeExpressionBinder"),Zt(Po,"ProgramConfiguration",{omit:["_buffers"]}),Zt(f,"ProgramConfigurationSet");const E=jt/Math.PI/2,M=5,R=6,z=16383,j=64,G=[j,32,16],U=-E,q=E;function re(a,e,o,u=E){return o=Sn(o),[a*Math.sin(o)*u,-e*u,a*Math.cos(o)*u]}function Y(a,e,o){return re(Math.cos(Sn(a)),Math.sin(Sn(a)),e,o)}const ne=63710088e-1,oe=2*Math.PI*ne;class ce{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ce(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,u=this.lat*o,d=e.lat*o,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((e.lng-this.lng)*o);return ne*Math.acos(Math.min(g,1))}toBounds(e=0){const o=360*e/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new ge({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(e){return Y(this.lat,this.lng,E+e*E/ne)}static convert(e){if(e instanceof ce)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ce(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ce(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ge{constructor(e,o){if(e)if(o)this.setSouthWest(e).setNorthEast(o);else if(e.length===4){const u=e;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=e;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(e){return this._ne=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}setSouthWest(e){return this._sw=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}extend(e){const o=this._sw,u=this._ne;let d,g;if(e instanceof ce)d=e,g=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(ce.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ce.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new ce(d.lng,d.lat),this._ne=new ce(g.lng,g.lat)),this}getCenter(){return new ce((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ce(this.getWest(),this.getNorth())}getSouthEast(){return new ce(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=ce.convert(e);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){if(e)return e instanceof ge?e:new ge(e)}}const xe=0,Ce=25.5;function Ae(a){return oe*Math.cos(a*Math.PI/180)}function Te(a){return(180+a)/360}function be(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Ie(a,e){return a/Ae(e)}function Re(a){return 360*a-180}function Be(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ge(a,e){return a*Ae(Be(e))}const st=85.051129;function it(a){return Math.cos(Sn(Ee(a,-85.051129,st)))}function mt(a,e){const o=Ee(e,xe,Ce),u=Math.pow(2,o);return it(a)*oe/(512*u)}function Ue(a){return 1/Math.cos(a*Math.PI/180)}function Je(a,e=0){const o=Math.exp(Math.PI*(1-(a.y+e/jt)/(1<<a.z)*2));return 80150034*o/(o*o+1)/jt/(1<<a.z)}class Le{constructor(e,o,u=0){this.x=+e,this.y=+o,this.z=+u}static fromLngLat(e,o=0){const u=ce.convert(e);return new Le(Te(u.lng),be(u.lat),Ie(o,u.lat))}toLngLat(){return new ce(Re(this.x),Be(this.y))}toAltitude(){return Ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oe*Ue(Be(this.y))}}function lt(a,e,o,u,d,g,y,T,C){const I=(e+u)/2,N=(o+d)/2,O=new Ot(I,N);T(O),function(L,V,H,X,te,ae){const de=H-te,pe=X-ae;return Math.abs((X-V)*de-(H-L)*pe)/Math.hypot(de,pe)}(O.x,O.y,g.x,g.y,y.x,y.y)>=C?(lt(a,e,o,I,N,g,O,T,C),lt(a,I,N,u,d,O,y,T,C)):a.push(y)}function Ye(a,e,o){let u=a[0],d=u.x,g=u.y;e(u);const y=[u];for(let T=1;T<a.length;T++){const C=a[T],{x:I,y:N}=C;e(C),lt(y,d,g,I,N,u,C,e,o),d=I,g=N,u=C}return y}function pt(a,e,o,u){if(u(e,o)){const d=e.add(o)._mult(.5);pt(a,e,d,u),pt(a,d,o,u)}else a.push(o)}function It(a,e){let o=a[0];const u=[o];for(let d=1;d<a.length;d++){const g=a[d];pt(u,o,g,e),o=g}return u}const ct=Math.pow(2,14)-1,wt=-ct-1;function Vt(a,e){const o=Math.round(a.x*e),u=Math.round(a.y*e);return a.x=Ee(o,wt,ct),a.y=Ee(u,wt,ct),(o<a.x||o>a.x+1||u<a.y||u>a.y+1)&&Hr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function qt(a,e,o){const u=a.loadGeometry(),d=a.extent,g=jt/d;if(e&&o&&o.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:T,x:C,y:I,projection:N}=o,O=L=>{const V=Re((e.x+L.x/d)/y),H=Be((e.y+L.y/d)/y),X=N.project(V,H);L.x=(X.x*T-C)*d,L.y=(X.y*T-I)*d};for(let L=0;L<u.length;L++)if(a.type!==1)u[L]=Ye(u[L],O,1);else{const V=[];for(const H of u[L])H.x<0||H.x>=d||H.y<0||H.y>=d||(O(H),V.push(H));u[L]=V}}for(const y of u)for(const T of y)Vt(T,g);return u}function Bt(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?qt(a):[]}}var Xt,cr,gr,Or,Qr,wn,oi,Vn={};function Pn(){if(cr)return Xt;cr=1;var a=Ga();function e(d,g,y,T,C){this.properties={},this.extent=y,this.type=0,this._pbf=d,this._geometry=-1,this._keys=T,this._values=C,d.readFields(o,this,g)}function o(d,g,y){d==1?g.id=y.readVarint():d==2?function(T,C){for(var I=T.readVarint()+T.pos;T.pos<I;){var N=C._keys[T.readVarint()],O=C._values[T.readVarint()];C.properties[N]=O}}(y,g):d==3?g.type=y.readVarint():d==4&&(g._geometry=y.pos)}function u(d){for(var g,y,T=0,C=0,I=d.length,N=I-1;C<I;N=C++)T+=((y=d[N]).x-(g=d[C]).x)*(g.y+y.y);return T}return Xt=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var g,y=d.readVarint()+d.pos,T=1,C=0,I=0,N=0,O=[];d.pos<y;){if(C<=0){var L=d.readVarint();T=7&L,C=L>>3}if(C--,T===1||T===2)I+=d.readSVarint(),N+=d.readSVarint(),T===1&&(g&&O.push(g),g=[]),g.push(new a(I,N));else{if(T!==7)throw new Error("unknown command "+T);g&&g.push(g[0].clone())}}return g&&O.push(g),O},e.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var g=d.readVarint()+d.pos,y=1,T=0,C=0,I=0,N=1/0,O=-1/0,L=1/0,V=-1/0;d.pos<g;){if(T<=0){var H=d.readVarint();y=7&H,T=H>>3}if(T--,y===1||y===2)(C+=d.readSVarint())<N&&(N=C),C>O&&(O=C),(I+=d.readSVarint())<L&&(L=I),I>V&&(V=I);else if(y!==7)throw new Error("unknown command "+y)}return[N,L,O,V]},e.prototype.toGeoJSON=function(d,g,y){var T,C,I=this.extent*Math.pow(2,y),N=this.extent*d,O=this.extent*g,L=this.loadGeometry(),V=e.types[this.type];function H(ae){for(var de=0;de<ae.length;de++){var pe=ae[de];ae[de]=[360*(pe.x+N)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+O)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(T=0;T<L.length;T++)X[T]=L[T][0];H(L=X);break;case 2:for(T=0;T<L.length;T++)H(L[T]);break;case 3:for(L=function(ae){var de=ae.length;if(de<=1)return[ae];for(var pe,Q,he=[],me=0;me<de;me++){var _e=u(ae[me]);_e!==0&&(Q===void 0&&(Q=_e<0),Q===_e<0?(pe&&he.push(pe),pe=[ae[me]]):pe.push(ae[me]))}return pe&&he.push(pe),he}(L),T=0;T<L.length;T++)for(C=0;C<L[T].length;C++)H(L[T][C])}L.length===1?L=L[0]:V="Multi"+V;var te={type:"Feature",geometry:{type:V,coordinates:L},properties:this.properties};return"id"in this&&(te.id=this.id),te},Xt}function $i(){if(Or)return gr;Or=1;var a=Pn();function e(u,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,d),this.length=this._features.length}function o(u,d,g){u===15?d.version=g.readVarint():u===1?d.name=g.readString():u===5?d.extent=g.readVarint():u===2?d._features.push(g.pos):u===3?d._keys.push(g.readString()):u===4&&d._values.push(function(y){for(var T=null,C=y.readVarint()+y.pos;y.pos<C;){var I=y.readVarint()>>3;T=I===1?y.readString():I===2?y.readFloat():I===3?y.readDouble():I===4?y.readVarint64():I===5?y.readVarint():I===6?y.readSVarint():I===7?y.readBoolean():null}return T}(g))}return gr=e,e.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var d=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,d,this.extent,this._keys,this._values)},gr}function Vr(){return oi||(oi=1,Vn.VectorTile=function(){if(wn)return Qr;wn=1;var a=$i();function e(o,u,d){if(o===3){var g=new a(d,d.readVarint()+d.pos);g.length&&(u[g.name]=g)}}return Qr=function(o,u){this.layers=o.readFields(e,{},u)},Qr}(),Vn.VectorTileFeature=Pn(),Vn.VectorTileLayer=$i()),Vn}var en=Vr();const un="3d_elevation_id",ai="level";class Ji{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,o){return this._valid&&e(o(this._geometry)),this}require(e,o,u){return this.get(e,!0,o,u)}optional(e,o,u){return this.get(e,!1,o,u)}success(){return this._valid}get(e,o,u,d){const g=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(d?d(g):g):o&&(this._valid=!1),this}}class ui{constructor(e,o){this.featureFunc=e,this.vertexFunc=o}parseFeature(e,o,u){return this.featureFunc(e,o,u)}parseVertex(e,o,u){return this.vertexFunc(e,o,u)}}const Ln=new ui((a,e,o)=>a.reset(e).require(un,u=>{o.id=u}).optional("fixed_height_relative",u=>{o.constantHeight=u},bn.decodeRelativeHeight).geometry(u=>{o.bounds=u},dm).success(),(a,e,o)=>a.reset(e).require(un,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height_relative",u=>{o.height=u},bn.decodeRelativeHeight).geometry(u=>{o.position=u},bn.getPoint).success()),Fi=new ui((a,e,o)=>a.reset(e).require(un,u=>{o.id=u}).optional("fixed_height",u=>{o.constantHeight=u},bn.decodeMetricHeight).geometry(u=>{o.bounds=u},dm).success(),(a,e,o)=>a.reset(e).require(un,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height",u=>{o.height=u},bn.decodeMetricHeight).geometry(u=>{o.position=u},bn.getPoint).success());class bn{static getPoint(e){return go(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const o=[],u=[],d=e.length,g=new Ji;for(let T=0;T<d;T++){const C=e.feature(T),I=C.properties.hasOwnProperty("version")?String(C.properties.version):void 0,N=(y=I)?y==="1.0.1"?Fi:void 0:Ln;if(N===void 0){Hr(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const O=C.properties.hasOwnProperty("type")?C.properties.type:void 0;if(O){if(en.VectorTileFeature.types[C.type]==="Point"&&O==="curve_point"){const L={};N.parseVertex(g,C,L)&&o.push(L)}else if(en.VectorTileFeature.types[C.type]==="Polygon"&&O==="curve_meta"){const L={};N.parseFeature(g,C,L)&&u.push(L)}}}var y;return{vertices:o,features:u}}}class Bi{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,u){const d=Dr(o,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class mi{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,u){const d=ar(o,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1]+(e[2]-this.pos[2])*o[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,o,u){if(function(V,H){var X=V[0],te=V[1],ae=V[2],de=H[0],pe=H[1],Q=H[2];return Math.abs(X-de)<=A*Math.max(1,Math.abs(X),Math.abs(de))&&Math.abs(te-pe)<=A*Math.max(1,Math.abs(te),Math.abs(pe))&&Math.abs(ae-Q)<=A*Math.max(1,Math.abs(ae),Math.abs(Q))}(this.pos,e)||o===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,y]=this.dir,T=this.pos[0]-e[0],C=this.pos[1]-e[1],I=this.pos[2]-e[2],N=d*d+g*g+y*y,O=2*(T*d+C*g+I*y),L=O*O-4*N*(T*T+C*C+I*I-o*o);if(L<0){const V=Math.max(-O/2,0),H=T+d*V,X=C+g*V,te=I+y*V,ae=Math.hypot(H,X,te);return u[0]=H*o/ae,u[1]=X*o/ae,u[2]=te*o/ae,!1}{const V=(-O-Math.sqrt(L))/(2*N);if(V<0){const H=Math.hypot(T,C,I);return u[0]=T*o/H,u[1]=C*o/H,u[2]=I*o/H,!1}return u[0]=T+d*V,u[1]=C+g*V,u[2]=I+y*V,!0}}}class Gn{constructor(e,o,u,d,g){this.TL=e,this.TR=o,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(e,o,u){const d=[-1,1,1],g=[1,1,1],y=[1,-1,1],T=[-1,-1,1],C=Cr(d,d,e),I=Cr(g,g,e),N=Cr(y,y,e),O=Cr(T,T,e);return new Gn(C,I,N,O,o/u)}}function hi(a,e,o){let u=1/0,d=-1/0;const g=[];for(const y of a){On(g,y,e);const T=ar(g,o);u=Math.min(u,T),d=Math.max(d,T)}return[u,d]}function Xr(a,e){let o=!0;for(let u=0;u<a.planes.length;u++){const d=a.planes[u];let g=0;for(let y=0;y<e.length;y++)g+=ar(d,e[y])+d[3]>=0;if(g===0)return 0;g!==e.length&&(o=!1)}return o?2:1}function Gi(a,e){for(const o of a.projections){const u=hi(e,a.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Bs(a,e){let o=0;const u=[0,0,0,0];for(let y=0;y<a.length;y++)u[0]=a[y][0],u[1]=a[y][1],u[2]=a[y][2],u[3]=1,(d=u)[0]*(g=e)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&o++;var d,g;return o}class wi{constructor(e,o){this.points=e||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Dn.fromPoints(this.points),this.projections=[],this.frustumEdges=[On([],this.points[2],this.points[3]),On([],this.points[0],this.points[3]),On([],this.points[4],this.points[0]),On([],this.points[5],this.points[1]),On([],this.points[6],this.points[2]),On([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:d,projection:hi(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:hi(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(e,o,u,d){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const N=zi([],I,e),O=1/N[3]/o*g;return(L=N)[0]=(V=N)[0]*(H=[O,O,d?1/N[3]:O,O])[0],L[1]=V[1]*H[1],L[2]=V[2]*H[2],L[3]=V[3]*H[3],L;var L,V,H}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const N=Rr([],lr([],On([],y[I[0]],y[I[1]]),On([],y[I[2]],y[I[1]]))),O=-ar(N,y[I[1]]);return N.concat(O)}),C=[];for(let I=0;I<y.length;I++)C.push([y[I][0],y[I][1],y[I][2]]);return new wi(C,T)}intersectsPrecise(e,o,u){for(let d=0;d<o.length;d++)if(!Bs(e,o[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Bs(e,this.planes[d]))return 0;for(const d of u)for(const g of this.frustumEdges){const y=lr([],d,g),T=Br(y);if(T===0)continue;Ht(y,y,1/T);const C=hi(this.points,this.points[0],y),I=hi(e,this.points[0],y);if(C[0]>I[1]||I[0]>C[1])return 0}return 1}containsPoint(e){for(const o of this.planes){const u=o[3];if(ar([o[0],o[1],o[2]],e)+u<0)return!1}return!0}}class Dn{static fromPoints(e){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of e)gt(o,o,d),Jt(u,u,d);return new Dn(o,u)}static fromTileIdAndHeight(e,o,u){const d=1<<e.canonical.z,g=e.canonical.x,y=e.canonical.y;return new Dn([g/d,y/d,o],[(g+1)/d,(y+1)/d,u])}static applyTransform(e,o){const u=e.getCorners();for(let d=0;d<u.length;++d)Cr(u[d],u[d],o);return Dn.fromPoints(u)}static applyTransformFast(e,o){const u=[o[12],o[13],o[14]],d=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const T=o[4*y+g],C=T*e.min[y],I=T*e.max[y];u[g]+=Math.min(C,I),d[g]+=Math.max(C,I)}return new Dn(u,d)}static projectAabbCorners(e,o){const u=e.getCorners();for(let d=0;d<u.length;++d)Cr(u[d],u[d],o);return u}constructor(e,o){this.min=e,this.max=o,this.center=Ht([],br([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],u=Sr(this.min),d=Sr(this.max);for(let g=0;g<o.length;g++)u[g]=o[g]?this.min[g]:this.center[g],d[g]=o[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new Dn(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Xr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Xr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,o){return o||this.intersects(e)?Gi(e,this.getCorners()):0}intersectsPreciseFlat(e,o){return o||this.intersectsFlat(e)?Gi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let o=0;o<3;++o)if(this.min[o]>e.max[o]||e.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e.min[o]),this.max[o]=Math.max(this.max[o],e.max[o])}encapsulatePoint(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e[o]),this.max[o]=Math.max(this.max[o],e[o])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Zt(Dn,"Aabb");class Zo{constructor(e,o){this.feature=e,this.metersToTile=o,this.index=0}get(){const e=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,u=o[1],d=-o[0],g=(e.extent+1)*this.metersToTile;return[new Ot(Math.trunc(e.position[0]+u*g),Math.trunc(e.position[1]+d*g)),new Ot(Math.trunc(e.position[0]-u*g),Math.trunc(e.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ro{constructor(e,o,u,d,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((C=this.vertices[T.a].position)[0]===(I=this.vertices[T.b].position)[0]&&C[1]===I[1]);var C,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:go(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const C=this.vertices[T.a].position,I=this.vertices[T.b].position,N=Ea(ss(),I,C),O=As(N),L=Ca(ss(),N,1/O);this.edgeProps.push({vec:N,dir:L,len:O});const V=this.vertexProps[T.a].dir,H=this.vertexProps[T.b].dir;Ta(V,V,L),Ta(H,H,L)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||$a(T.dir,T.dir);this.tessellate(y)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(e);if(o==null)return 0;const[u,d]=o;return Ir(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(e,o){const u=this.getClosestEdge(e);if(!u)return Ft(0,0,1);const d=u[0],g=this.edges[d],y=this.edgeProps[d].vec,T=Ft(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*o),C=Ft(T[1],-T[0],0);lr(C,C,T);const I=Br(C);return I>0?Ht(C,C,1/I):Ft(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,d=0;const g=go(e.x,e.y);for(let y=0;y<this.edges.length;y++){const T=this.edges[y],C=this.edgeProps[y].dir,I=new Bi(g,this.edgeProps[y].dir),N=this.vertices[T.a].position,O=this.vertices[T.b].position,L=ss(),V=ss(),H=I.intersectsPlane(N,this.vertexProps[T.a].dir,L),X=I.intersectsPlane(O,this.vertexProps[T.b].dir,V);if(!H||!X)continue;const te=Ea(ss(),V,L),ae=Ea(ss(),g,L),de=Dr(te,te),pe=de>0?Dr(ae,te)/de:0,Q=Ee(pe,0,1),he=Math.abs((pe-Q)*this.edgeProps[y].len),me=Ea(ss(),g,N),_e=he+Math.abs(Dr(me,go(C[1],-C[0])));_e<u&&(o=y,u=_e,d=Q)}return[o,d]}tessellate(e){for(let o=this.edges.length-1;o>=0;--o){const u=this.edges[o].a,d=this.edges[o].b,{position:g,height:y,extent:T}=this.vertices[u],{position:C,height:I,extent:N}=this.vertices[d],O=this.vertexProps[u].dir,L=this.vertexProps[d].dir,V=Ft(g[0]/e,g[1]/e,y),H=Ft(C[0]/e,C[1]/e,I),X=Ft(O[1],-O[0],0);Ht(X,X,T);const te=Ft(L[1],-L[0],0);if(Ht(te,te,N),this.distSqLines(Ft(V[0]+.5*X[0],V[1]+.5*X[1],V[2]+.5*X[2]),Ft(H[0]-.5*te[0],H[1]-.5*te[1],H[2]-.5*te[2]),Ft(V[0]-.5*X[0],V[1]-.5*X[1],V[2]-.5*X[2]),Ft(H[0]+.5*te[0],H[1]+.5*te[1],H[2]+.5*te[2]))<=.0025000000000000005)continue;const ae=this.vertices.length,de=Ta(ss(),g,C);this.vertices.push({position:Ca(de,de,.5),height:.5*(y+I),extent:.5*(T+N)});const pe=Ta(ss(),O,L);this.vertexProps.push({dir:$a(pe,pe)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:u,b:ae}),this.edges.push({a:ae,b:d});const Q=Ea(ss(),this.vertices[ae].position,g),he=As(Q),me={vec:Q,dir:Ca(ss(),Q,1/he),len:he};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(e,o,u,d){const g=Yt(_r(),o,e),y=Yt(_r(),d,u),T=Yt(_r(),e,u),C=ar(g,g),I=ar(g,y),N=ar(g,T),O=ar(y,y),L=ar(y,T),V=C*O-I*I;if(V===0){const te=ar(T,y)/ar(y,y);return Ct($r(_r(),u,d,te),e)}const H=(I*L-N*O)/V,X=(C*L-I*N)/V;return Ct($r(_r(),e,o,H),$r(_r(),u,d,X))}}class Oa{static parseFrom(e,o){const u=bn.parse(e);if(!u)return[];let{vertices:d,features:g}=u;const y=1/Je(o);g.sort((N,O)=>N.id-O.id),d.sort((N,O)=>N.id-O.id||N.idx-O.idx),d=d.filter((N,O,L)=>O===L.findIndex(V=>V.id===N.id&&V.idx===N.idx));const T=new Array;let C=0;const I=d.length;for(const N of g){if(N.constantHeight){T.push(new Ro(N.id,N.bounds,N.constantHeight));continue}for(;C!==I&&d[C].id<N.id;)C++;if(C===I||d[C].id!==N.id)continue;const O=new Array,L=new Array,V=C;for(;C!==I&&d[C].id===N.id;){const H=d[C];if(O.push({position:H.position,height:H.height,extent:H.extent}),C!==V&&d[C-1].idx===H.idx-1){const X=C-V;L.push({a:X-1,b:X})}C++}T.push(new Ro(N.id,N.bounds,void 0,O,L,y))}return T}static getElevationFeature(e,o){if(!o)return;const u=+e.properties[un];return Number.isNaN(u)?void 0:o.find(d=>d.id===u)}}class ws{constructor(e,o){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(o)||(this.zScale=Math.pow(2,o.z-e.z),this.xOffset=(e.x*this.zScale-o.x)*jt,this.yOffset=(e.y*this.zScale-o.y)*jt)}constantElevation(e,o){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,o)}pointElevation(e,o,u){const d=this.constantElevation(o,u);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(e),u))}computeBiasedHeight(e,o){return o<=0?e:e+o*ze(0,o,e>=0?e:Math.abs(.5*e))}}Zt(Ro,"ElevationFeature");class da{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Hl,this.indexArray=new Rs,this.segments=new si,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new mc),this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){const g=this.layers[0],y=[];let T=null;g.type==="circle"&&(T=g.layout.get("circle-sort-key"));for(const{feature:I,id:N,index:O,sourceLayerIndex:L}of e){const V=this.layers[0]._featureFilter.needGeometry,H=Bt(I,V);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),H,u))continue;const X=T?T.evaluate(H,{},u):void 0,te={id:N,properties:I.properties,type:I.type,sourceLayerIndex:L,index:O,geometry:V?H.geometry:qt(I,u,d),patterns:{},sortKey:X};y.push(te)}T&&y.sort((I,N)=>I.sortKey-N.sortKey);let C=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new up,C=d.projection);for(const I of y){const{geometry:N,index:O,sourceLayerIndex:L}=I,V=e[O].feature;this.addFeature(I,N,O,o.availableImages,u,C,o.brightness,o.elevationFeatures),o.featureIndex.insert(V,N,O,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,o,u,d,g,y,T){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ku.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,zg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,o,u,d,g,y,T,C){let I;this.elevationMode!=="none"&&(I=Oa.getElevationFeature(e,C));for(const N of o)for(const O of N){const L=O.x,V=O.y;if(L<0||L>=jt||V<0||V>=jt)continue;if(y){const te=y.projectTilePoint(L,V,g),ae=y.upVector(g,L,V);this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),X=H.vertexLength;if(this.addCircleVertex(L,V,-1,-1),this.addCircleVertex(L,V,1,-1),this.addCircleVertex(L,V,1,1),this.addCircleVertex(L,V,-1,1),this.elevationMode!=="none"){const te=I?I.pointElevation(new Ot(L,V)):0;this.hasElevation=this.hasElevation||te!==0;for(let ae=0;ae<4;ae++)this.elevatedLayoutVertexArray.emplaceBack(te)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},d,g,T,void 0,this.worldview)}addCircleVertex(e,o,u,d){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*o+(d+1)/2)}addGlobeExtVertex(e,o){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}}function Xo(a,e){for(let o=0;o<a.length;o++)if(xl(e,a[o]))return!0;for(let o=0;o<e.length;o++)if(xl(a,e[o]))return!0;return!!su(a,e)}function Ko(a,e,o){return!!xl(a,e)||!!rh(e,a,o)}function fa(a,e){if(a.length===1)return hf(e,a[0]);for(let o=0;o<e.length;o++){const u=e[o];for(let d=0;d<u.length;d++)if(xl(a,u[d]))return!0}for(let o=0;o<a.length;o++)if(hf(e,a[o]))return!0;for(let o=0;o<e.length;o++)if(su(a,e[o]))return!0;return!1}function pa(a,e,o){if(a.length>1){if(su(a,e))return!0;for(let u=0;u<e.length;u++)if(rh(e[u],a,o))return!0}for(let u=0;u<a.length;u++)if(rh(a[u],e,o))return!0;return!1}function su(a,e){if(a.length===0||e.length===0)return!1;for(let o=0;o<a.length-1;o++){const u=a[o],d=a[o+1];for(let g=0;g<e.length-1;g++)if(uf(u,d,e[g],e[g+1]))return!0}return!1}function uf(a,e,o,u){return ni(a,o,u)!==ni(e,o,u)&&ni(a,e,o)!==ni(a,e,u)}function ou(a,e,o){return(a.x-o.x)*(e.y-o.y)-(a.y-o.y)*(e.x-o.x)}function Om(a,e,o,u){const d=ou(a,e,u),g=ou(a,e,o);if(Math.sign(d)===Math.sign(g))return;const y=ou(o,u,a),T=y+g-d;return Math.sign(y)!==Math.sign(T)?[y/(y-T),g/(g-d)]:void 0}function rh(a,e,o){const u=o*o;if(e.length===1)return a.distSqr(e[0])<u;for(let d=1;d<e.length;d++)if(vp(a,e[d-1],e[d])<u)return!0;return!1}function vp(a,e,o){const u=e.distSqr(o);if(u===0)return a.distSqr(e);const d=((a.x-e.x)*(o.x-e.x)+(a.y-e.y)*(o.y-e.y))/u;return a.distSqr(d<0?e:d>1?o:o.sub(e)._mult(d)._add(e))}function hf(a,e){let o,u,d,g=!1;for(let y=0;y<a.length;y++){o=a[y];for(let T=0,C=o.length-1;T<o.length;C=T++)u=o[T],d=o[C],u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function xl(a,e){let o=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){const g=a[u],y=a[d];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(o=!o)}return o}function bc(a,e,o,u,d){for(const y of a)if(e<=y.x&&o<=y.y&&u>=y.x&&d>=y.y)return!0;const g=[new Ot(e,o),new Ot(e,d),new Ot(u,d),new Ot(u,o)];if(a.length>2){for(const y of g)if(xl(a,y))return!0}for(let y=0;y<a.length-1;y++)if(Wl(a[y],a[y+1],g))return!0;return!1}function Wl(a,e,o){const u=o[0],d=o[2];if(a.x<u.x&&e.x<u.x||a.x>d.x&&e.x>d.x||a.y<u.y&&e.y<u.y||a.y>d.y&&e.y>d.y)return!1;const g=ni(a,e,o[0]);return g!==ni(a,e,o[1])||g!==ni(a,e,o[2])||g!==ni(a,e,o[3])}function wc(a,e,o,u,d,g){let y=e.y-a.y,T=a.x-e.x;if(g=g||0){const C=y*y+T*T;if(C===0)return!0;const I=Math.sqrt(C);y/=I,T/=I}return!((o.x-a.x)*y+(o.y-a.y)*T-g<0||(u.x-a.x)*y+(u.y-a.y)*T-g<0||(d.x-a.x)*y+(d.y-a.y)*T-g<0)}function Lm(a,e,o,u,d,g,y){return!(wc(a,e,u,d,g,y)||wc(e,o,u,d,g,y)||wc(o,a,u,d,g,y)||wc(u,d,a,e,o,y)||wc(d,g,a,e,o,y)||wc(g,u,a,e,o,y))}function bp(a,e,o){const u=e.paint.get(a).value;return u.kind==="constant"?u.value:o.programConfigurations.get(e.id).getMaxValue(a)}function zm(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Bg(a,e,o,u,d){if(!e[0]&&!e[1])return a;const g=Ot.convert(e)._mult(d);o==="viewport"&&g._rotate(-u);const y=[];for(let T=0;T<a.length;T++)y.push(a[T].sub(g));return y}function jm(a,e,o,u){const d=Ot.convert(a)._mult(u);return e==="viewport"&&d._rotate(-o),d}let Vg,Fm;function Zy(a,e,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[a*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}Zt(da,"CircleBucket",{omit:["layers"]});class df{constructor(e,o,u){this.z=e,this.x=o,this.y=u,this.key=au(0,e,e,o,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const u=function(g,y,T){var C=Zy(256*g,256*(y=Math.pow(2,T)-y-1),T),I=Zy(256*(g+1),256*(y+1),T);return C[0]+","+C[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),d=function(g,y,T){let C,I="";for(let N=g;N>0;N--)C=1<<N-1,I+=(y&C?1:0)+(T&C?2:0);return I}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Bm{constructor(e,o){this.wrap=e,this.canonical=o,this.key=au(e,o.z,o.z,o.x,o.y)}}class No{constructor(e,o,u,d,g){this.overscaledZ=e,this.wrap=o,this.canonical=new df(u,+d,+g),this.key=o===0&&e===u?this.canonical.key:au(o,e,u,d,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new No(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return au(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return au(this.wrap*+o,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new No(o,this.wrap,o,u,d),new No(o,this.wrap,o,u+1,d),new No(o,this.wrap,o,u,d+1),new No(o,this.wrap,o,u+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new No(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Bm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function au(a,e,o,u,d){const g=1<<Math.min(o,22);let y=g*(d%g)+u%g;return a&&o<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-o)))),16*(32*y+o)+(e-o)}const $1=[a=>{let e=a.canonical.x-1,o=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,o--),new No(a.overscaledZ,o,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,o=a.wrap;return e===1<<a.canonical.z&&(e=0,o++),new No(a.overscaledZ,o,a.canonical.z,e,a.canonical.y)},a=>new No(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new No(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Zt(df,"CanonicalTileID"),Zt(No,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ug=Tn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_}=Ug,w=Tn([{name:"a_pos_3",components:3,type:"Int16"}]);var k=Tn([{name:"a_pos",type:"Int16",components:2}]);function B(a){return a*E/ne}const Z=[new Dn([U,U,U],[q,q,q]),new Dn([U,U,U],[0,0,q]),new Dn([0,U,U],[q,0,q]),new Dn([U,0,U],[0,q,q]),new Dn([0,0,U],[q,q,q])];function se(a,e,o,u=!0){const d=Ht([],a._camera.position,a.worldSize),g=[e,o,1,1];zi(g,g,a.pixelMatrixInverse),mo(g,g,1/g[3]);const y=Rr([],On([],g,d)),T=a.globeMatrix,C=[T[12],T[13],T[14]],I=On([],C,d),N=Br(I),O=Rr([],I),L=a.worldSize/(2*Math.PI),V=ar(O,y),H=Math.asin(L/N);if(H<Math.acos(V)){if(!u)return null;const Oe=[],Ve=[];Ht(Oe,y,N/V),Rr(Ve,On(Ve,Oe,I)),Rr(y,br(y,I,Ht(y,Ve,Math.tan(H)*N)))}const X=[];new mi(d,y).closestPointOnSphere(C,L,X);const te=Rr([],Ui(T,0)),ae=Rr([],Ui(T,1)),de=Rr([],Ui(T,2)),pe=ar(te,X),Q=ar(ae,X),he=ar(de,X),me=Ke(Math.asin(-Q/L));let _e=Ke(Math.atan2(pe,he));_e=a.center.lng+function(Oe,Ve){const tt=(Ve-Oe+180)%360-180;return tt<-180?tt+360:tt}(a.center.lng,_e);const De=Te(_e),ke=Ee(be(me),0,1);return new Le(De,ke)}class we{constructor(e,o,u){this.a=On([],e,u),this.b=On([],o,u),this.center=u;const d=Rr([],this.a),g=Rr([],this.b);this.angle=Math.acos(ar(d,g))}}function He(a,e){if(a.angle===0)return null;let o;return o=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),o<0||o>1?null:function(u,d,g,y){const T=Math.sin(g);return u*(Math.sin((1-y)*g)/T)+d*(Math.sin(y*g)/T)}(a.a[e],a.b[e],a.angle,Ee(o,0,1))+a.center[e]}function Qe(a){if(a.z<=1)return Z[a.z+2*a.y+a.x];const e=Wr(sr(a));return Dn.fromPoints(e)}function Et(a,e,o){return Ht(a,a,1-o),qe(a,a,e,o)}function ur(a,e,o){for(const u of a)Cr(u,u,e),Ht(u,u,o)}function pr(a,e,o,u){const d=e/a.worldSize,g=a.globeMatrix;if(o.z<=1){const ke=Qe(o).getCorners();return ur(ke,g,d),Dn.fromPoints(ke)}const y=sr(o,u),T=Wr(y,E+B(a._tileCoverLift));ur(T,g,d);const C=Number.MAX_VALUE,I=[-C,-C,-C],N=[C,C,C];if(y.contains(a.center)){for(const Ve of T)gt(N,N,Ve),Jt(I,I,Ve);I[2]=0;const ke=a.point,Oe=[ke.x*d,ke.y*d,0];return gt(N,N,Oe),Jt(I,I,Oe),new Dn(N,I)}if(a._tileCoverLift>0){for(const ke of T)gt(N,N,ke),Jt(I,I,ke);return new Dn(N,I)}const O=[g[12]*d,g[13]*d,g[14]*d],L=y.getCenter(),V=Ee(a.center.lat,-85.051129,st),H=Ee(L.lat,-85.051129,st),X=Te(a.center.lng),te=be(V);let ae=X-Te(L.lng);const de=te-be(H);ae>.5?ae-=1:ae<-.5&&(ae+=1);let pe=0;Math.abs(ae)>Math.abs(de)?pe=ae>=0?1:3:(pe=de>=0?0:2,qe(O,O,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(Sn(de>=0?y.getSouth():y.getNorth()))*E));const Q=T[pe],he=T[(pe+1)%4],me=new we(Q,he,O),_e=[He(me,0)||Q[0],He(me,1)||Q[1],He(me,2)||Q[2]],De=mn(a.zoom);if(De>0){const ke=function({x:Ve,y:tt,z:vt},ft,xt,St,nt){const _t=1/(1<<vt);let et=Ve*_t,rt=et+_t,Mt=tt*_t,Pt=Mt+_t,yr=0;const rr=(et+rt)/2-St;return rr>.5?yr=-1:rr<-.5&&(yr=1),et=((et+yr)*ft-(St*=ft))*xt+St,rt=((rt+yr)*ft-St)*xt+St,Mt=(Mt*ft-(nt*=ft))*xt+nt,Pt=(Pt*ft-nt)*xt+nt,[[et,Pt,0],[rt,Pt,0],[rt,Mt,0],[et,Mt,0]]}(o,e,a._pixelsPerMercatorPixel,X,te);for(let Ve=0;Ve<T.length;Ve++)Et(T[Ve],ke[Ve],De);const Oe=br([],ke[pe],ke[(pe+1)%4]);Ht(Oe,Oe,.5),Et(_e,Oe,De)}for(const ke of T)gt(N,N,ke),Jt(I,I,ke);return N[2]=Math.min(Q[2],he[2]),gt(N,N,_e),Jt(I,I,_e),new Dn(N,I)}function sr({x:a,y:e,z:o},u=!1){const d=1/(1<<o),g=new ce(Re(a*d),e===(1<<o)-1&&u?-90:Be((e+1)*d)),y=new ce(Re((a+1)*d),e===0&&u?90:Be(e*d));return new ge(g,y)}function Wr(a,e=E){const o=Sn(a.getNorth()),u=Sn(a.getSouth()),d=Math.cos(o),g=Math.cos(u),y=Math.sin(o),T=Math.sin(u),C=a.getWest(),I=a.getEast();return[re(g,T,C,e),re(g,T,I,e),re(d,y,I,e),re(d,y,C,e)]}function tn(a,e,o,u){const d=1<<o.z,g=(a/jt+o.x)/d;return Y(Be((e/jt+o.y)/d),Re(g),u)}function an({min:a,max:e}){return z/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const Vs=new Float64Array(16);function yt(a){const e=an(a),o=kt(Vs,[e,e,e]);return Pe(o,o,Zr([],a.min))}function ut(a){const e=(u=a.min,(o=Vs)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o);var o,u;const d=1/an(a);return Fe(e,e,[d,d,d])}function bt(a){const e=jt/(2*Math.PI);return a/(2*Math.PI)/e}function wr(a,e){return jt/(512*Math.pow(2,a))*an(Qe(e))}function fn(a,e,o,u,d){const g=bt(o),y=[a,e,-o/(2*Math.PI)],T=W(new Float64Array(16));return Pe(T,T,y),Fe(T,T,[g,g,g]),ht(T,T,Sn(-d)),at(T,T,Sn(-u)),T}function mn(a){return ze(M,R,a)}function En(a,e){const o=Y(e.lat,e.lng),u=function(H){const X=Y(H._center.lat,H._center.lng);let te=lr([],Ft(0,1,0),X);const ae=Rt([],-H.angle,X);te=Cr(te,te,ae),Rt(ae,-H._pitch,te);const de=Rr([],X);return Ht(de,de,B(H.cameraToCenterDistance/H.pixelsPerMeter)),Cr(de,de,ae),br([],X,de)}(a);return y=(d=Yt([],u,o))[0],T=d[1],C=d[2],I=(g=o)[0],N=g[1],O=g[2],V=(L=Math.sqrt(y*y+T*T+C*C)*Math.sqrt(I*I+N*N+O*O))&&ar(d,g)/L,Math.acos(Math.min(Math.max(V,-1),1));var d,g,y,T,C,I,N,O,L,V}function zn(a,e){return En(a,e)>Math.PI/2*1.01}const vo=Sn(85),Zi=Math.cos(vo),sd=Math.sin(vo),H1=J(),C2=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function A2(a,e,o,u,d,g,y,T,C){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(C*=a.pixelToTileUnitsFactor);const I=a.tileID.canonical,N=o.projection.upVectorScale(I,o.center.lat,o.worldSize).metersToTile;for(const O of e)for(const L of O){const V=L.add(T),H=d&&o.elevation?o.elevation.exaggeration()*d.getElevationAt(V.x,V.y,!0):0,X=o.projection.projectTilePoint(V.x,V.y,I);if(H>0){const pe=o.projection.upVector(I,V.x,V.y);X.x+=pe[0]*N*H,X.y+=pe[1]*N*H,X.z+=pe[2]*N*H}const te=g?V:WL(X.x,X.y,X.z,u),ae=g?a.tilespaceRays.map(pe=>XL(pe,H)):a.queryGeometry.screenGeometry,de=zi([],[X.x,X.y,X.z,1],u);if(!y&&g?C*=de[3]/o.cameraToCenterDistance:y&&!g&&(C*=o.cameraToCenterDistance/de[3]),g){const pe=Be((L.y/jt+I.y)/(1<<I.z));C/=o.projection.pixelsPerMeter(pe,1)/Ie(1,pe)}if(Ko(ae,te,C))return!0}return!1}function WL(a,e,o,u){const d=zi([],[a,e,o,1],u);return new Ot(d[0]/d[3],d[1]/d[3])}const I2=Ft(0,0,0),ZL=Ft(0,0,1);function XL(a,e){const o=_r();return I2[2]=e,a.intersectsPlane(I2,ZL,o),new Ot(o[0],o[1])}class M2 extends da{}let k2,P2,R2,N2;function D2(a,{width:e,height:o},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*o*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*o*u);return a.width=e,a.height=o,a.data=d,a}function O2(a,e,o){const{width:u,height:d}=e;u===a.width&&d===a.height||(G1(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,d)},o,null),a.width=u,a.height=d,a.data=e.data)}function G1(a,e,o,u,d,g,y,T){if(d.width===0||d.height===0)return e;if(d.width>a.width||d.height>a.height||o.x>a.width-d.width||o.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||u.x>e.width-d.width||u.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const C=a.data,I=e.data,N=g===4&&T;for(let O=0;O<d.height;O++){const L=((o.y+O)*a.width+o.x)*g,V=((u.y+O)*e.width+u.x)*g;if(N)for(let H=0;H<d.width;H++){const X=L+H*g+3,te=V+H*g;I[te+0]=255,I[te+1]=255,I[te+2]=255,I[te+3]=C[X]}else if(y)for(let H=0;H<d.width;H++){const X=L+H*g,te=V+H*g,ae=new In(C[X+0]/255,C[X+1]/255,C[X+2]/255,C[X+3]).toNonPremultipliedRenderColor(y).toArray();I[te+0]=ae[0],I[te+1]=ae[1],I[te+2]=ae[2],I[te+3]=ae[3]}else for(let H=0;H<d.width*g;H++)I[V+H]=C[L+H]}return e}Zt(M2,"HeatmapBucket",{omit:["layers"]});class wp{constructor(e,o){D2(this,e,1,o)}resize(e){O2(this,new wp(e),1)}clone(){return new wp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,d,g){G1(e,o,u,d,g,1,null)}}class Do{constructor(e,o){D2(this,e,4,o)}resize(e){O2(this,new Do(e),4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,d,g,y,T){G1(e,o,u,d,g,4,y,T)}}class L2{constructor(e,o){this.width=e.width,this.height=e.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function Xy(a){const e={},o=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new Do({width:o,height:u}),g=(y,T,C)=>{e[a.evaluationKey]=C;const I=a.expression.evaluate(e),N=I?I.toNonPremultipliedRenderColor(null):null;N&&(d.data[y+T+0]=Math.floor(255*N.r),d.data[y+T+1]=Math.floor(255*N.g),d.data[y+T+2]=Math.floor(255*N.b),d.data[y+T+3]=Math.floor(255*N.a))};if(a.clips)for(let y=0,T=0;y<u;++y,T+=4*o)for(let C=0,I=0;C<o;C++,I+=4){const N=C/(o-1),{start:O,end:L}=a.clips[y];g(T,I,O*(1-N)+L*N)}else for(let y=0,T=0;y<o;y++,T+=4)g(0,T,y/(o-1));return d}Zt(wp,"AlphaImage"),Zt(Do,"RGBAImage");const KL=Tn([{name:"a_pos",components:2,type:"Int16"}],4),YL=Tn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),JL=Tn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),QL=Tn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ky(a,e,o=2){const u=e&&e.length,d=u?e[0]*o:a.length;let g=z2(a,0,d,o,!0);const y=[];if(!g||g.next===g.prev)return y;let T,C,I;if(u&&(g=function(N,O,L,V){const H=[];for(let X=0,te=O.length;X<te;X++){const ae=z2(N,O[X]*V,X<te-1?O[X+1]*V:N.length,V,!1);ae===ae.next&&(ae.steiner=!0),H.push(az(ae))}H.sort(iz);for(let X=0;X<H.length;X++)L=sz(H[X],L);return L}(a,e,g,o)),a.length>80*o){T=1/0,C=1/0;let N=-1/0,O=-1/0;for(let L=o;L<d;L+=o){const V=a[L],H=a[L+1];V<T&&(T=V),H<C&&(C=H),V>N&&(N=V),H>O&&(O=H)}I=Math.max(N-T,O-C),I=I!==0?32767/I:0}return Yy(g,y,o,T,C,I,0),y}function z2(a,e,o,u,d){let g;if(d===function(y,T,C,I){let N=0;for(let O=T,L=C-I;O<C;O+=I)N+=(y[L]-y[O])*(y[O+1]+y[L+1]),L=O;return N}(a,e,o,u)>0)for(let y=e;y<o;y+=u)g=V2(y/u|0,a[y],a[y+1],g);else for(let y=o-u;y>=e;y-=u)g=V2(y/u|0,a[y],a[y+1],g);return g&&$g(g,g.next)&&(e_(g),g=g.next),g}function Vm(a,e){if(!a)return a;e||(e=a);let o,u=a;do if(o=!1,u.steiner||!$g(u,u.next)&&Qs(u.prev,u,u.next)!==0)u=u.next;else{if(e_(u),u=e=u.prev,u===u.next)break;o=!0}while(o||u!==e);return e}function Yy(a,e,o,u,d,g,y){if(!a)return;!y&&g&&function(C,I,N,O){let L=C;do L.z===0&&(L.z=q1(L.x,L.y,I,N,O)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==C);L.prevZ.nextZ=null,L.prevZ=null,function(V){let H,X=1;do{let te,ae=V;V=null;let de=null;for(H=0;ae;){H++;let pe=ae,Q=0;for(let me=0;me<X&&(Q++,pe=pe.nextZ,pe);me++);let he=X;for(;Q>0||he>0&&pe;)Q!==0&&(he===0||!pe||ae.z<=pe.z)?(te=ae,ae=ae.nextZ,Q--):(te=pe,pe=pe.nextZ,he--),de?de.nextZ=te:V=te,te.prevZ=de,de=te;ae=pe}de.nextZ=null,X*=2}while(H>1)}(L)}(a,u,d,g);let T=a;for(;a.prev!==a.next;){const C=a.prev,I=a.next;if(g?tz(a,u,d,g):ez(a))e.push(C.i,a.i,I.i),e_(a),a=I.next,T=I.next;else if((a=I)===T){y?y===1?Yy(a=rz(Vm(a),e),e,o,u,d,g,2):y===2&&nz(a,e,o,u,d,g):Yy(Vm(a),e,o,u,d,g,1);break}}}function ez(a){const e=a.prev,o=a,u=a.next;if(Qs(e,o,u)>=0)return!1;const d=e.x,g=o.x,y=u.x,T=e.y,C=o.y,I=u.y,N=Math.min(d,g,y),O=Math.min(T,C,I),L=Math.max(d,g,y),V=Math.max(T,C,I);let H=u.next;for(;H!==e;){if(H.x>=N&&H.x<=L&&H.y>=O&&H.y<=V&&Jy(d,T,g,C,y,I,H.x,H.y)&&Qs(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function tz(a,e,o,u){const d=a.prev,g=a,y=a.next;if(Qs(d,g,y)>=0)return!1;const T=d.x,C=g.x,I=y.x,N=d.y,O=g.y,L=y.y,V=Math.min(T,C,I),H=Math.min(N,O,L),X=Math.max(T,C,I),te=Math.max(N,O,L),ae=q1(V,H,e,o,u),de=q1(X,te,e,o,u);let pe=a.prevZ,Q=a.nextZ;for(;pe&&pe.z>=ae&&Q&&Q.z<=de;){if(pe.x>=V&&pe.x<=X&&pe.y>=H&&pe.y<=te&&pe!==d&&pe!==y&&Jy(T,N,C,O,I,L,pe.x,pe.y)&&Qs(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,Q.x>=V&&Q.x<=X&&Q.y>=H&&Q.y<=te&&Q!==d&&Q!==y&&Jy(T,N,C,O,I,L,Q.x,Q.y)&&Qs(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;pe&&pe.z>=ae;){if(pe.x>=V&&pe.x<=X&&pe.y>=H&&pe.y<=te&&pe!==d&&pe!==y&&Jy(T,N,C,O,I,L,pe.x,pe.y)&&Qs(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;Q&&Q.z<=de;){if(Q.x>=V&&Q.x<=X&&Q.y>=H&&Q.y<=te&&Q!==d&&Q!==y&&Jy(T,N,C,O,I,L,Q.x,Q.y)&&Qs(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function rz(a,e){let o=a;do{const u=o.prev,d=o.next.next;!$g(u,d)&&F2(u,o,o.next,d)&&Qy(u,d)&&Qy(d,u)&&(e.push(u.i,o.i,d.i),e_(o),e_(o.next),o=a=d),o=o.next}while(o!==a);return Vm(o)}function nz(a,e,o,u,d,g){let y=a;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&lz(y,T)){let C=B2(y,T);return y=Vm(y,y.next),C=Vm(C,C.next),Yy(y,e,o,u,d,g,0),void Yy(C,e,o,u,d,g,0)}T=T.next}y=y.next}while(y!==a)}function iz(a,e){let o=a.x-e.x;return o===0&&(o=a.y-e.y,o===0)&&(o=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),o}function sz(a,e){const o=function(d,g){let y=g;const T=d.x,C=d.y;let I,N=-1/0;if($g(d,y))return y;do{if($g(d,y.next))return y.next;if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){const X=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(X<=T&&X>N&&(N=X,I=y.x<y.next.x?y:y.next,X===T))return I}y=y.next}while(y!==g);if(!I)return null;const O=I,L=I.x,V=I.y;let H=1/0;y=I;do{if(T>=y.x&&y.x>=L&&T!==y.x&&j2(C<V?T:N,C,L,V,C<V?N:T,C,y.x,y.y)){const X=Math.abs(C-y.y)/(T-y.x);Qy(y,d)&&(X<H||X===H&&(y.x>I.x||y.x===I.x&&oz(I,y)))&&(I=y,H=X)}y=y.next}while(y!==O);return I}(a,e);if(!o)return e;const u=B2(o,a);return Vm(u,u.next),Vm(o,o.next)}function oz(a,e){return Qs(a.prev,a,e.prev)<0&&Qs(e.next,a,a.next)<0}function q1(a,e,o,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function az(a){let e=a,o=a;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==a);return o}function j2(a,e,o,u,d,g,y,T){return(d-y)*(e-T)>=(a-y)*(g-T)&&(a-y)*(u-T)>=(o-y)*(e-T)&&(o-y)*(g-T)>=(d-y)*(u-T)}function Jy(a,e,o,u,d,g,y,T){return!(a===y&&e===T)&&j2(a,e,o,u,d,g,y,T)}function lz(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(o,u){let d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==u.i&&d.next.i!==u.i&&F2(d,d.next,o,u))return!0;d=d.next}while(d!==o);return!1}(a,e)&&(Qy(a,e)&&Qy(e,a)&&function(o,u){let d=o,g=!1;const y=(o.x+u.x)/2,T=(o.y+u.y)/2;do d.y>T!=d.next.y>T&&d.next.y!==d.y&&y<(d.next.x-d.x)*(T-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==o);return g}(a,e)&&(Qs(a.prev,a,e.prev)||Qs(a,e.prev,e))||$g(a,e)&&Qs(a.prev,a,a.next)>0&&Qs(e.prev,e,e.next)>0)}function Qs(a,e,o){return(e.y-a.y)*(o.x-e.x)-(e.x-a.x)*(o.y-e.y)}function $g(a,e){return a.x===e.x&&a.y===e.y}function F2(a,e,o,u){const d=Ex(Qs(a,e,o)),g=Ex(Qs(a,e,u)),y=Ex(Qs(o,u,a)),T=Ex(Qs(o,u,e));return d!==g&&y!==T||!(d!==0||!Tx(a,o,e))||!(g!==0||!Tx(a,u,e))||!(y!==0||!Tx(o,a,u))||!(T!==0||!Tx(o,e,u))}function Tx(a,e,o){return e.x<=Math.max(a.x,o.x)&&e.x>=Math.min(a.x,o.x)&&e.y<=Math.max(a.y,o.y)&&e.y>=Math.min(a.y,o.y)}function Ex(a){return a>0?1:a<0?-1:0}function Qy(a,e){return Qs(a.prev,a,a.next)<0?Qs(a,e,a.next)>=0&&Qs(a,a.prev,e)>=0:Qs(a,e,a.prev)<0||Qs(a,a.next,e)<0}function B2(a,e){const o=W1(a.i,a.x,a.y),u=W1(e.i,e.x,e.y),d=a.next,g=e.prev;return a.next=e,e.prev=a,o.next=d,d.prev=o,u.next=o,o.prev=u,g.next=u,u.prev=g,u}function V2(a,e,o,u){const d=W1(a,e,o);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function e_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function W1(a,e,o){return{i:a,x:e,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Cx(a,e){const o=a.length;if(o<=1)return[a];const u=[];let d,g;for(let y=0;y<o;y++){const T=gn(a[y]);T!==0&&(a[y].area=Math.abs(T),g===void 0&&(g=T<0),g===T<0?(d&&u.push(d),d=[a[y]]):d.push(a[y]))}if(d&&u.push(d),e>1)for(let y=0;y<u.length;y++)u[y].length<=e||(ks(u[y],e,1,u[y].length-1,cz),u[y]=u[y].slice(0,e));return u}function cz(a,e){return e.area-a.area}function U2(a,e,o=1){if(!a)return null;const u=typeof a=="string"?Uo.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(const g of[u,d]){if(!g)continue;const y=g.id.toString();e.has(y)||e.set(y,[]),g.scaleSelf(o),e.get(y).push(g)}return{primary:u.toString(),secondary:d?d.toString():null}}function Z1(a,e,o,u){const d=u.patternDependencies;let g=!1;for(const y of e){const T=y.paint.get(`${a}-pattern`);T.isConstant()||(g=!0),U2(T.constantOr(null),d,o)&&(g=!0)}return g}function X1(a,e,o,u,d,g){const y=g.patternDependencies;for(const T of e){const C=T.paint.get(`${a}-pattern`).value;if(C.kind!=="constant"){let I=C.evaluate({zoom:u},o,{},g.availableImages);I=I&&I.name?I.name:I;const N=U2(I,y,d);if(!N)continue;const{primary:O,secondary:L}=N;O&&(o.patterns[T.id]=[O,L].filter(Boolean))}}return o}class $2{constructor(){this.polygons=new Map}add(e,...o){this.polygons.has(e)?this.polygons.get(e).push(...o):this.polygons.set(e,o)}merge(e){for(const[o,u]of e.polygons)this.add(o,...u)}}class Um{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Um;let o=[];for(const I of e)o.push(...I.portals);if(o.length===0)return new Um;const u=(I,N)=>I<=0&&N<=0||I>=jt&&N>=jt;for(const I of o){const N=I.va,O=I.vb;(u(N.x,O.x)||u(N.y,O.y))&&(I.type="border")}const d=o.filter(I=>I.type!=="unevaluated"),g=o.filter(I=>I.type==="unevaluated");if(g.length===0)return new Um;g.sort((I,N)=>I.hash===N.hash?I.isTunnel===N.isTunnel?0:I.isTunnel?-1:1:I.hash<N.hash?1:-1),o=d.concat(g);let y=d.length,T=y,C=y;do if(T++,T===o.length||o[y].hash!==o[T].hash){if(T-y==2){C<y&&(o[C]=o[y],o[y]=null);const I=o[C],N=o[T-1];I.type=I.isTunnel!==N.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:N.connection.a},C++}y=T}while(y!==o.length);return o.splice(C),o.sort((I,N)=>I.hash<N.hash?1:-1),{portals:o}}}Zt(Um,"ElevationPortalGraph"),Zt($2,"ElevationPolygons");class uz{constructor(e,o,u){this.outPositions=e,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,o,u){let d=e[2];u!=null&&(d*=u);const g=this.getVec3Bits(e)<<96n|this.getVec3Bits(o),y=this.vertexLookup.get(g);if(y!=null)return y;const T=this.outPositions.length;this.vertexLookup.set(g,T);const C=Math.trunc(16384*o[0]),I=Math.trunc(16384*o[1]),N=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(C,I,N),T}addVertices(e,o,...u){const d=[];for(const g of u){const y=this.addVertex(g,e,o);d.push(y)}return d}addTriangles(e,o,u){if(o&&u){const d=u.length===1,g=Ft(0,0,0);for(let y=0;y<e.length;y+=3){const T=o[e[y+0]],C=o[e[y+1]],I=o[e[y+2]],N=d?u[0]:u[e[y+1]],O=d?u[0]:u[e[y+2]],L=this.addVertex(Ft(T.x,T.y,d?u[0]:u[e[y+0]]),g),V=this.addVertex(Ft(C.x,C.y,N),g),H=this.addVertex(Ft(I.x,I.y,O),g);this.outIndices.emplaceBack(L,V,H)}}else for(let d=0;d<e.length;d+=3)this.outIndices.emplaceBack(e[d+0],e[d+1],e[d+2])}addQuad(e,o){const u=this.addVertices(o,void 0,...e.map(C=>Ft(C.coord.x,C.coord.y,C.height))),[d,g,y,T]=u;this.addTriangles([d,g,y,y,T,d])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Zl{constructor(e,o,u,d){this.unevaluatedPortals=new Um,this.portalPolygons=new $2,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Em,this.vertexNormals=new lp,this.indexArray=new Rs,this.tileToMeters=Je(e),this.bridgeProgramConfigurations=new f(o,{zoom:u,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new f(o,{zoom:u,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(e,o){const u=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(o[d]);return u}addTriangles(e,o,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of e)d.push(g+o)}addRenderableRing(e,o,u,d,g,y){const T=[new Ot(g.min.x,g.min.y),new Ot(g.max.x,g.min.y),new Ot(g.max.x,g.max.y),new Ot(g.min.x,g.max.y)];for(let C=0;C<u-1;C++){const I=o+C,N=I+1,O=this.unevalVertices[I],L=this.unevalVertices[N];if(!(O.x>=g.min.x&&O.x<=g.max.x&&O.y>=g.min.y&&O.y<=g.max.y||L.x>=g.min.x&&L.x<=g.max.x&&L.y>=g.min.y&&L.y<=g.max.y||Wl(O,L,T))||this.isOnBorder(O.x,L.x)||this.isOnBorder(O.y,L.y))continue;const V=Zl.computeEdgeHash(this.unevalVertices[I],this.unevalVertices[N]);let H,X=this.vertexHashLookup.get(Zl.computePosHash(O));X!=null?H=X.next:(X=this.vertexHashLookup.get(Zl.computePosHash(L)),H=X!=null?X.prev:V),this.unevalEdges.push({polygonIdx:e,a:I,b:N,hash:V,portalHash:H,isTunnel:d,type:"unevaluated",featureInfo:y})}}addPortalCandidates(e,o,u,d,g){if(o.length===0)return;this.portalPolygons.add(e,{geometry:o,zLevel:g});const y=o[0];this.vertexHashLookup.clear();let T=Zl.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let C=0;C<y.length-1;C++){const I=y[C+0],N=y[C+1],O=go(N.x-I.x,N.y-I.y),L=As(O);if(L===0)continue;let V="unevaluated";const H=d.pointElevation(I),X=d.pointElevation(N);Math.abs(H)<.01&&Math.abs(X)<.01?V="entrance":(this.isOnBorder(I.x,N.x)||this.isOnBorder(I.y,N.y))&&(V="border");const te=Zl.computeEdgeHash(I,N);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:I,vb:N,vab:O,length:L,hash:te,isTunnel:u,type:V});const ae=Zl.computePosHash(I);this.vertexHashLookup.set(ae,{prev:T,next:te}),T=te}}construct(e){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},d=new uz(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const g=o(),y=o(),T=o(),C=(L,V)=>{L.sort((X,te)=>X.type===V&&te.type!==V?-1:X.type!==V&&te.type===V?1:0);const H=L.findIndex(X=>X.type!==V);return H>=0?H:L.length};let I=0;this.unevalEdges.length>0&&(I=C(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters)),u(T);const N=o(),O=o();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(I),V=C(L,"tunnel")+I;this.unevalEdges.push(...L),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:V})}u(N),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(O),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=si.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.depthSegments=si.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=si.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableTunnelSegments=si.simpleSegment(0,N.primitiveOffset,0,N.primitiveLength),this.shadowCasterSegments=si.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(e,o,u,d,g,y,T,C){this.bridgeProgramConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C),this.tunnelProgramConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,JL.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,QL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,o,u,d,g){const y=(T,C)=>{for(let I=0;I<C.length-1;I++){const N=C[I].featureIndex,O=C[I+1].vertexStart,L=e.feature(N);T.populatePaintArrays(O,L,N,{},u,o,d,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,o,u,d,g){const y=new Map;for(let T=d;T<g;T++){const C=u[T],I=C.a,N=C.b,O=Zl.computePosHash(e[I]),L=Zl.computePosHash(e[N]);y.has(O)||y.set(O,{}),y.has(L)||y.set(L,{});const V=y.get(O),H=y.get(L);o[I]<=0&&o[N]<=0||(V.to=N,H.from=I)}return y}constructBridgeStructures(e,o,u,d,g,y){e.clearVertexLookup();const T=this.computeVertexConnections(o,u,d,g.min,g.max),C=1/y,I=.5*C,N=V=>Ft(o[V].x,o[V].y,u[V]*C),O=V=>{const H=T.get(Zl.computePosHash(o[V])),X=H.from,te=H.to;if(!X||!te)return;const ae=N(X),de=N(V),pe=N(te),Q=Ft(0,0,0);if(!ri(ae,de)){const me=On(_r(),de,ae);br(Q,Q,Rr(me,me))}if(!ri(pe,de)){const me=On(_r(),pe,de);br(Q,Q,Rr(me,me))}const he=$s(Q);return he>0?Ht(Q,Q,1/he):void 0};let L=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(V,H)=>V.featureInfo.featureIndex-H.featureInfo.featureIndex);for(let V=g.min;V<g.max;V++){const H=d[V];if(!H.featureInfo.guardRailEnabled)continue;const X=this.prepareEdgePoints(o,u,H,(Gr,tr)=>Gr>tr);if(X==null)continue;const te=X[0],ae=X[1],de=Ft(te.coord.x,te.coord.y,C*te.height),pe=Ft(ae.coord.x,ae.coord.y,C*ae.height);if(ri(de,pe))continue;const Q=On(_r(),pe,de);Rr(Q,Q);const he=Gr=>Rr(Gr,Gr),me=O(H.a)||Q,_e=O(H.b)||Q,De=he(Ft(me[1],-me[0],0)),ke=he(Ft(_e[1],-_e[0],0)),Oe=he(lr(_r(),De,me)),Ve=he(lr(_r(),ke,_e)),tt=_r(),vt=[br(_r(),de,Ht(tt,On(tt,De,Oe),I)),br(_r(),de,Ht(tt,br(tt,De,Oe),I)),br(_r(),de,Ht(tt,Oe,I)),de],ft=[br(_r(),pe,Ht(tt,On(tt,ke,Ve),I)),br(_r(),pe,Ht(tt,br(tt,ke,Ve),I)),br(_r(),pe,Ht(tt,Ve,I)),pe];L=this.addFeatureSection(H.featureInfo.featureIndex,L,this.bridgeFeatureSections,e);const[xt,St]=e.addVertices(De,y,vt[0],vt[1]),[nt,_t]=e.addVertices(ke,y,ft[0],ft[1]);e.addTriangles([xt,St,nt,St,_t,nt]);const[et,rt]=e.addVertices(Oe,y,vt[1],vt[2]),[Mt,Pt]=e.addVertices(Ve,y,ft[1],ft[2]);e.addTriangles([et,rt,Mt,rt,Pt,Mt]);const[yr,rr]=e.addVertices(Zr(De,De),y,vt[2],vt[3]),[$t,At]=e.addVertices(Zr(ke,ke),y,ft[2],ft[3]);e.addTriangles([yr,rr,$t,rr,At,$t])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,o,u,d,g,y){e.clearVertexLookup();let T=Number.POSITIVE_INFINITY;const C=(N,O)=>N.featureInfo.featureIndex-O.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,C),this.sortSubarray(d,y.min,y.max,C);const I=N=>Rr(N,N);for(let N=g.min;N<g.max;N++){const O=this.prepareEdgePoints(o,u,d[N],(X,te)=>X<te);if(O==null)continue;const[L,V]=O,H=I(Ft(-(V.coord.y-L.coord.y),V.coord.x-L.coord.x,0));T=this.addFeatureSection(d[N].featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad([L,V,{coord:V.coord,height:d[N].isTunnel?-.1:0},{coord:L.coord,height:d[N].isTunnel?-.1:0}],H)}for(let N=y.min;N<y.max;N++){const O=d[N];O.isTunnel&&([O.a,O.b]=[O.b,O.a]);const L=o[O.a],V=o[O.b],H=I(Ft(-(V.y-L.y),V.x-L.x,0));T=this.addFeatureSection(O.featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad([{coord:V,height:0},{coord:L,height:0},{coord:L,height:u[O.a]+4},{coord:V,height:u[O.b]+4}],H),e.addQuad([{coord:L,height:0},{coord:V,height:0},{coord:V,height:u[O.b]+4},{coord:L,height:u[O.a]+4}],H)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,o,u,d){let g=o[u.a],y=o[u.b];const T=d(g,0),C=d(y,0);if(T&&C)return[{coord:e[u.a],height:g},{coord:e[u.b],height:y}];if(!T&&!C)return;const I=e[u.a].clone(),N=e[u.b].clone();if(T){if(!C){const O=y/(y-g);N.x=Ir(N.x,I.x,O),N.y=Ir(N.y,I.y,O),y=Ir(y,g,O)}}else{const O=g/(g-y);I.x=Ir(I.x,N.x,O),I.y=Ir(I.y,N.y,O),g=Ir(g,y,O)}return[{coord:I,height:g},{coord:N,height:y}]}prepareEdges(e,o){if(o.length===0)return;o.sort((T,C)=>T.hash===C.hash?C.polygonIdx-T.polygonIdx:C.hash>T.hash?1:-1);let u=0,d=0,g=0,y=o[u].polygonIdx;do d++,(d===o.length||o[u].hash!==o[d].hash)&&((d-u==1||o[d-1].polygonIdx!==y)&&(g<u&&(o[g]=o[u],o[u]=null),o[g].type="none",g++),u=d,u!==o.length&&(y=o[u].polygonIdx));while(u!==o.length);if(o.splice(g),o.length!==0&&e.length!==0){o.sort((I,N)=>I.portalHash<N.portalHash?1:-1);let T=0,C=0;for(;T!==o.length&&C!==e.length;){const I=o[T],N=e[C];I.portalHash>N.hash?T++:N.hash>I.portalHash?C++:(I.type=N.type,T++)}}}isOnBorder(e,o){return e<=0&&o<=0||e>=jt&&o>=jt}addFeatureSection(e,o,u,d){return e!==o&&(o=e,u.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),o}sortSubarray(e,o,u,d){const g=e.slice(o,u);g.sort(d),e.splice(o,g.length,...g)}static computeEdgeHash(e,o){return(e.y===o.y&&e.x>o.x||e.y>o.y)&&([e,o]=[o,e]),BigInt(Zl.computePosHash(e))<<32n|BigInt(Zl.computePosHash(o))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var H2,G2={exports:{}},q2=(H2||(H2=1,function(a,e){(function(o){function u(ye,Se){return ye>Se?1:ye<Se?-1:0}var d=function(ye,Se){ye===void 0&&(ye=u),Se===void 0&&(Se=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!Se},g={size:{configurable:!0}};function y(ye,Se,ot,Lt,Gt){var Ut=Gt-Lt;if(Ut>0){var er=Lt+Math.floor(Ut/2),Lr={key:Se[er],data:ot[er],parent:ye};return Lr.left=y(Lr,Se,ot,Lt,er),Lr.right=y(Lr,Se,ot,er+1,Gt),Lr}return null}function T(ye,Se,ot,Lt,Gt){if(!(ot>=Lt)){for(var Ut=ye[ot+Lt>>1],er=ot-1,Lr=Lt+1;;){do er++;while(Gt(ye[er],Ut)<0);do Lr--;while(Gt(ye[Lr],Ut)>0);if(er>=Lr)break;var yn=ye[er];ye[er]=ye[Lr],ye[Lr]=yn,yn=Se[er],Se[er]=Se[Lr],Se[Lr]=yn}T(ye,Se,ot,Lr,Gt),T(ye,Se,Lr+1,Lt,Gt)}}d.prototype.rotateLeft=function(ye){var Se=ye.right;Se&&(ye.right=Se.left,Se.left&&(Se.left.parent=ye),Se.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.left=ye),ye.parent=Se},d.prototype.rotateRight=function(ye){var Se=ye.left;Se&&(ye.left=Se.right,Se.right&&(Se.right.parent=ye),Se.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.right=ye),ye.parent=Se},d.prototype._splay=function(ye){for(;ye.parent;){var Se=ye.parent;Se.parent?Se.left===ye&&Se.parent.left===Se?(this.rotateRight(Se.parent),this.rotateRight(Se)):Se.right===ye&&Se.parent.right===Se?(this.rotateLeft(Se.parent),this.rotateLeft(Se)):Se.left===ye&&Se.parent.right===Se?(this.rotateRight(Se),this.rotateLeft(Se)):(this.rotateLeft(Se),this.rotateRight(Se)):Se.left===ye?this.rotateRight(Se):this.rotateLeft(Se)}},d.prototype.splay=function(ye){for(var Se,ot,Lt,Gt,Ut;ye.parent;)(ot=(Se=ye.parent).parent)&&ot.parent?((Lt=ot.parent).left===ot?Lt.left=ye:Lt.right=ye,ye.parent=Lt):(ye.parent=null,this._root=ye),Gt=ye.left,Ut=ye.right,ye===Se.left?(ot&&(ot.left===Se?(Se.right?(ot.left=Se.right,ot.left.parent=ot):ot.left=null,Se.right=ot,ot.parent=Se):(Gt?(ot.right=Gt,Gt.parent=ot):ot.right=null,ye.left=ot,ot.parent=ye)),Ut?(Se.left=Ut,Ut.parent=Se):Se.left=null,ye.right=Se,Se.parent=ye):(ot&&(ot.right===Se?(Se.left?(ot.right=Se.left,ot.right.parent=ot):ot.right=null,Se.left=ot,ot.parent=Se):(Ut?(ot.left=Ut,Ut.parent=ot):ot.left=null,ye.right=ot,ot.parent=ye)),Gt?(Se.right=Gt,Gt.parent=Se):Se.right=null,ye.left=Se,Se.parent=ye)},d.prototype.replace=function(ye,Se){ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.parent=ye.parent)},d.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},d.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},d.prototype.insert=function(ye,Se){var ot=this._root,Lt=null,Gt=this._compare;if(this._noDuplicates)for(;ot;){if(Lt=ot,Gt(ot.key,ye)===0)return;ot=Gt(ot.key,ye)<0?ot.right:ot.left}else for(;ot;)Lt=ot,ot=Gt(ot.key,ye)<0?ot.right:ot.left;return ot={key:ye,data:Se,left:null,right:null,parent:Lt},Lt?Gt(Lt.key,ot.key)<0?Lt.right=ot:Lt.left=ot:this._root=ot,this.splay(ot),this._size++,ot},d.prototype.find=function(ye){for(var Se=this._root,ot=this._compare;Se;){var Lt=ot(Se.key,ye);if(Lt<0)Se=Se.right;else{if(!(Lt>0))return Se;Se=Se.left}}return null},d.prototype.contains=function(ye){for(var Se=this._root,ot=this._compare;Se;){var Lt=ot(ye,Se.key);if(Lt===0)return!0;Se=Lt<0?Se.left:Se.right}return!1},d.prototype.remove=function(ye){var Se=this.find(ye);if(!Se)return!1;if(this.splay(Se),Se.left)if(Se.right){var ot=this.minNode(Se.right);ot.parent!==Se&&(this.replace(ot,ot.right),ot.right=Se.right,ot.right.parent=ot),this.replace(Se,ot),ot.left=Se.left,ot.left.parent=ot}else this.replace(Se,Se.left);else this.replace(Se,Se.right);return this._size--,!0},d.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var Se=this.minNode(ye.right);Se.parent!==ye&&(this.replace(Se,Se.right),Se.right=ye.right,Se.right.parent=Se),this.replace(ye,Se),Se.left=ye.left,Se.left.parent=Se}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},d.prototype.erase=function(ye){var Se=this.find(ye);if(Se){this.splay(Se);var ot=Se.left,Lt=Se.right,Gt=null;ot&&(ot.parent=null,Gt=this.maxNode(ot),this.splay(Gt),this._root=Gt),Lt&&(ot?Gt.right=Lt:this._root=Lt,Lt.parent=Gt),this._size--}},d.prototype.pop=function(){var ye=this._root,Se=null;if(ye){for(;ye.left;)ye=ye.left;Se={key:ye.key,data:ye.data},this.remove(ye.key)}return Se},d.prototype.next=function(ye){var Se=ye;if(Se)if(Se.right)for(Se=Se.right;Se&&Se.left;)Se=Se.left;else for(Se=ye.parent;Se&&Se.right===ye;)ye=Se,Se=Se.parent;return Se},d.prototype.prev=function(ye){var Se=ye;if(Se)if(Se.left)for(Se=Se.left;Se&&Se.right;)Se=Se.right;else for(Se=ye.parent;Se&&Se.left===ye;)ye=Se,Se=Se.parent;return Se},d.prototype.forEach=function(ye){for(var Se=this._root,ot=[],Lt=!1,Gt=0;!Lt;)Se?(ot.push(Se),Se=Se.left):ot.length>0?(ye(Se=ot.pop(),Gt++),Se=Se.right):Lt=!0;return this},d.prototype.range=function(ye,Se,ot,Lt){for(var Gt=[],Ut=this._compare,er=this._root;Gt.length!==0||er;)if(er)Gt.push(er),er=er.left;else{if(Ut((er=Gt.pop()).key,Se)>0)break;if(Ut(er.key,ye)>=0&&ot.call(Lt,er))return this;er=er.right}return this},d.prototype.keys=function(){for(var ye=this._root,Se=[],ot=[],Lt=!1;!Lt;)ye?(Se.push(ye),ye=ye.left):Se.length>0?(ye=Se.pop(),ot.push(ye.key),ye=ye.right):Lt=!0;return ot},d.prototype.values=function(){for(var ye=this._root,Se=[],ot=[],Lt=!1;!Lt;)ye?(Se.push(ye),ye=ye.left):Se.length>0?(ye=Se.pop(),ot.push(ye.data),ye=ye.right):Lt=!0;return ot},d.prototype.at=function(ye){for(var Se=this._root,ot=[],Lt=!1,Gt=0;!Lt;)if(Se)ot.push(Se),Se=Se.left;else if(ot.length>0){if(Se=ot.pop(),Gt===ye)return Se;Gt++,Se=Se.right}else Lt=!0;return null},d.prototype.load=function(ye,Se,ot){if(ye===void 0&&(ye=[]),Se===void 0&&(Se=[]),ot===void 0&&(ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Lt=ye.length;return ot&&T(ye,Se,0,Lt-1,this._compare),this._root=y(null,ye,Se,0,Lt),this._size=Lt,this},d.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},d.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},d.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},d.createTree=function(ye,Se,ot,Lt,Gt){return new d(ot,Gt).load(ye,Se,Lt)},Object.defineProperties(d.prototype,g);var C=0,I=1,N=2,O=3,L=0,V=1,H=2,X=3;function te(ye,Se,ot){Se===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===Se.isSubject?(ye.inOut=!Se.inOut,ye.otherInOut=Se.otherInOut):(ye.inOut=!Se.otherInOut,ye.otherInOut=Se.isVertical()?!Se.inOut:Se.inOut),Se&&(ye.prevInResult=!ae(Se,ot)||Se.isVertical()?Se.prevInResult:Se));var Lt=ae(ye,ot);ye.resultTransition=Lt?function(Gt,Ut){var er,Lr=!Gt.inOut,yn=!Gt.otherInOut;switch(Ut){case L:er=Lr&&yn;break;case V:er=Lr||yn;break;case X:er=Lr^yn;break;case H:er=Gt.isSubject?Lr&&!yn:yn&&!Lr}return er?1:-1}(ye,ot):0}function ae(ye,Se){switch(ye.type){case C:switch(Se){case L:return!ye.otherInOut;case V:return ye.otherInOut;case H:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case X:return!0}break;case N:return Se===L||Se===V;case O:return Se===H;case I:return!1}return!1}var de=function(ye,Se,ot,Lt,Gt){this.left=Se,this.point=ye,this.otherEvent=ot,this.isSubject=Lt,this.type=Gt||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},pe={inResult:{configurable:!0}};function Q(ye,Se){return ye[0]===Se[0]&&ye[1]===Se[1]}de.prototype.isBelow=function(ye){var Se=this.point,ot=this.otherEvent.point;return this.left?(Se[0]-ye[0])*(ot[1]-ye[1])-(ot[0]-ye[0])*(Se[1]-ye[1])>0:(ot[0]-ye[0])*(Se[1]-ye[1])-(Se[0]-ye[0])*(ot[1]-ye[1])>0},de.prototype.isAbove=function(ye){return!this.isBelow(ye)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},pe.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var ye=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(de.prototype,pe);var he=11102230246251565e-32,me=134217729,_e=(3+8*he)*he;function De(ye,Se,ot,Lt,Gt){var Ut,er,Lr,yn,_n=Se[0],on=Lt[0],Kn=0,gi=0;on>_n==on>-_n?(Ut=_n,_n=Se[++Kn]):(Ut=on,on=Lt[++gi]);var xn=0;if(Kn<ye&&gi<ot)for(on>_n==on>-_n?(Lr=Ut-((er=_n+Ut)-_n),_n=Se[++Kn]):(Lr=Ut-((er=on+Ut)-on),on=Lt[++gi]),Ut=er,Lr!==0&&(Gt[xn++]=Lr);Kn<ye&&gi<ot;)on>_n==on>-_n?(Lr=Ut-((er=Ut+_n)-(yn=er-Ut))+(_n-yn),_n=Se[++Kn]):(Lr=Ut-((er=Ut+on)-(yn=er-Ut))+(on-yn),on=Lt[++gi]),Ut=er,Lr!==0&&(Gt[xn++]=Lr);for(;Kn<ye;)Lr=Ut-((er=Ut+_n)-(yn=er-Ut))+(_n-yn),_n=Se[++Kn],Ut=er,Lr!==0&&(Gt[xn++]=Lr);for(;gi<ot;)Lr=Ut-((er=Ut+on)-(yn=er-Ut))+(on-yn),on=Lt[++gi],Ut=er,Lr!==0&&(Gt[xn++]=Lr);return Ut===0&&xn!==0||(Gt[xn++]=Ut),xn}function ke(ye){return new Float64Array(ye)}var Oe=33306690738754716e-32,Ve=22204460492503146e-32,tt=11093356479670487e-47,vt=ke(4),ft=ke(8),xt=ke(12),St=ke(16),nt=ke(4);function _t(ye,Se,ot){var Lt=function(Gt,Ut,er,Lr,yn,_n){var on=(Ut-_n)*(er-yn),Kn=(Gt-yn)*(Lr-_n),gi=on-Kn;if(on===0||Kn===0||on>0!=Kn>0)return gi;var xn=Math.abs(on+Kn);return Math.abs(gi)>=Oe*xn?gi:-function(qi,Ti,Wn,Qi,Ai,yi,Ei){var ei,cn,ii,Wi,Pr,Mn,Ii,Xi,Oi,Ss,li,gs,el,Oo,bo,tl,ld,Ts,Us=qi-Ai,Lo=Wn-Ai,ma=Ti-yi,Yo=Qi-yi;vt[0]=(bo=(Xi=Us-(Ii=(Mn=me*Us)-(Mn-Us)))*(Ss=Yo-(Oi=(Mn=me*Yo)-(Mn-Yo)))-((Oo=Us*Yo)-Ii*Oi-Xi*Oi-Ii*Ss))-((li=bo-(ld=(Xi=ma-(Ii=(Mn=me*ma)-(Mn-ma)))*(Ss=Lo-(Oi=(Mn=me*Lo)-(Mn-Lo)))-((tl=ma*Lo)-Ii*Oi-Xi*Oi-Ii*Ss)))+(Pr=bo-li))+(Pr-ld),vt[1]=(el=Oo-((gs=Oo+li)-(Pr=gs-Oo))+(li-Pr))-((li=el-tl)+(Pr=el-li))+(Pr-tl),vt[2]=gs-((Ts=gs+li)-(Pr=Ts-gs))+(li-Pr),vt[3]=Ts;var Ip=function(lX,tI){for(var rI=tI[0],ew=1;ew<4;ew++)rI+=tI[ew];return rI}(0,vt),I_=Ve*Ei;if(Ip>=I_||-Ip>=I_||(ei=qi-(Us+(Pr=qi-Us))+(Pr-Ai),ii=Wn-(Lo+(Pr=Wn-Lo))+(Pr-Ai),cn=Ti-(ma+(Pr=Ti-ma))+(Pr-yi),Wi=Qi-(Yo+(Pr=Qi-Yo))+(Pr-yi),ei===0&&cn===0&&ii===0&&Wi===0)||(I_=tt*Ei+_e*Math.abs(Ip),(Ip+=Us*Wi+Yo*ei-(ma*ii+Lo*cn))>=I_||-Ip>=I_))return Ip;nt[0]=(bo=(Xi=ei-(Ii=(Mn=me*ei)-(Mn-ei)))*(Ss=Yo-(Oi=(Mn=me*Yo)-(Mn-Yo)))-((Oo=ei*Yo)-Ii*Oi-Xi*Oi-Ii*Ss))-((li=bo-(ld=(Xi=cn-(Ii=(Mn=me*cn)-(Mn-cn)))*(Ss=Lo-(Oi=(Mn=me*Lo)-(Mn-Lo)))-((tl=cn*Lo)-Ii*Oi-Xi*Oi-Ii*Ss)))+(Pr=bo-li))+(Pr-ld),nt[1]=(el=Oo-((gs=Oo+li)-(Pr=gs-Oo))+(li-Pr))-((li=el-tl)+(Pr=el-li))+(Pr-tl),nt[2]=gs-((Ts=gs+li)-(Pr=Ts-gs))+(li-Pr),nt[3]=Ts;var J3=De(4,vt,4,nt,ft);nt[0]=(bo=(Xi=Us-(Ii=(Mn=me*Us)-(Mn-Us)))*(Ss=Wi-(Oi=(Mn=me*Wi)-(Mn-Wi)))-((Oo=Us*Wi)-Ii*Oi-Xi*Oi-Ii*Ss))-((li=bo-(ld=(Xi=ma-(Ii=(Mn=me*ma)-(Mn-ma)))*(Ss=ii-(Oi=(Mn=me*ii)-(Mn-ii)))-((tl=ma*ii)-Ii*Oi-Xi*Oi-Ii*Ss)))+(Pr=bo-li))+(Pr-ld),nt[1]=(el=Oo-((gs=Oo+li)-(Pr=gs-Oo))+(li-Pr))-((li=el-tl)+(Pr=el-li))+(Pr-tl),nt[2]=gs-((Ts=gs+li)-(Pr=Ts-gs))+(li-Pr),nt[3]=Ts;var Q3=De(J3,ft,4,nt,xt);nt[0]=(bo=(Xi=ei-(Ii=(Mn=me*ei)-(Mn-ei)))*(Ss=Wi-(Oi=(Mn=me*Wi)-(Mn-Wi)))-((Oo=ei*Wi)-Ii*Oi-Xi*Oi-Ii*Ss))-((li=bo-(ld=(Xi=cn-(Ii=(Mn=me*cn)-(Mn-cn)))*(Ss=ii-(Oi=(Mn=me*ii)-(Mn-ii)))-((tl=cn*ii)-Ii*Oi-Xi*Oi-Ii*Ss)))+(Pr=bo-li))+(Pr-ld),nt[1]=(el=Oo-((gs=Oo+li)-(Pr=gs-Oo))+(li-Pr))-((li=el-tl)+(Pr=el-li))+(Pr-tl),nt[2]=gs-((Ts=gs+li)-(Pr=Ts-gs))+(li-Pr),nt[3]=Ts;var eF=De(Q3,xt,4,nt,St);return St[eF-1]}(Gt,Ut,er,Lr,yn,_n,xn)}(ye[0],ye[1],Se[0],Se[1],ot[0],ot[1]);return Lt>0?-1:Lt<0?1:0}function et(ye,Se){var ot=ye.point,Lt=Se.point;return ot[0]>Lt[0]?1:ot[0]<Lt[0]?-1:ot[1]!==Lt[1]?ot[1]>Lt[1]?1:-1:function(Gt,Ut,er,Lr){return Gt.left!==Ut.left?Gt.left?1:-1:_t(er,Gt.otherEvent.point,Ut.otherEvent.point)!==0?Gt.isBelow(Ut.otherEvent.point)?-1:1:!Gt.isSubject&&Ut.isSubject?1:-1}(ye,Se,ot)}function rt(ye,Se,ot){var Lt=new de(Se,!1,ye,ye.isSubject),Gt=new de(Se,!0,ye.otherEvent,ye.isSubject);return Q(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),Lt.contourId=Gt.contourId=ye.contourId,et(Gt,ye.otherEvent)>0&&(ye.otherEvent.left=!0,Gt.left=!1),ye.otherEvent.otherEvent=Gt,ye.otherEvent=Lt,ot.push(Gt),ot.push(Lt),ot}function Mt(ye,Se){return ye[0]*Se[1]-ye[1]*Se[0]}function Pt(ye,Se){return ye[0]*Se[0]+ye[1]*Se[1]}function yr(ye,Se,ot){var Lt=function(yn,_n,on,Kn,gi){var xn=[_n[0]-yn[0],_n[1]-yn[1]],qi=[Kn[0]-on[0],Kn[1]-on[1]];function Ti(Mn,Ii,Xi){return[Mn[0]+Ii*Xi[0],Mn[1]+Ii*Xi[1]]}var Wn=[on[0]-yn[0],on[1]-yn[1]],Qi=Mt(xn,qi),Ai=Qi*Qi,yi=Pt(xn,xn);if(Ai>0){var Ei=Mt(Wn,qi)/Qi;if(Ei<0||Ei>1)return null;var ei=Mt(Wn,xn)/Qi;return ei<0||ei>1?null:Ei===0||Ei===1?[Ti(yn,Ei,xn)]:ei===0||ei===1?[Ti(on,ei,qi)]:[Ti(yn,Ei,xn)]}if((Ai=(Qi=Mt(Wn,xn))*Qi)>0)return null;var cn=Pt(xn,Wn)/yi,ii=cn+Pt(xn,qi)/yi,Wi=Math.min(cn,ii),Pr=Math.max(cn,ii);return Wi<=1&&Pr>=0?Wi===1?[Ti(yn,Wi>0?Wi:0,xn)]:Pr===0?[Ti(yn,Pr<1?Pr:1,xn)]:[Ti(yn,Wi>0?Wi:0,xn),Ti(yn,Pr<1?Pr:1,xn)]:null}(ye.point,ye.otherEvent.point,Se.point,Se.otherEvent.point),Gt=Lt?Lt.length:0;if(Gt===0||Gt===1&&(Q(ye.point,Se.point)||Q(ye.otherEvent.point,Se.otherEvent.point))||Gt===2&&ye.isSubject===Se.isSubject)return 0;if(Gt===1)return Q(ye.point,Lt[0])||Q(ye.otherEvent.point,Lt[0])||rt(ye,Lt[0],ot),Q(Se.point,Lt[0])||Q(Se.otherEvent.point,Lt[0])||rt(Se,Lt[0],ot),1;var Ut=[],er=!1,Lr=!1;return Q(ye.point,Se.point)?er=!0:et(ye,Se)===1?Ut.push(Se,ye):Ut.push(ye,Se),Q(ye.otherEvent.point,Se.otherEvent.point)?Lr=!0:et(ye.otherEvent,Se.otherEvent)===1?Ut.push(Se.otherEvent,ye.otherEvent):Ut.push(ye.otherEvent,Se.otherEvent),er&&Lr||er?(Se.type=I,ye.type=Se.inOut===ye.inOut?N:O,er&&!Lr&&rt(Ut[1].otherEvent,Ut[0].point,ot),2):Lr?(rt(Ut[0],Ut[1].point,ot),3):Ut[0]!==Ut[3].otherEvent?(rt(Ut[0],Ut[1].point,ot),rt(Ut[1],Ut[2].point,ot),3):(rt(Ut[0],Ut[1].point,ot),rt(Ut[3].otherEvent,Ut[2].point,ot),3)}function rr(ye,Se){if(ye===Se)return 0;if(_t(ye.point,ye.otherEvent.point,Se.point)!==0||_t(ye.point,ye.otherEvent.point,Se.otherEvent.point)!==0)return Q(ye.point,Se.point)?ye.isBelow(Se.otherEvent.point)?-1:1:ye.point[0]===Se.point[0]?ye.point[1]<Se.point[1]?-1:1:et(ye,Se)===1?Se.isAbove(ye.point)?-1:1:ye.isBelow(Se.point)?-1:1;if(ye.isSubject!==Se.isSubject)return ye.isSubject?-1:1;var ot=ye.point,Lt=Se.point;return ot[0]===Lt[0]&&ot[1]===Lt[1]?(ot=ye.otherEvent.point)[0]===(Lt=Se.otherEvent.point)[0]&&ot[1]===Lt[1]?0:ye.contourId>Se.contourId?1:-1:et(ye,Se)===1?1:-1}var $t=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function At(ye,Se,ot,Lt){var Gt,Ut=ye+1,er=Se[ye].point,Lr=Se.length;for(Ut<Lr&&(Gt=Se[Ut].point);Ut<Lr&&Gt[0]===er[0]&&Gt[1]===er[1];){if(!ot[Ut])return Ut;++Ut<Lr&&(Gt=Se[Ut].point)}for(Ut=ye-1;ot[Ut]&&Ut>Lt;)Ut--;return Ut}$t.prototype.isExterior=function(){return this.holeOf==null};var Gr=nr,tr=nr;function nr(ye,Se){if(!(this instanceof nr))return new nr(ye,Se);if(this.data=ye||[],this.length=this.data.length,this.compare=Se||jr,this.length>0)for(var ot=(this.length>>1)-1;ot>=0;ot--)this._down(ot)}function jr(ye,Se){return ye<Se?-1:ye>Se?1:0}nr.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var Se=this.data,ot=this.compare,Lt=Se[ye];ye>0;){var Gt=ye-1>>1,Ut=Se[Gt];if(ot(Lt,Ut)>=0)break;Se[ye]=Ut,ye=Gt}Se[ye]=Lt},_down:function(ye){for(var Se=this.data,ot=this.compare,Lt=this.length>>1,Gt=Se[ye];ye<Lt;){var Ut=1+(ye<<1),er=Ut+1,Lr=Se[Ut];if(er<this.length&&ot(Se[er],Lr)<0&&(Ut=er,Lr=Se[er]),ot(Lr,Gt)>=0)break;Se[ye]=Lr,ye=Ut}Se[ye]=Gt}},Gr.default=tr;var rn=Math.max,Kr=Math.min,hn=0;function sn(ye,Se,ot,Lt,Gt,Ut){var er,Lr,yn,_n,on,Kn;for(er=0,Lr=ye.length-1;er<Lr;er++)if(_n=ye[er+1],on=new de(yn=ye[er],!1,void 0,Se),Kn=new de(_n,!1,on,Se),on.otherEvent=Kn,yn[0]!==_n[0]||yn[1]!==_n[1]){on.contourId=Kn.contourId=ot,Ut||(on.isExteriorRing=!1,Kn.isExteriorRing=!1),et(on,Kn)>0?Kn.left=!0:on.left=!0;var gi=yn[0],xn=yn[1];Gt[0]=Kr(Gt[0],gi),Gt[1]=Kr(Gt[1],xn),Gt[2]=rn(Gt[2],gi),Gt[3]=rn(Gt[3],xn),Lt.push(on),Lt.push(Kn)}}var dn=[];function qn(ye,Se,ot){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof Se[0][0][0]=="number"&&(Se=[Se]);var Lt=function(xn,qi,Ti){var Wn=null;return xn.length*qi.length==0&&(Ti===L?Wn=dn:Ti===H?Wn=xn:Ti!==V&&Ti!==X||(Wn=xn.length===0?qi:xn)),Wn}(ye,Se,ot);if(Lt)return Lt===dn?null:Lt;var Gt=[1/0,1/0,-1/0,-1/0],Ut=[1/0,1/0,-1/0,-1/0],er=function(xn,qi,Ti,Wn,Qi){var Ai,yi,Ei,ei,cn,ii,Wi=new Gr(null,et);for(Ei=0,ei=xn.length;Ei<ei;Ei++)for(cn=0,ii=(Ai=xn[Ei]).length;cn<ii;cn++)(yi=cn===0)&&hn++,sn(Ai[cn],!0,hn,Wi,Ti,yi);for(Ei=0,ei=qi.length;Ei<ei;Ei++)for(cn=0,ii=(Ai=qi[Ei]).length;cn<ii;cn++)yi=cn===0,Qi===H&&(yi=!1),yi&&hn++,sn(Ai[cn],!1,hn,Wi,Wn,yi);return Wi}(ye,Se,Gt,Ut,ot);if(Lt=function(xn,qi,Ti,Wn,Qi){var Ai=null;return(Ti[0]>Wn[2]||Wn[0]>Ti[2]||Ti[1]>Wn[3]||Wn[1]>Ti[3])&&(Qi===L?Ai=dn:Qi===H?Ai=xn:Qi!==V&&Qi!==X||(Ai=xn.concat(qi))),Ai}(ye,Se,Gt,Ut,ot))return Lt===dn?null:Lt;for(var Lr=function(xn){var qi,Ti,Wn=function(Ei){var ei,cn,ii,Wi,Pr=[];for(cn=0,ii=Ei.length;cn<ii;cn++)((ei=Ei[cn]).left&&ei.inResult||!ei.left&&ei.otherEvent.inResult)&&Pr.push(ei);for(var Mn=!1;!Mn;)for(Mn=!0,cn=0,ii=Pr.length;cn<ii;cn++)cn+1<ii&&et(Pr[cn],Pr[cn+1])===1&&(Wi=Pr[cn],Pr[cn]=Pr[cn+1],Pr[cn+1]=Wi,Mn=!1);for(cn=0,ii=Pr.length;cn<ii;cn++)(ei=Pr[cn]).otherPos=cn;for(cn=0,ii=Pr.length;cn<ii;cn++)(ei=Pr[cn]).left||(Wi=ei.otherPos,ei.otherPos=ei.otherEvent.otherPos,ei.otherEvent.otherPos=Wi);return Pr}(xn),Qi={},Ai=[],yi=function(){if(!Qi[qi]){var Ei=Ai.length,ei=function(Pr,Mn,Ii){var Xi=new $t;if(Pr.prevInResult!=null){var Oi=Pr.prevInResult,Ss=Oi.outputContourId;if(Oi.resultTransition>0){var li=Mn[Ss];if(li.holeOf!=null){var gs=li.holeOf;Mn[gs].holeIds.push(Ii),Xi.holeOf=gs,Xi.depth=Mn[Ss].depth}else Mn[Ss].holeIds.push(Ii),Xi.holeOf=Ss,Xi.depth=Mn[Ss].depth+1}else Xi.holeOf=null,Xi.depth=Mn[Ss].depth}else Xi.holeOf=null,Xi.depth=0;return Xi}(Wn[qi],Ai,Ei),cn=function(Pr){Qi[Pr]=!0,Pr<Wn.length&&Wn[Pr]&&(Wn[Pr].outputContourId=Ei)},ii=qi,Wi=qi;for(ei.points.push(Wn[qi].point);cn(ii),cn(ii=Wn[ii].otherPos),ei.points.push(Wn[ii].point),!((ii=At(ii,Wn,Qi,Wi))==Wi||ii>=Wn.length)&&Wn[ii];);Ai.push(ei)}};for(qi=0,Ti=Wn.length;qi<Ti;qi++)yi();return Ai}(function(xn,qi,Ti,Wn,Qi,Ai){for(var yi,Ei,ei,cn=new d(rr),ii=[],Wi=Math.min(Wn[2],Qi[2]);xn.length!==0;){var Pr=xn.pop();if(ii.push(Pr),Ai===L&&Pr.point[0]>Wi||Ai===H&&Pr.point[0]>Wn[2])break;if(Pr.left){Ei=yi=cn.insert(Pr),yi=yi!==(ei=cn.minNode())?cn.prev(yi):null,Ei=cn.next(Ei);var Mn=yi?yi.key:null;if(te(Pr,Mn,Ai),Ei&&yr(Pr,Ei.key,xn)===2&&(te(Pr,Mn,Ai),te(Ei.key,Pr,Ai)),yi&&yr(yi.key,Pr,xn)===2){var Ii=yi;te(Mn,(Ii=Ii!==ei?cn.prev(Ii):null)?Ii.key:null,Ai),te(Pr,Mn,Ai)}}else Ei=yi=cn.find(Pr=Pr.otherEvent),yi&&Ei&&(yi=yi!==ei?cn.prev(yi):null,Ei=cn.next(Ei),cn.remove(Pr),Ei&&yi&&yr(yi.key,Ei.key,xn))}return ii}(er,0,0,Gt,Ut,ot)),yn=[],_n=0;_n<Lr.length;_n++){var on=Lr[_n];if(on.isExterior()){for(var Kn=[on.points],gi=0;gi<on.holeIds.length;gi++)Kn.push(Lr[on.holeIds[gi]].points);yn.push(Kn)}}return yn}var Si={UNION:V,DIFFERENCE:H,INTERSECTION:L,XOR:X};o.diff=function(ye,Se){return qn(ye,Se,H)},o.intersection=function(ye,Se){return qn(ye,Se,L)},o.operations=Si,o.union=function(ye,Se){return qn(ye,Se,V)},o.xor=function(ye,Se){return qn(ye,Se,X)},Object.defineProperty(o,"__esModule",{value:!0})})(e)}(0,G2.exports)),G2.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ax(a,e,o,u){const d=[],g=u===0?(y,T,C,I,N,O)=>{y.push(new Ot(O,C+(O-T)/(I-T)*(N-C)))}:(y,T,C,I,N,O)=>{y.push(new Ot(T+(O-C)/(N-C)*(I-T),O))};for(const y of a){const T=[];for(const C of y){if(C.length<=2)continue;const I=[];for(let L=0;L<C.length-1;L++){const V=C[L].x,H=C[L].y,X=C[L+1].x,te=C[L+1].y,ae=u===0?V:H,de=u===0?X:te;ae<e?de>e&&g(I,V,H,X,te,e):ae>o?de<o&&g(I,V,H,X,te,o):I.push(C[L]),de<e&&ae>=e&&g(I,V,H,X,te,e),de>o&&ae<=o&&g(I,V,H,X,te,o)}let N=C[C.length-1];const O=u===0?N.x:N.y;O>=e&&O<=o&&I.push(N),I.length&&(N=I[I.length-1],I[0].x===N.x&&I[0].y===N.y||I.push(I[0]),T.push(I))}T.length&&d.push(T)}return d}function hz(a,e){const o=K1(a),u=K1([e]),d=q2.intersection(o,u);return d==null?[]:W2(d)}function dz(a,e){let u=K1(a,65536);for(;e.valid();e.next()){const[d,g]=e.get(),y=d.x*65536,T=d.y*65536,C=g.x*65536,I=g.y*65536,N=C-y,O=I-T,L=Math.hypot(N,O),V=Math.trunc(O/L*3),H=-Math.trunc(N/L*3);u=q2.diff(u,[[[y,T],[C,I],[C+V,I+H],[y+V,T+H],[y,T]]])}return W2(u,1/65536)}function K1(a,e=1){return[a.map(o=>o.map(u=>[u.x*e,u.y*e]))]}function W2(a,e=1){return a.map(o=>o.map((u,d)=>{const g=u.map(y=>new Ot(y[0]*e,y[1]*e).round());return d>0&&g.reverse(),g}))}class Y1{constructor(e,o){this.layoutVertexArray=new Hl,this.indexArray=new Rs,this.lineIndexArray=new yc,this.triangleSegments=new si,this.lineSegments=new si,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new mc)}update(e,o,u,d,g,y,T,C){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KL.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,YL.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,o,u,d,g,y,T){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,d,g,y,void 0,T)}}class J1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Y1(e,!1),this.elevationBufferData=new Y1(e,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.hasPattern=Z1("fill",this.layers,this.pixelRatio,o);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:C,index:I,sourceLayerIndex:N}of e){const O=this.layers[0]._featureFilter.needGeometry,L=Bt(T,O);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),L,u))continue;const V=g?g.evaluate(L,{},u,o.availableImages):void 0,H={id:C,properties:T.properties,type:T.type,sourceLayerIndex:N,index:I,geometry:O?L.geometry:qt(T,u,d),patterns:{},sortKey:V};y.push(H)}g&&y.sort((T,C)=>T.sortKey-C.sortKey);for(const T of y){const{geometry:C,index:I,sourceLayerIndex:N}=T;if(this.hasPattern){const O=X1("fill",this.layers,T,this.zoom,this.pixelRatio,o);this.patternFeatures.push(O)}else this.addFeature(T,C,I,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(e[I].feature,C,I,N,this.index)}}update(e,o,u,d,g,y,T){this.bufferData.update(e,o,u,d,g,y,T,this.worldview),this.elevationBufferData.update(e,o,u,d,g,y,T,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,o,u,d,g,y,T,this.worldview)}addFeatures(e,o,u,d,g,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,o,u,d,y,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,o,u,d,g,y=[],T,C){const I=Cx(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,I,d,u,C):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(e,u,g,y,d,T,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,g,y,d,T,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,o,u,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(o,u,d,g,this.worldview))}addElevatedRoadFeature(e,o,u,d,g){const y=new Array,T=Oa.getElevationFeature(e,g);if(!T)return void this.addGeometry(o,this.bufferData);{const I=this.clipPolygonsToTile(o,1);I.length>0&&y.push({polygons:I,elevationFeature:T,elevationTileID:u})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:d};for(const I of y)if(I.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Zl(I.elevationTileID,this.layers,this.zoom,this.lut));const O=I.elevationFeature.isTunnel();let L=0;e.properties.hasOwnProperty(ai)&&(L=+e.properties[ai]);for(const V of I.polygons)this.elevatedStructures.addPortalCandidates(I.elevationFeature.id,V,O,I.elevationFeature,L)}I.elevationFeature.constantHeight==null&&(I.polygons=this.prepareElevatedPolygons(I.polygons,I.elevationFeature,I.elevationTileID));const N=new ws(u,I.elevationTileID);this.addElevatedGeometry(I.polygons,N,I.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,C)}}addElevatedGeometry(e,o,u,d,g,y){const T={elevation:u,elevationSampler:o,bias:d,index:g,featureInfo:y},[C,I]=this.addGeometry(e,this.elevationBufferData,T);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:I}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,I))}addGeometry(e,o,u){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(d=y,g=y));const T=(C,I,N)=>{if(u!=null)if(I.push(C),y!=null)o.elevatedLayoutVertexArray.emplaceBack(y),N.push(y);else{const O=u.elevationSampler.pointElevation(C,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(O),N.push(O),d=Math.min(d,O),g=Math.max(g,O)}};for(const C of e){let I=0;for(const pe of C)I+=pe.length;const N=o.triangleSegments.prepareSegment(I,o.layoutVertexArray,o.indexArray),O=N.vertexLength,L=[],V=[],H=[],X=[],te=[],ae=o.layoutVertexArray.length;for(const pe of C){if(pe.length===0)continue;pe!==C[0]&&V.push(L.length/2);const Q=o.lineSegments.prepareSegment(pe.length,o.layoutVertexArray,o.lineIndexArray),he=Q.vertexLength;u&&te.push(o.layoutVertexArray.length-ae),T(pe[0],H,X),o.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),o.lineIndexArray.emplaceBack(he+pe.length-1,he),L.push(pe[0].x),L.push(pe[0].y);for(let me=1;me<pe.length;me++)T(pe[me],H,X),o.layoutVertexArray.emplaceBack(pe[me].x,pe[me].y),o.lineIndexArray.emplaceBack(he+me-1,he+me),L.push(pe[me].x),L.push(pe[me].y);Q.vertexLength+=pe.length,Q.primitiveLength+=pe.length}const de=Ky(L,V);for(let pe=0;pe<de.length;pe+=3)o.indexArray.emplaceBack(O+de[pe],O+de[pe+1],O+de[pe+2]);if(de.length>0&&u&&this.elevationMode==="hd-road-base"){const pe=u.elevation.isTunnel(),Q=u.elevation.safeArea,he=this.elevatedStructures.addVertices(H,X);this.elevatedStructures.addTriangles(de,he,pe);const me=te.length;if(me>0){for(let _e=0;_e<me-1;_e++)this.elevatedStructures.addRenderableRing(u.index,te[_e]+he,te[_e+1]-te[_e],pe,Q,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,te[me-1]+he,H.length-te[me-1],pe,Q,u.featureInfo)}}N.vertexLength+=I,N.primitiveLength+=de.length/3}return[d,g]}prepareElevatedPolygons(e,o,u){const d=1/Je(u),g=[];for(const y of e){const T=dz(y,new Zo(o,d));g.push(...T)}return g}clipPolygonsToTile(e,o){const u=-o,d=-o,g=jt+o,y=jt+o;let T=0;const C=[],I=[];for(;T<e.length;T++){const L=e[T],V=dm(L);(V.min.x>=u&&V.max.x<=g&&V.min.y>=d&&V.max.y<=y?C:I).push(L)}if(C.length===e.length)return e;const N=[new Ot(u,d),new Ot(g,d),new Ot(g,y),new Ot(u,y),new Ot(u,d)],O=C;for(const L of I)O.push(...hz(L,N));return O}}let Z2,X2,K2,Y2;Zt(J1,"FillBucket",{omit:["layers","patternFeatures"]}),Zt(Y1,"FillBufferData"),Zt(Zl,"ElevatedStructures");class Q1{constructor(e,o,u,d){if(this.triangleCount=o.length/3,this.min=new Ot(0,0),this.max=new Ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[g,y]=[e[0].clone(),e[0].clone()];for(let O=1;O<e.length;++O){const L=e[O];g.x=Math.min(g.x,L.x),g.y=Math.min(g.y,L.y),y.x=Math.max(y.x,L.x),y.y=Math.max(y.y,L.y)}if(d){const O=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/d);u=Math.max(u,O)}if(u===0)return;this.min=g,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const C=Math.max(T.x,T.y)/u;this.cellsX=Math.max(1,Math.ceil(T.x/C)),this.cellsY=Math.max(1,Math.ceil(T.y/C)),this.xScale=1/C,this.yScale=1/C;const I=[];for(let O=0;O<this.triangleCount;O++){const L=e[o[3*O+0]].sub(this.min),V=e[o[3*O+1]].sub(this.min),H=e[o[3*O+2]].sub(this.min),X=od(Math.floor(Math.min(L.x,V.x,H.x)),this.xScale,this.cellsX),te=od(Math.floor(Math.max(L.x,V.x,H.x)),this.xScale,this.cellsX),ae=od(Math.floor(Math.min(L.y,V.y,H.y)),this.yScale,this.cellsY),de=od(Math.floor(Math.max(L.y,V.y,H.y)),this.yScale,this.cellsY),pe=new Ot(0,0),Q=new Ot(0,0),he=new Ot(0,0),me=new Ot(0,0);for(let _e=ae;_e<=de;++_e){pe.y=Q.y=_e*C,he.y=me.y=(_e+1)*C;for(let De=X;De<=te;++De)pe.x=he.x=De*C,Q.x=me.x=(De+1)*C,(Lm(L,V,H,pe,Q,me)||Lm(L,V,H,pe,me,he))&&I.push({cellIdx:_e*this.cellsX+De,triIdx:O})}}if(I.length===0)return;I.sort((O,L)=>O.cellIdx-L.cellIdx||O.triIdx-L.triIdx);let N=0;for(;N<I.length;){const O=I[N].cellIdx,L={start:this.payload.length,len:0};for(;N<I.length&&I[N].cellIdx===O;)++L.len,this.payload.push(I[N++].triIdx);this.cells[O]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const u=od(e.x-this.min.x,this.xScale,this.cellsX),d=od(e.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const T=this.payload[g.start+y],C=Math.floor(T/8),I=1<<T%8;if(!(this.lookup[C]&I)&&(this.lookup[C]|=I,o.push(T),o.length===this.triangleCount))return}}}query(e,o,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>o.x||e.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const d=od(e.x-this.min.x,this.xScale,this.cellsX),g=od(o.x-this.min.x,this.xScale,this.cellsX),y=od(e.y-this.min.y,this.yScale,this.cellsY),T=od(o.y-this.min.y,this.yScale,this.cellsY);for(let C=y;C<=T;C++)for(let I=d;I<=g;I++){const N=this.cells[C*this.cellsX+I];if(N)for(let O=0;O<N.len;O++){const L=this.payload[N.start+O],V=Math.floor(L/8),H=1<<L%8;if(!(this.lookup[V]&H)&&(this.lookup[V]|=H,u.push(L),u.length===this.triangleCount))return}}}}function od(a,e,o){return Math.max(0,Math.min(o-1,Math.floor(a*e)))}Zt(Q1,"TriangleGridIndex");class J2{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,o){for(const u of this.footprints)o.push({footprint:u,id:e})}populate(e,o,u,d){const g=[];for(const{feature:y,id:T,index:C,sourceLayerIndex:I}of e){const N=this.layers[0]._featureFilter.needGeometry,O=Bt(y,N);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),O,u))continue;const L={id:T,properties:y.properties,type:y.type,sourceLayerIndex:I,index:C,geometry:N?O.geometry:qt(y,u,d),patterns:{}};g.push(L)}for(const y of g){const{geometry:T,index:C,sourceLayerIndex:I}=y;this.addFeature(y,T,C,u,{},o.availableImages,o.brightness),o.featureIndex.insert(e[C].feature,T,C,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,o,u,d,g,y,T){}destroy(){}addFeature(e,o,u,d,g,y=[],T){for(const C of Cx(o,2)){const I=[],N=[],O=[],L=new Ot(1/0,1/0),V=new Ot(-1/0,-1/0);for(const te of C)if(te.length!==0){te!==C[0]&&O.push(N.length/2);for(let ae=0;ae<te.length;ae++)N.push(te[ae].x),N.push(te[ae].y),I.push(te[ae]),L.x=Math.min(L.x,te[ae].x),L.y=Math.min(L.y,te[ae].y),V.x=Math.max(V.x,te[ae].x),V.y=Math.max(V.y,te[ae].y)}const H=Ky(N,O),X=new Q1(I,H,8,256);this.footprints.push({vertices:I,indices:H,grid:X,min:L,max:V})}}}Zt(J2,"ClipBucket",{omit:["layers"]});const fz=Tn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pz=Tn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),mz=Tn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),gz=Tn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),yz=Tn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),_z=Tn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:xz}=fz,Ix=Number.MAX_SAFE_INTEGER;function Q2(a,e,o,u){return a.order<e||a.order===Ix||!(a.clipMask&o)||function(d,g){return g.length!==0&&g.find(y=>y===d)===void 0}(u,a.clipScope)}function Mx(a,e){return a.x-e.x||a.y-e.y}function eE(a,e){return Mx(a.min,e.min)===0&&Mx(a.max,e.max)===0}function eb(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function tb(a,e){if(a.length!==e.length)return!1;for(let o=0;o<a.length;o++)if(a[o].sourceId!==e[o].sourceId||!eE(a[o],e[o])||a[o].order!==e[o].order||a[o].clipMask!==e[o].clipMask||!qa(a[o].clipScope,e[o].clipScope))return!1;return!0}function tE(a,e,o){const u=1/jt,d=1/(1<<o.canonical.z),g=(e.x*u+o.canonical.x)*d+o.wrap,y=(e.y*u+o.canonical.y)*d;return{min:new Ot((a.x*u+o.canonical.x)*d+o.wrap,(a.y*u+o.canonical.y)*d),max:new Ot(g,y)}}function vz(a,e,o){const u=1<<o.canonical.z,d=((e.x-o.wrap)*u-o.canonical.x)*jt,g=(e.y*u-o.canonical.y)*jt;return{min:new Ot(((a.x-o.wrap)*u-o.canonical.x)*jt,(a.y*u-o.canonical.y)*jt),max:new Ot(d,g)}}function rE(a,e,o,u,d,g,y){const T=a.indices,C=a.vertices,I=[];for(let N=u;N<u+d;N+=3){const O=e[o[N+0]+g],L=e[o[N+1]+g],V=e[o[N+2]+g],H=Math.min(O.x,L.x,V.x),X=Math.max(O.x,L.x,V.x),te=Math.min(O.y,L.y,V.y),ae=Math.max(O.y,L.y,V.y);I.length=0,a.grid.query(new Ot(H,te),new Ot(X,ae),I);for(let de=0;de<I.length;de++){const pe=I[de];if(Lm(C[T[3*pe+0]],C[T[3*pe+1]],C[T[3*pe+2]],O,L,V,y))return!0}}return!1}function nE(a,e,o,u){if(!a||!o)return!1;let d=a.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(o.vertices.length<a.vertices.length)return nE(o,u,a,e);const g=e.canonical,y=u.canonical,T=Math.pow(2,y.z-g.z);d=a.vertices.map(C=>new Ot((C.x+g.x*jt)*T-y.x*jt,(C.y+g.y*jt)*T-y.y*jt))}return rE(o,d,a.indices,0,a.indices.length,0,0)}function iE(a,e,o,u){const d=Math.pow(2,u.z-o.z);return new Ot((a+o.x*jt)*d-u.x*jt,(e+o.y*jt)*d-u.y*jt)}function sE(a,e){const o=[];e.grid.queryPoint(a,o);const u=e.indices,d=e.vertices;for(let g=0;g<o.length;g++){const y=o[g];if(xl([d[u[3*y+0]],d[u[3*y+1]],d[u[3*y+2]]],a))return!0}return!1}const rb=[new Ot(0,0),new Ot(jt,0),new Ot(jt,jt),new Ot(0,jt)];function oE(a,e){const o=[];let u=[];if(!e||a.length<2)return[a];if(a.length===2)return Wl(a[0],a[1],rb)?[a]:[];for(let d=0;d<a.length+2;d++){const g=a[d%a.length],y=a[(d+1)%a.length],T=Wl(d===0?a[a.length-1]:a[(d-1)%a.length],g,rb),C=Wl(g,y,rb),I=T||C;I&&u.push(g),I&&C||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const nb=en.VectorTileFeature.types,bz=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wz=["fill-extrusion-flood-light-ground-radius"],Sz=Math.pow(2,13),Tz=Math.pow(2,15)-1,aE=new Ot(0,1),Sp=2147483648;function t_(a,e,o,u,d,g,y,T){a.emplaceBack((e<<1)+y,(o<<1)+g,(Math.floor(u*Sz)<<1)+d,Math.round(T))}function r_(a,e,o){a.emplaceBack(e.x*jt,e.y*jt,o?1:0)}function kx(a,e,o,u,d,g){a.emplaceBack(e.x,e.y,(o.x<<1)+u,(o.y<<1)+d,g)}function n_(a,e,o){a.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}class lE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class cE{constructor(){this.centroidXY=new Ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class uE{constructor(){this.acc=new Ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,o){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=o.x,e.min.y=e.max.y=o.y)}appendEdge(e,o,u){this.accCount++,this.acc._add(o);let d=!!this.borders;o.x<e.min.x?(e.min.x=o.x,d=!0):o.x>e.max.x&&(e.max.x=o.x,d=!0),o.y<e.min.y?(e.min.y=o.y,d=!0):o.y>e.max.y&&(e.max.y=o.y,d=!0),((o.x===0||o.x===jt)&&o.x===u.x)!=((o.y===0||o.y===jt)&&o.y===u.y)&&this.processBorderOverlap(o,u),d&&this.checkBorderIntersection(o,u)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,Ir(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>jt!=e.x>jt&&this.addBorderIntersection(1,Ir(o.y,e.y,(jt-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,Ir(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>jt!=e.y>jt&&this.addBorderIntersection(3,Ir(o.x,e.x,(jt-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const u=e.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,e.y)}else{const u=e.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new Ot(0,0):new Ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0):0}}function hE(a,e){const o=a.add(e)._unit(),u=Ee(a.x*o.x+a.y*o.y,-1,1);var d,g,y;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*Tz*((g=a).x*(y=e).y-g.y*y.x<0?-1:1)}const Ez=[a=>a.x<0,a=>a.x>jt,a=>a.y<0,a=>a.y>jt];function Cz(a,e,o,u){const d=[4];if(u===0)return d;o._mult(u);const g=a.sub(o),y=e.sub(o),T=[a,e,g,y];for(let C=0;C<4;C++)for(const I of T)if(Ez[C](I)){d.push(C);break}return d}class dE{constructor(e){this.vertexArray=new qu,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut},o=>wz.includes(o)),this._segments=new si,this.hiddenByLandmarkVertexArray=new nf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new si}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,o,u,d=!1){const g=e.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let C;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const I=e[0],N=e[1];C=hE(I.sub(e[g-1])._perp()._unit(),N.sub(I)._perp()._unit())}for(let I=0;I<g;I++){const N=I===g-1?0:I+1,O=e[I],L=e[N],V=e[N===g-1?0:N+1],H=L.sub(O)._perp()._unit(),X=hE(H,V.sub(L)._perp()._unit()),te=C,ae=X;if(ib(O,L,o)||d&&mE(O,o)&&mE(L,o)){C=X;continue}const de=T.vertexLength;kx(this.vertexArray,O,L,1,1,te),kx(this.vertexArray,O,L,1,0,te),kx(this.vertexArray,O,L,0,1,ae),kx(this.vertexArray,O,L,0,0,ae),T.vertexLength+=4;const pe=Cz(O,L,H,u);for(const Q of pe)this._segmentToGroundQuads[y].push({id:de,region:Q}),this._segmentToRegionTriCounts[y][Q]+=2,T.primitiveLength+=2;C=X}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),o=e.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((d,g)=>d.region-g.region);for(let u=0;u<o;u++){const d=this._segmentToGroundQuads[u],g=e[u],y=this._segmentToRegionTriCounts[u];y.reduce((C,I)=>C+I,0);let T=0;for(let C=0;C<=4;C++){const I=y[C];if(I!==0){let N=this.regionSegments[C];N||(N=this.regionSegments[C]=new si);const O={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+T,vertexLength:g.vertexLength,primitiveLength:I};N.get().push(O)}T+=I}for(let C=0;C<d.length;C++){const I=d[C].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,o,u,d,g,y,T){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,o,u,d,g,y,void 0,T)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,pz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,o,u,d,g,y,T,C){this.hasData()&&this.programConfigurations.updatePaintArrays(e,o,u,d,g,y,T,C)}updateHiddenByLandmark(e){if(!this.hasData())return;const o=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const u=e.flags&Sp?1:0;for(let d=e.groundVertexArrayOffset;d<o;++d)this.hiddenByLandmarkVertexArray.emplace(d,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,yz.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const o=this.regionSegments[e];o&&o.destroy()}}}}class Px{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rs,this.footprintVertices=new Hl,this.footprintSegments=[],this.layoutVertexArray=new Yh,this.centroidVertexArray=new of,this.wallVertexArray=new Rm,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut},o=>bz.includes(o)),this.segments=new si,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new dE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.features=[],this.hasPattern=Z1("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Je(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:T,sourceLayerIndex:C}of e){const I=this.layers[0]._featureFilter.needGeometry,N=Bt(g,I);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),N,u))continue;const O={id:y,sourceLayerIndex:C,index:T,geometry:I?N.geometry:qt(g,u,d),properties:g.properties,type:g.type,patterns:{}},L=this.layoutVertexArray.length,V=nb[O.type]==="Polygon";if(this.hasPattern)this.features.push(X1("fill-extrusion",this.layers,O,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const H of O.geometry)for(const X of oE(H,V))this.addFeature(O,[X],T,u,{},o.availableImages,d,o.brightness);else this.addFeature(O,O.geometry,T,u,{},o.availableImages,d,o.brightness);o.featureIndex.insert(g,O.geometry,T,C,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,o,u,d,g,y){for(const T of this.features){const C=nb[T.type]==="Polygon",{geometry:I}=T;if(this.wallMode)for(const N of I)for(const O of oE(N,C))this.addFeature(T,[O],T.index,o,u,d,g,y);else this.addFeature(T,I,T.index,o,u,d,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,o,u,d,g,y,T){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview),this.groundEffect.update(e,o,g,u,d,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xz),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,gz.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,_z.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,mz.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,u,d,g,y,T,C){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,N=[new Ot(0,0),new Ot(jt,jt)],O=T.projection,L=O.name==="globe",V=this.wallMode||nb[e.type]==="Polygon",H=new uE;H.centroidDataIndex=this.centroidData.length;const X=new cE,te=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},d)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},d);let de;if(X.height=ae,X.vertexArrayOffset=this.layoutVertexArray.length,X.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new up),this.wallMode){if(L)return void Hr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;de=function(Oe){const Ve=Oe[0].x===Oe[Oe.length-1].x&&Oe[0].y===Oe[Oe.length-1].y;(function($t){let At=0;const Gr=$t.length;for(let tr=0;tr<Gr;tr++)At+=($t[(tr+1)%Gr].x-$t[tr].x)*($t[(tr+1)%Gr].y+$t[tr].y);return At>=0})(Oe)||(Oe=Oe.reverse());const vt={geometry:[],joinNormals:[],indices:[]},ft=[],xt=[],St=[];let nt=Oe.length;for(;nt>=2&&Oe[nt-1].equals(Oe[nt-2]);)nt--;if(nt<(Ve?3:2))return vt;let _t,et,rt,Mt,Pt,yr=0;for(;yr<nt-1&&Oe[yr].equals(Oe[yr+1]);)yr++;Ve&&(_t=Oe[nt-2],Pt=Oe[yr].sub(_t)._unit()._perp());for(let $t=yr;$t<nt;$t++){if(rt=$t===nt-1?Ve?Oe[yr+1]:void 0:Oe[$t+1],rt&&Oe[$t].equals(rt))continue;Pt&&(Mt=Pt),_t&&(et=_t),_t=Oe[$t],Pt=rt?rt.sub(_t)._unit()._perp():Mt,Mt=Mt||Pt;let At=Mt.add(Pt);At.x===0&&At.y===0||At._unit();const Gr=At.x*Pt.x+At.y*Pt.y,tr=Gr!==0?1/Gr:1/0,nr=Mt.x*Pt.y-Mt.y*Pt.x>0;let jr="miter";const rn=2;jr==="miter"&&tr>rn&&(jr="bevel"),jr==="bevel"&&(tr>100&&(jr="flipbevel"),tr<rn&&(jr="miter"));const Kr=(hn,sn,dn,qn)=>{const Si=new Ot(hn.x,hn.y),ye=new Ot(hn.x,hn.y);Si.x+=sn.x*qn,Si.y+=sn.y*qn,ye.x-=sn.x*Math.max(dn,1),ye.y-=sn.y*Math.max(dn,1),St.push(sn),ft.push(Si),xt.push(ye)};if(jr==="miter")At._mult(tr),Kr(_t,At,0,0);else if(jr==="flipbevel")At=Pt.mult(-1),Kr(_t,At,0,0),Kr(_t,At.mult(-1),0,0);else{const hn=-Math.sqrt(tr*tr-1),sn=nr?hn:0,dn=nr?0:hn;et&&Kr(_t,Mt,sn,dn),rt&&Kr(_t,Pt,sn,dn)}}vt.geometry=[...ft,...xt.reverse(),ft[0]],vt.joinNormals=[...St,...St.reverse(),St[St.length-1]];const rr=vt.geometry.length-1;for(let $t=0;$t<rr/2;$t++)if($t+1<rr/2){let At=$t,Gr=$t+1,tr=rr-1-$t,nr=rr-2-$t;At=At===0?rr-1:At-1,Gr=Gr===0?rr-1:Gr-1,tr=tr===0?rr-1:tr-1,nr=nr===0?rr-1:nr-1,vt.indices.push(tr),vt.indices.push(Gr),vt.indices.push(At),vt.indices.push(tr),vt.indices.push(nr),vt.indices.push(Gr)}return vt}(o[0]),o=[de.geometry]}const pe=(Oe,Ve)=>Oe<(Ve.length-1)/2||Oe===Ve.length-1,Q=this.wallMode?[o]:Cx(o,500);for(let Oe=Q.length-1;Oe>=0;Oe--){const Ve=Q[Oe];(Ve.length===0||(he=Ve[0]).every(tt=>tt.x<=0)||he.every(tt=>tt.x>=jt)||he.every(tt=>tt.y<=0)||he.every(tt=>tt.y>=jt))&&Q.splice(Oe,1)}var he;let me;if(L)me=xE(Q,N,d);else{me=[];for(const Oe of Q)me.push({polygon:Oe,bounds:N})}const _e=V?this.edgeRadius:0,De=_e>0&&this.zoom<17,ke=(Oe,Ve)=>{if(Oe.length===0)return!1;const tt=Oe[Oe.length-1];return Ve.x===tt.x&&Ve.y===tt.y};for(const{polygon:Oe,bounds:Ve}of me){let tt=0,vt=0;for(const nt of Oe)V&&!nt[0].equals(nt[nt.length-1])&&nt.push(nt[0]),vt+=V?nt.length-1:nt.length;const ft=this.segments.prepareSegment((V?5:4)*vt,this.layoutVertexArray,this.indexArray);X.footprintSegIdx<0&&(X.footprintSegIdx=this.footprintSegments.length),X.polygonSegIdx<0&&(X.polygonSegIdx=this.polygonSegments.length);const xt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},St=new lE;if(St.vertexOffset=this.footprintVertices.length,St.indexOffset=3*this.footprintIndices.length,St.ringIndices=[],V){const nt=[],_t=[];tt=ft.vertexLength;for(let rt=0;rt<Oe.length;rt++){const Mt=Oe[rt];Mt.length&&rt!==0&&_t.push(nt.length/2);const Pt=[];let yr,rr;yr=Mt[1].sub(Mt[0])._perp()._unit(),St.ringIndices.push(Mt.length-1);for(let $t=1;$t<Mt.length;$t++){const At=Mt[$t],Gr=Mt[$t===Mt.length-1?1:$t+1],tr=At.clone();if(_e){rr=Gr.sub(At)._perp()._unit();const nr=yr.add(rr)._unit(),jr=_e*Math.min(4,1/(yr.x*nr.x+yr.y*nr.y));tr.x+=jr*nr.x,tr.y+=jr*nr.y,tr.x=Math.round(tr.x),tr.y=Math.round(tr.y),yr=rr}if(!te||_e!==0&&!De||ke(Pt,tr)||Pt.push(tr),t_(this.layoutVertexArray,tr.x,tr.y,0,0,1,1,0),this.wallMode){const nr=pe($t,Mt);r_(this.wallVertexArray,de.joinNormals[$t],!nr)}ft.vertexLength++,this.footprintVertices.emplaceBack(At.x,At.y),nt.push(At.x,At.y),L&&n_(this.layoutVertexExtArray,O.projectTilePoint(tr.x,tr.y,d),O.upVector(d,tr.x,tr.y))}te&&(_e===0||De)&&(Pt.length!==0&&ke(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,Ve,I))}const et=this.wallMode?de.indices:Ky(nt,_t);for(let rt=0;rt<et.length;rt+=3)this.footprintIndices.emplaceBack(St.vertexOffset+et[rt+0],St.vertexOffset+et[rt+1],St.vertexOffset+et[rt+2]),this.indexArray.emplaceBack(tt+et[rt],tt+et[rt+2],tt+et[rt+1]),ft.primitiveLength++;St.indexCount+=et.length,St.vertexCount+=this.footprintVertices.length-St.vertexOffset}for(let nt=0;nt<Oe.length;nt++){const _t=Oe[nt];H.startRing(X,_t[0]);let et=_t.length>4&&gE(_t[_t.length-2],_t[0],_t[1]),rt=_e?Az(_t[_t.length-2],_t[0],_t[1],_e):0;const Mt=[];let Pt,yr,rr;yr=_t[1].sub(_t[0])._perp()._unit();let $t=!0;for(let At=1,Gr=0;At<_t.length;At++){let tr=_t[At-1],nr=_t[At];const jr=_t[At===_t.length-1?1:At+1];if(H.appendEdge(X,nr,tr),ib(nr,tr,Ve)){_e&&(yr=jr.sub(nr)._perp()._unit(),$t=!$t);continue}const rn=nr.sub(tr)._perp(),Kr=rn.x/(Math.abs(rn.x)+Math.abs(rn.y)),hn=rn.y>0?1:0,sn=tr.dist(nr);if(Gr+sn>32768&&(Gr=0),_e){rr=jr.sub(nr)._perp()._unit();let ye=pE(tr,nr,jr,fE(yr,rr),_e);isNaN(ye)&&(ye=0);const Se=nr.sub(tr)._unit();tr=tr.add(Se.mult(rt))._round(),nr=nr.add(Se.mult(-ye))._round(),rt=ye,yr=rr,te&&this.zoom>=17&&(ke(Mt,tr)||Mt.push(tr),ke(Mt,nr)||Mt.push(nr))}const dn=ft.vertexLength,qn=_t.length>4&&gE(tr,nr,jr);let Si=yE(Gr,et,$t);if(t_(this.layoutVertexArray,tr.x,tr.y,Kr,hn,0,0,Si),t_(this.layoutVertexArray,tr.x,tr.y,Kr,hn,0,1,Si),this.wallMode){const ye=pe(At-1,_t),Se=de.joinNormals[At-1];r_(this.wallVertexArray,Se,ye),r_(this.wallVertexArray,Se,ye)}if(Gr+=sn,Si=yE(Gr,qn,!$t),et=qn,t_(this.layoutVertexArray,nr.x,nr.y,Kr,hn,0,0,Si),t_(this.layoutVertexArray,nr.x,nr.y,Kr,hn,0,1,Si),this.wallMode){const ye=pe(At,_t),Se=de.joinNormals[At];r_(this.wallVertexArray,Se,ye),r_(this.wallVertexArray,Se,ye)}if(ft.vertexLength+=4,this.indexArray.emplaceBack(dn+0,dn+1,dn+2),this.indexArray.emplaceBack(dn+1,dn+3,dn+2),ft.primitiveLength+=2,_e){const ye=tt+(At===1?_t.length-2:At-2),Se=At===1?tt:ye+1;if(this.indexArray.emplaceBack(dn+1,ye,dn+3),this.indexArray.emplaceBack(ye,Se,dn+3),ft.primitiveLength+=2,Pt===void 0&&(Pt=dn),!ib(jr,_t[At],Ve)){const ot=At===_t.length-1?Pt:ft.vertexLength;this.indexArray.emplaceBack(dn+2,dn+3,ot),this.indexArray.emplaceBack(dn+3,ot+1,ot),this.indexArray.emplaceBack(dn+3,Se,ot+1),ft.primitiveLength+=3}$t=!$t}if(L){const ye=this.layoutVertexExtArray,Se=O.projectTilePoint(tr.x,tr.y,d),ot=O.projectTilePoint(nr.x,nr.y,d),Lt=O.upVector(d,tr.x,tr.y),Gt=O.upVector(d,nr.x,nr.y);n_(ye,Se,Lt),n_(ye,Se,Lt),n_(ye,ot,Gt),n_(ye,ot,Gt)}}V&&(tt+=_t.length-1),te&&_e&&this.zoom>=17&&(Mt.length!==0&&ke(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,Ve,I,_e>0))}this.footprintSegments.push(St),xt.triangleCount=this.indexArray.length-xt.triangleArrayOffset,this.polygonSegments.push(xt),++X.footprintSegLen,++X.polygonSegLen}if(X.vertexCount=this.layoutVertexArray.length-X.vertexArrayOffset,X.groundVertexCount=this.groundEffect.vertexArray.length-X.groundVertexArrayOffset,X.vertexCount!==0){if(X.centroidXY=H.borders?aE:this.encodeCentroid(H,X),this.centroidData.push(X),H.borders){this.featuresOnBorder.push(H);const Oe=this.featuresOnBorder.length-1;for(let Ve=0;Ve<H.borders.length;Ve++)H.borders[Ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ve].push(Oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,g,y,d,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,u,g,y,d,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((o,u)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}splitToSubtiles(){const e=[];for(let T=0;T<this.centroidData.length;T++){const C=this.centroidData[T],I=+(C.min.y+C.max.y>jt),N=2*I+(+(C.min.x+C.max.x>jt)^I);for(let O=0;O<C.polygonSegLen;O++){const L=C.polygonSegIdx+O;e.push({centroidIdx:T,subtile:N,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const o=new Rs;e.sort((T,C)=>T.triangleSegmentIdx===C.triangleSegmentIdx?T.subtile-C.subtile:T.triangleSegmentIdx-C.triangleSegmentIdx);let u=0,d=0,g=0;for(const T of e){if(T.triangleSegmentIdx!==u)break;g++}const y=e.length;for(;d!==e.length;){u=e[d].triangleSegmentIdx;let T=0,C=d,I=d;for(let N=C;N<g&&e[N].subtile===T;N++)I++;for(;C!==g;){const N=e[C];T=N.subtile;const O=this.centroidData[N.centroidIdx].min.clone(),L=this.centroidData[N.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=C;H<I;H++){const X=e[H],te=this.polygonSegments[X.polygonSegmentIdx],ae=this.centroidData[X.centroidIdx].min,de=this.centroidData[X.centroidIdx].max,pe=this.indexArray.uint16;for(let Q=te.triangleArrayOffset;Q<te.triangleArrayOffset+te.triangleCount;Q++)o.emplaceBack(pe[3*Q],pe[3*Q+1],pe[3*Q+2]);V.primitiveLength+=te.triangleCount,O.x=Math.min(O.x,ae.x),O.y=Math.min(O.y,ae.y),L.x=Math.max(L.x,de.x),L.y=Math.max(L.y,de.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:O,max:L}),C=I;for(let H=C;H<g&&e[H].subtile===e[C].subtile;H++)I++}d=g;for(let N=d;N<y&&e[N].triangleSegmentIdx===e[d].triangleSegmentIdx;N++)g++}o._trim(),this.indexArray=o}getVisibleSegments(e,o,u){const d=new si;if(this.wallMode){for(const X of this.triangleSubSegments)d.segments.push(X.segment);return d}let g=0,y=0;const T=1<<e.canonical.z;if(o){const X=o.getMinMaxForTile(e);X&&(g=X.min,y=X.max)}y+=this.maxHeight;const C=e.toUnwrapped();let I;const N=[C.canonical.x/T+C.wrap,C.canonical.y/T],O=[(C.canonical.x+1)/T+C.wrap,(C.canonical.y+1)/T],L=(X,te,ae)=>[X[0]*(1-ae[0])+te[0]*ae[0],X[1]*(1-ae[1])+te[1]*ae[1]],V=[],H=[];for(const X of this.triangleSubSegments){V[0]=X.min.x/jt,V[1]=X.min.y/jt,H[0]=X.max.x/jt,H[1]=X.max.y/jt;const te=L(N,O,V),ae=L(N,O,H);if(new Dn([te[0],te[1],g],[ae[0],ae[1],y]).intersectsPrecise(u)===0){I&&(d.segments.push(I),I=void 0);continue}const de=X.segment;I&&I.vertexOffset!==de.vertexOffset&&(d.segments.push(I),I=void 0),I?(I.vertexLength+=de.vertexLength,I.primitiveLength+=de.primitiveLength):I={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&d.segments.push(I),d}encodeCentroid(e,o){const u=e.centroid(),d=o.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),y=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Ot(Ee(u.x,1,jt-1)<<3|g,Ee(u.y,1,jt-1)<<3|y)}encodeBorderCentroid(e){if(!e.borders)return new Ot(0,0);const o=e.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const d=o[0][0]!==u?0:1;return new Ot(6|(o[0][0]!==u?0:65528),(o[d][0]+o[d][1])/2<<3|6)}{const d=o[2][0]!==u?2:3;return new Ot((o[d][0]+o[d][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(e){const o=this.centroidData[e.centroidDataIndex];o.flags&=Sp,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const o=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,d=e.flags&Sp?aE:e.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==d.y||g!==d.x){for(let y=o;y<u;++y)this.centroidVertexArray.emplace(y,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(e.toUnwrapped());if(tb(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-e.canonical.z));for(const C of this.centroidData)if(!(C.flags&Sp||y.min.x>C.max.x||C.min.x>y.max.x||y.min.y>C.max.y||C.min.y>y.max.y))for(let I=0;I<C.footprintSegLen;I++){const N=this.footprintSegments[C.footprintSegIdx+I];if(g.length=0,Iz(this.footprintVertices,N.vertexOffset,N.vertexCount,y.footprintTileId.canonical,e.canonical,g),rE(y.footprint,g,this.footprintIndices.uint16,N.indexOffset,N.indexCount,-N.vertexOffset,-T)){C.flags|=Sp;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,o,u){let d=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let T=0;for(const C of y.ringIndices){for(let I=T,N=C+T-1;I<C+T;N=I++){const O=this.footprintVertices.int16[2*(I+y.vertexOffset)+0],L=this.footprintVertices.int16[2*(I+y.vertexOffset)+1],V=this.footprintVertices.int16[2*(N+y.vertexOffset)+1];L>o!=V>o&&e<(this.footprintVertices.int16[2*(N+y.vertexOffset)+0]-O)*(o-L)/(V-L)+O&&(d=!d)}T=C}}return d}getHeightAtTileCoord(e,o){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(e+jt)*jt+(o+jt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&Sp)}:void 0}for(const y of this.centroidData)e>y.max.x||y.min.x>e||o>y.max.y||y.min.y>o||this.footprintContainsPoint(e,o,y)&&y&&y.height>u&&(u=y.height,this.partLookup[g]=y,d=!!(y.flags&Sp));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[g]=void 0}}function fE(a,e){const o=a.add(e)._unit();return a.x*o.x+a.y*o.y}function Az(a,e,o,u){const d=e.sub(a)._perp()._unit(),g=o.sub(e)._perp()._unit();return pE(a,e,o,fE(d,g),u)}function pE(a,e,o,u,d){const g=Math.sqrt(1-u*u);return Math.min(a.dist(e)/3,e.dist(o)/3,d*g/u)}function ib(a,e,o){return a.x<o[0].x&&e.x<o[0].x||a.x>o[1].x&&e.x>o[1].x||a.y<o[0].y&&e.y<o[0].y||a.y>o[1].y&&e.y>o[1].y}function mE(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function gE(a,e,o){if(a.x<0||a.x>=jt||e.x<0||e.x>=jt||o.x<0||o.x>=jt)return!1;const u=o.sub(e),d=u.perp(),g=a.sub(e);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function yE(a,e,o){const u=e?2|a:-3&a;return o?1|u:-2&u}function _E(){const a=Math.PI/32,e=Math.tan(a),o=ne;return o*Math.sqrt(1+2*e*e)-o}function xE(a,e,o){const u=1<<o.z,d=Re(o.x/u),g=Re((o.x+1)/u),y=Be(o.y/u),T=Be((o.y+1)/u);return function(C,I,N,O,L=0,V){const H=[];if(!C.length||!N||!O)return H;const X=(me,_e)=>{for(const De of me)H.push({polygon:De,bounds:_e})},te=Math.ceil(Math.log2(N)),ae=Math.ceil(Math.log2(O)),de=te-ae,pe=[];for(let me=0;me<Math.abs(de);me++)pe.push(de>0?0:1);for(let me=0;me<Math.min(te,ae);me++)pe.push(0),pe.push(1);let Q=C;if(Q=Ax(Q,I[0].y-L,I[1].y+L,1),Q=Ax(Q,I[0].x-L,I[1].x+L,0),!Q.length)return H;const he=[];for(pe.length?he.push({polygons:Q,bounds:I,depth:0}):X(Q,I);he.length;){const me=he.pop(),_e=me.depth,De=pe[_e],ke=me.bounds[0],Oe=me.bounds[1],Ve=De===0?ke.x:ke.y,tt=De===0?Oe.x:Oe.y,vt=V?V(De,Ve,tt):.5*(Ve+tt),ft=Ax(me.polygons,Ve-L,vt+L,De),xt=Ax(me.polygons,vt-L,tt+L,De);if(ft.length){const St=[ke,new Ot(De===0?vt:Oe.x,De===1?vt:Oe.y)];pe.length>_e+1?he.push({polygons:ft,bounds:St,depth:_e+1}):X(ft,St)}if(xt.length){const St=[new Ot(De===0?vt:ke.x,De===1?vt:ke.y),Oe];pe.length>_e+1?he.push({polygons:xt,bounds:St,depth:_e+1}):X(xt,St)}}return H}(a,e,Math.ceil((g-d)/11.25),Math.ceil((y-T)/11.25),1,(C,I,N)=>{if(C===0)return .5*(I+N);{const O=Be((o.y+I/jt)/u);return(be(.5*(Be((o.y+N/jt)/u)+O))*u-o.y)*jt}})}function Iz(a,e,o,u,d,g){const y=Math.pow(2,u.z-d.z);for(let T=0;T<o;T++){let C=a.int16[2*(T+e)+0],I=a.int16[2*(T+e)+1];C=(C+d.x*jt)*y-u.x*jt,I=(I+d.y*jt)*y-u.y*jt,g.push(new Ot(C,I))}}let vE,bE;Zt(Px,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(cE,"PartData"),Zt(lE,"FootprintSegment"),Zt(uE,"BorderCentroidData"),Zt(dE,"GroundEffect");class $m extends Ot{constructor(e,o,u){super(e,o),this.z=u}}class wE extends $m{constructor(e,o,u,d){super(e,o,u),this.w=d}}function SE(a,e,o,u){const d=o==="x"?"y":"x",g=(u-a[o])/(e[o]-a[o]);a[d]=Math.round(a[d]+(e[d]-a[d])*g),a[o]=u,a.hasOwnProperty("z")&&(a.z=Ir(a.z,e.z,g)),a.hasOwnProperty("w")&&(a.w=Ir(a.w,e.w,g))}function TE(a,e,o,u){const d=o,g=u;for(const y of["x","y"]){let T=a,C=e;T[y]>=C[y]&&(T=e,C=a),T[y]<d&&C[y]>d&&SE(T,C,y,d),T[y]<g&&C[y]>g&&SE(C,T,y,g)}}function Rx(a,e,o,u,d,g){const y=[];for(let T=0;T<a.length;T++){const C=a[T];let I;const N=y.length;let O=0;for(let L=0;L<C.length-1;L++){let V=C[L],H=C[L+1],X=0;const te=O;let ae,de;g&&(X=Math.hypot(H.x-V.x,H.y-V.y),O+=X,ae=V,de=H),V.x<e&&H.x<e||(V.x<e?V=new Ot(e,V.y+(e-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<e&&(H=new Ot(e,V.y+(e-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<o&&H.y<o||(V.y<o?V=new Ot(V.x+(o-V.y)/(H.y-V.y)*(H.x-V.x),o)._round():H.y<o&&(H=new Ot(V.x+(o-V.y)/(H.y-V.y)*(H.x-V.x),o)._round()),V.x>=u&&H.x>=u||(V.x>=u?V=new Ot(u,V.y+(u-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=u&&(H=new Ot(u,V.y+(u-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=d&&H.y>=d||(V.y>=d?V=new Ot(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round():H.y>=d&&(H=new Ot(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round()),I&&V.equals(I[I.length-1])||(I=[V],y.push(I),g&&g.push({progress:{min:te+EE(ae,de,V)*X,max:1},parentIndex:T,prevPoint:ae,nextPoint:de})),I.push(H),g&&(g[g.length-1].progress.max=te+EE(ae,de,H)*X,g[g.length-1].nextPoint=de)))))}if(g&&O>0)for(let L=N;L<y.length;L++)g[L].progress.min/=O,g[L].progress.max/=O}return y}function Mz(a,e,o,u,d){if(a.length<2)return void u.push(a);const g=[];for(;e.valid();){const[I,N]=e.get();for(let O=0;O<a.length-1;O++){const L=a[O],V=a[O+1],H=Om(L,V,I,N);if(H){const[X]=H,te=new Ot(Ir(L.x,V.x,X),Ir(L.y,V.y,X));g.push({t:O+X,distance:0,point:te})}}e.next()}if(g.length===0)return void u.push(a);g.sort((I,N)=>I.t-N.t);let y=0,T=0,C=[];for(u.push(C);y!==a.length;){if(T===g.length){for(;y!==a.length;)C.length!==0&&C[C.length-1].equals(a[y])||C.push(a[y]),y++;break}g[T].t<=y?(C.length!==0&&C[C.length-1].equals(g[T].point)||C.push(g[T].point),Math.trunc(g[T].t),T++):(C.length!==0&&C[C.length-1].equals(a[y])||C.push(a[y]),y++)}}function EE(a,e,o){return a.x!==e.x?(o.x-a.x)/(e.x-a.x):a.y!==e.y?(o.y-a.y)/(e.y-a.y):0}function i_(a,e){return a.x*e.x+a.y*e.y}function CE(a,e){if(a.length===1){let o=0;const u=e[o++];let d;for(;!d||u.equals(d);)if(d=e[o++],!d)return 1/0;for(;o<e.length;o++){const g=e[o],y=a[0],T=d.sub(u),C=g.sub(u),I=y.sub(u),N=i_(T,T),O=i_(T,C),L=i_(C,C),V=i_(I,T),H=i_(I,C),X=N*L-O*O,te=(L*V-O*H)/X,ae=(N*H-O*V)/X,de=u.z*(1-te-ae)+d.z*te+g.z*ae;if(isFinite(de))return de}return 1/0}{let o=1/0;for(const u of e)o=Math.min(o,u.z);return o}}function AE(a,e,o,u,d,g,y,T){const C=y*d.getElevationAt(a,e,!0,!0),I=g[0]!==0,N=I?g[1]===0?y*(g[0]/7-450):y*function(O,L,V){const H=Math.floor(L[0]/8),X=Math.floor(L[1]/8),te=10*(L[0]-8*H),ae=10*(L[1]-8*X),de=O.getElevationAt(H,X,!0,!0),pe=O.getMeterToDEM(V),Q=Math.floor(.5*(te*pe-1)),he=Math.floor(.5*(ae*pe-1)),me=O.tileCoordToPixel(H,X),_e=2*Q+1,De=2*he+1,ke=function(xt,St,nt,_t,et){return[xt.getElevationAtPixel(St,nt,!0),xt.getElevationAtPixel(St+et,nt,!0),xt.getElevationAtPixel(St,nt+et,!0),xt.getElevationAtPixel(St+_t,nt+et,!0)]}(O,me.x-Q,me.y-he,_e,De),Oe=Math.abs(ke[0]-ke[1]),Ve=Math.abs(ke[2]-ke[3]),tt=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),vt=Math.min(.25,.5*pe*(Oe+Ve)/_e),ft=Math.min(.25,.5*pe*tt/De);return de+Math.max(vt*te,ft*ae)}(d,g,T):C;return{base:C+(o===0?-1:o),top:I?Math.max(N+u,C+o+2):C+u}}class kz{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Pz{constructor(){this.tasks={},this.taskQueue=[],Qt(["process"],this),this.invoker=new kz(this.process),this.nextId=0}add(e,o){const u=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:T}){return T=T||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-T:g==="maybePrepare"&&y?400-T:500:200-T:100-T}(o);if(d===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:o,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<o&&(o=g.priority,e=d)}if(e===null)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class IE{constructor(e,o,u){this.target=e,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Pz}send(e,o,u,d,g=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[T]=u);const C=new Set;return this.target.postMessage({id:T,type:e,hasCallback:!!u,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:qo(o,C)},C),{cancel:()=>{u&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const o=e.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(o.mustQueue||Fn(self)){const d=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,o),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,o)}processTask(e,o){if(delete this.cancelCallbacks[e],o.type==="<response>"){const u=this.callbacks[e];delete this.callbacks[e],u&&(o.error?u(Fl(o.error)):u(null,Fl(o.data)))}else{const u=new Set,d=o.hasCallback?(y,T)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:y?qo(y):null,data:qo(T,u)},u)}:()=>{},g=Fl(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,g,d);else if(this.parent.getWorkerSource){const y=o.type.split("."),{source:T,scope:C}=g;this.parent.getWorkerSource(o.sourceMapId,y[0],T,C)[y[1]](g,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var s_={workerUrl:"",workerClass:null,workerParams:void 0};const sb="mapboxgl_preloaded_worker_pool";class Hm{constructor(){this.active={}}acquire(e,o=Hm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(s_.workerClass!=null?new s_.workerClass:new self.Worker(s_.workerUrl,s_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sb]}numActive(){return Object.keys(this.active).length}}Hm.workerCount=2;class Hg{constructor(e,o,u="Worker",d=Hm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ze();const g=this.workerPool.acquire(this.id,d);for(let y=0;y<g.length;y++){const T=new Hg.Actor(g[y],o,this.id);T.name=`${u} ${y}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,o,u){je(this.actors,(d,g)=>{d.send(e,o,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let o_,ob;function Nx(){return o_||(o_=new Hm),o_}Hg.Actor=IE;class Rz{constructor(e){this.module=e}createIntArray(e){const o=new Int32Array(e),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heap32.set(o,u/o.BYTES_PER_ELEMENT),u}createFloatArray(e){const o=new Float32Array(e),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heapF32.set(o,u/o.BYTES_PER_ELEMENT),u}createStringBuffer(e){const o=this.module.malloc(e.length+1);for(let u=0;u<e.length;++u)this.module.heapU8[o+u]=e.charCodeAt(u);return this.module.heapU8[o+e.length]=0,o}readStringBuffer(e){let o="";for(;this.module.heapU8[e]!==0;)o+=String.fromCharCode(this.module.heapU8[e]),++e;return o}setStyle(e){const o=e.entranceColorRgb,u=e.facadeGlazingColorRgb,d=e.roofColorRgb,g=e.wallColorRgb,y=e.normalScale;this.module.setStyle(o[0],o[1],o[2],u[0],u[1],u[2],d[0],d[1],d[2],g[0],g[1],g[2],y[0],y[1],y[2],e.tileToMeters)}setAOOptions(e,o){this.module.setAOOptions(e?1:0,o)}setMetricOptions(e,o){this.module.setMetricOptions(e?1:0,o)}setFacadeOptions(e,o,u){this.module.setFacadeOptions(e,o,u)}generateMesh(e,o){for(const T of e){const C=this.createStringBuffer(T.roofType),I=[0],N=[];for(const V of T.coordinates)if(Array.isArray(V)){for(const H of V)N.push(H.x),N.push(H.y);I.push(N.length)}const O=this.createIntArray(I),L=this.createFloatArray(N);this.module.addFeature(T.id,T.sourceId,T.minHeight,T.height,C,T.roofType.length,L,O,I.length-1),this.module.free(C),this.module.free(O),this.module.free(L)}for(const T of o){let C;C=T.entrances?JSON.parse(T.entrances):[];const I=this.createFloatArray(C),N=[];for(const L of T.coordinates)N.push(L.x),N.push(L.y);const O=this.createFloatArray(N);this.module.addFacade(T.sourceId,T.crossPerc,T.distanceToRoad,I,C.length,O,N.length),this.module.free(I),this.module.free(O)}if(!this.module.generateMesh()){const T=this.module.getLastError();return this.readStringBuffer(T)}const u=this.module.getMeshCount(),d=new Array(u);for(let T=0;T<u;T++){const C=this.module.getPositionsPtr(T),I=this.module.getPositionsLength(T),N=new Float32Array(this.module.heapF32.buffer,C,I),O=this.module.getNormalsPtr(T),L=this.module.getNormalsLength(T),V=new Float32Array(this.module.heapF32.buffer,O,L),H=this.module.getColorsPtr(T),X=this.module.getColorsLength(T),te=new Uint8Array(this.module.heapU8.buffer,H,X),ae=this.module.getAOPtr(T),de=this.module.getAOLength(T),pe=new Float32Array(this.module.heapF32.buffer,ae,de),Q=this.module.getIndicesPtr(T),he=this.module.getIndicesLength(T),me=new Int32Array(this.module.heap32.buffer,Q,he),_e=this.module.getBuildingPart(T),De=this.readStringBuffer(_e);d[T]={positions:N,normals:V,colors:te,ao:pe,indices:me,buildingPart:De}}const g=this.module.getRingCount(),y=[];for(let T=0;T<g;T++){const C=this.module.getRingPtr(T),I=this.module.getRingLength(T),N=new Float32Array(this.module.heapF32.buffer,C,I);y.push(N)}return{meshes:d,modifiedPolygonRings:y}}}let a_,ab,nh,Gg,lb,qg=null,Wg=null,ME=null,cb=null;function kE(){return Fn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ab||Gs.DRACO_URL}function PE(){if(Fn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Gg)return Gg;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Gg=WebAssembly.validate(a)?Gs.MESHOPT_SIMD_URL:Gs.MESHOPT_URL,Gg}const Dx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Nz={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},l_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function RE(a,e,o){const u=o.json.bufferViews.length,d=o.buffers.length;e.bufferView=u,o.json.bufferViews[u]={buffer:d,byteLength:a.byteLength},o.buffers[d]=a}const ub="KHR_draco_mesh_compression";function Dz(a,e){const o=a.extensions&&a.extensions[ub];if(!o)return;const u=new nh.Decoder,d=LE(e,o.bufferView),g=new nh.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=e.json.accessors[a.indices],T=Dx[y.componentType],C=y.count*T.BYTES_PER_ELEMENT,I=nh._malloc(C);T===Uint16Array?u.GetTrianglesUInt16Array(g,C,I):u.GetTrianglesUInt32Array(g,C,I),RE(nh.memory.buffer.slice(I,I+C),y,e),nh._free(I);for(const N of Object.keys(o.attributes)){const O=u.GetAttributeByUniqueId(g,o.attributes[N]),L=e.json.accessors[a.attributes[N]],V=Nz[L.componentType],H=L.count*l_[L.type]*Dx[L.componentType].BYTES_PER_ELEMENT,X=nh._malloc(H);u.GetAttributeDataArrayForAllPoints(g,O,nh[V],H,X),RE(nh.memory.buffer.slice(X,X+H),L,e),nh._free(X)}u.destroy(),g.destroy(),delete a.extensions[ub]}const Ox="EXT_meshopt_compression";function Oz(a,e){if(!a.extensions||!a.extensions[Ox])return;const o=a.extensions[Ox],u=new Uint8Array(e.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),d=new Uint8Array(o.count*o.byteStride);lb.decodeGltfBuffer(d,o.count,o.byteStride,u,o.mode,o.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=d.buffer,delete a.extensions[Ox]}const NE=1179937895,DE=new TextDecoder("utf8");function OE(a,e){return new URL(a,e).href}function Lz(a,e,o,u){return fetch(OE(a.uri,u)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[o]=d})}function LE(a,e){const o=a.json.bufferViews[e];return new Uint8Array(a.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function zz(a,e,o,u){if(a.uri){const d=OE(a.uri,u);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{e.images[o]=g})}if(a.bufferView!==void 0){const d=LE(e,a.bufferView),g=new Blob([d],{type:a.mimeType});return createImageBitmap(g).then(y=>{e.images[o]=y})}}function zE(a,e=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===NE){const N=new Uint32Array(a,e);let O=2;const L=(N[O++]>>2)-3,V=N[O++]>>2;if(O++,u.json=JSON.parse(DE.decode(N.subarray(O,O+V))),O+=V,O<L){const H=N[O++];O++;const X=e+(O<<2);u.buffers[0]=a.slice(X,X+H)}}else u.json=JSON.parse(DE.decode(new Uint8Array(a,e)));const{buffers:d,images:g,meshes:y,extensionsUsed:T,bufferViews:C}=u.json;let I=Promise.resolve();if(d){const N=[];for(let O=0;O<d.length;O++){const L=d[O];L.uri?N.push(Lz(L,u,O,o)):u.buffers[O]||(u.buffers[O]=null)}I=Promise.all(N)}return I.then(()=>{const N=[],O=T&&T.includes(ub),L=T&&T.includes(Ox);if(O&&N.push(function(){if(!nh)return a_??(a_=function(V){let H,X=null;function te(){H=new Uint8Array(X.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const de={a:{a:ae,d:function(pe,Q,he){return H.copyWithin(pe,Q,Q+he)},c:function(pe){const Q=H.length,he=Math.max(pe>>>0,Math.ceil(1.2*Q)),me=Math.ceil((he-Q)/65536);try{return X.grow(me),te(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,de):V.then(pe=>pe.arrayBuffer()).then(pe=>WebAssembly.instantiate(pe,de))).then(pe=>{const{Rb:Q,Qb:he,P:me,T:_e,X:De,Ja:ke,La:Oe,Qa:Ve,Va:tt,Wa:vt,eb:ft,jb:xt,f:St,e:nt,yb:_t,zb:et,Ab:rt,Bb:Mt,Db:Pt,Gb:yr}=pe.instance.exports;X=nt;const rr=(()=>{let $t=0,At=0,Gr=0,tr=0;return nr=>{Gr&&(Q(tr),Q($t),At+=Gr,Gr=$t=0),$t||(At+=128,$t=he(At));const jr=nr.length+7&-8;let rn=$t;jr>=At&&(Gr=jr,rn=tr=he(jr));for(let Kr=0;Kr<nr.length;Kr++)H[rn+Kr]=nr[Kr];return rn}})();return te(),St(),{memory:nt,_free:Q,_malloc:he,Mesh:class{constructor(){this.ptr=me()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=ke()}destroy(){xt(this.ptr)}DecodeArrayToMesh($t,At,Gr){const tr=rr($t),nr=Oe(this.ptr,tr,At,Gr.ptr);return!!De(nr)}GetAttributeByUniqueId($t,At){return{ptr:Ve(this.ptr,$t.ptr,At)}}GetTrianglesUInt16Array($t,At,Gr){tt(this.ptr,$t.ptr,At,Gr)}GetTrianglesUInt32Array($t,At,Gr){vt(this.ptr,$t.ptr,At,Gr)}GetAttributeDataArrayForAllPoints($t,At,Gr,tr,nr){ft(this.ptr,$t.ptr,At.ptr,Gr,tr,nr)}},DT_INT8:_t(),DT_UINT8:et(),DT_INT16:rt(),DT_UINT16:Mt(),DT_UINT32:Pt(),DT_FLOAT32:yr()}})}(fetch(kE())),a_.then(V=>{nh=V,a_=void 0}))}()),L&&N.push(function(){if(lb)return;const V=function(H){let X;const te=WebAssembly.instantiateStreaming(H,{}).then(pe=>{X=pe.instance,X.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:te,supported:!0,decodeGltfBuffer(pe,Q,he,me,_e,De){(function(ke,Oe,Ve,tt,vt,ft,xt){const St=ke.exports.sbrk,nt=tt+3&-4,_t=St(nt*vt),et=St(ft.length),rt=new Uint8Array(ke.exports.memory.buffer);rt.set(ft,et);const Mt=Oe(_t,tt,vt,et,ft.length);if(Mt===0&&xt&&xt(_t,nt,vt),Ve.set(rt.subarray(_t,_t+tt*vt)),St(_t-St(0)),Mt!==0)throw new Error(`Malformed buffer data: ${Mt}`)})(X,X.exports[de[_e]],pe,Q,he,me,X.exports[ae[De]])}}}(fetch(PE()));return V.ready.then(()=>{lb=V})}()),g)for(let V=0;V<g.length;V++)N.push(zz(g[V],u,V,o));return(N.length?Promise.all(N):Promise.resolve()).then(()=>{if(O&&y)for(const{primitives:V}of y)for(const H of V)Dz(H,u);if(L&&y&&C)for(const V of C)Oz(V,u);return u})})}class jE{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,o){}prepare(){return function(){if(cb!=null||ME!=null)return null;if(Wg!=null)return Wg;const e=fetch(Gs.BUILDING_GEN_URL);return Wg=function(o){let u,d,g,y;function T(){u=new Uint8Array(y.buffer),d=new Int32Array(y.buffer),g=new Float32Array(y.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const I=()=>{},N={a:{a:C,f:function(O){const L=u.length,V=Math.max(O>>>0,Math.ceil(1.2*L)),H=Math.ceil((V-L)/65536);try{return y.grow(H),T(),!0}catch{return!1}},g:C,b:I,c:I,d:I,e:I}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,N):o.then(O=>O.arrayBuffer()).then(O=>WebAssembly.instantiate(O,N))).then(O=>{const L=O.instance.exports;return(0,L.g)(),y=L.f,T(),new Rz({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setFacadeOptions:L.k,addFeature:L.l,addFacade:L.m,generateMesh:L.n,getLastError:L.o,getMeshCount:L.p,getPositionsPtr:L.q,getPositionsLength:L.r,getNormalsPtr:L.s,getNormalsLength:L.t,getColorsPtr:L.u,getColorsLength:L.v,getAOPtr:L.w,getAOLength:L.x,getIndicesPtr:L.y,getIndicesLength:L.z,getBuildingPart:L.A,getRingCount:L.B,getRingPtr:L.C,getRingLength:L.D,free:L.E,malloc:L.F,heapU8:u,heap32:d,heapF32:g})})}(e).then(o=>(Wg=null,cb=o,cb)).catch(o=>{Hr("Could not load building-gen"),Wg=null,ME=o}),Wg}()}populate(e,o,u,d){}update(e,o,u,d,g,y,T){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,o){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let FE,BE;Zt(jE,"BuildingBucket",{omit:["layers"]});const jz=Tn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Fz=Tn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Bz}=jz,Vz=Tn([{name:"a_packed",components:3,type:"Float32"}]),{members:Uz}=Vz,$z=Tn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Hz}=$z;class VE{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new wp({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const u=this.getKey(e,o);return this.positions[u]}trim(){const e=this.width,o=this.height=Nt(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,u){const d=[];let g=e.length%2==1?-e[e.length-1]*u:0,y=e[0]*u,T=!0;d.push({left:g,right:y,isDash:T,zeroLength:e[0]===0});let C=e[0];for(let I=1;I<e.length;I++){T=!T;const N=e[I];g=C*u,C+=N,y=C*u,d.push({left:g,right:y,isDash:T,zeroLength:N===0})}return d}addRoundDash(e,o,u){const d=o/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let T=0,C=e[T];for(let I=0;I<this.width;I++){I/C.right>1&&(C=e[++T]);const N=Math.abs(I-C.left),O=Math.abs(I-C.right),L=Math.min(N,O);let V;const H=g/u*(d+1);if(C.isDash){const X=d-Math.abs(H);V=Math.sqrt(L*L+X*X)}else V=d-Math.sqrt(L*L+H*H);this.image.data[y+I]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,o){for(let C=e.length-1;C>=0;--C){const I=e[C],N=e[C+1];I.zeroLength?e.splice(C,1):N&&N.isDash===I.isDash&&(N.left=I.left,e.splice(C,1))}const u=e[0],d=e[e.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,T=e[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=e[++y]);const I=Math.abs(C-T.left),N=Math.abs(C-T.right),O=Math.min(I,N);this.image.data[g+C]=Math.max(0,Math.min(255,(T.isDash?O:-O)+o+128))}}addDash(e,o){const u=this.getKey(e,o);if(this.positions[u])return this.positions[u];const d=o==="round",g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Hr("LineAtlas out of space"),null;e.length===0&&e.push(1);let T=0;for(let N=0;N<e.length;N++)e[N]<0&&(Hr("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),T+=e[N];if(T!==0){const N=this.width/T,O=this.getDashRanges(e,this.width,N);d?this.addRoundDash(O,N,g):this.addRegularDash(O,o==="square"?.5*N:0)}const C=this.nextRow+g;this.nextRow+=y;const I={tl:[C,g],br:[T,0]};return this.positions[u]=I,I}}Zt(VE,"LineAtlas");const Gz=en.VectorTileFeature.types,qz=Math.cos(Math.PI/180*37.5),Wz=Math.cos(Math.PI/180*5);class hb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new cp,this.layoutVertexArray2=new gl,this.patternVertexArray=new gl,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new si,this.maxLineLength=0,this.zOffsetVertexArray=new gl,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:jt/64,this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.hasPattern=Z1("line",this.layers,this.pixelRatio,o);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Je(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),V=L.isConstant()&&!L.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&y==="none"&&Hr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const C=[];for(const{feature:L,id:V,index:H,sourceLayerIndex:X}of e){const te=this.layers[0]._featureFilter.needGeometry,ae=Bt(L,te);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),ae,u))continue;const de=g?g.evaluate(ae,{},u):void 0,pe={id:V,properties:L.properties,type:L.type,sourceLayerIndex:X,index:H,geometry:te?ae.geometry:qt(L,u,d),patterns:{},sortKey:de};C.push(pe)}g&&C.sort((L,V)=>L.sortKey-V.sortKey);const{lineAtlas:I,featureIndex:N}=o,O=this.addConstantDashes(I);for(const L of C){const{geometry:V,index:H,sourceLayerIndex:X}=L;if(O&&this.addFeatureDashes(L,I),this.hasPattern){const te=X1("line",this.layers,L,this.zoom,this.pixelRatio,o);this.patternFeatures.push(te)}else this.addFeature(L,V,H,u,I.positions,o.availableImages,o.brightness,o.elevationFeatures);N.insert(e[H].feature,V,H,X,this.index)}}addConstantDashes(e){let o=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")o=!0;else{const y=g.value,T=d.value;if(!T)continue;e.addDash(T,y)}}return o}addFeatureDashes(e,o){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let T,C;if(g.kind==="constant"){if(T=g.value,!T)continue}else T=g.evaluate({zoom:u},e);C=y.kind==="constant"?y.value:y.evaluate({zoom:u},e),o.addDash(T,C),e.patterns[d.id]=[o.getKey(T,C)]}}update(e,o,u,d,g,y,T,C){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}addFeatures(e,o,u,d,g,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,o,u,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Uz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Hz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Fz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,u,d,g,y,T,C){const I=this.layers[0].layout,N=I.get("line-join").evaluate(e,{}),O=I.get("line-cap").evaluate(e,{}),L=I.get("line-miter-limit"),V=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=I.get("line-z-offset").value;const H=this.layers[0].paint.get("line-width").value;if(H.kind!=="constant"&&H.isLineProgressConstant===!1&&(this.variableWidthValue=H),this.elevationType==="road"){const X=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,o,d,C,N,O,L,V)){const[te,ae]=this.clipRuntimeLinesToTile(o,1);for(let de=0;de<te.length;de++){const pe=te[de],Q=ae[de],he={progress:{min:Q.progress.min,max:Q.progress.max},nextDir:this.computeSegNextDir(Q,pe),prevDir:this.computeSegPrevDir(Q,pe)};this.addLine(pe,e,d,N,O,L,V,he)}this.fillNonElevatedRoadSegment(X)}}else for(const X of o)this.addLine(X,e,d,N,O,L,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,g,y,d,T,void 0,this.worldview)}computeSegNextDir(e,o){return e.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(e,o){return o[1].sub(e.prevPoint).unit()}clipLinesToTile(e,o){return Rx(e,-o,-o,jt+o,jt+o)}clipRuntimeLinesToTile(e,o){const u=[];return[Rx(e,-o,-o,jt+o,jt+o,u),u]}addElevatedRoadFeature(e,o,u,d,g,y,T,C){const I=[],N=Oa.getElevationFeature(e,d);if(N){const O=this.clipLinesToTile(o,1),L=this.prepareElevatedLines(O,N,u);for(const V of L)I.push({geometry:V,elevation:N,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const O of I){const L=this.layoutVertexArray.length;this.addLine(O.geometry,e,u,g,y,T,C);const V=new ws(u,O.elevationTileID);if(O.elevation)for(let H=L;H<this.layoutVertexArray.length;H++){const X=new Ot(this.layoutVertexArray.int16[6*H]>>1,this.layoutVertexArray.int16[6*H+1]>>1),te=V.pointElevation(X,O.elevation,.05);this.updateHeightRange(te),this.zOffsetVertexArray.emplaceBack(te,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(e,o,u){if(o.constantHeight!=null)return e;const d=[],g=1/Je(u);for(const y of e)Mz(y,new Zo(o,g),0,d);return d}fillNonElevatedRoadSegment(e){for(let o=e;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,o,u,d,g,y,T,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I=d==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const N=C&&C.progress.min>0,O=C&&C.progress.max<1;if(this.lineClips){let De={min:this.lineClips.start,max:this.lineClips.end},ke=1;if(C){const tt=this.lineClips.end-this.lineClips.start;De=function(vt,ft,xt){return{min:Bo(vt.min,ft,xt),max:Bo(vt.max,ft,xt)}}(C.progress,{min:0,max:1},De),tt>0&&(ke=(De.max-De.min)/tt)}const Oe=+o.properties.mapbox_clip_feature_len,Ve=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(Oe)||Number.isNaN(Ve)){for(let vt=0;vt<e.length-1;vt++)this.totalDistance+=e[vt].dist(e[vt+1]);const tt=this.totalDistance/(De.max-De.min);this.totalFeatureLength=Number.isFinite(tt)?tt:0,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Oe,this.distance=Ve*ke,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=Gz[o.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let H=0;for(;H<V-1&&e[H].equals(e[H+1]);)H++;if(V<(L?3:2))return;d==="bevel"&&(y=1.05);const X=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let te,ae,de,pe,Q,he,me,_e;C&&C.prevDir&&(he=C.prevDir.perp()),C&&C.nextDir&&(me=C.nextDir.perp()),this.e1=this.e2=-1,L&&(te=e[V-2],Q=e[H].sub(te)._unit()._perp());for(let De=H;De<V;De++){if(de=De===V-1?L?e[H+1]:void 0:e[De+1],de&&e[De].equals(de))continue;Q&&(pe=Q),te&&(ae=te),te=e[De],_e=this.evaluateLineProgressFeatures(ae?ae.dist(te):0),Q=de?de.sub(te)._unit()._perp():pe,pe=pe||Q;const ke=ae&&de;let Oe=ke?d:L||I?"butt":g;const Ve=pe.x*Q.x+pe.y*Q.y;if(I){const et=function(rt){if(rt.patternJoinNone){const Mt=rt.segmentPoints.length/2,Pt=rt.lineSoFar-rt.segmentStart;for(let yr=0;yr<Mt;++yr){const rr=rt.segmentPoints[2*yr+1],$t=Math.round(rt.segmentPoints[2*yr])+.5+.25*rr;rt.patternVertexArray.emplaceBack($t,Pt,rt.segmentStart),rt.patternVertexArray.emplaceBack($t,Pt,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(ke&&Ve<Wz){this.updateDistance(ae,te),this.addCurrentVertex(te,pe,1,1,X,_e),et(this),this.addCurrentVertex(te,Q,-1,-1,X,_e);continue}if(ae){if(!de){this.updateDistance(ae,te),this.addCurrentVertex(te,pe,1,1,X,_e),et(this);continue}Oe="miter"}}let tt=pe.add(Q);tt.x===0&&tt.y===0||tt._unit();const vt=tt.x*Q.x+tt.y*Q.y,ft=vt!==0?1/vt:1/0,xt=2*Math.sqrt(2-2*vt),St=vt<qz&&ae&&de,nt=pe.x*Q.y-pe.y*Q.x>0,_t=this.overscaling<=16?15*jt/(512*this.overscaling):0;if(ke&&Oe==="round"){if(ft<T)Oe="miter";else if(ft<=2){const et=db(te,-10,jt+10);Oe=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(Oe==="miter"&&ft>y&&(Oe="bevel"),Oe==="bevel"&&(ft>2&&(Oe="flipbevel"),ft<y&&(Oe="miter")),ae&&!(Oe==="miter"&&St)&&this.updateDistance(ae,te),Oe==="miter")if(St){const et=te.dist(ae);if(et>2*_t){const Mt=te.sub(te.sub(ae)._mult(_t/et)._round());this.updateDistance(ae,Mt),this.addCurrentVertex(Mt,pe,0,0,X,_e),ae=Mt}this.updateDistance(ae,te),tt._mult(ft),this.addCurrentVertex(te,tt,0,0,X,_e);const rt=te.dist(de);if(rt>2*_t){const Mt=te.add(de.sub(te)._mult(_t/rt)._round());this.updateDistance(te,Mt),this.addCurrentVertex(Mt,Q,0,0,X,_e),te=Mt}}else tt._mult(ft),this.addCurrentVertex(te,tt,0,0,X,_e);else if(Oe==="flipbevel"){if(ft>100)tt=Q.mult(-1);else{const et=ft*pe.add(Q).mag()/pe.sub(Q).mag();tt._perp()._mult(et*(nt?-1:1))}this.addCurrentVertex(te,tt,0,0,X,_e),this.addCurrentVertex(te,tt.mult(-1),0,0,X,_e)}else if(Oe==="bevel"||Oe==="fakeround"){_e!=null&&ae&&this.addCurrentVertex(te,me||pe,-1,-1,X,_e);const et=te.dist(ae)<=2*_t&&Oe!=="bevel",rt=tt.mult(nt?1:-1);rt._mult(ft);const Mt=Q.mult(nt?-1:1),Pt=pe.mult(nt?-1:1),yr=this.evaluateLineProgressFeatures(this.distance);if(_e==null&&(this.addHalfVertex(te,rt.x,rt.y,!1,!nt,0,X,yr),et||this.addHalfVertex(te,rt.x+2*Pt.x,rt.y+2*Pt.y,!1,nt,0,X,yr)),Oe==="fakeround"){const rr=Math.round(180*xt/Math.PI/20);this.addHalfVertex(te,Pt.x,Pt.y,!1,nt,0,X,yr);for(let $t=0;$t<rr;$t++){let At=$t/rr;if(At!==.5){const tr=At-.5;At+=At*tr*(At-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*tr*tr+(.848013+Ve*(.215638*Ve-1.06021)))}const Gr=Mt.sub(Pt)._mult(At)._add(Pt)._unit();this.addHalfVertex(te,Gr.x,Gr.y,!1,nt,0,X,yr)}this.addHalfVertex(te,Mt.x,Mt.y,!1,nt,0,X,yr)}et||_e!=null||this.addHalfVertex(te,rt.x+2*Mt.x,rt.y+2*Mt.y,!1,nt,0,X,yr),_e!=null&&de&&this.addCurrentVertex(te,he||Q,1,1,X,_e)}else if(Oe==="butt")this.addCurrentVertex(te,tt,0,0,X,_e);else if(Oe==="square"){if(!ae){const et=N?0:-1;this.addCurrentVertex(te,tt,et,et,X,_e)}if(this.addCurrentVertex(te,tt,0,0,X,_e),ae){const et=O?0:1;this.addCurrentVertex(te,tt,et,et,X,_e)}}else if(Oe==="round"){if(ae){const et=!ke&&me?me:pe;this.addCurrentVertex(te,et,0,0,X,_e),!ke&&O||this.addCurrentVertex(te,et,1,1,X,_e,!0)}if(de){const et=!ke&&he?he:Q;!ke&&N||this.addCurrentVertex(te,et,-1,-1,X,_e,!0),this.addCurrentVertex(te,et,0,0,X,_e)}}}}addVerticesTo(e,o,u,d,g,y,T,C,I,N){const O=(o.w-e.w)/this.tessellationStep|0;let L=0;const V=this.scaledDistance;if(O>1){this.lineSoFar=e.w;const X=(o.x-e.x)/O,te=(o.y-e.y)/O,ae=(o.z-e.z)/O,de=(o.w-e.w)/O;for(let pe=1;pe<O;++pe){e.x+=X,e.y+=te,e.z+=ae,this.lineSoFar+=de,L+=de;const Q=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(e,u,d,N,!1,T,I,Q),this.addHalfVertex(e,g,y,N,!0,-C,I,Q)}}this.lineSoFar=o.w,this.scaledDistance=V;const H=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,d,N,!1,T,I,H),this.addHalfVertex(o,g,y,N,!0,-C,I,H)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Hr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:o}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(e,o,u,d,g,y,T=!1){const C=o.x+o.y*u,I=o.y-o.x*u,N=o.y*d-o.x,O=-o.y-o.x*d;if(y!=null){const L=this.elevationType==="offset",V=-10,H=jt+10,X=y.zOffset,te=new wE(e.x,e.y,X,this.lineSoFar),ae=!!L&&db(e,V,H),de=this.lineSoFar,pe=this.distance;if(this.currentVertex)if(ae){const Q=this.currentVertexIsOutside,he=this.currentVertex,me=new wE(e.x,e.y,X,this.lineSoFar);if(TE(he,me,V,H),!db(me,V,H)){if(Q){this.e1=this.e2=-1,this.distance-=he.dist(te),this.lineSoFar=he.w;const _e=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,C,I,T,!1,u,g,_e),this.addHalfVertex(he,N,O,T,!0,-d,g,_e),this.prevDistance=this.distance}this.distance=this.prevDistance+he.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(he,me,C,I,N,O,u,d,g,T),this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}}else{const Q=this.currentVertex;if(this.currentVertexIsOutside){TE(Q,te,V,H),this.e1=this.e2=-1,this.distance-=Q.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Q.w;const he=this.evaluateLineProgressFeatures(Q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Q,C,I,T,!1,u,g,he),this.addHalfVertex(Q,N,O,T,!0,-d,g,he),this.prevDistance=this.distance,this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Q,te,C,I,N,O,u,d,g,T)}else ae||(this.addHalfVertex(e,C,I,T,!1,u,g,y),this.addHalfVertex(e,N,O,T,!0,-d,g,y));this.currentVertex=te,this.currentVertexIsOutside=ae,this.lineSoFar=de}else this.addHalfVertex(e,C,I,T,!1,u,g,y),this.addHalfVertex(e,N,O,T,!0,-d,g,y)}addHalfVertex({x:e,y:o},u,d,g,y,T,C,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(o<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const O=Ir(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,O)}const N=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),C.primitiveLength++),y?this.e2=N:this.e1=N,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,o){this.prevDistance=this.distance,this.distance+=e.dist(o),this.updateScaledDistance()}}function db(a,e,o){return a.x<e||a.x>o||a.y<e||a.y>o}let UE,$E;function HE(a,e,o){return e*(jt/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}Zt(hb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const GE=(a,e,o)=>(1-o)*a+o*e;function qE(a,e){return 1/HE(a,1,e.tileZoom)}function WE(a,e,o,u){return a.translatePosMatrix(u||e.tileID.projMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const ZE=a=>{const e=[];XE(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const o=a.paint.get("line-trim-offset");o[0]===0&&o[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return u&&d&&e.push("LINE_JOIN_NONE"),e};function XE(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let fb;const KE=()=>fb||(fb={layout:UE||(UE=new Di({"line-cap":new zt($e.layout_line["line-cap"]),"line-join":new zt($e.layout_line["line-join"]),"line-miter-limit":new Tt($e.layout_line["line-miter-limit"]),"line-round-limit":new Tt($e.layout_line["line-round-limit"]),"line-sort-key":new zt($e.layout_line["line-sort-key"]),"line-z-offset":new zt($e.layout_line["line-z-offset"]),"line-elevation-reference":new Tt($e.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt($e.layout_line["line-cross-slope"]),visibility:new Tt($e.layout_line.visibility),"line-width-unit":new Tt($e.layout_line["line-width-unit"])})),paint:$E||($E=new Di({"line-opacity":new zt($e.paint_line["line-opacity"]),"line-color":new zt($e.paint_line["line-color"]),"line-translate":new Tt($e.paint_line["line-translate"]),"line-translate-anchor":new Tt($e.paint_line["line-translate-anchor"]),"line-width":new zt($e.paint_line["line-width"]),"line-gap-width":new zt($e.paint_line["line-gap-width"]),"line-offset":new zt($e.paint_line["line-offset"]),"line-blur":new zt($e.paint_line["line-blur"]),"line-dasharray":new zt($e.paint_line["line-dasharray"]),"line-pattern":new zt($e.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt($e.paint_line["line-pattern-cross-fade"]),"line-gradient":new pc($e.paint_line["line-gradient"]),"line-trim-offset":new Tt($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt($e.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt($e.paint_line["line-trim-color"]),"line-emissive-strength":new Tt($e.paint_line["line-emissive-strength"]),"line-border-width":new zt($e.paint_line["line-border-width"]),"line-border-color":new zt($e.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},fb);class Zz extends zt{possiblyEvaluate(e,o){return o=new Hn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(e,o)}evaluate(e,o,u,d){return o=Xe({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(e,o,u,d)}}let c_;function YE(a,e){return e>0?e+2*a:a}const Xz=Tn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kz=Tn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Yz=Tn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jz=Tn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Qz=Tn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),ej=Tn([{name:"a_texb",components:2,type:"Uint16"}]),tj=Tn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),rj=Tn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const JE=Tn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nj=Tn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tn([{name:"triangle",components:3,type:"Uint16"}]),Tn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Tn([{type:"Float32",name:"offsetX"}]),Tn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var co=24;function ij(a,e,o){return a.sections.forEach(u=>{u.text=function(d,g,y){const T=g.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?d=d.toLocaleUpperCase():T==="lowercase"&&(d=d.toLocaleLowerCase()),pl.applyArabicShaping&&(d=pl.applyArabicShaping(d)),d}(u.text,e,o)}),a}const u_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function sj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function oj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var QE,pb,eC,mb={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function aj(){return QE||(QE=1,mb.read=function(a,e,o,u,d){var g,y,T=8*d-u-1,C=(1<<T)-1,I=C>>1,N=-7,O=o?d-1:0,L=o?-1:1,V=a[e+O];for(O+=L,g=V&(1<<-N)-1,V>>=-N,N+=T;N>0;g=256*g+a[e+O],O+=L,N-=8);for(y=g&(1<<-N)-1,g>>=-N,N+=u;N>0;y=256*y+a[e+O],O+=L,N-=8);if(g===0)g=1-I;else{if(g===C)return y?NaN:1/0*(V?-1:1);y+=Math.pow(2,u),g-=I}return(V?-1:1)*y*Math.pow(2,g-u)},mb.write=function(a,e,o,u,d,g){var y,T,C,I=8*g-d-1,N=(1<<I)-1,O=N>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=u?0:g-1,H=u?1:-1,X=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,y=N):(y=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-y))<1&&(y--,C*=2),(e+=y+O>=1?L/C:L*Math.pow(2,1-O))*C>=2&&(y++,C/=2),y+O>=N?(T=0,y=N):y+O>=1?(T=(e*C-1)*Math.pow(2,d),y+=O):(T=e*Math.pow(2,O-1)*Math.pow(2,d),y=0));d>=8;a[o+V]=255&T,V+=H,T/=256,d-=8);for(y=y<<d|T,I+=d;I>0;a[o+V]=255&y,V+=H,y/=256,I-=8);a[o+V-H]|=128*X}),mb}function tC(){if(eC)return pb;eC=1,pb=e;var a=aj();function e(Q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Q)?Q:new Uint8Array(Q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var o=4294967296,u=1/o,d=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function g(Q){return Q.type===e.Bytes?Q.readVarint()+Q.pos:Q.pos+1}function y(Q,he,me){return me?4294967296*he+(Q>>>0):4294967296*(he>>>0)+(Q>>>0)}function T(Q,he,me){var _e=he<=16383?1:he<=2097151?2:he<=268435455?3:Math.floor(Math.log(he)/(7*Math.LN2));me.realloc(_e);for(var De=me.pos-1;De>=Q;De--)me.buf[De+_e]=me.buf[De]}function C(Q,he){for(var me=0;me<Q.length;me++)he.writeVarint(Q[me])}function I(Q,he){for(var me=0;me<Q.length;me++)he.writeSVarint(Q[me])}function N(Q,he){for(var me=0;me<Q.length;me++)he.writeFloat(Q[me])}function O(Q,he){for(var me=0;me<Q.length;me++)he.writeDouble(Q[me])}function L(Q,he){for(var me=0;me<Q.length;me++)he.writeBoolean(Q[me])}function V(Q,he){for(var me=0;me<Q.length;me++)he.writeFixed32(Q[me])}function H(Q,he){for(var me=0;me<Q.length;me++)he.writeSFixed32(Q[me])}function X(Q,he){for(var me=0;me<Q.length;me++)he.writeFixed64(Q[me])}function te(Q,he){for(var me=0;me<Q.length;me++)he.writeSFixed64(Q[me])}function ae(Q,he){return(Q[he]|Q[he+1]<<8|Q[he+2]<<16)+16777216*Q[he+3]}function de(Q,he,me){Q[me]=he,Q[me+1]=he>>>8,Q[me+2]=he>>>16,Q[me+3]=he>>>24}function pe(Q,he){return(Q[he]|Q[he+1]<<8|Q[he+2]<<16)+(Q[he+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Q,he,me){for(me=me||this.length;this.pos<me;){var _e=this.readVarint(),De=_e>>3,ke=this.pos;this.type=7&_e,Q(De,he,this),this.pos===ke&&this.skip(_e)}return he},readMessage:function(Q,he){return this.readFields(Q,he,this.readVarint()+this.pos)},readFixed32:function(){var Q=ae(this.buf,this.pos);return this.pos+=4,Q},readSFixed32:function(){var Q=pe(this.buf,this.pos);return this.pos+=4,Q},readFixed64:function(){var Q=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*o;return this.pos+=8,Q},readSFixed64:function(){var Q=ae(this.buf,this.pos)+pe(this.buf,this.pos+4)*o;return this.pos+=8,Q},readFloat:function(){var Q=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Q},readDouble:function(){var Q=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Q},readVarint:function(Q){var he,me,_e=this.buf;return he=127&(me=_e[this.pos++]),me<128?he:(he|=(127&(me=_e[this.pos++]))<<7,me<128?he:(he|=(127&(me=_e[this.pos++]))<<14,me<128?he:(he|=(127&(me=_e[this.pos++]))<<21,me<128?he:function(De,ke,Oe){var Ve,tt,vt=Oe.buf;if(Ve=(112&(tt=vt[Oe.pos++]))>>4,tt<128||(Ve|=(127&(tt=vt[Oe.pos++]))<<3,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<10,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<17,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<24,tt<128)||(Ve|=(1&(tt=vt[Oe.pos++]))<<31,tt<128))return y(De,Ve,ke);throw new Error("Expected varint not more than 10 bytes")}(he|=(15&(me=_e[this.pos]))<<28,Q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Q=this.readVarint();return Q%2==1?(Q+1)/-2:Q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Q=this.readVarint()+this.pos,he=this.pos;return this.pos=Q,Q-he>=12&&d?function(me,_e,De){return d.decode(me.subarray(_e,De))}(this.buf,he,Q):function(me,_e,De){for(var ke="",Oe=_e;Oe<De;){var Ve,tt,vt,ft=me[Oe],xt=null,St=ft>239?4:ft>223?3:ft>191?2:1;if(Oe+St>De)break;St===1?ft<128&&(xt=ft):St===2?(192&(Ve=me[Oe+1]))==128&&(xt=(31&ft)<<6|63&Ve)<=127&&(xt=null):St===3?(tt=me[Oe+2],(192&(Ve=me[Oe+1]))==128&&(192&tt)==128&&((xt=(15&ft)<<12|(63&Ve)<<6|63&tt)<=2047||xt>=55296&&xt<=57343)&&(xt=null)):St===4&&(tt=me[Oe+2],vt=me[Oe+3],(192&(Ve=me[Oe+1]))==128&&(192&tt)==128&&(192&vt)==128&&((xt=(15&ft)<<18|(63&Ve)<<12|(63&tt)<<6|63&vt)<=65535||xt>=1114112)&&(xt=null)),xt===null?(xt=65533,St=1):xt>65535&&(xt-=65536,ke+=String.fromCharCode(xt>>>10&1023|55296),xt=56320|1023&xt),ke+=String.fromCharCode(xt),Oe+=St}return ke}(this.buf,he,Q)},readBytes:function(){var Q=this.readVarint()+this.pos,he=this.buf.subarray(this.pos,Q);return this.pos=Q,he},readPackedVarint:function(Q,he){if(this.type!==e.Bytes)return Q.push(this.readVarint(he));var me=g(this);for(Q=Q||[];this.pos<me;)Q.push(this.readVarint(he));return Q},readPackedSVarint:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSVarint());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSVarint());return Q},readPackedBoolean:function(Q){if(this.type!==e.Bytes)return Q.push(this.readBoolean());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readBoolean());return Q},readPackedFloat:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFloat());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFloat());return Q},readPackedDouble:function(Q){if(this.type!==e.Bytes)return Q.push(this.readDouble());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readDouble());return Q},readPackedFixed32:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFixed32());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFixed32());return Q},readPackedSFixed32:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSFixed32());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSFixed32());return Q},readPackedFixed64:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFixed64());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFixed64());return Q},readPackedSFixed64:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSFixed64());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSFixed64());return Q},skip:function(Q){var he=7&Q;if(he===e.Varint)for(;this.buf[this.pos++]>127;);else if(he===e.Bytes)this.pos=this.readVarint()+this.pos;else if(he===e.Fixed32)this.pos+=4;else{if(he!==e.Fixed64)throw new Error("Unimplemented type: "+he);this.pos+=8}},writeTag:function(Q,he){this.writeVarint(Q<<3|he)},realloc:function(Q){for(var he=this.length||16;he<this.pos+Q;)he*=2;if(he!==this.length){var me=new Uint8Array(he);me.set(this.buf),this.buf=me,this.length=he}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Q){this.realloc(4),de(this.buf,Q,this.pos),this.pos+=4},writeSFixed32:function(Q){this.realloc(4),de(this.buf,Q,this.pos),this.pos+=4},writeFixed64:function(Q){this.realloc(8),de(this.buf,-1&Q,this.pos),de(this.buf,Math.floor(Q*u),this.pos+4),this.pos+=8},writeSFixed64:function(Q){this.realloc(8),de(this.buf,-1&Q,this.pos),de(this.buf,Math.floor(Q*u),this.pos+4),this.pos+=8},writeVarint:function(Q){(Q=+Q||0)>268435455||Q<0?function(he,me){var _e,De;if(he>=0?(_e=he%4294967296|0,De=he/4294967296|0):(De=~(-he/4294967296),4294967295^(_e=~(-he%4294967296))?_e=_e+1|0:(_e=0,De=De+1|0)),he>=18446744073709552e3||he<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),function(ke,Oe,Ve){Ve.buf[Ve.pos++]=127&ke|128,ke>>>=7,Ve.buf[Ve.pos++]=127&ke|128,ke>>>=7,Ve.buf[Ve.pos++]=127&ke|128,ke>>>=7,Ve.buf[Ve.pos++]=127&ke|128,Ve.buf[Ve.pos]=127&(ke>>>=7)}(_e,0,me),function(ke,Oe){var Ve=(7&ke)<<4;Oe.buf[Oe.pos++]|=Ve|((ke>>>=3)?128:0),ke&&(Oe.buf[Oe.pos++]=127&ke|((ke>>>=7)?128:0),ke&&(Oe.buf[Oe.pos++]=127&ke|((ke>>>=7)?128:0),ke&&(Oe.buf[Oe.pos++]=127&ke|((ke>>>=7)?128:0),ke&&(Oe.buf[Oe.pos++]=127&ke|((ke>>>=7)?128:0),ke&&(Oe.buf[Oe.pos++]=127&ke)))))}(De,me)}(Q,this):(this.realloc(4),this.buf[this.pos++]=127&Q|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=127&(Q>>>=7)|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=127&(Q>>>=7)|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=Q>>>7&127))))},writeSVarint:function(Q){this.writeVarint(Q<0?2*-Q-1:2*Q)},writeBoolean:function(Q){this.writeVarint(!!Q)},writeString:function(Q){Q=String(Q),this.realloc(4*Q.length),this.pos++;var he=this.pos;this.pos=function(_e,De,ke){for(var Oe,Ve,tt=0;tt<De.length;tt++){if((Oe=De.charCodeAt(tt))>55295&&Oe<57344){if(!Ve){Oe>56319||tt+1===De.length?(_e[ke++]=239,_e[ke++]=191,_e[ke++]=189):Ve=Oe;continue}if(Oe<56320){_e[ke++]=239,_e[ke++]=191,_e[ke++]=189,Ve=Oe;continue}Oe=Ve-55296<<10|Oe-56320|65536,Ve=null}else Ve&&(_e[ke++]=239,_e[ke++]=191,_e[ke++]=189,Ve=null);Oe<128?_e[ke++]=Oe:(Oe<2048?_e[ke++]=Oe>>6|192:(Oe<65536?_e[ke++]=Oe>>12|224:(_e[ke++]=Oe>>18|240,_e[ke++]=Oe>>12&63|128),_e[ke++]=Oe>>6&63|128),_e[ke++]=63&Oe|128)}return ke}(this.buf,Q,this.pos);var me=this.pos-he;me>=128&&T(he,me,this),this.pos=he-1,this.writeVarint(me),this.pos+=me},writeFloat:function(Q){this.realloc(4),a.write(this.buf,Q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Q){this.realloc(8),a.write(this.buf,Q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Q){var he=Q.length;this.writeVarint(he),this.realloc(he);for(var me=0;me<he;me++)this.buf[this.pos++]=Q[me]},writeRawMessage:function(Q,he){this.pos++;var me=this.pos;Q(he,this);var _e=this.pos-me;_e>=128&&T(me,_e,this),this.pos=me-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(Q,he,me){this.writeTag(Q,e.Bytes),this.writeRawMessage(he,me)},writePackedVarint:function(Q,he){he.length&&this.writeMessage(Q,C,he)},writePackedSVarint:function(Q,he){he.length&&this.writeMessage(Q,I,he)},writePackedBoolean:function(Q,he){he.length&&this.writeMessage(Q,L,he)},writePackedFloat:function(Q,he){he.length&&this.writeMessage(Q,N,he)},writePackedDouble:function(Q,he){he.length&&this.writeMessage(Q,O,he)},writePackedFixed32:function(Q,he){he.length&&this.writeMessage(Q,V,he)},writePackedSFixed32:function(Q,he){he.length&&this.writeMessage(Q,H,he)},writePackedFixed64:function(Q,he){he.length&&this.writeMessage(Q,X,he)},writePackedSFixed64:function(Q,he){he.length&&this.writeMessage(Q,te,he)},writeBytesField:function(Q,he){this.writeTag(Q,e.Bytes),this.writeBytes(he)},writeFixed32Field:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeFixed32(he)},writeSFixed32Field:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeSFixed32(he)},writeFixed64Field:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeFixed64(he)},writeSFixed64Field:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeSFixed64(he)},writeVarintField:function(Q,he){this.writeTag(Q,e.Varint),this.writeVarint(he)},writeSVarintField:function(Q,he){this.writeTag(Q,e.Varint),this.writeSVarint(he)},writeStringField:function(Q,he){this.writeTag(Q,e.Bytes),this.writeString(he)},writeFloatField:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeFloat(he)},writeDoubleField:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeDouble(he)},writeBooleanField:function(Q,he){this.writeVarintField(Q,!!he)}},pb}var Lx=ci(tC());const gb=3;function lj(a,e,o){e.glyphs=[],a===1&&o.readMessage(cj,e)}function cj(a,e,o){if(a===3){const{id:u,bitmap:d,width:g,height:y,left:T,top:C,advance:I}=o.readMessage(uj,{});e.glyphs.push({id:u,bitmap:new wp({width:g+2*gb,height:y+2*gb},d),metrics:{width:g,height:y,left:T,top:C,advance:I}})}else a===4?e.ascender=o.readSVarint():a===5&&(e.descender=o.readSVarint())}function uj(a,e,o){a===1?e.id=o.readVarint():a===2?e.bitmap=o.readBytes():a===3?e.width=o.readVarint():a===4?e.height=o.readVarint():a===5?e.left=o.readSVarint():a===6?e.top=o.readSVarint():a===7&&(e.advance=o.readVarint())}const hj=gb,vl={horizontal:1,vertical:2,horizontalOnly:3};class h_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,o){const u=new h_;return u.scale=e||1,u.fontStack=o,u}static forImage(e){const o=new h_;return o.image=e,o}}class Zg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o,u){const d=new Zg;for(let g=0;g<e.sections.length;g++){const y=e.sections[g];y.image?d.addImageSection(y,u):d.addTextSection(y,o)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(o,u){let d="";for(let g=0;g<o.length;g++){const y=o.charCodeAt(g+1)||null,T=o.charCodeAt(g-1)||null;d+=!u&&(y&&Zd(y)&&!u_[o[g+1]]||T&&Zd(T)&&!u_[o[g-1]])||!u_[o[g]]?o[g]:u_[o[g]]}return d}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&zx[this.text.charCodeAt(u)];u++)e++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&zx[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const u=new Zg;return u.text=this.text.substring(e,o),u.sectionIndex=this.sectionIndex.slice(e,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(h_.forText(e.scale,e.fontStack||o));const u=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(u)}addImageSection(e,o){const u=e.image?e.image.getPrimary():null;if(!u)return void Hr("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(h_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Hr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yb(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X=1){const te=Zg.fromFeature(a,d,X);O===vl.vertical&&te.verticalizePunctuation(L);let ae=[];const de=function(_e,De,ke,Oe,Ve,tt){if(!_e)return[];const vt=[],ft=function(_t,et,rt,Mt,Pt,yr){let rr=0;for(let $t=0;$t<_t.length();$t++){const At=_t.getSection($t);rr+=rC(_t.getCodePoint($t),At,Mt,Pt,et,yr)}return rr/Math.max(1,Math.ceil(rr/rt))}(_e,De,ke,Oe,Ve,tt),xt=_e.text.indexOf("")>=0;let St=0;for(let _t=0;_t<_e.length();_t++){const et=_e.getSection(_t),rt=_e.getCodePoint(_t);if(zx[rt]||(St+=rC(rt,et,Oe,Ve,De,tt)),_t<_e.length()-1){const Mt=!((nt=rt)<11904||!(xr["Bopomofo Extended"](nt)||xr.Bopomofo(nt)||xr["CJK Compatibility Forms"](nt)||xr["CJK Compatibility Ideographs"](nt)||xr["CJK Compatibility"](nt)||xr["CJK Radicals Supplement"](nt)||xr["CJK Strokes"](nt)||xr["CJK Symbols and Punctuation"](nt)||xr["CJK Unified Ideographs Extension A"](nt)||xr["CJK Unified Ideographs"](nt)||xr["Enclosed CJK Letters and Months"](nt)||xr["Halfwidth and Fullwidth Forms"](nt)||xr.Hiragana(nt)||xr["Ideographic Description Characters"](nt)||xr["Kangxi Radicals"](nt)||xr["Katakana Phonetic Extensions"](nt)||xr.Katakana(nt)||xr["Vertical Forms"](nt)||xr["Yi Radicals"](nt)||xr["Yi Syllables"](nt)));(dj[rt]||Mt||et.image)&&vt.push(iC(_t+1,St,ft,vt,fj(rt,_e.getCodePoint(_t+1),Mt&&xt),!1))}}var nt;return sC(iC(_e.length(),St,ft,vt,0,!0))}(te,I,g,e,u,V),{processBidirectionalText:pe,processStyledBidirectionalText:Q}=pl;if(pe&&te.sections.length===1){const _e=pe(te.toString(),de);for(const De of _e){const ke=new Zg;ke.text=De,ke.sections=te.sections;for(let Oe=0;Oe<De.length;Oe++)ke.sectionIndex.push(0);ae.push(ke)}}else if(Q){const _e=Q(te.text,te.sectionIndex,de);for(const De of _e){const ke=new Zg;ke.text=De[0],ke.sectionIndex=De[1],ke.sections=te.sections,ae.push(ke)}}else ae=function(_e,De){const ke=[],Oe=_e.text;let Ve=0;for(const tt of De)ke.push(_e.substring(Ve,tt)),Ve=tt;return Ve<Oe.length&&ke.push(_e.substring(Ve,Oe.length)),ke}(te,de);const he=[],me={positionedLines:he,text:te.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(_e,De,ke,Oe,Ve,tt,vt,ft,xt,St,nt,_t){let et=0,rt=0,Mt=0;const Pt=ft==="right"?1:ft==="left"?0:.5;let yr=!1;for(const nr of Ve){const jr=nr.getSections();for(const rn of jr){if(rn.image)continue;const Kr=De[rn.fontStack];if(Kr&&(yr=Kr.ascender!==void 0&&Kr.descender!==void 0,!yr))break}if(!yr)break}let rr=0;for(const nr of Ve){nr.trim();const jr=nr.getMaxScale(),rn=(jr-1)*co,Kr={positionedGlyphs:[],lineOffset:0};_e.positionedLines[rr]=Kr;const hn=Kr.positionedGlyphs;let sn=0;if(!nr.length()){rt+=tt,++rr;continue}let dn=0,qn=0;for(let ye=0;ye<nr.length();ye++){const Se=nr.getSection(ye),ot=nr.getSectionIndex(ye),Lt=nr.getCodePoint(ye);let Gt=Se.scale,Ut=null,er=null,Lr=null,yn=co,_n=0;xt===vl.vertical&&(($t=Lt)===12312||$t===12313||$t===12316||$t===12540||$t===12448)&&(xt=vl.horizontal);const on=!(xt===vl.horizontal||!nt&&!ep(Lt)||nt&&(zx[Lt]||Rg(Lt)));if(Se.image){const Kn=Oe.get(Se.image.toString());if(!Kn)continue;Lr=Se.image,_e.iconsInText=_e.iconsInText||!0,er=Kn.paddedRect;const gi=Kn.displaySize;Gt=Gt*co/_t,Ut={width:gi[0],height:gi[1],left:0,top:-3,advance:on?gi[1]:gi[0],localGlyph:!1},_n=yr?-Ut.height*Gt:jr*co-17-gi[1]*Gt,yn=Ut.advance;const xn=(on?gi[0]:gi[1])*Gt-co*jr;xn>0&&xn>sn&&(sn=xn)}else{const Kn=ke[Se.fontStack];if(!Kn)continue;Kn[Lt]&&(er=Kn[Lt]);const gi=De[Se.fontStack];if(!gi)continue;const xn=gi.glyphs[Lt];if(!xn)continue;if(Ut=xn.metrics,yn=Lt!==8203?co:0,yr){const qi=gi.ascender!==void 0?Math.abs(gi.ascender):0,Ti=gi.descender!==void 0?Math.abs(gi.descender):0,Wn=(qi+Ti)*Gt;dn<Wn&&(dn=Wn,qn=(qi-Ti)/2*Gt),_n=-qi*Gt}else _n=(jr-Gt)*co-17}on?(_e.verticalizable=!0,hn.push({glyph:Lt,image:Lr,x:et,y:rt+_n,vertical:on,scale:Gt,localGlyph:Ut.localGlyph,fontStack:Se.fontStack,sectionIndex:ot,metrics:Ut,rect:er}),et+=yn*Gt+St):(hn.push({glyph:Lt,image:Lr,x:et,y:rt+_n,vertical:on,scale:Gt,localGlyph:Ut.localGlyph,fontStack:Se.fontStack,sectionIndex:ot,metrics:Ut,rect:er}),et+=Ut.advance*Gt+St)}hn.length!==0&&(Mt=Math.max(et-St,Mt),yr?oC(hn,Pt,sn,qn,tt*jr/2):oC(hn,Pt,sn,0,tt/2)),et=0;const Si=tt*jr+sn;Kr.lineOffset=Math.max(sn,rn),rt+=Si,++rr}var $t;const At=rt,{horizontalAlign:Gr,verticalAlign:tr}=_b(vt);(function(nr,jr,rn,Kr,hn,sn){const dn=(jr-rn)*hn,qn=-sn*Kr;for(const Si of nr)for(const ye of Si.positionedGlyphs)ye.x+=dn,ye.y+=qn})(_e.positionedLines,Pt,Gr,tr,Mt,At),_e.top+=-tr*At,_e.bottom=_e.top+At,_e.left+=-Gr*Mt,_e.right=_e.left+Mt,_e.hasBaseline=yr}(me,e,o,u,ae,y,T,C,O,I,L,H),!function(_e){for(const De of _e)if(De.positionedGlyphs.length!==0)return!1;return!0}(he))return me}const zx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dj={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function rC(a,e,o,u,d,g){if(e.image){const y=u.get(e.image.toString());return y?y.displaySize[0]*e.scale*co/g+d:0}{const y=o[e.fontStack],T=y&&y.glyphs[a];return T?T.metrics.advance*e.scale+d:0}}function nC(a,e,o,u){const d=Math.pow(a-e,2);return u?a<e?d/2:2*d:d+Math.abs(o)*o}function fj(a,e,o){let u=0;return a===10&&(u-=1e4),o&&(u+=150),a!==40&&a!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function iC(a,e,o,u,d,g){let y=null,T=nC(e,o,d,g);for(const C of u){const I=nC(e-C.x,o,d,g)+C.badness;I<=T&&(y=C,T=I)}return{index:a,x:e,priorBreak:y,badness:T}}function sC(a){return a?sC(a.priorBreak).concat(a.index):[]}function _b(a){let e=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function oC(a,e,o,u,d){if(!(e||o||u||d))return;const g=a.length-1,y=a[g],T=(y.x+y.metrics.advance*y.scale)*e;for(let C=0;C<=g;C++)a[C].x-=T,a[C].y+=o+u+d}function aC(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function pj(a,e,o,u){const{horizontalAlign:d,verticalAlign:g}=_b(u),y=o[0]-a.displaySize[0]*d,T=o[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:e,top:T,bottom:T+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function lC(a,e,o,u,d,g){const y=a.imagePrimary;let T;if(y.content){const te=y.content,ae=y.pixelRatio||1;T=[te[0]/ae,te[1]/ae,y.displaySize[0]-te[2]/ae,y.displaySize[1]-te[3]/ae]}const C=e.left*g,I=e.right*g;let N,O,L,V;o==="width"||o==="both"?(V=d[0]+C-u[3],O=d[0]+I+u[1]):(V=d[0]+(C+I-y.displaySize[0])/2,O=V+y.displaySize[0]);const H=e.top*g,X=e.bottom*g;return o==="height"||o==="both"?(N=d[1]+H-u[0],L=d[1]+X+u[2]):(N=d[1]+(H+X-y.displaySize[1])/2,L=N+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:N,right:O,bottom:L,left:V,collisionPadding:T}}function cC(a){return!a.imagePrimary.stretchX}function uC(a){return!a.imagePrimary.stretchY}function hC(a){return{width:a.right-a.left,height:a.bottom-a.top}}const ad=128;function dC(a,e,o){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Hn(a+1,{worldview:o}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=u;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let T=y;for(;T<d.length&&d[T]<a+1;)T++;T=Math.min(d.length-1,T);const C=d[y],I=d[T];return u.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:C,maxZoom:I,minSize:u.evaluate(new Hn(C,{worldview:o})),maxSize:u.evaluate(new Hn(I,{worldview:o})),interpolationType:g}}}function xb(a,{uSize:e,uSizeT:o},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/ad:a.kind==="composite"?Ir(u/ad,d/ad,o):e}function d_(a,e,o=1){let u=0,d=0;if(a.kind==="constant")d=a.layoutSize*o;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:T}=a,C=g?Ee(Zs.interpolationFactor(g,e,y,T),0,1):0;a.kind==="camera"?d=Ir(a.minSize,a.maxSize,C)*o:u=C*o}return{uSizeT:u,uSize:d}}class ff extends Ot{constructor(e,o,u,d,g){super(e,o),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new ff(this.x,this.y,this.z,this.angle,this.segment)}}function fC(a,e,o,u,d){if(e.segment===void 0)return!0;let g=e,y=e.segment+1,T=0;for(;T>-o/2;){if(y--,y<0)return!1;T-=a[y].dist(g),g=a[y]}T+=a[y].dist(a[y+1]),y++;const C=[];let I=0;for(;T<o/2;){const N=a[y],O=a[y+1];if(!O)return!1;let L=a[y-1].angleTo(N)-N.angleTo(O);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:L}),I+=L;T-C[0].distance>u;)I-=C.shift().angleDelta;if(I>d)return!1;y++,T+=N.dist(O)}return!0}function pC(a){let e=0;for(let o=0;o<a.length-1;o++)e+=a[o].dist(a[o+1]);return e}function mC(a,e,o){return a?.6*e*o:0}function gC(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function mj(a,e,o,u,d,g){const y=mC(o,d,g),T=gC(o,u)*g;let C=0;const I=pC(a)/2;for(let N=0;N<a.length-1;N++){const O=a[N],L=a[N+1],V=O.dist(L);if(C+V>I){const H=(I-C)/V,X=Ir(O.x,L.x,H),te=Ir(O.y,L.y,H),ae=new ff(X,te,0,L.angleTo(O),N);return!y||fC(a,ae,T,y,e)?ae:void 0}C+=V}}function gj(a,e,o,u,d,g,y,T,C){const I=mC(u,g,y),N=gC(u,d),O=N*y,L=a[0].x===0||a[0].x===C||a[0].y===0||a[0].y===C;return e-O<e/4&&(e=O+e/4),yC(a,L?e/2*T%e:(N/2+2*g)*y*T%e,e,I,o,O,L,!1,C)}function yC(a,e,o,u,d,g,y,T,C){const I=g/2,N=pC(a);let O=0,L=e-o,V=[];for(let H=0;H<a.length-1;H++){const X=a[H],te=a[H+1],ae=X.dist(te),de=te.angleTo(X);for(;L+o<O+ae;){L+=o;const pe=(L-O)/ae,Q=Ir(X.x,te.x,pe),he=Ir(X.y,te.y,pe);if(Q>=0&&Q<C&&he>=0&&he<C&&L-I>=0&&L+I<=N){const me=new ff(Q,he,0,de,H);u&&!fC(a,me,g,u,d)||V.push(me)}}O+=ae}return T||V.length||y||(V=yC(a,O/2,o,u,d,g,y,!0,C)),V}function _C(a){let e=0,o=0;for(const y of a)e+=y.w*y.h,o=Math.max(o,y.w);a.sort((y,T)=>T.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let d=0,g=0;for(const y of a)for(let T=u.length-1;T>=0;T--){const C=u[T];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===C.w&&y.h===C.h){const I=u.pop();T<u.length&&(u[T]=I)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(u.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:d,h:g,fill:e/(d*g)||0}}Zt(ff,"Anchor");const Gm=1;class f_{static getImagePositionScale(e,o,u){if(o&&e&&e.options&&e.options.transform){const d=e.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(e,o,u,d){this.paddedRect=e;const{pixelRatio:g,version:y,stretchX:T,stretchY:C,content:I,sdf:N,usvg:O}=o;this.pixelRatio=g,this.stretchX=T,this.stretchY=C,this.content=I,this.version=y,this.padding=u,this.sdf=N,this.usvg=O,this.scale=f_.getImagePositionScale(d,O,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function vb(a,e,o){const u=ic.parse(a),d=function(g,y,T=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*T[0])+2*y,h:(g.data?g.data.height:g.height*T[1])+2*y}}(e,o,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new f_(d,e,o,u),imageVariant:u}}class xC{constructor(e,o,u){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(e,d,Gm,y),this.addImages(o,g,2,y);const{w:T,h:C}=_C(y),I=new Do({width:T||1,height:C||1});for(const[N,O]of e.entries()){const L=d.get(N).paddedRect;Do.copy(O.data,I,{x:0,y:0},{x:L.x+Gm,y:L.y+Gm},O.data,u,O.sdf)}for(const[N,O]of o.entries()){const L=g.get(N),V=L.paddedRect;let H=L.padding;const X=V.x+H,te=V.y+H,ae=O.data.width,de=O.data.height;H=H>1?H-1:H,Do.copy(O.data,I,{x:0,y:0},{x:X,y:te},O.data,u),Do.copy(O.data,I,{x:0,y:de-H},{x:X,y:te-H},{width:ae,height:H},u),Do.copy(O.data,I,{x:0,y:0},{x:X,y:te+de},{width:ae,height:H},u),Do.copy(O.data,I,{x:ae-H,y:0},{x:X-H,y:te},{width:H,height:de},u),Do.copy(O.data,I,{x:0,y:0},{x:X+ae,y:te},{width:H,height:de},u),Do.copy(O.data,I,{x:ae-H,y:de-H},{x:X-H,y:te-H},{width:H,height:H},u),Do.copy(O.data,I,{x:0,y:de-H},{x:X+ae,y:te-H},{width:H,height:H},u),Do.copy(O.data,I,{x:0,y:0},{x:X+ae,y:te+de},{width:H,height:H},u),Do.copy(O.data,I,{x:ae-H,y:0},{x:X-H,y:te+de},{width:H,height:H},u)}this.lut=u,this.image=I,this.iconPositions=d,this.patternPositions=g}addImages(e,o,u,d){for(const[g,y]of e.entries()){const{bin:T,imagePosition:C,imageVariant:I}=vb(g,y,u);o.set(g,C),d.push(T),y.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(e,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>e.hasImage(d,u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of e.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=ic.parse(g);if(_o.isEqual(y.id,d)){const T=e.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(g),T,o)}}for(const g of this.patternPositions.keys()){const y=ic.parse(g);if(_o.isEqual(y.id,d)){const T=e.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(g),T,o)}}}}patchUpdatedImage(e,o,u){if(!e||!o||e.version===o.version)return;e.version=o.version;const[d,g]=e.tl,y=e.sdf;if(this.lut||y){const T={width:o.data.width,height:o.data.height},C=new Do(T);Do.copy(o.data,C,{x:0,y:0},{x:0,y:0},T,this.lut,y),u.update(C,{position:{x:d,y:g}})}else u.update(o.data,{position:{x:d,y:g}})}}Zt(f_,"ImagePosition"),Zt(xC,"ImageAtlas");const jx=1e20;function vC(a,e,o,u,d,g,y,T,C){for(let I=e;I<e+u;I++)bC(a,o*g+I,g,d,y,T,C);for(let I=o;I<o+d;I++)bC(a,I*g+e,1,u,y,T,C)}function bC(a,e,o,u,d,g,y){g[0]=0,y[0]=-1e20,y[1]=jx,d[0]=a[e];for(let T=1,C=0,I=0;T<u;T++){d[T]=a[e+T*o];const N=T*T;do{const O=g[C];I=(d[T]-d[O]+N-O*O)/(T-O)/2}while(I<=y[C]&&--C>-1);C++,g[C]=T,y[C]=I,y[C+1]=jx}for(let T=0,C=0;T<u;T++){for(;y[C+1]<T;)C++;const I=g[C],N=T-I;a[e+T*o]=d[I]+N*N}}const ih=2,bb={none:0,ideographs:1,all:2};class Xg{constructor(e,o,u){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,o){this.urls[o]=e}getGlyphs(e,o,u){const d=[],g=this.urls[o]||Gs.GLYPHS_URL;for(const y in e)for(const T of e[y])d.push({stack:y,id:T});je(d,({stack:y,id:T},C)=>{let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=I.glyphs[T];if(N!==void 0)return void C(null,{stack:y,id:T,glyph:N});if(N=this._tinySDF(I,y,T),N)return I.glyphs[T]=N,void C(null,{stack:y,id:T,glyph:N});const O=Math.floor(T/256);if(256*O>65535)return Hr("glyphs > 65535 not supported"),void C(null,{stack:y,id:T,glyph:N});if(I.ranges[O])return void C(null,{stack:y,id:T,glyph:N});let L=I.requests[O];L||(L=I.requests[O]=[],Xg.loadGlyphRange(y,O,g,this.requestManager,(V,H)=>{if(H){I.ascender=H.ascender,I.descender=H.descender;for(const X in H.glyphs)this._doesCharSupportLocalGlyph(+X)||(I.glyphs[+X]=H.glyphs[+X]);I.ranges[O]=!0}for(const X of L)X(V,H);delete I.requests[O]})),L.push((V,H)=>{V?C(V):H&&C(null,{stack:y,id:T,glyph:H.glyphs[T]||null})})},(y,T)=>{if(y)u(y);else if(T){const C={};for(const{stack:I,id:N,glyph:O}of T)C[I]===void 0&&(C[I]={}),C[I].glyphs===void 0&&(C[I].glyphs={}),C[I].glyphs[N]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},C[I].ascender=this.entries[I].ascender,C[I].descender=this.entries[I].descender;u(null,C)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==bb.none&&(this.localGlyphMode===bb.all?!!this.localFontFamily:!!this.localFontFamily&&(xr["CJK Unified Ideographs"](e)||xr["Hangul Syllables"](e)||xr.Hiragana(e)||xr.Katakana(e)||xr["CJK Symbols and Punctuation"](e)||xr["CJK Unified Ideographs Extension A"](e)||xr["CJK Unified Ideographs Extension B"](e)||xr.Osage(e)))}_tinySDF(e,o,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let X="400";/bold/i.test(o)?X="900":/medium/i.test(o)?X="500":/light/i.test(o)&&(X="200"),g=e.tinySDF=new Xg.TinySDF({fontFamily:d,fontWeight:X,fontSize:24*ih,buffer:3*ih,radius:8*ih}),g.fontWeight=X}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:T,width:C,height:I,glyphWidth:N,glyphHeight:O,glyphLeft:L,glyphTop:V,glyphAdvance:H}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new wp({width:C,height:I},T),metrics:{width:N/ih,height:O/ih,left:L/ih,top:V/ih-27,advance:H/ih,localGlyph:!0}}}}Xg.loadGlyphRange=function(a,e,o,u,d){const g=256*e,y=g+255,T=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),Xa.Glyphs);Td(T,(C,I)=>{if(C)d(C);else if(I){const N={},O=function(L){return new Lx(L).readFields(lj,{})}(I);for(const L of O.glyphs)N[L.id]=L;d(null,{glyphs:N,ascender:O.ascender,descender:O.descender})}})},Xg.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const T=this.size=a+4*e,C=this._createCanvas(T),I=this.ctx=C.getContext("2d",{willReadFrequently:!0});I.font=`${y} ${g} ${a}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.ceil(o),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),C=Math.min(this.size-this.buffer,y+Math.ceil(u)),I=T+2*this.buffer,N=C+2*this.buffer,O=Math.max(I*N,0),L=new Uint8ClampedArray(O),V={data:L,width:I,height:N,glyphWidth:T,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||C===0)return V;const{ctx:H,buffer:X,gridInner:te,gridOuter:ae}=this;H.clearRect(X,X,T,C),H.fillText(a,X,X+y);const de=H.getImageData(X,X,T,C);ae.fill(jx,0,O),te.fill(0,0,O);for(let pe=0;pe<C;pe++)for(let Q=0;Q<T;Q++){const he=de.data[4*(pe*T+Q)+3]/255;if(he===0)continue;const me=(pe+X)*I+Q+X;if(he===1)ae[me]=0,te[me]=jx;else{const _e=.5-he;ae[me]=_e>0?_e*_e:0,te[me]=_e<0?_e*_e:0}}vC(ae,0,0,I,N,I,this.f,this.v,this.z),vC(te,X,X,T,C,I,this.f,this.v,this.z);for(let pe=0;pe<O;pe++){const Q=Math.sqrt(ae[pe])-Math.sqrt(te[pe]);L[pe]=Math.round(255-255*(Q/this.radius+this.cutoff))}return V}};const qm=Gm;function wC(a,e){return a+e[1]-e[0]}function SC(a,e,o,u,d=1){const g=[],y=a.imagePrimary,T=y.pixelRatio,C=y.paddedRect.w-2*qm,I=y.paddedRect.h-2*qm,N=(a.right-a.left)*d,O=(a.bottom-a.top)*d,L=y.stretchX||[[0,C]],V=y.stretchY||[[0,I]],H=L.reduce(wC,0),X=V.reduce(wC,0),te=C-H,ae=I-X;let de=0,pe=H,Q=0,he=X,me=0,_e=te,De=0,ke=ae;if(y.content&&u){const Ve=y.content;de=Fx(L,0,Ve[0]),Q=Fx(V,0,Ve[1]),pe=Fx(L,Ve[0],Ve[2]),he=Fx(V,Ve[1],Ve[3]),me=Ve[0]-de,De=Ve[1]-Q,_e=Ve[2]-Ve[0]-pe,ke=Ve[3]-Ve[1]-he}const Oe=(Ve,tt,vt,ft)=>{const xt=Bx(Ve.stretch-de,pe,N,a.left*d),St=Vx(Ve.fixed-me,_e,Ve.stretch,H),nt=Bx(tt.stretch-Q,he,O,a.top*d),_t=Vx(tt.fixed-De,ke,tt.stretch,X),et=Bx(vt.stretch-de,pe,N,a.left*d),rt=Vx(vt.fixed-me,_e,vt.stretch,H),Mt=Bx(ft.stretch-Q,he,O,a.top*d),Pt=Vx(ft.fixed-De,ke,ft.stretch,X),yr=new Ot(xt,nt),rr=new Ot(et,nt),$t=new Ot(et,Mt),At=new Ot(xt,Mt),Gr=new Ot(St/T,_t/T),tr=new Ot(rt/T,Pt/T),nr=e*Math.PI/180;if(nr){const dn=Math.sin(nr),qn=Math.cos(nr),Si=[qn,-dn,dn,qn];yr._matMult(Si),rr._matMult(Si),At._matMult(Si),$t._matMult(Si)}const jr=Ve.stretch+Ve.fixed,rn=vt.stretch+vt.fixed,Kr=tt.stretch+tt.fixed,hn=ft.stretch+ft.fixed,sn=a.imageSecondary;return{tl:yr,tr:rr,bl:At,br:$t,texPrimary:{x:y.paddedRect.x+qm+jr,y:y.paddedRect.y+qm+Kr,w:rn-jr,h:hn-Kr},texSecondary:sn?{x:sn.paddedRect.x+qm+jr,y:sn.paddedRect.y+qm+Kr,w:rn-jr,h:hn-Kr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gr,pixelOffsetBR:tr,minFontScaleX:_e/T/N,minFontScaleY:ke/T/O,isSDF:o}};if(u&&(y.stretchX||y.stretchY)){const Ve=TC(L,te,H),tt=TC(V,ae,X);for(let vt=0;vt<Ve.length-1;vt++){const ft=Ve[vt],xt=Ve[vt+1];for(let St=0;St<tt.length-1;St++)g.push(Oe(ft,tt[St],xt,tt[St+1]))}}else g.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return g}function Fx(a,e,o){let u=0;for(const d of a)u+=Math.max(e,Math.min(o,d[1]))-Math.max(e,Math.min(o,d[0]));return u}function TC(a,e,o){const u=[{fixed:-1,stretch:0}];for(const[d,g]of a){const y=u[u.length-1];u.push({fixed:d-y.stretch,stretch:y.stretch}),u.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return u.push({fixed:e+qm,stretch:o}),u}function Bx(a,e,o,u){return a/e*o+u}function Vx(a,e,o,u){return a-e*o/u}function yj(a,e,o,u){const d=e+a.positionedLines[u].lineOffset;return u===0?o+d/2:o+(d+(e+a.positionedLines[u-1].lineOffset))/2}function _j(a,e=1,o=!1){let u=1/0,d=1/0,g=-1/0,y=-1/0;const T=a[0];for(let V=0;V<T.length;V++){const H=T[V];(!V||H.x<u)&&(u=H.x),(!V||H.y<d)&&(d=H.y),(!V||H.x>g)&&(g=H.x),(!V||H.y>y)&&(y=H.y)}const C=Math.min(g-u,y-d);let I=C/2;const N=new Ih([],xj);if(C===0)return new Ot(u,d);for(let V=u;V<g;V+=C)for(let H=d;H<y;H+=C)N.push(new Kg(V+I,H+I,I,a));let O=function(V){let H=0,X=0,te=0;const ae=V[0];for(let de=0,pe=ae.length,Q=pe-1;de<pe;Q=de++){const he=ae[de],me=ae[Q],_e=he.x*me.y-me.x*he.y;X+=(he.x+me.x)*_e,te+=(he.y+me.y)*_e,H+=3*_e}return new Kg(X/H,te/H,0,V)}(a),L=N.length;for(;N.length;){const V=N.pop();(V.d>O.d||!O.d)&&(O=V,o&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,L)),V.max-O.d<=e||(I=V.h/2,N.push(new Kg(V.p.x-I,V.p.y-I,I,a)),N.push(new Kg(V.p.x+I,V.p.y-I,I,a)),N.push(new Kg(V.p.x-I,V.p.y+I,I,a)),N.push(new Kg(V.p.x+I,V.p.y+I,I,a)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${O.d}`)),O.p}function xj(a,e){return e.max-a.max}class Kg{constructor(e,o,u,d){this.p=new Ot(e,o),this.h=u,this.d=function(g,y){let T=!1,C=1/0;for(let I=0;I<y.length;I++){const N=y[I];for(let O=0,L=N.length,V=L-1;O<L;V=O++){const H=N[O],X=N[V];H.y>g.y!=X.y>g.y&&g.x<(X.x-H.x)*(g.y-H.y)/(X.y-H.y)+H.x&&(T=!T),C=Math.min(C,vp(g,H,X))}}return(T?1:-1)*Math.sqrt(C)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const vj=Object.keys,wb=Number.POSITIVE_INFINITY,bj=Math.sqrt(2);function EC(a,[e,o]){let u=0,d=0;if(o===wb){e<0&&(e=0);const g=e/bj;switch(a){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),o=Math.abs(o),a){case"top-right":case"top-left":case"top":d=o-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-o}switch(a){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,d]}function Ux(a,e,o,u,d,g,y,T,C){if(!e||!e.usvg)return;const I=hC(u),N=hC(d),O=g!=="both"&&g!=="width"||!cC(u)?1:N.width/I.width,L=g!=="both"&&g!=="height"||!uC(u)?1:N.height/I.height;o.scaleSelf(O,L);const V=o.toString();y.set(V,o),T.set(V,e);const{imagePosition:H}=vb(V,e,Gm);C.set(V,H)}function CC(a,e,o,u,d,g,y,T,C){if(!a)return;const I=function(N,O,L,V,H,X){if(N.kind==="camera")return N.maxSize;if(N.kind==="composite"){const te=O.possiblyEvaluate(new Hn(N.maxZoom,{worldview:X}),L).evaluate(H,{},L),ae=O.possiblyEvaluate(new Hn(N.minZoom,{worldview:X}),L).evaluate(H,{},L);return Math.max(te,ae)}return O.possiblyEvaluate(new Hn(V,{worldview:X})).evaluate(H,{},L)}(e,o,u,d,g,C);return a.scaleSelf(I*T*y)}function AC(a,e,o,u,d,g,y,T,C){return{iconPrimary:CC(a.getPrimary(),e,o,u,d,g,y,T,C),iconSecondary:CC(a.getSecondary(),e,o,u,d,g,y,T,C)}}function wj(a,e,o){if(!e)return;const u=o.get(a.toString()),d=o.get(e.toString());d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||Hr(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),u.usvg!==d.usvg&&Hr(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function IC(a,e,o,u){if(!a)return;const d=e.get(o.toString());if(a.imagePrimary=d,u){const g=e.get(u.toString());a.imageSecondary=g}}function Sj(a,e){for(const o in a.horizontal)MC(a.horizontal[o],e);MC(a.vertical,e)}function MC(a,e){if(a){for(const o of a.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=e.get(d).paddedRect}}}function Sb(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tj(a,e,o,u,d,g,y,T,C){const I=Tb(g.horizontal)||g.vertical,N=o.get("icon-text-fit-padding").evaluate(u,{},d);let O,L=e;return e&&C!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(O=lC(e,g.vertical,C,N,T,y)),I&&(L=lC(e,I,C,N,T,y))),{defaultShapedIcon:L,verticallyShapedIcon:O}}function Ej(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae,de,pe){let Q=y.textMaxSize.evaluate(e,{},L);Q===void 0?Q=T*y.textScaleFactor:Q*=y.textScaleFactor;const he=a.layers[0].layout,me=Tb(o.horizontal)||o.vertical,_e=V.name==="globe",De=co,ke=a.tilePixelRatio*Q/De,Oe=(St=a.overscaling,a.zoom>18&&St>2&&(St>>=1),Math.max(jt/(512*St),1)*he.get("symbol-spacing")),Ve=he.get("text-padding")*a.tilePixelRatio,tt=he.get("icon-padding")*a.tilePixelRatio,vt=Sn(he.get("text-max-angle")),ft=he.get("icon-rotation-alignment")==="map"&&pe!=="point",xt=Oe/2;var St;a.hasAnyIconTextFit===!1&&te!=="none"&&(a.hasAnyIconTextFit=!0);const nt=e.properties?+e.properties[un]:null,_t=nt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(nt):65535,et=(rt,Mt,Pt)=>{if(Mt.x<0||Mt.x>=jt||Mt.y<0||Mt.y>=jt)return;let yr=null;if(_e){const{x:rr,y:$t,z:At}=V.projectTilePoint(Mt.x,Mt.y,Pt);yr={anchor:new ff(rr,$t,At,0,void 0),up:V.upVector(Pt,Mt.x,Mt.y)}}(function(rr,$t,At,Gr,tr,nr,jr,rn,Kr,hn,sn,dn,qn,Si,ye,Se,ot,Lt,Gt,Ut,er,Lr,yn,_n,on,Kn,gi,xn,qi){const Ti=rr.addToLineVertexArray($t,Gr);let Wn,Qi,Ai,yi,Ei,ei,cn,ii=0,Wi=0,Pr=0,Mn=0,Ii=-1,Xi=-1;const Oi={};let Ss=Su("");const li=At?At.anchor:$t,gs=xn!=="none";let el=0,Oo=0;if(Kr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ts=Kr.layout.get("text-offset").evaluate(er,{},on);el=Ts[0]*co,Oo=Ts[1]*co}else el=Kr.layout.get("text-radial-offset").evaluate(er,{},on)*co,Oo=wb;if(rr.allowVerticalPlacement&&tr.vertical){const Ts=tr.vertical;if(ye)ei=Eb(Ts),rn&&(cn=Eb(rn));else{const Us=Kr.layout.get("text-rotate").evaluate(er,{},on)+90;Ai=$x(hn,li,$t,sn,dn,qn,Ts,Si,Us,Se),rn&&(yi=$x(hn,li,$t,sn,dn,qn,rn,Lt,Us))}}if(nr){const Ts=rr.iconSizeData,Us=Kr.layout.get("icon-rotate").evaluate(er,{},on),Lo=SC(nr,Us,yn,gs,Lr.iconScaleFactor),ma=rn?SC(rn,Us,yn,gs,Lr.iconScaleFactor):void 0;Qi=$x(hn,li,$t,sn,dn,qn,nr,Lt,Us,null),ii=4*Lo.length;let Yo=null;Ts.kind==="source"?(Yo=[ad*Kr.layout.get("icon-size").evaluate(er,{},on)*Lr.iconScaleFactor],Yo[0]>Tp&&Hr(`${rr.layerIds[0]}: Value for "icon-size" is >= ${p_}. Reduce your "icon-size".`)):Ts.kind==="composite"&&(Yo=[ad*Lr.compositeIconSizes[0].evaluate(er,{},on)*Lr.iconScaleFactor,ad*Lr.compositeIconSizes[1].evaluate(er,{},on)*Lr.iconScaleFactor],(Yo[0]>Tp||Yo[1]>Tp)&&Hr(`${rr.layerIds[0]}: Value for "icon-size" is >= ${p_}. Reduce your "icon-size".`)),rr.addSymbols(rr.icon,Lo,Yo,Ut,Gt,er,void 0,At,$t,Ti.lineStartIndex,Ti.lineLength,-1,_n,on,Kn,gi),Ii=rr.icon.placedSymbolArray.length-1,ma&&(Wi=4*ma.length,rr.addSymbols(rr.icon,ma,Yo,Ut,Gt,er,vl.vertical,At,$t,Ti.lineStartIndex,Ti.lineLength,-1,_n,on,Kn,gi),Xi=rr.icon.placedSymbolArray.length-1)}for(const Ts in tr.horizontal){const Us=Ts,Lo=tr.horizontal[Us];Wn||(Ss=Su(Lo.text),ye?Ei=Eb(Lo):Wn=$x(hn,li,$t,sn,dn,qn,Lo,Si,Kr.layout.get("text-rotate").evaluate(er,{},on),Se));const ma=Lo.positionedLines.length===1;if(Pr+=kC(rr,At,$t,Lo,jr,Kr,ye,er,Se,Ti,tr.vertical?vl.horizontal:vl.horizontalOnly,ma?vj(tr.horizontal):[Us],Oi,Ii,Lr,_n,on,Kn),ma)break}tr.vertical&&(Mn+=kC(rr,At,$t,tr.vertical,jr,Kr,ye,er,Se,Ti,vl.vertical,["vertical"],Oi,Xi,Lr,_n,on,Kn));let bo=-1;const tl=(Ts,Us)=>Ts?Math.max(Ts,Us):Us;bo=tl(Ei,bo),bo=tl(ei,bo),bo=tl(cn,bo);const ld=bo>-1?1:0;rr.glyphOffsetArray.length>=65535&&Hr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),er.sortKey!==void 0&&rr.addToSortKeyRanges(rr.symbolInstances.length,er.sortKey),rr.symbolInstances.emplaceBack($t.x,$t.y,li.x,li.y,li.z,Oi.right>=0?Oi.right:-1,Oi.center>=0?Oi.center:-1,Oi.left>=0?Oi.left:-1,Oi.vertical>=0?Oi.vertical:-1,Ii,Xi,Ss,Wn!==void 0?Wn:rr.collisionBoxArray.length,Wn!==void 0?Wn+1:rr.collisionBoxArray.length,Ai!==void 0?Ai:rr.collisionBoxArray.length,Ai!==void 0?Ai+1:rr.collisionBoxArray.length,Qi!==void 0?Qi:rr.collisionBoxArray.length,Qi!==void 0?Qi+1:rr.collisionBoxArray.length,yi||rr.collisionBoxArray.length,yi?yi+1:rr.collisionBoxArray.length,sn,Pr,Mn,ii,Wi,ld,0,el,Oo,bo,0,gs?1:0,qi)})(a,Mt,yr,rt,o,u,g,d,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,Ve,de,I,0,tt,ft,ae,e,y,N,O,L,H,X,te,_t)};if(pe==="line")for(const rt of Rx(e.geometry,0,0,jt,jt)){const Mt=gj(rt,Oe,vt,o.vertical||me,u,De,ke,a.overscaling,jt);for(const Pt of Mt)me&&Cj(a,me.text,xt,Pt)||et(rt,Pt,L)}else if(pe==="line-center"){for(const rt of e.geometry)if(rt.length>1){const Mt=mj(rt,vt,o.vertical||me,u,De,ke);Mt&&et(rt,Mt,L)}}else if(e.type==="Polygon")for(const rt of Cx(e.geometry,0)){const Mt=_j(rt,16);et(rt[0],new ff(Mt.x,Mt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const rt of e.geometry)et(rt,new ff(rt[0].x,rt[0].y,0,0,void 0),L);else if(e.type==="Point")for(const rt of e.geometry)for(const Mt of rt)et([Mt],new ff(Mt.x,Mt.y,0,0,void 0),L)}const p_=255,Tp=p_*ad;function kC(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te,ae){const de=function(he,me,_e,De,ke,Oe,Ve,tt){const vt=[];if(me.positionedLines.length===0)return vt;const ft=De.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,xt=function(rt){const Mt=rt[0],Pt=rt[1],yr=Mt*Pt;return yr>0?[Mt,-Pt]:yr<0?[-Mt,Pt]:Mt===0?[Pt,Mt]:[Pt,-Mt]}(_e);let St=Math.abs(me.top-me.bottom);for(const rt of me.positionedLines)St-=rt.lineOffset;const nt=me.positionedLines.length,_t=St/nt;let et=me.top-_e[1];for(let rt=0;rt<nt;++rt){const Mt=me.positionedLines[rt];et=yj(me,_t,et,rt);for(const Pt of Mt.positionedGlyphs){if(!Pt.rect)continue;const yr=Pt.rect||{};let rr=hj+1,$t=!0,At=1,Gr=0;if(Pt.image){const er=Ve.get(Pt.image.toString());if(!er)continue;if(er.sdf){Hr("SDF images are not supported in formatted text and will be ignored.");continue}$t=!1,At=er.pixelRatio,rr=Gm/At}const tr=(ke||tt)&&Pt.vertical,nr=Pt.metrics.advance*Pt.scale/2,jr=Pt.metrics,rn=Pt.rect;if(rn===null)continue;tt&&me.verticalizable&&(Gr=Pt.image?nr-Pt.metrics.width*Pt.scale/2:0);const Kr=ke?[Pt.x+nr,Pt.y]:[0,0];let hn=[0,0],sn=[0,0],dn=!1;ke||(tr?(sn=[Pt.x+nr+xt[0],Pt.y+xt[1]-Gr],dn=!0):hn=[Pt.x+nr+_e[0],Pt.y+_e[1]-Gr]);const qn=rn.w*Pt.scale/(At*(Pt.localGlyph?ih:1)),Si=rn.h*Pt.scale/(At*(Pt.localGlyph?ih:1));let ye,Se,ot,Lt;if(tr){const er=Pt.y-et,Lr=new Ot(-nr,nr-er),yn=-Math.PI/2,_n=new Ot(...sn);ye=new Ot(-nr+hn[0],hn[1]),ye._rotateAround(yn,Lr)._add(_n),ye.x+=-er+nr,ye.y-=(jr.left-rr)*Pt.scale;const on=Pt.image?jr.advance*Pt.scale:co*Pt.scale,Kn=String.fromCodePoint(Pt.glyph);sj(Kn)?ye.x+=(1-rr)*Pt.scale:oj(Kn)?ye.x+=on-jr.height*Pt.scale+(-rr-1)*Pt.scale:ye.x+=Pt.image||jr.width+2*rr===rn.w&&jr.height+2*rr===rn.h?(on-Si)/2:(on-(jr.height+2*rr)*Pt.scale)/2,Se=new Ot(ye.x,ye.y-qn),ot=new Ot(ye.x+Si,ye.y),Lt=new Ot(ye.x+Si,ye.y-qn)}else{const er=(jr.left-rr)*Pt.scale-nr+hn[0],Lr=(-jr.top-rr)*Pt.scale+hn[1],yn=er+qn,_n=Lr+Si;ye=new Ot(er,Lr),Se=new Ot(yn,Lr),ot=new Ot(er,_n),Lt=new Ot(yn,_n)}if(ft){let er;er=ke?new Ot(0,0):dn?new Ot(xt[0],xt[1]):new Ot(_e[0],_e[1]),ye._rotateAround(ft,er),Se._rotateAround(ft,er),ot._rotateAround(ft,er),Lt._rotateAround(ft,er)}const Gt=new Ot(0,0),Ut=new Ot(0,0);vt.push({tl:ye,tr:Se,bl:ot,br:Lt,texPrimary:yr,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:Kr,sectionIndex:Pt.sectionIndex,isSDF:$t,pixelOffsetTL:Gt,pixelOffsetBR:Ut,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,u,C,g,y,T,d,a.allowVerticalPlacement),pe=a.textSizeData;let Q=null;pe.kind==="source"?(Q=[ad*g.layout.get("text-size").evaluate(T,{},te)*H.textScaleFactor],Q[0]>Tp&&Hr(`${a.layerIds[0]}: Value for "text-size" is >= ${p_}. Reduce your "text-size".`)):pe.kind==="composite"&&(Q=[ad*H.compositeTextSizes[0].evaluate(T,{},te)*H.textScaleFactor,ad*H.compositeTextSizes[1].evaluate(T,{},te)*H.textScaleFactor],(Q[0]>Tp||Q[1]>Tp)&&Hr(`${a.layerIds[0]}: Value for "text-size" is >= ${p_}. Reduce your "text-size".`)),a.addSymbols(a.text,de,Q,C,y,T,N,e,o,I.lineStartIndex,I.lineLength,V,X,te,ae,!1);for(const he of O)L[he]=a.text.placedSymbolArray.length-1;return 4*de.length}function Tb(a){for(const e in a)return a[e];return null}function $x(a,e,o,u,d,g,y,T,C,I){let N=y.top,O=y.bottom,L=y.left,V=y.right;if(aC(y)&&y.collisionPadding){const H=y.collisionPadding;L-=H[0],N-=H[1],V+=H[2],O+=H[3]}if(C){const H=new Ot(L,N),X=new Ot(V,N),te=new Ot(L,O),ae=new Ot(V,O),de=Sn(C);let pe=new Ot(0,0);I&&(pe=new Ot(I[0],I[1])),H._rotateAround(de,pe),X._rotateAround(de,pe),te._rotateAround(de,pe),ae._rotateAround(de,pe),L=Math.min(H.x,X.x,te.x,ae.x),V=Math.max(H.x,X.x,te.x,ae.x),N=Math.min(H.y,X.y,te.y,ae.y),O=Math.max(H.y,X.y,te.y,ae.y)}return a.emplaceBack(e.x,e.y,e.z,o.x,o.y,L,N,V,O,T,u,d,g),a.length-1}function Eb(a){aC(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function Cj(a,e,o,u){const d=a.compareText;if(e in d){const g=d[e];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<o)return!0}else d[e]=[];return d[e].push(u),!1}function PC(a,e){const o=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,d=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(o)*d/Math.sin(Math.max(Math.PI/2-a._pitch-o,.01));let y=Math.sin(a._pitch)*g+d;const T=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let C=Math.max(a.zoom-17,0);a.isOrthographic&&(C/=10),y*=1+C}return Math.min(1.01*y,T)}function m_(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const o=Math.pow(2,-a.z),u=a.x*o,d=(a.x+1)*o,g=a.y*o,y=(a.y+1)*o,T=Re(u),C=Re(d),I=Be(g),N=Be(y),O=e.project(T,I),L=e.project(C,I),V=e.project(C,N),H=e.project(T,N);let X=Math.min(O.x,L.x,V.x,H.x),te=Math.min(O.y,L.y,V.y,H.y),ae=Math.max(O.x,L.x,V.x,H.x),de=Math.max(O.y,L.y,V.y,H.y);const pe=o/16;function Q(me,_e,De,ke,Oe,Ve){const tt=(De+Oe)/2,vt=(ke+Ve)/2,ft=e.project(Re(tt),Be(vt)),xt=Math.max(0,X-ft.x,te-ft.y,ft.x-ae,ft.y-de);X=Math.min(X,ft.x),ae=Math.max(ae,ft.x),te=Math.min(te,ft.y),de=Math.max(de,ft.y),xt>pe&&(Q(me,ft,De,ke,tt,vt),Q(ft,_e,tt,vt,Oe,Ve))}Q(O,L,u,g,d,g),Q(L,V,d,g,d,y),Q(V,H,d,y,u,y),Q(H,O,u,y,u,g),X-=pe,te-=pe,ae+=pe,de+=pe;const he=1/Math.max(ae-X,de-te);return{scale:he,x:X*he,y:te*he,x2:ae*he,y2:de*he,projection:e}}function RC(a,{x:e,y:o},u=0){return new Ot(((e-u)*a.scale-a.x)*jt,(o*a.scale-a.y)*jt)}const Aj=W(new Float32Array(16));class Ep{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,o){return{x:0,y:0,z:0}}unproject(e,o){return new ce(0,0)}projectTilePoint(e,o,u){return{x:e,y:o,z:0}}locationPoint(e,o,u,d=!0){return e._coordinatePoint(e.locationCoordinate(o,u),d)}pixelsPerMeter(e,o){return Ie(1,e)*o}pixelSpaceConversion(e,o,u){return 1}farthestPixelDistance(e){return PC(e,e.pixelsPerMeter)}pointCoordinate(e,o,u,d){const g=e.horizonLineFromTop(!1),y=new Ot(o,Math.max(g,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,d))}pointCoordinate3D(e,o,u){const d=new Ot(o,u);if(e.elevation)return e.elevation.pointCoordinate(d);{const g=this.pointCoordinate(e,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,o){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,o.x,o.y);const u=e.horizonLineFromTop();return o.y<u}createInversionMatrix(e,o){return Aj}createTileMatrix(e,o,u){let d,g,y;const T=u.canonical,C=W(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=m_(T,this);d=1,g=I.x+u.wrap*I.scale,y=I.y,Fe(C,C,[d/I.scale,d/I.scale,e.pixelsPerMeter/o])}else d=o/e.zoomScale(T.z),g=(T.x+Math.pow(2,T.z)*u.wrap)*d,y=T.y*d;return Pe(C,C,[g,y,0]),Fe(C,C,[d/jt,d/jt,1]),C}upVector(e,o,u){return[0,0,1]}upVectorScale(e,o,u){return{metersToTile:1}}}class Ij extends Ep{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[o,u]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(Sn(o));this.n=(d+Math.sin(Sn(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,o){const{n:u,c:d,r0:g}=this,y=Sn(e-this.center[0]),T=Sn(o),C=Math.sqrt(d-2*u*Math.sin(T))/u;return{x:C*Math.sin(y*u),y:C*Math.cos(y*u)-g,z:0}}unproject(e,o){const{n:u,c:d,r0:g}=this,y=g+o;let T=Math.atan2(e,Math.abs(y))*Math.sign(y);y*u<0&&(T-=Math.PI*Math.sign(e)*Math.sign(y));const C=Sn(this.center[0])*u;T=We(T,-Math.PI-C,Math.PI-C);const I=Ee(Ke(T/u)+this.center[0],-180,180),N=Math.asin(Ee((d-(e*e+y*y)*u*u)/(2*u),-1,1)),O=Ee(Ke(N),-85.051129,st);return new ce(I,O)}}const g_=1.340264,y_=-.081106,__=893e-6,x_=.003796,Hx=Math.sqrt(3)/2;class Mj extends Ep{project(e,o){o=o/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(Hx*Math.sin(o)),d=u*u,g=d*d*d;return{x:.5*(e*Math.cos(u)/(Hx*(g_+3*y_*d+g*(7*__+9*x_*d)))/Math.PI+.5),y:1-.5*(u*(g_+y_*d+g*(__+x_*d))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,d=u*u,g=d*d*d;for(let N,O,L,V=0;V<12&&(O=u*(g_+y_*d+g*(__+x_*d))-o,L=g_+3*y_*d+g*(7*__+9*x_*d),N=O/L,u=Ee(u-N,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(N)<1e-12));++V);const y=Hx*e*(g_+3*y_*d+g*(7*__+9*x_*d))/Math.cos(u),T=Math.asin(Math.sin(u)/Hx),C=Ee(180*y/Math.PI,-180,180),I=Ee(180*T/Math.PI,-85.051129,st);return new ce(C,I)}}class kj extends Ep{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){return{x:.5+e/360,y:.5-o/360,z:0}}unproject(e,o){const u=360*(e-.5),d=Ee(360*(.5-o),-85.051129,st);return new ce(u,d)}}const Yg=Math.PI/2;function Gx(a){return Math.tan((Yg+a)/2)}class Pj extends Ep{constructor(e){super(e),this.center=e.center||[0,30];const[o,u]=this.parallels=e.parallels||[30,30];let d=Sn(o),g=Sn(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const y=Math.cos(d),T=Gx(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(Gx(g)/T),this.f=y*Math.pow(Gx(d),this.n)/this.n}project(e,o){o=Sn(o),this.southernCenter&&(o=-o),e=Sn(e-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?o<-Yg+u&&(o=-Yg+u):o>Yg-u&&(o=Yg-u);const y=g/Math.pow(Gx(o),d);let T=y*Math.sin(d*e),C=g-y*Math.cos(d*e);return T=.5*(T/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:T,y:this.southernCenter?C:1-C,z:0}}unproject(e,o){e=(2*e-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:d}=this,g=d-o,y=Math.sign(g),T=Math.sign(u)*Math.sqrt(e*e+g*g);let C=Math.atan2(e,Math.abs(g))*y;g*u<0&&(C-=Math.PI*Math.sign(e)*y);const I=Ee(Ke(C/u)+this.center[0],-180,180),N=Ee(Ke(2*Math.atan(Math.pow(d/T,1/u))-Yg),-85.051129,st);return new ce(I,this.southernCenter?-N:N)}}class NC extends Ep{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,o){return{x:Te(e),y:be(o),z:0}}unproject(e,o){const u=Re(e),d=Be(o);return new ce(u,d)}}const DC=Sn(st);class Rj extends Ep{project(e,o){const u=(o=Sn(o))*o,d=u*u;return{x:.5*((e=Sn(e))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,d=25,g=0,y=u*u;do{y=u*u;const I=y*y;g=(u*(1.007226+y*(.015085+I*(.028874*y-.044475-.005916*I)))-o)/(1.007226+y*(.045255+I*(.259866*y-.311325-.005916*11*I))),u=Ee(u-g,-DC,DC)}while(Math.abs(g)>1e-6&&--d>0);y=u*u;const T=Ee(Ke(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),C=Ke(u);return new ce(T,C)}}const OC=Sn(st);class Nj extends Ep{project(e,o){o=Sn(o),e=Sn(e);const u=Math.cos(o),d=2/Math.PI,g=Math.acos(u*Math.cos(e/2)),y=Math.sin(g)/g,T=.5*(e*d+2*u*Math.sin(e/2)/y)||0,C=.5*(o+Math.sin(o)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,o){let u=e=(2*e-.5)*Math.PI,d=o=(2*(1-o)-1)*Math.PI,g=25;const y=1e-6;let T=0,C=0;do{const I=Math.cos(d),N=Math.sin(d),O=2*N*I,L=N*N,V=I*I,H=Math.cos(u/2),X=Math.sin(u/2),te=2*H*X,ae=X*X,de=1-V*H*H,pe=de?1/de:0,Q=de?Math.acos(I*H)*Math.sqrt(1/de):0,he=.5*(2*Q*I*X+2*u/Math.PI)-e,me=.5*(Q*N+d)-o,_e=.5*pe*(V*ae+Q*I*H*L)+1/Math.PI,De=pe*(te*O/4-Q*N*X),ke=.125*pe*(O*X-Q*N*V*te),Oe=.5*pe*(L*H+Q*ae*I)+.5,Ve=De*ke-Oe*_e;T=(me*De-he*Oe)/Ve,C=(he*ke-me*_e)/Ve,u=Ee(u-T,-Math.PI,Math.PI),d=Ee(d-C,-OC,OC)}while((Math.abs(T)>y||Math.abs(C)>y)&&--g>0);return new ce(Ke(u),Ke(d))}}class LC extends Ep{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Sn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){const{scale:u,cosPhi:d}=this;return{x:Sn(e)*d*u+.5,y:-Math.sin(Sn(o))/d*u+.5,z:0}}unproject(e,o){const{scale:u,cosPhi:d}=this,g=-(o-.5)/u,y=Ee(Ke((e-.5)/u)/d,-180,180),T=Math.asin(Ee(g*d,-1,1)),C=Ee(Ke(T),-85.051129,st);return new ce(y,C)}}class Dj extends NC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,o,u){const d=tn(e,o,u);return Cr(d,d,yt(Qe(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,o,u){const d=Y(o.lat,o.lng),g=Rr([],d),y=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(o),e._centerAltitude):e._centerAltitude;qe(d,d,g,Ie(1,0)*jt*y);const T=W(new Float64Array(16));return fe(T,e.pixelMatrix,e.globeMatrix),Cr(d,d,T),new Ot(d[0],d[1])}pixelsPerMeter(e,o){return Ie(1,0)*o}pixelSpaceConversion(e,o,u){const d=Ie(1,e)*o,g=Ir(Ie(1,45)*o,d,u);return this.pixelsPerMeter(e,o)/g}createTileMatrix(e,o,u){const d=ut(Qe(u.canonical));return fe(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,o){const{center:u}=e,d=yt(Qe(o));return at(d,d,Sn(u.lng)),ht(d,d,Sn(u.lat)),Fe(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,o,u,d){return se(e,o,u,!0)||new Le(0,0)}pointCoordinate3D(e,o,u){const d=this.pointCoordinate(e,o,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,o){return!se(e,o.x,o.y,!1)}farthestPixelDistance(e){const o=function(d,g){const y=d.cameraToCenterDistance,T=d._centerAltitude*g,C=d._camera,I=d._camera.forward(),N=br([],Ht([],I,-y),[0,0,T]),O=d.worldSize/(2*Math.PI),L=[0,0,-O],V=d.width/d.height,H=Math.tan(d.fovAboveCenter),X=Ht([],C.up(),H),te=Ht([],C.right(),H*V),ae=Rr([],br([],br([],I,X),te)),de=[];let pe;if(new mi(N,ae).closestPointOnSphere(L,O,de)){const Q=br([],de,L),he=On([],Q,N);pe=Math.cos(d.fovAboveCenter)*Br(he)}else{const Q=On([],N,L),he=On([],L,N);Rr(he,he);const me=Br(Q)-O;pe=Math.sqrt(me*(me+2*O));const _e=Math.acos(pe/(O+me))-Math.acos(ar(I,he));pe*=Math.cos(_e)}return 1.01*pe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=mn(e.zoom);if(u>0){const d=PC(e,Ie(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ir(o,d+g*(1-Math.cos(y)),Math.pow(u,10))}return o}upVector(e,o,u){return tn(o,u,e,1)}upVectorScale(e){return{metersToTile:B(an(Qe(e)))}}}function zC(a){const e=a.parallels,o=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new NC(a);case"equirectangular":return new kj(a);case"naturalEarth":return new Rj(a);case"equalEarth":return new Mj(a);case"winkelTripel":return new Nj(a);case"albers":return o?new LC(a):new Ij(a);case"lambertConformalConic":return o?new LC(a):new Pj(a);case"globe":return new Dj(a)}throw new Error(`Invalid projection name: ${a.name}`)}const Oj=en.VectorTileFeature.types,Lj=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qx(a,e,o,u,d,g,y,T,C,I,N,O,L){const V=T?Math.min(Tp,Math.round(T[0])):0,H=T?Math.min(Tp,Math.round(T[1])):0;a.emplaceBack(e,o,Math.round(32*u),Math.round(32*d),g,y,(V<<1)+(C?1:0),H,16*I,16*N,256*O,256*L)}function Wx(a,e,o){a.emplaceBack(e,o)}function Zx(a,e,o,u,d,g,y){a.emplaceBack(e,o,u,d,g,y)}const Xx=(a,e,o,u)=>{for(let d=0;d<e;d++)a.emplaceBack(o[0],o[1],o[2],u[0],u[1],u[2])};function Kx(a,e,o,u,d){a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d)}function zj(a){for(const e of a.sections)if(Xd(e.text))return!0;return!1}class Cb{constructor(e){this.layoutVertexArray=new Jh,this.indexArray=new Rs,this.programConfigurations=e,this.segments=new si,this.dynamicLayoutVertexArray=new Ps,this.opacityVertexArray=new gc,this.placedSymbolArray=new mp,this.iconTransitioningVertexArray=new yc,this.globeExtVertexArray=new Mo,this.zOffsetVertexArray=new mc,this.orientationVertexArray=new dp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,o,u,d,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Yz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Lj,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,ej.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Kz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Jz.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,Qz.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Zt(Cb,"SymbolBuffers");class Ab{constructor(e,o,u){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new u,this.segments=new si,this.collisionVertexArray=new Gl,this.collisionVertexArrayExt=new Ps}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,rj.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(Ab,"CollisionBuffers");class Yx{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=W([]),this.placementViewportMatrix=W([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=dC(this.zoom,o["text-size"],this.worldview),this.iconSizeData=dC(this.zoom,o["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>vl[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Cb(new f(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Cb(new f(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new sf,this.lineVertexArray=new gp,this.symbolInstances=new km}calculateGlyphDependencies(e,o,u,d,g){for(const y of e){const T=y.codePointAt(0);if(T===void 0)break;if(o[T]=!0,d&&g&&T<=65535){const C=u_[y];C&&(o[C.charCodeAt(0)]=!0)}}}updateFootprints(e,o){}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!tb(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(e,o,u,d){const g=this.layers[0],y=g.layout,T=this.projection.name==="globe",C=y.get("text-font"),I=y.get("text-field"),N=y.get("icon-image"),[O,L]=y.get("icon-size-scale-range"),V=Ee(o.scaleFactor||1,O,L),H=(I.value.kind!=="constant"||I.value.value instanceof Ao&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),X=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,te=y.get("symbol-sort-key");if(this.features=[],!H&&!X)return;const ae=o.iconDependencies,de=o.glyphDependencies,pe=o.availableImages,Q=new Hn(this.zoom,{worldview:this.worldview});for(const{feature:he,id:me,index:_e,sourceLayerIndex:De}of e){const ke=g._featureFilter.needGeometry,Oe=Bt(he,ke);if(!g._featureFilter.filter(Q,Oe,u))continue;if(ke||(Oe.geometry=qt(he,u,d)),T&&he.type!==1&&u.z<=5){const xt=Oe.geometry,St=.98078528056,nt=(_t,et)=>ar(tn(_t.x,_t.y,u,1),tn(et.x,et.y,u,1))<St;for(let _t=0;_t<xt.length;_t++)xt[_t]=It(xt[_t],nt)}let Ve,tt;if(H){const xt=g.getValueAndResolveTokens("text-field",Oe,u,pe),St=Ao.factory(xt);zj(St)&&(this.hasRTLText=!0),(!this.hasRTLText||fc()==="unavailable"||this.hasRTLText&&pl.isParsed())&&(Ve=ij(St,g,Oe))}if(X){const xt=g.getValueAndResolveTokens("icon-image",Oe,u,pe);tt=typeof xt=="string"?Uo.build(xt):xt}if(!Ve&&!tt)continue;const vt=this.sortFeaturesByKey?te.evaluate(Oe,{},u):void 0,ft={id:me,text:Ve,icon:tt,index:_e,sourceLayerIndex:De,geometry:Oe.geometry,properties:he.properties,type:Oj[he.type],sortKey:vt};if(this.features.push(ft),tt){const xt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:St,iconSecondary:nt}=AC(tt,this.iconSizeData,xt["icon-size"],u,this.zoom,ft,this.pixelRatio,V,this.worldview),_t=St.id.toString();if(ae.has(_t)?ae.get(_t).push(St):ae.set(_t,[St]),nt){const et=nt.id.toString();ae.has(et)?ae.get(et).push(nt):ae.set(et,[nt])}}if(Ve){const xt=C.evaluate(Oe,{},u).join(","),St=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vl.vertical)>=0;for(const nt of Ve.sections)if(nt.image){const _t=nt.image.getPrimary().scaleSelf(this.pixelRatio),et=_t.id.toString(),rt=ae.get(et)||[];rt.push(_t),ae.set(et,rt)}else{const _t=Ra(Ve.toString()),et=nt.fontStack||xt,rt=de[et]=de[et]||{};this.calculateGlyphDependencies(nt.text,rt,St,this.allowVerticalPlacement,_t)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(he){const me={},_e={},De=[];let ke=0;function Oe(ft){De.push(he[ft]),ke++}function Ve(ft,xt,St){const nt=_e[ft];return delete _e[ft],_e[xt]=nt,De[nt].geometry[0].pop(),De[nt].geometry[0]=De[nt].geometry[0].concat(St[0]),nt}function tt(ft,xt,St){const nt=me[xt];return delete me[xt],me[ft]=nt,De[nt].geometry[0].shift(),De[nt].geometry[0]=St[0].concat(De[nt].geometry[0]),nt}function vt(ft,xt,St){const nt=St?xt[0][xt[0].length-1]:xt[0][0];return`${ft}:${nt.x}:${nt.y}`}for(let ft=0;ft<he.length;ft++){const xt=he[ft],St=xt.geometry,nt=xt.text?xt.text.toString():null;if(!nt){Oe(ft);continue}const _t=vt(nt,St),et=vt(nt,St,!0);if(_t in _e&&et in me&&_e[_t]!==me[et]){const rt=tt(_t,et,St),Mt=Ve(_t,et,De[rt].geometry);delete me[_t],delete _e[et],_e[vt(nt,De[Mt].geometry,!0)]=Mt,De[rt].geometry=null}else _t in _e?Ve(_t,et,St):et in me?tt(_t,et,St):(Oe(ft),me[_t]=ke-1,_e[et]=ke-1)}return De.filter(ft=>ft.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const he of o.elevationFeatures)this.elevationFeatureIdToIndex.set(he.id,this.elevationFeatures.length),this.elevationFeatures.push(he)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((he,me)=>he.sortKey-me.sortKey)}update(e,o,u,d,g,y,T){this.text.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const u=Je(e),d=1/u;let g=!1,y=!1;for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T),I=Ft(1,0,0),N=Ft(0,1,0),{numHorizontalGlyphVertices:O,numVerticalGlyphVertices:L,numIconVertices:V,numVerticalIconVertices:H}=C,X=O>0||L>0,te=V>0,ae=this.elevationFeatures[C.elevationFeatureIndex];if(ae){const de=new Ot(C.tileAnchorX,C.tileAnchorY),pe=.075+ae.pointElevation(de);C.zOffset!==pe&&(o=!0,C.zOffset=pe);const Q=ae.computeSlopeNormal(de,d),he=Fo(Ki(),Ft(0,0,1),Q);Zn(I,I,he),Zn(N,N,he),I[2]*=u,N[2]*=u,I[0]===1&&I[1]===0&&I[2]===0&&N[0]===0&&N[1]===1&&N[2]===0||(g=g||X,y=y||te)}if(X&&(Xx(this.text.orientationVertexArray,O,I,N),Xx(this.text.orientationVertexArray,L,I,N)),te){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:pe}=C;de>=0&&Xx(this.icon.orientationVertexArray,V,I,N),pe>=0&&Xx(this.icon.orientationVertexArray,H,I,N)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(g,y,T)=>{u+=y,u>g.length&&g.resize(u);for(let C=-y;C<0;C++)g.emplace(C+u,T)},o=(g,y,T)=>{d+=y,d>g.length&&g.resize(d);for(let C=-y;C<0;C++)g.emplace(C+d,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:C,numIconVertices:I}=y,N=y.zOffset,O=I>0;if((T>0||C>0)&&(e(this.text.zOffsetVertexArray,T,N),e(this.text.zOffsetVertexArray,C,N)),O){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:V}=y;L>=0&&o(this.icon.zOffsetVertexArray,I,N),V>=0&&o(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,N)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=zC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const u=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:g}of o)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,o,u,d,g,y,T,C,I,N,O,L,V,H,X,te){const ae=e.indexArray,de=e.layoutVertexArray,pe=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*o.length,de,ae,this.canOverlap?y.sortKey:void 0),he=this.glyphOffsetArray.length,me=Q.vertexLength,_e=this.allowVerticalPlacement&&T===vl.vertical?Math.PI/2:0,De=y.text&&y.text.sections;for(let Oe=0;Oe<o.length;Oe++){const{tl:Ve,tr:tt,bl:vt,br:ft,texPrimary:xt,texSecondary:St,pixelOffsetTL:nt,pixelOffsetBR:_t,minFontScaleX:et,minFontScaleY:rt,glyphOffset:Mt,isSDF:Pt,sectionIndex:yr}=o[Oe],rr=Q.vertexLength,$t=Mt[1];if(qx(de,I.x,I.y,Ve.x,$t+Ve.y,xt.x,xt.y,u,Pt,nt.x,nt.y,et,rt),qx(de,I.x,I.y,tt.x,$t+tt.y,xt.x+xt.w,xt.y,u,Pt,_t.x,nt.y,et,rt),qx(de,I.x,I.y,vt.x,$t+vt.y,xt.x,xt.y+xt.h,u,Pt,nt.x,_t.y,et,rt),qx(de,I.x,I.y,ft.x,$t+ft.y,xt.x+xt.w,xt.y+xt.h,u,Pt,_t.x,_t.y,et,rt),C){const{x:At,y:Gr,z:tr}=C.anchor,[nr,jr,rn]=C.up;Zx(pe,At,Gr,tr,nr,jr,rn),Zx(pe,At,Gr,tr,nr,jr,rn),Zx(pe,At,Gr,tr,nr,jr,rn),Zx(pe,At,Gr,tr,nr,jr,rn),Kx(e.dynamicLayoutVertexArray,At,Gr,tr,_e)}else Kx(e.dynamicLayoutVertexArray,I.x,I.y,I.z,_e);if(te){const At=St||xt;Wx(e.iconTransitioningVertexArray,At.x,At.y),Wx(e.iconTransitioningVertexArray,At.x+At.w,At.y),Wx(e.iconTransitioningVertexArray,At.x,At.y+At.h),Wx(e.iconTransitioningVertexArray,At.x+At.w,At.y+At.h)}ae.emplaceBack(rr,rr+1,rr+2),ae.emplaceBack(rr+1,rr+2,rr+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),Oe!==o.length-1&&yr===o[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,y,y.index,{},V,H,X,De&&De[yr],this.worldview)}const ke=C?C.anchor:I;e.placedSymbolArray.emplaceBack(ke.x,ke.y,ke.z,I.x,I.y,he,this.glyphOffsetArray.length-he,me,N,O,I.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],T,0,0,0,L,0)}_commitLayoutVertex(e,o,u,d,g,y,T){e.emplaceBack(o,u,d,g,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,o,u,d,g,y,T){const C=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=C.vertexLength,N=T.tileAnchorX,O=T.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,e.padding,T.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x1,e.y2)),C.vertexLength+=4;const L=u.indexArray;L.emplaceBack(I,I+1),L.emplaceBack(I+1,I+2),L.emplaceBack(I+2,I+3),L.emplaceBack(I+3,I),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,u,d,g,y){for(let T=d;T<g;T++){const C=u.get(T),I=this.getSymbolInstanceTextSize(e,y,o,T);this._addCollisionDebugVertices(C,I,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,o,u,d,g,y){for(let T=d;T<g;T++){const C=u.get(T),I=this.getSymbolInstanceIconSize(e,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(C,I,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ab(ef,JE.members,yc),this.iconCollisionBox=new Ab(ef,JE.members,yc);const d=d_(this.iconSizeData,e),g=d_(this.textSizeData,e,u);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,e,o,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(g,e,o,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(d,e,o,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(d,e,o,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(e,o,u,d){const g=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:d),y=xb(this.textSizeData,e,g)/co;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,o,u){const d=this.icon.placedSymbolArray.get(u),g=xb(this.iconSizeData,e,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,o,u,d){e.emplaceBack(o,-u,-u,d),e.emplaceBack(o,u,-u,d),e.emplaceBack(o,u,u,d),e.emplaceBack(o,-u,u,d)}_updateTextDebugCollisionBoxes(e,o,u,d,g,y,T){for(let C=d;C<g;C++){const I=u.get(C),N=this.getSymbolInstanceTextSize(e,y,o,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,I.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(e,o,u,d,g,y,T){for(let C=d;C<g;C++){const I=u.get(C),N=this.getSymbolInstanceIconSize(e,o,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,I.padding,y.zOffset)}}updateCollisionDebugBuffers(e,o,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=d_(this.iconSizeData,e,d),y=d_(this.textSizeData,e,u);for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(y,e,o,C.textBoxStartIndex,C.textBoxEndIndex,C,u),this._updateTextDebugCollisionBoxes(y,e,o,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,u),this._updateIconDebugCollisionBoxes(g,e,o,C.iconBoxStartIndex,C.iconBoxEndIndex,C,d),this._updateIconDebugCollisionBoxes(g,e,o,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,u,d,g,y,T,C,I){const N={};if(o<u){const{x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(o);N.textBox={x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q},N.textFeatureIndex=he}if(d<g){const{x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(d);N.verticalTextBox={x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q},N.verticalTextFeatureIndex=he}if(y<T){const{x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(y);N.iconBox={x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q},N.iconFeatureIndex=he}if(C<I){const{x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(C);N.verticalIconBox={x1:O,y1:L,x2:V,y2:H,padding:X,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:de,tileAnchorX:pe,tileAnchorY:Q},N.verticalIconFeatureIndex=he}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,o){const u=e.placedSymbolArray.get(o),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(e),u=Math.cos(e),d=[],g=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const C=this.symbolInstances.get(T);d.push(0|Math.round(o*C.tileAnchorX+u*C.tileAnchorY)),g.push(C.featureIndex)}return y.sort((T,C)=>d[T]-d[C]||g[C]-g[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:I}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jC,FC,Ib;Zt(Yx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Yx.addDynamicAttributes=Kx;class BC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Th,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(BC,"FormatSectionOverride",{omit:["defaultValue"]});const Mb=()=>Ib||(Ib={layout:jC||(jC=new Di({"symbol-placement":new Tt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt($e.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new zt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt($e.layout_symbol["icon-image"]),"icon-rotate":new zt($e.layout_symbol["icon-rotate"]),"icon-padding":new Tt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new zt($e.layout_symbol["icon-offset"]),"icon-anchor":new zt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt($e.layout_symbol["text-rotation-alignment"]),"text-field":new zt($e.layout_symbol["text-field"]),"text-font":new zt($e.layout_symbol["text-font"]),"text-size":new zt($e.layout_symbol["text-size"]),"text-size-scale-range":new Tt($e.layout_symbol["text-size-scale-range"]),"text-max-width":new zt($e.layout_symbol["text-max-width"]),"text-line-height":new zt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new zt($e.layout_symbol["text-letter-spacing"]),"text-justify":new zt($e.layout_symbol["text-justify"]),"text-radial-offset":new zt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new zt($e.layout_symbol["text-anchor"]),"text-max-angle":new Tt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt($e.layout_symbol["text-writing-mode"]),"text-rotate":new zt($e.layout_symbol["text-rotate"]),"text-padding":new Tt($e.layout_symbol["text-padding"]),"text-keep-upright":new Tt($e.layout_symbol["text-keep-upright"]),"text-transform":new zt($e.layout_symbol["text-transform"]),"text-offset":new zt($e.layout_symbol["text-offset"]),"text-allow-overlap":new Tt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Tt($e.layout_symbol["text-optional"]),visibility:new Tt($e.layout_symbol.visibility)})),paint:FC||(FC=new Di({"icon-opacity":new zt($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new zt($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new zt($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zt($e.paint_symbol["text-emissive-strength"]),"icon-color":new zt($e.paint_symbol["icon-color"]),"icon-halo-color":new zt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zt($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new zt($e.paint_symbol["text-occlusion-opacity"]),"text-color":new zt($e.paint_symbol["text-color"],{runtimeType:na,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new zt($e.paint_symbol["text-halo-color"]),"text-halo-width":new zt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new zt($e.paint_symbol["text-halo-blur"]),"text-translate":new Tt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Tt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new zt($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},Ib);class Jx extends lo{constructor(e,o,u,d){super(e,Mb(),o,u,d),this._colorAdjustmentMatrix=W([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,o){super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,o,u,d){return this._saturation===e&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(g,y,T,C){g=yo(g),y=us(y);const I=J(),N=g/3,O=1-2*N,L=[O,N,N,0,N,O,N,0,N,N,O,0,0,0,0,1],V=.5-.5*y,H=C-T;return fe(I,[H,0,0,0,0,H,0,0,0,0,H,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,V,V,V,1]),fe(I,I,L),I}(e,o,u,d),this._saturation=e,this._contrast=o,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,o,u,d){const g=this.layout.get(e).evaluate(o,{},u,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||hc(y.value)||!g?g:function(T,C){return C.replace(/{([^{}]+)}/g,(I,N)=>N in T?String(T[N]):"")}(o.properties,g)}createBucket(e){return new Yx(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Mb().paint.overridableProperties){if(!Jx.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),u=new BC(o),d=new Uu(u,o.property.specification,this.scope,this.options);let g=null;g=o.value.kind==="constant"||o.value.kind==="source"?new Kc("source",d):new Yc("composite",d,o.value.zoomStops,o.value.interpolationType),this.paint._values[e]=new Vl(o.property,g,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&Jx.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const u=e.get("text-field"),d=Mb().paint.properties[o];let g=!1;const y=T=>{for(const C of T)if(d.overrides&&d.overrides.hasOverride(C))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ao)y(u.value.value.sections);else if(u.value.kind==="source"){const T=I=>{g||(I instanceof Nr&&Kt(I.value)===Eh?y(I.value.sections):I instanceof Au?y(I.sections):I.eachChild(T))},C=u.value;C._styleExpression&&T(C._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,o,u){return{config:new Po(this,{zoom:o,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let VC,UC,$C,HC;var kb=Tn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Pb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Rb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Nb{constructor(e,o,u,d){this.context=e,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(o,{premultiply:d&&d.premultiply})}update(e,o){const u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:g}=this,{gl:y}=g,{x:T,y:C}=o&&o.position?o.position:{x:0,y:0},I=T+u,N=C+d;!this.size||this.size[0]===I&&this.size[1]===N||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!o||o.premultiply!==!1));const O=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&I>0&&N>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(I,N)))+1:1;y.texStorage2D(y.TEXTURE_2D,L,this.format,I,N),this.size=[I,N]}if(this.size)if(O)y.texSubImage2D(y.TEXTURE_2D,0,T,C,Pb(this.format),Rb(this.format),e);else{const L=e.data;L&&y.texSubImage2D(y.TEXTURE_2D,0,T,C,u,d,Pb(this.format),Rb(this.format),L)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,o,u=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(e,o,u,d,g){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),o!==this.magFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,o),this.magFilter=o),e!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?e===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_FUNC,g)):T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.NONE),this.compareMode=g)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qx{constructor(e,o){this.context=e,this.texture=o}bind(e,o){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}}function ev(a,e,o,u,d,g,y,T){const C=[a,e,1,o,u,1,d,g,1],I=[y,T,1],N=$([],C),[O,L,V]=Fr(I,I,N);return K(C,C,[O,0,0,0,L,0,0,0,V])}function GC(a,e,o,u,d,g,y,T){const C=function(I,N,O,L,V,H,X,te){const ae=ev(0,0,1,0,1,1,0,1),de=ev(I,N,O,L,V,H,X,te);return K(de,de,$([],ae))}(a,e,o,u,d,g,y,T);return[C[2]/C[8]/jt,C[5]/C[8]/jt]}function tv(a){return[a[0],Math.min(Math.max(a[1],-85.051129),st)]}class qC extends Fc{constructor(e,o,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=o,this._dirty=!1}load(e,o){if(this._loaded=o||!1,this.fire(new jc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=bu(this.map._requestManager.transformRequest(this.url,Xa.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new cl(u)):d&&(this.image=d instanceof HTMLImageElement?Wa.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Qx(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new jc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Qx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=e[0][1],u=e[0][1];for(const g of e)g[1]>u&&(u=g[1]),g[1]<o&&(o=g[1]);const d=(u+o)/2;if(d>st?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=e.map(Le.fromLngLat);this.tileID=function(y){let T=1/0,C=1/0,I=-1/0,N=-1/0;for(const X of y)T=Math.min(T,X.x),C=Math.min(C,X.y),I=Math.max(I,X.x),N=Math.max(N,X.y);const O=Math.max(I-T,N-C),L=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),V=Math.pow(2,L);let H=Math.floor((T+I)/2*V);return H>1&&(H-=1),new df(L,H,Math.floor((C+N)/2*V))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new jc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ae in this.tiles){const de=this.tiles[ae];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=m_(new df(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const de=ae[1].x-ae[0].x,pe=ae[1].y-ae[0].y,Q=ae[2].x-ae[1].x,he=ae[2].y-ae[1].y,me=ae[3].x-ae[2].x,_e=ae[3].y-ae[2].y,De=ae[0].x-ae[3].x,ke=ae[0].y-ae[3].y,Oe=de*he-Q*pe,Ve=Q*_e-me*he,tt=me*ke-De*_e,vt=De*pe-de*ke;return Oe>0&&Ve>0&&tt>0&&vt>0||Oe<0&&Ve<0&&tt<0&&vt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=m_(this.tileID,this.map.transform.projection),[g,y,T,C]=this.coordinates.map(ae=>{const de=d.projection.project(ae[0],ae[1]);return RC(d,de)._round()});this.perspectiveTransform=GC(g.x,g.y,y.x,y.y,T.x,T.y,C.x,C.y);const I=this._boundsArray=new Yh;I.emplaceBack(g.x,g.y,0,0),I.emplaceBack(y.x,y.y,jt,0),I.emplaceBack(C.x,C.y,0,jt),I.emplaceBack(T.x,T.y,jt,jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(I,kb.members),this.boundsSegments=si.simpleSegment(0,0,4,2);const N=[],O=[tv((L=this.coordinates)[0]),tv(L[1]),tv(L[2]),tv(L[3])];var L;const[V,H,X,te]=function(ae){let de=ae[0][0],pe=de,Q=ae[0][1],he=Q;for(let me=1;me<ae.length;me++)ae[me][0]<de?de=ae[me][0]:ae[me][0]>pe&&(pe=ae[me][0]),ae[me][1]<Q?Q=ae[me][1]:ae[me][1]>he&&(he=ae[me][1]);return[de,Q,pe-de,he-Q]}(O);{const ae=new Yh,[de,pe,Q,he]=function(nt){let _t=nt[0].x,et=_t,rt=nt[0].y,Mt=rt;for(let Pt=1;Pt<nt.length;Pt++)nt[Pt].x<_t?_t=nt[Pt].x:nt[Pt].x>et&&(et=nt[Pt].x),nt[Pt].y<rt?rt=nt[Pt].y:nt[Pt].y>Mt&&(Mt=nt[Pt].y);return[_t,rt,et-_t,Mt-rt]}(u),me=nt=>[(nt.x-de)/Q,(nt.y-pe)/he],[_e,De,ke,Oe]=u.map(me),Ve=function(nt,_t,et,rt,Mt,Pt,yr,rr){const $t=ev(0,0,1,0,1,1,0,1);return K($t,$t,$([],ev(nt,_t,et,rt,Mt,Pt,yr,rr)))}(_e[0],_e[1],De[0],De[1],ke[0],ke[1],Oe[0],Oe[1]);this.elevatedGlobePerspectiveTransform=GC(_e[0],_e[1],De[0],De[1],ke[0],ke[1],Oe[0],Oe[1]);const tt=(nt,_t)=>{N.push(nt.lng);const et=Math.round((nt.lng-V)/X*jt),rt=Math.round((nt.lat-H)/te*jt),Mt=me(_t),Pt=Fr([],[Mt[0],Mt[1],1],Ve),yr=Math.round(Pt[0]/Pt[2]*jt),rr=Math.round(Pt[1]/Pt[2]*jt);ae.emplaceBack(et,rt,yr,rr)},vt=u[3].x-u[0].x,ft=u[3].y-u[0].y,xt=u[2].x-u[1].x,St=u[2].y-u[1].y;for(let nt=0;nt<65;nt++){const _t=nt/64,et=[u[0].x+_t*vt,u[0].y+_t*ft],rt=[u[1].x+_t*xt,u[1].y+_t*St],Mt=rt[0]-et[0],Pt=rt[1]-et[1];for(let yr=0;yr<65;yr++){const rr=yr/64,$t={x:et[0]+Mt*rr,y:et[1]+Pt*rr};tt(o.projection.unproject($t.x,$t.y),$t)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ae,kb.members)}{this.maxLongitudeTriangleSize=0;let ae=[],de=new Rs;const pe=(Q,he,me)=>{de.emplaceBack(Q,he,me);const _e=N[Q],De=N[he],ke=N[me],Oe=Math.min(Math.min(_e,De),ke),Ve=Math.max(Math.max(_e,De),ke)-Oe;Ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ve),ae.push(Oe+Ve/2)};for(let Q=0;Q<64;Q++)for(let he=0;he<64;he++){const me=65*Q+he,_e=me+1,De=me+65,ke=De+1;pe(me,De,_e),pe(_e,De,ke)}[ae,de]=function(Q,he){const me=Array.from({length:Q.length},(ke,Oe)=>Oe);me.sort((ke,Oe)=>Q[ke]-Q[Oe]);const _e=[],De=new Rs;for(let ke=0;ke<me.length;ke++){const Oe=me[ke];_e.push(Q[Oe]);const Ve=3*Oe,tt=Ve+1;De.emplaceBack(he.uint16[Ve],he.uint16[tt],he.uint16[tt+1])}return[_e,De]}(ae,de),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(de)}this.elevatedGlobeSegments=si.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/jt,0,te/jt,0,0,H,V,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof Qx||(this.texture?this.texture.update(this.image):(this.texture=new Nb(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(o)}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=e+180)+360*Math.round((u[0]-g)/360);var g;const y=new si,T=(O,L)=>{y.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:o.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=C){const O=ms(u,0,u.length,d+C);return O===u.length||T(O,Ri(u,O+1,u.length,d+360-C)-O),y}d<u[0]&&(d+=360);const I=Ri(u,0,u.length,d-C);if(I===u.length)return T(0,u.length),y;T(0,I-0);const N=ms(u,I+1,u.length,d+C);return N!==u.length&&T(N,u.length-N),y}}const jj=(Math.pow(256,2)-1)/16907520;class WC extends lo{constructor(e,o,u,d){super(e,{layout:$C||($C=new Di({visibility:new Tt($e.layout_raster.visibility)})),paint:HC||(HC=new Di({"raster-opacity":new Tt($e.paint_raster["raster-opacity"]),"raster-color":new pc($e.paint_raster["raster-color"]),"raster-color-mix":new Tt($e.paint_raster["raster-color-mix"]),"raster-color-range":new Tt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt($e.paint_raster["raster-saturation"]),"raster-contrast":new Tt($e.paint_raster["raster-contrast"]),"raster-resampling":new Tt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt($e.paint_raster["raster-array-band"]),"raster-elevation":new Tt($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof qC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Xy({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let ZC,XC,KC,YC,JC;class QC extends lo{constructor(e,o,u,d){super(e,{layout:ZC||(ZC=new Di({visibility:new Tt($e["layout_raster-particle"].visibility)})),paint:XC||(XC=new Di({"raster-particle-array-band":new Tt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pc($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,d),this._updateColorRamp(),this.lastInvalidatedAt=Wa.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Xy({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Wa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Fj extends lo{constructor(e,o){super(e,{},o,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Db(a,e,o){const u=[0,0,1],d=to([]);return To(d,d,o?-Sn(a)+Math.PI:Sn(a)),Qo(d,d,-Sn(e)),Zn(u,u,d),Rr(u,u)}function eA(a,e){const o=rv(a.projection,a.zoom,a.width,a.height),u=function(g,y,T,C,I){const N=new ce(T.lng-180*Cp,T.lat),O=new ce(T.lng+180*Cp,T.lat),L=g.project(N.lng,N.lat),V=g.project(O.lng,O.lat),H=-Math.atan2(V.y-L.y,V.x-L.x),X=Le.fromLngLat(T);X.y=Ee(X.y,-1+Cp,1-Cp);const te=X.toLngLat(),ae=g.project(te.lng,te.lat),de=Le.fromLngLat(te);de.x+=Cp;const pe=de.toLngLat(),Q=g.project(pe.lng,pe.lat),he=rA(Q.x-ae.x,Q.y-ae.y,H),me=Le.fromLngLat(te);me.y+=Cp;const _e=me.toLngLat(),De=g.project(_e.lng,_e.lat),ke=rA(De.x-ae.x,De.y-ae.y,H),Oe=Math.abs(he.x)/Math.abs(ke.y),Ve=W([]);Dt(Ve,Ve,-H*(1-(I?0:C)));const tt=W([]);return Fe(tt,tt,[1,1-(1-Oe)*C,1]),tt[4]=-ke.x/ke.y*C,Dt(tt,tt,H),fe(tt,Ve,tt),tt}(a.projection,0,a.center,o,e),d=tA(a);return Fe(u,u,[d,d,1]),u}function tA(a){const e=a.projection,o=rv(a.projection,a.zoom,a.width,a.height),u=Ob(e,a.center),d=Ob(e,ce.convert(e.center));return Math.pow(2,u*o+(1-o)*d)}function rv(a,e,o,u,d=1/0){const g=a.range;if(!g)return 0;const y=Math.min(d,Math.max(o,u)),T=Math.log(y/1024)/Math.LN2;return ze(g[0]+T,g[1]+T,e)}const Cp=1/4e4;function Ob(a,e){const o=Ee(e.lat,-85.051129,st),u=new ce(e.lng-180*Cp,o),d=new ce(e.lng+180*Cp,o),g=a.project(u.lng,o),y=a.project(d.lng,o),T=Le.fromLngLat(u),C=Le.fromLngLat(d),I=y.x-g.x,N=y.y-g.y,O=C.x-T.x,L=C.y-T.y,V=Math.sqrt((O*O+L*L)/(I*I+N*N));return Math.log(V)/Math.LN2}function rA(a,e,o){const u=Math.cos(o),d=Math.sin(o);return{x:a*u-e*d,y:a*d+e*u}}function nA(a,e,o){W(a),Dt(a,a,Sn(e[2])),ht(a,a,Sn(e[0])),at(a,a,Sn(e[1])),Fe(a,a,o),fe(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function nv(a,e,o,u,d,g,y,T){const C=[o[0]-e[0],o[1]-e[1],0],I=[u[0]-e[0],u[1]-e[1],0];if(Br(C)<1e-12||Br(I)<1e-12)return to(a);const N=lr([],C,I);Rr(N,N),Yt(I,u,e),C[2]=(g-d)*T,I[2]=(y-d)*T;const O=C;return lr(O,C,I),Rr(O,O),Fo(a,N,O)}function Lb(a,e,o=!1){const u=mn(e.zoom),d=function(g,y,T){const C=y.worldSize,I=[g[12],g[13],g[14]],N=Be(I[1]/C),O=Re(I[0]/C),L=W([]),V=Ie(1,N)*C,H=Ie(1,0)*C*mt(N,y.zoom),X=1/bt(C);let te=H*X;if(T){const Q=rv(y.projection,y.zoom,y.width,y.height,1024);te=X*y.projection.pixelSpaceConversion(y.center.lat,C,Q)}const ae=Y(N,O);br(ae,ae,Ht([],Rr([],ae),V*te*I[2]));const de=function(Q){const he=[Q[0],Q[1],Q[2]];let me=[0,1,0];const _e=lr([],me,he);return lr(me,he,_e),kr(me)===0&&(me=[0,1,0],lr(_e,he,me)),Rr(_e,_e),Rr(me,me),Rr(he,he),[_e[0],_e[1],_e[2],0,me[0],me[1],me[2],0,he[0],he[1],he[2],0,Q[0],Q[1],Q[2],1]}(ae);Fe(L,L,[te,te,te*V]),Pe(L,L,[-I[0],-I[1],-I[2]]);const pe=fe([],y.globeMatrix,de);return fe(pe,pe,L),fe(pe,pe,g),pe}(a,e,o);if(u>0){const g=function(y,T){const C=T.worldSize,I=Ie(1,0)*C*mt(T.center.lat,T.zoom)/bt(C),N=Ie(1,T.center.lat)*C,O=W([]);return at(O,O,Sn(T.center.lng)),ht(O,O,Sn(T.center.lat)),Pe(O,O,[0,0,E]),Fe(O,O,[I,I,I*N]),Pe(O,O,[T.point.x-.5*C,T.point.y-.5*C,0]),fe(O,O,y),fe(O,T.globeMatrix,O)}(a,e);return function(y,T,C){const I=(H,X,te)=>{const ae=Br(H),de=Br(X),pe=Et(H,X,te);return Ht(pe,pe,1/Br(pe)*Ir(ae,de,te))},N=I([y[0],y[1],y[2]],[T[0],T[1],T[2]],C),O=I([y[4],y[5],y[6]],[T[4],T[5],T[6]],C),L=I([y[8],y[9],y[10]],[T[8],T[9],T[10]],C),V=Et([y[12],y[13],y[14]],[T[12],T[13],T[14]],C);return[N[0],N[1],N[2],0,O[0],O[1],O[2],0,L[0],L[1],L[2],0,V[0],V[1],V[2],1]}(d,g,u)}return d}function iA(a,e,o,u){const d=Dn.projectAabbCorners(u,o);let g=Number.MAX_VALUE,y=-1;for(let I=0;I<d.length;++I){const N=d[I];N[0]=(.5*N[0]+.5)*e.width,N[1]=(.5-.5*N[1])*e.height,N[2]<g&&(y=I,g=N[2])}const T=I=>new Ot(d[I][0],d[I][1]);let C;switch(y){case 0:case 6:C=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:C=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:C=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:C=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(Xo(a,C))return g}const Bj=Tn([{name:"a_pos_3f",components:3,type:"Float32"}]),Vj=Tn([{name:"a_color_3f",components:3,type:"Float32"}]),Uj=Tn([{name:"a_color_4f",components:4,type:"Float32"}]),$j=Tn([{name:"a_uv_2f",components:2,type:"Float32"}]),Hj=Tn([{name:"a_normal_3f",components:3,type:"Float32"}]),Gj=Tn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qj=Tn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),sA={None:0,Model:1,Symbol:2,FillExtrusion:4};class iv{constructor(e,o,u,d){this.message=(e?`${e}: `:"")+u,d&&(this.identifier=d),o!=null&&o.__line__&&(this.line=o.__line__)}}function zb(a,e){const o=a.indexOf("://")===-1;try{return new URL(a,o&&e?"http://example.com":void 0),!0}catch{return!1}}class oA{constructor(e,o){this.feature=e,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class aA{constructor(){this.instancedDataArray=new Xu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class jb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,o){}populate(e,o,u,d){this.tileToMeter=Je(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:C,sourceLayerIndex:I}of e){const N=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),O=Bt(y,g);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom,{worldview:this.worldview}),O,u))continue;const L={id:N,sourceLayerIndex:I,index:C,geometry:g?O.geometry:qt(y,u,d),properties:y.properties,type:y.type,patterns:{}},V=this.addFeature(L,L.geometry,O);V&&o.featureIndex.insert(y,L.geometry,C,I,this.index,this.instancesPerModel[V].instancedDataArray.length,jt/32)}this.lookup=null}update(e,o,u,d){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const T in e)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],e[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const d of u.features){const g=this.layers[0],y=d.feature,T=this.canonical,C=g.paint.get("model-rotation").evaluate(y,{},T),I=g.paint.get("model-scale").evaluate(y,{},T),N=g.paint.get("model-translation").evaluate(y,{},T);ri(d.rotation,C)&&ri(d.scale,I)&&ri(d.translation,N)||(this.evaluate(d,d.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,o,u,d){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const g=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(tb(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const T in this.instancesPerModel){const C=this.instancesPerModel[T],I=C.instancedDataArray;for(const N of C.features){const O=N.instancedDataOffset,L=N.instancedDataCount;for(let V=0;V<L;V++){const H=16*(V+O);let X=I.float32[H+0];const te=X>jt;X=te?X-jt:X;const ae=Math.floor(X),de=I.float32[H+1];let pe=!1;for(const Q of this.activeReplacements)if(!Q2(Q,u,sA.Model,d)&&!(Q.min.x>ae||ae>Q.max.x||Q.min.y>de||de>Q.max.y)&&(pe=sE(iE(ae,de,e.canonical,Q.footprintTileId.canonical),Q.footprint),pe))break;I.float32[H]=pe?X+jt:X,y=y||pe!==te}}}return y}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,Gj.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)e.removeModel(o,"",!0)}addFeature(e,o,u){const d=this.layers[0],g=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Hr(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(zb(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new aA);const y=this.instancesPerModel[g],T=y.instancedDataArray,C=new oA(u,T.length);for(const I of o)for(const N of I){if(N.x<0||N.x>=jt||N.y<0||N.y>=jt)continue;const O=(this.lookupDim-1)/jt,L=this.lookupDim*(N.y*O|0)+N.x*O|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const V=T.length;T.resize(V+1),y.instancesEvaluatedElevation.push(0),T.float32[16*V]=N.x,T.float32[16*V+1]=N.y}return C.instancedDataCount=y.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(e.id&&(y.idToFeaturesIndex[e.id]=y.features.length),y.features.push(C),this.evaluate(C,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(e,o,u,d){const g=this.layers[0],y=e.feature,T=this.canonical,C=e.rotation=g.paint.get("model-rotation").evaluate(y,o,T),I=e.scale=g.paint.get("model-scale").evaluate(y,o,T),N=e.translation=g.paint.get("model-translation").evaluate(y,o,T),O=g.paint.get("model-color").evaluate(y,o,T);O.a=g.paint.get("model-color-mix-intensity").evaluate(y,o,T);const L=[];this.maxVerticalOffset<N[2]&&(this.maxVerticalOffset=N[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),nA(L,C,I);const V=Math.round(100*O.a)+O.b/1.05;for(let H=0;H<e.instancedDataCount;++H){const X=e.instancedDataOffset+H,te=16*X,ae=u.instancedDataArray.float32;let de=0;d&&(de=ae[te+6]-u.instancesEvaluatedElevation[X]);const pe=0|ae[te+1];ae[te]=(0|ae[te])+O.r/1.05,ae[te+1]=pe+O.g/1.05,ae[te+2]=V,ae[te+3]=1/(T.z>10?this.tileToMeter:Je(T,pe)),ae[te+4]=N[0],ae[te+5]=N[1],ae[te+6]=N[2]+de,ae[te+7]=L[0],ae[te+8]=L[1],ae[te+9]=L[2],ae[te+10]=L[4],ae[te+11]=L[5],ae[te+12]=L[6],ae[te+13]=L[8],ae[te+14]=L[9],ae[te+15]=L[10],u.instancesEvaluatedElevation[X]=N[2]}}}let lA,cA;Zt(jb,"ModelBucket",{omit:["layers"]}),Zt(aA,"PerModelAttributes"),Zt(oA,"ModelFeature");const Wm=64,Jg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function uA(a,e,o,u,d,g,y,T,C,I=!1){const N=o.zoom,O=o.project(u),L=mt(u.lat,N),V=1/L;W(a),Pe(a,a,[O.x+y[0]*V,O.y+y[1]*V,y[2]]);let H=1,X=1;const te=o.worldSize;if(I){if(o.projection.name==="mercator"){let Q=0;o.elevation&&(Q=o.elevation.getAtPointOrZero(new Le(O.x/te,O.y/te),0));const he=zi([],[O.x,O.y,Q,1],o.projMatrix)[3]/o.cameraToCenterDistance;H=he,X=he*mt(o.center.lat,N)}else if(o.projection.name==="globe"){const Q=Lb(a,o),he=[0,0,0,1];zi(he,he,fe([],o.projMatrix,Q));const me=he[3]/o.cameraToCenterDistance,_e=mn(N),De=o.projection.pixelsPerMeter(u.lat,te)*mt(u.lat,N),ke=o.projection.pixelsPerMeter(o.center.lat,te)*mt(o.center.lat,N);H=me/Ir(De,it(o.center.lat),_e),X=me*L/De,H*=ke,X*=ke}}else H=V;Fe(a,a,[H,H,X]);const ae=[...a],de=e.orientation,pe=[];if(nA(pe,[de[0]+d[0],de[1]+d[1],de[2]+d[2]],g),fe(a,ae,pe),T&&o.elevation){let Q=0;const he=[];if(C&&o.elevation){Q=function(_e,De,ke,Oe,Ve){const tt=De.elevation;if(!tt)return 0;const vt=Dn.projectAabbCorners(ke,Oe),ft=Ie(1,Ve.lat)*De.worldSize,xt=function(At,Gr){const tr=[0,0,1],nr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const jr of nr){const rn=At[jr.corners[0]],Kr=At[jr.corners[1]],hn=At[jr.corners[2]],sn=[Kr[0]-rn[0],Kr[1]-rn[1],Gr*(Kr[2]-rn[2])],dn=lr(sn,sn,[hn[0]-rn[0],hn[1]-rn[1],Gr*(hn[2]-rn[2])]);Rr(dn,dn),jr.dotProductWithUp=ar(dn,tr)}return nr.sort((jr,rn)=>jr.dotProductWithUp-rn.dotProductWithUp),nr[0].corners}(vt,ft),St=vt[xt[0]],nt=vt[xt[1]],_t=vt[xt[2]],et=vt[xt[3]],rt=tt.getAtPointOrZero(new Le(St[0]/De.worldSize,St[1]/De.worldSize),0),Mt=tt.getAtPointOrZero(new Le(nt[0]/De.worldSize,nt[1]/De.worldSize),0),Pt=tt.getAtPointOrZero(new Le(_t[0]/De.worldSize,_t[1]/De.worldSize),0),yr=tt.getAtPointOrZero(new Le(et[0]/De.worldSize,et[1]/De.worldSize),0),rr=(rt+yr)/2,$t=(Mt+Pt)/2;return rr>$t?Mt<Pt?nv(_e,nt,et,St,Mt,yr,rt,ft):nv(_e,_t,St,et,Pt,rt,yr,ft):rt<yr?nv(_e,St,nt,_t,rt,Mt,Pt,ft):nv(_e,et,_t,nt,yr,Pt,Mt,ft),Math.max(rr,$t)}(he,o,e.aabb,a,u);const me=fe([],hr([],he),pe);fe(a,ae,me)}else Q=o.elevation.getAtPointOrZero(new Le(O.x/te,O.y/te),0);Q!==0&&(a[14]+=Q)}}function v_(a,e,o=!1){a.uploaded||(a.gfxTexture=new Nb(e,a.image,o?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function Wj(a,e,o){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,Bj.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,Hj.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,$j.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?Vj:Uj).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,qj.members,!0)),a.segments=si.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&v_(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&v_(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&v_(u.normalTexture,e),u.occlusionTexture&&v_(u.occlusionTexture,e,o),u.emissionTexture&&v_(u.emissionTexture,e)}function Fb(a,e,o){if(a.meshes)for(const u of a.meshes)Wj(u,e,o);if(a.children)for(const u of a.children)Fb(u,e,o)}function sv(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)sv(e)}function Bb(a){if(a.meshes)for(const o of a.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((e=o.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const o of a.children)Bb(o)}class Qg{constructor(e,o,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(e,o,u){const d=u||e.findDEMTileFor(o);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,T=1<<o.canonical.z-y.canonical.z;return new Qg(d,g.dim/jt/T,[(o.canonical.x/T-y.canonical.x)*g.dim,(o.canonical.y/T-y.canonical.y)*g.dim])}tileCoordToPixel(e,o){const u=o*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(u);return new Ot(d,g)}getElevationAt(e,o,u,d){const g=e*this._scale+this._offset[0],y=o*this._scale+this._offset[1],T=Math.floor(g),C=Math.floor(y),I=this._dem;return d=!!d,u?Ir(Ir(I.get(T,C,d),I.get(T,C+1,d),y-C),Ir(I.get(T+1,C,d),I.get(T+1,C+1,d),y-C),g-T):I.get(T,C,d)}getElevationAtPixel(e,o,u){return this._dem.get(e,o,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ie(1,e)*this._dem.stride}}const Vb=new Float32Array(262144),Zm=new Uint8Array(262144);function hA(a){let e=0;if(a.meshes)for(const o of a.meshes)e=Math.max(e,o.aabb.max[2]);if(a.children)for(const o of a.children)e=Math.max(e,hA(o));return e}function dA(a,e,o){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const d=Dn.applyTransform(u.aabb,a.matrix);o.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(const u of a.children)dA(u,e,o)}const fA=["","wall","door","roof","window","lamp","logo"];class pA{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:hA(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const o=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=Dn.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),e++;this.aabb=o}return this.aabb}}class ov{constructor(e,o,u,d,g,y,T,C){this.id=u,this.layers=e,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=Jg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=Jg.HasMapboxMeshFeatures),g&&(this.modelTraits|=Jg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const I of o)this.nodesInfo.push(new pA(I)),dA(I,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,o){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&o.push({footprint:d.footprint,id:e})}}update(e){const o=Object.keys(e).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!qa(e,this.states))for(const d of u)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const d=u.node;this.uploaded?this.updatePbrBuffer(d):Fb(d,e,!0)}for(const u of o)sv(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let o=!1;if(!e.meshes)return o;for(const u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(e,o,u){const d=e.transform.projectionOptions,g=e.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||b_(u.paint.get("model-color").value,y)||b_(u.paint.get("model-color-mix-intensity").value,y)||b_(u.paint.get("model-roughness").value,y)||b_(u.paint.get("model-emissive-strength").value,y)||b_(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=d,this.brightness=g;const T=this.getNodesInfo();for(const C of T)C.state=null;return!0}return!1}evaluateTransform(e,o){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=o.paint.get("model-translation").evaluate(y,{},d),g.evaluatedScale=o.paint.get("model-scale").evaluate(y,{},d)}}evaluate(e,o){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const g=d.feature,y=o&&o[g.id];if(qa(y,d.state))continue;d.state=structuredClone(y);const T=d.node.meshes&&d.node.meshes[0].featureData,C=d.evaluatedColor[2],I=d.evaluatedRMEA[2],N=this.id.canonical;if(d.hasTranslucentParts=!1,T){for(let O=0;O<fA.length;O++){const L=fA[O];L.length&&(g.properties.part=L);const V=e.paint.get("model-color").evaluate(g,y,N).toPremultipliedRenderColor(null),H=e.paint.get("model-color-mix-intensity").evaluate(g,y,N);d.evaluatedColor[O]=[V.r,V.g,V.b,H],d.evaluatedRMEA[O][0]=e.paint.get("model-roughness").evaluate(g,y,N),d.evaluatedRMEA[O][2]=e.paint.get("model-emissive-strength").evaluate(g,y,N),d.evaluatedRMEA[O][3]=V.a,d.emissionHeightBasedParams[O]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,N),!d.hasTranslucentParts&&V.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,Xj(d,C!==d.evaluatedColor[2]||I!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(g,y,N);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(g,y,N),d.evaluatedScale=e.paint.get("model-scale").evaluate(g,y,N),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,o,u,d){const g=e.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=Qg.create(e,u,g);if(!y)return;this.modelTraits&Jg.HasMapboxMeshFeatures&&this.updateDEM(e,y,u,d);for(const T of this.getNodesInfo()){const C=T.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const I=C.footprint.vertices;let N=y.getElevationAt(I[0].x,I[0].y,!0,!0);for(let O=1;O<I.length;O++)N=Math.min(N,y.getElevationAt(I[O].x,I[O].y,!0,!0));C.elevation=N}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=o}}updateDEM(e,o,u,d){let g=o._dem._modifiedForSources[d];if(g===void 0&&(o._dem._modifiedForSources[d]=[],g=o._dem._modifiedForSources[d]),g.includes(u.canonical))return;const y=o._dem.dim;g.push(u.canonical);let T=!1;for(const C of this.getNodesInfo()){const I=C.node;if(!I.footprint||!I.footprint.grid)continue;const N=I.footprint.grid,O=o.tileCoordToPixel(N.min.x,N.min.y),L=o.tileCoordToPixel(N.max.x,N.max.y),V=Math.min(Math.min(y-L.y,O.x),Math.min(O.y,y-L.x));if(V<0)continue;const H=Ee(V,2,5);let X=Math.max(0,O.x-H),te=Math.max(0,O.y-H),ae=Math.min(L.x+H,y-1),de=Math.min(L.y+H,y-1);for(let me=te;me<=de;++me)for(let _e=X;_e<=ae;++_e)Zm[me*y+_e]=255;let pe=0,Q=0;for(let me=0;me<N.cellsY;++me)for(let _e=0;_e<N.cellsX;++_e){if(!N.cells[me*N.cellsX+_e])continue;const De=o.tileCoordToPixel(N.min.x+_e/N.xScale,N.min.y+me/N.yScale),ke=o.tileCoordToPixel(N.min.x+(_e+1)/N.xScale,N.min.y+(me+1)/N.yScale);for(let Oe=De.y;Oe<=Math.min(ke.y+1,y-1);++Oe)for(let Ve=De.x;Ve<=Math.min(ke.x+1,y-1);++Ve)Zm[Oe*y+Ve]===255&&(Zm[Oe*y+Ve]=0,pe+=o.getElevationAtPixel(Ve,Oe),Q++)}const he=pe/Q;X=Math.max(1,O.x-H),te=Math.max(1,O.y-H),ae=Math.min(L.x+H,y-2),de=Math.min(L.y+H,y-2),T=!0;for(let me=te;me<=de;++me)for(let _e=X;_e<=ae;++_e)Zm[me*y+_e]===0&&(Vb[me*y+_e]=o._dem.set(_e,me,he));for(let me=1;me<H;++me){X=Math.max(1,O.x-me),te=Math.max(1,O.y-me),ae=Math.min(L.x+me,y-2),de=Math.min(L.y+me,y-2);for(let _e=te;_e<=de;++_e)for(let De=X;De<=ae;++De){const ke=_e*y+De;if(Zm[ke]===255){let Oe=0,Ve=0,tt=-1,vt=-1;for(let ft=-1;ft<=1;++ft)for(let xt=-1;xt<=1;++xt){const St=(_e+ft)*y+De+xt;if(Zm[St]>=me)continue;const nt=Vb[St],_t=Math.abs(nt);_t>Ve&&(Oe=nt,Ve=_t,tt=xt,vt=ft)}if(Ve>.1){const ft=1-(me+.5*Math.abs(tt*vt))/H;let xt=o._dem.get(De,_e)+Oe*ft;const St=o._dem.get(De+tt,_e+vt),nt=o._dem.get(De-tt,_e-vt,!0);(xt-St)*(xt-nt)>0&&(xt=(St+nt)/2),Vb[ke]=o._dem.set(De,_e,xt),Zm[ke]=me}}}}}T&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Wa.now())}setFilter(e){this.filter=e?Kd(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Hn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const o of e)sv(o.node),Bb(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(e.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(e,o){const u=[],d=[0,0,0],g=W([]);for(const y of this.getNodesInfo()){const T=y.node.meshes[0],C=T.transformedAabb;if(e<C.min[0]||o<C.min[1]||e>C.max[0]||o>C.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};ie(g,y.node.matrix),d[0]=e,d[1]=o,Cr(d,d,g);const I=(d[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*Wm|0,N=Math.min(63,(d[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*Wm|0)*Wm+Math.min(63,I),O=T.heightmap[N];if(!(O<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:O,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Ot(e,o),new Ot(e,o),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function b_(a,e){return a instanceof Kc&&!a.isLightConstant&&e}function Zj(a,e,o,u,d,g,y,T){let C=(61440&e|(61440&e)>>4)>>8,I=(3840&e|(3840&e)>>4)>>4,N=240&e|(240&e)>>4;o[3]>0&&(C=Ir(C,255*o[0],o[3]),I=Ir(I,255*o[1],o[3]),N=Ir(N,255*o[2],o[3]));const O=C<<8|I,L=N<<8|Math.floor(255*u[3]),V=function(me){const _e=Ee(me,0,2);return Math.min(Math.round(.5*_e*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],H=Ee(d[0],0,1),X=Ee(d[1],0,1),te=Ee(d[2],0,1),ae=Ee(d[3],0,1);let de,pe,Q,he;if(H!==X&&y!==g&&X!==H){const me=y-g;pe=1/(me*(X-H)),Q=-(g+me*H)/(me*(X-H));const _e=Ee(d[4],-1,1);he=Math.pow(10,_e),de=255*te<<8|255*ae}else de=65535,pe=0,Q=1,he=1;if(a.emplaceBack(O,L,V,de,pe,Q,he),T){const me=T.length;T.clear();for(let _e=0;_e<me;_e++)T.emplaceBack(O,L,V,de,pe,Q,he)}}function Xj(a,e,o){const u=a.node;let d=0;const g=o&Jg.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===d||!y.featureData)continue;y.featureArray=new ed,y.featureArray.reserve(y.featureData.length);let T=e;for(const C of y.featureData){const I=g?65535&C:C>>16&65535,N=g?C>>16&65535:65535&C,O=(15&N)<8?15&N:0,L=a.evaluatedRMEA[O],V=a.evaluatedColor[O],H=a.emissionHeightBasedParams[O];let X;if(T&&O===2&&u.lights&&(X=new ed,X.resize(10*u.lights.length)),Zj(y.featureArray,I,V,L,H,y.aabb.min[2],y.aabb.max[2],X),X&&T){T=!1;const te=u.meshes[u.lightMeshIndex];te.featureArray=X,te.featureArray._trim()}}y.featureArray._trim(),d++}}function mA(a,e,o,u){const d=1<<a.z;e.lat=Be((u/jt+a.y)/d),e.lng=Re((o/jt+a.x)/d)}function Kj(a,e,o,u){const d=a.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const y=d.node,T=o.tile,C=u.calculatePosMatrix(T.tileID.toUnwrapped(),u.worldSize),I=d.evaluatedScale;let N=0;u.elevation&&y.elevation&&(N=y.elevation*u.elevation.exaggeration()),Pe(C,C,[(y.anchor?y.anchor[0]:0)*(I[0]-1),(y.anchor?y.anchor[1]:0)*(I[1]-1),N]),Fe(C,C,I);const O=o.queryGeometry,L=O.isPointQuery()?O.screenBounds:O.screenGeometry,V=function(X){const te=fe([],C,X.matrix);fe(te,u.expandedFarZProjMatrix,te);for(let ae=0;ae<X.meshes.length;++ae){const de=X.meshes[ae];if(ae===X.lightMeshIndex)continue;const pe=iA(L,u,te,de.aabb);pe!=null&&(g=Math.min(pe,g))}if(X.children)for(const ae of X.children)V(ae)};if(V(y),g===Number.MAX_VALUE)return;const H=new ce(0,0);return mA(T.tileID.canonical,H,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:H,feature:d.feature}}Zt(ov,"Tiled3dModelBucket",{omit:["layers"]}),Zt(pA,"Tiled3dModelFeature");const Yj={circle:class extends lo{constructor(a,e,o,u){super(a,{layout:Vg||(Vg=new Di({"circle-sort-key":new zt($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt($e.layout_circle["circle-elevation-reference"]),visibility:new Tt($e.layout_circle.visibility)})),paint:Fm||(Fm=new Di({"circle-radius":new zt($e.paint_circle["circle-radius"]),"circle-color":new zt($e.paint_circle["circle-color"]),"circle-blur":new zt($e.paint_circle["circle-blur"]),"circle-opacity":new zt($e.paint_circle["circle-opacity"]),"circle-translate":new Tt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}createBucket(a){return new da(a)}queryRadius(a){const e=a;return bp("circle-radius",this,e)+bp("circle-stroke-width",this,e)+zm(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,o,u,d,g,y,T){const C=jm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return A2(a,u,g,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,o){const u=C2(this);return{config:new Po(this,{zoom:e,lut:o}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends lo{createBucket(a){return new M2(a)}constructor(a,e,o,u){super(a,{layout:k2||(k2=new Di({visibility:new Tt($e.layout_heatmap.visibility)})),paint:P2||(P2=new Di({"heatmap-radius":new zt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return bp("heatmap-radius",this,a)}queryIntersectsFeature(a,e,o,u,d,g,y,T){const C=this.paint.get("heatmap-radius").evaluate(e,o);return A2(a,u,g,y,T,!0,!0,new Ot(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,o){return a==="heatmap"?{config:new Po(this,{zoom:e,lut:o}),overrideFog:!1}:{}}},hillshade:class extends lo{constructor(a,e,o,u){super(a,{layout:R2||(R2=new Di({visibility:new Tt($e.layout_hillshade.visibility)})),paint:N2||(N2=new Di({"hillshade-illumination-direction":new Tt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,o){return{overrideFog:!1}}},fill:class extends lo{constructor(a,e,o,u){super(a,{layout:Z2||(Z2=new Di({"fill-sort-key":new zt($e.layout_fill["fill-sort-key"]),visibility:new Tt($e.layout_fill.visibility),"fill-elevation-reference":new Tt($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new zt($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:X2||(X2=new Di({"fill-antialias":new Tt($e.paint_fill["fill-antialias"]),"fill-opacity":new zt($e.paint_fill["fill-opacity"]),"fill-color":new zt($e.paint_fill["fill-color"]),"fill-outline-color":new zt($e.paint_fill["fill-outline-color"]),"fill-translate":new Tt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new zt($e.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt($e.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new zt($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new zt($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new zt($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(a,e,o){return{config:new Po(this,{zoom:e,lut:o}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new J1(a)}queryRadius(){return zm(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,o,u,d,g){return!a.queryGeometry.isAboveHorizon&&fa(Bg(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends lo{constructor(a,e,o,u){super(a,{layout:vE||(vE=new Di({visibility:new Tt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:bE||(bE=new Di({"fill-extrusion-opacity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zt($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt($e["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new zt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zt($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new zt($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Px(a)}queryRadius(){return zm(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,o,u,d,g,y,T,C){const I=jm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,o),O=this.paint.get("fill-extrusion-base").evaluate(e,o),L=[0,0],V=T&&g.elevation,H=g.elevation?g.elevation.exaggeration():1,X=a.tile.getBucket(this);if(V&&X instanceof Px){const Q=X.centroidVertexArray,he=C+1;he<Q.length&&(L[0]=Q.geta_centroid_pos0(he),L[1]=Q.geta_centroid_pos1(he))}if(L[0]===0&&L[1]===1)return!1;g.projection.name==="globe"&&(u=xE([u],[new Ot(0,0),new Ot(jt,jt)],a.tileID.canonical).map(Q=>Q.polygon).flat());const te=V?T:null,[ae,de]=function(Q,he,me,_e,De,ke,Oe,Ve,tt,vt,ft){return Q.projection.name==="globe"?function(xt,St,nt,_t,et,rt,Mt,Pt,yr,rr,$t){const At=[],Gr=[],tr=xt.projection.upVectorScale($t,xt.center.lat,xt.worldSize).metersToTile,nr=[0,0,0,1],jr=[0,0,0,1],rn=(hn,sn,dn,qn)=>{hn[0]=sn,hn[1]=dn,hn[2]=qn,hn[3]=1},Kr=_E();nt>0&&(nt+=Kr),_t+=Kr;for(const hn of St){const sn=[],dn=[];for(const qn of hn){const Si=qn.x+et.x,ye=qn.y+et.y,Se=xt.projection.projectTilePoint(Si,ye,$t),ot=xt.projection.upVector($t,qn.x,qn.y);let Lt=nt,Gt=_t;if(Mt){const Ut=AE(Si,ye,nt,_t,Mt,Pt,yr,rr);Lt+=Ut.base,Gt+=Ut.top}nt!==0?rn(nr,Se.x+ot[0]*tr*Lt,Se.y+ot[1]*tr*Lt,Se.z+ot[2]*tr*Lt):rn(nr,Se.x,Se.y,Se.z),rn(jr,Se.x+ot[0]*tr*Gt,Se.y+ot[1]*tr*Gt,Se.z+ot[2]*tr*Gt),Cr(nr,nr,rt),Cr(jr,jr,rt),sn.push(new $m(nr[0],nr[1],nr[2])),dn.push(new $m(jr[0],jr[1],jr[2]))}At.push(sn),Gr.push(dn)}return[At,Gr]}(Q,he,me,_e,De,ke,Oe,Ve,tt,vt,ft):Oe?function(xt,St,nt,_t,et,rt,Mt,Pt,yr){const rr=[],$t=[],At=[0,0,0,1];for(const Gr of xt){const tr=[],nr=[];for(const jr of Gr){const rn=jr.x+_t.x,Kr=jr.y+_t.y,hn=AE(rn,Kr,St,nt,rt,Mt,Pt,yr);At[0]=rn,At[1]=Kr,At[2]=hn.base,At[3]=1,zi(At,At,et),At[3]=Math.max(At[3],1e-5);const sn=new $m(At[0]/At[3],At[1]/At[3],At[2]/At[3]);At[0]=rn,At[1]=Kr,At[2]=hn.top,At[3]=1,zi(At,At,et),At[3]=Math.max(At[3],1e-5);const dn=new $m(At[0]/At[3],At[1]/At[3],At[2]/At[3]);tr.push(sn),nr.push(dn)}rr.push(tr),$t.push(nr)}return[rr,$t]}(he,me,_e,De,ke,Oe,Ve,tt,vt):function(xt,St,nt,_t,et){const rt=[],Mt=[],Pt=et[8]*St,yr=et[9]*St,rr=et[10]*St,$t=et[11]*St,At=et[8]*nt,Gr=et[9]*nt,tr=et[10]*nt,nr=et[11]*nt;for(const jr of xt){const rn=[],Kr=[];for(const hn of jr){const sn=hn.x+_t.x,dn=hn.y+_t.y,qn=et[0]*sn+et[4]*dn+et[12],Si=et[1]*sn+et[5]*dn+et[13],ye=et[2]*sn+et[6]*dn+et[14],Se=et[3]*sn+et[7]*dn+et[15],ot=qn+Pt,Lt=Si+yr,Gt=ye+rr,Ut=Math.max(Se+$t,1e-5),er=qn+At,Lr=Si+Gr,yn=ye+tr,_n=Math.max(Se+nr,1e-5);rn.push(new $m(ot/Ut,Lt/Ut,Gt/Ut)),Kr.push(new $m(er/_n,Lr/_n,yn/_n))}rt.push(rn),Mt.push(Kr)}return[rt,Mt]}(he,me,_e,De,ke)}(g,u,O,N,I,y,te,L,H,g.center.lat,a.tileID.canonical),pe=a.queryGeometry;return function(Q,he,me){let _e=1/0;fa(me,he)&&(_e=CE(me,he[0]));for(let De=0;De<he.length;De++){const ke=he[De],Oe=Q[De];for(let Ve=0;Ve<ke.length-1;Ve++){const tt=ke[Ve],vt=[tt,ke[Ve+1],Oe[Ve+1],Oe[Ve],tt];Xo(me,vt)&&(_e=Math.min(_e,CE(me,vt)))}}return _e!==1/0&&_e}(ae,de,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},building:class extends lo{constructor(a,e,o,u){super(a,{layout:FE||(FE=new Di({visibility:new Tt($e.layout_building.visibility),"building-roof-shape":new zt($e.layout_building["building-roof-shape"]),"building-height":new zt($e.layout_building["building-height"]),"building-base":new zt($e.layout_building["building-base"])})),paint:BE||(BE=new Di({"building-opacity":new Tt($e.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Tt($e.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt($e.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt($e.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt($e.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt($e.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt($e.paint_building["building-cast-shadows"]),"building-color":new zt($e.paint_building["building-color"]),"building-emissive-strength":new zt($e.paint_building["building-emissive-strength"]),"building-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new jE(a)}},line:class extends lo{constructor(a,e,o,u){const d=KE();super(a,d,e,o,u),d.layout&&(this.layout=new ml(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(c_)return c_;const o=KE();return c_=new Zz(o.paint.properties["line-width"].specification),c_.useIntegerZoom=!0,c_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new hb(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,o){const u=ZE(this);return{config:new Po(this,{zoom:e,lut:o}),defines:u,overrideFog:!1}}queryRadius(a){const e=a,o=YE(bp("line-width",this,e),bp("line-gap-width",this,e)),u=bp("line-offset",this,e);return o/2+Math.abs(u)+zm(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,o,u,d,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=Bg(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=a.pixelToTileUnitsFactor/2*YE(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),C=this.paint.get("line-offset").evaluate(e,o);return C&&(u=function(I,N){const O=[],L=new Ot(0,0);for(let V=0;V<I.length;V++){const H=I[V],X=[];for(let te=0;te<H.length;te++){const ae=H[te],de=H[te+1],pe=te===0?L:ae.sub(H[te-1])._unit()._perp(),Q=te===H.length-1?L:de.sub(ae)._unit()._perp(),he=pe._add(Q)._unit();he._mult(1/(he.x*Q.x+he.y*Q.y)),X.push(he._mult(N)._add(ae))}O.push(X)}return O}(u,C*a.pixelToTileUnitsFactor)),function(I,N,O){for(let L=0;L<N.length;L++){const V=N[L];if(I.length>=3){for(let H=0;H<V.length;H++)if(xl(I,V[H]))return!0}if(pa(I,V,O))return!0}return!1}(y,u,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Jx,background:class extends lo{constructor(a,e,o,u){super(a,{layout:VC||(VC=new Di({visibility:new Tt($e.layout_background.visibility)})),paint:UC||(UC=new Di({"background-pitch-alignment":new Tt($e.paint_background["background-pitch-alignment"]),"background-color":new Tt($e.paint_background["background-color"]),"background-pattern":new Tt($e.paint_background["background-pattern"]),"background-opacity":new Tt($e.paint_background["background-opacity"]),"background-emissive-strength":new Tt($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,o){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:WC,"raster-particle":QC,sky:class extends lo{constructor(a,e,o,u){super(a,{layout:KC||(KC=new Di({visibility:new Tt($e.layout_sky.visibility)})),paint:YC||(YC=new Di({"sky-type":new Tt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new pc($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=a.style.light,y=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&Hr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Db(y.azimuthal,90-y.polar,e):Db(u[0],90-u[1],e)}const o=this.paint.get("sky-gradient-center");return Db(o[0],90-o[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends lo{constructor(a,e,o,u){super(a,{paint:JC||(JC=new Di({}))},e,null)}},model:class extends lo{constructor(a,e,o,u){super(a,{layout:lA||(lA=new Di({visibility:new Tt($e.layout_model.visibility),"model-id":new zt($e.layout_model["model-id"])})),paint:cA||(cA=new Di({"model-opacity":new zt($e.paint_model["model-opacity"]),"model-rotation":new zt($e.paint_model["model-rotation"]),"model-scale":new zt($e.paint_model["model-scale"]),"model-translation":new zt($e.paint_model["model-translation"]),"model-color":new zt($e.paint_model["model-color"]),"model-color-mix-intensity":new zt($e.paint_model["model-color-mix-intensity"]),"model-type":new Tt($e.paint_model["model-type"]),"model-cast-shadows":new Tt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zt($e.paint_model["model-emissive-strength"]),"model-roughness":new zt($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zt($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new jb(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof ov?jt-1:0}queryIntersectsFeature(a,e,o,u,d,g){if(!this.modelManager)return!1;const y=this.modelManager,T=a.tile.getBucket(this);if(!(T&&T instanceof jb))return!1;for(const C in T.instancesPerModel){const I=T.instancesPerModel[C],N=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(N)){const O=I.features[I.idToFeaturesIndex[N]],L=y.getModel(C,this.scope);if(!L)return!1;let V=J();const H=new ce(0,0),X=T.canonical;let te=Number.MAX_VALUE;for(let ae=0;ae<O.instancedDataCount;++ae){const de=16*(O.instancedDataOffset+ae),pe=I.instancedDataArray.float32,Q=[pe[de+4],pe[de+5],pe[de+6]];mA(X,H,pe[de],0|pe[de+1]),uA(V,L,g,H,O.rotation,O.scale,Q,!1,!1,!1),g.projection.name==="globe"&&(V=Lb(V,g));const he=fe([],g.projMatrix,V),me=a.queryGeometry,_e=iA(me.isPointQuery()?me.screenBounds:me.screenGeometry,g,he,L.aabb);_e!=null&&(te=Math.min(_e,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(a,e,o){return!(!this.layout||e.isDataDriven()||o.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Yc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends lo{constructor(a,e,o,u){super(a,{layout:K2||(K2=new Di({"clip-layer-types":new Tt($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt($e.layout_clip["clip-layer-scope"])})),paint:Y2||(Y2=new Di({}))},e,o,u)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new J2(a)}is3D(a){return!0}}},Ub=new In(0,0,0),$b={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Hb={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},av={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Jj={PAINT_ORDER_FILL_AND_STROKE:1},w_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},gA={MASK_TYPE_LUMINANCE:1};function Qj(a,e,o){a===1&&e.icons.push(function(u,d){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:T}=y;T.top==null&&(T.top=T.left),T.width==null&&(T.width=g.usvg_tree.width),T.height==null&&(T.height=T.width)}return y.stretch_x&&y.stretch_x.length&&yA(y,"x"),y.stretch_y&&y.stretch_y.length&&yA(y,"y"),g}(u.readFields(e3,{name:void 0},d))}(o,o.readVarint()+o.pos))}function yA(a,e){const o=[],u=a[`stretch_${e}`];let d=null;for(let g=0;g<u.length;g++)d===null?d=o.length===0?u[0]:o[o.length-1][1]+u[g]:(o.push([d,d+u[g]]),d=null);a[`stretch_${e}_areas`]=o}function e3(a,e,o){a===1?e.name=o.readString():a===2?e.metadata=function(u,d){return u.readFields(t3,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(o,o.readVarint()+o.pos):a===3&&(e.usvg_tree=function(u,d){return u.readFields(i3,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(o,o.readVarint()+o.pos),e.data="usvg_tree")}function t3(a,e,o){a===1?e.stretch_x=o.readPackedVarint():a===2?e.stretch_y=o.readPackedVarint():a===3?e.content_area=function(u,d){return u.readFields(r3,{left:0},d)}(o,o.readVarint()+o.pos):a===4&&e.variables.push(function(u,d){return u.readFields(n3,{name:void 0},d)}(o,o.readVarint()+o.pos))}function r3(a,e,o){a===1?e.left=o.readVarint():a===2?e.width=o.readVarint():a===3?e.top=o.readVarint():a===4&&(e.height=o.readVarint())}function n3(a,e,o){a===1?e.name=o.readString():a===2&&(e.rgb_color=uv(o.readVarint()),e.value="rgb_color")}function i3(a,e,o){a===1?e.width=e.height=o.readVarint():a===2?e.height=o.readVarint():a===3?e.children.push(lv(o,o.readVarint()+o.pos)):a===4?e.linear_gradients.push(function(u,d){return u.readFields(h3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(o,o.readVarint()+o.pos)):a===5?e.radial_gradients.push(function(u,d){return u.readFields(f3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(o,o.readVarint()+o.pos)):a===7?e.clip_paths.push(function(u,d){return u.readFields(p3,{children:[]},d)}(o,o.readVarint()+o.pos)):a===8&&e.masks.push(function(u,d){const g=u.readFields(m3,{left:0,width:20,mask_type:gA.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(o,o.readVarint()+o.pos))}function lv(a,e){return a.readFields(s3,{},e)}function s3(a,e,o){a===1?(e.group=function(u,d){return u.readFields(o3,{opacity:255,children:[]},d)}(o,o.readVarint()+o.pos),e.node="group"):a===2&&(e.path=function(u,d){return u.readFields(l3,{paint_order:1,commands:[],step:1,diffs:[],rule:$b.PATH_RULE_NON_ZERO},d)}(o,o.readVarint()+o.pos),e.node="path")}function o3(a,e,o){a===1?e.transform=cv(o,o.readVarint()+o.pos):a===2?e.opacity=o.readVarint():a===5?e.clip_path_idx=o.readVarint():a===6?e.mask_idx=o.readVarint():a===7&&e.children.push(lv(o,o.readVarint()+o.pos))}function cv(a,e){return a.readFields(a3,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function a3(a,e,o){a===1?e.sx=o.readFloat():a===2?e.ky=o.readFloat():a===3?e.kx=o.readFloat():a===4?e.sy=o.readFloat():a===5?e.tx=o.readFloat():a===6&&(e.ty=o.readFloat())}function l3(a,e,o){a===1?e.fill=function(u,d){return u.readFields(c3,{rgb_color:Ub,paint:"rgb_color",opacity:255},d)}(o,o.readVarint()+o.pos):a===2?e.stroke=function(u,d){return u.readFields(u3,{rgb_color:Ub,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(o,o.readVarint()+o.pos):a===3?e.paint_order=o.readVarint():a===5?o.readPackedVarint(e.commands):a===6?e.step=o.readFloat():a===7?o.readPackedSVarint(e.diffs):a===8&&(e.rule=o.readVarint())}function c3(a,e,o){a===1?(e.rgb_color=uv(o.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=o.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=o.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=o.readVarint())}function uv(a){return new In((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function u3(a,e,o){a===1?(e.rgb_color=uv(o.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=o.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=o.readVarint(),e.paint="radial_gradient_idx"):a===5?o.readPackedFloat(e.dasharray):a===6?e.dashoffset=o.readFloat():a===7?e.miterlimit=o.readFloat():a===8?e.opacity=o.readVarint():a===9?e.width=o.readFloat():a===10?e.linecap=o.readVarint():a===11&&(e.linejoin=o.readVarint())}function h3(a,e,o){a===1?e.transform=cv(o,o.readVarint()+o.pos):a===2?e.spread_method=o.readVarint():a===3?e.stops.push(_A(o,o.readVarint()+o.pos)):a===4?e.x1=o.readFloat():a===5?e.y1=o.readFloat():a===6?e.x2=o.readFloat():a===7&&(e.y2=o.readFloat())}function _A(a,e){return a.readFields(d3,{offset:0,opacity:255,rgb_color:Ub},e)}function d3(a,e,o){a===1?e.offset=o.readFloat():a===2?e.opacity=o.readVarint():a===3&&(e.rgb_color=uv(o.readVarint()))}function f3(a,e,o){a===1?e.transform=cv(o,o.readVarint()+o.pos):a===2?e.spread_method=o.readVarint():a===3?e.stops.push(_A(o,o.readVarint()+o.pos)):a===4?e.cx=o.readFloat():a===5?e.cy=o.readFloat():a===6?e.r=o.readFloat():a===7?e.fx=o.readFloat():a===8?e.fy=o.readFloat():a===9&&(e.fr=o.readFloat())}function p3(a,e,o){a===1?e.transform=cv(o,o.readVarint()+o.pos):a===2?e.clip_path_idx=o.readVarint():a===3&&e.children.push(lv(o,o.readVarint()+o.pos))}function m3(a,e,o){a===1?e.left=e.top=o.readFloat():a===2?e.width=e.height=o.readFloat():a===3?e.top=o.readFloat():a===4?e.height=o.readFloat():a===5?e.mask_type=o.readVarint():a===6?e.mask_idx=o.readVarint():a===7&&e.children.push(lv(o,o.readVarint()+o.pos))}class g3{static calculate(e={},o=[]){const u=new Map,d=new Map;if(Object.keys(e).length===0)return u;o.forEach(g=>{d.set(g.name,g.rgb_color||new In(0,0,0))});for(const[g,y]of Object.entries(e))d.has(g)?u.set(d.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function ey(a,e=255,o){const u=e/255,d=a.toString(),g=o.has(d)?o.get(d).clone():a.clone();return g.a*=u,g.toString()}function S_(a,e){if(!yh()){const o=document.createElement("canvas");return o.width=a,o.height=e,o}return new OffscreenCanvas(a,e)}function y3(a,e){const o=g3.calculate(e.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,d=u.width,g=u.height,y=e.transform?e.transform:new DOMMatrix,T=Math.max(1,Math.round(d*y.a)),C=Math.max(1,Math.round(g*y.d)),I=new DOMMatrix([T/d,0,0,C/g,0,0]),N=S_(T,C).getContext("2d");return Gb(N,I,u,u,o),N.getImageData(0,0,T,C)}function Gb(a,e,o,u,d){for(const g of u.children)xA(a,e,o,g,d)}function xA(a,e,o,u,d){u.group?(a.save(),function(g,y,T,C,I){const N=C.mask_idx!=null?T.masks[C.mask_idx]:null,O=C.clip_path_idx!=null?T.clip_paths[C.clip_path_idx]:null;if(C.transform&&(y=ty(C.transform).preMultiplySelf(y)),!function(H,X,te){return H.opacity!==255||X||te}(C,O!=null,N!=null))return void Gb(g,y,T,C,I);const L=S_(g.canvas.width,g.canvas.height),V=L.getContext("2d");Gb(V,y,T,C,I),O&&CA(V,y,T,O),N&&AA(V,y,T,N,I),g.globalAlpha=C.opacity/255,g.drawImage(L,0,0)}(a,e,o,u.group,d),a.restore()):u.path&&(a.save(),function(g,y,T,C,I){g.setTransform(y),C.paint_order===Jj.PAINT_ORDER_FILL_AND_STROKE?(vA(g,T,C,I),wA(g,T,C,I)):(wA(g,T,C,I),vA(g,T,C,I))}(a,e,o,u.path,d),a.restore())}function vA(a,e,o,u){const d=o.fill;if(!d)return;const g=d.opacity/255;switch(a.save(),a.beginPath(),IA(o,a),d.paint){case"rgb_color":a.fillStyle=ey(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const y=e.linear_gradients[d.linear_gradient_idx];y.transform&&a.setTransform(ty(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=SA(a,y,g,u);break}case"radial_gradient_idx":{const y=e.radial_gradients[d.radial_gradient_idx];y.transform&&a.setTransform(ty(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=TA(a,y,g,u)}}a.fill(bA(o)),a.restore()}function bA(a){return a.rule===$b.PATH_RULE_NON_ZERO?"nonzero":a.rule===$b.PATH_RULE_EVEN_ODD?"evenodd":void 0}function wA(a,e,o,u){const d=o.stroke;if(!d)return;const g=MA(o);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;const y=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=ey(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=SA(a,e.linear_gradients[d.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":a.strokeStyle=TA(a,e.radial_gradients[d.radial_gradient_idx],y,u,!0)}switch(d.linejoin){case av.LINE_JOIN_MITER_CLIP:case av.LINE_JOIN_MITER:a.lineJoin="miter";break;case av.LINE_JOIN_ROUND:a.lineJoin="round";break;case av.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(d.linecap){case Hb.LINE_CAP_BUTT:a.lineCap="butt";break;case Hb.LINE_CAP_ROUND:a.lineCap="round";break;case Hb.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function SA(a,e,o,u,d=!1){if(e.stops.length===1){const L=e.stops[0];return ey(L.rgb_color,L.opacity*o,u)}const{x1:g,y1:y,x2:T,y2:C}=e;let I=new DOMPoint(g,y),N=new DOMPoint(T,C);if(d){const L=ty(e.transform);I=L.transformPoint(I),N=L.transformPoint(N)}const O=a.createLinearGradient(I.x,I.y,N.x,N.y);for(const L of e.stops)O.addColorStop(L.offset,ey(L.rgb_color,L.opacity*o,u));return O}function TA(a,e,o,u,d=!1){if(e.stops.length===1){const ae=e.stops[0];return ey(ae.rgb_color,ae.opacity*o,u)}const g=ty(e.transform),{fx:y,fy:T,fr:C,cx:I,cy:N,r:O}=e;let L=new DOMPoint(y,T),V=new DOMPoint(I,N),H=C,X=O;if(d){L=g.transformPoint(L),V=g.transformPoint(V);const ae=(g.a+g.d)/2;H=C*ae,X=e.r*ae}const te=a.createRadialGradient(L.x,L.y,H,V.x,V.y,X);for(const ae of e.stops)te.addColorStop(ae.offset,ey(ae.rgb_color,ae.opacity*o,u));return te}function EA(a,e,o,u){const d=u.transform?ty(u.transform).preMultiplySelf(e):e,g=S_(a.canvas.width,a.canvas.height),y=g.getContext("2d");for(const C of u.children)if(C.group)EA(y,d,o,C.group);else if(C.path){const I=C.path,N=new Path2D;N.addPath(MA(I),d),y.fill(N,bA(I))}const T=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;T&&CA(y,d,o,T),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function CA(a,e,o,u){const d=S_(a.canvas.width,a.canvas.height);EA(d.getContext("2d"),e,o,u),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function AA(a,e,o,u,d){if(u.children.length===0)return;const g=u.mask_idx!=null?o.masks[u.mask_idx]:null;g&&AA(a,e,o,g,d);const y=a.canvas.width,T=a.canvas.height,C=S_(y,T),I=C.getContext("2d"),N=u.width,O=u.height,L=u.left,V=u.top,H=new Path2D,X=new Path2D;X.rect(L,V,N,O),H.addPath(X,e),I.clip(H);for(const de of u.children)xA(I,e,o,de,d);const te=I.getImageData(0,0,y,T),ae=te.data;if(u.mask_type===gA.MASK_TYPE_LUMINANCE)for(let de=0;de<ae.length;de+=4)ae[de+3]=ae[de+3]/255*(.2126*ae[de]+.7152*ae[de+1]+.0722*ae[de+2]);I.putImageData(te,0,0),a.globalCompositeOperation="destination-in",a.drawImage(C,0,0)}function ty(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function IA(a,e){const o=a.step;let u=a.diffs[0]*o,d=a.diffs[1]*o;e.moveTo(u,d);for(let g=0,y=2;g<a.commands.length;g++)switch(a.commands[g]){case w_.PATH_COMMAND_MOVE:u+=a.diffs[y++]*o,d+=a.diffs[y++]*o,e.moveTo(u,d);break;case w_.PATH_COMMAND_LINE:u+=a.diffs[y++]*o,d+=a.diffs[y++]*o,e.lineTo(u,d);break;case w_.PATH_COMMAND_QUAD:{const T=u+a.diffs[y++]*o,C=d+a.diffs[y++]*o;u=T+a.diffs[y++]*o,d=C+a.diffs[y++]*o,e.quadraticCurveTo(T,C,u,d);break}case w_.PATH_COMMAND_CUBIC:{const T=u+a.diffs[y++]*o,C=d+a.diffs[y++]*o,I=T+a.diffs[y++]*o,N=C+a.diffs[y++]*o;u=I+a.diffs[y++]*o,d=N+a.diffs[y++]*o,e.bezierCurveTo(T,C,I,N,u,d);break}case w_.PATH_COMMAND_CLOSE:e.closePath()}return e}function MA(a){return IA(a,new Path2D)}class hv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const o=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,o),o}put(e,o){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,o)}delete(e){this.cache.delete(e)}}Zt(hv,"LRUCache");class qb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Do(e,e.data)}getFromCache(e,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new hv(150)),this.cacheMap.get(u).get(Ul(e.toString(),o))}setInCache(e,o,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new hv(150));const g=this.cacheDependenciesMap.get(d),y=Ul(e.id.toString(),u);g.get(y)||g.set(y,new Set);const T=this.cacheMap.get(d),C=e.toString();g.get(y).add(C),T.put(Ul(e.toString(),u),o)}removeImagesFromCacheByIds(e,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of e){const T=Ul(y.toString(),o);if(g.has(T)){for(const C of g.get(T))d.delete(C);g.delete(T)}}}rasterize(e,o,u,d,g=y3){const y=this.getFromCache(e,u,d);if(y)return y.clone();const T=g(o.icon,e.options),C=qb._getImage(T);return this.setInCache(e,C,u,d),C.clone()}}class kA{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const u=this.toIdx(e,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function PA(a,e,o,u){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(o[y]<a[y]||o[y]>e[y])return null}else{const T=1/u[y];let C=(a[y]-o[y])*T,I=(e[y]-o[y])*T;if(C>I){const N=C;C=I,I=N}if(C>d&&(d=C),I<g&&(g=I),d>g)return null}return d}function RA(a,e,o,u,d,g,y,T,C,I,N){const O=u-a,L=d-e,V=g-o,H=y-a,X=T-e,te=C-o,ae=N[1]*te-N[2]*X,de=N[2]*H-N[0]*te,pe=N[0]*X-N[1]*H,Q=O*ae+L*de+V*pe;if(Math.abs(Q)<1e-15)return null;const he=1/Q,me=I[0]-a,_e=I[1]-e,De=I[2]-o,ke=(me*ae+_e*de+De*pe)*he;if(ke<0||ke>1)return null;const Oe=_e*V-De*L,Ve=De*O-me*V,tt=me*L-_e*O,vt=(N[0]*Oe+N[1]*Ve+N[2]*tt)*he;return vt<0||ke+vt>1?null:(H*Oe+X*Ve+te*tt)*he}function NA(a,e,o){return(a-e)/(o-e)}function DA(a,e,o,u,d,g,y,T,C){const I=1<<o,N=g-u,O=y-d,L=(a+1)/I*N+u,V=(e+0)/I*O+d,H=(e+1)/I*O+d;T[0]=(a+0)/I*N+u,T[1]=V,C[0]=L,C[1]=H}class OA{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(g){const y=Math.ceil(Math.log2(g.dim/8)),T=[];let C=Math.ceil(Math.pow(2,y));const I=1/C,N=(V,H,X,te,ae)=>{const de=te?1:0,pe=(V+1)*X-de,Q=H*X,he=(H+1)*X-de;ae[0]=V*X,ae[1]=Q,ae[2]=pe,ae[3]=he};let O=new kA(C);const L=[];for(let V=0;V<C*C;V++){N(V%C,Math.floor(V/C),I,!1,L);const H=Ap(L[0],L[1],g),X=Ap(L[2],L[1],g),te=Ap(L[2],L[3],g),ae=Ap(L[0],L[3],g);O.minimums.push(Math.min(H,X,te,ae)),O.maximums.push(Math.max(H,X,te,ae)),O.leaves.push(1)}for(T.push(O),C/=2;C>=1;C/=2){const V=T[T.length-1];O=new kA(C);for(let H=0;H<C*C;H++){N(H%C,Math.floor(H/C),2,!0,L);const X=V.getElevation(L[0],L[1]),te=V.getElevation(L[2],L[1]),ae=V.getElevation(L[2],L[3]),de=V.getElevation(L[0],L[3]),pe=V.isLeaf(L[0],L[1]),Q=V.isLeaf(L[2],L[1]),he=V.isLeaf(L[2],L[3]),me=V.isLeaf(L[0],L[3]),_e=Math.min(X.min,te.min,ae.min,de.min),De=Math.max(X.max,te.max,ae.max,de.max),ke=pe&&Q&&he&&me;O.maximums.push(De),O.minimums.push(_e),O.leaves.push(De-_e<=5&&ke?1:0)}T.push(O)}return T}(this.dem),u=o.length-1,d=o[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(e,o,u,d,g,y,T=1){return PA([e,o,-100],[u,d,this.maximums[0]*T],g,y)}raycast(e,o,u,d,g,y,T=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,o,u,d,g,y,T);if(C==null)return null;const I=[],N=[],O=[],L=[],V=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:H,t:X,nodex:te,nodey:ae,depth:de}=V.pop();if(this.leaves[H]){DA(te,ae,de,e,o,u,d,O,L);const Q=1<<de,he=(te+0)/Q,me=(te+1)/Q,_e=(ae+0)/Q,De=(ae+1)/Q,ke=Ap(he,_e,this.dem)*T,Oe=Ap(me,_e,this.dem)*T,Ve=Ap(me,De,this.dem)*T,tt=Ap(he,De,this.dem)*T,vt=RA(O[0],O[1],ke,L[0],O[1],Oe,L[0],L[1],Ve,g,y),ft=RA(L[0],L[1],Ve,O[0],L[1],tt,O[0],O[1],ke,g,y),xt=Math.min(vt!==null?vt:Number.MAX_VALUE,ft!==null?ft:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const St=qe([],g,y,X);if(LA(ke,Oe,tt,Ve,NA(St[0],O[0],L[0]),NA(St[1],O[1],L[1]))>=St[2])return X}continue}let pe=0;for(let Q=0;Q<this._siblingOffset.length;Q++){DA((te<<1)+this._siblingOffset[Q][0],(ae<<1)+this._siblingOffset[Q][1],de+1,e,o,u,d,O,L),O[2]=-100,L[2]=this.maximums[this.childOffsets[H]+Q]*T;const he=PA(O,L,g,y);if(he!=null){const me=he;I[Q]=me;let _e=!1;for(let De=0;De<pe&&!_e;De++)me>=I[N[De]]&&(N.splice(De,0,Q),_e=!0);_e||(N[pe]=Q),pe++}}for(let Q=0;Q<pe;Q++){const he=N[Q];V.push({idx:this.childOffsets[H]+he,t:I[he],nodex:(te<<1)+this._siblingOffset[he][0],nodey:(ae<<1)+this._siblingOffset[he][1],depth:de+1})}}return null}_addNode(e,o,u){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,u,d,g){if(e[d].isLeaf(o,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,T=e[y];let C=0,I=0;for(let N=0;N<this._siblingOffset.length;N++){const O=2*o+this._siblingOffset[N][0],L=2*u+this._siblingOffset[N][1],V=T.getElevation(O,L),H=T.isLeaf(O,L),X=this._addNode(V.min,V.max,H);H&&(C|=1<<N),I||(I=X)}for(let N=0;N<this._siblingOffset.length;N++)C&1<<N||this._construct(e,2*o+this._siblingOffset[N][0],2*u+this._siblingOffset[N][1],y,I+N)}}function LA(a,e,o,u,d,g){return Ir(Ir(a,o,g),Ir(e,u,g),d)}function Ap(a,e,o){const u=o.dim,d=Ee(a*u-.5,0,u-1),g=Ee(e*u-.5,0,u-1),y=Math.floor(d),T=Math.floor(g),C=Math.min(y+1,u-1),I=Math.min(T+1,u-1);return LA(o.get(y,T),o.get(C,T),o.get(y,I),o.get(C,I),d-y,g-T)}const _3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function x3(a,e,o){return(256*a*256+256*e+o)/10-1e4}function v3(a,e,o){return 256*a+e+o/256-32768}class dv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,u,d=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Hr(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const g=this.dim=o.height-2,y=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let C=0;C<g;C++)y[this._idx(-1,C)]=y[this._idx(0,C)],y[this._idx(g,C)]=y[this._idx(g-1,C)],y[this._idx(C,-1)]=y[this._idx(C,0)],y[this._idx(C,g)]=y[this._idx(C,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const T=u==="terrarium"?v3:x3;for(let C=0;C<y.length;++C){const I=4*C;this.floatView[C]=T(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Wa.now()}_buildQuadTree(){this._tree=new OA(this)}get(e,o,u=!1){u&&(e=Ee(e,-1,this.dim),o=Ee(o,-1,this.dim));const d=this._idx(e,o);return this.floatView[d]}set(e,o,u){const d=this._idx(e,o),g=this.floatView[d];return this.floatView[d]=u,u-g}static getUnpackVector(e){return _3[e]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}static pack(e,o){const u=[0,0,0,0],d=dv.getUnpackVector(o);let g=Math.floor((e+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new L2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,o,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,g=o*this.dim+this.dim,y=u*this.dim,T=u*this.dim+this.dim;switch(o){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:y=T-1;break;case 1:T=y+1}const C=-o*this.dim,I=-u*this.dim;for(let N=y;N<T;N++)for(let O=d;O<g;O++){const L=4*this._idx(O,N),V=4*this._idx(O+C,N+I);this.pixels[L+0]=e.pixels[V+0],this.pixels[L+1]=e.pixels[V+1],this.pixels[L+2]=e.pixels[V+2],this.pixels[L+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function b3(a,e,o){a===1?e.headerLength=o.readFixed32():a===2?e.x=o.readVarint():a===3?e.y=o.readVarint():a===4?e.z=o.readVarint():a===5&&e.layers.push(function(u,d){return u.readFields(C3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(o,o.readVarint()+o.pos))}function w3(a,e,o){a===1?(e.delta_filter=function(u,d){return u.readFields(S3,{blockSize:0},d)}(o,o.readVarint()+o.pos),e.filter="delta_filter"):a===2?(o.readVarint(),e.filter="zigzag_filter"):a===3?(o.readVarint(),e.filter="bitshuffle_filter"):a===4&&(o.readVarint(),e.filter="byteshuffle_filter")}function S3(a,e,o){a===1&&(e.blockSize=o.readVarint())}function T3(a,e,o){a===1?(o.readVarint(),e.codec="gzip_data"):a===2?(o.readVarint(),e.codec="jpeg_image"):a===3?(o.readVarint(),e.codec="webp_image"):a===4&&(o.readVarint(),e.codec="png_image")}function E3(a,e,o){let u=0,d=0;a===1?e.firstByte=o.readFixed64():a===2?e.lastByte=o.readFixed64():a===3?e.filters.push(function(g,y){return g.readFields(w3,{},y)}(o,o.readVarint()+o.pos)):a===4?e.codec=function(g,y){return g.readFields(T3,{},y)}(o,o.readVarint()+o.pos):a===5?d=o.readFloat():a===6?u=o.readFloat():a===7?e.bands.push(o.readString()):a===8?e.offset=o.readDouble():a===9&&(e.scale=o.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=u)}function C3(a,e,o){a===1?e.version=o.readVarint():a===2?e.name=o.readString():a===3?e.units=o.readString():a===4?e.tileSize=o.readVarint():a===5?e.buffer=o.readVarint():a===6?e.pixelFormat=o.readVarint():a===7&&e.dataIndex.push(function(u,d){return u.readFields(E3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(o,o.readVarint()+o.pos))}function A3(a,e,o){if(a===2)(function(u,d,g){u.readFields(I3,g,d)})(o,o.readVarint()+o.pos,e);else if(a===3)throw new Error("Not implemented")}function I3(a,e,o){if(a===1){let u=0;const d=o.readVarint()+o.pos;for(;o.pos<d;)e[u++]=o.readVarint()}}function M3(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let o=e[3];for(let u=2;u>=1;u--){const d=u===1?1:0,g=u===2?1:0;for(let y=0;y<e[0];y++){const T=e[1]*y;for(let C=d;C<e[1];C++){const I=e[2]*(C+T);for(let N=g;N<e[2];N++){const O=e[3]*(N+I);for(let L=0;L<e[3];L++){const V=O+L;a[V]+=a[V-o]}}}}o*=e[u]}return a}function k3(a){for(let e=0,o=a.length;e<o;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function P3(a,e){switch(e){case"uint32":return a;case"uint16":for(let o=0;o<a.length;o+=2){const u=a[o],d=a[o+1];a[o]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,a[o+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let o=0;o<a.length;o+=4){const u=a[o],d=a[o+1],g=a[o+2],y=a[o+3];a[o+0]=(192&u)>>6|(192&d)>>4|(192&g)>>2|192&y,a[o+1]=(48&u)>>4|(48&d)>>2|48&g|(48&y)<<2,a[o+2]=(12&u)>>2|12&d|(12&g)<<2|(12&y)<<4,a[o+3]=3&u|(3&d)<<2|(3&g)<<4|(3&y)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Zt(dv,"DEMData"),Zt(OA,"DemMinMaxQuadTree",{omit:["dem"]});var Sc=Uint8Array,T_=Uint16Array,R3=Int32Array,zA=new Sc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),jA=new Sc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),N3=new Sc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),FA=function(a,e){for(var o=new T_(31),u=0;u<31;++u)o[u]=e+=1<<a[u-1];var d=new R3(o[30]);for(u=1;u<30;++u)for(var g=o[u];g<o[u+1];++g)d[g]=g-o[u]<<5|u;return{b:o,r:d}},BA=FA(zA,2),VA=BA.b,D3=BA.r;VA[28]=258,D3[258]=28;for(var O3=FA(jA,0).b,UA=new T_(32768),Ns=0;Ns<32768;++Ns){var ry=(43690&Ns)>>1|(21845&Ns)<<1;UA[Ns]=((65280&(ry=(61680&(ry=(52428&ry)>>2|(13107&ry)<<2))>>4|(3855&ry)<<4))>>8|(255&ry)<<8)>>1}var E_=function(a,e,o){for(var u=a.length,d=0,g=new T_(e);d<u;++d)a[d]&&++g[a[d]-1];var y,T=new T_(e);for(d=1;d<e;++d)T[d]=T[d-1]+g[d-1]<<1;y=new T_(1<<e);var C=15-e;for(d=0;d<u;++d)if(a[d])for(var I=d<<4|a[d],N=e-a[d],O=T[a[d]-1]++<<N,L=O|(1<<N)-1;O<=L;++O)y[UA[O]>>C]=I;return y},C_=new Sc(288);for(Ns=0;Ns<144;++Ns)C_[Ns]=8;for(Ns=144;Ns<256;++Ns)C_[Ns]=9;for(Ns=256;Ns<280;++Ns)C_[Ns]=7;for(Ns=280;Ns<288;++Ns)C_[Ns]=8;var $A=new Sc(32);for(Ns=0;Ns<32;++Ns)$A[Ns]=5;var L3=E_(C_,9),z3=E_($A,5),Wb=function(a){for(var e=a[0],o=1;o<a.length;++o)a[o]>e&&(e=a[o]);return e},sh=function(a,e,o){var u=e/8|0;return(a[u]|a[u+1]<<8)>>(7&e)&o},Zb=function(a,e){var o=e/8|0;return(a[o]|a[o+1]<<8|a[o+2]<<16)>>(7&e)},j3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],oh=function(a,e,o){var u=new Error(e||j3[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,oh),!o)throw u;return u},F3=new Sc(0),B3=typeof TextDecoder<"u"&&new TextDecoder;try{B3.decode(F3,{stream:!0})}catch{}const V3={gzip_data:"gzip"};class lu extends Error{constructor(e){super(e),this.name="MRTError"}}const U3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},HA={uint32:1,uint16:2,uint8:4},$3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Xb;class fv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const o=this.layers[e];if(!o)throw new lu(`Layer '${e}' not found`);return o}getHeaderLength(e){const o=new Uint8Array(e),u=new DataView(e);if(o[0]!==13)throw new lu("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){const o=new Uint8Array(e),u=this.getHeaderLength(e);if(o.length<u)throw new lu(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const d=function(g,y){return g.readFields(b3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Xb(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new lu(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new GA(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const o=[],u=this.getLayer(e.layerName);for(let d of e.blockIndices){const g=u.dataIndex[d],y=g.firstByte-e.firstByte,T=g.lastByte-e.firstByte;if(u._blocksInProgress.has(d))continue;const C={layerName:u.name,firstByte:y,lastByte:T,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(I=>I.filter)};u._blocksInProgress.add(d),o.push(C)}return new qA(o,()=>{o.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(o.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),d)throw d;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class GA{constructor({version:e,name:o,units:u,tileSize:d,pixelFormat:g,buffer:y,dataIndex:T},C){if(this.version=e,this.version!==1)throw new lu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=o,this.units=u,this.tileSize=d,this.buffer=y,this.pixelFormat=U3[g],this.dataIndex=T,this.bandShape=[d+2*y,d+2*y,HA[this.pixelFormat]],this._decodedBlocks=new hv(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return HA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const o=e.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,e.data)}getBlockForBand(e){let o=0;switch(typeof e){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[g,y]of d.bands.entries())if(y===e)return{bandIndex:o+g,blockIndex:u,blockBandIndex:g};o+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(e>=o&&e<o+d.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-o};o+=d.bands.length}break;default:throw new lu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let o=1/0,u=-1/0;const d=[],g=new Set;for(const y of e){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new lu(`Invalid band: ${JSON.stringify(y)}`);const C=this.dataIndex[T];d.includes(T)||d.push(T),g.add(T),o=Math.min(o,C.firstByte),u=Math.max(u,C.lastByte)}if(g.size>this.cacheSize)throw new lu(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:d}}hasBand(e){const{blockIndex:o}=this.getBlockForBand(e);return o>=0}hasDataForBand(e){const{blockIndex:o}=this.getBlockForBand(e);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(e){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(e);if(o<0)throw new lu(`Band not found: ${JSON.stringify(e)}`);const d=this._decodedBlocks.get(o.toString());if(!d)throw new lu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[o],y=this.bandShape.reduce((I,N)=>I*N,1),T=u*y,C=d.subarray(T,T+y);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}fv.setPbf=function(a){Xb=a};class qA{constructor(e,o,u){this.tasks=e,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,o){this._finalized||(this._onComplete(e,o),this._finalized=!0)}}function Xm(a,e){const o=a.json.bufferViews[e.bufferView],u=Dx[e.componentType];return new u(a.buffers[o.buffer],(e.byteOffset||0)+(o.byteOffset||0),e.count*(o.byteStride&&o.byteStride!==l_[e.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:l_[e.type]))}function Kb(a,e,o,u){const d=Dx[e.componentType],g=function(N){switch(N){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),y=a.json.bufferViews[e.bufferView],T=y.byteStride?y.byteStride/d.BYTES_PER_ELEMENT:l_[e.type],C=o.float32,I=C.length/o.capacity;for(let N=0,O=0;N<e.count*T;N+=T,O+=I)for(let L=0;L<I;L++)C[O+L]=u[N+L]*g;o._trim()}function H3(a,e,o){const u=a.indices,d=a.attributes,g={};g.indexArray=new Rs;const y=e.json.accessors[u],T=y.count/3;g.indexArray.reserve(T);const C=Xm(e,y);for(let L=0;L<T;L++)g.indexArray.emplaceBack(C[3*L],C[3*L+1],C[3*L+2]);g.indexArray._trim(),g.vertexArray=new gl;const I=e.json.accessors[d.POSITION];g.vertexArray.reserve(I.count);const N=Xm(e,I);for(let L=0;L<I.count;L++)g.vertexArray.emplaceBack(N[3*L],N[3*L+1],N[3*L+2]);if(g.vertexArray._trim(),g.aabb=new Dn(I.min,I.max),g.centroid=function(L,V){const H=[0,0,0],X=L.length;if(X>0){for(let te=0;te<X;te++){const ae=3*L[te];H[0]+=V[ae],H[1]+=V[ae+1],H[2]+=V[ae+2]}H[0]/=X,H[1]/=X,H[2]/=X}return H}(C,N),d.COLOR_0!==void 0){const L=e.json.accessors[d.COLOR_0],V=l_[L.type],H=Xm(e,L);g.colorArray=V===3?new gl:new Ps,g.colorArray.resize(L.count),Kb(e,L,g.colorArray,H)}if(d.NORMAL!==void 0){g.normalArray=new gl;const L=e.json.accessors[d.NORMAL];g.normalArray.resize(L.count);const V=Xm(e,L);Kb(e,L,g.normalArray,V)}if(d.TEXCOORD_0!==void 0&&o.length>0){g.texcoordArray=new Zu;const L=e.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(L.count);const V=Xm(e,L);Kb(e,L,g.texcoordArray,V)}if(d._FEATURE_ID_RGBA4444!==void 0){const L=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Xm(e,L))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Xm(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const O=a.material;return g.material=function(L,V){const{emissiveFactor:H=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:te=.5,normalTexture:ae,occlusionTexture:de,emissiveTexture:pe,doubleSided:Q}=L,{baseColorFactor:he=[1,1,1,1],metallicFactor:me=1,roughnessFactor:_e=1,baseColorTexture:De,metallicRoughnessTexture:ke}=L.pbrMetallicRoughness||{},Oe=de?V[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&Oe){const Ve=de.extensions.KHR_texture_transform;Oe.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new In(...he),metallicFactor:me,roughnessFactor:_e,baseColorTexture:De?V[De.index]:void 0,metallicRoughnessTexture:ke?V[ke.index]:void 0},doubleSided:Q,emissiveFactor:new In(...H),alphaMode:X,alphaCutoff:te,normalTexture:ae?V[ae.index]:void 0,occlusionTexture:Oe,emissionTexture:pe?V[pe.index]:void 0,defined:L.defined===void 0}}(O!==void 0?e.json.materials[O]:{defined:!1},o),g}function WA(a,e,o){const{matrix:u,rotation:d,translation:g,scale:y,mesh:T,extras:C,children:I}=a,N={};if(N.matrix=u||function(O,L,V,H){var X=L[0],te=L[1],ae=L[2],de=L[3],pe=X+X,Q=te+te,he=ae+ae,me=X*pe,_e=X*Q,De=X*he,ke=te*Q,Oe=te*he,Ve=ae*he,tt=de*pe,vt=de*Q,ft=de*he,xt=H[0],St=H[1],nt=H[2];return O[0]=(1-(ke+Ve))*xt,O[1]=(_e+ft)*xt,O[2]=(De-vt)*xt,O[3]=0,O[4]=(_e-ft)*St,O[5]=(1-(me+Ve))*St,O[6]=(Oe+tt)*St,O[7]=0,O[8]=(De+vt)*nt,O[9]=(Oe-tt)*nt,O[10]=(1-(me+ke))*nt,O[11]=0,O[12]=V[0],O[13]=V[1],O[14]=V[2],O[15]=1,O}([],d||[0,0,0,1],g||[0,0,0],y||[1,1,1]),T!==void 0){N.meshes=o[T];const O=N.anchor=[0,0];for(const L of N.meshes){const{min:V,max:H}=L.aabb;O[0]+=V[0]+H[0],O[1]+=V[1]+H[1]}O[0]=Math.floor(O[0]/N.meshes.length/2),O[1]=Math.floor(O[1]/N.meshes.length/2)}if(C&&(C.id&&(N.id=C.id),C.lights&&(N.lights=function(O){if(!O.length)return[];const L=function(ae){const de=atob(ae),pe=new Uint8Array(de.length);for(let Q=0;Q<de.length;Q++)pe[Q]=de.codePointAt(Q);return pe}(O),V=[],H=L.length/24,X=new Uint16Array(L.buffer),te=new Float32Array(L.buffer);for(let ae=0;ae<H;ae++){const de=X[2*ae*6]/30,pe=X[2*ae*6+1]/30,Q=X[2*ae*6+10]/100,he=te[6*ae+1],me=te[6*ae+2],_e=te[6*ae+3],De=te[6*ae+4],ke=_e-he,Oe=De-me,Ve=Math.hypot(ke,Oe);V.push({pos:[he+.5*ke,me+.5*Oe,pe],normal:[Oe/Ve,-ke/Ve,0],width:Ve,height:de,depth:Q,points:[he,me,_e,De]})}return V}(C.lights))),I){const O=[];for(const L of I)O.push(WA(e.json.nodes[L],e,o));N.children=O}return N}function G3(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new Q1(a.vertices,a.indices,8,256),[o,u]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:o,max:u}}function q3(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const o=e[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const y of o){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],C=y[1];typeof T=="number"&&typeof C=="number"&&u.push(new Ot(T,C))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let y=0;y<u.length;y++){const T=u[y],C=u[(y+1)%u.length],I=u[(y+2)%u.length];d+=(T.x-C.x)*(I.y-C.y)-(I.x-C.x)*(T.y-C.y)}d>0&&u.reverse();const g=Ky(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function W3(a,e){const o=[],u=[];let d=0;const g=[];for(const y of a){d=o.length;const T=y.vertexArray.float32,C=y.indexArray.uint16;for(let I=0;I<y.vertexArray.length;I++)g[0]=T[3*I+0],g[1]=T[3*I+1],g[2]=T[3*I+2],Cr(g,g,e),o.push(new Ot(g[0],g[1]));for(let I=0;I<3*y.indexArray.length;I++)u.push(C[I]+d)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const T=o[u[y+0]],C=o[u[y+1]],I=o[u[y+2]];(T.x-C.x)*(I.y-C.y)-(I.x-C.x)*(T.y-C.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:o,indices:u}}function ZA(a){const e=function(C,I){const N=[],O=WebGL2RenderingContext;if(C.json.textures)for(const L of C.json.textures){const V={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};L.sampler!==void 0&&Object.assign(V,C.json.samplers[L.sampler]),N.push({image:I[L.source],sampler:V,uploaded:!1})}return N}(a,a.images),o=function(C,I){const N=[];for(const O of C.json.meshes){const L=[];for(const V of O.primitives)L.push(H3(V,C,I));N.push(L)}return N}(a,e),{scenes:u,scene:d,nodes:g}=a.json,y=u?u[d||0].nodes:g,T=[];for(const C of y)T.push(WA(g[C],a,o));return function(C,I,N){const O={},L=new Set;for(let V=0;V<C.length;V++){const H=N[I[V]];if(!H.extras)continue;const X=H.extras["mapbox:footprint:version"],te=H.extras["mapbox:footprint:id"];(X||te)&&L.add(V),X==="1.0.0"&&te&&(O[te]=V)}for(let V=0;V<C.length;V++){if(L.has(V))continue;const H=C[V],X=N[I[V]];if(!X.extras)continue;let te=null;H.id in O&&(te=W3(C[O[H.id]].meshes,H.matrix)),te||(te=q3(X)),te&&(H.footprint=G3(te))}if(L.size>0){const V=Array.from(L.values()).sort((H,X)=>H-X);for(let H=V.length-1;H>=0;H--)C.splice(V[H],1)}}(T,y,a.json.nodes),T}function Z3(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,o=a.aabb.min[0]-1,u=a.aabb.min[1]-1,d=Wm/(a.aabb.max[0]-o+2),g=Wm/(a.aabb.max[1]-u+2);for(let y=0;y<e.length;y+=3){const T=e[y+2],C=(e[y+0]-o)*d|0,I=(e[y+1]-u)*g|0;T>a.heightmap[I*Wm+C]&&(a.heightmap[I*Wm+C]=T)}}function X3(a,e){const o={};o.indexArray=new Rs,o.indexArray.reserve(4*a.length),o.vertexArray=new gl,o.vertexArray.reserve(10*a.length),o.colorArray=new Ps,o.vertexArray.reserve(10*a.length);let u=0;for(const y of a){const T=Math.min(10,Math.max(4,1.3*y.height))*e,C=[-y.normal[1],y.normal[0],0],I=Math.min(.29,.1*y.width/y.depth),N=y.width-2*y.depth*e*(I+.01),O=qe([],y.pos,C,N/2),L=qe([],y.pos,C,-N/2),V=[O[0],O[1],O[2]+y.height],H=[L[0],L[1],L[2]+y.height],X=qe([],y.normal,C,I);Ht(X,X,T);const te=qe([],y.normal,C,-I);Ht(te,te,T),br(X,O,X),br(te,L,te),O[2]+=.1,L[2]+=.1,o.vertexArray.emplaceBack(X[0],X[1],X[2]),o.vertexArray.emplaceBack(te[0],te[1],te[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack(H[0],H[1],H[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(X[0],X[1],X[2]),o.vertexArray.emplaceBack(te[0],te[1],te[2]);const ae=N/T/2;o.colorArray.emplaceBack(-ae-I,-1,ae,.8),o.colorArray.emplaceBack(ae+I,-1,ae,.8),o.colorArray.emplaceBack(-ae,0,ae,1.3),o.colorArray.emplaceBack(ae,0,ae,1.3),o.colorArray.emplaceBack(ae+I,-.8,ae,.7),o.colorArray.emplaceBack(ae+I,-.8,ae,.7),o.colorArray.emplaceBack(0,0,ae,1.3),o.colorArray.emplaceBack(0,0,ae,1.3),o.colorArray.emplaceBack(ae+I,-1.2,ae,.8),o.colorArray.emplaceBack(ae+I,-1.2,ae,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const d={defined:!0};d.emissiveFactor=In.black;const g={};return g.baseColorFactor=In.white,d.pbrMetallicRoughness=g,o.material=d,o.aabb=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}fv.performDecoding=function(a,e){const o=new Uint8Array(a);return Promise.all(e.tasks.map(u=>{const{layerName:d,firstByte:g,lastByte:y,pixelFormat:T,blockShape:C,blockIndex:I,filters:N,codec:O}=u,L=o.subarray(g,y+1),V=new Uint32Array(C[0]*C[1]*C[2]);let H;if(O!=="gzip_data")throw new lu(`Unhandled codec: ${O}`);return H=function(X,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((Q=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||oh(6,"invalid gzip data");var De=_e[3],ke=10;4&De&&(ke+=2+(_e[10]|_e[11]<<8));for(var Oe=(De>>3&1)+(De>>4&1);Oe>0;Oe-=!_e[ke++]);return ke+(2&De)}(pe=X))+8>pe.length&&oh(6,"invalid gzip data"),function(_e,De,ke,Oe){var Ve=_e.length;if(!Ve||De.f&&!De.l)return ke||new Sc(0);var tt=!ke,vt=tt||De.i!=2,ft=De.i;tt&&(ke=new Sc(3*Ve));var xt,St,nt=function(Qi){var Ai=ke.length;if(Qi>Ai){var yi=new Sc(Math.max(2*Ai,Qi));yi.set(ke),ke=yi}},_t=De.f||0,et=De.p||0,rt=De.b||0,Mt=De.l,Pt=De.d,yr=De.m,rr=De.n,$t=8*Ve;do{if(!Mt){_t=sh(_e,et,1);var At=sh(_e,et+1,3);if(et+=3,!At){var Gr=_e[(ye=4+((et+7)/8|0))-4]|_e[ye-3]<<8,tr=ye+Gr;if(tr>Ve){ft&&oh(0);break}vt&&nt(rt+Gr),ke.set(_e.subarray(ye,tr),rt),De.b=rt+=Gr,De.p=et=8*tr,De.f=_t;continue}if(At==1)Mt=L3,Pt=z3,yr=9,rr=5;else if(At==2){var nr=sh(_e,et,31)+257,jr=sh(_e,et+10,15)+4,rn=nr+sh(_e,et+5,31)+1;et+=14;for(var Kr=new Sc(rn),hn=new Sc(19),sn=0;sn<jr;++sn)hn[N3[sn]]=sh(_e,et+3*sn,7);et+=3*jr;var dn=Wb(hn),qn=(1<<dn)-1,Si=E_(hn,dn);for(sn=0;sn<rn;){var ye,Se=Si[sh(_e,et,qn)];if(et+=15&Se,(ye=Se>>4)<16)Kr[sn++]=ye;else{var ot=0,Lt=0;for(ye==16?(Lt=3+sh(_e,et,3),et+=2,ot=Kr[sn-1]):ye==17?(Lt=3+sh(_e,et,7),et+=3):ye==18&&(Lt=11+sh(_e,et,127),et+=7);Lt--;)Kr[sn++]=ot}}var Gt=Kr.subarray(0,nr),Ut=Kr.subarray(nr);yr=Wb(Gt),rr=Wb(Ut),Mt=E_(Gt,yr),Pt=E_(Ut,rr)}else oh(1);if(et>$t){ft&&oh(0);break}}vt&&nt(rt+131072);for(var er=(1<<yr)-1,Lr=(1<<rr)-1,yn=et;;yn=et){var _n=(ot=Mt[Zb(_e,et)&er])>>4;if((et+=15&ot)>$t){ft&&oh(0);break}if(ot||oh(2),_n<256)ke[rt++]=_n;else{if(_n==256){yn=et,Mt=null;break}var on=_n-254;_n>264&&(on=sh(_e,et,(1<<(xn=zA[sn=_n-257]))-1)+VA[sn],et+=xn);var Kn=Pt[Zb(_e,et)&Lr],gi=Kn>>4;if(Kn||oh(3),et+=15&Kn,Ut=O3[gi],gi>3){var xn=jA[gi];Ut+=Zb(_e,et)&(1<<xn)-1,et+=xn}if(et>$t){ft&&oh(0);break}vt&&nt(rt+131072);var qi=rt+on;if(rt<Ut){var Ti=0-Ut,Wn=Math.min(Ut,qi);for(Ti+rt<0&&oh(3);rt<Wn;++rt)ke[rt]=(void 0)[Ti+rt]}for(;rt<qi;++rt)ke[rt]=ke[rt-Ut]}}De.l=Mt,De.p=yn,De.b=rt,De.f=_t,Mt&&(_t=1,De.m=yr,De.d=Pt,De.n=rr)}while(!_t);return rt!=ke.length&&tt?(xt=ke,((St=rt)==null||St>xt.length)&&(St=xt.length),new Sc(xt.subarray(0,St))):ke.subarray(0,rt)}(pe.subarray(Q,-8),{i:2},new Sc(((ae=pe)[(de=ae.length)-4]|ae[de-3]<<8|ae[de-2]<<16|ae[de-1]<<24)>>>0))));var ae,de,pe,Q;const he=V3[te];if(!he)throw new Error(`Unhandled codec: ${te}`);const me=new globalThis.DecompressionStream(he);return new Response(new Blob([X]).stream().pipeThrough(me)).arrayBuffer().then(_e=>new Uint8Array(_e))}(L,O).then(X=>(function(te,ae){te.readFields(A3,ae)}(new Xb(X),V),new $3[T](V.buffer))),H.then(X=>{for(let te=N.length-1;te>=0;te--)switch(N[te]){case"delta_filter":M3(X,C);break;case"zigzag_filter":k3(X);break;case"bitshuffle_filter":P3(X,T);break;default:throw new lu(`Unhandled filter "${N[te]}"`)}return{layerName:d,blockIndex:I,data:X}}).catch(X=>{throw X})}))},Zt(qA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Zt(fv,"MapboxRasterTile"),Zt(GA,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class XA{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const u=e[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const K3=["id","tile","layer","source","sourceLayer","state"];class ny{constructor(e,o,u,d,g){this.type="Feature",this._vectorTileFeature=e,this._z=o,this._x=u,this._y=d,this.properties=e.properties,this.id=g}clone(){const e=new ny(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of K3)this[o]!==void 0&&(e[o]=this[o]);return e}}class KA{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zs(jt,16,0),this.featureIndexArray=new yp,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,o,u,d,g,y=0,T=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,y);const I=this.grid;for(let N=0;N<o.length;N++){const O=o[N],L=[1/0,1/0,-1/0,-1/0];for(let V=0;V<O.length;V++){const H=O[V];L[0]=Math.min(L[0],H.x),L[1]=Math.min(L[1],H.y),L[2]=Math.max(L[2],H.x),L[3]=Math.max(L[3],H.y)}T!==0&&(L[0]-=T,L[1]-=T,L[2]+=T,L[3]+=T),L[0]<jt&&L[1]<jt&&L[2]>=0&&L[3]>=0&&I.insert(C,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new en.VectorTile(new Lx(this.rawTileData)).layers,this.sourceLayerCoder=new XA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o){const{tilespaceGeometry:u,transform:d,tileTransform:g,pixelPosMatrix:y,availableImages:T,worldview:C}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const I=u.bufferedTilespaceBounds,N=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(H,X,te,ae)=>bc(u.bufferedTilespaceGeometry,H,X,te,ae));N.sort(Y3);let O=null;d.elevation&&N.length>0&&(O=Qg.create(d.elevation,this.tileID));const L={};let V;for(let H=0;H<N.length;H++){const X=N[H];if(X===V)continue;V=X;const te=this.featureIndexArray.get(X);let ae=null;this.is3DTile?this.loadMatchingModelFeature(L,te,e,u,d,C):this.loadMatchingFeature(L,te,e,T,C,(de,pe,Q,he=0)=>(ae||(ae=qt(de,this.tileID.canonical,g)),pe.queryIntersectsFeature(u,de,Q,ae,this.z,d,y,O,he)))}return L}loadMatchingFeature(e,o,u,d,g,y){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:I,layoutVertexArrayOffset:N}=o,O=this.bucketLayerIDs[C],L=u.layers,V=Object.keys(L);if(V.length&&!Ur(V,O))return;const H=u.sourceCache,X=this.sourceLayerCoder.decode(I),te=this.vtLayers[X].feature(T),ae=this.getId(te,X);for(let de=0;de<O.length;de++){const pe=O[de];if(!L[pe])continue;const{styleLayer:Q,targets:he}=L[pe];let me={};ae!==void 0&&(me=H.getFeatureState(Q.sourceLayer,ae));const _e=!y||y(te,Q,me,N);if(!_e)continue;const De=new ny(te,this.z,this.x,this.y,ae);De.tile=this.tileID.canonical,De.state=me;let ke=this.serializedLayersCache.get(pe);ke||(ke=Q.serialize(),ke.id=pe,this.serializedLayersCache.set(pe,ke)),De.source=ke.source,De.sourceLayer=ke["source-layer"],De.layer=Xe({},ke),De.layer.paint=YA(ke.paint,Q.paint,te,me,d),De.layer.layout=YA(ke.layout,Q.layout,te,me,d);let Oe=!1;for(const Ve of he){this.updateFeatureProperties(De,Ve);const{filter:tt}=Ve;if(tt){if(te.properties=De.properties,tt.needGeometry){const vt=Bt(te,!0);if(!tt.filter(new Hn(this.tileID.overscaledZ,{worldview:g}),vt,this.tileID.canonical))continue}else if(!tt.filter(new Hn(this.tileID.overscaledZ,{worldview:g}),te))continue}Oe=!0,Ve.targetId&&this.addFeatureVariant(De,Ve)}Oe&&this.appendToResult(e,pe,T,De,_e)}}loadMatchingModelFeature(e,o,u,d,g,y){const{featureIndex:T,bucketIndex:C}=o,I=this.bucketLayerIDs[C],N=u.layers,O=Object.keys(N);if(!O.length||Ur(O,I))for(let L=0;L<I.length;L++){const V=I[L],{styleLayer:H,targets:X}=N[V];if(H.type!=="model")continue;const te=d.tile,ae=te.getBucket(H);if(!(ae&&ae instanceof ov))continue;const de=Kj(ae,T,d,g);if(!de)continue;const{z:pe,x:Q,y:he}=te.tileID.canonical,{feature:me,intersectionZ:_e,position:De}=de;let ke={};me.id!==void 0&&(ke=u.sourceCache.getFeatureState(H.sourceLayer,me.id));const Oe=new ny({},pe,Q,he,me.id);Oe.tile=this.tileID.canonical,Oe.state=ke,Oe.properties=me.properties,Oe.geometry={type:"Point",coordinates:[De.lng,De.lat]};let Ve=this.serializedLayersCache.get(V);Ve||(Ve=H.serialize(),Ve.id=V,this.serializedLayersCache.set(V,Ve)),Oe.source=Ve.source,Oe.sourceLayer=Ve["source-layer"],Oe.layer=Xe({},Ve);let tt=!1;for(const vt of X){this.updateFeatureProperties(Oe,vt);const{filter:ft}=vt;if(ft){if(me.properties=Oe.properties,ft.needGeometry){if(!ft.filter(new Hn(this.tileID.overscaledZ,{worldview:y}),me,this.tileID.canonical))continue}else if(!ft.filter(new Hn(this.tileID.overscaledZ,{worldview:y}),me))continue}tt=!0,vt.targetId&&this.addFeatureVariant(Oe,vt)}tt&&this.appendToResult(e,V,T,Oe,_e)}}updateFeatureProperties(e,o,u){if(o.properties){const d={};for(const g in o.properties){const y=o.properties[g].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);y!=null&&(d[g]=y)}e.properties=d}}addFeatureVariant(e,o,u){const d={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[o.targetId]=e.variants[o.targetId]||[],e.variants[o.targetId].push(d)}appendToResult(e,o,u,d,g){let y=e[o];y===void 0&&(y=e[o]=[]),y.push({featureIndex:u,feature:d,intersectionZ:g})}lookupSymbolFeatures(e,o,u,d,g,y){const T={};this.loadVTLayers();for(const C of e)this.loadMatchingFeature(T,{bucketIndex:o,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},d,g,y);return T}loadFeature(e){const{featureIndex:o,sourceLayerIndex:u}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[o])return g[o];const y=this.vtLayers[d].feature(o);return g[o]=y,y}hasLayer(e){for(const o of this.bucketLayerIDs)for(const u of o)if(e===u)return!0;return!1}getId(e,o){let u=e.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=zl(d);if(g.result!=="success"){const y=g.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void Hr(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new kd),u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function YA(a,e,o,u,d){return Me(a,(g,y)=>{const T=e instanceof ml?e.get(y):null;return T&&T.evaluate?T.evaluate(o,u,void 0,d):T})}function Y3(a,e){return e-a}Zt(KA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const JA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(e,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=JA[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new Yb(T,y,g,e)}constructor(e,o=64,u=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=JA.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+C,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+C),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+C,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=o,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Jb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:T}=this,C=[0,g.length-1,0],I=[];for(;C.length;){const N=C.pop()||0,O=C.pop()||0,L=C.pop()||0;if(O-L<=T){for(let te=L;te<=O;te++){const ae=y[2*te],de=y[2*te+1];ae>=e&&ae<=u&&de>=o&&de<=d&&I.push(g[te])}continue}const V=L+O>>1,H=y[2*V],X=y[2*V+1];H>=e&&H<=u&&X>=o&&X<=d&&I.push(g[V]),(N===0?e<=H:o<=X)&&(C.push(L),C.push(V-1),C.push(1-N)),(N===0?u>=H:d>=X)&&(C.push(V+1),C.push(O),C.push(1-N))}return I}within(e,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,T=[0,d.length-1,0],C=[],I=u*u;for(;T.length;){const N=T.pop()||0,O=T.pop()||0,L=T.pop()||0;if(O-L<=y){for(let te=L;te<=O;te++)eI(g[2*te],g[2*te+1],e,o)<=I&&C.push(d[te]);continue}const V=L+O>>1,H=g[2*V],X=g[2*V+1];eI(H,X,e,o)<=I&&C.push(d[V]),(N===0?e-u<=H:o-u<=X)&&(T.push(L),T.push(V-1),T.push(1-N)),(N===0?e+u>=H:o+u>=X)&&(T.push(V+1),T.push(O),T.push(1-N))}return C}}function Jb(a,e,o,u,d,g){if(d-u<=o)return;const y=u+d>>1;QA(a,e,y,u,d,g),Jb(a,e,o,u,y-1,1-g),Jb(a,e,o,y+1,d,1-g)}function QA(a,e,o,u,d,g){for(;d>u;){if(d-u>600){const I=d-u+1,N=o-u+1,O=Math.log(I),L=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*L*(I-L)/I)*(N-I/2<0?-1:1);QA(a,e,o,Math.max(u,Math.floor(o-N*L/I+V)),Math.min(d,Math.floor(o+(I-N)*L/I+V)),g)}const y=e[2*o+g];let T=u,C=d;for(A_(a,e,u,o),e[2*d+g]>y&&A_(a,e,u,d);T<C;){for(A_(a,e,T,C),T++,C--;e[2*T+g]<y;)T++;for(;e[2*C+g]>y;)C--}e[2*u+g]===y?A_(a,e,u,C):(C++,A_(a,e,C,d)),C<=o&&(u=C+1),o<=C&&(d=C-1)}}function A_(a,e,o,u){Qb(a,o,u),Qb(e,2*o,2*u),Qb(e,2*o+1,2*u+1)}function Qb(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}function eI(a,e,o,u){const d=a-o,g=e-u;return d*d+g*g}i.$=Ms,i.A=jc,i.B=ic,i.C=Ul,i.D=Hg,i.E=Fc,i.F=2,i.G=f_,i.H=_C,i.I=_o,i.J=sc,i.K=class extends iv{},i.L=Al,i.M=Fs,i.N=$h,i.O=Uh,i.P=Ot,i.Q=Gd,i.R=Xa,i.S=hc,i.T=Nb,i.U=Wo,i.V=iv,i.W=$u,i.X=zl,i.Y=Nh,i.Z=Wc,i._=cc,i.a=function(a){return Gs.API_CDN_URL_REGEX.test(a)},i.a$=Ze,i.a0=qs,i.a1=nu,i.a2=Xc,i.a3=Hd,i.a4=function(a){const e=a.value;let o=[];if(!e)return o;const u=sc(e);return u!=="string"?(o=o.concat([new iv(a.key,e,`string expected, "${u}" found`)]),o):(zb(e,!0)||(o=o.concat([new iv(a.key,e,`invalid url "${e}"`)])),o)},i.a5=$e,i.a6=ds,i.a7=Di,i.a8=Tt,i.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return bi(a.expression.evaluate(e))}interpolate(a,e,o){return{x:Ir(a.x,e.x,o),y:Ir(a.y,e.y,o),z:Ir(a.z,e.z,o),azimuthal:Ir(a.azimuthal,e.azimuthal,o),polar:Ir(a.polar,e.polar,o)}}},i.aA=zi,i.aB=E,i.aC=xl,i.aD=Te,i.aE=Ye,i.aF=function(a,e){const o={};for(let u=0;u<e.length;u++){const d=e[u];d in a&&(o[d]=a[d])}return o},i.aG=ge,i.aH=be,i.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,o,u){const d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},e):u(g,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=o((g,y)=>{d.result=[g,y];for(const T of d.callbacks)this.scheduler?this.scheduler.add(()=>{T(g,y)},e):T(g,y);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==u),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},i.aJ=function(a,e,o){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{const g=Td(a.request,(y,T,C,I)=>{y?d(y):T&&d(null,{vectorTile:o?void 0:new en.VectorTile(new Lx(T)),rawData:T,cacheControl:C,expires:I})});return()=>{g.cancel(),d()}},e)},i.aK=function(a){Pf++,Pf>fi&&(a.getActor().send("enforceCacheSizeLimit",Aa),Pf=0)},i.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},i.aM=No,i.aN=WC,i.aO=QC,i.aP=qC,i.aQ=function(a,e){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let u=0;u<a.length;u++){const d=document.createElement("source");Eg(a[u])||(o.crossOrigin="Anonymous"),d.src=a[u],o.appendChild(d)}return{cancel:()=>{}}},i.aR=Qx,i.aS=function(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>zE(e,0,a))},i.aT=ZA,i.aU=class{constructor(a,e,o,u){this.id=a,this.position=e!=null?new ce(e[0],e[1]):new ce(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(fe(a.matrix,e,a.matrix),a.meshes)for(const o of a.meshes){const u=Dn.applyTransformFast(o.aabb,a.matrix);this.aabb.encapsulate(u)}if(a.children)for(const o of a.children)this._applyTransformations(o,a.matrix)}computeBoundsAndApplyParent(){const a=W([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,o,u,d,g,y=!1){uA(this.matrix,this,a.transform,this.position,e,o,u,d,g,y)}upload(a){if(!this.uploaded){for(const e of this.nodes)Fb(e,a);for(const e of this.nodes)sv(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)Bb(a)}},i.aV=Qt,i.aW=m_,i.aX=Re,i.aY=Be,i.aZ=Yh,i.a_=Rs,i.aa=Hn,i.ab=Yc,i.ac=Le,i.ad=Cr,i.ae=Br,i.af=ze,i.ag=ml,i.ah=mn,i.ai=Ir,i.aj=jt,i.ak=Sh,i.al=Sn,i.am=In,i.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return function([o,u]){const d=bi([1,o,u]);return{x:d.x,y:d.y,z:d.z}}(a.expression.evaluate(e))}interpolate(a,e,o){return{x:Ir(a.x,e.x,o),y:Ir(a.y,e.y,o),z:Ir(a.z,e.z,o)}}},i.ao=function(a,e,o=0,u=!0){const d=new Ot(o,o),g=a.sub(d),y=e.add(d),T=[g,new Ot(y.x,g.y),y,new Ot(g.x,y.y)];return u&&T.push(g.clone()),T},i.ap=function(a,e){const o=[];for(let u=0;u<a.length;u++){const d=We(u-1,-1,a.length-1),g=We(u+1,-1,a.length-1),y=a[u],T=a[g],C=a[d].sub(y).unit(),I=T.sub(y).unit(),N=I.angleWithSep(C.x,C.y),O=C.add(I).unit().mult(-1*e/Math.sin(N/2));o.push(y.add(O))}return o},i.aq=RC,i.ar=bc,i.as=function(a,e,o=0){return Ft(((e.x-o)*a.scale-a.x)*jt,(e.y*a.scale-a.y)*jt,Ge(e.z,e.y))},i.at=On,i.au=Rr,i.av=mi,i.aw=HE,i.ax=function(a){let e=1/0,o=1/0,u=-1/0,d=-1/0;for(const g of a)e=Math.min(e,g.x),o=Math.min(o,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new Ot(e,o),max:new Ot(u,d)}},i.ay=Ee,i.az=fe,i.b=function(a){return Gs.API_FONTS_REGEX.test(a)},i.b$=function(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+d*T,a[1]=d*C-u*T,a[2]=g*C+y*T,a[3]=y*C-g*T,a},i.b0=td,i.b1=Yx,i.b2=function(){pl.isLoading()||pl.isLoaded()||fc()!=="deferred"||tp()},i.b3=Kd,i.b4=Bt,i.b5=ny,i.b6=Nn,i.b7=hb,i.b8=J1,i.b9=qt,i.bA=function(a,e){const{x:o,y:u}=a.point,d=fn(o,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return fe(d,d,ut(Qe(e)))},i.bB=D,i.bC=function(a){return a[0]=0,a[1]=0,a[2]=0,a},i.bD=function(a,e){return Math.hypot(e[0]-a[0],e[1]-a[1],e[2]-a[2])},i.bE=qe,i.bF=lr,i.bG=ar,i.bH=d_,i.bI=vl,i.bJ=xb,i.bK=function(a,e,o,u,d){const g=5*e+2;a.float32[g+0]=o,a.float32[g+1]=u,a.float32[g+2]=d},i.bL=Kx,i.bM=Rx,i.bN=Xo,i.bO=co,i.bP=Q2,i.bQ=sA,i.bR=iE,i.bS=sE,i.bT=_b,i.bU=EC,i.bV=Sb,i.bW=Yb,i.bX=We,i.bY=Ht,i.bZ=$s,i.b_=to,i.ba=Hl,i.bb=Ys,i.bc=k,i.bd=si,i.be=Ky,i.bf=kb,i.bg=function(a,e){const o=mn(e.zoom);if(o===0)return Qe(a);const u=sr(a),d=Wr(u),g=Te(u.getWest())*e.worldSize,y=Te(u.getEast())*e.worldSize,T=be(u.getNorth())*e.worldSize,C=be(u.getSouth())*e.worldSize,I=[g,T,0],N=[y,T,0],O=[g,C,0],L=[y,C,0],V=ie([],e.globeMatrix);return Cr(I,I,V),Cr(N,N,V),Cr(O,O,V),Cr(L,L,V),d[0]=Et(d[0],O,o),d[1]=Et(d[1],L,o),d[2]=Et(d[2],N,o),d[3]=Et(d[3],I,o),Dn.fromPoints(d)},i.bh=yt,i.bi=ie,i.bj=tn,i.bk=Et,i.bl=Kh,i.bm=w,i.bn=kt,i.bo=Pe,i.bp=fv,i.bq=Lx,i.br=Td,i.bs=function(a,e){const o=[];for(const u in a)u in e||o.push(u);return o},i.bt=je,i.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bv=qa,i.bw=function(a){var e=new P(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e},i.bx=W,i.by=Dt,i.bz=J,i.c=kf,i.c$=Nx,i.c0=Qo,i.c1=Ui,i.c2=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},i.c3=hr,i.c4=function(a,e,o,u,d){var g,y=1/Math.tan(e/2);return a[0]=y/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0?(a[10]=(d+u)*(g=1/(u-d)),a[14]=2*d*u*g):(a[10]=-1,a[14]=-2*u),a},i.c5=function(a,e,o,u,d,g,y){var T=1/(e-o),C=1/(u-d),I=1/(g-y);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*I,a[11]=0,a[12]=(e+o)*T,a[13]=(d+u)*C,a[14]=(y+g)*I,a[15]=1,a},i.c6=Ie,i.c7=function(a,e,o){a[4*e+0]=o[0],a[4*e+1]=o[1],a[4*e+2]=o[2],a[4*e+3]=o[3]},i.c8=Ju,i.c9=qr,i.cA=rv,i.cB=Tr,i.cC=eA,i.cD=function(a){const e=eA(a,!0);return D([],[e[0],e[1],e[4],e[5]])},i.cE=Fe,i.cF=Gn,i.cG=ht,i.cH=function(a){const{x:e,y:o}=a.point,{lng:u,lat:d}=a._center;return fn(e,o,a.worldSize,u,d)},i.cI=Er,i.cJ=Ke,i.cK=au,i.cL=M,i.cM=function(a,e,o){let u=0;for(let d=0;d<2;++d)a[d]>0&&(u+=(a[d]-0)*(a[d]-0)),e[d]<0&&(u+=(0-e[d])*(0-e[d]));return u},i.cN=function(a){return a*a*a*a*a},i.cO=Ae,i.cP=45,i.cQ=vc,i.cR=function(a,e,o){const u=Math.sqrt(a*a+e*e+o*o),d=u>0?Math.acos(o/u)*Ql:0;let g=a!==0||e!==0?Math.atan2(-e,-a)*Ql+90:0;return g<0&&(g+=360),[u,g,d]},i.cS=Ft,i.cT=bi,i.cU=Je,i.cV=br,i.cW=Dn,i.cX=Yt,i.cY=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},i.cZ=zb,i.c_=function(a,e){return a.readFields(Qj,{icons:[]},e)},i.ca=Xn,i.cb=ql,i.cc=nd,i.cd=ce,i.ce=zC,i.cf=function(){var a=new P(4);return P!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},i.cg=function(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+g*T,a[1]=d*C+y*T,a[2]=u*-T+g*C,a[3]=d*-T+y*C,a},i.ch=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},i.ci=ri,i.cj=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},i.ck=Hs,i.cl=Zn,i.cm=Bm,i.cn=wi,i.co=tA,i.cp=df,i.cq=pr,i.cr=function(a,e,o,u,d,g,y,T,C){if(C.name==="globe")return pr(a,e,new df(o,u,d),!1);const I=m_({z:o,x:u,y:d},C);return new Dn([(g+I.x/I.scale)*e,e*(I.y/I.scale),y],[(g+I.x2/I.scale)*e,e*(I.y2/I.scale),T])},i.cs=function(a,e,o){return a[0]=Math.min(e[0],o[0]),a[1]=Math.min(e[1],o[1]),a[2]=Math.min(e[2],o[2]),a[3]=Math.min(e[3],o[3]),a},i.ct=function(a,e,o){return a[0]=Math.max(e[0],o[0]),a[1]=Math.max(e[1],o[1]),a[2]=Math.max(e[2],o[2]),a[3]=Math.max(e[3],o[3]),a},i.cu=function(a){const e=Math.round((a+45+360)%360/90)%4;return le[e]},i.cv=st,i.cw=mo,i.cx=R,i.cy=function(a){const e=W(new Float64Array(16));fe(e,a.pixelMatrix,a.globeMatrix);const o=[0,U,0],u=[0,q,0];return Cr(o,o,e),Cr(u,u,e),[o[0]>0&&o[0]<=a.width&&o[1]>0&&o[1]<=a.height&&!zn(a,new ce(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!zn(a,new ce(a.center.lat,-90))]},i.cz=function(a,e){const{scale:o}=a.tileTransform,u=o*jt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(d,g,y){var T=g[1],C=g[2],I=g[3],N=y[0],O=y[1];return d[0]=g[0]*N,d[1]=T*N,d[2]=C*O,d[3]=I*O,d}(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},i.d=function(a){return Gs.API_TILEJSON_REGEX.test(a)},i.d$=pp,i.d0=Xg,i.d1=bb,i.d2=Sd,i.d3=ru,i.d4=Eo,i.d5=Su,i.d6=mr,i.d7=function(a){const e=a.indexOf(iu);return e>=0?a.slice(0,e):a},i.d8=function(a){return a.indexOf(iu)>=0},i.d9=function(a){const e=a.lastIndexOf(iu);return e>=0?a.slice(e+1):""},i.dA=wr,i.dB=us,i.dC=yo,i.dD=256,i.dE=function(a,e){const o=[0,0,0];return Cr(o,o,yt(Qe(e.canonical))),Cr(o,o,a),o},i.dF=a=>({u_matrix:new nd(a),u_texsize:new ql(a),u_pixels_to_tile_units:new eh(a),u_device_pixel_ratio:new Xn(a),u_width_scale:new Xn(a),u_floor_width_scale:new Xn(a),u_image:new Ju(a),u_units_to_pixels:new ql(a),u_tile_units_to_pixels:new Xn(a),u_alpha_discard_threshold:new Xn(a),u_trim_offset:new ql(a),u_trim_fade_range:new ql(a),u_trim_color:new vc(a),u_emissive_strength:new Xn(a),u_zbias_factor:new Xn(a),u_tile_to_meter:new Xn(a),u_ground_shadow_factor:new qr(a),u_pattern_transition:new Xn(a)}),i.dG=a=>({u_matrix:new nd(a),u_pixels_to_tile_units:new eh(a),u_device_pixel_ratio:new Xn(a),u_width_scale:new Xn(a),u_floor_width_scale:new Xn(a),u_units_to_pixels:new ql(a),u_dash_image:new Ju(a),u_gradient_image:new Ju(a),u_image_height:new Xn(a),u_texsize:new ql(a),u_tile_units_to_pixels:new Xn(a),u_alpha_discard_threshold:new Xn(a),u_trim_offset:new ql(a),u_trim_fade_range:new ql(a),u_trim_color:new vc(a),u_emissive_strength:new Xn(a),u_zbias_factor:new Xn(a),u_tile_to_meter:new Xn(a),u_ground_shadow_factor:new qr(a)}),i.dH=a=>({u_camera_to_center_distance:new Xn(a),u_extrude_scale:new eh(a),u_device_pixel_ratio:new Xn(a),u_matrix:new nd(a),u_inv_rot_matrix:new nd(a),u_merc_center:new ql(a),u_tile_id:new qr(a),u_zoom_transition:new Xn(a),u_up_dir:new qr(a),u_emissive_strength:new Xn(a)}),i.dI=tf,i.dJ=nj,i.dK=C2,i.dL=(a,e,o,u,d,g)=>{const y=a.transform,T=y.projection.name==="globe";let C;if(g.paint.get("circle-pitch-alignment")==="map")if(T){const N=wr(y.zoom,e.canonical)*y._pixelsPerMercatorPixel;C=Float32Array.from([N,0,0,N])}else C=y.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(y.projection),u_matrix:a.translatePosMatrix(e.projMatrix,o,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Wa.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:H1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(T){I.u_inv_rot_matrix=u,I.u_merc_center=d,I.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],I.u_zoom_transition=mn(y.zoom);const N=d[0]*jt,O=d[1]*jt;I.u_up_dir=y.projection.upVector(new df(0,0,0),N,O)}return I},i.dM=ZE,i.dN=Uo,i.dO=(a,e,o,u,d,g,y,T,C,I)=>{const N=a.transform,O=N.pitch<15?GE(.07,.7,Ee((14-N.zoom)/5,0,1)):.07,L=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:WE(a,e,o,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:N.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:qE(e,N),u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:Je(e.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:I}},i.dP=(a,e,o,u,d,g,y,T,C,I)=>{const N=a.transform,O=N.calculatePixelsToTileUnitsMatrix(e),L=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=N.pitch<15?GE(.07,.7,Ee((14-N.zoom)/5,0,1)):.07;return{u_matrix:WE(a,e,o,u),u_pixels_to_tile_units:O,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:T,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:XE(o)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qE(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:Je(e.tileID.canonical,0),u_ground_shadow_factor:I}},i.dQ=Nt,i.dR=Xy,i.dS=Ge,i.dT=$1,i.dU=Px,i.dV=_E,i.dW=Sp,i.dX=450,i.dY=7,i.dZ=jj,i.d_=Tn,i.da=function(a){const e=[],o=a.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},i.db=function(a,e,o,u){return a.type==="custom"?new Fj(a,e):new Yj[a.type](a,e,o,u)},i.dc=Wt,i.dd=function(a){const e=a.indexOf(iu);return e>=0?a.slice(e+1):""},i.de=class extends ny{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},i.df=ns,i.dg=Cl,i.dh=function(a){return a({pluginStatus:ao,pluginURL:ua}),ns.on("pluginStateChange",a),a},i.di=_p,i.dj=class extends xc{constructor(a){super(a),this.current=Qu}set(a,e,o){if(this.fetchUniformLocation(a,e)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},i.dk=ue,i.dl=function(a,e,o){const u=mn(o.zoom),d=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!d&&!g},i.dm=function(a){const e=a.pixelsPerMeter,o=e/Ie(1,a.center.lat),u=W(new Float64Array(16));return Pe(u,u,[a.point.x,a.point.y,0]),Fe(u,u,[o,o,e]),Float32Array.from(u)},i.dn=sr,i.dp=function(a){const e=st-5;a=Ee(a,-80.051129,e)/e*90;const o=Math.pow(Math.abs(Math.sin(Sn(a))),3);return Math.round(o*(G.length-1))},i.dq=function(a,e,o,u){const d=e.getNorth(),g=e.getSouth(),y=e.getWest(),T=e.getEast(),C=1<<a.z,I=T-y,N=d-g,O=I/j,L=-N/G[o],V=[0,O,0,L,0,0,d,y,0];if(a.z>0){const H=180/u;K(V,V,[H/I+1,0,0,0,H/N+1,0,-.5*H/O,.5*H/L,1])}return V[2]=C,V[5]=a.x,V[8]=a.y,V},i.dr=Qe,i.ds=function(a,e,o){const u=W(new Float64Array(16)),d=(e/(1<<a)-.5)*Math.PI*2;return at(u,o.globeMatrix,d),Float32Array.from(u)},i.dt=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const o=e.getSource().maxzoom,u=1<<o,d=Math.floor(a.x),g=Math.floor((a.x-d)*u),y=Math.floor(a.y*u),T=this.findDEMTileFor(new No(o,d,o,g,y));return!(!T||!T.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,o=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const u=this._source();if(!u||a.y<0||a.y>1)return e;const d=u.getSource().maxzoom,g=1<<d,y=Math.floor(a.x),T=a.x-y,C=new No(d,y,d,Math.floor(T*g),Math.floor(a.y*g)),I=this.findDEMTileFor(C);if(!I||!I.dem)return e;const N=I.dem,O=1<<I.tileID.canonical.z,L=(T*O-I.tileID.canonical.x)*N.dim,V=(a.y*O-I.tileID.canonical.y)*N.dim,H=Math.floor(L),X=Math.floor(V);return(o?this.exaggeration():1)*Ir(Ir(N.get(H,X),N.get(H,X+1),V-X),Ir(N.get(H+1,X),N.get(H+1,X+1),V-X),L-H)}getAtTileOffset(a,e,o){const u=1<<a.canonical.z;return this.getAtPointOrZero(new Le(a.wrap+(a.canonical.x+e/jt)/u,(a.canonical.y+o/jt)/u))}getAtTileOffsetFunc(a,e,o,u){return d=>{const g=this.getAtTileOffset(a,d.x,d.y),y=u.upVector(a.canonical,d.x,d.y);return Ht(y,y,g*u.upVectorScale(a.canonical,e,o).metersToTile),y}}getForTilePoints(a,e,o,u){if(this.isUsingMockSource())return!1;const d=Qg.create(this,a,u);return!!d&&(e.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],o)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const o=e.dem.tree,u=e.tileID,d=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/d-u.canonical.x,y=a.canonical.y/d-u.canonical.y,T=0;for(let C=0;C<a.canonical.z-u.canonical.z&&!o.leaves[T];C++){g*=2,y*=2;const I=2*Math.floor(y)+Math.floor(g);T=o.childOffsets[T]+I,g%=1,y%=1}return{min:this.exaggeration()*o.minimums[T],max:this.exaggeration()*o.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of a){const g=this.getMinMaxForTile(d.tileID);g&&(o=Math.min(o,g.min),u=Math.max(u,g.max),e=!0)}return e?{min:o,max:u}:null}},i.du=L2,i.dv=B,i.dw=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},i.dx=F,i.dy=function(a,e){var o=Math.sin(e),u=Math.cos(e);return a[0]=u,a[1]=o,a[2]=0,a[3]=-o,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},i.dz=Fr,i.e=Gs,i.e$=XA,i.e0=256,i.e1=ut,i.e2=gl,i.e3=at,i.e4=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},i.e5=_c,i.e6=Qh,i.e7=Ll,i.e8=function(a,e,o,u,d){return Ee((a-e)/(o-e)*(d-u)+u,u,d)},i.e9=To,i.eA=function(a,e,o){return a[0]=e[0]/o[0],a[1]=e[1]/o[1],a[2]=e[2]/o[2],a},i.eB=vs,i.eC=Y,i.eD=kr,i.eE=function(a,e,o,u){return a[0]=e,a[1]=o,a[2]=u,a},i.eF=function([a,e,o]){const u=Math.hypot(a,e,o),d=Math.atan2(a,o),g=.5*Math.PI-Math.acos(-e/u);return new ce(Ke(d),Ke(g))},i.eG=El,i.eH=Ob,i.eI=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!function(o){if(ji==null){const u=o.navigator?o.navigator.userAgent:null;ji=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ji}(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eJ=function(a,e){Aa=a,fi=e},i.eK=zn,i.eL=En,i.eM=function(a){const e=[0,0,0],o=W(new Float64Array(16));return fe(o,a.pixelMatrix,a.globeMatrix),Cr(e,e,o),new Ot(e[0],e[1])},i.eN=function(){const a=o_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(sb),o_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.eO=function(){Nx().acquire(sb)},i.eP=fc,i.eQ=function(a,e,o=!1){if(ao===oo.deferred||ao===oo.loading||ao===oo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ua=Wa.resolveURL(a),ao=oo.deferred,dc=e,Wh(),o||tp()},i.eR=function(a){Gg=Wa.resolveURL(a),qg||(qg=new Hg(Nx(),new Fc)),qg.broadcast("setMeshoptUrl",Gg)},i.eS=PE,i.eT=function(a){ab=Wa.resolveURL(a),qg||(qg=new Hg(Nx(),new Fc)),qg.broadcast("setDracoUrl",ab)},i.eU=kE,i.eV=s_,i.eW=function(a){const e=Dc();if(!e)return;const o=e.delete(ec);a&&o.then(()=>a()).catch(a)},i.eX=Hm,i.eY=Zt,i.eZ=wp,i.e_=ih,i.ea=function(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8],O=N*y-T*I,L=-N*g+T*C,V=I*g-y*C,H=o*O+u*L+d*V;return H?(a[0]=O*(H=1/H),a[1]=(-N*u+d*I)*H,a[2]=(T*u-d*y)*H,a[3]=L*H,a[4]=(N*o-d*C)*H,a[5]=(-T*o+d*g)*H,a[6]=V*H,a[7]=(-I*o+u*C)*H,a[8]=(y*o-u*g)*H,a):null},i.eb=Zr,i.ec=mt,i.ed=Lb,i.ee=function(a,e){if(a===e){var o=e[1],u=e[2],d=e[3],g=e[6],y=e[7],T=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=o,a[6]=e[9],a[7]=e[13],a[8]=u,a[9]=g,a[11]=e[14],a[12]=d,a[13]=y,a[14]=T}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},i.ef=_r,i.eg=[1,1,1],i.eh=class{constructor(a,e,o,u){this.context=a,this.format=u,this.size=o,this.texture=a.gl.createTexture();const[d,g,y]=this.size,{gl:T}=a;T.bindTexture(T.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,d,g,y,0,Pb(this.format),Rb(this.format),e.data)}bind(a,e){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},i.ei=Qg,i.ej=function(a,e,o,u){var d=new P(4);return d[0]=a,d[1]=e,d[2]=o,d[3]=u,d},i.ek=Hi,i.el=function(a,e,o,u){var d=e[0],g=e[1],y=e[2],T=e[3];return a[0]=d+u*(o[0]-d),a[1]=g+u*(o[1]-g),a[2]=y+u*(o[2]-y),a[3]=T+u*(o[3]-T),a},i.em=Jg,i.en=yc,i.eo=Zu,i.ep=function(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,X){var te=new P(16);return te[0]=a,te[1]=e,te[2]=o,te[3]=u,te[4]=d,te[5]=g,te[6]=y,te[7]=T,te[8]=C,te[9]=I,te[10]=N,te[11]=O,te[12]=L,te[13]=V,te[14]=H,te[15]=X,te},i.eq=ne,i.er=rf,i.es=fp,i.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ot(1/0,1/0),max:new Ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const o=tE(new Ot(0,0),new Ot(jt,jt),a),u=[];if(e&&!eb(o,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!eb(o,d))continue;const g=vz(d.min,d.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const o=[];for(const u of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(u).buckets[e.layer];d&&d.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const o=a.getOrder(),u=a.getClipMask(),d=a.getClipScope();for(const g of e){if(!g.footprint)continue;const y=tE(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:o,clipMask:u,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,o)=>e.priority-o.priority||Mx(e.min,o.min)||Mx(e.max,o.max)||e.order-o.order||e.clipMask-o.clipMask||function(u,d){const g=(y,T)=>y+T;return u.length-d.length||u.reduce(g,"").localeCompare(d.reduce(g,""))}(e.clipScope,o.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const o=this._activeRegions[e],u=this._prevRegions[e];a=o.priority!==u.priority||!eE(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!qa(o.clipScope,u.clipScope),++e}}if(a){++this._updateTime;for(const o of this._activeRegions)o.order!==Ix&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const e=o=>{const u=this._activeRegions;if(o>=u.length)return o;const d=u[o].priority;for(;o<u.length&&u[o].priority===d;)++o;return o};if(this._sourceIds.length>1){let o=0,u=e(o);for(;o!==u;){let d=o;const g=o;for(;d!==u;){const y=this._activeRegions[d];y.hiddenByOverlap=!1;for(let T=0;T<g;T++){const C=this._activeRegions[T];if(!C.hiddenByOverlap&&y.order===Ix&&eb(y,C)&&(y.hiddenByOverlap=nE(y.footprint,y.tileId,C.footprint,C.tileId),y.hiddenByOverlap))break}++d}o=u,u=e(o)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},i.eu=Ix,i.ev=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const o=new Hl,u=new Rs,d=[],g=a+1+2,y=e[0]+1,T=e[0]+1+(1+e.length),C=(I,N,O)=>{let L=I===g-1?I-2:I===0?I:I-1;return L+=O?24575:0,[L,N]};for(let I=0;I<g;++I)o.emplaceBack(...C(I,0,!0));for(let I=0;I<y;++I)for(let N=0;N<g;++N)o.emplaceBack(...C(N,I,(N===0||N===g-1)&&!0));for(let I=0;I<e.length;++I){const N=e[I];for(let O=0;O<g;++O)o.emplaceBack(...C(O,N,!0))}for(let I=0;I<e.length;++I){const N=u.length,O=e[I]+1+2,L=new Rs;for(let X=0;X<O-1;X++){const te=X===O-2,ae=te?g*(T-e.length+I-X):g;for(let de=0;de<g-1;de++){const pe=X*g+de;X===0||te||de===0||de===g-2?(L.emplaceBack(pe+1,pe,pe+ae),L.emplaceBack(pe+ae,pe+ae+1,pe+1)):(u.emplaceBack(pe+1,pe,pe+ae),u.emplaceBack(pe+ae,pe+ae+1,pe+1))}}const V=si.simpleSegment(0,N,o.length,u.length-N);for(let X=0;X<L.uint16.length;X+=3)u.emplaceBack(L.uint16[X],L.uint16[X+1],L.uint16[X+2]);const H=si.simpleSegment(0,N,o.length,u.length-N);d.push({withoutSkirts:V,withSkirts:H})}return{vertices:o,indices:u,segments:d}}_createGrid(a){const e=this._fillGridMeshWithLods(j,G);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,k.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new Rs;for(let y=0;y<=j;y++)e.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const o=new _c,u=new _c,d=new _c,g=new _c;this._poleSegments=[];for(let y=0,T=0;y<M;y++){const C=360/(1<<y);o.emplaceBack(0,-E,0,.5,0),u.emplaceBack(0,-E,0,.5,1),d.emplaceBack(0,-E,0,.5,.5),g.emplaceBack(0,-E,0,.5,.5);for(let I=0;I<=j;I++){let N=I/j,O=0;const L=Ir(0,C,N),[V,H,X]=re(Zi,sd,L,E);o.emplaceBack(V,H,X,N,O),u.emplaceBack(V,H,X,N,1-O);const te=Sn(L);N=.5+.5*Math.sin(te),O=.5+.5*Math.cos(te),d.emplaceBack(V,H,X,N,O),g.emplaceBack(V,H,X,N,1-O)}this._poleSegments.push(si.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(o,_,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,_,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,_,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,_,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},i.ew=ve,i.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.ey=Ne,i.ez=Ue,i.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,o)=>String.fromCharCode(+("0x"+o))))},i.f0=KA,i.f1=VE,i.f2=un,i.f3="hd_road_elevation",i.f4=Oa,i.f5=Me,i.f6=Um,i.f7=vb,i.f8=Gm,i.f9=function(a,e,o,u,d,g,y,T=1,C,I,N){a.createArrays(),a.tilePixelRatio=jt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const O=a.layers[0].layout,L=a.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=T,V.textSizeScaleRange=O.get("text-size-scale-range"),V.iconSizeScaleRange=O.get("icon-size-scale-range");const[H,X]=V.textSizeScaleRange,[te,ae]=V.iconSizeScaleRange;V.textScaleFactor=Ee(V.scaleFactor,H,X),V.iconScaleFactor=Ee(V.scaleFactor,te,ae);const de=L["text-size"],pe=L["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:ke,maxZoom:Oe}=a.textSizeData;V.compositeTextSizes=[de.possiblyEvaluate(new Hn(ke,{worldview:N}),g),de.possiblyEvaluate(new Hn(Oe,{worldview:N}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:ke,maxZoom:Oe}=a.iconSizeData;V.compositeIconSizes=[pe.possiblyEvaluate(new Hn(ke,{worldview:N}),g),pe.possiblyEvaluate(new Hn(Oe,{worldview:N}),g)]}V.layoutTextSize=de.possiblyEvaluate(new Hn(y+1,{worldview:N}),g),V.layoutIconSize=pe.possiblyEvaluate(new Hn(y+1,{worldview:N}),g),V.textMaxSize=de.possiblyEvaluate(new Hn(18,{worldview:N}),g);const Q=O.get("symbol-placement"),he=O.get("text-rotation-alignment")==="map"&&Q!=="point",me=O.get("text-size");let _e=!1;const De=[];for(const ke of a.features){const Oe=O.get("text-font").evaluate(ke,{},g).join(","),Ve=me.evaluate(ke,{},g)*V.textScaleFactor,tt=V.layoutTextSize.evaluate(ke,{},g)*V.textScaleFactor,vt=V.layoutIconSize.evaluate(ke,{},g)*V.iconScaleFactor,ft={horizontal:{},vertical:void 0},xt=ke.text;let St,nt=[0,0];if(xt){const jr=xt.toString(),rn=O.get("text-letter-spacing").evaluate(ke,{},g)*co,Kr=O.get("text-line-height").evaluate(ke,{},g)*co,hn=tu(jr)?rn:0,sn=O.get("text-anchor").evaluate(ke,{},g),dn=O.get("text-variable-anchor");if(!dn){const ot=O.get("text-radial-offset").evaluate(ke,{},g);if(ot)nt=EC(sn,[ot*co,wb]);else{const Lt=O.get("text-offset").evaluate(ke,{},g);nt=[Lt[0]*co,Lt[1]*co]}}let qn=he?"center":O.get("text-justify").evaluate(ke,{},g);const Si=Q==="point",ye=Si?O.get("text-max-width").evaluate(ke,{},g)*co:1/0,Se=ot=>{a.allowVerticalPlacement&&Ra(jr)&&(ft.vertical=yb(xt,e,o,d,Oe,ye,Kr,sn,ot,hn,nt,vl.vertical,!0,tt,Ve,C))};if(!he&&dn){const ot=qn==="auto"?dn.map(Gt=>Sb(Gt)):[qn];let Lt=!1;for(let Gt=0;Gt<ot.length;Gt++){const Ut=ot[Gt];if(!ft.horizontal[Ut])if(Lt)ft.horizontal[Ut]=ft.horizontal[0];else{const er=yb(xt,e,o,d,Oe,ye,Kr,"center",Ut,hn,nt,vl.horizontal,!1,tt,Ve,C);er&&(ft.horizontal[Ut]=er,Lt=er.positionedLines.length===1)}}Se("left")}else{if(qn==="auto"&&(qn=Sb(sn)),Si||O.get("text-writing-mode").indexOf("horizontal")>=0||!Ra(jr)){const ot=yb(xt,e,o,d,Oe,ye,Kr,sn,qn,hn,nt,vl.horizontal,!1,tt,Ve,C);ot&&(ft.horizontal[qn]=ot)}Se(Si?"left":qn)}}let _t,et,rt,Mt,Pt,yr,rr=!1;const $t=O.get("icon-text-fit").evaluate(ke,{},g);if(ke.icon&&ke.icon.hasPrimary()){const jr=AC(ke.icon,a.iconSizeData,L["icon-size"],g,a.zoom,ke,C,V.iconScaleFactor,N);_t=jr.iconPrimary,rt=jr.iconSecondary;const rn=_t.toString();if(et=u.get(rn),et&&(Pt=O.get("icon-offset").evaluate(ke,{},g),yr=O.get("icon-anchor").evaluate(ke,{},g),St=pj(d.get(rn),rt?d.get(rt.toString()):void 0,Pt,yr),rr=et.sdf,a.sdfIcons===void 0?a.sdfIcons=et.sdf:a.sdfIcons!==et.sdf&&Hr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==a.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),rt){const Kr=rt.toString();Mt=u.get(Kr)}}_e=_e||!(!ke.icon||!ke.icon.hasSecondary());const At=Tb(ft.horizontal)||ft.vertical;a.iconsInText||(a.iconsInText=!!At&&At.iconsInText);const Gr=tt*V.textScaleFactor/co,{defaultShapedIcon:tr,verticallyShapedIcon:nr}=Tj(a,St,O,ke,g,ft,Gr,Pt,$t);$t!=="none"&&St&&(cC(St)||uC(St))&&(Ux(0,et,_t,St,tr,$t,I,u,d),Ux(0,Mt,rt,St,tr,$t,I,u,d),nr&&(Ux(0,et,_t,St,nr,$t,I,u,d),Ux(0,Mt,rt,St,nr,$t,I,u,d))),St=tr,De.push({feature:ke,shapedTextOrientations:ft,shapedText:At,shapedIcon:St,iconPrimary:_t,iconSecondary:rt,iconOffset:Pt,iconAnchor:yr,verticallyShapedIcon:nr,layoutTextSize:tt,layoutIconSize:vt,textOffset:nt,isSDFIcon:rr,iconTextFit:$t})}return{featureData:De,sizes:V,hasAnySecondaryIcon:_e,textAlongLine:he,symbolPlacement:Q}},i.fa=xC,i.fb=function(a,e,o,u,d,g,y,T,C,I){const{featureData:N,hasAnySecondaryIcon:O,sizes:L,textAlongLine:V,symbolPlacement:H}=e;for(const X of N){const{shapedIcon:te,verticallyShapedIcon:ae,feature:de,shapedTextOrientations:pe,shapedText:Q,layoutTextSize:he,textOffset:me,isSDFIcon:_e,iconPrimary:De,iconSecondary:ke,iconTextFit:Oe,iconOffset:Ve}=X;IC(te,I.iconPositions,De,ke),IC(ae,I.iconPositions,De,ke),Sj(pe,I.iconPositions),wj(De,ke,I.iconPositions),(Q||te)&&Ej(a,de,pe,te,ae,C,L,he,0,me,_e,u,d,y,T,O,Oe,Ve,V,H)}o&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,L.textScaleFactor)},i.fc=en,i.fd=dv,i.fe=Ga,i.ff=Vr,i.fg=tC,i.fh=ci,i.fi=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==NE){const o=new Uint32Array(a,0,7),[,,u,d,g,y]=o;e=o.byteLength+d+g+y+g,(u!==a.byteLength||e>=a.byteLength)&&Hr("Invalid b3dm header information.")}return zE(a,e)},i.fj=function(a,e){const o=ZA(a);for(const u of o){for(const d of u.meshes)Z3(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(X3(u.lights,e)))}return o},i.fk=ov,i.fl=Fn,i.fm=IE,i.fn=pl,i.fo=oo,i.fp=function(a){vu(),ll?.then(e=>{e.keys().then(o=>{for(let u=0;u<o.length-a;u++)e.delete(o[u]).catch(d=>Hr(d.message))}).catch(o=>Hr(o.message))}).catch(e=>Hr(e.message))},i.g=function(a,e){return Cl(Xe(a,{method:"GET"}),e)},i.h=Xe,i.i=function(a){return Gs.API_STYLE_REGEX.test(a)&&!kf(a)},i.j=function(a){return a.indexOf("mapbox:")===0},i.k=kc,i.l=wd,i.m=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.n=function(a,e){return Cl(Xe(a,{type:"json"}),e)},i.o=bu,i.p=function(a,e){return Cl(Xe(a,{method:"POST"}),e)},i.q=Wa,i.r=Do,i.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=yh,i.u=function(){return function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},i.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},i.w=Hr,i.x=function(){return ob||(ob=new Hm),ob},i.y=qb,i.z=cl}),m(["./shared"],function(i){function A(Ke){const le=Ke?Ke.url.toString():void 0;return le?performance.getEntriesByName(le):[]}function P(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let ue="[";for(const ve of Ke)ue+=`${P(ve)},`;return`${ue}]`}let le="{";for(const ue of Object.keys(Ke).sort())le+=`${ue}:${P(Ke[ue])},`;return`${le}}`}function D(Ke){let le="";for(const ue of i.bu)le+=`/${P(Ke[ue])}`;return le}class F{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,ue){this._layerConfigs={},this._layers={},this.update(le,[],ue)}update(le,ue,ve){this._options=ve;for(const Ee of le)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=i.db(Ee,this.scope,null,this._options)).compileFilter(ve),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ue)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Ne=function(Ee,ze){const We={};for(let Xe=0;Xe<Ee.length;Xe++){const dt=Ee[Xe];let Ze=ze&&ze[dt.id];Ze||(dt.type==="symbol"?Ze=dt.id:(Ze=D(dt),dt.type==="line"&&dt.paint&&function Qt(Me){return typeof Me=="string"&&Me==="line-progress"||(Array.isArray(Me)?Me.some(Qt):!(!Me||typeof Me!="object")&&Object.values(Me).some(Qt))}(dt.paint["line-width"])&&(Ze+=`/${P(dt.paint["line-width"])}`))),ze&&(ze[dt.id]=Ze);let Nt=We[Ze];Nt||(Nt=We[Ze]=[]),Nt.push(dt)}const je=[];for(const Xe in We)je.push(We[Xe]);return je}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Ne){const ze=Ee.map(Nt=>this._layers[Nt.id]),We=ze[0];if(We.visibility==="none")continue;const je=We.source||"";let Xe=this.familiesBySource[je];Xe||(Xe=this.familiesBySource[je]={});const dt=We.sourceLayer||"_geojsonTileLayer";let Ze=Xe[dt];Ze||(Ze=Xe[dt]=[]),Ze.push(ze)}}}const $=1*i.e_;class K{constructor(le){const ue={},ve=[];for(const We in le){const je=le[We],Xe=ue[We]={};for(const dt in je.glyphs){const Ze=je.glyphs[+dt];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Nt=Ze.metrics.localGlyph?$:1,Qt={x:0,y:0,w:Ze.bitmap.width+2*Nt,h:Ze.bitmap.height+2*Nt};ve.push(Qt),Xe[dt]=Qt}}const{w:Ne,h:Ee}=i.H(ve),ze=new i.eZ({width:Ne||1,height:Ee||1});for(const We in le){const je=le[We];for(const Xe in je.glyphs){const dt=je.glyphs[+Xe];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const Ze=ue[We][Xe],Nt=dt.metrics.localGlyph?$:1;i.eZ.copy(dt.bitmap,ze,{x:0,y:0},{x:Ze.x+Nt,y:Ze.y+Nt},dt.bitmap)}}this.image=ze,this.positions=ue}}i.eY(K,"GlyphAtlas");class J{constructor(le){this.tileID=new i.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.lut=le.lut,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.scope=le.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.request&&le.request.collectResourceTiming,this.promoteId=le.promoteId,this.isSymbolTile=le.isSymbolTile,this.tileTransform=i.aW(le.tileID.canonical,le.projection),this.projection=le.projection,this.worldview=le.worldview,this.localizableLayerIds=le.localizableLayerIds,this.brightness=le.brightness,this.extraShadowCaster=!!le.extraShadowCaster,this.tessellationStep=le.tessellationStep,this.scaleFactor=le.scaleFactor,this.worldview=le.worldview}parse(le,ue,ve,Ne,Ee,ze){this.status="parsing",this.data=le,this.collisionBoxArray=new i.b0;const We=new i.e$(Object.keys(le.layers).sort()),je=new i.f0(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Xe={},dt=new i.f1(256,256),Ze={featureIndex:je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:dt,availableImages:ve,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Nt=[],Qt=ue.familiesBySource[this.source];for(const Wt in Qt){const mr=le.layers[Wt];if(!mr)continue;let Ur=!1,nn=!1,Hr=!1;for(const Fn of Qt[Wt])Fn[0].type==="symbol"?Ur=!0:nn=!0,Fn[0].is3D()&&Fn[0].type!=="model"&&(Hr=!0);if(this.extraShadowCaster&&!Hr||this.isSymbolTile===!0&&!Ur||this.isSymbolTile===!1&&!nn)continue;mr.version===1&&i.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=We.encode(Wt),gn=[];let bi=!1;for(let Fn=0,Nn=0;Fn<mr.length;Fn++){const ji=mr.feature(Fn),Ui=je.getId(ji,Wt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Wt)){const Ri=ji.properties?ji.properties.worldview:null;if(this.worldview&&typeof Ri=="string")if(Ri==="all")ji.properties.$localized=!0;else{if(!Ri.split(",").includes(this.worldview))continue;ji.properties.$localized=!0,ji.properties.worldview=this.worldview}}!bi&&ji.properties&&ji.properties.hasOwnProperty(i.f2)&&(bi=!0),gn.push({feature:ji,id:Ui,index:Nn,sourceLayerIndex:ni}),Nn++}bi&&!Ze.elevationFeatures&&le.layers.hasOwnProperty(i.f3)&&(Ze.elevationFeatures=i.f4.parseFrom(le.layers[i.f3],this.canonical));for(const Fn of Qt[Wt]){const Nn=Fn[0];if(this.extraShadowCaster&&(!Nn.is3D()||Nn.type==="model")||this.isSymbolTile!==void 0&&Nn.type==="symbol"!==this.isSymbolTile||Nn.minzoom&&this.zoom<Math.floor(Nn.minzoom)||Nn.maxzoom&&this.zoom>=Nn.maxzoom||Nn.visibility==="none")continue;W(Fn,this.zoom,Ze.brightness,ve,this.worldview);const ji=Xe[Nn.id]=Nn.createBucket({index:je.bucketLayerIDs.length,layers:Fn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ne,worldview:this.worldview});je.bucketLayerIDs.push(Fn.map(Ri=>i.C(Ri.id,Ri.scope)));let Ui=ji.prepare?ji.prepare():null;Ui!=null?(Ui=Ui.then(()=>ji.populate(gn,Ze,this.tileID.canonical,this.tileTransform)),Nt.push(Ui)):ji.populate(gn,Ze,this.tileID.canonical,this.tileTransform)}}const Me=()=>{let Wt,mr,Ur,nn,Hr,ni;dt.trim();const gn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},bi=()=>{if(Wt)return this.status="done",ze(Wt);if(this.extraShadowCaster)this.status="done",ze(null,{buckets:Object.values(Xe).filter(Nn=>!Nn.isEmpty()),featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mr&&Ur&&nn){const Nn=new K(mr),ji=new Map;for(const[ms,us]of Ur.entries()){const{imagePosition:yo}=i.f7(ms,us,i.f8);ji.set(ms,yo)}const Ui={};for(const ms in Xe){const us=Xe[ms];us instanceof i.b1&&(W(us.layers,this.zoom,Ze.brightness,ve,this.worldview),Ui[ms]=i.f9(us,mr,Nn.positions,Ur,ji,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Hr,this.worldview))}const Ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,Ur,Hr,()=>{Ri.iconsPending=!1,Fn(Ui,Nn,Ri)}),this.rasterizeIfNeeded(Ee,nn,ni,()=>{Ri.patternsPending=!1,Fn(Ui,Nn,Ri)})}},Fn=(Nn,ji,Ui,Ri)=>{if(Ui.iconsPending||Ui.patternsPending)return;const ms=new i.fa(Ur,nn,this.lut);for(const us in Xe){const yo=Xe[us];if(us in Nn)i.fb(yo,Nn[us],this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ur,ms);else if(yo.hasPattern&&(yo instanceof i.b7||yo instanceof i.b8||yo instanceof i.dU)){W(yo.layers,this.zoom,Ze.brightness,ve,this.worldview);const Bo=Object.fromEntries(ms.patternPositions);yo.addFeatures(Ze,this.tileID.canonical,Bo,ve,this.tileTransform,this.brightness)}}this.status="done",ze(null,{buckets:Object.values(Xe).filter(us=>!us.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ji.image,lineAtlas:dt,imageAtlas:ms,brightness:Ze.brightness})};if(!this.extraShadowCaster){const Nn=i.f5(Ze.glyphDependencies,Ri=>Object.keys(Ri).map(Number));Object.keys(Nn).length?Ee.send("getGlyphs",{uid:this.uid,stacks:Nn,scope:this.scope},(Ri,ms)=>{Wt||(Wt=Ri,mr=ms,bi())},void 0,!1,gn):mr={};const ji=Array.from(Ze.iconDependencies.keys()).map(Ri=>i.I.parse(Ri));ji.length?Ee.send("getImages",{images:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ri,ms)=>{Wt||(Wt=Ri,Ur=new Map,Hr=this.updateImageMapAndGetImageTaskQueue(Ur,ms,Ze.iconDependencies),bi())},void 0,!1,gn):(Ur=new Map,Hr=new Map);const Ui=Array.from(Ze.patternDependencies.keys()).map(Ri=>i.I.parse(Ri));Ui.length?Ee.send("getImages",{images:Ui,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ri,ms)=>{Wt||(Wt=Ri,nn=new Map,ni=this.updateImageMapAndGetImageTaskQueue(nn,ms,Ze.patternDependencies),bi())},void 0,!1,gn):(nn=new Map,ni=new Map)}if(Ze.elevationFeatures&&Ze.elevationFeatures.length>0){const Nn=[];for(const Ui of Object.values(Xe))if(Ui instanceof i.b8){const Ri=Ui.getUnevaluatedPortalGraph();Ri&&Nn.push(Ri)}const ji=i.f6.evaluate(Nn);for(const Ui of Object.values(Xe))if(Ui instanceof i.b8){const Ri=le.layers[We.decode(Ui.sourceLayerIndex)];Ui.setEvaluatedPortalGraph(ji,Ri,this.tileID.canonical,Ze.availableImages,Ze.brightness)}}bi()};Nt.length>0?Promise.allSettled(Nt).then(Me).catch(ze):Me()}rasterizeIfNeeded(le,ue,ve,Ne){Array.from(ue.values()).some(Ee=>Ee.usvg)?this.rasterize(le,ue,ve,Ne):Ne()}updateImageMapAndGetImageTaskQueue(le,ue,ve){const Ne=new Map;for(const Ee of ue.keys()){const ze=ve.get(Ee)||[];for(const We of ze){const je=We.toString(),Xe=ue.get(We.id.toString());Xe.usvg?Ne.has(je)||(Ne.set(je,We),le.set(je,Object.assign({},Xe))):le.set(je,Xe)}}return Ne}rasterize(le,ue,ve,Ne){this.rasterizeTask=le.send("rasterizeImages",{scope:this.scope,tasks:ve},(Ee,ze)=>{if(!Ee)for(const[We,je]of ze.entries()){const Xe=Object.assign(ue.get(We),{data:je});ue.set(We,Xe)}Ne()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function W(Ke,le,ue,ve,Ne){const Ee=new i.aa(le,{brightness:ue,worldview:Ne});for(const ze of Ke)ze.recalculate(Ee,ve)}class ie extends i.E{constructor(le,ue,ve,Ne,Ee,ze,We){super(),this.actor=le,this.layerIndex=ue,this.availableImages=ve,this.availableModels=Ne,this.loadVectorData=ze||i.aJ,this.loading={},this.loaded={},this.deduped=new i.aI(le.scheduler),this.isSpriteLoaded=Ee,this.scheduler=le.scheduler,this.brightness=We}loadTile(le,ue){const ve=le.uid,Ne=le&&le.request,Ee=Ne&&Ne.collectResourceTiming,ze=this.loading[ve]=new J(le);ze.abort=this.loadVectorData(le,(We,je)=>{const Xe=!this.loading[ve];if(delete this.loading[ve],ze.cancelRasterize(),Xe||We||!je)return ze.status="done",Xe||(this.loaded[ve]=ze),ue(We);const dt=je.rawData,Ze={};je.expires&&(Ze.expires=je.expires),je.cacheControl&&(Ze.cacheControl=je.cacheControl),ze.vectorTile=je.vectorTile||new i.fc.VectorTile(new i.bq(dt));const Nt=()=>{ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,Me)=>{if(Qt||!Me)return ue(Qt);const Wt={};if(Ee){const mr=A(Ne);mr.length>0&&(Wt.resourceTiming=JSON.parse(JSON.stringify(mr)))}ue(null,i.h({rawTileData:dt.slice(0)},Me,Ze,Wt))})};this.isSpriteLoaded?Nt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Nt,{type:"parseTile",isSymbolTile:le.isSymbolTile,zoom:le.tileZoom}):Nt()}),this.loaded=this.loaded||{},this.loaded[ve]=ze})}reloadTile(le,ue){const ve=this.loaded,Ne=le.uid;if(ve&&ve[Ne]){const Ee=ve[Ne];Ee.scaleFactor=le.scaleFactor,Ee.showCollisionBoxes=le.showCollisionBoxes,Ee.projection=le.projection,Ee.brightness=le.brightness,Ee.tileTransform=i.aW(le.tileID.canonical,le.projection),Ee.extraShadowCaster=le.extraShadowCaster,Ee.lut=le.lut,Ee.worldview=le.worldview;const ze=(We,je)=>{const Xe=Ee.reloadCallback;Xe&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),ue(We,je)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ze):ze())}else ue(null,void 0)}abortTile(le,ue){const ve=le.uid,Ne=this.loading[ve];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ve]),ue()}removeTile(le,ue){const ve=this.loaded,Ne=le.uid;ve&&ve[Ne]&&delete ve[Ne],ue()}}class fe{loadTile(le,ue){const{uid:ve,encoding:Ne,rawImageData:Ee,padding:ze}=le,We=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,ze):Ee;ue(null,new i.fd(ve,We,Ne,ze<1))}reloadTile(le,ue){ue(null,null)}abortTile(le,ue){ue()}removeTile(le,ue){ue()}getImageData(le,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const ve=this.offscreenCanvasContext.getImageData(-ue,-ue,le.width+2*ue,le.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}i.bp.setPbf(i.bq);class Pe{constructor(le){this._mrt=new i.bp(le.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=le.uid,this.tileID=le.tileID,this.source=le.source}parse(le,ue){const ve=this._mrt;this.status="parsing",this._entireBuffer=le;try{ve.parseHeader(le),this._isHeaderLoaded=!0;const Ne=[];for(const Ee in ve.layers){const ze=ve.getLayer(Ee),We=ze.getDataRange(ze.getBandList()),je=ve.createDecodingTask(We),Xe=le.slice(We.firstByte,We.lastByte+1),dt=i.bp.performDecoding(Xe,je).then(Ze=>je.complete(null,Ze)).catch(Ze=>je.complete(Ze,null));Ne.push(dt)}Promise.allSettled(Ne).then(()=>ue(null,ve)).catch(Ee=>ue(Ee))}catch(Ne){ue(Ne)}}}class Fe{constructor(le){this.actor=le,this.loading={},this.loaded={}}loadTile(le,ue){const ve=le.uid,Ne=le.request,Ee=this.loading[ve]=new Pe(le),{cancel:ze}=i.br(Ne,(We,je,Xe,dt)=>{const Ze=!this.loading[ve];if(delete this.loading[ve],Ze||We||!je)return Ee.status="done",Ze||(this.loaded[ve]=Ee),ue(We);Ee.parse(je,(Nt,Qt)=>{if(Nt||!Qt)return ue(Nt);ue(null,Qt,Xe,dt)}),this.loaded[ve]=Ee});Ee.abort=ze}reloadTile(le,ue){ue(null,void 0)}abortTile(le,ue){const ve=le.uid,Ne=this.loading[ve];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ve]),ue()}removeTile(le,ue){const ve=le.uid;this.loaded[ve]&&delete this.loaded[ve],ue()}decodeRasterArray(le,ue){i.bp.performDecoding(le.buffer,le.task).then(ve=>ue(null,ve)).catch(ve=>ue(ve))}}const ht=i.fc.VectorTileFeature.prototype.toGeoJSON;class at{constructor(le){this._feature=le,this.extent=i.aj,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const ue of this._feature.geometry)le.push([new i.P(ue[0],ue[1])]);return le}{const le=[];for(const ue of this._feature.geometry){const ve=[];for(const Ne of ue)ve.push(new i.P(Ne[0],Ne[1]));le.push(ve)}return le}}toGeoJSON(le,ue,ve){return ht.call(this,le,ue,ve)}}class Dt{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.aj,this.length=le.length,this._features=le}feature(le){return new at(this._features[le])}}class kt{constructor(le,ue){this.name=le,this.extent=i.aj,this.length=ue.length,this._features=ue}feature(le){return new at(this._features[le])}}class Rt extends Dt{constructor(le){super([]),this.layers={};for(const ue in le)this.layers[ue]=new kt(ue,le[ue])}}const hr=64/4096,Tr=128;class _r{constructor(){this.features=new Map}clear(){this.features.clear()}load(le=[],ue){for(const ve of le){const Ne=ve.id;if(Ne==null)continue;let Ee=this.features.get(Ne);Ee&&this.updateCache(Ee,ue),ve.geometry?(Ee=Br(ve),this.updateCache(Ee,ue),this.features.set(Ne,Ee)):this.features.delete(Ne),this.updateCache(Ee,ue)}}updateCache(le,ue){for(const{canonical:ve,uid:Ne}of Object.values(ue)){const{z:Ee,x:ze,y:We}=ve;Sr(le,Math.pow(2,Ee),ze,We)&&delete ue[Ne]}}getTile(le,ue,ve){const Ne=Math.pow(2,le),Ee=[];for(const ze of this.features.values())Sr(ze,Ne,ue,ve)&&Ee.push(Er(ze,Ne,ue,ve));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function Sr({minX:Ke,minY:le,maxX:ue,maxY:ve},Ne,Ee,ze){return Ke<(Ee+1+hr)/Ne&&le<(ze+1+hr)/Ne&&ue>(Ee-hr)/Ne&&ve>(ze-hr)/Ne}function Br(Ke){const{id:le,geometry:ue,properties:ve}=Ke;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ne,coordinates:Ee}=ue,ze={id:le,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},We=ze.geometry;if(Ne==="Point")Ft(Ee,We,ze);else if(Ne==="MultiPoint")for(const je of Ee)Ft(je,We,ze);else if(Ne==="LineString")ze.type=2,br(Ee,We,ze);else if(Ne==="MultiLineString")ze.type=2,Yt(Ee,We,ze);else if(Ne==="Polygon")ze.type=3,Yt(Ee,We,ze,!0);else{if(Ne!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ze.type=3;for(const je of Ee)Yt(je,We,ze,!0)}return ze}function Ft([Ke,le],ue,ve){const Ne=i.aD(Ke);let Ee=i.aH(le);Ee=Ee<0?0:Ee>1?1:Ee,ue.push(Ne,Ee),ve.minX=Math.min(ve.minX,Ne),ve.minY=Math.min(ve.minY,Ee),ve.maxX=Math.max(ve.maxX,Ne),ve.maxY=Math.max(ve.maxY,Ee)}function br(Ke,le,ue,ve=!1,Ne=!1){const Ee=[];for(const ze of Ke)Ft(ze,Ee,ue);le.push(Ee),ve&&function(ze,We){let je=0;for(let Xe=0,dt=ze.length,Ze=dt-2;Xe<dt;Ze=Xe,Xe+=2)je+=(ze[Xe]-ze[Ze])*(ze[Xe+1]+ze[Ze+1]);if(je>0===We)for(let Xe=0,dt=ze.length;Xe<dt/2;Xe+=2){const Ze=ze[Xe],Nt=ze[Xe+1];ze[Xe]=ze[dt-2-Xe],ze[Xe+1]=ze[dt-1-Xe],ze[dt-2-Xe]=Ze,ze[dt-1-Xe]=Nt}}(Ee,Ne)}function Yt(Ke,le,ue,ve=!1){for(let Ne=0;Ne<Ke.length;Ne++)br(Ke[Ne],le,ue,ve,Ne===0)}function Er(Ke,le,ue,ve){const{id:Ne,type:Ee,geometry:ze,tags:We}=Ke,je=[];if(Ee===1)(function(Xe,dt,Ze,Nt,Qt){for(let Me=0;Me<Xe.length;Me+=2){const Wt=Math.round(i.aj*(Xe[Me+0]*dt-Ze)),mr=Math.round(i.aj*(Xe[Me+1]*dt-Nt));Qt.push([Wt,mr])}})(ze,le,ue,ve,je);else for(const Xe of ze)gt(Xe,le,ue,ve,je);return{id:Ne,type:Ee,geometry:je,tags:We}}function gt(Ke,le,ue,ve,Ne){const ze=i.aj+Tr;let We;for(let je=0;je<Ke.length-2;je+=2){let Xe=Math.round(i.aj*(Ke[je+0]*le-ue)),dt=Math.round(i.aj*(Ke[je+1]*le-ve)),Ze=Math.round(i.aj*(Ke[je+2]*le-ue)),Nt=Math.round(i.aj*(Ke[je+3]*le-ve));const Qt=Ze-Xe,Me=Nt-dt;Xe<-128&&Ze<-128||(Xe<-128?(dt+=Math.round(Me*((-128-Xe)/Qt)),Xe=-128):Ze<-128&&(Nt=dt+Math.round(Me*((-128-Xe)/Qt)),Ze=-128),dt<-128&&Nt<-128||(dt<-128?(Xe+=Math.round(Qt*((-128-dt)/Me)),dt=-128):Nt<-128&&(Ze=Xe+Math.round(Qt*((-128-dt)/Me)),Nt=-128),Xe>=ze&&Ze>=ze||(Xe>=ze?(dt+=Math.round(Me*((ze-Xe)/Qt)),Xe=ze):Ze>=ze&&(Nt=dt+Math.round(Me*((ze-Xe)/Qt)),Ze=ze),dt>=ze&&Nt>=ze||(dt>=ze?(Xe+=Math.round(Qt*((ze-dt)/Me)),dt=ze):Nt>=ze&&(Ze=Xe+Math.round(Qt*((ze-dt)/Me)),Nt=ze),We&&Xe===We[We.length-1][0]&&dt===We[We.length-1][1]||(We=[[Xe,dt]],Ne.push(We)),We.push([Ze,Nt])))))}}var Jt,Ht,qe,Ct={exports:{}},kr=function(){if(qe)return Ct.exports;qe=1;var Ke=i.fg(),le=function(){if(Ht)return Jt;Ht=1;var dt=i.fe(),Ze=i.ff().VectorTileFeature;function Nt(Me,Wt){this.options=Wt||{},this.features=Me,this.length=Me.length}function Qt(Me,Wt){this.id=typeof Me.id=="number"?Me.id:void 0,this.type=Me.type,this.rawGeometry=Me.type===1?[Me.geometry]:Me.geometry,this.properties=Me.tags,this.extent=Wt||4096}return Jt=Nt,Nt.prototype.feature=function(Me){return new Qt(this.features[Me],this.options.extent)},Qt.prototype.loadGeometry=function(){var Me=this.rawGeometry;this.geometry=[];for(var Wt=0;Wt<Me.length;Wt++){for(var mr=Me[Wt],Ur=[],nn=0;nn<mr.length;nn++)Ur.push(new dt(mr[nn][0],mr[nn][1]));this.geometry.push(Ur)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Me=this.geometry,Wt=1/0,mr=-1/0,Ur=1/0,nn=-1/0,Hr=0;Hr<Me.length;Hr++)for(var ni=Me[Hr],gn=0;gn<ni.length;gn++){var bi=ni[gn];Wt=Math.min(Wt,bi.x),mr=Math.max(mr,bi.x),Ur=Math.min(Ur,bi.y),nn=Math.max(nn,bi.y)}return[Wt,Ur,mr,nn]},Qt.prototype.toGeoJSON=Ze.prototype.toGeoJSON,Jt}();function ue(dt){var Ze=new Ke;return function(Nt,Qt){for(var Me in Nt.layers)Qt.writeMessage(3,ve,Nt.layers[Me])}(dt,Ze),Ze.finish()}function ve(dt,Ze){var Nt;Ze.writeVarintField(15,dt.version||1),Ze.writeStringField(1,dt.name||""),Ze.writeVarintField(5,dt.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(Nt=0;Nt<dt.length;Nt++)Qt.feature=dt.feature(Nt),Ze.writeMessage(2,Ne,Qt);var Me=Qt.keys;for(Nt=0;Nt<Me.length;Nt++)Ze.writeStringField(3,Me[Nt]);var Wt=Qt.values;for(Nt=0;Nt<Wt.length;Nt++)Ze.writeMessage(4,Xe,Wt[Nt])}function Ne(dt,Ze){var Nt=dt.feature;Nt.id!==void 0&&Ze.writeVarintField(1,Nt.id),Ze.writeMessage(2,Ee,dt),Ze.writeVarintField(3,Nt.type),Ze.writeMessage(4,je,Nt)}function Ee(dt,Ze){var Nt=dt.feature,Qt=dt.keys,Me=dt.values,Wt=dt.keycache,mr=dt.valuecache;for(var Ur in Nt.properties){var nn=Nt.properties[Ur],Hr=Wt[Ur];if(nn!==null){Hr===void 0&&(Qt.push(Ur),Wt[Ur]=Hr=Qt.length-1),Ze.writeVarint(Hr);var ni=typeof nn;ni!=="string"&&ni!=="boolean"&&ni!=="number"&&(nn=JSON.stringify(nn));var gn=ni+":"+nn,bi=mr[gn];bi===void 0&&(Me.push(nn),mr[gn]=bi=Me.length-1),Ze.writeVarint(bi)}}}function ze(dt,Ze){return(Ze<<3)+(7&dt)}function We(dt){return dt<<1^dt>>31}function je(dt,Ze){for(var Nt=dt.loadGeometry(),Qt=dt.type,Me=0,Wt=0,mr=Nt.length,Ur=0;Ur<mr;Ur++){var nn=Nt[Ur],Hr=1;Qt===1&&(Hr=nn.length),Ze.writeVarint(ze(1,Hr));for(var ni=Qt===3?nn.length-1:nn.length,gn=0;gn<ni;gn++){gn===1&&Qt!==1&&Ze.writeVarint(ze(2,ni-1));var bi=nn[gn].x-Me,Fn=nn[gn].y-Wt;Ze.writeVarint(We(bi)),Ze.writeVarint(We(Fn)),Me+=bi,Wt+=Fn}Qt===3&&Ze.writeVarint(ze(7,1))}}function Xe(dt,Ze){var Nt=typeof dt;Nt==="string"?Ze.writeStringField(1,dt):Nt==="boolean"?Ze.writeBooleanField(7,dt):Nt==="number"&&(dt%1!=0?Ze.writeDoubleField(3,dt):dt<0?Ze.writeSVarintField(6,dt):Ze.writeVarintField(5,dt))}return Ct.exports=ue,Ct.exports.fromVectorTileJs=ue,Ct.exports.fromGeojsonVt=function(dt,Ze){Ze=Ze||{};var Nt={};for(var Qt in dt)Nt[Qt]=new le(dt[Qt].features,Ze),Nt[Qt].name=Qt,Nt[Qt].version=Ze.version,Nt[Qt].extent=Ze.extent;return ue({layers:Nt})},Ct.exports.GeoJSONWrapper=le,Ct.exports}(),Zr=i.fh(kr);const Rr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},ar=Math.fround||(lr=new Float32Array(1),Ke=>(lr[0]=+Ke,lr[0]));var lr;const $r=3,Cr=5,Fr=6;class Zn{constructor(le){this.options=Object.assign(Object.create(Rr),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:ue,minZoom:ve,maxZoom:Ne}=this.options;ue&&console.time("total time");const Ee=`prepare ${le.length} points`;ue&&console.time(Ee),this.points=le;const ze=[];for(let je=0;je<le.length;je++){const Xe=le[je];if(!Xe.geometry)continue;const[dt,Ze]=Xe.geometry.coordinates,Nt=ar(vs(dt)),Qt=ar($s(Ze));ze.push(Nt,Qt,1/0,je,-1,1),this.options.reduce&&ze.push(0)}let We=this.trees[Ne+1]=this._createTree(ze);ue&&console.timeEnd(Ee);for(let je=Ne;je>=ve;je--){const Xe=+Date.now();We=this.trees[je]=this._createTree(this._cluster(We,je)),ue&&console.log("z%d: %d clusters in %dms",je,We.numItems,+Date.now()-Xe)}return ue&&console.timeEnd("total time"),this}getClusters(le,ue){let ve=((le[0]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,le[1]));let Ee=le[2]===180?180:((le[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)ve=-180,Ee=180;else if(ve>Ee){const Ze=this.getClusters([ve,Ne,180,ze],ue),Nt=this.getClusters([-180,Ne,Ee,ze],ue);return Ze.concat(Nt)}const We=this.trees[this._limitZoom(ue)],je=We.range(vs(ve),$s(ze),vs(Ee),$s(Ne)),Xe=We.data,dt=[];for(const Ze of je){const Nt=this.stride*Ze;dt.push(Xe[Nt+Cr]>1?ri(Xe,Nt,this.clusterProps):this.points[Xe[Nt+$r]])}return dt}getChildren(le){const ue=this._getOriginId(le),ve=this._getOriginZoom(le),Ne="No cluster with the specified id.",Ee=this.trees[ve];if(!Ee)throw new Error(Ne);const ze=Ee.data;if(ue*this.stride>=ze.length)throw new Error(Ne);const We=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),je=Ee.within(ze[ue*this.stride],ze[ue*this.stride+1],We),Xe=[];for(const dt of je){const Ze=dt*this.stride;ze[Ze+4]===le&&Xe.push(ze[Ze+Cr]>1?ri(ze,Ze,this.clusterProps):this.points[ze[Ze+$r]])}if(Xe.length===0)throw new Error(Ne);return Xe}getLeaves(le,ue,ve){const Ne=[];return this._appendLeaves(Ne,le,ue=ue||10,ve=ve||0,0),Ne}getTile(le,ue,ve){const Ne=this.trees[this._limitZoom(le)],Ee=Math.pow(2,le),{extent:ze,radius:We}=this.options,je=We/ze,Xe=(ve-je)/Ee,dt=(ve+1+je)/Ee,Ze={features:[]};return this._addTileFeatures(Ne.range((ue-je)/Ee,Xe,(ue+1+je)/Ee,dt),Ne.data,ue,ve,Ee,Ze),ue===0&&this._addTileFeatures(Ne.range(1-je/Ee,Xe,1,dt),Ne.data,Ee,ve,Ee,Ze),ue===Ee-1&&this._addTileFeatures(Ne.range(0,Xe,je/Ee,dt),Ne.data,-1,ve,Ee,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(le){let ue=this._getOriginZoom(le)-1;for(;ue<=this.options.maxZoom;){const ve=this.getChildren(le);if(ue++,ve.length!==1)break;le=ve[0].properties.cluster_id}return ue}_appendLeaves(le,ue,ve,Ne,Ee){const ze=this.getChildren(ue);for(const We of ze){const je=We.properties;if(je&&je.cluster?Ee+je.point_count<=Ne?Ee+=je.point_count:Ee=this._appendLeaves(le,je.cluster_id,ve,Ne,Ee):Ee<Ne?Ee++:le.push(We),le.length===ve)break}return Ee}_createTree(le){const ue=new i.bW(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<le.length;ve+=this.stride)ue.add(le[ve],le[ve+1]);return ue.finish(),ue.data=le,ue}_addTileFeatures(le,ue,ve,Ne,Ee,ze){for(const We of le){const je=We*this.stride,Xe=ue[je+Cr]>1;let dt,Ze,Nt;if(Xe)dt=On(ue,je,this.clusterProps),Ze=ue[je],Nt=ue[je+1];else{const Wt=this.points[ue[je+$r]];dt=Wt.properties;const[mr,Ur]=Wt.geometry.coordinates;Ze=vs(mr),Nt=$s(Ur)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(Ze*Ee-ve)),Math.round(this.options.extent*(Nt*Ee-Ne))]],tags:dt};let Me;Me=Xe||this.options.generateId?ue[je+$r]:this.points[ue[je+$r]].id,Me!==void 0&&(Qt.id=Me),ze.features.push(Qt)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,ue){const{radius:ve,extent:Ne,reduce:Ee,minPoints:ze}=this.options,We=ve/(Ne*Math.pow(2,ue)),je=le.data,Xe=[],dt=this.stride;for(let Ze=0;Ze<je.length;Ze+=dt){if(je[Ze+2]<=ue)continue;je[Ze+2]=ue;const Nt=je[Ze],Qt=je[Ze+1],Me=le.within(je[Ze],je[Ze+1],We),Wt=je[Ze+Cr];let mr=Wt;for(const Ur of Me){const nn=Ur*dt;je[nn+2]>ue&&(mr+=je[nn+Cr])}if(mr>Wt&&mr>=ze){let Ur,nn=Nt*Wt,Hr=Qt*Wt,ni=-1;const gn=(Ze/dt<<5)+(ue+1)+this.points.length;for(const bi of Me){const Fn=bi*dt;if(je[Fn+2]<=ue)continue;je[Fn+2]=ue;const Nn=je[Fn+Cr];nn+=je[Fn]*Nn,Hr+=je[Fn+1]*Nn,je[Fn+4]=gn,Ee&&(Ur||(Ur=this._map(je,Ze,!0),ni=this.clusterProps.length,this.clusterProps.push(Ur)),Ee(Ur,this._map(je,Fn)))}je[Ze+4]=gn,Xe.push(nn/mr,Hr/mr,1/0,gn,-1,mr),Ee&&Xe.push(ni)}else{for(let Ur=0;Ur<dt;Ur++)Xe.push(je[Ze+Ur]);if(mr>1)for(const Ur of Me){const nn=Ur*dt;if(!(je[nn+2]<=ue)){je[nn+2]=ue;for(let Hr=0;Hr<dt;Hr++)Xe.push(je[nn+Hr])}}}}return Xe}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,ue,ve){if(le[ue+Cr]>1){const ze=this.clusterProps[le[ue+Fr]];return ve?Object.assign({},ze):ze}const Ne=this.points[le[ue+$r]].properties,Ee=this.options.map(Ne);return ve&&Ee===Ne?Object.assign({},Ee):Ee}}function ri(Ke,le,ue){return{type:"Feature",id:Ke[le+$r],properties:On(Ke,le,ue),geometry:{type:"Point",coordinates:[(ve=Ke[le],360*(ve-.5)),Hi(Ke[le+1])]}};var ve}function On(Ke,le,ue){const ve=Ke[le+Cr],Ne=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Ee=Ke[le+Fr],ze=Ee===-1?{}:Object.assign({},ue[Ee]);return Object.assign(ze,{cluster:!0,cluster_id:Ke[le+$r],point_count:ve,point_count_abbreviated:Ne})}function vs(Ke){return Ke/360+.5}function $s(Ke){const le=Math.sin(Ke*Math.PI/180),ue=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ue<0?0:ue>1?1:ue}function Hi(Ke){const le=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function mo(Ke,le,ue,ve){let Ne=ve;const Ee=le+(ue-le>>1);let ze,We=ue-le;const je=Ke[le],Xe=Ke[le+1],dt=Ke[ue],Ze=Ke[ue+1];for(let Nt=le+3;Nt<ue;Nt+=3){const Qt=El(Ke[Nt],Ke[Nt+1],je,Xe,dt,Ze);if(Qt>Ne)ze=Nt,Ne=Qt;else if(Qt===Ne){const Me=Math.abs(Nt-Ee);Me<We&&(ze=Nt,We=Me)}}Ne>ve&&(ze-le>3&&mo(Ke,le,ze,ve),Ke[ze+2]=Ne,ue-ze>3&&mo(Ke,ze,ue,ve))}function El(Ke,le,ue,ve,Ne,Ee){let ze=Ne-ue,We=Ee-ve;if(ze!==0||We!==0){const je=((Ke-ue)*ze+(le-ve)*We)/(ze*ze+We*We);je>1?(ue=Ne,ve=Ee):je>0&&(ue+=ze*je,ve+=We*je)}return ze=Ke-ue,We=le-ve,ze*ze+We*We}function zi(Ke,le,ue,ve){const Ne={id:Ke??null,type:le,geometry:ue,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(le==="Point"||le==="MultiPoint"||le==="LineString")Ki(Ne,ue);else if(le==="Polygon")Ki(Ne,ue[0]);else if(le==="MultiLineString")for(const Ee of ue)Ki(Ne,Ee);else if(le==="MultiPolygon")for(const Ee of ue)Ki(Ne,Ee[0]);return Ne}function Ki(Ke,le){for(let ue=0;ue<le.length;ue+=3)Ke.minX=Math.min(Ke.minX,le[ue]),Ke.minY=Math.min(Ke.minY,le[ue+1]),Ke.maxX=Math.max(Ke.maxX,le[ue]),Ke.maxY=Math.max(Ke.maxY,le[ue+1])}function to(Ke,le,ue,ve){if(!le.geometry)return;const Ne=le.geometry.coordinates;if(Ne&&Ne.length===0)return;const Ee=le.geometry.type,ze=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let We=[],je=le.id;if(ue.promoteId?je=le.properties[ue.promoteId]:ue.generateId&&(je=ve||0),Ee==="Point")Qo(Ne,We);else if(Ee==="MultiPoint")for(const Xe of Ne)Qo(Xe,We);else if(Ee==="LineString")To(Ne,We,ze,!1);else if(Ee==="MultiLineString"){if(ue.lineMetrics){for(const Xe of Ne)We=[],To(Xe,We,ze,!1),Ke.push(zi(je,"LineString",We,le.properties));return}Cs(Ne,We,ze,!1)}else if(Ee==="Polygon")Cs(Ne,We,ze,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Xe of le.geometry.geometries)to(Ke,{id:je,geometry:Xe,properties:le.properties},ue,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Ne){const dt=[];Cs(Xe,dt,ze,!0),We.push(dt)}}Ke.push(zi(je,Ee,We,le.properties))}function Qo(Ke,le){le.push(Ua(Ke[0]),wa(Ke[1]),0)}function To(Ke,le,ue,ve){let Ne,Ee,ze=0;for(let je=0;je<Ke.length;je++){const Xe=Ua(Ke[je][0]),dt=wa(Ke[je][1]);le.push(Xe,dt,0),je>0&&(ze+=ve?(Ne*dt-Xe*Ee)/2:Math.sqrt(Math.pow(Xe-Ne,2)+Math.pow(dt-Ee,2))),Ne=Xe,Ee=dt}const We=le.length-3;le[2]=1,mo(le,0,We,ue),le[We+2]=1,le.size=Math.abs(ze),le.start=0,le.end=le.size}function Cs(Ke,le,ue,ve){for(let Ne=0;Ne<Ke.length;Ne++){const Ee=[];To(Ke[Ne],Ee,ue,ve),le.push(Ee)}}function Ua(Ke){return Ke/360+.5}function wa(Ke){const le=Math.sin(Ke*Math.PI/180),ue=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ue<0?0:ue>1?1:ue}function is(Ke,le,ue,ve,Ne,Ee,ze,We){if(ve/=le,Ee>=(ue/=le)&&ze<ve)return Ke;if(ze<ue||Ee>=ve)return null;const je=[];for(const Xe of Ke){const dt=Xe.geometry;let Ze=Xe.type;const Nt=Ne===0?Xe.minX:Xe.minY,Qt=Ne===0?Xe.maxX:Xe.maxY;if(Nt>=ue&&Qt<ve){je.push(Xe);continue}if(Qt<ue||Nt>=ve)continue;let Me=[];if(Ze==="Point"||Ze==="MultiPoint")Sa(dt,Me,ue,ve,Ne);else if(Ze==="LineString")Hs(dt,Me,ue,ve,Ne,!1,We.lineMetrics);else if(Ze==="MultiLineString")ss(dt,Me,ue,ve,Ne,!1);else if(Ze==="Polygon")ss(dt,Me,ue,ve,Ne,!0);else if(Ze==="MultiPolygon")for(const Wt of dt){const mr=[];ss(Wt,mr,ue,ve,Ne,!0),mr.length&&Me.push(mr)}if(Me.length){if(We.lineMetrics&&Ze==="LineString"){for(const Wt of Me)je.push(zi(Xe.id,Ze,Wt,Xe.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Me.length===1?(Ze="LineString",Me=Me[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Me.length===3?"Point":"MultiPoint"),je.push(zi(Xe.id,Ze,Me,Xe.tags))}}return je.length?je:null}function Sa(Ke,le,ue,ve,Ne){for(let Ee=0;Ee<Ke.length;Ee+=3){const ze=Ke[Ee+Ne];ze>=ue&&ze<=ve&&go(le,Ke[Ee],Ke[Ee+1],Ke[Ee+2])}}function Hs(Ke,le,ue,ve,Ne,Ee,ze){let We=Fo(Ke);const je=Ne===0?Ta:Ea;let Xe,dt,Ze=Ke.start;for(let mr=0;mr<Ke.length-3;mr+=3){const Ur=Ke[mr],nn=Ke[mr+1],Hr=Ke[mr+2],ni=Ke[mr+3],gn=Ke[mr+4],bi=Ne===0?Ur:nn,Fn=Ne===0?ni:gn;let Nn=!1;ze&&(Xe=Math.sqrt(Math.pow(Ur-ni,2)+Math.pow(nn-gn,2))),bi<ue?Fn>ue&&(dt=je(We,Ur,nn,ni,gn,ue),ze&&(We.start=Ze+Xe*dt)):bi>ve?Fn<ve&&(dt=je(We,Ur,nn,ni,gn,ve),ze&&(We.start=Ze+Xe*dt)):go(We,Ur,nn,Hr),Fn<ue&&bi>=ue&&(dt=je(We,Ur,nn,ni,gn,ue),Nn=!0),Fn>ve&&bi<=ve&&(dt=je(We,Ur,nn,ni,gn,ve),Nn=!0),!Ee&&Nn&&(ze&&(We.end=Ze+Xe*dt),le.push(We),We=Fo(Ke)),ze&&(Ze+=Xe)}let Nt=Ke.length-3;const Qt=Ke[Nt],Me=Ke[Nt+1],Wt=Ne===0?Qt:Me;Wt>=ue&&Wt<=ve&&go(We,Qt,Me,Ke[Nt+2]),Nt=We.length-3,Ee&&Nt>=3&&(We[Nt]!==We[0]||We[Nt+1]!==We[1])&&go(We,We[0],We[1],We[2]),We.length&&le.push(We)}function Fo(Ke){const le=[];return le.size=Ke.size,le.start=Ke.start,le.end=Ke.end,le}function ss(Ke,le,ue,ve,Ne,Ee){for(const ze of Ke)Hs(ze,le,ue,ve,Ne,Ee,!1)}function go(Ke,le,ue,ve){Ke.push(le,ue,ve)}function Ta(Ke,le,ue,ve,Ne,Ee){const ze=(Ee-le)/(ve-le);return go(Ke,Ee,ue+(Ne-ue)*ze,1),ze}function Ea(Ke,le,ue,ve,Ne,Ee){const ze=(Ee-ue)/(Ne-ue);return go(Ke,le+(ve-le)*ze,Ee,1),ze}function Ca(Ke,le){const ue=[];for(let ve=0;ve<Ke.length;ve++){const Ne=Ke[ve],Ee=Ne.type;let ze;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ze=As(Ne.geometry,le);else if(Ee==="MultiLineString"||Ee==="Polygon"){ze=[];for(const We of Ne.geometry)ze.push(As(We,le))}else if(Ee==="MultiPolygon"){ze=[];for(const We of Ne.geometry){const je=[];for(const Xe of We)je.push(As(Xe,le));ze.push(je)}}ue.push(zi(Ne.id,Ee,ze,Ne.tags))}return ue}function As(Ke,le){const ue=[];ue.size=Ke.size,Ke.start!==void 0&&(ue.start=Ke.start,ue.end=Ke.end);for(let ve=0;ve<Ke.length;ve+=3)ue.push(Ke[ve]+le,Ke[ve+1],Ke[ve+2]);return ue}function $a(Ke,le){if(Ke.transformed)return Ke;const ue=1<<Ke.z,ve=Ke.x,Ne=Ke.y;for(const Ee of Ke.features){const ze=Ee.geometry,We=Ee.type;if(Ee.geometry=[],We===1)for(let je=0;je<ze.length;je+=2)Ee.geometry.push(Dr(ze[je],ze[je+1],le,ue,ve,Ne));else for(let je=0;je<ze.length;je++){const Xe=[];for(let dt=0;dt<ze[je].length;dt+=2)Xe.push(Dr(ze[je][dt],ze[je][dt+1],le,ue,ve,Ne));Ee.geometry.push(Xe)}}return Ke.transformed=!0,Ke}function Dr(Ke,le,ue,ve,Ne,Ee){return[Math.round(ue*(Ke*ve-Ne)),Math.round(ue*(le*ve-Ee))]}function ci(Ke,le,ue,ve,Ne){const Ee=le===Ne.maxZoom?0:Ne.tolerance/((1<<le)*Ne.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:ue,y:ve,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Ke)di(ze,We,Ee,Ne);return ze}function di(Ke,le,ue,ve){const Ne=le.geometry,Ee=le.type,ze=[];if(Ke.minX=Math.min(Ke.minX,le.minX),Ke.minY=Math.min(Ke.minY,le.minY),Ke.maxX=Math.max(Ke.maxX,le.maxX),Ke.maxY=Math.max(Ke.maxY,le.maxY),Ee==="Point"||Ee==="MultiPoint")for(let We=0;We<Ne.length;We+=3)ze.push(Ne[We],Ne[We+1]),Ke.numPoints++,Ke.numSimplified++;else if(Ee==="LineString")Vi(ze,Ne,Ke,ue,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let We=0;We<Ne.length;We++)Vi(ze,Ne[We],Ke,ue,Ee==="Polygon",We===0);else if(Ee==="MultiPolygon")for(let We=0;We<Ne.length;We++){const je=Ne[We];for(let Xe=0;Xe<je.length;Xe++)Vi(ze,je[Xe],Ke,ue,!0,Xe===0)}if(ze.length){let We=le.tags||null;if(Ee==="LineString"&&ve.lineMetrics){We={};for(const Xe in le.tags)We[Xe]=le.tags[Xe];We.mapbox_clip_start=Ne.start/Ne.size,We.mapbox_clip_end=Ne.end/Ne.size}const je={geometry:ze,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:We};le.id!==null&&(je.id=le.id),Ke.features.push(je)}}function Vi(Ke,le,ue,ve,Ne,Ee){const ze=ve*ve;if(ve>0&&le.size<(Ne?ze:ve))return void(ue.numPoints+=le.length/3);const We=[];for(let je=0;je<le.length;je+=3)(ve===0||le[je+2]>ze)&&(ue.numSimplified++,We.push(le[je],le[je+1])),ue.numPoints++;Ne&&function(je,Xe){let dt=0;for(let Ze=0,Nt=je.length,Qt=Nt-2;Ze<Nt;Qt=Ze,Ze+=2)dt+=(je[Ze]-je[Qt])*(je[Ze+1]+je[Qt+1]);if(dt>0===Xe)for(let Ze=0,Nt=je.length;Ze<Nt/2;Ze+=2){const Qt=je[Ze],Me=je[Ze+1];je[Ze]=je[Nt-2-Ze],je[Ze+1]=je[Nt-1-Ze],je[Nt-2-Ze]=Qt,je[Nt-1-Ze]=Me}}(We,Ee),Ke.push(We)}const Is={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ha{constructor(le,ue){const ve=(ue=this.options=function(Ee,ze){for(const We in ze)Ee[We]=ze[We];return Ee}(Object.create(Is),ue)).debug;if(ve&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ne=function(Ee,ze){const We=[];if(Ee.type==="FeatureCollection")for(let je=0;je<Ee.features.length;je++)to(We,Ee.features[je],ze,je);else to(We,Ee.type==="Feature"?Ee:{geometry:Ee},ze);return We}(le,ue);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=function(Ee,ze){const We=ze.buffer/ze.extent;let je=Ee;const Xe=is(Ee,1,-1-We,We,0,-1,2,ze),dt=is(Ee,1,1-We,2+We,0,-1,2,ze);return(Xe||dt)&&(je=is(Ee,1,-We,1+We,0,-1,2,ze)||[],Xe&&(je=Ca(Xe,1).concat(je)),dt&&(je=je.concat(Ca(dt,-1)))),je}(Ne,ue),Ne.length&&this.splitTile(Ne,0,0,0),ve&&(Ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,ue,ve,Ne,Ee,ze,We){const je=[le,ue,ve,Ne],Xe=this.options,dt=Xe.debug;for(;je.length;){Ne=je.pop(),ve=je.pop(),ue=je.pop(),le=je.pop();const Ze=1<<ue,Nt=Ga(ue,ve,Ne);let Qt=this.tiles[Nt];if(!Qt&&(dt>1&&console.time("creation"),Qt=this.tiles[Nt]=ci(le,ue,ve,Ne,Xe),this.tileCoords.push({z:ue,x:ve,y:Ne}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ve,Ne,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Nn=`z${ue}`;this.stats[Nn]=(this.stats[Nn]||0)+1,this.total++}if(Qt.source=le,Ee==null){if(ue===Xe.indexMaxZoom||Qt.numPoints<=Xe.indexMaxPoints)continue}else{if(ue===Xe.maxZoom||ue===Ee)continue;if(Ee!=null){const Nn=Ee-ue;if(ve!==ze>>Nn||Ne!==We>>Nn)continue}}if(Qt.source=null,le.length===0)continue;dt>1&&console.time("clipping");const Me=.5*Xe.buffer/Xe.extent,Wt=.5-Me,mr=.5+Me,Ur=1+Me;let nn=null,Hr=null,ni=null,gn=null,bi=is(le,Ze,ve-Me,ve+mr,0,Qt.minX,Qt.maxX,Xe),Fn=is(le,Ze,ve+Wt,ve+Ur,0,Qt.minX,Qt.maxX,Xe);le=null,bi&&(nn=is(bi,Ze,Ne-Me,Ne+mr,1,Qt.minY,Qt.maxY,Xe),Hr=is(bi,Ze,Ne+Wt,Ne+Ur,1,Qt.minY,Qt.maxY,Xe),bi=null),Fn&&(ni=is(Fn,Ze,Ne-Me,Ne+mr,1,Qt.minY,Qt.maxY,Xe),gn=is(Fn,Ze,Ne+Wt,Ne+Ur,1,Qt.minY,Qt.maxY,Xe),Fn=null),dt>1&&console.timeEnd("clipping"),je.push(nn||[],ue+1,2*ve,2*Ne),je.push(Hr||[],ue+1,2*ve,2*Ne+1),je.push(ni||[],ue+1,2*ve+1,2*Ne),je.push(gn||[],ue+1,2*ve+1,2*Ne+1)}}getTile(le,ue,ve){le=+le,ue=+ue,ve=+ve;const Ne=this.options,{extent:Ee,debug:ze}=Ne;if(le<0||le>24)return null;const We=1<<le,je=Ga(le,ue=ue+We&We-1,ve);if(this.tiles[je])return $a(this.tiles[je],Ee);ze>1&&console.log("drilling down to z%d-%d-%d",le,ue,ve);let Xe,dt=le,Ze=ue,Nt=ve;for(;!Xe&&dt>0;)dt--,Ze>>=1,Nt>>=1,Xe=this.tiles[Ga(dt,Ze,Nt)];return Xe&&Xe.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",dt,Ze,Nt),console.time("drilling down")),this.splitTile(Xe.source,dt,Ze,Nt,le,ue,ve),ze>1&&console.timeEnd("drilling down"),this.tiles[je]?$a(this.tiles[je],Ee):null):null}}function Ga(Ke,le,ue){return 32*((1<<Ke)*ue+le)+Ke}function Ot(Ke,le){const ue=Ke.tileID.canonical;if(!this._geoJSONIndex)return void le(null,null);const ve=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!ve)return void le(null,null);const Ne=je=>je.tags&&"3d_elevation_id"in je.tags&&"source"in je.tags&&je.tags.source==="elevation",Ee=ve.features.filter(je=>Ne(je));let ze;if(Ee.length>0){const je=ve.features.filter(Xe=>!Ne(Xe));ze=new Rt({_geojsonTileLayer:je,hd_road_elevation:Ee})}else ze=new Dt(ve.features);let We=Zr(ze);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),le(null,{vectorTile:ze,rawData:We.buffer})}class qa extends ie{constructor(le,ue,ve,Ne,Ee,ze,We){super(le,ue,ve,Ne,Ee,Ot,We),ze&&(this.loadGeoJSON=ze),this._dynamicIndex=new _r}loadData(le,ue){const ve=le&&le.request,Ne=ve&&ve.collectResourceTiming;this.loadGeoJSON(le,(Ee,ze)=>{if(Ee||!ze)return ue(Ee);if(typeof ze!="object")return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{try{if(le.filter){const je=i.X(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));ze.features=ze.features.filter(Xe=>je.value.evaluate({zoom:0},Xe))}le.dynamic?(ze.type==="Feature"&&(ze={type:"FeatureCollection",features:[ze]}),le.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ze.features,this.loaded),le.cluster&&(ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=le.cluster?new Zn(function({superclusterOptions:je,clusterProperties:Xe}){if(!Xe||!je)return je;const dt={},Ze={},Nt={accumulated:null,zoom:0},Qt={properties:null},Me=Object.keys(Xe);for(const Wt of Me){const[mr,Ur]=Xe[Wt],nn=i.X(Ur),Hr=i.X(typeof mr=="string"?[mr,["accumulated"],["get",Wt]]:mr);dt[Wt]=nn.value,Ze[Wt]=Hr.value}return je.map=Wt=>{Qt.properties=Wt;const mr={};for(const Ur of Me)mr[Ur]=dt[Ur].evaluate(Nt,Qt);return mr},je.reduce=(Wt,mr)=>{Qt.properties=mr;for(const Ur of Me)Nt.accumulated=Wt[Ur],Wt[Ur]=Ze[Ur].evaluate(Nt,Qt)},je}(le)).load(ze.features):le.dynamic?this._dynamicIndex:function(je,Xe){return new Ha(je,Xe)}(ze,le.geojsonVtOptions)}catch(je){return ue(je)}const We={};if(Ne){const je=A(ve);je&&(We.resourceTiming={},We.resourceTiming[le.source]=JSON.parse(JSON.stringify(je)))}ue(null,We)}})}reloadTile(le,ue){const ve=this.loaded;return ve&&ve[le.uid]?le.partial?ue(null,void 0):super.reloadTile(le,ue):this.loadTile(le,ue)}loadGeoJSON(le,ue){if(le.request)i.n(le.request,ue);else{if(typeof le.data!="string")return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(le.data))}catch{return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(ve){ue(ve)}}getClusterChildren(le,ue){try{ue(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(ve){ue(ve)}}getClusterLeaves(le,ue){try{ue(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(ve){ue(ve)}}}class gh{constructor(le,ue,ve){this.tileID=new i.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=ue,this.worldview=ve}parse(le,ue,ve,Ne){this.status="parsing";const Ee=new i.aM(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),ze=[],We=ue.familiesBySource[ve.source],je=new i.f0(Ee,ve.promoteId);je.bucketLayerIDs=[],je.is3DTile=!0,i.fi(le).then(Xe=>{if(!Xe)return Ne(new Error("Could not parse tile"));const dt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,Ze=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),Nt=new i.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qt in We)for(const Me of We[Qt]){const Wt=Me[0];je.bucketLayerIDs.push(Me.map(nn=>i.C(nn.id,nn.scope))),Wt.recalculate(Nt,[]);const mr=i.fj(Xe,1/i.cU(ve.tileID.canonical)),Ur=new i.fk(Me,mr,Ee,dt,Ze,this.brightness,je,this.worldview);dt||(Ur.needsUpload=!0),ze.push(Ur),Ur.evaluate(Wt)}this.status="done",Ne(null,{buckets:ze,featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Ne(new Error(Xe.message)))}}class Ql{constructor(le,ue,ve,Ne,Ee,ze,We,je){this.actor=le,this.layerIndex=ue,this.availableImages=ve,this.availableModels=Ne,this.brightness=We,this.loading={},this.loaded={},this.worldview=je}loadTile(le,ue){const ve=le.uid,Ne=this.loading[ve]=new gh(le,this.brightness,this.worldview);i.br(le.request,(Ee,ze)=>{const We=!this.loading[ve];return delete this.loading[ve],We||Ee?(Ne.status="done",We||(this.loaded[ve]=Ne),ue(Ee)):ze&&ze.byteLength!==0?void Ne.parse(ze,this.layerIndex,le,(je,Xe)=>{Ne.status="done",this.loaded=this.loaded||{},this.loaded[ve]=Ne,je||!Xe?ue(je):ue(null,Xe)}):(Ne.status="done",this.loaded[ve]=Ne,ue())})}reloadTile(le,ue){const ve=this.loaded,Ne=le.uid;if(ve&&ve[Ne]){const Ee=ve[Ne];Ee.projection=le.projection,Ee.brightness=le.brightness;const ze=(We,je)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(le,ue)),ue(We,je)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&this.loadTile(le,ue)}}abortTile(le,ue){const ve=le.uid;this.loading[ve]&&delete this.loading[ve],ue()}removeTile(le,ue){const ve=this.loaded,Ne=le.uid;ve&&ve[Ne]&&delete ve[Ne],ue()}}class Sn{constructor(le){this.self=le,this.actor=new i.fm(le,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.ce({name:"mercator"}),this.workerSourceTypes={vector:ie,geojson:qa,"raster-dem":fe,"raster-array":Fe,"batched-model":Ql},this.workerSources={},this.self.registerWorkerSource=(ue,ve)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=ve},this.self.registerRTLTextPlugin=ue=>{if(i.fn.isParsed())throw new Error("RTL text plugin already registered.");i.fn.setState({pluginStatus:i.fo.parsed,pluginURL:i.fn.getPluginURL()}),i.fn.applyArabicShaping=ue.applyArabicShaping,i.fn.processBidirectionalText=ue.processBidirectionalText,i.fn.processStyledBidirectionalText=ue.processStyledBidirectionalText;for(const ve of this.rtlPluginParsingListeners)ve(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(le,ue,ve){delete this.layerIndexes[le],delete this.availableImages[le],delete this.availableModels[le],delete this.workerSources[le],ve()}checkIfReady(le,ue,ve){ve()}setReferrer(le,ue){this.referrer=ue}spriteLoaded(le,ue){this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={});const{scope:ve,isLoaded:Ne}=ue;if(this.isSpriteLoaded[le][ve]=Ne,this.workerSources[le]&&this.workerSources[le][ve])for(const Ee in this.workerSources[le][ve]){const ze=this.workerSources[le][ve][Ee];for(const We in ze){const je=ze[We];je instanceof ie&&(je.isSpriteLoaded=Ne,je.fire(new i.A("isSpriteLoaded")))}}}setImages(le,ue,ve){this.availableImages[le]||(this.availableImages[le]={});const{scope:Ne,images:Ee}=ue;if(this.availableImages[le][Ne]=Ee,this.workerSources[le]&&this.workerSources[le][Ne]){for(const ze in this.workerSources[le][Ne]){const We=this.workerSources[le][Ne][ze];for(const je in We)We[je].availableImages=Ee}ve()}else ve()}setModels(le,{scope:ue,models:ve},Ne){if(this.availableModels[le]||(this.availableModels[le]={}),this.availableModels[le][ue]=ve,this.workerSources[le]&&this.workerSources[le][ue]){for(const Ee in this.workerSources[le][ue]){const ze=this.workerSources[le][ue][Ee];for(const We in ze)ze[We].availableModels=ve}Ne()}else Ne()}setProjection(le,ue){this.projections[le]=i.ce(ue)}setBrightness(le,ue,ve){this.brightness=ue,ve()}setWorldview(le,ue,ve){this.worldview=ue,ve()}setLayers(le,ue,ve){this.getLayerIndex(le,ue.scope).replace(ue.layers,ue.options),ve()}updateLayers(le,ue,ve){this.getLayerIndex(le,ue.scope).update(ue.layers,ue.removedIds,ue.options),ve()}loadTile(le,ue,ve){ue.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,ue.type,ue.source,ue.scope).loadTile(ue,ve)}decodeRasterArray(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).decodeRasterArray(ue,ve)}reloadTile(le,ue,ve){ue.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,ue.type,ue.source,ue.scope).reloadTile(ue,ve)}abortTile(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).abortTile(ue,ve)}removeTile(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).removeTile(ue,ve)}removeSource(le,ue,ve){if(!(this.workerSources[le]&&this.workerSources[le][ue.scope]&&this.workerSources[le][ue.scope][ue.type]&&this.workerSources[le][ue.scope][ue.type][ue.source]))return;const Ne=this.workerSources[le][ue.scope][ue.type][ue.source];delete this.workerSources[le][ue.scope][ue.type][ue.source],Ne.removeSource!==void 0?Ne.removeSource(ue,ve):ve()}loadWorkerSource(le,ue,ve){try{this.self.importScripts(ue.url),ve()}catch(Ne){ve(Ne.toString())}}syncRTLPluginState(le,ue,ve){if(i.fn.isParsed())ve(null,!0);else if(i.fn.isParsing())this.rtlPluginParsingListeners.push(ve);else try{i.fn.setState(ue);const Ne=i.fn.getPluginURL();!i.fn.isLoaded()||i.fn.isParsed()||i.fn.isParsing()||Ne==null||(i.fn.setState({pluginStatus:i.fo.parsing,pluginURL:i.fn.getPluginURL()}),this.self.importScripts(Ne),i.fn.isParsed()?ve(null,!0):this.rtlPluginParsingListeners.push(ve))}catch(Ne){ve(Ne.toString())}}setDracoUrl(le,ue){this.dracoUrl=ue}getAvailableImages(le,ue){this.availableImages[le]||(this.availableImages[le]={});let ve=this.availableImages[le][ue];return ve||(ve=[]),ve}getAvailableModels(le,ue){this.availableModels[le]||(this.availableModels[le]={});let ve=this.availableModels[le][ue];return ve||(ve={}),ve}getLayerIndex(le,ue){this.layerIndexes[le]||(this.layerIndexes[le]={});let ve=this.layerIndexes[le][ue];return ve||(ve=this.layerIndexes[le][ue]=new F,ve.scope=ue),ve}getWorkerSource(le,ue,ve,Ne){const Ee=this.workerSources;return Ee[le]||(Ee[le]={}),Ee[le][Ne]||(Ee[le][Ne]={}),Ee[le][Ne][ue]||(Ee[le][Ne][ue]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),Ee[le][Ne][ue][ve]||(Ee[le][Ne][ue][ve]=new this.workerSourceTypes[ue]({send:(ze,We,je,Xe,dt,Ze)=>this.actor.send(ze,We,je,le,dt,Ze),scheduler:this.actor.scheduler},this.getLayerIndex(le,Ne),this.getAvailableImages(le,Ne),this.getAvailableModels(le,Ne),this.isSpriteLoaded[le][Ne],void 0,this.brightness,this.worldview)),Ee[le][Ne][ue][ve]}rasterizeImagesWorker(le,ue,ve){const Ne=new Map;for(const[Ee,{image:ze,imageVariant:We}]of ue.tasks.entries()){const je=this.imageRasterizer.rasterize(We,ze,ue.scope,le);Ne.set(Ee,je)}ve(void 0,Ne)}removeRasterizedImages(le,ue,ve){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,le),ve()}enforceCacheSizeLimit(le,ue){i.fp(ue)}getWorkerPerformanceMetrics(le,ue,ve){ve(void 0,void 0)}}return i.fl(self)&&(self.worker=new Sn(self)),Sn}),m(["./shared"],function(i){var A="3.13.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},D={mark(f){performance.mark(f)},measure(f,n,c){performance.measure(f,n,c)}};function F(f){const n=f.name.split("?")[0];return i.a(n)&&n.includes("mapbox-gl.js")?"javascript":i.a(n)&&n.includes("mapbox-gl.css")?"css":i.b(n)?"fontRange":i.c(n)?"sprite":i.i(n)?"style":i.d(n)?"tilejson":"other"}var $,K={},J=function(){if($)return K;function f(p){return!n(p)}function n(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,E,M=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(M);try{E=new Worker(R),S=!0}catch{S=!1}return E&&E.terminate(),URL.revokeObjectURL(R),S}()?function(){var S=document.createElement("canvas");S.width=S.height=1;var E=S.getContext("2d");if(!E)return!1;var M=E.getImageData(0,0,1,1);return M&&M.width===S.width}()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=function(S){var E,M=function(R){var z=document.createElement("canvas"),j=Object.create(f.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=R,z.getContext("webgl2",j)}(S);if(!M)return!1;try{E=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!E||M.isContextLost())&&(M.shaderSource(E,"void main() {}"),M.compileShader(E),M.getShaderParameter(E,M.COMPILE_STATUS)===!0)}(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}$=1,K.supported=f,K.notSupportedReason=n;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},K}();function W(f,n,c){const p=document.createElement(f);return n!=null&&(p.className=n),c&&c.appendChild(p),p}function ie(f,n,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(n))p.setAttributeNS(null,x,String(n[x]));return c&&c.appendChild(p),p}const fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Pe=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Fe;function ht(){fe&&Pe&&(Fe=fe[Pe],fe[Pe]="none")}function at(){fe&&Pe&&(fe[Pe]=Fe)}function Dt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Dt,!0)}function kt(){window.addEventListener("click",Dt,!0),window.setTimeout(()=>{window.removeEventListener("click",Dt,!0)},0)}function Rt(f,n){const c=f.getBoundingClientRect();return _r(f,c,n)}function hr(f,n){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<n.length;x++)p.push(_r(f,c,n[x]));return p}function Tr(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function _r(f,n,c){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new i.P((c.clientX-n.left)*p,(c.clientY-n.top)*p)}const Sr="01",Br="NO_ACCESS_TOKEN";class Ft{constructor(n,c,p){this._transformRequestFn=n,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const n=function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Sr,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,c){return this._transformRequestFn&&this._transformRequestFn(n,c)||{url:n}}normalizeStyleURL(n,c){if(!i.j(n))return n;const p=Yt(n);return p.params.push(`sdk=js-${A}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(n,c){if(!i.j(n))return n;const p=Yt(n);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(n,c){if(!i.j(n))return n;const p=Yt(n);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(n,c,p,x){if(!i.j(n))return n;const S=Yt(n);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),p&&S.params.push(`language=${p}`),x&&S.params.push(`worldview=${x}`),this._makeAPIURL(S,this._customAccessToken||c)}normalizeIconsetURL(n,c){const p=Yt(n);return i.j(n)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Er(p)}normalizeSpriteURL(n,c,p,x){const S=Yt(n);return i.j(n)?(S.path=`/styles/v1${S.path}/sprite${c}${p}`,this._makeAPIURL(S,this._customAccessToken||x)):(S.path+=`${c}${p}`,Er(S))}normalizeTileURL(n,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!i.j(n))return n;const x=Yt(n);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${i.l.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${i.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${i.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${i.e.TILE_URL_VERSION}${x.path}`);const S=this._customAccessToken||function(E){for(const M of E){const R=M.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(x.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,S)}canonicalizeTileURL(n,c){const p=Yt(n);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return n;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let S=p.params;return c&&(S=S.filter(E=>!E.match(/^access_token=/))),S.length&&(x+=`?${S.join("&")}`),x}canonicalizeTileset(n,c){const p=!!c&&i.j(c),x=[];for(const S of n.tiles||[])i.k(S)?x.push(this.canonicalizeTileURL(S,p)):x.push(S);return x}_makeAPIURL(n,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Yt(i.e.API_URL);if(n.protocol=x.protocol,n.authority=x.authority,n.protocol==="http"){const S=n.params.indexOf("secure");S>=0&&n.params.splice(S,1)}if(x.path!=="/"&&(n.path=`${x.path}${n.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Er(n);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return n.params=n.params.filter(S=>S.indexOf("access_token")===-1),n.params.push(`access_token=${c||""}`),Er(n)}}const br=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Yt(f){const n=f.match(br);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Er(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const gt="mapbox.eventData";function Jt(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(i.m(n[1]))}catch{return null}}class Ht{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const c=Jt(i.e.ACCESS_TOKEN);let p="";return p=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",n?`${gt}.${n}:${p}`:`${gt}:${p}`}fetchEventData(){const n=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid");if(n)try{const x=localStorage.getItem(c);x&&(this.eventData=JSON.parse(x));const S=localStorage.getItem(p);S&&(this.anonId=S)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const n=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.anonId;if(n&&x)try{localStorage.setItem(p,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,c,p,x){if(!i.e.EVENTS_URL)return;const S=Yt(i.e.EVENTS_URL);S.params.push(`access_token=${x||i.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(n).toISOString()},M=c?i.h(E,c):E,R={url:Er(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=i.p(R,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)})}queueRequest(n,c){this.queue.push(n),this.processRequests(c)}}const qe=new class extends Ht{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>i.j(c)||i.k(c))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Jt(i.e.ACCESS_TOKEN),c=n?n.u:i.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),E=new Date(x),M=(x-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||S.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Sr,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},f):this.processRequests()}},Ct=qe.postTurnstileEvent.bind(qe),kr=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,c,p){this.skuToken=n,this.errorCb=p,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Br)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Sr,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f))}remove(){this.errorCb=null}},Zr=kr.postMapLoadEvent.bind(kr),Rr=new class extends Ht{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=i.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:c,style:p,importedStyles:x}=n;if(!i.e.EVENTS_URL||!f&&!i.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(c),E={mapInstanceId:S,eventId:this.getEventId(S),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},f)}},ar=Rr.postStyleLoadEvent.bind(Rr),lr=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:c}=this.queue.shift(),p=function(x){const S=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),M=function(q){const re={};if(q){for(const Y in q)if(Y!=="other")for(const ne of q[Y]){const oe=`${Y}ResolveRangeMin`,ce=`${Y}ResolveRangeMax`,ge=`${Y}RequestCount`,xe=`${Y}RequestCachedCount`;re[oe]=Math.min(re[oe]||1/0,ne.startTime),re[ce]=Math.max(re[ce]||-1/0,ne.responseEnd);const Ce=Ae=>{re[Ae]===void 0&&(re[Ae]=0),++re[Ae]};ne.transferSize!==void 0&&ne.transferSize===0&&Ce(xe),Ce(ge)}}return re}(function(q,re){const Y={};if(q)for(const ne of q){const oe=re(ne);Y[oe]===void 0&&(Y[oe]=[]),Y[oe].push(ne)}return Y}(S,F)),R=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=z?z.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},U=(q,re,Y)=>{Y!=null&&q.push({name:re,value:Y.toString()})};for(const q in M)U(G.counters,q,M[q]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(U(G.counters,"interactionRangeMin",x.interactionRange[0]),U(G.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const q of Object.keys(P)){const re=P[q],Y=E.find(ne=>ne.name===re);Y&&U(G.counters,re,Y.startTime)}return U(G.counters,"visibilityHidden",x.visibilityHidden),U(G.attributes,"style",function(q){if(q)for(const re of q){const Y=re.name.split("?")[0];if(i.i(Y)){const ne=Y.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(S)),U(G.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),U(G.attributes,"fogEnabled",x.fogEnabled?"true":"false"),U(G.attributes,"projection",x.projection),U(G.attributes,"zoom",x.zoom),U(G.metadata,"devicePixelRatio",R),U(G.metadata,"connectionEffectiveType",j),U(G.metadata,"navigatorUserAgent",navigator.userAgent),U(G.metadata,"screenWidth",window.screen.width),U(G.metadata,"screenHeight",window.screen.height),U(G.metadata,"windowWidth",window.innerWidth),U(G.metadata,"windowHeight",window.innerHeight),U(G.metadata,"mapWidth",x.width/R),U(G.metadata,"mapHeight",x.height/R),U(G.metadata,"webglRenderer",x.renderer),U(G.metadata,"webglVendor",x.vendor),U(G.metadata,"sdkVersion",A),U(G.metadata,"sdkIdentifier","mapbox-gl-js"),G}(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(n,p,()=>{},f)}},$r=lr.postPerformanceEvent.bind(lr),Cr=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,c,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const x=Yt(i.e.API_URL+i.e.SESSION_PATH);x.params.push(`sku=${n||""}`),x.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const S={url:Er(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(S,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,n,c,p){this.skuToken=n,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Br)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:c}=this.queue.shift();n&&this.success[n]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):n&&(this.success[n]=!0)},f)}remove(){this.errorCb=null}},Fr=Cr.getSessionAPI.bind(Cr),Zn=new Set;function ri(f,n){n?Zn.add(f):Zn.delete(f)}class On{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,c){this._updatedSourceCaches[n]=c,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const c=n.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(n.id),this.setDirty()}removeLayer(n){const c=n.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][n.id]=n,this._updatedLayers[c].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const c in this._updatedLayers)n[c]=n[c]||{},n[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)n[c]=n[c]||{},n[c].removedIds=Object.keys(this._removedLayers[c]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function vs(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class $s extends i.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new i.r({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const c=this.atlasTexture.get(n);c&&(c.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(n.id,n)}removeImageProvider(n,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(n)}getPendingImageProviders(){const n=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&n.push(p);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,c){if(this.loaded.get(c)!==n&&(this.loaded.set(c,n),n)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(n,c){return!!this.getImage(n,c)}getImage(n,c){return this.images.get(c).get(n.toString())}addImage(n,c,p){this._validate(n,p)&&this.images.get(c).set(n.toString(),p)}_validate(n,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.z(new Error(`Image "${n.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.z(new Error(`Image "${n.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new i.z(new Error(`Image "${n.name}" has invalid "content" value`))),p=!1),p}_validateStretch(n,c){if(!n)return!0;let p=0;for(const x of n){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(n,c){return n?n.length!==4||!c.usvg&&(n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,c,p){const x=this.images.get(c).get(n.toString());p.version=x.version+1,this.images.get(c).set(n.toString(),p),this.updatedImages.get(c).add(n),this.removeFromImageRasterizerCache(n,c)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,c){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([n],c))}removeImage(n,c){const p=this.images.get(c),x=p.get(n.toString());p.delete(n.toString()),this.patterns.get(c).delete(n.toString()),this.removeFromImageRasterizerCache(n,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map(c=>i.I.from(c))}getImages(n,c,p){const x=[],S=[],E=this.imageProviders.get(c);for(const j of n){if(!j.iconsetId){x.push(j);continue}const G=E.get(j.iconsetId);G&&(this.getImage(j,c)?S.push(j):G.addPendingRequest(j))}if(x.length===0)return void this._notify(S,c,p);let M=!0;const R=!!this.loaded.get(c),z=this.images.get(c);if(!R)for(const j of x)z.has(j.toString())||(M=!1);R||M?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(n,c){const p=new Map,{tasks:x,scope:S}=n;for(const[E,M]of x.entries()){const R=this.getImage(M.id,S);R&&p.set(E,{image:R,imageVariant:M})}this._rasterizeImages(S,p,c)}_rasterizeImages(n,c,p){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:n},p);else{const x=new Map;for(const[S,{image:E,imageVariant:M}]of c.entries())x.set(S,this.imageRasterizer.rasterize(M,E,n,0));p(void 0,x)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,c,p){const x=this.images.get(c),S=new Map;for(const E of n){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new i.A("styleimagemissing",{id:E.name}))}const M=x.get(E.toString());if(!M){i.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:M.usvg?null:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,usvg:M.usvg,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)};M.usvg&&Object.assign(R,{width:M.icon.usvg_tree.width,height:M.icon.usvg_tree.height}),S.set(i.I.toString(E),R)}p(null,S)}getPixelSize(n){const{width:c,height:p}=this.atlasImage.get(n);return{width:c,height:p}}getPattern(n,c,p){const x=n.toString(),S=this.patterns.get(c),E=S.get(x),M=this.getImage(n,c);if(!M)return null;if(E){if(E.position.version===M.version)return E.position;E.position.version=M.version}else{if(M.usvg&&!M.data){const R=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const z=new i.B(n).scaleSelf(i.q.devicePixelRatio),j=new Map([[z.toString(),{image:M,imageVariant:z}]]);return this._rasterizeImages(c,j,(G,U)=>this.storePatternImage(z,c,M,p,U)),null}this.storePattern(n,c,M)}return this._updatePatternAtlas(c,p),S.get(x).position}getPatternInFlightId(n,c){return i.C(n,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,c,p,x,S){const E=n.toString(),M=S?S.get(E):void 0;M&&(p.data=M,this.storePattern(n.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),c)))}storePattern(n,c,p){const x={w:p.data.width+2*i.F,h:p.data.height+2*i.F,x:0,y:0},S=new i.G(x,p,i.F);this.patterns.get(c).set(n.toString(),{bin:x,position:S})}bind(n,c){const p=n.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new i.T(n,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(n,c){const p=this.patterns.get(n),x=Array.from(p.values()).map(({bin:z})=>z),{w:S,h:E}=i.H(x),M=this.atlasImage.get(n);M.resize({width:S||1,height:E||1});const R=this.images.get(n);for(const[z,{bin:j,position:G}]of p.entries()){let U=G.padding;const q=j.x+U,re=j.y+U,Y=R.get(z).data,ne=Y.width,oe=Y.height;U=U>1?U-1:U,i.r.copy(Y,M,{x:0,y:0},{x:q,y:re},{width:ne,height:oe},c),i.r.copy(Y,M,{x:0,y:oe-U},{x:q,y:re-U},{width:ne,height:U},c),i.r.copy(Y,M,{x:0,y:0},{x:q,y:re+oe},{width:ne,height:U},c),i.r.copy(Y,M,{x:ne-U,y:0},{x:q-U,y:re},{width:U,height:oe},c),i.r.copy(Y,M,{x:0,y:0},{x:q+ne,y:re},{width:U,height:oe},c),i.r.copy(Y,M,{x:ne-U,y:oe-U},{x:q-U,y:re-U},{width:U,height:U},c),i.r.copy(Y,M,{x:0,y:oe-U},{x:q+ne,y:re-U},{width:U,height:U},c),i.r.copy(Y,M,{x:0,y:0},{x:q+ne,y:re+oe},{width:U,height:U},c),i.r.copy(Y,M,{x:ne-U,y:0},{x:q-U,y:re+oe},{width:U,height:U},c)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,c){const p=this.images.get(c);for(const x of n){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const S=p.get(x.toString());vs(S)&&this.updateImage(x,c,S)}}}function Hi(f){const n=f.key,c=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},S=f.style,E=f.styleSpec;let M=[];const R=i.J(c);if(R!=="object")return[new i.V(n,c,`object expected, ${R} found`)];for(const z in c){const j=z.split(".")[0];let G;x[j]?G=x[j]:p[j]?G=Dr:x["*"]?G=x["*"]:p["*"]&&(G=Dr),G?M=M.concat(G({key:(n&&`${n}.`)+z,value:c[z],valueSpec:p[j]||p["*"],style:S,styleSpec:E,object:c,objectKey:z},c)):M.push(new i.K(n,c[z],`unknown property "${z}"`))}for(const z in p)x[z]||p[z].required&&p[z].default===void 0&&c[z]===void 0&&M.push(new i.V(n,c,`missing required property "${z}"`));return M}function mo(f){const n=f.value,c=f.valueSpec,p=f.style,x=f.styleSpec,S=f.key,E=f.arrayElementValidator||Dr;if(i.J(n)!=="array")return[new i.V(S,n,`array expected, ${i.J(n)} found`)];if(c.length&&n.length!==c.length)return[new i.V(S,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new i.V(S,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let M={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(M.function=c.function),i.J(c.value)==="object"&&(M=c.value);let R=[];for(let z=0;z<n.length;z++)R=R.concat(E({array:n,arrayIndex:z,value:n[z],valueSpec:M,style:p,styleSpec:x,key:`${S}[${z}]`},!0));return R}function El(f){const n=f.key,c=f.value,p=f.valueSpec;let x=i.J(c);if(x==="number"&&c!=c&&(x="NaN"),x!=="number")return[new i.V(n,c,`number expected, ${x} found`)];if("minimum"in p){let S=p.minimum;if(i.J(p.minimum)==="array"&&(S=p.minimum[f.arrayIndex]),c<S)return[new i.V(n,c,`${c} is less than the minimum value ${S}`)]}if("maximum"in p){let S=p.maximum;if(i.J(p.maximum)==="array"&&(S=p.maximum[f.arrayIndex]),c>S)return[new i.V(n,c,`${c} is greater than the maximum value ${S}`)]}return[]}function zi(f){const n=f.valueSpec,c=i.M(f.value.type);let p,x,S,E={};const M=c!=="categorical"&&f.value.property===void 0,R=!M,z=i.J(f.value.stops)==="array"&&i.J(f.value.stops[0])==="array"&&i.J(f.value.stops[0][0])==="object",j=Hi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(c==="identity")return[new i.V(q.key,q.value,'identity function may not have a "stops" property')];let re=[];const Y=q.value;return re=re.concat(mo({key:q.key,value:Y,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:G})),i.J(Y)==="array"&&Y.length===0&&re.push(new i.V(q.key,Y,"array must have at least one stop")),re},default:function(q){return Dr({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return c==="identity"&&M&&j.push(new i.V(f.key,f.value,'missing required property "property"')),c==="identity"||f.value.stops||j.push(new i.V(f.key,f.value,'missing required property "stops"')),c==="exponential"&&f.valueSpec.expression&&!i.N(f.valueSpec)&&j.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(R&&!i.O(f.valueSpec)?j.push(new i.V(f.key,f.value,"property functions not supported")):M&&!i.Q(f.valueSpec)&&j.push(new i.V(f.key,f.value,"zoom functions not supported"))),c!=="categorical"&&!z||f.value.property!==void 0||j.push(new i.V(f.key,f.value,'"property" property is required')),j;function G(q){let re=[];const Y=q.value,ne=q.key;if(i.J(Y)!=="array")return[new i.V(ne,Y,`array expected, ${i.J(Y)} found`)];if(Y.length!==2)return[new i.V(ne,Y,`array length 2 expected, length ${Y.length} found`)];if(z){if(i.J(Y[0])!=="object")return[new i.V(ne,Y,`object expected, ${i.J(Y[0])} found`)];if(Y[0].zoom===void 0)return[new i.V(ne,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new i.V(ne,Y,"object stop key must have value")];const oe=i.M(Y[0].zoom);if(typeof oe!="number")return[new i.V(ne,Y[0].zoom,"stop zoom values must be numbers")];if(S&&S>oe)return[new i.V(ne,Y[0].zoom,"stop zoom values must appear in ascending order")];oe!==S&&(S=oe,x=void 0,E={}),re=re.concat(Hi({key:`${ne}[0]`,value:Y[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:El,value:U}}))}else re=re.concat(U({key:`${ne}[0]`,value:Y[0],style:q.style,styleSpec:q.styleSpec},Y));return i.S(i.U(Y[1]))?re.concat([new i.V(`${ne}[1]`,Y[1],"expressions are not allowed in function stops.")]):re.concat(Dr({key:`${ne}[1]`,value:Y[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function U(q,re){const Y=i.J(q.value),ne=i.M(q.value),oe=q.value!==null?q.value:re;if(p){if(Y!==p)return[new i.V(q.key,oe,`${Y} stop domain type must match previous stop domain type ${p}`)]}else p=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof ne!="number"&&typeof ne!="string"&&typeof ne!="boolean")return[new i.V(q.key,oe,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&c!=="categorical"){let ce=`number expected, ${Y} found`;return i.O(n)&&c===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(q.key,oe,ce)]}return c!=="categorical"||Y!=="number"||typeof ne=="number"&&isFinite(ne)&&Math.floor(ne)===ne?c!=="categorical"&&Y==="number"&&typeof ne=="number"&&typeof x=="number"&&x!==void 0&&ne<x?[new i.V(q.key,oe,"stop domain values must appear in ascending order")]:(x=ne,c==="categorical"&&ne in E?[new i.V(q.key,oe,"stop domain values must be unique")]:(E[ne]=!0,[])):[new i.V(q.key,oe,`integer expected, found ${String(ne)}`)]}}function Ki(f){const n=(f.expressionContext==="property"?i.W:i.X)(i.U(f.value),f.valueSpec);if(n.result==="error")return n.value.map(p=>new i.V(`${f.key}${p.key}`,f.value,p.message));const c=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.Y(c))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return to(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.Z(c,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i._(c))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function to(f,n){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const x of n.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return f instanceof i.$&&c.has(f.name)?[new i.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild(x=>{p.push(...to(x,n))}),p)}function Qo(f){const n=f.key,c=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(i.M(c))===-1&&x.push(new i.V(n,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(i.M(c))===-1&&x.push(new i.V(n,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function To(f){return i.a1(i.U(f.value))?Ki(i.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Cs(f)}function Cs(f){const n=f.value,c=f.key;if(i.J(n)!=="array")return[new i.V(c,n,`array expected, ${i.J(n)} found`)];const p=f.styleSpec;let x,S=[];if(n.length<1)return[new i.V(c,n,"filter array must have at least 1 element")];switch(S=S.concat(Qo({key:`${c}[0]`,value:n[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),i.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&i.M(n[1])==="$type"&&S.push(new i.V(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&S.push(new i.V(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(x=i.J(n[1]),x!=="string"&&S.push(new i.V(`${c}[1]`,n[1],`string expected, ${x} found`)));for(let E=2;E<n.length;E++)x=i.J(n[E]),i.M(n[1])==="$type"?S=S.concat(Qo({key:`${c}[${E}]`,value:n[E],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&S.push(new i.V(`${c}[${E}]`,n[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<n.length;E++)S=S.concat(Cs({key:`${c}[${E}]`,value:n[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=i.J(n[1]),n.length!==2?S.push(new i.V(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):x!=="string"&&S.push(new i.V(`${c}[1]`,n[1],`string expected, ${x} found`))}return S}function Ua(f,n){const c=f.key,p=f.style,x=f.layer,S=f.styleSpec,E=f.value,M=f.objectKey,R=S[`${n}_${f.layerType}`];if(!R)return[];const z=M.match(/^(.*)-use-theme$/);if(n==="paint"&&z&&R[z[1]])return i.S(E)?[].concat(Dr({key:f.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:S,expressionContext:"property",propertyType:n,propertyKey:M})):Dr({key:c,value:E,valueSpec:{type:"string"},style:p,styleSpec:S});const j=M.match(/^(.*)-transition$/);if(n==="paint"&&j&&R[j[1]]&&R[j[1]].transition)return Dr({key:c,value:E,valueSpec:S.transition,style:p,styleSpec:S});const G=f.valueSpec||R[M];if(!G)return[new i.K(c,E,`unknown property "${M}"`)];let U;if(i.J(E)==="string"&&i.O(G)&&!G.tokens&&(U=/^{([^}]+)}$/.exec(E))){const re=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new i.V(c,E,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const q=[];if(f.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||q.push(new i.V(c,E,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&i.a2(i.U(E))&&i.M(E.type)==="identity"&&q.push(new i.V(c,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&i.O(G)&&(i.a3(G)||i.Q(G))){const re=i.W(i.U(E),G),Y=re.value.expression||re.value._styleExpression.expression;Y&&!i.Z(Y,["measure-light"])&&(M==="model-emissive-strength"&&i._(Y)&&i.Y(Y)||q.push(new i.V(c,E,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Dr({key:f.key,value:E,valueSpec:G,style:p,styleSpec:S,expressionContext:"property",propertyType:n,propertyKey:M}))}function wa(f){return Ua(f,"paint")}function is(f){return Ua(f,"layout")}function Sa(f){let n=[];const c=f.value,p=f.key,x=f.style,S=f.styleSpec;c.type||c.ref||n.push(new i.V(p,c,'either "type" or "ref" is required'));let E=i.M(c.type);const M=i.M(c.ref);if(c.id){const R=i.M(c.id);for(let z=0;z<f.arrayIndex;z++){const j=x.layers[z];i.M(j.id)===R&&n.push(new i.V(p,c.id,`duplicate layer id "${c.id}", previously used at line ${j.id.__line__}`))}}if("ref"in c){let R;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&n.push(new i.V(p,c[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{i.M(z.id)===M&&(R=z)}),R?R.ref?n.push(new i.V(p,c.ref,"ref cannot reference another ref layer")):E=i.M(R.type):typeof M=="string"&&n.push(new i.V(p,c.ref,`ref layer "${M}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(c.source){const R=x.sources&&x.sources[c.source],z=R&&i.M(R.type);R?z==="vector"&&E==="raster"?n.push(new i.V(p,c.source,`layer "${c.id}" requires a raster source`)):z==="raster"&&E!=="raster"?n.push(new i.V(p,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&E!=="hillshade"?n.push(new i.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&z==="geojson"&&!R.lineMetrics?n.push(new i.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&z!=="raster-array"&&n.push(new i.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):n.push(new i.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new i.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new i.V(p,c.source,`source "${c.source}" not found`))}else n.push(new i.V(p,c,'missing required property "source"'));return n=n.concat(Hi({key:p,value:c,valueSpec:S.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Dr({key:`${p}.type`,value:c.type,valueSpec:S.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:R=>To(i.L({layerType:E},R)),layout:R=>Hi({layer:c,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>is(i.L({layerType:E},z))}}),paint:R=>Hi({layer:c,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>wa(i.L({layerType:E,layer:c},z))}})}})),n}function Hs(f){const n=f.value,c=f.key,p=i.J(n);return p!=="string"?[new i.V(c,n,`string expected, ${p} found`)]:[]}const Fo={promoteId:function f({key:n,value:c}){if(i.J(c)==="string")return Hs({key:n,value:c});if(Array.isArray(c)){const p=[],x=i.U(c),S=i.X(x);return S.result==="error"&&S.value.forEach(E=>{p.push(new i.V(`${n}${E.key}`,null,`${E.message}`))}),i.Z(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new i.V(`${n}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const x in c)p.push(...f({key:`${n}.${x}`,value:c[x]}));return p}}};function ss(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!n.type)return[new i.V(c,n,'"type" is required')];const S=i.M(n.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&(n.url||n.tiles||E.push(new i.K(c,n,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Hi({key:c,value:n,valueSpec:p[`source_${S.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Fo})),E;case"geojson":if(E=Hi({key:c,value:n,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Fo}),n.cluster)for(const M in n.clusterProperties){const[R,z]=n.clusterProperties[M],j=typeof R=="string"?[R,["accumulated"],["get",M]]:R;E.push(...Ki({key:`${c}.${M}.map`,value:z,expressionContext:"cluster-map"})),E.push(...Ki({key:`${c}.${M}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return E;case"video":return Hi({key:c,value:n,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Hi({key:c,value:n,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qo({key:`${c}.type`,value:n.type,valueSpec:{values:go(p)}})}}function go(f){return f.source.reduce((n,c)=>{const p=f[c];return p.type.type==="enum"&&(n=n.concat(Object.keys(p.type.values))),n},[])}function Ta(f){const n=f.value,c=f.styleSpec,p=c.light,x=f.style;let S=[];const E=i.J(n);if(n===void 0)return S;if(E!=="object")return S=S.concat([new i.V("light",n,`object expected, ${E} found`)]),S;for(const M in n){const R=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);S=S.concat(z&&p[z[1]]?Dr({key:M,value:n[M],valueSpec:{type:"string"},style:x,styleSpec:c}):R&&p[R[1]]&&p[R[1]].transition?Dr({key:M,value:n[M],valueSpec:c.transition,style:x,styleSpec:c}):p[M]?Dr({key:M,value:n[M],valueSpec:p[M],style:x,styleSpec:c}):[new i.V(M,n[M],`unknown property "${M}"`)])}return S}function Ea(f){const n=f.value;let c=[];if(!n)return c;const p=i.J(n);if(p!=="object")return c=c.concat([new i.V("light-3d",n,`object expected, ${p} found`)]),c;const x=f.styleSpec,S=x["light-3d"],E=f.key,M=f.style,R=f.style.lights;for(const G of["type","id"])if(!(G in n))return c=c.concat([new i.V("light-3d",n,`missing property ${G} on light`)]),c;if(n.type&&R)for(let G=0;G<f.arrayIndex;G++){const U=i.M(n.type),q=R[G];i.M(q.type)===U&&c.push(new i.V(E,n.id,`duplicate light type "${n.type}", previously defined at line ${q.id.__line__}`))}const z=`properties_light_${n.type}`;if(!(z in x))return c=c.concat([new i.V("light-3d",n,`Invalid light type ${n.type}`)]),c;const j=x[z];for(const G in n)if(G==="properties"){const U=n[G],q=i.J(U);if(q!=="object")return c=c.concat([new i.V("properties",U,`object expected, ${q} found`)]),c;for(const re in U){const Y=re.match(/^(.*)-transition$/),ne=re.match(/^(.*)-use-theme$/);c=c.concat(ne&&j[ne[1]]?Dr({key:G,value:U[re],valueSpec:{type:"string"},style:M,styleSpec:x}):Y&&j[Y[1]]&&j[Y[1]].transition?Dr({key:G,value:n[G],valueSpec:x.transition,style:M,styleSpec:x}):j[re]?Dr({key:re,value:U[re],valueSpec:j[re],style:M,styleSpec:x}):[new i.K(f.key,U[re],`unknown property "${re}"`)])}}else c=c.concat(S[G]?Dr({key:G,value:n[G],valueSpec:S[G],style:M,styleSpec:x}):[new i.K(G,n[G],`unknown property "${G}"`)]);return c}function Ca(f){const n=f.value,c=f.key,p=f.style,x=f.styleSpec,S=x.terrain;let E=[];const M=i.J(n);if(n===void 0||M==="null")return E;if(M!=="object")return E=E.concat([new i.V("terrain",n,`object expected, ${M} found`)]),E;for(const R in n){const z=R.match(/^(.*)-transition$/),j=R.match(/^(.*)-use-theme$/);E=E.concat(j&&S[j[1]]?Dr({key:R,value:n[R],valueSpec:{type:"string"},style:p,styleSpec:x}):z&&S[z[1]]&&S[z[1]].transition?Dr({key:R,value:n[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?Dr({key:R,value:n[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,n[R],`unknown property "${R}"`)])}if(n.source){const R=p.sources&&p.sources[n.source],z=R&&i.M(R.type);R?z!=="raster-dem"&&E.push(new i.V(c,n.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):E.push(new i.V(c,n.source,`source "${n.source}" not found`))}else E.push(new i.V(c,n,'terrain is missing required property "source"'));return E}function As(f){const n=f.value,c=f.style,p=f.styleSpec,x=p.fog;let S=[];const E=i.J(n);if(n===void 0)return S;if(E!=="object")return S=S.concat([new i.V("fog",n,`object expected, ${E} found`)]),S;for(const M in n){const R=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);S=S.concat(z&&x[z[1]]?Dr({key:M,value:n[M],valueSpec:{type:"string"},style:c,styleSpec:p}):R&&x[R[1]]&&x[R[1]].transition?Dr({key:M,value:n[M],valueSpec:p.transition,style:c,styleSpec:p}):x[M]?Dr({key:M,value:n[M],valueSpec:x[M],style:c,styleSpec:p}):[new i.K(M,n[M],`unknown property "${M}"`)])}return S}const $a={"*":()=>[],array:mo,boolean:function(f){const n=f.value,c=f.key,p=i.J(n);return p!=="boolean"?[new i.V(c,n,`boolean expected, ${p} found`)]:[]},number:El,color:function(f){const n=f.key,c=f.value,p=i.J(c);return p!=="string"?[new i.V(n,c,`color expected, ${p} found`)]:i.a0.parseCSSColor(c)===null?[new i.V(n,c,`color expected, "${c}" found`)]:[]},enum:Qo,filter:To,function:zi,layer:Sa,object:Hi,source:ss,model:i.a4,light:Ta,"light-3d":Ea,terrain:Ca,fog:As,string:Hs,formatted:function(f){return Hs(f).length===0?[]:Ki(f)},resolvedImage:function(f){return Hs(f).length===0?[]:Ki(f)},projection:function(f){const n=f.value,c=f.styleSpec,p=c.projection,x=f.style;let S=[];const E=i.J(n);if(E==="object")for(const M in n)S=S.concat(Dr({key:M,value:n[M],valueSpec:p[M],style:x,styleSpec:c}));else E!=="string"&&(S=S.concat([new i.V("projection",n,`object or string expected, ${E} found`)]));return S},import:function(f){const{value:n,styleSpec:c}=f,{data:p,...x}=n;Object.defineProperty(x,"__line__",{value:n.__line__,enumerable:!1});let S=Hi(i.L({},f,{value:x,valueSpec:c.import}));return i.M(x.id)===""&&S.push(new i.V(`${f.key}.id`,x,"import id can't be an empty string")),p&&(S=S.concat(di(p,c,{key:`${f.key}.data`}))),S},iconset:function(f){const n=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!n.type)return[new i.V(c,n,'"type" is required')];const S=i.M(n.type);let E=[];if(E=E.concat(Hi({key:c,value:n,valueSpec:p[`iconset_${S}`],style:x,styleSpec:p})),S==="source"&&n.source){const M=x.sources&&x.sources[n.source],R=M&&i.M(M.type);M?R!=="raster-array"&&E.push(new i.V(c,n.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):E.push(new i.V(c,n.source,`source "${n.source}" not found`))}return E}};function Dr(f,n=!1){const c=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression&&i.a2(i.M(c)))return zi(f);if(p.expression&&i.S(i.U(c)))return Ki(f);if(p.type&&$a[p.type]){const S=$a[p.type](f);return n===!0&&S.length>0&&i.J(f.value)==="array"?Ki(f):S}return Hi(i.L({},f,{valueSpec:p.type?x[p.type]:p}))}function ci(f){const n=f.value,c=f.key,p=Hs(f);return p.length||(n.indexOf("{fontstack}")===-1&&p.push(new i.V(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&p.push(new i.V(c,n,'"glyphs" url must include a "{range}" token'))),p}function di(f,n=i.a5,c={}){return Dr({key:c.key||"",value:f,valueSpec:n.$root,styleSpec:n,style:f,objectElementValidators:{glyphs:ci,"*":()=>[]}})}function Vi(f,n=i.a5){return Ne(di(f,n))}const Is=f=>Ne(ss(f)),Ha=f=>Ne(Ta(f)),Ga=f=>Ne(Ea(f)),Ot=f=>Ne(Ca(f)),qa=f=>Ne(As(f)),gh=f=>Ne(function(n){const c=n.value,p=n.style,x=n.styleSpec,S=x.snow;let E=[];const M=i.J(c);if(c===void 0)return E;if(M!=="object")return E=E.concat([new i.V("snow",c,`object expected, ${M} found`)]),E;for(const R in c){const z=R.match(/^(.*)-transition$/);E=E.concat(z&&S[z[1]]&&S[z[1]].transition?Dr({key:R,value:c[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?Dr({key:R,value:c[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,c[R],`unknown property "${R}"`)])}return E}(f)),Ql=f=>Ne(function(n){const c=n.value,p=n.style,x=n.styleSpec,S=x.rain;let E=[];const M=i.J(c);if(c===void 0)return E;if(M!=="object")return E=E.concat([new i.V("rain",c,`object expected, ${M} found`)]),E;for(const R in c){const z=R.match(/^(.*)-transition$/);E=E.concat(z&&S[z[1]]&&S[z[1]].transition?Dr({key:R,value:c[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?Dr({key:R,value:c[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,c[R],`unknown property "${R}"`)])}return E}(f)),Sn=f=>Ne(Sa(f)),Ke=f=>Ne(To(f)),le=f=>Ne(wa(f)),ue=f=>Ne(is(f)),ve=f=>Ne(i.a4(f));function Ne(f){return f.slice().sort((n,c)=>n.line&&c.line?n.line-c.line:0)}function Ee(f,n){let c=!1;if(n&&n.length)for(const p of n)p instanceof i.K?i.w(p.message):(f.fire(new i.z(new Error(p.message))),c=!0);return c}let ze;class We extends i.E{constructor(n,c="flat"){super(),this._transitionable=new i.a6(ze||(ze=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(n,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c,p={}){this._validate(Ha,n,p)||(this._transitionable.setTransitionOrValue(n),this.id=c)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Ee(this,n.call(Vi,i.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let je=class extends i.E{constructor(f,n,c,p,x){super(),this.scope=c,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=x}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let c=-1,p=-1,x=1;for(const S of n.zoomStops)x=n.evaluate(new i.aa(S,{worldview:this.worldview})),x>.01?(c=S,p=-1):p=S;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.ab}};const Xe=45,dt=65,Ze=.05;function Nt(f,n,c,p){const x=i.af(Xe,dt,c),[S,E]=Qt(f,p);let M=1-Math.min(1,Math.exp((n-S)/(E-S)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*x*f.alpha}function Qt(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}function Me(f,n,c,p,x){const S=i.ad([],[n,c,p],x.mercatorFogMatrix);return Nt(f,i.ae(S),x.pitch,x._fov)}function Wt(f,n,c,p,x,S,E){const M=[[c,p,0],[x,p,0],[x,S,0],[c,S,0]];let R=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const j of M){const G=i.ad([],j,n),U=i.ae(G);R=Math.min(R,U),z=Math.max(z,U)}return[Nt(f,R,E.pitch,E._fov),Nt(f,z,E.pitch,E._fov)]}class mr extends i.E{constructor(n,c,p,x){super();const S=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(S,p,new Map(x)),this.set(n,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ag(S),this.scope=p}get state(){const n=this._transform,c=n.projection.name==="globe",p=i.ah(n.zoom),x=this.properties.get("range"),S=[.5,3];return{range:c?[i.ai(S[0],x[0],p),i.ai(S[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c,p={}){if(this._validate(qa,n,p))return;const x=i.h({},n);for(const S of Object.keys(i.a5.fog))x[S]===void 0&&(x[S]=i.a5.fog[S].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.af(Xe,dt,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(p,x,S){const E=i.ac.fromLngLat(x),M=S.elevation?S.elevation.getAtPointOrZero(E):0;return Me(p,E.x,E.y,M,S)}(this.state,n,c):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(n.toUnwrapped());return Wt(this.state,c,0,0,i.aj,i.aj,this._transform)}getOpacityForBounds(n,c,p,x,S){return this._transform.projection.supportsFog?Wt(this.state,n,c,p,x,S,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Qt(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=n.points[p];let S;if(x[2]>=0)S=x;else{const E=n.points[p-4];S=i.ak(E,x,E[2]/(E[2]-x[2]))}if(Me(this.state,S[0],S[1],0,this._transform)>=Ze)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,p){return(!p||p.validate!==!1)&&Ee(this,n.call(Vi,i.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ur,nn,Hr,ni,gn=class extends i.E{constructor(f,n,c,p){super();const x=Ur||(Ur=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=i.al(c[0]),x=-Math.max(i.al(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(n.r,n.g,n.b,n.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(gh,f,c))return;const p=i.h({},f);for(const x of Object.keys(i.a5.snow))p[x]===void 0&&(p[x]=i.a5.snow[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Ee(this,f.call(Vi,i.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},bi=class extends i.E{constructor(f,n,c,p){super();const x=nn||(nn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(x),this.scope=c}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),c=this.properties.get("direction"),p=i.al(c[0]),x=-Math.max(i.al(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(n.r,n.g,n.b,n.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,n,c={}){if(this._validate(Ql,f,c))return;const p=i.h({},f);for(const x of Object.keys(i.a5.rain))p[x]===void 0&&(p[x]=i.a5.rain[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,c){return(!c||c.validate!==!1)&&Ee(this,f.call(Vi,i.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Fn extends i.E{constructor(n,c,p,x){super(),this.scope=p,this._options=n,this.properties=new i.ag(c),this._transitionable=new i.a6(c,p,new Map(x)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,c){this._options=n,this._transitionable.setTransitionOrValue(n.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Nn{constructor(n,c,p,x){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(n,c){let p,x;if(n instanceof i.P||typeof n[0]=="number"){const S=i.P.convert(n);p=[S],x=c.isPointAboveHorizon(S)}else{const S=i.P.convert(n[0]),E=i.P.convert(n[1]),M=S.add(E)._div(2);p=[S,E],x=i.ao(S,E).every(R=>c.isPointAboveHorizon(R))&&c.isPointAboveHorizon(M)}return new Nn(p,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return i.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.ao(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),i.ap(x,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.ao(c,p,n),S=this.cameraPoint.clone();switch(3*((S.y>c.y)+(S.y>p.y))+((S.x>c.x)+(S.x>p.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(n,c,p,x=0){const S=n.queryPadding/c._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(S,c):this._bufferedScreenMercator(S,c);let M=n.tileID.wrap+(E.unwrapped?x:0);const R=E.polygon.map(ne=>i.aq(n.tileTransform,ne,M));if(!i.ar(R,0,0,i.aj,i.aj))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(ne=>i.as(n.tileTransform,ne,M)),j=z.map(ne=>new i.P(ne[0],ne[1])),G=c.getFreeCameraOptions().position||new i.ac(0,0,0),U=i.as(n.tileTransform,G,M),q=z.map(ne=>{const oe=i.at(ne,ne,U);return i.au(oe,oe),new i.av(U,oe)}),re=i.aw(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:q,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(Y=i.ax(R),Y.min.x=i.ay(Y.min.x,0,i.aj),Y.min.y=i.ay(Y.min.y,0,i.aj),Y.max.x=i.ay(Y.max.x,0,i.aj),Y.max.y=i.ay(Y.max.y,0,i.aj),Y),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:re};var Y}_bufferedScreenMercator(n,c){const p=Ri(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(n,c){const p=Ri(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(n,c){const p=function(S,E){const M=i.az([],E.pixelMatrix,E.globeMatrix),R=[0,-i.aB,0,1],z=[0,i.aB,0,1],j=[0,0,0,1];i.aA(R,R,M),i.aA(z,z,M),i.aA(j,j,M);const G=new i.P(R[0]/R[3],R[1]/R[3]),U=new i.P(z[0]/z[3],z[1]/z[3]),q=i.aC(S,G)&&R[3]<j[3],re=i.aC(S,U)&&z[3]<j[3];if(!q&&!re)return null;const Y=function(Te,be,Ie){for(let Re=1;Re<Te.length;Re++){const Be=Ui(be.pointCoordinate3D(Te[Re-1]).x),Ge=Ui(be.pointCoordinate3D(Te[Re]).x);if(Ie<0){if(Be<Ge)return{idx:Re,t:-Be/(Ge-1-Be)}}else if(Ge<Be)return{idx:Re,t:(1-Be)/(Ge+1-Be)}}return null}(S,E,q?-1:1);if(!Y)return null;const{idx:ne,t:oe}=Y;let ce=ne>1?ji(S.slice(0,ne),E):[],ge=ne<S.length?ji(S.slice(ne),E):[];ce=ce.map(Te=>new i.P(Ui(Te.x),Te.y)),ge=ge.map(Te=>new i.P(Ui(Te.x),Te.y));const xe=[...ce];xe.length===0&&xe.push(ge[ge.length-1]);const Ce=i.ai(xe[xe.length-1].y,(ge.length===0?ce[0]:ge[0]).y,oe);let Ae;return Ae=q?[new i.P(0,Ce),new i.P(0,0),new i.P(1,0),new i.P(1,Ce)]:[new i.P(1,Ce),new i.P(1,1),new i.P(0,1),new i.P(0,Ce)],xe.push(...Ae),ge.length===0?xe.push(ce[0]):xe.push(...ge),{polygon:xe.map(Te=>new i.ac(Te.x,Te.y)),unwrapped:!1}}(n,c);if(p)return p;const x=function(S,E){let M=!1,R=-1/0,z=0;for(let G=0;G<S.length-1;G++)S[G].x>R&&(R=S[G].x,z=G);for(let G=0;G<S.length-1;G++){const U=(z+G)%(S.length-1),q=S[U],re=S[U+1];Math.abs(q.x-re.x)>.5&&(q.x<re.x?(q.x+=1,U===0&&(S[S.length-1].x+=1)):(re.x+=1,U+1===S.length-1&&(S[0].x+=1)),M=!0)}const j=i.aD(E.center.lng);return M&&j<Math.abs(j-1)&&S.forEach(G=>{G.x-=1}),{polygon:S,unwrapped:M}}(ji(n,c).map(S=>new i.P(Ui(S.x),S.y)),c);return{polygon:x.polygon.map(S=>new i.ac(S.x,S.y)),unwrapped:x.unwrapped}}}function ji(f,n){return i.aE(f,c=>{const p=n.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Ui(f){return f<0?1+f%1:f%1}function Ri(f){return 100*f|0}function ms(f,n,c,p,x){const S=function(M,R){if(M)return x(M);if(R){if(f.url&&R.tiles&&f.tiles&&delete f.tiles,R.variants){if(!Array.isArray(R.variants))return x(new Error("variants must be an array"));for(const j of R.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return x(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){R=i.h(R,j);break}}}const z=i.aF(i.h({},R,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=n.canonicalizeTileset(z,f.url),x(null,z)}},E=function(M,R,z){if(!M)return null;if(!R&&!z)return M;z=z||M.worldview_default;const j=Object.values(M.language||{});if(j.length===0)return null;const G=Object.values(M.worldview||{});if(G.length===0)return null;const U=j.every(re=>re===R),q=G.every(re=>re===z);return U&&q?M:R in(M.language_options||{})||z in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(f.data,c,p);return E?i.q.frame(()=>S(null,E)):f.url?i.n(n.transformRequest(n.normalizeSourceURL(f.url,null,c,p),i.R.Source),S):i.q.frame(()=>{const{data:M,...R}=f;S(null,R)})}function us(f,n){const c=Math.pow(2,n.z),p=Math.floor(i.aD(f.getWest())*c),x=Math.floor(i.aH(f.getNorth())*c),S=Math.ceil(i.aD(f.getEast())*c),E=Math.ceil(i.aH(f.getSouth())*c);return n.x>=p&&n.x<S&&n.y>=x&&n.y<E}class yo{constructor(n,c,p){this.bounds=n?i.aG.convert(this.validateBounds(n)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const c of n)this.extraBounds.push(i.aG.convert(this.validateBounds(c)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!us(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(us(c,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const c=new yo(n.bounds,n.minzoom,n.maxzoom);return c.addExtraBounds(n.extra_bounds),c}}class Bo extends i.E{constructor(n,c,p,x){if(super(),this.id=n,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.h(this,i.aF(c,["url","scheme","tileSize","promoteId"])),this._options=i.h({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.aI}load(n){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=ms(this._options,this.map._requestManager,c,p,(x,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.z(x));else if(S){if(i.h(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of S.vector_layers)this.vectorLayerIds.push(E.id),S.worldview&&S.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=yo.fromTileJSON(S),Ct(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}loadTile(n,c){const p=n.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),S=this.map._requestManager.transformRequest(x,i.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,M=E?{image:E.image.clone()}:null,R={request:S,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&i.j(p)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",R,z.bind(this));else if(n.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",R,z.bind(this),void 0,!0);else{const j=i.aJ.call({deduped:this._deduped},R,(G,U)=>{G||!U?z.call(this,G):(R.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},n.actor&&n.actor.send("loadTile",R,z.bind(this),void 0,!0))},!0);n.request={cancel:j}}function z(j,G){return delete n.request,n.aborted?c(null):j&&j.status!==404?c(j):(G&&G.resourceTiming&&(n.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&n.setExpiryData(G),n.loadVectorData(G,this.map.painter),i.aK(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Gs extends i.E{constructor(n,c,p,x){super(),this.id=n,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.h({type:"raster"},c),i.h(this,i.aF(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=ms(this._options,this.map._requestManager,null,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new i.z(p)):x&&(i.h(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=yo.fromTileJSON(x),Ct(x.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const p=i.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=i.o(this.map._requestManager.transformRequest(x,i.R.Tile),(S,E,M,R)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):S?(n.state="errored",c(S)):E?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:R}),n.setTexture(E,this.map.painter),n.state="loaded",i.aK(this.dispatcher),void c(null)):c(null)))}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c&&c()}unloadTile(n,c){n.texture&&n.texture instanceof i.T?(n.destroy(!0),n.texture&&n.texture instanceof i.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class kc extends Gs{constructor(n,c,p,x){super(n,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.h({type:"raster-array"},c)}triggerRepaint(n){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,n.tileID),this.map.triggerRepaint()}loadTile(n,c){const p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile),S={request:x,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=x,n.actor||(n.actor=this.dispatcher.getActor());const E=(M,R,z,j)=>{if(delete n.request,n.aborted)return n.state="unloaded",c(null);if(M)return M.name==="AbortError"?void 0:(n.state="errored",c(M));if(this.map._refreshExpiredTiles&&R&&n.setExpiryData({cacheControl:z,expires:j}),this.partial)n.state="empty";else{if(!R)return c(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=R}c(null)};n.request=this.partial?n.fetchHeader(void 0,E.bind(this)):n.actor.send("loadTile",S,E.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,c){const p=n.texture;p&&p instanceof i.T?(n.destroy(!0),this.map.painter.saveTileTexture(p)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,c,p){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(c,p,(x,S)=>{if(x)return n.state="errored",this.fire(new i.z(x)),void this.triggerRepaint(n);S&&(n._isHeaderLoaded=!0,n.setTexture(S,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:S})=>S===n),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(n,c,p){if(!n)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let S=null;c instanceof i.aN?S=c.paint.get("raster-array-band"):c instanceof i.aO&&(S=c.paint.get("raster-particle-array-band"));const E=S||this.getInitialBand(x);if(E!=null)if(n.textureDescriptor){if(!n.updateNeeded(x,E)||p)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,x,E)}getImages(n,c){const p=new Map;for(const x of n)for(const S of c){const[E,M]=S.split("/"),R=x.getLayer(E);if(!R||!R.hasBand(M)||!R.hasDataForBand(M))continue;const{bytes:z,tileSize:j,buffer:G}=R.getBandView(M),U=j+2*G,q={data:new i.r({width:U,height:U},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(S,q)}return p}}const kf={vector:Bo,raster:Gs,"raster-dem":class extends Gs{constructor(f,n,c,p){super(f,n,c,p),this.type="raster-dem",this.maxzoom=22,this._options=i.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,S){x&&(f.state="errored",n(x)),S&&(f.dem=S,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=i.o(this.map._requestManager.transformRequest(c,i.R.Tile),(function(x,S,E,M){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(x)f.state="errored",n(x);else if(S){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:M});const R=ImageBitmap&&S instanceof ImageBitmap&&i.t(),z=1-(S.width-i.aL(S.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const j=R?S:i.q.getImageData(S,z),G={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:z};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",G,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),p=(n.x-1+c)%c,x=n.x===0?f.wrap-1:f.wrap,S=(n.x+1+c)%c,E=n.x+1===c?f.wrap+1:f.wrap,M={};return M[new i.aM(f.overscaledZ,x,n.z,p,n.y).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,n.z,S,n.y).key]={backfilled:!1},n.y>0&&(M[new i.aM(f.overscaledZ,x,n.z,p,n.y-1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,n.z,S,n.y-1).key]={backfilled:!1}),n.y+1<c&&(M[new i.aM(f.overscaledZ,x,n.z,p,n.y+1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,n.z,S,n.y+1).key]={backfilled:!1}),M}},"raster-array":kc,geojson:class extends i.E{constructor(f,n,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=n.data,this._options=i.h({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=i.aj/this.tileSize;this.workerOptions=i.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:i.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:i.aj,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const c of this._data.features)n.set(c.id,c);for(const c of f.features)n.set(c.id,c);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=i.h({append:f},this.workerOptions);n.scope=this.scope;const c=this._data;typeof c=="string"?(n.request=this.map._requestManager.transformRequest(i.q.resolveURL(c),i.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.z(p));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.A("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=i.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,S=this._partialReload,E={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:S,worldview:this.map.getWorldview()};f.request=this.actor.send(c,E,(M,R)=>S&&!R?(f.state="loaded",n(null)):(delete f.request,f.destroy(),f.aborted?n(null):M?n(M):(f.loadVectorData(R,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aP{constructor(f,n,c,p){super(f,n,c,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,i.R.Source).url);i.aQ(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new i.z(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aP,model:class extends i.E{constructor(f,n,c,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const f=[];for(const n in this._options.models){const c=this._options.models[n],p=i.aS(this.map._requestManager.transformRequest(c.uri,i.R.Model).url).then(x=>{if(!x)return;const S=i.aT(x),E=new i.aU(n,c.position,c.orientation,S);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new i.z(new Error(`Could not load model ${n} from ${c.uri}: ${x.message}`)))});f.push(p)}Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new i.z(new Error(`Could not load models: ${n.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,n){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(f,n,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=ms(this._options,this.map._requestManager,n,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.z(p))):x&&(i.h(this,x),x.bounds&&(this.tileBounds=new yo(x.bounds,this.minzoom,this.maxzoom)),Ct(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const S=Object.values(f.buckets);for(const E of S)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(S,E){return f.aborted?n(null):S&&S.status!==404?n(S):(this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadModelData(E,this.map.painter),f.state="loaded",void n(null))}}serialize(){return i.h({},this._options)}},canvas:class extends i.aP{constructor(f,n,c,p){super(f,n,c,p),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new i.z(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,n,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new yo(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),i.h(this,i.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:n,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:c,y:p,z:x}=f.tileID.canonical,S=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:S.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",n(null)):E===void 0?(f.state="errored",n(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(E)?(this.loadTileData(f,E),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(f.state="errored",n(E))}),f.request.cancel=()=>S.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof i.T?(f.destroy(!0),f.texture&&f.texture instanceof i.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=i.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Pc=function(f,n,c,p){const x=new kf[n.type](f,n,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return i.aV(["load","abort","unload","serialize","prepare"],x),x};function Rc(f,n,c=""){return`${c}:${n.id||""}:${n.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:S}=p;return`featureset:${x}${S?`:import:${S}`:""}`}}(f.target)}`}function Nc(f,n,c,p=""){if(f.uniqueFeatureID){const x=Rc(f,n,p);if(c.has(x))return!0;c.add(x)}return!1}function yu(f,n,c,p,x=!1){const S=n.sourceCache.transform,E=n.sourceCache.tilesIn(f,n.has3DLayers,x);E.sort(yh);const M=[];for(const R of E){const z=R.tile.queryRenderedFeatures(n,R,c,p,S,x);Object.keys(z).length&&M.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:z})}return M.length===0?{}:function(R){const z={},j={};for(const G of R){const U=G.queryResults,q=G.wrappedTileID,re=j[q]=j[q]||{};for(const Y in U){const ne=U[Y],oe=re[Y]=re[Y]||{},ce=z[Y]=z[Y]||[];for(const ge of ne)oe[ge.featureIndex]||(oe[ge.featureIndex]=!0,ce.push(ge))}}return z}(M)}function _u(f,n,c,p,x,S){const E={},M=p.queryRenderedSymbols(f),R=[];for(const z of Object.keys(M).map(Number))R.push(x[z]);R.sort(yh);for(const z of R){const j=z.featureIndex.lookupSymbolFeatures(M[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,n,c,S);for(const G in j){const U=E[G]=E[G]||[],q=j[G];q.sort((re,Y)=>{const ne=z.featureSortOrder;if(ne){const oe=ne.indexOf(re.featureIndex);return ne.indexOf(Y.featureIndex)-oe}return Y.featureIndex-re.featureIndex});for(const re of q)U.push(re)}}return E}function bd(f,n){const c=f.getRenderableIds().map(S=>f.getTileByID(S)),p=[],x={};for(let S=0;S<c.length;S++){const E=c[S],M=E.tileID.canonical.key;x[M]||(x[M]=!0,E.querySourceFeatures(p,n))}return p}function yh(f,n){const c=f.tileID,p=n.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Wa(f,n){const c={};if(!n)return c;for(const p of f){const x=p.layerIds.map(S=>n.getLayer(S)).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(S=>x.filter(E=>E.id===S)[0]));for(const S of x)c[S.fqid]=p}}return c}const Vo=32,Eo=33,ec=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,c=0,p=0,x=0,S=0,E=0,M=0;for(1&n?x=S=E=Vo:c=p=M=Vo;(n>>=1)>1;){const z=c+x>>1,j=p+S>>1;1&n?(x=c,S=p,c=E,p=M):(c=x,p=S,x=E,S=M),E=z,M=j}const R=4*f;ec[R+0]=c,ec[R+1]=p,ec[R+2]=x,ec[R+3]=S}const Aa=new Uint16Array(2178),fi=new Uint8Array(1089),_h=new Uint16Array(1089);function ll(f){return f===0?-.03125:f===32?.03125:0}const xu={type:2,extent:i.aj,loadGeometry:()=>[[new i.P(0,0),new i.P(i.aj+1,0),new i.P(i.aj+1,i.aj+1),new i.P(0,i.aj+1),new i.P(0,0)]]};class Dc{constructor(n,c,p,x,S,E){this.tileID=n,this.uid=i.a$(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E}registerFadeDuration(n){const c=n+this.timeAdded;c<i.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,c,p){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=Wa(n.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof i.b1){if(this.hasSymbolBuckets=!0,!p)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof i.b1&&S.hasRTLText){this.hasRTLText=!0,i.b2();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x],E=c.style.getOwnLayer(x);if(!E)continue;const M=E.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,M)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new i.b0}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,c,p){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,Wa(n.buckets,c.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const x in this.buckets){const S=this.buckets[x];S.uploadPending()&&S.upload(n)}const c=n.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new i.T(n,p.image,c.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(n,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(n,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(n,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(n,c,p,x,S,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=function(R,z){const j=i.bn([],[.5*R.width,.5*-R.height,1]);return i.bo(j,j,[1,-1,0]),i.az(j,j,R.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(j)}(S,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:c,pixelPosMatrix:M,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),S=c?c.sourceLayer:"",E=x._geojsonTileLayer||x[S];if(!E)return;const M=i.b3(c&&c.filter),{z:R,x:z,y:j}=this.tileID.canonical,G={z:R,x:z,y:j};for(let U=0;U<E.length;U++){const q=E.feature(U);if(M.needGeometry){const ne=i.b4(q,!0);if(!M.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),ne,this.tileID.canonical))continue}else if(!M.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const re=p.getId(q,S),Y=new i.b5(q,R,z,j,re);Y.tile=G,n.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const c=this.expirationTime;if(n.cacheControl){const p=i.b6(n.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const S=this.expirationTime-c;S?this.expirationTime=p+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,c){if(!this.latestFeatureIndex||!n.style)return;const p=this.latestFeatureIndex.loadVTLayers(),x=n.style.listImages(),S=n.style.getBrightness();for(const E in this.buckets){if(!n.style.hasLayer(E))continue;const M=this.buckets[E],R=M.layers[0],z=R.sourceLayer||"_geojsonTileLayer",j=p[z],G=n.style.getLayerSourceCache(R);let U={};G&&(U=G._state.getState(z,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},re=Object.keys(U).length>0&&!c;re&&!M.stateDependentLayers.length&&!c||M.update(U,j,x,q,re?M.stateDependentLayers:M.layers,c,S),(M instanceof i.b7||M instanceof i.b8)&&n._terrain&&n._terrain.enabled&&G&&M.uploadPending()&&n._terrain._clearRenderCacheForTile(G.id,this.tileID);const Y=n&&n.style&&n.style.getOwnLayer(E);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=i.q.now()+n}setTexture(n,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof i.T?this.texture.update(n):(this.texture=new i.T(p,n,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(n,c){const p={};for(const x of c)p[x]=!0;this.dependencies[n]=p}hasDependency(n,c){for(const p of n){const x=this.dependencies[p];if(x){for(const S of c)if(x[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=i.b9(xu,this.tileID.canonical,this.tileTransform)[0],x=new i.ba,S=new i.bb;for(let E=0;E<p.length;E++){const{x:M,y:R}=p[E];x.emplaceBack(M,R),S.emplaceBack(E)}S.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(S),this._tileDebugBuffer=n.createVertexBuffer(x,i.bc.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,x.length,S.length)}_makeTileBoundsBuffers(n,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=i.b9(xu,this.tileID.canonical,this.tileTransform)[0];let x,S;if(this.isRaster){const E=function(M,R){const z=i.aW(M,R),j=Math.pow(2,M.z);for(let ne=0;ne<Eo;ne++)for(let oe=0;oe<Eo;oe++){const ce=i.aX((M.x+(oe+ll(oe))/Vo)/j),ge=i.aY((M.y+(ne+ll(ne))/Vo)/j),xe=R.project(ce,ge),Ce=ne*Eo+oe;Aa[2*Ce+0]=Math.round((xe.x*z.scale-z.x)*i.aj),Aa[2*Ce+1]=Math.round((xe.y*z.scale-z.y)*i.aj)}fi.fill(0),_h.fill(0);for(let ne=2045;ne>=0;ne--){const oe=4*ne,ce=ec[oe+0],ge=ec[oe+1],xe=ec[oe+2],Ce=ec[oe+3],Ae=ce+xe>>1,Te=ge+Ce>>1,be=Ae+Te-ge,Ie=Te+ce-Ae,Re=ge*Eo+ce,Be=Ce*Eo+xe,Ge=Te*Eo+Ae,st=Math.hypot((Aa[2*Re+0]+Aa[2*Be+0])/2-Aa[2*Ge+0],(Aa[2*Re+1]+Aa[2*Be+1])/2-Aa[2*Ge+1])>=16;fi[Ge]=fi[Ge]||(st?1:0),ne<1022&&(fi[Ge]=fi[Ge]||fi[(ge+Ie>>1)*Eo+(ce+be>>1)]||fi[(Ce+Ie>>1)*Eo+(xe+be>>1)])}const G=new i.aZ,U=new i.a_;let q=0;function re(ne,oe){const ce=oe*Eo+ne;return _h[ce]===0&&(G.emplaceBack(Aa[2*ce+0],Aa[2*ce+1],ne*i.aj/Vo,oe*i.aj/Vo),_h[ce]=++q),_h[ce]-1}function Y(ne,oe,ce,ge,xe,Ce){const Ae=ne+ce>>1,Te=oe+ge>>1;if(Math.abs(ne-xe)+Math.abs(oe-Ce)>1&&fi[Te*Eo+Ae])Y(xe,Ce,ne,oe,Ae,Te),Y(ce,ge,xe,Ce,Ae,Te);else{const be=re(ne,oe),Ie=re(ce,ge),Re=re(xe,Ce);U.emplaceBack(be,Ie,Re)}}return Y(0,0,Vo,Vo,Vo,0),Y(Vo,Vo,0,0,0,Vo),{vertices:G,indices:U}}(this.tileID.canonical,c);x=E.vertices,S=E.indices}else{x=new i.aZ,S=new i.a_;for(const{x:M,y:R}of p)x.emplaceBack(M,R,0,0);const E=i.be(x.int16.subarray(0,4*x.length),void 0,4);for(let M=0;M<E.length;M+=3)S.emplaceBack(E[M],E[M+1],E[M+2])}this._tileBoundsBuffer=n.createVertexBuffer(x,i.bf.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(S),this._tileBoundsSegments=i.bd.simpleSegment(0,0,x.length,S.length)}_makeGlobeTileDebugBuffers(n,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,S=i.bg(x,c),E=i.bh(S),M=i.ah(c.zoom);let R;M>0&&(R=i.bi(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,x,c,E,R,M),this._makeGlobeTileDebugTextBuffer(n,x,c,E,R,M)}_globePoint(n,c,p,x,S,E,M){let R=i.bj(n,c,p);if(E){const z=1<<p.z,j=i.aD(x.center.lng),G=i.aH(x.center.lat),U=(p.x+.5)/z-j;let q=0;U>.5?q=-1:U<-.5&&(q=1);let re=(n/i.aj+p.x)/z+q,Y=(c/i.aj+p.y)/z;re=(re-j)*x._pixelsPerMercatorPixel+j,Y=(Y-G)*x._pixelsPerMercatorPixel+G;const ne=[re*x.worldSize,Y*x.worldSize,0];i.ad(ne,ne,E),R=i.bk(R,ne,M)}return i.ad(R,R,S)}_makeGlobeTileDebugBorderBuffer(n,c,p,x,S,E){const M=new i.ba,R=new i.bb,z=new i.bl,j=(U,q,re,Y,ne)=>{const oe=(re-U)/(ne-1),ce=(Y-q)/(ne-1),ge=M.length;for(let xe=0;xe<ne;xe++){const Ce=U+xe*oe,Ae=q+xe*ce;M.emplaceBack(Ce,Ae);const Te=this._globePoint(Ce,Ae,c,p,x,S,E);z.emplaceBack(Te[0],Te[1],Te[2]),R.emplaceBack(ge+xe)}},G=i.aj;j(0,0,G,0,16),j(G,0,G,G,16),j(G,G,0,G,16),j(0,G,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(R),this._tileDebugBuffer=n.createVertexBuffer(M,i.bc.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(z,i.bm.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,M.length,R.length)}_makeGlobeTileDebugTextBuffer(n,c,p,x,S,E){const M=i.aj/4,R=new i.ba,z=new i.a_,j=new i.bl,G=25;z.reserve(32),R.reserve(G),j.reserve(G);const U=(q,re)=>G*q+re;for(let q=0;q<G;q++){const re=q*M;for(let Y=0;Y<G;Y++){const ne=Y*M;R.emplaceBack(ne,re);const oe=this._globePoint(ne,re,c,p,x,S,E);j.emplaceBack(oe[0],oe[1],oe[2])}}for(let q=0;q<4;q++)for(let re=0;re<4;re++){const Y=U(q,re),ne=U(q,re+1),oe=U(q+1,re),ce=U(q+1,re+1);z.emplaceBack(Y,ne,oe),z.emplaceBack(oe,ne,ce)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(z),this._tileDebugTextBuffer=n.createVertexBuffer(R,i.bc.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(j,i.bm.members),this._tileDebugTextSegments=i.bd.simpleSegment(0,0,G,32)}destroy(n=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bp.setPbf(i.bq);class vu extends Dc{constructor(n,c,p,x,S){super(n,c,p,x,S),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexture(n,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(n.width),this.texture&&this.texture instanceof i.T?this.texture.update(n,{premultiply:!1}):this.texture=new i.T(p,n,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,c){const p=this._mrt=new i.bp(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=i.br(x,(S,E,M,R)=>{if(S)c(S);else try{const z=p.getHeaderLength(E);if(z>n)return void(this.request=this.fetchHeader(z,c));p.parseHeader(E),this._isHeaderLoaded=!0;let j=0;for(const G of Object.values(p.layers))j=Math.max(j,G.dataIndex[G.dataIndex.length-1].lastByte);E.byteLength>=j&&(this.entireBuffer=E),c(null,this.entireBuffer||E,M,R)}catch(z){c(z)}}),this.request}fetchBand(n,c,p){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void p(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void p(new Error("Can't fetch tile band without an actor"));let E;const M=(G,U)=>{E.complete(G,U),G?p(G):(this.updateTextureDescriptor(n,c),p(null,this.textureDescriptor&&this.textureDescriptor.img))},R=(G,U)=>{if(G)return p(G);const q=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:U,task:E},M,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),E.cancel()})},z=x.getLayer(n);if(!z)return void p(new Error(`Unknown sourceLayer "${n}"`));if(z.hasDataForBand(c))return this.updateTextureDescriptor(n,c),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=z.getDataRange([c]);if(E=x.createDecodingTask(j),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)R(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),U=i.br(G,R);this._fetchQueue.push(()=>{U.cancel(),E.cancel()})}else p(null)}updateNeeded(n,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,c){if(!this._mrt)return;const p=this._mrt.getLayer(n);if(!p||!p.hasBand(c)||!p.hasDataForBand(c))return;const{bytes:x,tileSize:S,buffer:E,offset:M,scale:R}=p.getBandView(c),z=S+2*E,j=new i.r({width:z,height:z},x),G=this.texture;G&&G instanceof i.T&&G.update(j,{premultiply:!1}),this.textureDescriptor={layer:n,band:c,img:j,buffer:E,offset:M,tileSize:S,format:p.pixelFormat,mix:[R,256*R,65536*R,16777216*R]}}}class Pf{constructor(n,c){this.max=n,this.onRemove=c,this.reset()}reset(){for(const n in this.data)for(const c of this.data[n])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(n,c,p){const x=n.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:c,timeout:void 0};if(p!==void 0&&(S.timeout=setTimeout(()=>{this.remove(n,S)},p)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const c=this.data[n].shift();return c.timeout&&clearTimeout(c.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),c.value}getByKey(n){const c=this.data[n];return c?c[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,c){if(!this.has(n))return this;const p=n.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),S=this.data[p][x];return this.data[p].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(n){const c=[];for(const p in this.data)for(const x of this.data[p])n(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class wd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,c,p){const x=String(c);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][x]=this.stateChanges[n][x]||{},i.h(this.stateChanges[n][x],p),this.deletedStates[n]===null){this.deletedStates[n]={};for(const S in this.state[n])S!==x&&(this.deletedStates[n][S]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][x]===null){this.deletedStates[n][x]={};for(const S in this.state[n][x])p[S]||(this.deletedStates[n][x][S]=null)}else for(const S in p)this.deletedStates[n]&&this.deletedStates[n][x]&&this.deletedStates[n][x][S]===null&&delete this.deletedStates[n][x][S]}removeFeatureState(n,c,p){if(this.deletedStates[n]===null)return;const x=String(c);if(this.deletedStates[n]=this.deletedStates[n]||{},p&&c!==void 0)this.deletedStates[n][x]!==null&&(this.deletedStates[n][x]=this.deletedStates[n][x]||{},this.deletedStates[n][x][p]=null);else if(c!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][x])for(p in this.deletedStates[n][x]={},this.stateChanges[n][x])this.deletedStates[n][x][p]=null;else this.deletedStates[n][x]=null;else this.deletedStates[n]=null}getState(n,c){const p=this.state[n]||{},x=this.stateChanges[n]||{},S=this.deletedStates[n];if(S===null)return{};if(c!==void 0){const M=String(c),R=i.h({},p[M],x[M]);if(S){const z=S[c];if(z===null)return{};for(const j in z)delete R[j]}return R}const E=i.h({},p,x);if(S)for(const M in S)delete E[M];return E}initializeTileState(n,c){n.refreshFeatureState(c)}coalesceChanges(n,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),i.h(this.state[x][E],this.stateChanges[x][E]),S[E]=this.state[x][E];p[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const E in this.state[x])S[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const M of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][M];S[E]=this.state[x][E]}p[x]=p[x]||{},i.h(p[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in n)n[x].refreshFeatureState(c)}}class ro extends i.E{constructor(n,c,p){super(),this.id=n,this._onlySymbols=p,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Pf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new wd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,c){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,c)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(n),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(ea).map(n=>n.key)}getRenderableIds(n,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,n,c)&&p.push(this._tiles[x]);return n?p.sort((x,S)=>{const E=x.tileID,M=S.tileID,R=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-M.overscaledZ||z.y-R.y||z.x-R.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(ea).map(x=>x.key)}hasRenderableParent(n){const c=this.findLoadedParent(n,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(n,c,p){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(c||!this._tiles[n].holdingForFade())&&(p||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,c){const p=this._tiles[n];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,n,c)))}_tileLoaded(n,c,p,x){if(x)if(n.state="errored",x.status!==404)this._source.fire(new i.z(x,{tile:n}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=i.q.now(),p==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(c,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const S=c[x];if(n.neighboringTiles&&n.neighboringTiles[S]){const E=this.getTileByID(S);p(n,E),p(E,n)}}function p(x,S){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=S.tileID.canonical.x-x.tileID.canonical.x;const M=S.tileID.canonical.y-x.tileID.canonical.y,R=Math.pow(2,x.tileID.canonical.z),z=S.tileID.key;E===0&&M===0||Math.abs(M)>1||(Math.abs(E)>1&&(Math.abs(E+R)===1?E+=R:Math.abs(E-R)===1&&(E-=R)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,E,M),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,c,p,x){for(const S in this._tiles){let E=this._tiles[S];if(x[S]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>p)continue;let M=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(M=z)}let R=M;for(;R.overscaledZ>c;)if(R=R.scaledTo(R.overscaledZ-1),n[R.key]){x[M.key]=M;break}}}findLoadedParent(n,c){if(n.key in this._loadedParentTiles){const p=this._loadedParentTiles[n.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=n.overscaledZ-1;p>=c;p--){const x=n.scaledTo(p),S=this._getLoadedTile(x);if(S)return S}}_getLoadedTile(n){const c=this._tiles[n.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,c){c=c||this._source.tileSize;const p=Math.ceil(n.width/c)+1,x=Math.ceil(n.height/c)+1,S=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(M)}handleWrapJump(n){const c=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,c){const p={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),p[S.tileID.key]=S}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(n,c,p,x,S){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(n,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let M,R=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const U=z.attenuationRange()[0],q=Math.floor(U)-Math.log2(z.getDemUpscale());R>q&&(R=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(U=>new i.aM(U.canonical.z,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y));else if(this.tileCoverLift!==0){const U=n.clone();U.tileCoverLift=this.tileCoverLift,M=U.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&n.projection.name==="globe"&&(M.push(new i.aM(1,0,1,0,0)),M.push(new i.aM(1,0,1,1,0)),M.push(new i.aM(1,0,1,0,1)),M.push(new i.aM(1,0,1,1,1)))}else if(M=n.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const U=this._source.hasTile.bind(this._source);M=M.filter(q=>U(q))}}else M=[];if(M.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Za(this._source.type)){const U=n.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),q=Math.min(U,this._source.maxzoom);if(E){const re=n.extendTileCover(M,q);for(const Y of re)M.push(Y)}else if(S){const re=n.extendTileCover(M,q,this.transform._camera.forward());for(const Y of re)M.push(Y)}else if(this.castsShadows&&x){const re=n.extendTileCover(M,q,x);for(const Y of re)this._shadowCasterTiles[Y.key]=!0,M.push(Y)}}const j=this._updateRetainedTiles(M);if(Za(this._source.type)&&M.length!==0){const U={},q={},re=Object.keys(j);for(const ne of re){const oe=j[ne],ce=this._tiles[ne];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=i.q.now())continue;const ge=this.findLoadedParent(oe,Math.max(oe.overscaledZ-ro.maxOverzooming,this._source.minzoom));ge&&(this._addTile(ge.tileID),U[ge.tileID.key]=ge.tileID),q[ne]=oe}const Y=M[M.length-1].overscaledZ;for(const ne in this._tiles){const oe=this._tiles[ne];if(j[ne]||!oe.hasData())continue;let ce=oe.tileID;for(;ce.overscaledZ>Y;){ce=ce.scaledTo(ce.overscaledZ-1);const ge=this._tiles[ce.key];if(ge&&ge.hasData()&&q[ce.key]){j[ne]=oe.tileID;break}}}for(const ne in U)j[ne]||(this._coveredTiles[ne]=!0,j[ne]=U[ne])}for(const U in j)this._tiles[U].clearFadeHold();const G=i.bs(this._tiles,j);for(const U of G){const q=this._tiles[U];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+U)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const c={};if(n.length===0)return c;const p={},x=n.reduce((z,j)=>Math.min(z,j.overscaledZ),1/0),S=n[0].overscaledZ,E=Math.max(S-ro.maxOverzooming,this._source.minzoom),M=Math.max(S+ro.maxUnderzooming,this._source.minzoom),R={};for(const z of n){const j=this._addTile(z);c[z.key]=z,j.hasData()||x<this._source.maxzoom&&(R[z.key]=z)}this._retainLoadedChildren(R,x,M,c);for(const z of n){let j=this._tiles[z.key];if(j.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const U=z.children(this._source.maxzoom)[0],q=this.getTile(U);if(q&&q.hasData()){c[U.key]=U;continue}}else{const U=z.children(this._source.maxzoom);if(c[U[0].key]&&c[U[1].key]&&c[U[2].key]&&c[U[3].key])continue}let G=j.wasRequested();for(let U=z.overscaledZ-1;U>=E;--U){const q=z.scaledTo(U);if(p[q.key]||(p[q.key]=!0,j=this.getTile(q),!j&&G&&(j=this._addTile(q)),j&&(c[q.key]=q,G=j.wasRequested(),j.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const c=[];let p,x=this._tiles[n].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(S),p)break;x=S}for(const S of c)this._loadedParentTiles[S]=p}}_addTile(n){let c=this._tiles[n.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),c;c=this._cache.getAndRemove(n),c&&(this._setTileReloadTimer(n.key,c),c.tileID=n,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,S=this._source.tileSize*n.overscaleFactor();c=this._source.type==="raster-array"?new vu(n,S,this.transform.tileZoom,x,this._isRaster):new Dc(n,S,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,n.key,c.state))}return c.uses++,this._tiles[n.key]=c,p||this._source.fire(new i.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(n,c){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const p=c.getExpiryTimeout();p&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},p))}_removeTile(n){const c=this._tiles[n];c&&(c.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,c,p){const x=[],S=this.transform;if(!S)return x;const E=S.projection.name==="globe",M=i.aD(S.center.lng);for(const R in this._tiles){const z=this._tiles[R];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let j;if(E){const G=z.tileID.canonical;if(G.z===0){const U=[Math.abs(i.ay(M,...Ia(G,-1))-M),Math.abs(i.ay(M,...Ia(G,1))-M)];j=[0,2*U.indexOf(Math.min(...U))-1]}else{const U=[Math.abs(i.ay(M,...Ia(G,-1))-M),Math.abs(i.ay(M,...Ia(G,0))-M),Math.abs(i.ay(M,...Ia(G,1))-M)];j=[U.indexOf(Math.min(...U))-1]}}else j=[0];for(const G of j){const U=n.containsTile(z,S,c,G);U&&x.push(U)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,c){const p=this.getRenderableIds(n,c).map(S=>this._tiles[S].tileID),x=this.transform.projection.name==="globe";for(const S of p)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=x?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return p}sortCoordinatesByDistance(n){const c=n.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),S={};for(const E of c){const M=1/(1<<E.canonical.z);S[E.key]=((E.canonical.x+.5)*M+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*M-p[1])*x[1]-p[2]*x[2]}return c.sort((E,M)=>S[E.key]-S[M.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Za(this._source.type))for(const n in this._tiles){const c=this._tiles[n];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(n,c,p){this._state.updateState(n=n||"_geojsonTileLayer",c,p)}removeFeatureState(n,c,p){this._state.removeFeatureState(n=n||"_geojsonTileLayer",c,p)}getFeatureState(n,c){return this._state.getState(n=n||"_geojsonTileLayer",c)}setDependencies(n,c,p){const x=this._tiles[n];x&&x.setDependencies(c,p)}reloadTilesForDependencies(n,c){for(const p in this._tiles)this._tiles[p].hasDependency(n,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(n,c))}_preloadTiles(n,c){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(n,c))};return void this._source.on("data",R)}const p=new Map,x=Array.isArray(n)?n:[n],S=this.map.painter.terrain,E=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const R of x){const z=R.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of z)p.set(j.key,j);this.usedForTerrain&&R.updateElevation(!1)}const M=Array.from(p.values());i.bt(M,(R,z)=>{const j=new Dc(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(j,G=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),z(G,j)})},c)}}function ea(f,n){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||p-c||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function Za(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Ia(f,n){const c=1<<f.z;return[f.x/c+n,(f.x+1)/c+n]}ro.maxOverzooming=10,ro.maxUnderzooming=3;class xh{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:n,visibilityChanged:c});else if(x.type==="model"){const S=this.style.getLayerSource(x);S&&S.type==="batched-model"&&this.layers.push({layer:x,visible:n,visibilityChanged:c})}}}onNewFrame(n){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(n)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(n)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(n)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(n,c){this.currentBuildingBuckets=[];for(const x of this.layers){const S=x.layer,E=this.style.getLayerSourceCache(S);let M=1;S.type==="fill-extrusion"?M=x.visible?S.paint.get("fill-extrusion-vertical-scale"):0:S.type==="building"&&(M=x.visible?S.paint.get("building-vertical-scale"):0);let R=E?E.getTile(c):null;if(!R&&E&&c.canonical.z>E.getSource().minzoom){let z=c.scaledTo(Math.min(E.getSource().maxzoom,c.overscaledZ-1));for(;z.overscaledZ>=E.getSource().minzoom&&(R=E.getTile(z),!R&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(S):null,tileID:R?R.tileID:c,verticalScale:M})}n.hasAnyZOffset=!1;let p=!1;for(let x=0;x<n.symbolInstances.length;x++){const S=n.symbolInstances.get(x),E=S.zOffset,M=this._getHeightAtTileOffset(c,S.tileAnchorX,S.tileAnchorY);S.zOffset=M!==Number.NEGATIVE_INFINITY?M:E,p||E===S.zOffset||(p=!0),n.hasAnyZOffset||S.zOffset===0||(n.hasAnyZOffset=!0)}p&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,c,p,x){let S=c,E=p;if(n.canonical.z!==x.canonical.z){const M=x.canonical,R=1/(1<<n.canonical.z-M.z);S=(c+n.canonical.x*i.aj)*R-M.x*i.aj|0,E=(p+n.canonical.y*i.aj)*R-M.y*i.aj|0}return{tileX:S,tileY:E}}_getHeightAtTileOffset(n,c,p){let x,S;for(let E=0;E<this.layers.length;++E){const M=this.layers[E].layer;if(M.type!=="fill-extrusion"&&M.type!=="building")continue;const{bucket:R,tileID:z,verticalScale:j}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:G,tileY:U}=this._mapCoordToOverlappingTile(n,c,p,z),q=R.getHeightAtTileCoord(G,U);q&&q.height!==void 0&&(q.hidden?x=q.height:S=Math.max(q.height*j,S||0))}if(S!==void 0)return S;for(let E=0;E<this.layers.length;++E){const M=this.layers[E];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:R,tileID:z}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:j,tileY:G}=this._mapCoordToOverlappingTile(n,c,p,z),U=R.getHeightAtTileCoord(j,G);if(U&&!U.hidden)return U.height===void 0&&x!==void 0?Math.min(U.maxHeight,x)*U.verticalScale:U.height?U.height*U.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vh(f,n){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return i.bu.forEach(p=>{p in n&&(c[p]=n[p])}),c}function Xa(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=vh(f[c],n[f[c].ref]));return f}const An={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Sd(f,n,c){c.push({command:An.addSource,args:[f,n[f]]})}function Cl(f,n,c){n.push({command:An.removeSource,args:[f]}),c[f]=!0}function Td(f,n,c,p){Cl(f,c,p),Sd(f,n,c)}function Eg(f,n,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!i.bv(f[c][p],n[c][p]))return!1;for(p in n[c])if(n[c].hasOwnProperty(p)&&p!=="data"&&!i.bv(f[c][p],n[c][p]))return!1;return!0}function Oc(f,n,c,p,x,S){let E;for(E in n=n||{},f=f||{})f.hasOwnProperty(E)&&(i.bv(f[E],n[E])||c.push({command:S,args:[p,E,n[E],x]}));for(E in n)n.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(i.bv(f[E],n[E])||c.push({command:S,args:[p,E,n[E],x]}))}function Lc(f){return f.id}function zc(f,n){return f[n.id]=n,f}class bu{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=i.ay(n,0,1);let c=1,p=this._distances[c];const x=n*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const S=c-1,E=this._distances[S],M=p-E,R=M>0?(x-E)/M:0;return this.points[S].mult(1-R).add(this.points[c].mult(R))}}class wu{constructor(n,c,p){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(c/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,p,x,S){this._forEachCell(c,p,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(n,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(n,c,p,x,S,E){this.boxCells[S].push(E)}_insertCircleCell(n,c,p,x,S,E){this.circleCells[S].push(E)}_query(n,c,p,x,S,E){if(p<0||n>this.width||x<0||c>this.height)return!S&&[];const M=[];if(n<=0&&c<=0&&this.width<=p&&this.height<=x){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],j=this.circles[3*R+1],G=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:z-G,y1:j-G,x2:z+G,y2:j+G})}return E?M.filter(E):M}return this._forEachCell(n,c,p,x,this._queryCell,M,{hitTest:S,seenUids:{box:{},circle:{}}},E),S?M.length>0:M}_queryCircle(n,c,p,x,S){const E=n-p,M=n+p,R=c-p,z=c+p;if(M<0||E>this.width||z<0||R>this.height)return!x&&[];const j=[];return this._forEachCell(E,R,M,z,this._queryCellCircle,j,{hitTest:x,circle:{x:n,y:c,radius:p},seenUids:{box:{},circle:{}}},S),x?j.length>0:j}query(n,c,p,x,S){return this._query(n,c,p,x,!1,S)}hitTest(n,c,p,x,S){return this._query(n,c,p,x,!0,S)}hitTestCircle(n,c,p,x){return this._queryCircle(n,c,p,!0,x)}_queryCell(n,c,p,x,S,E,M,R){const z=M.seenUids,j=this.boxCells[S];if(j!==null){const U=this.bboxes;for(const q of j)if(!z.box[q]){z.box[q]=!0;const re=4*q;if(n<=U[re+2]&&c<=U[re+3]&&p>=U[re+0]&&x>=U[re+1]&&(!R||R(this.boxKeys[q]))){if(M.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[q],x1:U[re],y1:U[re+1],x2:U[re+2],y2:U[re+3]})}}}const G=this.circleCells[S];if(G!==null){const U=this.circles;for(const q of G)if(!z.circle[q]){z.circle[q]=!0;const re=3*q;if(this._circleAndRectCollide(U[re],U[re+1],U[re+2],n,c,p,x)&&(!R||R(this.circleKeys[q]))){if(M.hitTest)return E.push(!0),!0;{const Y=U[re],ne=U[re+1],oe=U[re+2];E.push({key:this.circleKeys[q],x1:Y-oe,y1:ne-oe,x2:Y+oe,y2:ne+oe})}}}}}_queryCellCircle(n,c,p,x,S,E,M,R){const z=M.circle,j=M.seenUids,G=this.boxCells[S];if(G!==null){const q=this.bboxes;for(const re of G)if(!j.box[re]){j.box[re]=!0;const Y=4*re;if(this._circleAndRectCollide(z.x,z.y,z.radius,q[Y+0],q[Y+1],q[Y+2],q[Y+3])&&(!R||R(this.boxKeys[re])))return E.push(!0),!0}}const U=this.circleCells[S];if(U!==null){const q=this.circles;for(const re of U)if(!j.circle[re]){j.circle[re]=!0;const Y=3*re;if(this._circlesCollide(q[Y],q[Y+1],q[Y+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[re])))return E.push(!0),!0}}}_forEachCell(n,c,p,x,S,E,M,R){const z=this._convertToXCellCoord(n),j=this._convertToYCellCoord(c),G=this._convertToXCellCoord(p),U=this._convertToYCellCoord(x);for(let q=z;q<=G;q++)for(let re=j;re<=U;re++)if(S.call(this,n,c,p,x,this.xCellCount*re+q,E,M,R))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,p,x,S,E){const M=x-n,R=S-c,z=p+E;return z*z>M*M+R*R}_circleAndRectCollide(n,c,p,x,S,E,M){const R=(E-x)/2,z=Math.abs(n-(x+R));if(z>R+p)return!1;const j=(M-S)/2,G=Math.abs(c-(S+j));if(G>j+p)return!1;if(z<=R||G<=j)return!0;const U=z-R,q=G-j;return U*U+q*q<=p*p}}const Ka={unknown:0,flipRequired:1,flipNotRequired:2},Ed=Math.tan(85*Math.PI/180);function tc(f,n,c,p,x,S,E){const M=i.bz();if(c)if(S.name==="globe"){const R=i.bA(x,n);i.az(M,M,R)}else{const R=i.bB([],E);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],p||i.by(M,M,x.angle)}else i.az(M,x.labelPlaneMatrix,f);return M}function Rf(f,n,c,p,x,S,E){const M=tc(f,n,c,p,x,S,E);return S.name==="globe"&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function bh(f,n,c,p,x,S,E){if(c){if(S.name==="globe"){const M=tc(f,n,c,p,x,S,E);return i.bi(M,M),i.az(M,f,M),M}{const M=i.bw(f),R=i.bx([]);return R[0]=E[0],R[1]=E[1],R[4]=E[2],R[5]=E[3],i.az(M,M,R),p||i.by(M,M,-x.angle),M}}return x.glCoordMatrix}function ta(f,n,c,p){const x=[f,n,c,1];c?i.aA(x,x,p):In(x,x,p);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function Su(f,n){return Math.min(.5+f/n*.5,1.5)}function jc(f,n){const c=f[0]/f[3],p=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&p>=-n[1]&&p<=n[1]}function cl(f,n,c,p,x,S,E,M,R,z){const j=c.transform,G=p?f.textSizeData:f.iconSizeData,U=i.bH(G,c.transform.zoom),q=j.projection.name==="globe",re=[256/c.width*2+1,256/c.height*2+1],Y=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Y.clear();let ne=null;q&&(ne=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const oe=f.lineVertexArray,ce=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ge=c.transform.width/c.transform.height;let xe,Ce=!1;for(let Ae=0;Ae<ce.length;Ae++){const Te=ce.get(Ae),{numGlyphs:be,writingMode:Ie}=Te;if(Ie!==i.bI.vertical||Ce||xe===i.bI.horizontal||(Ce=!0),xe=Ie,(Te.hidden||Ie===i.bI.vertical)&&!Ce){qs(be,Y);continue}Ce=!1;const Re=new i.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Be,y:Ge,z:st}=j.projection.projectTilePoint(Re.x,Re.y,z.canonical);if(R){const[Vt,qt,Bt]=R(Re);Be+=Vt,Ge+=qt,st+=Bt}const it=[Be,Ge,st,1];if(i.aA(it,it,n),!jc(it,re)){qs(be,Y);continue}const mt=it[3],Ue=Su(c.transform.getCameraToCenterDistance(j.projection),mt),Je=i.bJ(G,U,Te),Le=E?Je/Ue:Je*Ue,lt=ta(Be,Ge,st,x);if(lt[3]<=0){qs(be,Y);continue}let Ye={};const pt=i.al(f.layers[0].layout.get("text-max-angle")),It=Math.cos(pt),ct=E?null:R,wt=Fc(Te,Le,!1,M,n,x,S,f.glyphOffsetArray,oe,Y,ne,lt,Re,Ye,ge,ct,j.projection,z,E,It);Ce=wt.useVertical,ct&&wt.needsFlipping&&(Ye={}),(wt.notEnoughRoom||Ce||wt.needsFlipping&&Fc(Te,Le,!0,M,n,x,S,f.glyphOffsetArray,oe,Y,ne,lt,Re,Ye,ge,ct,j.projection,z,E,It).notEnoughRoom)&&qs(be,Y)}p?(f.text.dynamicLayoutVertexBuffer.updateData(Y),ne&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ne)):(f.icon.dynamicLayoutVertexBuffer.updateData(Y),ne&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ne))}function Cd(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne){const{lineStartIndex:oe,glyphStartIndex:ce,segment:ge}=M,xe=ce+M.numGlyphs,Ce=oe+M.lineLength,Ae=n.getoffsetX(ce),Te=n.getoffsetX(xe-1),be=Eu(f*Ae,c,p,x,S,E,ge,oe,Ce,R,z,j,G,U,!0,q,re,Y,ne);if(!be)return null;const Ie=Eu(f*Te,c,p,x,S,E,ge,oe,Ce,R,z,j,G,U,!0,q,re,Y,ne);return Ie?{first:be,last:Ie}:null}function Tu(f,n,c,p){return f===i.bI.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===i.bI.vertical?p>0?{needsFlipping:!0}:null:n!==Ka.unknown&&function(x,S){return x===0||Math.abs(S/x)>Ed}(c,p)?n===Ka.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Fc(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce,ge){const xe=n/24,Ce=f.lineOffsetX*xe,Ae=f.lineOffsetY*xe,{lineStartIndex:Te,glyphStartIndex:be,numGlyphs:Ie,segment:Re,writingMode:Be,flipState:Ge}=f,st=Te+f.lineLength,it=mt=>{if(j){const[lt,Ye,pt]=mt.up,It=z.length;i.bK(j,It+0,lt,Ye,pt),i.bK(j,It+1,lt,Ye,pt),i.bK(j,It+2,lt,Ye,pt),i.bK(j,It+3,lt,Ye,pt)}const[Ue,Je,Le]=mt.point;i.bL(z,Ue,Je,Le,mt.angle)};if(Ie>1){const mt=Cd(xe,M,Ce,Ae,c,G,U,f,R,S,q,Y,!1,ne,oe,ce,ge);if(!mt)return{notEnoughRoom:!0};if(p&&!c){let[Ue,Je,Le]=mt.first.point,[lt,Ye,pt]=mt.last.point;[Ue,Je]=ta(Ue,Je,Le,E),[lt,Ye]=ta(lt,Ye,pt,E);const It=Tu(Be,Ge,(lt-Ue)*re,Ye-Je);if(f.flipState=It&&It.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,It)return It}it(mt.first);for(let Ue=be+1;Ue<be+Ie-1;Ue++){const Je=Eu(xe*M.getoffsetX(Ue),Ce,Ae,c,G,U,Re,Te,st,R,S,q,Y,!1,!1,ne,oe,ce,ge);if(!Je)return z.length-=4*(Ue-be),{notEnoughRoom:!0};it(Je)}it(mt.last)}else{if(p&&!c){const Ue=ta(U.x,U.y,0,x),Je=Te+Re+1,Le=new i.P(R.getx(Je),R.gety(Je)),lt=ta(Le.x,Le.y,0,x),Ye=lt[3]>0?lt:wh(U,Le,Ue,1,x,void 0,ne,oe.canonical),pt=Tu(Be,Ge,(Ye[0]-Ue[0])*re,Ye[1]-Ue[1]);if(f.flipState=pt&&pt.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,pt)return pt}const mt=Eu(xe*M.getoffsetX(be),Ce,Ae,c,G,U,Re,Te,st,R,S,q,Y,!1,!1,ne,oe,ce,ge);if(!mt)return{notEnoughRoom:!0};it(mt)}return{}}function _o(f,n,c,p,x){const{x:S,y:E,z:M}=p.projectTilePoint(f.x,f.y,n);if(!x)return ta(S,E,M,c);const[R,z,j]=x(f);return ta(S+R,E+z,M+j,c)}function wh(f,n,c,p,x,S,E,M){const R=_o(f.sub(n)._unit()._add(f),M,x,E,S);return i.at(R,c,R),i.au(R,R),i.bE(R,c,R,p)}function Eu(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce){const ge=p?f-n:f+n;let xe=ge>0?1:-1,Ce=0;p&&(xe*=-1,Ce=Math.PI),xe<0&&(Ce+=Math.PI);let Ae=M+E+(xe>0?0:1)|0,Te=x,be=x,Ie=0,Re=0;const Be=Math.abs(ge),Ge=[],st=[];let it=S,mt=it,Ue=i.bC([]);const Je=()=>wh(mt,it,be,Be-Ie+1,j,U,Y,ne.canonical);for(;Ie+Re<=Be;){if(Ae+=xe,Ae<M||Ae>=R)return null;if(be=Te,mt=it,Ge.push(be),q&&st.push(mt),it=new i.P(z.getx(Ae),z.gety(Ae)),Te=G[Ae],!Te){const Bt=_o(it,ne.canonical,j,Y,U);Te=Bt[3]>0?G[Ae]=Bt:Je()}Ie+=Re;const Vt=i.at([],Te,be),qt=i.bD(be,Te);if(c&&qt>0&&Re>0&&i.bG(Ue,Vt)/(Re*qt)<ce)return null;Re=qt,Ue=Vt}re&&U&&(G[Ae]&&(Te=Je(),Re=i.bD(be,Te),Ue=i.at([],Te,be)),G[Ae]=Te);const Le=(Be-Ie)/Re,lt=it.sub(mt)._mult(Le)._add(mt),Ye=i.bE([],be,Ue,Le);let pt=[0,0,1],It=Ue[0],ct=Ue[1];if(oe&&(pt=Y.upVector(ne.canonical,lt.x,lt.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const Vt=[pt[2],0,-pt[0]],qt=i.bF([],pt,Vt);i.au(Vt,Vt),i.au(qt,qt),It=i.bG(Ue,Vt),ct=i.bG(Ue,qt)}if(c){const Vt=i.bF([],pt,Ue);i.au(Vt,Vt),i.bE(Ye,Ye,Vt,c*xe)}const wt=Ce+Math.atan2(ct,It);return Ge.push(Ye),q&&st.push(lt),{point:Ye,angle:wt,path:Ge,tilePath:st,up:pt}}function qs(f,n){const c=n.length,p=c+4*f;n.resize(p),n.float32.fill(-1/0,4*c,4*p)}function In(f,n,c){const p=n[0],x=n[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const Ma=100;class Ad{constructor(n,c,p=new wu(n.width+200,n.height+200,25),x=new wu(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ma,this.screenBottomBoundary=n.height+Ma,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,p,x,S,E,M,R){let z=p.projectedAnchorX,j=p.projectedAnchorY,G=p.projectedAnchorZ;const U=p.elevation,q=p.tileID,re=n.getProjection();if(U&&q){const[Ae,Te,be]=re.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Ie=re.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Ae*U*Ie,j+=Te*U*Ie,G+=be*U*Ie}const Y=this.projectAndGetPerspectiveRatio(M,z,j,G,p.tileID,re.name==="globe"||!!U||this.transform.pitch>0,re),ne=E*Y.perspectiveRatio,oe=(p.x1*c+x.x-p.padding)*ne+Y.point.x,ce=(p.y1*c+x.y-p.padding)*ne+Y.point.y,ge=(p.x2*c+x.x+p.padding)*ne+Y.point.x,xe=(p.y2*c+x.y+p.padding)*ne+Y.point.y,Ce=Y.perspectiveRatio<=.55||Y.occluded;return!this.isInsideGrid(oe,ce,ge,xe)||!S&&this.grid.hitTest(oe,ce,ge,xe,R)||Ce?{box:[],offscreen:!1,occluded:Y.occluded}:{box:[oe,ce,ge,xe],offscreen:this.isOffscreen(oe,ce,ge,xe),occluded:!1}}placeCollisionCircles(n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y){const ne=[],oe=this.transform.elevation,ce=n.getProjection(),ge=oe?oe.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,ce):null,xe=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:Ce,y:Ae,z:Te}=ce.projectTilePoint(xe.x,xe.y,Y.canonical);if(ge){const[pt,It,ct]=ge(xe);Ce+=pt,Ae+=It,Te+=ct}const be=ce.name==="globe",Ie=this.projectAndGetPerspectiveRatio(M,Ce,Ae,Te,Y,be||!!oe||this.transform.pitch>0,ce),{perspectiveRatio:Re}=Ie,Be=(G?E/Re:E*Re)/i.bO,Ge=ta(Ce,Ae,Te,R),st=p.lineOffsetX*Be,it=p.lineOffsetY*Be,mt=i.al(n.layers[0].layout.get("text-max-angle")),Ue=Math.cos(mt),Je=Ie.signedDistanceFromCamera>0?Cd(Be,S,st,it,!1,Ge,xe,p,x,R,{},oe&&!G?ge:null,G&&!!oe,ce,Y,G,Ue):null;let Le=!1,lt=!1,Ye=!0;if(Je&&!Ie.occluded){const pt=.5*q*Re+re,It=new i.P(-100,-100),ct=new i.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new bu,{first:Vt,last:qt}=Je,Bt=Vt.path.length;let Xt=[];for(let Or=Bt-1;Or>=1;Or--)Xt.push(Vt.path[Or]);for(let Or=1;Or<qt.path.length;Or++)Xt.push(qt.path[Or]);const cr=2.5*pt;z&&(Xt=Xt.map(([Or,Qr,wn],oi)=>(ge&&!be&&(wn=ge(oi<Bt-1?Vt.tilePath[Bt-1-oi]:qt.tilePath[oi-Bt+2])[2]),ta(Or,Qr,wn,z))),Xt.some(Or=>Or[3]<=0)&&(Xt=[]));let gr=[];if(Xt.length>0){let Or=1/0,Qr=-1/0,wn=1/0,oi=-1/0;for(const Vn of Xt)Or=Math.min(Or,Vn[0]),wn=Math.min(wn,Vn[1]),Qr=Math.max(Qr,Vn[0]),oi=Math.max(oi,Vn[1]);Qr>=It.x&&Or<=ct.x&&oi>=It.y&&wn<=ct.y&&(gr=[Xt.map(Vn=>new i.P(Vn[0],Vn[1]))],(Or<It.x||Qr>ct.x||wn<It.y||oi>ct.y)&&(gr=i.bM(gr,It.x,It.y,ct.x,ct.y)))}for(const Or of gr){wt.reset(Or,.25*pt);let Qr=0;Qr=wt.length<=.5*pt?1:Math.ceil(wt.paddedLength/cr)+1;for(let wn=0;wn<Qr;wn++){const oi=wn/Math.max(Qr-1,1),Vn=wt.lerp(oi),Pn=Vn.x+Ma,$i=Vn.y+Ma;ne.push(Pn,$i,pt,0);const Vr=Pn-pt,en=$i-pt,un=Pn+pt,ai=$i+pt;if(Ye=Ye&&this.isOffscreen(Vr,en,un,ai),lt=lt||this.isInsideGrid(Vr,en,un,ai),!c&&this.grid.hitTestCircle(Pn,$i,pt,U)&&(Le=!0,!j))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!j&&Le||!lt?[]:ne,offscreen:Ye,collisionDetected:Le,occluded:Ie.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,S=-1/0,E=-1/0;for(const j of n){const G=new i.P(j.x+Ma,j.y+Ma);p=Math.min(p,G.x),x=Math.min(x,G.y),S=Math.max(S,G.x),E=Math.max(E,G.y),c.push(G)}const M=this.grid.query(p,x,S,E).concat(this.ignoredGrid.query(p,x,S,E)),R={},z={};for(const j of M){const G=j.key;if(R[G.bucketInstanceId]===void 0&&(R[G.bucketInstanceId]={}),R[G.bucketInstanceId][G.featureIndex])continue;const U=[new i.P(j.x1,j.y1),new i.P(j.x2,j.y1),new i.P(j.x2,j.y2),new i.P(j.x1,j.y2)];i.bN(c,U)&&(R[G.bucketInstanceId][G.featureIndex]=!0,z[G.bucketInstanceId]===void 0&&(z[G.bucketInstanceId]=[]),z[G.bucketInstanceId].push(G.featureIndex))}return z}insertCollisionBox(n,c,p,x,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:S},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,p,x,S){const E=c?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:x,collisionGroupID:S};for(let R=0;R<n.length;R+=4)E.insertCircle(M,n[R],n[R+1],n[R+2])}projectAndGetPerspectiveRatio(n,c,p,x,S,E,M){const R=[c,p,x,1];let z=!1;x||this.transform.pitch>0?(i.aA(R,R,n),this.fogState&&S&&M.name!=="globe"&&(z=function(U,q,re,Y,ne,oe){const ce=oe.calculateFogTileMatrix(ne),ge=[q,re,Y];return i.ad(ge,ge,ce),Nt(U,i.ae(ge),oe.pitch,oe._fov)}(this.fogState,c,p,x,S.toUnwrapped(),this.transform)>.9)):In(R,R,n);const j=R[3];return{point:new i.P((R[0]/j+1)/2*this.transform.width+Ma,(-R[1]/j+1)/2*this.transform.height+Ma),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/j*.5,1.5),signedDistanceFromCamera:j,occluded:E&&R[2]>j||z}}isOffscreen(n,c,p,x){return p<Ma||n>=this.screenRightBoundary||x<Ma||c>this.screenBottomBoundary}isInsideGrid(n,c,p,x){return p>=0&&n<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=i.bx([]);return i.bo(n,n,[-100,-100,0]),n}}function cm(f,n,c){const p=n.createTileMatrix(f,f.worldSize,c.toUnwrapped());return i.az(new Float32Array(16),f.projMatrix,p)}function Ir(f,n,c){if(n.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(n.projection),cm(p,n.getProjection(),f)}function Sh(f,n,c){return n.name===c.projection.name?f.projMatrix:cm(c,n,f)}class rc{constructor(n,c,p,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Al{constructor(n,c,p,x,S,E=!1){this.text=new rc(n?n.text:null,c,p,S),this.icon=new rc(n?n.icon:null,c,x,S),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ra{constructor(n,c,p,x=!1){this.text=n,this.icon=c,this.skipFade=p,this.clipped=x}}class um{constructor(){this.invProjMatrix=i.bz(),this.viewportMatrix=i.bz(),this.circles=[]}}class Th{constructor(n,c,p,x,S){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=S}}class or{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[n]}}function Un(f,n,c,p,x){const{horizontalAlign:S,verticalAlign:E}=i.bT(f),M=-(S-.5)*n,R=-(E-.5)*c,z=i.bU(f,p);return new i.P(M+z[0]*x,R+z[1]*x)}function Bn(f,n,c,p,x){const S=new i.P(f,n);return c&&S._rotate(p?x:-x),S}class na{constructor(n,c,p,x,S,E){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ad(this.transform,S),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new or(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,p,x,S=1){const E=p.getBucket(c),M=p.latestFeatureIndex;if(!E||!M||c.fqid!==E.layerIds[0])return;const R=E.layers[0].layout,z=E.layers[0].paint,j=p.collisionBoxArray,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),U=p.tileSize/i.aj,q=p.tileID.toUnwrapped();this.transform.setProjection(E.projection);const re=(Y=p.tileID,ne=E.getProjection(),oe=this.transform,ne.name===this.projection?oe.calculateProjMatrix(Y.toUnwrapped()):cm(oe,ne,Y));var Y,ne,oe;const ce=R.get("text-pitch-alignment")==="map",ge=R.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const xe=c.dynamicFilter(),Ce=c.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(p),Te=Rf(re,p.tileID.canonical,ce,ge,this.transform,E.getProjection(),Ae);let be=null;if(ce){const Je=bh(re,p.tileID.canonical,ce,ge,this.transform,E.getProjection(),Ae);be=i.az([],this.transform.labelPlaneMatrix,Je)}let Ie=null;xe&&p.latestFeatureIndex&&(Ie={unwrappedTileID:q,dynamicFilter:xe,dynamicFilterNeedsFeature:Ce}),this.retainedQueryData[E.bucketInstanceId]=new Th(E.bucketInstanceId,M,E.sourceLayerIndex,E.index,p.tileID);const[Re,Be]=E.layers[0].layout.get("text-size-scale-range"),Ge=i.ay(S,Re,Be),[st,it]=R.get("icon-size-scale-range"),mt=i.ay(S,st,it),Ue={bucket:E,layout:R,paint:z,posMatrix:re,textLabelPlaneMatrix:Te,labelToScreenMatrix:be,clippingData:Ie,scale:G,textPixelRatio:U,holdingForFade:p.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:i.bH(E.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:i.bH(E.iconSizeData,this.transform.zoom,mt),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Je of E.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:lt,symbolInstanceEnd:Ye}=Je;n.push({sortKey:Le,symbolInstanceStart:lt,symbolInstanceEnd:Ye,parameters:Ue})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce){const{textOffset0:ge,textOffset1:xe,crossTileID:Ce}=U,Ae=[ge,xe],Te=Un(n,p,x,Ae,S),be=this.collisionIndex.placeCollisionBox(re,S,c,Bn(Te.x,Te.y,E,M,this.transform.angle),G,R,z,j.predicate);if(ne){const Ie=re.getSymbolInstanceIconSize(ce,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Ie,ne,Bn(Te.x,Te.y,E,M,this.transform.angle),G,R,z,j.predicate).box.length===0)return}if(be.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(Ie=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:Ae,width:p,height:x,anchor:n,textScale:S,prevAnchor:Ie},this.markUsedJustification(re,n,U,Y),re.allowVerticalPlacement&&(this.markUsedOrientation(re,Y,U),this.placedOrientations[Ce]=Y),{shift:Te,placedGlyphBoxes:be}}}placeLayerBucketPart(n,c,p,x,S=1){const{bucket:E,layout:M,paint:R,posMatrix:z,textLabelPlaneMatrix:j,labelToScreenMatrix:G,clippingData:U,textPixelRatio:q,holdingForFade:re,collisionBoxArray:Y,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:oe,collisionGroup:ce,latestFeatureIndex:ge}=n.parameters,xe=M.get("text-optional"),Ce=M.get("icon-optional"),Ae=M.get("text-allow-overlap"),Te=M.get("icon-allow-overlap"),be=M.get("text-rotation-alignment")==="map",Ie=M.get("text-pitch-alignment")==="map",Re=R.get("symbol-z-offset"),Be=M.get("symbol-elevation-reference")==="sea",[Ge,st]=M.get("text-size-scale-range"),[it,mt]=M.get("icon-size-scale-range"),Ue=i.ay(S,Ge,st),Je=i.ay(S,it,mt);this.transform.setProjection(E.projection);let Le=Ae&&(Te||!E.hasIconData()||Ce),lt=Te&&(Ae||!E.hasTextData()||xe);const Ye=!Re.isConstant();!E.collisionArrays&&Y&&E.deserializeCollisionBoxes(Y),p&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,Y,Ue,Je);const pt=(ct,wt,Vt)=>{const{crossTileID:qt,numVerticalGlyphVertices:Bt}=ct;let Xt=null;if(U&&U.dynamicFilterNeedsFeature||Ye){const Gn=this.retainedQueryData[E.bucketInstanceId];Xt=ge.loadFeature({featureIndex:ct.featureIndex,bucketIndex:Gn.bucketIndex,sourceLayerIndex:Gn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(U&&!(0,U.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Xt,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new i.P(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData(U.unwrappedTileID)))return this.placements[qt]=new ra(!1,!1,!1,!0),void c.add(qt);const cr=Re.evaluate(Xt,{});if(c.has(qt))return;if(re)return void(this.placements[qt]=new ra(!1,!1,!1));let gr=!1,Or=!1,Qr=!0,wn=!1,oi=!1,Vn=null,Pn={box:null,offscreen:null,occluded:null},$i={box:null},Vr=null,en=null,un=null,ai=0,Ji=0,ui=0;Vt.textFeatureIndex?ai=Vt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(ai=ct.featureIndex),Vt.verticalTextFeatureIndex&&(Ji=Vt.verticalTextFeatureIndex);const Ln=Gn=>{Gn.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const hi=this.transform.elevation;Gn.elevation=Be?cr:cr+(hi?hi.getAtTileOffset(Gn.tileID,Gn.tileAnchorX,Gn.tileAnchorY):0),Gn.elevation+=ct.zOffset},Fi=Vt.textBox;if(Fi){Ln(Fi);const Gn=Xr=>{let Gi=i.bI.horizontal;if(E.allowVerticalPlacement&&!Xr&&this.prevPlacement){const Bs=this.prevPlacement.placedOrientations[qt];Bs&&(this.placedOrientations[qt]=Bs,Gi=Bs,this.markUsedOrientation(E,Gi,ct))}return Gi},hi=(Xr,Gi)=>{if(E.allowVerticalPlacement&&Bt>0&&Vt.verticalTextBox){for(const Bs of E.writingModes)if(Bs===i.bI.vertical?(Pn=Gi(),$i=Pn):Pn=Xr(),Pn&&Pn.box&&Pn.box.length)break}else Pn=Xr()};if(M.get("text-variable-anchor")){let Xr=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qt]){const wi=this.prevPlacement.variableOffsets[qt];Xr.indexOf(wi.anchor)>0&&(Xr=Xr.filter(Dn=>Dn!==wi.anchor),Xr.unshift(wi.anchor))}const Gi=(wi,Dn,Zo)=>{const Ro=E.getSymbolInstanceTextSize(ne,ct,this.transform.zoom,wt),Oa=(wi.x2-wi.x1)*Ro+2*wi.padding,ws=(wi.y2-wi.y1)*Ro+2*wi.padding,da=ct.hasIconTextFit&&!Te?Dn:null;da&&Ln(da);let Xo={box:[],offscreen:!1,occluded:!1};const Ko=Ae?2*Xr.length:Xr.length;for(let fa=0;fa<Ko;++fa){const pa=this.attemptAnchorPlacement(Xr[fa%Xr.length],wi,Oa,ws,Ro,be,Ie,q,z,ce,fa>=Xr.length,ct,wt,E,Zo,da,ne,oe);if(pa&&(Xo=pa.placedGlyphBoxes,Xo&&Xo.box&&Xo.box.length)){gr=!0,Vn=pa.shift;break}}return Xo};hi(()=>Gi(Fi,Vt.iconBox,i.bI.horizontal),()=>{const wi=Vt.verticalTextBox;return wi&&Ln(wi),E.allowVerticalPlacement&&!(Pn&&Pn.box&&Pn.box.length)&&Bt>0&&wi?Gi(wi,Vt.verticalIconBox,i.bI.vertical):{box:null,offscreen:null,occluded:null}}),Pn&&(gr=Pn.box,Qr=Pn.offscreen,wn=Pn.occluded);const Bs=Gn(!(!Pn||!Pn.box));if(!gr&&this.prevPlacement){const wi=this.prevPlacement.variableOffsets[qt];wi&&(this.variableOffsets[qt]=wi,this.markUsedJustification(E,wi.anchor,ct,Bs))}}else{const Xr=(Gi,Bs)=>{const wi=E.getSymbolInstanceTextSize(ne,ct,this.transform.zoom,wt,S),Dn=this.collisionIndex.placeCollisionBox(E,wi,Gi,new i.P(0,0),Ae,q,z,ce.predicate);return Dn&&Dn.box&&Dn.box.length&&(this.markUsedOrientation(E,Bs,ct),this.placedOrientations[qt]=Bs),Dn};hi(()=>Xr(Fi,i.bI.horizontal),()=>{const Gi=Vt.verticalTextBox;return E.allowVerticalPlacement&&Bt>0&&Gi?(Ln(Gi),Xr(Gi,i.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Gn(!!(Pn&&Pn.box&&Pn.box.length))}}if(Vr=Pn,gr=Vr&&Vr.box&&Vr.box.length>0,Qr=Vr&&Vr.offscreen,wn=Vr&&Vr.occluded,ct.useRuntimeCollisionCircles){const Gn=E.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),hi=i.bJ(E.textSizeData,ne,Gn),Xr=M.get("text-padding");en=this.collisionIndex.placeCollisionCircles(E,Ae,Gn,E.lineVertexArray,E.glyphOffsetArray,hi,z,j,G,p,Ie,ce.predicate,ct.collisionCircleDiameter*hi/i.bO,Xr,this.retainedQueryData[E.bucketInstanceId].tileID),gr=Ae||en.circles.length>0&&!en.collisionDetected,Qr=Qr&&en.offscreen,wn=en.occluded}if(Vt.iconFeatureIndex&&(ui=Vt.iconFeatureIndex),Vt.iconBox){const Gn=hi=>{Ln(hi);const Xr=ct.hasIconTextFit&&Vn?Bn(Vn.x,Vn.y,be,Ie,this.transform.angle):new i.P(0,0),Gi=E.getSymbolInstanceIconSize(oe,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Gi,hi,Xr,Te,q,z,ce.predicate)};$i&&$i.box&&$i.box.length&&Vt.verticalIconBox?(un=Gn(Vt.verticalIconBox),Or=un.box.length>0):(un=Gn(Vt.iconBox),Or=un.box.length>0),Qr=Qr&&un.offscreen,oi=un.occluded}const bn=xe||ct.numHorizontalGlyphVertices===0&&Bt===0,Bi=Ce||ct.numIconVertices===0;if(bn||Bi?Bi?bn||(Or=Or&&gr):gr=Or&&gr:Or=gr=Or&&gr,gr&&Vr&&Vr.box&&this.collisionIndex.insertCollisionBox(Vr.box,M.get("text-ignore-placement"),E.bucketInstanceId,$i&&$i.box&&Ji?Ji:ai,ce.ID),Or&&un&&this.collisionIndex.insertCollisionBox(un.box,M.get("icon-ignore-placement"),E.bucketInstanceId,ui,ce.ID),en&&(gr&&this.collisionIndex.insertCollisionCircles(en.circles,M.get("text-ignore-placement"),E.bucketInstanceId,ai,ce.ID),p)){const Gn=E.bucketInstanceId;let hi=this.collisionCircleArrays[Gn];hi===void 0&&(hi=this.collisionCircleArrays[Gn]=new um);for(let Xr=0;Xr<en.circles.length;Xr+=4)hi.circles.push(en.circles[Xr+0]),hi.circles.push(en.circles[Xr+1]),hi.circles.push(en.circles[Xr+2]),hi.circles.push(en.collisionDetected?1:0)}const mi=E.projection.name!=="globe";Le=Le&&(mi||!wn),lt=lt&&(mi||!oi),this.placements[qt]=new ra(gr||Le,Or||lt,Qr||E.justReloaded),c.add(qt)},It=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,It),E.elevationType==="road"&&E.updateRoadElevation(It.canonical),E.updateZOffset(),E.sortFeaturesByY){const ct=E.getSortedSymbolIndexes(this.transform.angle);for(let wt=ct.length-1;wt>=0;--wt){const Vt=ct[wt];pt(E.symbolInstances.get(Vt),Vt,E.collisionArrays[Vt])}E.hasAnyZOffset&&i.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const ct=E.getSortedIndexesByZOffset();for(let wt=0;wt<ct.length;++wt){const Vt=ct[wt];pt(E.symbolInstances.get(Vt),Vt,E.collisionArrays[Vt])}}else for(let ct=n.symbolInstanceStart;ct<n.symbolInstanceEnd;ct++)pt(E.symbolInstances.get(ct),ct,E.collisionArrays[ct]);if(p&&E.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[E.bucketInstanceId];i.bi(ct.invProjMatrix,z),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(n,c,p,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R,crossTileID:z}=p,j=i.bV(c),G=x===i.bI.vertical?R:j==="left"?S:j==="center"?E:j==="right"?M:-1;S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=G>=0&&S!==G?0:z),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=G>=0&&E!==G?0:z),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:z),R>=0&&(n.text.placedSymbolArray.get(R).crossTileID=G>=0&&R!==G?0:z)}markUsedOrientation(n,c,p){const x=c===i.bI.horizontal||c===i.bI.horizontalOnly?c:0,S=c===i.bI.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z}=p,j=n.text.placedSymbolArray;E>=0&&(j.get(E).placedOrientation=x),M>=0&&(j.get(M).placedOrientation=x),R>=0&&(j.get(R).placedOrientation=x),z>=0&&(j.get(z).placedOrientation=S)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(n):1,S=c?c.opacities:{},E=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const R in this.placements){const z=this.placements[R],j=S[R];j?(this.opacities[R]=new Al(j,x,z.text,z.icon,null,z.clipped),p=p||z.text!==j.text.placed||z.icon!==j.icon.placed):(this.opacities[R]=new Al(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const R in S){const z=S[R];if(!this.opacities[R]){const j=new Al(z,x,!1,!1);j.isHidden()||(this.opacities[R]=j,p=p||z.text.placed||z.icon.placed)}}for(const R in E)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=E[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);p?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c,p,x){const S=new Set;for(const E of c){const M=E.getBucket(n);M&&E.latestFeatureIndex&&n.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,S,E,E.collisionBoxArray,p,x,E.tileID,n.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,E.tileID),M.elevationType==="road"&&M.updateRoadElevation(E.tileID.canonical),M.updateZOffset())}}updateBucketOpacities(n,c,p,x,S,E,M,R){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const z=n.layers[0].layout,j=n.layers[0].paint,G=!!n.layers[0].dynamicFilter(),U=new Al(null,0,!1,!1,!0),q=z.get("text-allow-overlap"),re=z.get("icon-allow-overlap"),Y=z.get("text-variable-anchor"),ne=z.get("text-rotation-alignment")==="map",oe=z.get("text-pitch-alignment")==="map",ce=j.get("symbol-z-offset"),ge=z.get("symbol-elevation-reference")==="sea",xe=!ce.isConstant(),Ce=new Al(null,0,q&&(re||!n.hasIconData()||z.get("icon-optional")),re&&(q||!n.hasTextData()||z.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const Ae=(be,Ie,Re)=>{for(let Be=0;Be<Ie/4;Be++)be.opacityVertexArray.emplaceBack(Re)};let Te=0;E&&n.updateReplacement(M,E);for(let be=0;be<n.symbolInstances.length;be++){const Ie=n.symbolInstances.get(be),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Be,crossTileID:Ge,numIconVertices:st,tileAnchorX:it,tileAnchorY:mt}=Ie;let Ue=null;const Je=this.retainedQueryData[n.bucketInstanceId];xe&&Ie&&Je&&(Ue=p.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:Je.bucketIndex,sourceLayerIndex:Je.sourceLayerIndex,layoutVertexArrayOffset:0}));const Le=ce.evaluate(Ue,{}),lt=c.has(Ge);let Ye=this.opacities[Ge];lt?Ye=U:Ye||(Ye=Ce,this.opacities[Ge]=Ye),c.add(Ge);const pt=Re>0||Be>0,It=st>0,ct=this.placedOrientations[Ge],wt=ct===i.bI.vertical,Vt=ct===i.bI.horizontal||ct===i.bI.horizontalOnly;!pt&&!It||Ye.isHidden()||Te++;let qt=!1;if((pt||It)&&E)for(const Bt of n.activeReplacements){if(i.bP(Bt,S,i.bQ.Symbol,R)||Bt.min.x>it||it>Bt.max.x||Bt.min.y>mt||mt>Bt.max.y)continue;const Xt=i.bR(it,mt,M.canonical,Bt.footprintTileId.canonical);if(qt=i.bS(Xt,Bt.footprint),qt)break}if(pt){const Bt=qt?Vc:Bc(Ye.text);Ae(n.text,Re,wt?Vc:Bt),Ae(n.text,Be,Vt?Vc:Bt);const Xt=Ye.text.isHidden(),{leftJustifiedTextSymbolIndex:cr,centerJustifiedTextSymbolIndex:gr,rightJustifiedTextSymbolIndex:Or,verticalPlacedTextSymbolIndex:Qr}=Ie,wn=n.text.placedSymbolArray,oi=Xt||wt?1:0;cr>=0&&(wn.get(cr).hidden=oi),gr>=0&&(wn.get(gr).hidden=oi),Or>=0&&(wn.get(Or).hidden=oi),Qr>=0&&(wn.get(Qr).hidden=Xt||Vt?1:0);const Vn=this.variableOffsets[Ge];Vn&&this.markUsedJustification(n,Vn.anchor,Ie,ct);const Pn=this.placedOrientations[Ge];Pn&&(this.markUsedJustification(n,"left",Ie,Pn),this.markUsedOrientation(n,Pn,Ie))}if(It){const Bt=qt?Vc:Bc(Ye.icon),{placedIconSymbolIndex:Xt,verticalPlacedIconSymbolIndex:cr}=Ie,gr=n.icon.placedSymbolArray,Or=Ye.icon.isHidden()?1:0;Xt>=0&&(Ae(n.icon,st,wt?Vc:Bt),gr.get(Xt).hidden=Or),cr>=0&&(Ae(n.icon,Ie.numVerticalIconVertices,Vt?Vc:Bt),gr.get(cr).hidden=Or)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Bt=n.collisionArrays[be];if(Bt){let Xt=new i.P(0,0),cr=!0;if(Bt.textBox||Bt.verticalTextBox){if(Y){const Or=this.variableOffsets[Ge];Or?(Xt=Un(Or.anchor,Or.width,Or.height,Or.textOffset,Or.textScale),ne&&Xt._rotate(oe?this.transform.angle:-this.transform.angle)):cr=!1}G&&(cr=!Ye.clipped),Bt.textBox&&nc(n.textCollisionBox.collisionVertexArray,Ye.text.placed,!cr||wt,Le,ge,Xt.x,Xt.y),Bt.verticalTextBox&&nc(n.textCollisionBox.collisionVertexArray,Ye.text.placed,!cr||Vt,Le,ge,Xt.x,Xt.y)}const gr=cr&&!!(!Vt&&Bt.verticalIconBox);Bt.iconBox&&nc(n.iconCollisionBox.collisionVertexArray,Ye.icon.placed,gr,Le,ge,Ie.hasIconTextFit?Xt.x:0,Ie.hasIconTextFit?Xt.y:0),Bt.verticalIconBox&&nc(n.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!gr,Le,ge,Ie.hasIconTextFit?Xt.x:0,Ie.hasIconTextFit?Xt.y:0)}}}if(n.fullyClipped=Te===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function nc(f,n,c,p,x,S,E){f.emplaceBack(n?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(n?1:0,c?1:0,S||0,E||0,p,x?1:0)}const $n=Math.pow(2,25),Nf=Math.pow(2,24),Eh=Math.pow(2,17),Id=Math.pow(2,16),Co=Math.pow(2,9),hs=Math.pow(2,8),By=Math.pow(2,1);function Bc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*$n+n*Nf+c*Eh+n*Id+c*Co+n*hs+c*By+n}const Vc=0;class Md{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,p,x,S,E){const M=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(M,x,n[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<M.length;){const R=M[this._currentPartIndex];if(c.placeLayerBucketPart(R,this._seenCrossTileIDs,p,R.symbolInstanceStart===0,E),this._currentPartIndex++,S())return!0}return!1}}class Df{constructor(n,c,p,x,S,E,M,R,z){this.placement=new na(n,S,E,M,R,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,c,p,x,S){const E=i.q.now(),M=()=>{const R=i.q.now()-E;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=c[n[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){const j=R,G=j.layout.get("symbol-z-elevate"),U=j.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=j.layout.get("symbol-z-order"),re=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&U),Y=j.layout.get("text-allow-overlap")||j.layout.get("icon-allow-overlap")||j.layout.get("text-ignore-placement")||j.layout.get("icon-ignore-placement"),ne=re&&Y,oe=this._inProgressLayer=this._inProgressLayer||new Md(j),ce=i.C(R.source,R.scope);if(oe.continuePlacement(G||ne?x[ce]:p[ce],this.placement,this._showCollisionBoxes,R,M,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Ch=512/i.aj/2;class Of{constructor(n,c,p){this.tileID=n,this.bucketInstanceId=p,this.index=new i.bW(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=n.canonical.x*i.aj,S=n.canonical.y*i.aj;for(let E=0;E<c.length;E++){const{key:M,crossTileID:R,tileAnchorX:z,tileAnchorY:j}=c.get(E),G=Math.floor((x+z)*Ch),U=Math.floor((S+j)*Ch);this.index.add(G,U),this.keys.push(M),this.crossTileIDs.push(R)}this.index.finish()}findMatches(n,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),S=Ch/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*i.aj,M=c.canonical.y*i.aj;for(let R=0;R<n.length;R++){const z=n.get(R);if(z.crossTileID)continue;const{key:j,tileAnchorX:G,tileAnchorY:U}=z,q=Math.floor((E+G)*S),re=Math.floor((M+U)*S),Y=this.index.range(q-x,re-x,q+x,re+x).sort((ne,oe)=>ne-oe);for(const ne of Y){const oe=this.crossTileIDs[ne];if(this.keys[ne]===j&&!p.has(oe)){p.add(oe),z.crossTileID=oe;break}}}}}class Ao{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ic{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],S={};for(const E in x){const M=x[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),S[M.tileID.key]=M}this.indexes[p]=S}this.lng=n}addBucket(n,c,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const x=this.usedCrossTileIDs[n.overscaledZ];for(const S in this.indexes){const E=this.indexes[S];if(Number(S)>n.overscaledZ)for(const M in E){const R=E[M];R.tileID.isChildOf(n)&&R.findMatches(c.symbolInstances,n,x)}else{const M=E[n.scaledTo(Number(S)).key];M&&M.findMatches(c.symbolInstances,n,x)}}for(let S=0;S<c.symbolInstances.length;S++){const E=c.symbolInstances.get(S);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Of(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[n].delete(p)}removeStaleBuckets(n){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const S in x)n[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[S]),delete x[S],c=!0)}return c}}class Uo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,p,x){let S=this.layerIndexes[n.fqid];S===void 0&&(S=this.layerIndexes[n.fqid]=new ic);let E=!1;const M={};x.name!=="globe"&&S.handleWrapJump(p);for(const R of c){const z=R.getBucket(n);z&&n.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,z,this.crossTileIDs)&&(E=!0),M[z.bucketInstanceId]=!0)}return S.removeStaleBuckets(M)&&(E=!0),E}pruneUnusedLayers(n){const c={};n.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Cu=771;class ln{constructor(n,c,p,x){this.blendFunction=n,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}ln.Replace=[1,0,1,0],ln.disabled=new ln(ln.Replace,i.am.transparent,[!1,!1,!1,!1]),ln.unblended=new ln(ln.Replace,i.am.transparent,[!0,!0,!0,!0]),ln.alphaBlended=new ln([1,Cu,1,Cu],i.am.transparent,[!0,!0,!0,!0]),ln.alphaBlendedNonPremultiplied=new ln([770,Cu,770,Cu],i.am.transparent,[!0,!0,!0,!0]),ln.multiply=new ln([774,0,774,0],i.am.transparent,[!0,!0,!0,!0]);class Kt{constructor(n,c,p){this.func=n,this.mask=c,this.range=p}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const ia=7680;class Nr{constructor(n,c,p,x,S,E){this.test=n,this.ref=c,this.mask=p,this.fail=x,this.depthFail=S,this.pass=E}}Nr.disabled=new Nr({func:519,mask:0},0,0,ia,ia,ia);const as=1029,Ah=2305;class Ar{constructor(n,c,p){this.enable=n,this.mode=c,this.frontFace=p}}function Au(f,n){const c=i.c1(f,3);i.c3(f,n),i.c7(f,3,c)}function Iu(f,n){const c=i.b_([]);return i.b$(c,c,-n),i.c0(c,c,-f),c}function sc(f,n){const c=[f[0],f[1],0],p=[n[0],n[1],0];if(i.ae(c)>=1e-15){const E=i.au([],c);i.bY(p,E,i.bG(p,E)),n[0]=p[0],n[1]=p[1]}const x=i.bF([],n,f);if(i.bZ(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Iu(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),S)}Ar.disabled=new Ar(!1,as,Ah),Ar.backCCW=new Ar(!0,as,Ah),Ar.backCW=new Ar(!0,as,2304),Ar.frontCW=new Ar(!0,1028,2304),Ar.frontCCW=new Ar(!0,1028,Ah);class Mu{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof i.ac?n:new i.ac(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=i.bX(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(n)):0,S=i.ac.fromLngLat(n,x),E=[S.x-p.x,S.y-p.y,S.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=sc(E,c)}setPitchBearing(n,c){this.orientation=Iu(i.al(n),i.al(-c))}}class Ya{constructor(n,c){this._transform=i.bx([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new i.ac(n[0],n[1],n[2])}get position(){const n=i.c1(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&i.c7(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||i.b_([]),n&&Au(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=Iu(n,c),Au(this._transform,this._orientation)}forward(){const n=i.c1(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=i.c1(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=i.c1(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const p=new Float64Array(16);return i.bi(p,this.getWorldToCamera(n,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,c,p){const x=this.position;i.bY(x,x,-n);const S=new Float64Array(16);return i.bn(S,[p,p,p]),i.bo(S,S,x),S[10]*=c,S}getWorldToCamera(n,c){const p=new Float64Array(16),x=new Float64Array(4),S=this.position;return i.c2(x,this._orientation),i.bY(S,S,-n),i.c3(p,x),i.bo(p,p,S),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(n,c,p,x){const S=new Float64Array(16);return i.c4(S,n,c,p,x),S}getCameraToClipOrthographic(n,c,p,x,S,E){const M=new Float64Array(16);return i.c5(M,n,c,p,x,S,E),M}getDistanceToElevation(n,c=!1){const p=n===0?0:i.c6(n,c?i.aY(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Ya([...this.position],[...this.orientation])}}const Io={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class kd{constructor(n=0,c=0,p=0,x=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=p,this.right=x}interpolate(n,c,p){return c.top!=null&&n.top!=null&&(this.top=i.ai(n.top,c.top,p)),c.bottom!=null&&n.bottom!=null&&(this.bottom=i.ai(n.bottom,c.bottom,p)),c.left!=null&&n.left!=null&&(this.left=i.ai(n.left,c.left,p)),c.right!=null&&n.right!=null&&(this.right=i.ai(n.right,c.right,p)),this}getCenter(n,c){const p=i.ay((this.left+n-this.right)/2,0,n),x=i.ay((this.top+c-this.bottom)/2,0,c);return new i.P(p,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new kd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ms=15;class Lf{constructor(n,c,p,x,S,E,M){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ya,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Lf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ms}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(n||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aF(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.ce(this.projectionOptions);const p=this.getProjection(),x=!i.bv(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.ce({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bX(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cf(),i.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=i.ay(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=i.al(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,S=0;for(let E=0;E<c.length;E++){const M=new i.P(c[E][0]*this.width,p+c[E][1]*(this.height-p)),R=n.pointCoordinate(M);if(!R)continue;const z=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*z,S+=z}return S===0?NaN:x/S}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(n),S=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,S);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const x=i.ae(i.at([],this._camera.position,p));return i.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!i.ch(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];i.ci(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Mu;return c.position=new i.ac(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!i.cj(n))return!1;i.ck(n,n);const c=i.cl([],[0,0,-1],n),p=i.cl([],[0,-1,0],n);if(p[2]<0)return!1;const x=sc(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=i.ay(n[2],x/p,x/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,p){this._unmodified=!1,this._edgeInsets.interpolate(n,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new i.cm(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),x=this.pointCoordinate(new i.P(this.width,0)),S=this.pointCoordinate(new i.P(this.width,this.height)),E=this.pointCoordinate(new i.P(0,this.height)),M=Math.floor(Math.min(p.x,x.x,S.x,E.x)),R=Math.floor(Math.max(p.x,x.x,S.x,E.x)),z=1;for(let j=M-z;j<=R+z;j++)j!==0&&c.push(new i.cm(j,n))}return c}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,c,p){let x=[];const S=p!=null,E=!S;if(E&&this.zoom<c||S&&p[0]===0&&p[1]===0)return x;const M=new Set,R=(j,G,U,q,re)=>{const Y=i.cK(G,j,U,q,re);M.has(Y)||(x.push(new i.aM(j,G,U,q,re)),M.add(Y))};for(let j=0;j<n.length;j++){const G=n[j];if(E&&G.canonical.z!==c)continue;const U=G.canonical,q=G.overscaledZ,re=G.wrap,Y=1<<U.z,ne=U.x+1<Y,oe=U.x>0,ce=U.y+1<Y,ge=U.y>0,xe=G.wrap-(oe?0:1),Ce=G.wrap+(ne?0:1),Ae=oe?U.x-1:Y-1,Te=ne?U.x+1:0;if(S)p[0]<0?(R(q,Ce,U.z,Te,U.y),p[1]<0&&ce&&(R(q,re,U.z,U.x,U.y+1),R(q,Ce,U.z,Te,U.y+1)),p[1]>0&&ge&&(R(q,re,U.z,U.x,U.y-1),R(q,Ce,U.z,Te,U.y-1))):p[0]>0?(R(q,xe,U.z,Ae,U.y),p[1]<0&&ce&&(R(q,re,U.z,U.x,U.y+1),R(q,xe,U.z,Ae,U.y+1)),p[1]>0&&ge&&(R(q,re,U.z,U.x,U.y-1),R(q,xe,U.z,Ae,U.y-1))):p[1]<0&&ce?R(q,re,U.z,U.x,U.y+1):ge&&R(q,re,U.z,U.x,U.y-1);else{const be=G.visibleQuadrants;1&be&&(R(q,xe,U.z,Ae,U.y),ge&&(R(q,re,U.z,U.x,U.y-1),R(q,xe,U.z,Ae,U.y-1))),2&be&&(R(q,Ce,U.z,Te,U.y),ge&&(R(q,re,U.z,U.x,U.y-1),R(q,Ce,U.z,Te,U.y-1))),4&be&&(R(q,xe,U.z,Ae,U.y),ce&&(R(q,re,U.z,U.x,U.y+1),R(q,xe,U.z,Ae,U.y+1))),8&be&&(R(q,Ce,U.z,Te,U.y),ce&&(R(q,re,U.z,U.x,U.y+1),R(q,Ce,U.z,Te,U.y+1)))}}const z=[];for(const j of x)x.some(G=>j.isChildOf(G))||z.push(j);if(x=z.filter(j=>!n.some(G=>!!(j.overscaledZ<c&&G.isChildOf(j))||j.equals(G)||j.isChildOf(G))),E){const j=1<<c,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=[j*G.x,j*G.y],q=4,re=q*q;x=x.filter(Y=>{const ne=Y.canonical.x+.5-U[0],oe=Y.canonical.y+.5-U[1];return ne*ne+oe*oe<re})}return x}coveringTiles(n){let c=this.coveringZoomLevel(n);const p=c,x=this.elevation&&this.elevation.exaggeration(),S=x&&!n.isTerrainDEM,E=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const M=this.locationCoordinate(this.center),R=this.center.lat,z=1<<c,j=[z*M.x,z*M.y,0],G=this.projection.name==="globe",U=!G,q=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,U),re=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=z*i.c6(1,this.center.lat),ne=this._camera.position[2]/i.c6(1,this.center.lat),oe=[z*re.x,z*re.y,ne*(U?1:Y)],ce=G||x,ge=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),xe=this.isLODDisabled(!0)?c:0;let Ce;if(this._elevation&&n.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();Ce=Le?Le.max:this._centerAltitude}else Ce=this._centerAltitude;const Ae=n.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?i.co(this):1,be=Le=>{const Ye=new i.ac(Le.x+25e-6,Le.y,Le.z),pt=new i.ac(Le.x,Le.y+25e-6,Le.z),It=Le.toLngLat(),ct=Ye.toLngLat(),wt=pt.toLngLat(),Vt=this.locationCoordinate(It),qt=this.locationCoordinate(ct),Bt=this.locationCoordinate(wt),Xt=Math.hypot(qt.x-Vt.x,qt.y-Vt.y),cr=Math.hypot(Bt.x-Vt.x,Bt.y-Vt.y);return Math.sqrt(Xt*cr)*Te/25e-6},Ie=Le=>{const lt=Ce,Ye=Ae;return{aabb:i.cr(this,z,0,0,0,Le,Ye,lt,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:lt,wrap:Le,fullyVisible:!1}},Re=[];let Be=[];const Ge=c,st=n.reparseOverscaled?p:c,it=(ne-this._centerAltitude)*Y,mt=Le=>{if(!this._elevation||!Le.tileID||!E)return;const lt=this._elevation.getMinMaxForTile(Le.tileID),Ye=Le.aabb;lt?(Ye.min[2]=lt.min,Ye.max[2]=lt.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Le.shouldSplit=Je(Le),Le.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ue=(Le,lt)=>{if(.707*lt<Le)return 1;const Ye=lt/Le;return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)},Je=Le=>{if(Le.zoom<xe)return!0;if(Le.zoom===Ge)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const lt=Le.aabb.distanceX(oe),Ye=Le.aabb.distanceY(oe);let pt=it,It=1;if(G){pt=Le.aabb.distanceZ(oe);const cr=Math.pow(2,Le.zoom),gr=i.aY((Le.y+1)/cr),Or=i.aY(Le.y/cr),Qr=Math.min(Math.max(R,gr),Or),wn=i.cO(Qr)/i.cO(R);if(It=Qr===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wn/this._mercatorScaleRatio),this.zoom<=i.cL&&Le.zoom===Ge-1&&wn>=.9)return!0}else if(S&&(pt=Le.aabb.distanceZ(oe)*Y),this.projection.isReprojectedInTileSpace&&p<=5){const cr=Math.pow(2,Le.zoom),gr=be(new i.ac((Le.x+.5)/cr,(Le.y+.5)/cr));It=gr>.85?1:gr}if(!E){const cr=Math.sqrt(lt*lt+Ye*Ye+pt*pt);let gr=(1<<Ge-Le.zoom)*ge*It;return gr*=Ue(Math.max(pt,it),cr),cr<gr}let ct=Number.MAX_VALUE,wt=0;const Vt=Le.aabb.getCorners(),qt=[];for(const cr of Vt){i.at(qt,cr,oe),G||(S?qt[2]*=Y:qt[2]=it);const gr=i.bG(qt,this._camera.forward());gr<ct&&(ct=gr,wt=Math.abs(qt[2]))}let Bt=(1<<Ge-Le.zoom)*ge*It;if(Bt*=Ue(Math.max(wt,it),ct),ct<Bt)return!0;const Xt=Le.aabb.closestPoint(j);return Xt[0]===j[0]&&Xt[1]===j[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Re.push(Ie(-Le)),Re.push(Ie(Le));for(Re.push(Ie(0));Re.length>0;){const Le=Re.pop(),lt=Le.x,Ye=Le.y;let pt=Le.fullyVisible;const It=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!pt){let ct=ce?Le.aabb.intersects(q):Le.aabb.intersectsFlat(q);if(ct===0&&It()){const wt=new i.cp(Le.zoom,lt,Ye);ct=i.cq(this,z,wt,!0).intersects(q)}if(ct===0)continue;pt=ct===2}if(Le.zoom!==Ge&&Je(Le))for(let ct=0;ct<4;ct++){const wt=(lt<<1)+ct%2,Vt=(Ye<<1)+(ct>>1),qt={aabb:E?Le.aabb.quadrant(ct):i.cr(this,z,Le.zoom+1,wt,Vt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:wt,y:Vt,wrap:Le.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};S&&!G&&(qt.tileID=new i.aM(Le.zoom+1===Ge?st:Le.zoom+1,Le.wrap,Le.zoom+1,wt,Vt),mt(qt)),Re.push(qt)}else{const ct=Le.zoom===Ge?st:Le.zoom;if(n.minzoom&&n.minzoom>ct)continue;let wt=0;if(!pt){let Xt=ce?Le.aabb.intersectsPrecise(q):Le.aabb.intersectsPreciseFlat(q);if(Xt===0&&It()){const cr=new i.cp(Le.zoom,lt,Ye);Xt=i.cq(this,z,cr,!0).intersectsPrecise(q)}if(Xt===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(Le.aabb.center))wt=15;else for(let cr=0;cr<4;cr++)Le.aabb.quadrant(cr).intersects(q)!==0&&(wt|=1<<cr)}const Vt=j[0]-(.5+lt+(Le.wrap<<Le.zoom))*(1<<c-Le.zoom),qt=j[1]-.5-Ye,Bt=Le.tileID?Le.tileID:new i.aM(ct,Le.wrap,Le.zoom,lt,Ye);n.calculateQuadrantVisibility&&(Bt.visibleQuadrants=wt),Be.push({tileID:Bt,distanceSq:Vt*Vt+qt*qt})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,lt=this.horizonLineFromTop();Be=Be.filter(Ye=>{const pt=[0,0,0,1],It=[i.aj,i.aj,0,1],ct=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.aA(pt,pt,ct),i.aA(It,It,ct);const wt=i.cs([],pt,It),Vt=i.ct([],pt,It),qt=i.cM(wt,Vt);if(qt===0)return!0;let Bt=!1;const Xt=this._elevation;if(Xt&&qt>Le&&lt!==0){const cr=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let gr;n.isTerrainDEM||(gr=Xt.getMinMaxForTile(Ye.tileID)),gr||(gr={min:Ae,max:Ce});const Or=i.cu(this.rotation),Qr=[Or[0]*i.aj,Or[1]*i.aj,gr.max];i.ad(Qr,Qr,cr),Bt=(1-Qr[1])*this.height*.5<lt}return qt<Le||Bt})}return Be.sort((Le,lt)=>Le.distanceSq-lt.distanceSq).map(Le=>Le.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=i.ay(n.lat,-85.051129,i.cv),p=this.projection.project(n.lng,c);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let p,x;const S=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(c.x-S.x)/M,x=(c.y-S.y)/M}else{const M=this.pointCoordinate(c),R=this.pointCoordinate(S);p=M.x-R.x,x=M.y-R.y}const E=this.locationCoordinate(n);this.setLocation(new i.ac(E.x-p,E.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,c){return this.projection.locationPoint(this,n,c)}locationPoint3D(n,c){return this.projection.locationPoint(this,n,c,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,c){return this.coordinateLocation(this.pointCoordinate3D(n,c))}locationCoordinate(n,c){const p=c?i.c6(c,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new i.ac(x.x,x.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const p=c??this._centerAltitude,x=[n.x,n.y,0,1],S=[n.x,n.y,1,1];i.aA(x,x,this.pixelMatrixInverse),i.aA(S,S,this.pixelMatrixInverse);const E=S[3];i.cw(x,x,1/x[3]),i.cw(S,S,1/E);const M=x[2],R=S[2];return{p0:x,p1:S,t:M===R?0:(p-M)/(R-M)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return i.aA(c,c,this.pixelMatrixInverse),i.aA(p,p,this.pixelMatrixInverse),i.cw(c,c,1/c[3]),i.cw(p,p,1/p[3]),c[2]=i.c6(c[2],this._center.lat)*this.worldSize,p[2]=i.c6(p[2],this._center.lat)*this.worldSize,i.cw(c,c,1/this.worldSize),i.cw(p,p,1/this.worldSize),new i.av([c[0],c[1],c[2]],i.au([],i.at([],p,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:p,t:x}=n,S=i.c6(c[2],this._center.lat),E=i.c6(p[2],this._center.lat);return new i.ac(i.ai(c[0],p[0],x)/this.worldSize,i.ai(c[1],p[1],x)/this.worldSize,i.ai(S,E,x))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n,c){if(!this.elevation)return this.pointCoordinate(n,c);let p=this.projection.pointCoordinate3D(this,n.x,n.y);if(p)return new i.ac(p[0],p[1],p[2]);let x=0,S=this.horizonLineFromTop();if(n.y>S)return this.pointCoordinate(n,c);const E=.02*S,M=n.clone();for(let R=0;R<10&&S-x>E;R++){M.y=i.ai(x,S,.66);const z=this.projection.pointCoordinate3D(this,M.x,M.y);z?(S=M.y,p=z):x=M.y}return p?new i.ac(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=i.cx)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return i.aA(x,x,this.pixelMatrix),x[3]>0?new i.P(x[0]/x[3],x[1]/x[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new i.P(c,n)),E=this.pointLocation3D(new i.P(x,n)),M=this.pointLocation3D(new i.P(x,p)),R=this.pointLocation3D(new i.P(c,p));let z=Math.min(S.lng,E.lng,M.lng,R.lng),j=Math.max(S.lng,E.lng,M.lng,R.lng),G=Math.min(S.lat,E.lat,M.lat,R.lat),U=Math.max(S.lat,E.lat,M.lat,R.lat);const q=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,Y=(ne,oe,ce,ge,xe)=>{const Ce=(ne+ce)/2,Ae=(oe+ge)/2,Te=new i.P(Ce,Ae),{lng:be,lat:Ie}=this.pointLocation3D(Te),Re=Math.max(0,z-be,G-Ie,be-j,Ie-U);z=Math.min(z,be),j=Math.max(j,be),G=Math.min(G,Ie),U=Math.max(U,Ie),(xe<re||Re>q)&&(Y(ne,oe,Ce,Ae,xe+1),Y(Ce,Ae,ce,ge,xe+1))};if(Y(c,n,x,n,1),Y(x,n,x,p,1),Y(x,p,c,p,1),Y(c,p,c,n,1),this.projection.name==="globe"){const[ne,oe]=i.cy(this);ne?(U=90,j=180,z=-180):oe&&(G=-90,j=180,z=-180)}return new i.aG(new i.cd(z,G),new i.cd(j,U))}_getBoundsRectangular(n,c){const{top:p,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,M=new i.P(x,p),R=new i.P(E,p),z=new i.P(E,S),j=new i.P(x,S);let G=this.pointCoordinate(M,n),U=this.pointCoordinate(R,n);const q=this.pointCoordinate(z,c),re=this.pointCoordinate(j,c),Y=(ne,oe)=>(oe.y-ne.y)/(oe.x-ne.x);return G.y>1&&U.y>=0?G=new i.ac((1-re.y)/Y(re,G)+re.x,1):G.y<0&&U.y<=1&&(G=new i.ac(-re.y/Y(re,G)+re.x,0)),U.y>1&&G.y>=0?U=new i.ac((1-q.y)/Y(q,U)+q.x,1):U.y<0&&G.y<=1&&(U=new i.ac(-q.y/Y(q,U)+q.x,0)),new i.aG().extend(this.coordinateLocation(G)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((p,x)=>{if(x.dem){const S=x.dem.tree;p.min=Math.min(p.min,S.minimums[0]),p.max=Math.max(p.max,S.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-85.051129,this.maxLat=i.cv,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aD(this.minLng)*this.tileSize,this.worldMaxX=i.aD(this.maxLng)*this.tileSize,this.worldMinY=i.aH(this.maxLat)*this.tileSize,this.worldMaxY=i.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=n.canonical,S=1/this.height,E=this.cameraWorldSize,M=E/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*n.wrap)*M,z=x.y*M,j=this.point;j.x*=E/this.worldSize,j.y*=E/this.worldSize;const G=this.angle,U=Math.sin(-G),q=-Math.cos(-G);return p[c]={bearing:[U,q],center:[(j.x-R)*S,(j.y-z)*S],scale:M/i.aj*S},p[c]}calculateFogTileMatrix(n){const c=n.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return i.az(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(n,c=!1,p=!1){const x=n.key;let S;if(S=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,S[x])return S[x];const E=this.calculatePosMatrix(n,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.az(E,M,E),S[x]=new Float32Array(E),S[x]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=i.cz(n,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=i.bn([],[n,n,n]);return i.az(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=i.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),S=i.c6(1,this._center.lat);p[2]/=S,x[2]/=S,i.au(x,x);const E=n.raycast(p,x,n.exaggeration());if(E){const M=i.bE([],p,x,E),R=new i.ac(M[0],M[1],i.c6(M[2],i.aY(M[1]))),z=(R.z+i.ae([R.x-p[0],R.y-p[1],R.z-p[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,p=i.c6(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),S=c.getAtPointOrZero(new i.ac(...x)),E=this.pixelsPerMeter/this.worldSize*S,M=this._minimumHeightOverTerrain(),R=x[2]-E;if(R<=M)if(R<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),j=[x[0],x[1],z.z-x[2]],G=i.ae(j);j[2]-=(M-R)/this._pixelsPerMercatorPixel;const U=i.ae(j);if(U===0)return;i.bY(j,j,G/U*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const U=this.center;return U.lat=i.ay(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(U.lng=i.ay(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let S=0,E=p,M=x;const R=this.width/2,z=this.height/2,j=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-z<j&&(M=j+z),x+z>G&&(M=G-z),G-j<this.height&&(S=Math.max(S,this.height/(G-j)),M=(G+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,re=this.worldSize/2-(U+q)/2;E=(p+re+this.worldSize)%this.worldSize-re,E-R<U&&(E=U+R),E+R>q&&(E=q-R),q-U<this.width&&(S=Math.max(S,this.width/(q-U)),E=(q+U)/2)}E===p&&M===x||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(E,M))),S&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.c6(1,this.center.lat)/i.c6(1,i.cP));const x=i.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,S);let M;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-n.x/this.width,R[9]=2*n.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ie*this.aspect,Be=-Re,Ge=-Ie;Re-=n.x,Be-=n.x,Ie+=n.y,Ge+=n.y,M=this._camera.getCameraToClipOrthographic(Be,Re,Ge,Ie,this._nearZ,this._farZ),((st,it,mt,Ue)=>{for(let Je=0;Je<16;Je++)st[Je]=i.ai(it[Je],mt[Je],Ue)})(M,M,R,i.cN(this.pitch>=Ms?1:this.pitch/Ms))}else M=R;const z=i.cB([],R,E);let j=i.cB([],M,E);if(this.projection.isReprojectedInTileSpace){const Ie=this.locationCoordinate(this.center),Re=i.bx([]);i.bo(Re,Re,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),i.az(Re,Re,i.cC(this)),i.bo(Re,Re,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),i.az(j,j,Re),i.az(z,z,Re),this.inverseAdjustmentMatrix=i.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cE([],j,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=j,this.invProjMatrix=i.bi(new Float64Array(16),this.projMatrix),c){const Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-n.x/this.width,Ie[9]=2*n.y/this.height,this.expandedFarZProjMatrix=i.cB([],Ie,E)}else this.expandedFarZProjMatrix=this.projMatrix;const G=i.bi([],M);this.frustumCorners=i.cF.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const U=new Float32Array(16);i.bx(U),i.cE(U,U,[1,-1,1]),i.cG(U,U,this._pitch),i.by(U,U,this.angle);const q=i.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bw(q);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+re)/this.height,this.skyboxMatrix=i.az(U,q,U);const Y=this.point,ne=Y.x,oe=Y.y,ce=this.width%2/2,ge=this.height%2/2,xe=Math.cos(this.angle),Ce=Math.sin(this.angle),Ae=ne-Math.round(ne)+xe*ce+Ce*ge,Te=oe-Math.round(oe)+xe*ge+Ce*ce,be=new Float64Array(j);if(i.bo(be,be,[Ae>.5?Ae-1:Ae,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=be,j=i.bz(),i.cE(j,j,[this.width/2,-this.height/2,1]),i.bo(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=i.bz(),i.cE(j,j,[1,-1,1]),i.bo(j,j,[-1,-1,0]),i.cE(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=i.az(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},j=i.bi(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cH(this);const Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad(Ie,Ie,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[n,n,c];i.bY(S,S,x),i.bY(p,p,-1),i.cI(p,p,S);const E=i.bz();i.bo(E,E,p),i.cE(E,E,S),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,x)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*S,x.y/this.worldSize-p[1]*S,n/this.worldSize*this._centerAltitude-p[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=n[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((c-p)/x,1)),this._camera.position=i.bE([],this._camera.position,n,S),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),S=i.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.al(this._maxPitch)),M=Math.max((n[2]-S)/Math.cos(p),E),R=this._zoomFromMercatorZ(M);i.bE(n,n,c,M),this._pitch=i.ay(p,i.al(this.minPitch),i.al(this.maxPitch)),this.angle=i.bX(x,-Math.PI,Math.PI),this._setZoom(i.ay(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,p=i.cx,x=0,S=1/0;for(;p-c>1e-6&&p>c;){const E=c+.5*(p-c),M=this.tileSize*Math.pow(2,E),R=this.getCameraToCenterDistance(this.projection,E,M),z=this.scaleZoom(R/(Math.max(0,n)*this.tileSize)),j=Math.abs(E-z);j<S&&(S=j,x=E),E<z?c=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const p=Math.min(n.x,c.x),x=Math.max(n.x,c.x),S=Math.min(n.y,c.y),E=Math.max(n.y,c.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new i.P(p,S),new i.P(x,E),new i.P(p,E),new i.P(x,S)],R=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const j of M){const G=this.pointRayIntersection(j);if(G.t<0)return!0;const U=this.rayIntersectionCoordinate(G);if(U.x<R||U.y<0||U.x>z||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(n,c){const p=i.ae(i.at([],this._camera.position,n)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([c,p,x],S){const E=[c,p,x,1];i.aA(E,E,S);const M=E[3]=Math.max(E[3],1e-6);return E[0]/=M,E[1]/=M,E[2]/=M,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,n))}}getCameraToCenterDistance(n,c=this.zoom,p=this.worldSize){const x=i.cA(n,c,this.width,this.height,1024),S=n.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(E=i.ai(1,E,i.cN(this.pitch>=Ms?1:this.pitch/Ms))),E}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.az(n,n,this.globeMatrix),n}getFrustum(n){return i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const sa=(f,n)=>{if(n>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?i.af(60,45,c.pitch):i.af(30,15,c.pitch),S=c._farZ-c._nearZ,E=n*c.height,M=((1-(R=x))*c.cameraToCenterDistance+R*(c._farZ+E))*p;var R;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(M-c._nearZ)/S,(M-E-c._nearZ)/S]}}},ks={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Pd{constructor(n,c){this.aabb=n,this.lastCascade=c}}class zf{add(n,c){const p=this.receivers[n.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[n.key]=new Pd(c,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,c,p){const x=i.cW.fromPoints(n.points);let S=0;for(const E in this.receivers){const M=this.receivers[E];if(!M||!x.intersectsAabb(M.aabb))continue;M.aabb.min=x.closestPoint(M.aabb.min),M.aabb.max=x.closestPoint(M.aabb.max);const R=M.aabb.getCorners();for(let z=0;z<p.length;z++){let j=!0;for(const G of R){const U=[G[0]*c,G[1]*c,G[2]];if(i.ad(U,U,p[z].matrix),U[0]<-1||U[0]>1||U[1]<-1||U[1]>1){j=!1;break}}if(M.lastCascade=z,S=Math.max(S,z),j)break}}return S+1}}class Vy{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new zf,this._depthMode=new Kt(n.context.gl.LEQUAL,Kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),n.tp.registerParameter(ks,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(ks,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(ks,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce((re,Y)=>{const ne=p.style._mergedLayers[Y];return re+(ne.hasShadowPass()&&!ne.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const S=p.context,E=ks.shadowMapResolution,M=ks.shadowMapResolution;if(this._cascades.length===0||ks.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<ks.cascadeCount;++re){const Y=p._shadowMapDebug,ne=S.gl,oe=S.createFramebuffer(E,M,Y,"texture"),ce=new i.T(S,{width:E,height:M,data:null},ne.DEPTH_COMPONENT16);if(oe.depthAttachment.set(ce.texture),Y){const ge=new i.T(S,{width:E,height:M,data:null},ne.RGBA8);oe.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:oe,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cn,scale:0})}}this.shadowDirection=Uc(c);let R=0;if(n.elevation){const re=n.elevation,Y=[1e4,-1e4];re.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const oe=ne.dem.tree;Y[0]=Math.min(Y[0],oe.minimums[0]),Y[1]=Math.max(Y[1],oe.maximums[0])}),Y[0]!==1e4&&(R=(Y[1]-Y[0])*re.exaggeration())}const z=1.5*n.cameraToCenterDistance,j=3*z,G=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const Y=this._cascades[re];let ne=n.height/50,oe=1;ks.cascadeCount===1?oe=j:re===0?oe=z:(ne=z,oe=j);const[ce,ge]=ku(n,this.shadowDirection,ne,oe,ks.shadowMapResolution,R);Y.scale=n.scale,Y.matrix=ce,Y.boundingSphereRadius=ge,i.bi(G,Y.matrix),Y.frustum=i.cn.fromInvProjectionMatrix(G,1,0,!0),Y.far=oe}const U=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[U].far,this._cascades[U].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ks.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ks.shadowMapResolution,this._uniformValues.u_shadowmap_0=Io.ShadowMap0,this._uniformValues.u_shadowmap_1=Io.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const re of this._groundShadowTiles){let Y={min:0,max:0};if(q){const ne=q.getMinMaxForTile(re);ne&&(Y=ne)}this.addShadowReceiver(re.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,ks.shadowMapResolution,ks.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){p.currentShadowCascade=S,x.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),x.clear({color:i.am.white,depth:1});for(const E of n.order){const M=n._mergedLayers[E];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const R=n.getLayerSourceCache(M),z=R?c[R.id]:void 0;(M.type==="model"||z&&z.length)&&p.renderLayer(p,R,M,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,c=n.style,p=n.context,x=p.gl,S=c.directionalLight,E=c.ambientLight;if(!S||!E)return;const M=[],R=sa(n,n.longestCutoffRange);R.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const z=ac(c,S,E),j=new Kt(x.LEQUAL,Kt.ReadOnly,n.depthRangeFor3D),G=new Nr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const U of this._groundShadowTiles){const q=U.toUnwrapped(),re=n.isTileAffectedByFog(U),Y=n.getOrCreateProgram("groundShadow",{defines:M,overrideFog:re});this.setupShadows(q,Y),n.uploadCommonUniforms(p,Y,q,null,R);const ne={u_matrix:n.transform.calculateProjMatrix(q),u_ground_shadow_factor:z};Y.draw(n,x.TRIANGLES,j,G,ln.multiply,Ar.disabled,ne,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ln.unblended:ln.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const c=this.painter.transform,p=c.calculatePosMatrix(n,c.worldSize);return i.az(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(n){return i.az(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,c,p,x=0){if(!this.enabled)return;const S=this.painter.transform,E=this.painter.context,M=E.gl,R=this._uniformValues,z=new Float64Array(16),j=S.calculatePosMatrix(n,S.worldSize);for(let G=0;G<this._cascades.length;G++)i.az(z,this._cascades[G].matrix,j),R[G===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),E.activeTexture.set(M.TEXTURE0+Io.ShadowMap0+G),this._cascades[G].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const G=i.cU(n.canonical),U=2/S.tileSize*i.aj/ks.shadowMapResolution,q=U*this._cascades[0].boundingSphereRadius,re=U*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(p==="vector-tile"?1:3)/Math.pow(2,x-n.canonical.z-(1-S.zoom+Math.floor(S.zoom)));R.u_shadow_normal_offset=[G,q*Y,re*Y],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(E,R)}setupShadowsFromMatrix(n,c,p=!1){if(!this.enabled)return;const x=this.painter.context,S=x.gl,E=this._uniformValues,M=new Float64Array(16);for(let R=0;R<ks.cascadeCount;R++)i.az(M,this._cascades[R].matrix,n),E[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),x.activeTexture.set(S.TEXTURE0+Io.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=p,p){const R=ks.normalOffset;E.u_shadow_normal_offset=[1,R,R],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,c,p,x){if(x[2]>=0)return{};const S=function(R,z,j){const G=j/(1<<R.canonical.z);return new i.cW([R.canonical.x*G+R.wrap*j,R.canonical.y*G+R.wrap*j,0],[(R.canonical.x+1)*G+R.wrap*j,(R.canonical.y+1)*G+R.wrap*j,z])}(n,c,p).getCorners(),E=c/-x[2];x[0]<0?(i.cV(S[0],S[0],[x[0]*E,0,0]),i.cV(S[3],S[3],[x[0]*E,0,0])):x[0]>0&&(i.cV(S[1],S[1],[x[0]*E,0,0]),i.cV(S[2],S[2],[x[0]*E,0,0])),x[1]<0?(i.cV(S[0],S[0],[0,x[1]*E,0]),i.cV(S[1],S[1],[0,x[1]*E,0])):x[1]>0&&(i.cV(S[2],S[2],[0,x[1]*E,0]),i.cV(S[3],S[3],[0,x[1]*E,0]));const M={};return M.vertices=S,M.planes=[oc(S[1],S[0],S[4]),oc(S[2],S[1],S[5]),oc(S[3],S[2],S[6]),oc(S[0],S[3],S[7])],M}addShadowReceiver(n,c,p){this._receivers.add(n,i.cW.fromTileIdAndHeight(n,c,p))}getMaxCascadeForTile(n){const c=this._receivers.get(n);return c&&c.lastCascade?c.lastCascade:0}}function oc(f,n,c){const p=i.at([],c,n),x=i.at([],f,n),S=i.bF([],p,x),E=i.ae(S);return E===0?[0,0,1,0]:(i.bY(S,S,1/E),[S[0],S[1],S[2],-i.bG(S,n)])}function Uc(f){const n=f.properties.get("direction"),c=i.cR(n.x,n.y,n.z);c[2]=i.ay(c[2],0,75);const p=i.cT([c[0],c[1],c[2]]);return i.cS(p.x,p.y,p.z)}function ac(f,n,c){const p=n.properties.get("color-use-theme")==="none",x=n.properties.get("color"),S=n.properties.get("intensity"),E=n.properties.get("direction"),M=[E.x,E.y,E.z],R=c.properties.get("color-use-theme")==="none",z=c.properties.get("color"),j=c.properties.get("intensity"),G=Math.max(i.bG([0,0,1],M),0),U=[0,0,0];i.bY(U,z.toPremultipliedRenderColor(R?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),j);const q=[0,0,0];return i.bY(q,x.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),G*S),i.cY([U[0]>0?U[0]/(U[0]+q[0]):0,U[1]>0?U[1]/(U[1]+q[1]):0,U[2]>0?U[2]/(U[2]+q[2]):0])}function ku(f,n,c,p,x,S){const E=f.zoom,M=f.scale,R=f.worldSize,z=1/R,j=f.aspect,G=Math.sqrt(1+j*j)*Math.tan(.5*f.fovX),U=G*G,q=p-c,re=p+c;let Y,ne;U>q/re?(Y=p,ne=p*G):(Y=.5*re*(1+U),ne=.5*Math.sqrt(q*q+2*(p*p+c*c)*U+re*re*U*U));const oe=f.projection.pixelsPerMeter(f.center.lat,R),ce=f._camera.getCameraToWorldMercator(),ge=[0,0,-Y*z];i.ad(ge,ge,ce);let xe=ne*z;const Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const pt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?oe:1),It=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);It[8]=2*-f.centerOffset.x/f.width,It[9]=2*f.centerOffset.y/f.height;const ct=new Float64Array(16);i.cB(ct,It,pt);const wt=new Float64Array(16);i.bi(wt,ct);const Vt=i.cn.fromInvProjectionMatrix(wt,R,E,!0);for(const qt of Vt.points){const Bt=((Ae=qt)[0]/=M,Ae[1]/=M,Ae[2]=i.c6(Ae[2],f._center.lat),Ae);xe=Math.max(xe,i.bZ(i.cX([],ge,Bt)))}}var Ae;xe*=x/(x-1);const Te=Math.acos(n[2]),be=Math.atan2(-n[0],-n[1]),Ie=new Ya;Ie.position=ge,Ie.setPitchBearing(Te,be);const Re=Ie.getWorldToCamera(R,oe),Be=xe*R,Ge=Math.min(f._mercatorZfromZoom(17)*R*-2,-2*Be),st=Ie.getCameraToClipOrthographic(-Be,Be,-Be,Be,Ge,(Be+S*oe)/n[2]),it=new Float64Array(16);i.az(it,st,Re);const mt=i.cS(Math.floor(1e6*ge[0])/1e6*R,Math.floor(1e6*ge[1])/1e6*R,0),Ue=.5*x,Je=[0,0,0];i.ad(Je,mt,it),i.bY(Je,Je,Ue);const Le=[Math.floor(Je[0]),Math.floor(Je[1]),Math.floor(Je[2])],lt=[0,0,0];i.at(lt,Je,Le),i.bY(lt,lt,-1/Ue);const Ye=new Float64Array(16);return i.bx(Ye),i.bo(Ye,Ye,lt),i.az(it,Ye,it),[it,Be]}class hm extends i.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,c){return i.aS(this.requestManager.transformRequest(c,i.R.Model).url).then(p=>{if(!p)return;const x=i.aT(p),S=new i.aU(n,void 0,void 0,x);return S.computeBoundsAndApplyParent(),S}).catch(p=>{if(p&&p.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${n} from ${c}: ${p.message}`)))})}load(n,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(n),S=[],E=[];for(const M of x){const R=n[M];this.hasURLBeenRequested(R)&&!p.forceReload||(this.modelByURL[R]={modelId:M,scope:c},S.push(this.loadModel(M,R)),E.push(M)),this.models[c][M]||(this.models[c][M]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+E.length,Promise.allSettled(S).then(M=>{for(let R=0;R<M.length;R++){const{status:z}=M[R];if(z==="rejected")continue;const{value:j}=M[R];this.models[c][E[R]]||(this.models[c][E[R]]={model:null,numReferences:1}),this.models[c][E[R]].model=j}this.numModelsLoading[c]-=E.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(M=>{this.fire(new i.z(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(n,c):this.getModelByURL(this.modelUris[c][n]))}getModel(n,c){return this.models[c]||(this.models[c]={}),this.models[c][n]?this.models[c][n].model:void 0}getModelByURL(n){if(!n)return null;const c=this.modelByURL[n];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(n,c){return this.models[c]&&this.models[c][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(n,p,{exactIdMatch:!0})||this.hasModelBeenAdded(n,p))&&this.modelUris[p][n]===x)this.models[p][n].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:S,modelId:E}=this.modelByURL[x];this.models[S][E].numReferences++}else this.modelUris[p][n]=x,this.load({[n]:this.modelUris[p][n]},p)}addModelURLs(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in n)p[x]=this.requestManager.normalizeModelURL(n[x])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of n)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&i.cZ(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,c,p=!1){if(this.models[c]&&this.models[c][n]&&(this.models[c][n].numReferences--,this.models[c][n].numReferences===0)){const x=this.modelUris[c][n];p||delete this.modelUris[c][n],delete this.modelByURL[x];const S=this.models[c][n].model;if(!S)return;delete this.models[c][n],S.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const c of Object.keys(this.models[n])){const p=this.models[n][c].model;delete this.models[n][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(n.context)}}const Rd=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),dm={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function lc(f){return f=f||{},Object.assign(f,dm)}class Uy extends i.E{constructor(n){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},i.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=n,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(n=>{n.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=n.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=n.stylesheet.indoor.buildingFeaturesetId,this._scope=n.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:n=>(n.feature&&n.feature.properties.floorplan&&this.selectFloorplan(n.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const n=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone"))};if(this._map.transform.zoom<13)return void n();const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=this._map.transform.width,x=this._map.transform.height,S=p*(2/3),E=x*(2/3),M=.5*(p-S),R=.5*(x-E),z=[new i.P(M,R),new i.P(M+S,R+E)],j=this._map.queryRenderedFeatures(z,c);j.length>0?this._selectedFloorplan&&j[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=j[0],this._floorplanSelected()):n()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const n=this._floorplanStates[this._indoorData.id].selectedBuilding,c=n?this._indoorData.buildings.find(M=>M.id===n):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,p=this._floorplanStates[this._indoorData.id].selectedLevel,x=this._indoorData.levels.find(M=>M.id===p),S=this._indoorData.levels.find(M=>!(!c||!c.levels)&&Number(M.levelOrder)===0&&c.levels.includes(M.id)),E=x?x.id:S?S.id:void 0;this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:E})),c&&this._buildingSelected(c,!1),E&&this._levelSelected(E)}_buildingSelected(n,c){if(!n||!n.id)return void console.warn("IndoorManager: Building or building id is undefined");c&&n.extent&&this._map.fitBounds(n.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=n?n.id:void 0;const p=this._indoorData.levels.filter(x=>n.levels.includes(x.id));this.fire(new i.A("buildingselected",{buildingId:n.id,levels:p}))}_levelSelected(n){const c=this._indoorData.levels.find(p=>p.id===n);c?(this._updateLevels(c,!0),this.fire(new i.A("levelselected",{levelId:c.id}))):console.warn(`IndoorManager: Level with ID ${n} not found in the current floorplan.`)}_updateLevels(n,c){if(!n||!n.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function p(z){const j=z.indexOf("/floor/");if(j===-1)return z;const G=j+7,U=z.indexOf("/",G);return U===-1?z.slice(G):z.slice(G,U)}this._floorplanStates[this._indoorData.id].selectedLevel=n.id;const x=[],S={},E={},M={},R={};for(const z of this._indoorData.levels){if(x.push(z.id),S[z.id]=z.levelOrder>=0?3*Math.abs(z.levelOrder+1):3*Math.abs(z.levelOrder),E[z.id]=z.levelOrder>=0?3*z.levelOrder:0,this.mergeFloors){const j=p(n.id),G=p(z.id);M[z.id]=G===j?"true":"false"}else M[z.id]=z.id===n.id?"true":"false";R[z.id]=z.levelOrder<n.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",n.levelOrder<0)}selectFloorplan(n){const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(p,c);if(x.length>0){for(const S of x)if(JSON.parse(S.properties["indoor-data"]).id===n){this._selectedFloorplan=S,this._floorplanSelected();break}}}selectBuilding(n){const c=this._indoorData.buildings.find(p=>p.id===n);this._buildingSelected(c,!0)}selectLevel(n){this._levelSelected(n)}}function $y(f){if(!f.metadata||!f.metadata.content_area)return;const n=i.q.devicePixelRatio,{left:c,top:p,width:x,height:S}=f.metadata.content_area,E=c*n,M=p*n;return[E,M,E+x*n,M+S*n]}function Cg(f){if(f)return f.map(([n,c])=>[n*i.q.devicePixelRatio,c*i.q.devicePixelRatio])}class Ja{constructor(n,c,p){this.id=n,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return n;const p=this.sourceCache.getSource();if(!(p instanceof kc))return n;const x=c.map(E=>this.sourceCache.getTile(E)),S=p.getImages(x,Array.from(this.pendingRequests));for(const[E,M]of S)n.set(i.I.from({name:E,iconsetId:this.id}),M),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),n}}const ul=(f,n)=>Ee(f,n&&n.filter(c=>c.identifier!=="source.canvas")),jf=i.aF(An,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),fm=i.aF(An,["setCenter","setZoom","setBearing","setPitch"]),Nd=new Set(["background","sky","slot","custom"]),Ff={version:8,layers:[],sources:{}},Dd={duration:300,delay:0};class xo extends i.E{constructor(n,c={}){super(),this.map=n,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=i.h({},Dd),this._buildingIndex=new xh(this),this.crossTileSymbolIndex=new Uo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new On,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.c$(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new $s(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.d0(n._requestManager,c.localFontFamily?i.d1.all:c.localIdeographFontFamily?i.d1.ideographs:i.d1.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new hm(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.d2());const p=this;this._rtlTextPluginCallback=xo.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,E)=>{if(i.d3(S),E&&E.every(M=>M))for(const M in p._sourceCaches){const R=p._sourceCaches[M],z=R.getSource().type;z!=="vector"&&z!=="geojson"||R.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.getOwnSource(x.sourceId);if(S&&S.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===S.id&&this._validateLayer(M)}})}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(i.j(n))return n;const c=i.d4(n);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.d5(JSON.stringify(n))}`}_diffStyle(n,c,p){this.globalId=this._getGlobalId(n);const x=(S,E)=>{try{E(null,this.setState(S,p))}catch(M){E(M,!1)}};if(typeof n=="string"){const S=this.map._requestManager.normalizeStyleURL(n),E=this.map._requestManager.transformRequest(S,i.R.Style);i.n(E,(M,R)=>{M?this.fire(new i.z(M)):R&&x(R,c)})}else typeof n=="object"&&x(n,c)}loadURL(n,c={}){this.fire(new i.A("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!i.j(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,c.accessToken),this.resolvedImports.add(n);const x=this.importsCache.get(n);if(x)return this._load(x,p);const S=this.map._requestManager.transformRequest(n,i.R.Style);this._request=i.n(S,(E,M)=>{if(this._request=null,E)this.fire(new i.z(E));else if(M)return this.importsCache.set(n,M),this._load(M,p)})}loadJSON(n,c={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=i.q.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Ff,!1)}_loadImports(n,c,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const S of n){const E=this._createFragmentStyle(S),M=new Promise(j=>{E.once("style.import.load",j),E.once("error",j)}).then(()=>this.mergeAll());if(x.push(M),this.resolvedImports.has(S.url)){E.loadEmpty();continue}const R=S.data||this.importsCache.get(S.url);R?(E.loadJSON(R,{validate:c}),this._isInternalStyle(R)&&(E.globalId=null)):S.url?E.loadURL(S.url,{validate:c}):E.loadEmpty();const z={style:E,id:S.id,config:S.config};if(p){const j=this.fragments.findIndex(({id:G})=>G===p);this.fragments=this.fragments.slice(0,j).concat(z).concat(this.fragments.slice(j))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(n=this,c=new Set){for(const p of n.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(n){const c=this.scope?i.C(n.id,this.scope):n.id;let p;const x=this._initialConfig&&this._initialConfig[c];(n.config||x)&&(p=i.h({},n.config,x));const S=new xo(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,c){const p=n.indoor?lc(n.schema):n.schema;if(this._isInternalStyle(n)){const E=i.h({},Ff,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(E,c)}if(this.updateConfig(this._config,p),c&&ul(this,Vi(n)))return;this._loaded=!0,this.stylesheet=i.d6(n);const x=()=>{for(const z in n.sources)this.addSource(z,n.sources[z],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const z in n.iconsets)this.addIconset(z,n.iconsets[z]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(n.glyphs);const E=Xa(this.stylesheet.layers);if(this._order=E.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new We(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={};for(const z of E){const j=i.db(z,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j;const G=this.getOwnLayerSourceCache(j),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&j.canCastShadows()&&U&&(G.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const R=this.isRootStyle();n.imports?this._loadImports(n.imports,c).then(()=>{this._reloadImports(),this.fire(new i.A(R?"style.load":"style.import.load"))}).catch(z=>{this.fire(new i.z(new Error("Failed to load imports",z))),this.fire(new i.A(R?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(R?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const S=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(S){const E=this._evaluateColorThemeData(S);this._loadColorTheme(E).then(()=>{x()}).catch(M=>{i.w(`Couldn't load color theme from the stylesheet: ${M}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,c,p,x,S,E,M,R,z,j;const G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(U=>{if(U.stylesheet){if(U.light!=null&&(n=U.light),U.stylesheet.lights)for(const q of U.stylesheet.lights)q.type==="ambient"&&U.ambientLight!=null&&(c=U.ambientLight),q.type==="directional"&&U.directionalLight!=null&&(p=U.directionalLight);x=this._prioritizeTerrain(x,U.terrain,U.stylesheet.terrain),U.stylesheet.fog&&U.fog!=null&&(S=U.fog),U.stylesheet.snow&&U.snow!=null&&(E=U.snow),U.stylesheet.rain&&U.rain!=null&&(M=U.rain),U.stylesheet.camera!=null&&(j=U.stylesheet.camera),U.stylesheet.projection!=null&&(R=U.stylesheet.projection),U.stylesheet.transition!=null&&(z=U.stylesheet.transition),G[U.scope]=U._styleColorTheme}}),this.light=n,this.ambientLight=c,this.directionalLight=p,this.fog=S,this.snow=E,this.rain=M,this._styleColorThemeForScope=G,x===null?delete this.terrain:this.terrain=x,this.camera=j||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=i.h({},Dd,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const c=p=>{for(const x of p.fragments)c(x.style);n(p)};c(this)}_prioritizeTerrain(n,c,p){const x=n&&n.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?n:null:c!=null&&(!n||x||c&&c.drapeRenderMode===1)?c:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{n=this._prioritizeTerrain(n,c.terrain,c.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(n=c.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){const n={},c={},p={};this.forEachFragmentStyle(x=>{for(const S in x._sourceCaches){const E=i.C(S,x.scope);n[E]=x._sourceCaches[S]}for(const S in x._otherSourceCaches){const E=i.C(S,x.scope);c[E]=x._otherSourceCaches[S]}for(const S in x._symbolSourceCaches){const E=i.C(S,x.scope);p[E]=x._symbolSourceCaches[S]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeLayers(){const n={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const E of S._order){const M=S._layers[E];if(M.type==="slot"){const R=i.d7(E);if(n[R])continue;n[R]=[]}M.slot&&n[M.slot]?n[M.slot].push(M):c.push(M)}}),this._mergedOrder=[];const x=(S=[])=>{for(const E of S)if(E.type==="slot"){const M=i.d7(E.id);n[M]&&x(n[M]),this._mergedSlots.push(M)}else{const M=i.C(E.id,E.scope);this._mergedOrder.push(M),p[M]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(c),this._mergedOrder.sort((S,E)=>{const M=p[S],R=p[E];return M.hasInitialOcclusionOpacityProperties?R.is3D(!!this.terrain)?1:0:M.is3D(!!this.terrain)&&R.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=i.h({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?function(c,p,x,S){const E=i.h({},p);for(const R of Object.keys(i.a5.colorTheme))E[R]===void 0&&(E[R]=i.a5.colorTheme[R].default);const M=new i.a6(Rd,c,new Map(x));return M.setTransitionOrValue(E,x),M.untransitioned().possiblyEvaluate(new i.aa(0,{worldview:void 0}))}(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const S="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=n;E.startsWith(S)||(E=S+E);const M=i.I.from("mapbox-reserved-lut"),R=new Image;R.src=E,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:j,data:G}=i.q.getImageData(R);if(j>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==j*j)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new i.r({width:z,height:j},G),pixelRatio:1,sdf:!1,usvg:!1,version:0});const U=this.imageManager.getImage(M,this.scope);U?(this._styleColorTheme.lut={image:U.data,data:n},p()):x(new Error("Missing LUT image."))}})}getLut(n){const c=this._styleColorThemeForScope[n];return c?c.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(c,p,x){let S,E,M;const R=i.q.devicePixelRatio>1?"@2x":"";let z=i.n(p.transformRequest(p.normalizeSpriteURL(c,R,".json"),i.R.SpriteJSON),(U,q)=>{z=null,M||(M=U,S=q,G())}),j=i.o(p.transformRequest(p.normalizeSpriteURL(c,R,".png"),i.R.SpriteImage),(U,q)=>{j=null,M||(M=U,E=q,G())});function G(){if(M)x(M);else if(S&&E){const U=i.q.getImageData(E),q={};for(const re in S){const{width:Y,height:ne,x:oe,y:ce,sdf:ge,pixelRatio:xe,stretchX:Ce,stretchY:Ae,content:Te}=S[re],be=new i.r({width:Y,height:ne});i.r.copy(U,be,{x:oe,y:ce},{x:0,y:0},{width:Y,height:ne},null),q[re]={data:be,pixelRatio:xe,sdf:ge,stretchX:Ce,stretchY:Ae,content:Te,usvg:!1}}x(null,q)}}return{cancel(){z&&(z.cancel(),z=null),j&&(j.cancel(),j=null)}}}(n,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new i.z(c));else if(p){const x=new Map;for(const S in p)x.set(i.I.from(S),p[S]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(n,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const S=new Ja(n,this.scope,p);this.imageManager.addImageProvider(S,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!i.j(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(S,E)=>{if(this._spriteRequest=null,S)c?this._loadSprite(n):this.fire(new i.z(S));else if(E){const M=new Map;for(const R in E)M.set(i.I.from(R),E[R]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.br((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(n),i.R.Iconset),(S,E)=>{if(S)return void x(S);const M={},R=i.c_(new i.bq(E));for(const z of R.icons){const j={version:1,pixelRatio:i.q.devicePixelRatio,content:$y(z),stretchX:z.metadata?Cg(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?Cg(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};M[z.name]=j}x(null,M)}))}_validateLayer(n){const c=this.getOwnSource(n.source);if(!c)return;const p=n.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.z(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,c)=>{const p=this.fragments[c];return p&&p.style&&(n.data=p.style.serialize()),n})}_serializeSources(){const n={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();n[p.id]||(n[p.id]=p.serialize())}return n}_serializeLayers(n){const c=[];for(const p of n){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const c=this.getOwnLayer(n);if(c)return c;this.fire(new i.z(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const c=this.getOwnSource(n);if(c)return c;this.fire(new i.z(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,c){const p=this.map.painter;if(p)for(let x=n.minzoom||0;x<(n.maxzoom||25.5);x++){const S=n.getProgramIds();if(S)for(const E of S){const M=n.getDefaultProgramParams(E,c.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(E,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(E,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(E,M)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const c=this.calculateLightsBrightness();n.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const R in M){const{updatedIds:z,removedIds:j}=M[R];(z||j)&&(this._updateWorkerLayers(R,z,j),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const S={};for(const M in this._mergedSourceCaches){const R=this._mergedSourceCaches[M];S[M]=R.used,R.used=!1,R.tileCoverLift=0}for(const M of this._mergedOrder){const R=this._mergedLayers[M];if(R.recalculate(n,this._availableImages),!R.isHidden(n.zoom)){const z=this.getLayerSourceCache(R);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,n)}):this.precompilePrograms(R,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const M of E)M.sourceCache.used=!0;for(const M in S){const R=this._mergedSourceCaches[M];S[M]!==R.used&&R.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const c of n){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const n={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;n[p]=n[p]||this._changes.getUpdatedImages(p),n[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n[p])}for(const c in n)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(n,c,p){const x=this.getFragmentStyle(n);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:n,removedIds:p||[],options:x.options})}setState(n,c){if(this._checkLoaded(),ul(this,Vi(n)))return!1;(n=i.d6(n)).layers=Xa(n.layers);const p=function(E,M){if(!E)return[{command:An.setStyle,args:[M]}];let R=[];try{if(!i.bv(E.version,M.version))return[{command:An.setStyle,args:[M]}];if(i.bv(E.center,M.center)||R.push({command:An.setCenter,args:[M.center]}),i.bv(E.zoom,M.zoom)||R.push({command:An.setZoom,args:[M.zoom]}),i.bv(E.bearing,M.bearing)||R.push({command:An.setBearing,args:[M.bearing]}),i.bv(E.pitch,M.pitch)||R.push({command:An.setPitch,args:[M.pitch]}),i.bv(E.sprite,M.sprite)||R.push({command:An.setSprite,args:[M.sprite]}),i.bv(E.glyphs,M.glyphs)||R.push({command:An.setGlyphs,args:[M.glyphs]}),i.bv(E.imports,M.imports)||function(q=[],re=[],Y){re=re||[];const ne=(q=q||[]).map(Lc),oe=re.map(Lc),ce=q.reduce(zc,{}),ge=re.reduce(zc,{}),xe=ne.slice();let Ce,Ae,Te,be;for(Ce=0,Ae=0;Ce<ne.length;Ce++)Te=ne[Ce],ge.hasOwnProperty(Te)?Ae++:(Y.push({command:An.removeImport,args:[Te]}),xe.splice(xe.indexOf(Te,Ae),1));for(Ce=0,Ae=0;Ce<oe.length;Ce++)Te=oe[oe.length-1-Ce],xe[xe.length-1-Ce]!==Te&&(ce.hasOwnProperty(Te)?(Y.push({command:An.removeImport,args:[Te]}),xe.splice(xe.lastIndexOf(Te,xe.length-Ae),1)):Ae++,be=xe[xe.length-Ce],Y.push({command:An.addImport,args:[ge[Te],be]}),xe.splice(xe.length-Ce,0,Te));for(const Ie of re){const Re=ce[Ie.id];Re&&(delete Re.data,i.bv(Re,Ie)||Y.push({command:An.updateImport,args:[Ie.id,Ie]}))}}(E.imports,M.imports,R),i.bv(E.transition,M.transition)||R.push({command:An.setTransition,args:[M.transition]}),i.bv(E.light,M.light)||R.push({command:An.setLight,args:[M.light]}),i.bv(E.fog,M.fog)||R.push({command:An.setFog,args:[M.fog]}),i.bv(E.snow,M.snow)||R.push({command:An.setSnow,args:[M.snow]}),i.bv(E.rain,M.rain)||R.push({command:An.setRain,args:[M.rain]}),i.bv(E.projection,M.projection)||R.push({command:An.setProjection,args:[M.projection]}),i.bv(E.lights,M.lights)||R.push({command:An.setLights,args:[M.lights]}),i.bv(E.camera,M.camera)||R.push({command:An.setCamera,args:[M.camera]}),i.bv(E.iconsets,M.iconsets)||function(q,re,Y){let ne;for(ne in re=re||{},q=q||{})q.hasOwnProperty(ne)&&(re.hasOwnProperty(ne)||Y.push({command:An.removeIconset,args:[ne]}));for(ne in re){if(!re.hasOwnProperty(ne))continue;const oe=re[ne];q.hasOwnProperty(ne)?i.bv(q[ne],oe)||(Y.push({command:An.removeIconset,args:[ne]}),Y.push({command:An.addIconset,args:[ne,oe]})):Y.push({command:An.addIconset,args:[ne,oe]})}}(E.iconsets,M.iconsets,R),!i.bv(E["color-theme"],M["color-theme"]))return[{command:An.setStyle,args:[M]}];const z={},j=[];(function(q,re,Y,ne){let oe;for(oe in re=re||{},q=q||{})q.hasOwnProperty(oe)&&(re.hasOwnProperty(oe)||Cl(oe,Y,ne));for(oe in re){if(!re.hasOwnProperty(oe))continue;const ce=re[oe];q.hasOwnProperty(oe)?i.bv(q[oe],ce)||(q[oe].type==="geojson"&&ce.type==="geojson"&&Eg(q,re,oe)?Y.push({command:An.setGeoJSONSourceData,args:[oe,ce.data]}):Td(oe,re,Y,ne)):Sd(oe,re,Y)}})(E.sources,M.sources,j,z);const G=[];E.layers&&E.layers.forEach(q=>{q.source&&z[q.source]?R.push({command:An.removeLayer,args:[q.id]}):G.push(q)});let U=E.terrain;U&&z[U.source]&&(R.push({command:An.setTerrain,args:[void 0]}),U=void 0),R=R.concat(j),i.bv(U,M.terrain)||R.push({command:An.setTerrain,args:[M.terrain]}),function(q,re,Y){re=re||[];const ne=(q=q||[]).map(Lc),oe=re.map(Lc),ce=q.reduce(zc,{}),ge=re.reduce(zc,{}),xe=ne.slice(),Ce=Object.create(null);let Ae,Te,be,Ie,Re,Be,Ge;for(Ae=0,Te=0;Ae<ne.length;Ae++)be=ne[Ae],ge.hasOwnProperty(be)?Te++:(Y.push({command:An.removeLayer,args:[be]}),xe.splice(xe.indexOf(be,Te),1));for(Ae=0,Te=0;Ae<oe.length;Ae++)be=oe[oe.length-1-Ae],xe[xe.length-1-Ae]!==be&&(ce.hasOwnProperty(be)?(Y.push({command:An.removeLayer,args:[be]}),xe.splice(xe.lastIndexOf(be,xe.length-Te),1)):Te++,Be=xe[xe.length-Ae],Y.push({command:An.addLayer,args:[ge[be],Be]}),xe.splice(xe.length-Ae,0,be),Ce[be]=!0);for(Ae=0;Ae<oe.length;Ae++)if(be=oe[Ae],Ie=ce[be],Re=ge[be],!Ce[be]&&!i.bv(Ie,Re))if(i.bv(Ie.source,Re.source)&&i.bv(Ie["source-layer"],Re["source-layer"])&&i.bv(Ie.type,Re.type)){for(Ge in Oc(Ie.layout,Re.layout,Y,be,null,An.setLayoutProperty),Oc(Ie.paint,Re.paint,Y,be,null,An.setPaintProperty),i.bv(Ie.slot,Re.slot)||Y.push({command:An.setSlot,args:[be,Re.slot]}),i.bv(Ie.filter,Re.filter)||Y.push({command:An.setFilter,args:[be,Re.filter]}),i.bv(Ie.minzoom,Re.minzoom)&&i.bv(Ie.maxzoom,Re.maxzoom)||Y.push({command:An.setLayerZoomRange,args:[be,Re.minzoom,Re.maxzoom]}),Ie)Ie.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Oc(Ie[Ge],Re[Ge],Y,be,Ge.slice(6),An.setPaintProperty):i.bv(Ie[Ge],Re[Ge])||Y.push({command:An.setLayerProperty,args:[be,Ge,Re[Ge]]}));for(Ge in Re)Re.hasOwnProperty(Ge)&&!Ie.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Oc(Ie[Ge],Re[Ge],Y,be,Ge.slice(6),An.setPaintProperty):i.bv(Ie[Ge],Re[Ge])||Y.push({command:An.setLayerProperty,args:[be,Ge,Re[Ge]]}))}else Y.push({command:An.removeLayer,args:[be]}),Be=xe[xe.lastIndexOf(be)+1],Y.push({command:An.addLayer,args:[Re,Be]})}(G,M.layers,R)}catch(z){console.warn("Unable to compute style diff:",z),R=[{command:An.setStyle,args:[M]}]}return R}(this.serialize(),n).filter(E=>!(E.command in fm));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in jf));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const S=[];return p.forEach(E=>{S.push(this[E.command](...E.args))}),c&&Promise.all(S).then(c).catch(c),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){for(const[c,p]of n.entries()){if(this.getImage(c))return this.fire(new i.z(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(n,c){return this.getImage(n)?this.fire(new i.z(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(n,c,p=!1){this.imageManager.updateImage(n,this.scope,c),p&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new i.A("data",{dataType:"style"})),this}addModel(n,c,p={}){return this._checkLoaded(),this._validate(ve,`models.${n}`,c,null,p)||(this.modelManager.addModel(n,c,this.scope),this.fire(new i.A("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,c,p={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Is,`sources.${n}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Pc(n,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const S=E=>{const M=(E?"symbol:":"other:")+x.id,R=i.C(M,this.scope),z=this._sourceCaches[M]=new ro(R,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};S(!1),c.type!=="vector"&&c.type!=="geojson"||S(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const c=this.getOwnSource(n);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new i.z(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new i.z(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([S,E])=>E.type==="source"&&E.source===n);if(x)return this.fire(new i.z(new Error(`Source "${n}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(n);for(const x of p){const S=i.d7(x.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(x.id),x.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getOwnSource(n).setData(c),this._changes.setDirty()}getOwnSource(n){const c=this.getOwnSourceCache(n);return c&&c.getSource()}getOwnSources(){const n=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&n.push(p.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const c in n){const p=n[c]._tiles;for(const x in p){const S=p[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const S of n){if(this._validate(Ga,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(S),E.updateTransitions(c)}else this.ambientLight=new Fn(S,Hr||(Hr=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(S),E.updateTransitions(c)}else this.directionalLight=new Fn(S,ni||(ni=new i.a7({direction:new i.an(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new i.aa(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,c=this.ambientLight;if(!n||!c)return;const p=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),x=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),S=n.properties.get("intensity"),E=n.properties.get("direction"),M=1-i.cR(E.x,E.y,E.z)[2]/90,R=p(x)*S*M,z=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),j=c.properties.get("intensity"),G=p(z)*j;return Number(((R+G)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(i.d8(n)){const c=i.d9(n),p=this.fragments.find(({id:S})=>S===c);if(!p)return;const x=i.d7(n);return p.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:p})=>p===n);return c?c.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const c={},p=(x,S="")=>`${x}::${S}`;this._featuresetSelectors={};for(const x in n){const S=this._featuresetSelectors[x]=[];for(const E of n[x].selectors){if(E.featureNamespace){const R=this.getOwnLayer(E.layer);if(!R){i.w(`Layer is undefined for selector: ${E.layer}`);continue}const z=p(R.source,R.sourceLayer);if(z in c&&c[z]!==E.featureNamespace){i.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[z]=E.featureNamespace}let M;if(E.properties)for(const R in E.properties){const z=i.X(E.properties[R]);z.result==="success"&&(M=M||{},M[R]=z.value)}S.push({layerId:E.layer,namespace:E.featureNamespace,properties:M,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const c=this.getFragmentStyle(n);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(n,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[n])return this.fire(new i.z(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const E of x[n].selectors){const M=p.getOwnLayer(E.layer);M&&S.push(M)}return S}getConfigProperty(n,c){const p=this.getFragmentStyle(n);if(!p)return null;const x=i.C(c,p.scope),S=p.options.get(x),E=S?S.value||S.default:null;return E?E.serialize():null}setConfigProperty(n,c,p){const x=this.getFragmentStyle(n);if(!x)return;const S=x.stylesheet.indoor?lc(x.stylesheet.schema):x.stylesheet.schema;if(!S||!S[c])return;const E=i.X(p);if(E.result!=="success")return void ul(this,E.value);const M=E.value.expression,R=i.C(c,x.scope),z=x.options.get(R);if(!z)return;let j;const{minValue:G,maxValue:U,stepValue:q,type:re,values:Y}=S[c],ne=i.X(S[c].default);ne.result==="success"&&(j=ne.value.expression),j?(this.options.set(R,Object.assign({},z,{value:M,default:j,minValue:G,maxValue:U,stepValue:q,type:re,values:Y})),this.updateConfigDependencies(c)):this.fire(new i.z(new Error(`No schema defined for the config option "${c}" in the "${n}" fragment.`)))}getConfig(n){const c=this.getFragmentStyle(n);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const S in p){const E=i.C(S,c.scope),M=c.options.get(E),R=M?M.value||M.default:null;x[S]=R?R.serialize():null}return x}setConfig(n,c){const p=this.getFragmentStyle(n);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const c=this.getFragmentStyle(n);return c?c.stylesheet.schema:null}setSchema(n,c){const p=this.getFragmentStyle(n);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(n,c){if(this._config=n,n||c)if(c)for(const p in c){let x,S;const E=i.X(c[p].default);if(E.result==="success"&&(x=E.value.expression),n&&n[p]!==void 0){const U=i.X(n[p]);U.result==="success"&&(S=U.value.expression)}const{minValue:M,maxValue:R,stepValue:z,type:j,values:G}=c[p];if(x){const U=i.C(p,this.scope);this.options.set(U,{default:x,value:S,minValue:M,maxValue:R,stepValue:z,type:j,values:G})}else this.fire(new i.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const c of this._configDependentLayers){const p=this.getLayer(c);if(p){if(n&&!p.configDependencies.has(n))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(n,c,p={}){this._checkLoaded();const x=n.id;if(this._layers[x])return void this.fire(new i.z(new Error(`Layer with id "${x}" already exists on this map`)));let S;if(n.type==="custom"){if(ul(this,i.da(n)))return;S=i.db(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=i.d6(n),n=i.h(n,{source:x})),this._validate(Sn,`layers.${x}`,n,{arrayIndex:-1},p))return;S=i.db(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid);let E=this._order.length;if(c){const j=this._order.indexOf(c);if(j===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));S.slot===this._layers[c].slot?E=j:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=S;const M=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&S.canCastShadows()&&R&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(S);if(z&&S.source&&M&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const j=i.C(S.source,S.scope);z.type!==S.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),M.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(n,c){this._checkLoaded();const p=this._checkLayer(n);if(!p||n===c)return;const x=this._order.indexOf(n);this._order.splice(x,1);let S=this._order.length;if(c){const E=this._order.indexOf(c);if(E===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?S=E:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const c=this._checkLayer(n);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(n);this._order.splice(p,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let S=!1;for(const E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){S=!0;break}x.castsShadows=S}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,p){this._checkLoaded();const x=this._checkLayer(n);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,c){this._checkLoaded();const p=this._checkLayer(n);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(n,c,p={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!i.bv(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(Ke,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=i.d6(c),this._updateLayer(x)))}getFilter(n){const c=this._checkLayer(n);if(c)return i.d6(c.filter)}setLayoutProperty(n,c,p,x={}){this._checkLoaded();const S=this._checkLayer(n);if(S&&!i.bv(S.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&ul(S,ue.call(Vi,{key:`layers.${n}.layout.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(c,p),S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)}}getLayoutProperty(n,c){const p=this._checkLayer(n);if(p)return p.getLayoutProperty(c)}setPaintProperty(n,c,p,x={}){this._checkLoaded();const S=this._checkLayer(n);if(!S||i.bv(S.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&ul(S,le.call(Vi,{key:`layers.${n}.paint.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:i.a5})))return;const E=S.setPaintProperty(c,p);S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),E&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(n,c){const p=this._checkLayer(n);if(p)return p.getPaintProperty(c)}setFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:R,importId:z}=n.target,j=this.getFragmentStyle(z),G=j.getFeaturesetLayers(R);for(const{source:U,sourceLayer:q}of G)j.setFeatureState({id:n.id,source:U,sourceLayer:q},c)}else if("layerId"in n.target){const{layerId:R}=n.target,z=this.getLayer(R);this.setFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=n.source,x=n.sourceLayer,S=this._checkSource(p);if(!S)return;const E=S.type;if(E==="geojson"&&x)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const R of M)R.setFeatureState(x,n.id,c)}removeFeatureState(n,c){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:R,importId:z}=n.target,j=this.getFragmentStyle(z),G=j.getFeaturesetLayers(R);for(const{source:U,sourceLayer:q}of G)j.removeFeatureState({id:n.id,source:U,sourceLayer:q},c)}else if("layerId"in n.target){const{layerId:R}=n.target,z=this.getLayer(R);this.removeFeatureState({id:n.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=n.source,x=this._checkSource(p);if(!x)return;const S=x.type,E=S==="vector"?n.sourceLayer:void 0;if(S==="vector"&&!E)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const R of M)R.removeFeatureState(E,n.id,c)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let S;if("featuresetId"in n.target){const{featuresetId:E,importId:M}=n.target,R=this.getFragmentStyle(M),z=R.getFeaturesetLayers(E);for(const{source:j,sourceLayer:G}of z){const U=R.getFeatureState({id:n.id,source:j,sourceLayer:G});if(U&&!S)S=U;else if(!i.bv(S,U))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:E}=n.target,M=this.getLayer(E);S=this.getFeatureState({id:n.id,source:M.source,sourceLayer:M.sourceLayer})}return S}const c=n.source,p=n.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return n.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,n.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=i.h({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return i.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),c=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return i.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(n){for(const c of Object.values(this._mergedLayers))n(c)&&this._updateLayer(c)}_updateLayer(n){this._changes.updateLayer(n);const c=this.getLayerSourceCache(n),p=i.C(n.source,n.scope),x=this._changes.getUpdatedSourceCaches();n.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=M=>this._mergedLayers[M].is3D(!!this.terrain),p=this.order,x={},S=[];for(let M=p.length-1;M>=0;M--){const R=p[M];if(c(R)){x[R]=M;for(const z of n){const j=z[R];if(j)for(const G of j)S.push(G)}}}S.sort((M,R)=>R.intersectionZ-M.intersectionZ);const E=[];for(let M=p.length-1;M>=0;M--){const R=p[M];if(c(R))for(let z=S.length-1;z>=0;z--){const j=S[z].feature;if(j.layer&&x[j.layer.id]<M)break;E.push(j),S.pop()}else for(const z of n){const j=z[R];if(j)for(const G of j)E.push(G.feature)}}return E}queryRenderedFeatures(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b3(c.filter));const S={},E=j=>{if(Nd.has(j.type))return;const G=this.getOwnLayerSourceCache(j),U=S[G.id]=S[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};j.is3D(!!this.terrain)&&(U.has3DLayers=!0),U.layers[j.fqid]=U.layers[j.fqid]||{styleLayer:j,targets:[]},U.layers[j.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const j of c.layers){const G=this._layers[j];if(!G)return this.fire(new i.z(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];E(G)}}else for(const j in this._layers)E(this._layers[j]);const M=this._queryRenderedFeatures(n,S,p),R=this._flattenAndSortRenderedFeatures(M),z=[];for(const j of R)i.dd(j.layer.id)===this.scope&&z.push(j);return z}queryRenderedFeatureset(n,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b3(c.filter));const S="mock",E=[];if(c&&c.target)E.push(Object.assign({},c,{targetId:S,filter:x}));else{const j=this.getFeaturesetDescriptors();for(const G of j)E.push({targetId:S,filter:x,target:G});for(const{style:G}of this.fragments){const U=G.getFeaturesetDescriptors();for(const q of U)E.push({targetId:S,filter:x,target:q})}}const M=this.queryRenderedTargets(n,E,p),R=[],z=new Set;for(const j of M)for(const G of j.variants[S])Nc(G,j,z)||R.push(new i.de(j,G));return R}queryRenderedTargets(n,c,p){const x={},S=(M,R,z,j)=>{const G=x[R.id]=x[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(G.layers[M.fqid]=G.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(G.has3DLayers=!0),!j)return z.uniqueFeatureID=!1,void G.layers[M.fqid].targets.push(z);G.layers[M.fqid].targets.push(Object.assign({},z,{namespace:j.namespace,properties:j.properties,uniqueFeatureID:j.uniqueFeatureID}))};for(const M of c)if("featuresetId"in M.target){const{featuresetId:R,importId:z}=M.target,j=this.getFragmentStyle(z);if(!j||!j._featuresetSelectors)continue;const G=j._featuresetSelectors[R];if(!G){this.fire(new i.z(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const U of G){const q=j.getOwnLayer(U.layerId);q&&!Nd.has(q.type)&&S(q,j.getOwnLayerSourceCache(q),M,U)}}else if("layerId"in M.target){const{layerId:R}=M.target,z=this.getLayer(R);if(!z||Nd.has(z.type))continue;S(z,this.getLayerSourceCache(z),M)}const E=this._queryRenderedFeatures(n,x,p);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(n,c,p){const x=[],S=!!this.map._showQueryGeometry,E=Nn.createFromScreenPoints(n,p);for(const M in c){const R=yu(E,c[M],this._availableImages,p,S);Object.keys(R).length&&x.push(R)}if(this.placement)for(const M in c){if(!c[M].sourceCache._onlySymbols)continue;const R=_u(E.screenGeometry,c[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&x.push(R)}return x}querySourceFeatures(n,c){const p=c&&c.filter;p&&this._validate(Ke,"querySourceFeatures.filter",p,null,c);let x=[];const S=this.getOwnSourceCaches(n);for(const E of S)x=x.concat(bd(E,c));return x}addSourceType(n,c,p){return xo.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(xo.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,c,p={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const M in n)if(!i.bv(n[M],x[M])){S=!0;break}if(!S)return;const E=this._getTransitionParameters();this.light.setLight(n,c,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,c=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=n;const x=n.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=i.d6(p),p=i.h(p,{source:M})}const S=i.h({},p),E={};if(this.terrain&&x){S.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(E.style=M.serialize())}if(this._validate(Ot,"terrain",S,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new i.A("data",{dataType:"style"}))}else{const S=this.terrain,E=S.get();for(const M of Object.keys(i.a5.terrain))!p.hasOwnProperty(M)&&i.a5.terrain[M].default&&(p[M]=i.a5.terrain[M].default);for(const M in n)if(!i.bv(n[M],E[M])){S.set(n,this.options),this.stylesheet.terrain=n;const R=this._getTransitionParameters({duration:0});S.updateTransitions(R),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new mr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(n){const c=this.snow=new gn(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(n){const c=this.rain=new bi(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.bv(c.get(),n)){c.set(n,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.bv(c.get(),n)){c.set(n,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.bv(c.get(),n)){c.set(n,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void n();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new i.A("colorthemeset")),n()}).catch(x=>{i.w(`Couldn't set color theme: ${x}`)})}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,c){const p=this.getFragmentStyle(n);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(n){return{now:i.q.now(),transition:i.h(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?n.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const p=this.terrain=new je(n,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,p,x,S={}){if(S&&S.validate===!1)return!1;const E=i.h({},this.serialize());return ul(this,n.call(Vi,i.h({key:c,style:E,value:p,styleSpec:i.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const c=this.getSourceCaches(n);for(const p of c)p.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){const c=this.getSourceCaches(n);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(n=>{n.modelManager.reloadModels(n.scope)})}updateSources(n){let c;this.directionalLight&&(c=Uc(this.directionalLight));const p=new Set;for(const x in this._mergedLayers){const S=this._mergedLayers[x];S.hasElevation()&&!p.has(S.source)&&p.add(S.source)}for(const x in this._mergedSourceCaches){const S=this._mergedSourceCaches[x],E=p.has(S._source.id);S.update(n,void 0,void 0,c,E)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,p,x,S,E,M=!1){let R=!1,z=!1;const j={},G={};for(const U of this._mergedOrder){const q=this._mergedLayers[U];if(q.type!=="symbol")continue;const re=i.C(q.source,q.scope);let Y=j[re];if(!Y){const oe=this.getLayerSourceCache(q);if(!oe)continue;const ce=oe.getRenderableIds(!0).map(ge=>oe.getTileByID(ge));G[re]=ce.slice(),Y=j[re]=ce.sort((ge,xe)=>xe.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(xe.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(q,Y,c.center.lng,c.projection);R=R||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),c.zoom))&&(this.pauseablePlacement=new Df(c,this._mergedOrder,M,p,x,S,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,G,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R){this._buildingIndex.onNewFrame(c.zoom);for(let U=0;U<this._mergedOrder.length;U++){const q=this._mergedLayers[this._mergedOrder[U]];if(q.type!=="symbol")continue;const re=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,j[i.C(q.source,q.scope)],U,re?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:S})=>S===n.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!c)return p.push(n),this._loadImports([n],!0);const x=p.findIndex(({id:S})=>S===c);return x===-1&&this.fire(new i.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(n).concat(p.slice(x)),this._loadImports([n],!0,c)}updateImport(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);return x===-1?this:typeof c=="string"?(this.setImportUrl(n,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(n,c.url),i.bv(c.config,p[x].config)||this.setImportConfig(n,c.config,c.data.schema),i.bv(c.data,p[x].data)||this.setImportData(n,c.data),this)}moveImport(n,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(n);if(x===-1)return this;const S=this.getImportIndex(c);if(S===-1)return this;const E=p[x],M=this.fragments[x];return p=p.filter(({id:R})=>R!==n),this.fragments=this.fragments.filter(({id:R})=>R!==n),this.stylesheet.imports=p.slice(0,S).concat(E).concat(p.slice(S)),this.fragments=this.fragments.slice(0,S).concat(M).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(n,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(n);if(x===-1)return this;p[x].url=c;const S=this.fragments[x];return S.style=this._createFragmentStyle(p[x]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(c),this}setImportData(n,c){this._checkLoaded();const p=this.getImportIndex(n),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(n,x[p].url))}setImportConfig(n,c,p){this._checkLoaded();const x=this.getImportIndex(n),S=this.stylesheet.imports||[];if(x===-1)return this;c?S[x].config=c:delete S[x].config;const E=this.fragments[x];p&&E.style.stylesheet&&(E.style.stylesheet.schema=p);const M=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=c,E.style.updateConfig(c,M),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(n);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(n){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===n);return c===-1&&this.fire(new i.z(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),c}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&n.push(p.getSource())}return n}getSource(n,c){const p=this.getSourceCache(n,c);return p&&p.getSource()}getLayerSource(n){const c=this.getLayerSourceCache(n);return c&&c.getSource()}getSourceCache(n,c){const p=i.C(n,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(n){const c=i.C(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[n]&&c.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&c.push(this._mergedSymbolSourceCaches[n]),c}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const c in n){const p=n[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(n){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n,this.scope)}getImages(n,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=E=>{if(E){const M=c.images.map(R=>i.I.toString(R));E.setDependencies(c.tileID.key,c.type,M)}},S=i.C(c.source,c.scope);x(this._mergedOtherSourceCaches[S]),x(this._mergedSymbolSourceCaches[S])}rasterizeImages(n,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(n,c,p){this.glyphManager.getGlyphs(c.stacks,c.scope,p)}getResource(n,c,p){return i.dg(c,p)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this.getOwnSourceCaches(n);return c.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${n}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,c){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const p=n.type==="fill-extrusion"&&n.sourceLayer==="building",x=n.type==="building";if(n.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}xo.getSourceType=function(f){return kf[f]},xo.setSourceType=function(f,n){kf[f]=n},xo.registerForPluginStateChange=i.dh;var Od=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,$c=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ld=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Il="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Hc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Bf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,no=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ih=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,jt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Mh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ru=[];Ws(Od,Ru),Ws(Ld,Ru),Ws($c,Ru);const Nu={"_prelude_fog.vertex.glsl":Bf,"_prelude_terrain.vertex.glsl":Hc,"_prelude_shadow.vertex.glsl":jt,"_prelude_fog.fragment.glsl":Pu,"_prelude_shadow.fragment.glsl":Mh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":no,"_prelude_raster_particle.glsl":Ih},kh={};pn("",Hc),pn(Pu,Bf),pn(Mh,jt),pn(no,""),pn(Ih,"");const Ph=pn($c,Ld),hl=Od;var zd={background:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:pn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:pn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:pn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:pn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:pn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:pn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:pn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:pn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:pn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:pn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:pn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:pn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:pn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:pn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:pn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Il),skyboxGradient:pn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Il),skyboxCapture:pn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:pn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:pn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:pn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:pn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:pn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:pn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:pn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:pn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ws(f,n){const c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const S of x)n.includes(S)||n.push(S)}}function pn(f,n){const c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(z=>{const j=z.split(" ");return j[j.length-1]}),x=[...new Set(x)]);const S={},E=[],M=[];if(f=f.replace(c,(z,j)=>(M.push(j),"")),(n=n.replace(c,(z,j)=>(E.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...Ru];Ws(f,R),Ws(n,R);for(const z of[...E,...M])Nu[z]||console.error(`Undefined include: ${z}`),kh[z]||(kh[z]=[],Ws(Nu[z],kh[z])),R=[...R,...kh[z]];return{fragmentSource:f=f.replace(p,(z,j,G,U,q)=>(S[q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${G} ${U} ${q};
#else
uniform ${G} ${U} u_${q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${G} ${U} ${q} = u_${q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${G} ${U} ${q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(p,(z,j,G,U,q)=>{const re=U==="float"?"vec2":U,Y=q.match(/color/)?"color":re;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${G} ${U} a_${q};
#endif
`:S[q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${G} ${re} a_${q};
out ${G} ${U} ${q};
#else
uniform ${G} ${U} u_${q};
#endif
`:j==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${G} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);
#else
    ${G} ${U} ${q} = u_${q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${G} ${U} a_${q};
    out ${G} ${U} ${q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${G} ${re} a_${q};
#else
uniform ${G} ${U} u_${q};
#endif
`:j==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${G} ${U} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${G} ${re} a_${q};
#else
uniform ${G} ${U} u_${q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${G} ${U} ${q} = a_${q};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${G} ${U} ${q} = a_${q};
#else
    ${G} ${U} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${G} ${U} ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);
#else
    ${G} ${U} ${q} = u_${q};
#endif
`}),staticAttributes:x,usedDefines:R,vertexIncludes:E,fragmentIncludes:M}}class Gc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,p,x,S,E,M,R){this.context=n;let z=this.boundPaintVertexBuffers.length!==x.length;for(let G=0;!z&&G<x.length;G++)this.boundPaintVertexBuffers[G]!==x[G]&&(z=!0);let j=this.boundDynamicVertexBuffers.length!==M.length;for(let G=0;!j&&G<M.length;G++)this.boundDynamicVertexBuffers[G]!==M[G]&&(j=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||z||j||this.boundIndexBuffer!==S||this.boundVertexOffset!==E)this.freshBind(c,p,x,S,E,M,R);else{n.bindVertexArrayOES.set(this.vao);for(const G of M)G&&(G.bind(),R&&G.instanceCount&&G.setVertexAttribDivisor(n.gl,c,R));S&&S.dynamicDraw&&S.bind()}}freshBind(n,c,p,x,S,E,M){const R=n.numAttributes,z=this.context,j=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=E,c.enableAttributes(j,n),c.bind(),c.setVertexAttribPointers(j,n,S);for(const G of p)G.enableAttributes(j,n),G.bind(),G.setVertexAttribPointers(j,n,S);for(const G of E)G&&(G.enableAttributes(j,n),G.bind(),G.setVertexAttribPointers(j,n,S),M&&G.instanceCount&&G.setVertexAttribDivisor(j,n,M));x&&x.bind(),z.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Hy(f,n){const c=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new i.ac(0,p/c).toLngLat().lat,new i.ac(0,(p+1)/c).toLngLat().lat]}function Gy(f,n,c,p,x,S,E){const M=f.context,R=M.gl,z=c.hillshadeFBO;if(!z)return;f.prepareDrawTile();const j=f.isTileAffectedByFog(n),G=f.getOrCreateProgram("hillshade",{overrideFog:j});M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());const U=((ne,oe,ce,ge)=>{const xe=ce.paint.get("hillshade-shadow-color"),Ce=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ce.paint.get("hillshade-highlight-color"),Te=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=ce.paint.get("hillshade-accent-color"),Ie=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=ce.paint.get("hillshade-emissive-strength");let Be=i.al(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Be-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const st=ne.style.directionalLight.properties.get("direction"),it=i.cR(st.x,st.y,st.z);Be=i.al(it[1])}const Ge=!ne.options.moving;return{u_matrix:ge||ne.transform.calculateProjMatrix(oe.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Hy(0,oe.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Be],u_shadow:xe.toPremultipliedRenderColor(Ce?null:ce.lut),u_highlight:Ae.toPremultipliedRenderColor(Te?null:ce.lut),u_emissive_strength:Re,u_accent:be.toPremultipliedRenderColor(Ie?null:ce.lut)}})(f,c,p,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(M,G,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:re,tileBoundsSegments:Y}=f.getTileBoundsBuffers(c);G.draw(f,R.TRIANGLES,x,S,E,Ar.disabled,U,p.id,q,re,Y)}function qc(f,n,c){if(!n.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const S=c.getPixels();n.demTexture?n.demTexture.update(S,{premultiply:!1}):n.demTexture=new i.T(p,S,x.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function qy(f,n,c){const p=f.context,x=p.gl;if(!n.dem)return;const S=n.dem;if(p.activeTexture.set(x.TEXTURE1),qc(f,n,S),!n.demTexture)return;n.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=S.dim;p.activeTexture.set(x.TEXTURE0);let M=n.hillshadeFBO;if(!M){const U=new i.T(p,{width:E,height:E,data:null},x.RGBA8);U.bind(x.LINEAR,x.CLAMP_TO_EDGE),M=n.hillshadeFBO=p.createFramebuffer(E,E,!0,"renderbuffer"),M.colorAttachment.set(U.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:z,tileBoundsSegments:j}=f.getMercatorTileBoundsBuffers(),G=[];f.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(f,x.TRIANGLES,Kt.disabled,Nr.disabled,ln.unblended,Ar.disabled,((U,q)=>{const re=q.stride,Y=i.bz();return i.c5(Y,0,i.aj,-8192,0,0,1),i.bo(Y,Y,[0,-8192,0]),{u_matrix:Y,u_image:1,u_dimension:[re,re],u_zoom:U.overscaledZ}})(n.tileID,S),c.id,R,z,j),n.needsHillshadePrepare=!1}class Ni{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pm extends Ni{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class es extends Ni{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class mm extends Ni{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Vf extends Ni{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class jd extends Ni{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ag extends Ni{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Uf extends Ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Fd extends Ni{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Du extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Rh extends Ni{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class gm extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class ym extends Ni{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class $f extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class Hf extends Ni{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ml extends Ni{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class cc extends Ni{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Nh extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Dh extends Ni{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Wc extends Ni{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Gf=class extends Ni{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class _m extends Ni{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class xm extends Ni{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Oh extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class qf extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Lh extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class kl extends Ni{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Bd extends Ni{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Pl extends Ni{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class dl extends Ni{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class zh extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Rl extends Ni{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Nl extends Ni{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Ig extends Nl{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Mg extends Nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ou extends Nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Vd extends Mg{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Zc=(f,n,c)=>({u_matrix:f,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:c}),Lu=(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_frustum_tl:E,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:z,u_globe_pos:j,u_globe_radius:G,u_viewport:U,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:re});function jh(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const ka=new class{constructor(){this.operations={}}newMorphing(f,n,c,p,x){if(f in this.operations){const S=this.operations[f];S.to.tileID.key!==c.tileID.key&&(S.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Dl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ts(f,n,c){if(n===0)return 0;const p=n<1&&c===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*p}function rs(f,n){const c=1<<f.z;return!n&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}const oa=f=>({u_matrix:f});function bs(f,n,c,p,x){if(x>0){const S=i.q.now(),E=(S-f.timeAdded)/x,M=n?(S-n.timeAdded)/x:-1,R=c.getSource(),z=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),j=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),G=j&&f.refreshedUponExpiration?1:i.ay(j?E:1-M,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class $o extends ro{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new i.D(i.c$(),null),x=Pc("mock-dem",c,p,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Zs extends ro{constructor(n){const c=Pc("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new i.D(i.c$(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,p){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,E)=>{if(S[E.key]="",!this._tiles[E.key]){const M=new Dc(E,this._source.tileSize*E.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);M.state="loaded",this._tiles[E.key]=M}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class uc extends i.aM{constructor(n,c,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class io extends i.dt{constructor(n,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,S]=function(R){const z=new i.ba,j=new i.a_,G=131;z.reserve(17161),j.reserve(33800);const U=i.aj/128,q=i.aj+U/2,re=q+U;for(let ne=-64;ne<re;ne+=U)for(let oe=-64;oe<re;oe+=U){const ce=oe<0||oe>q||ne<0||ne>q?24575:0,ge=i.ay(Math.round(oe),0,i.aj),xe=i.ay(Math.round(ne),0,i.aj);z.emplaceBack(ge+ce,xe)}const Y=(ne,oe)=>{const ce=oe*G+ne;j.emplaceBack(ce+1,ce,ce+G),j.emplaceBack(ce+G,ce+G+1,ce+1)};for(let ne=1;ne<129;ne++)for(let oe=1;oe<129;oe++)Y(oe,ne);return[0,129].forEach(ne=>{for(let oe=0;oe<130;oe++)Y(oe,ne),Y(ne,oe)}),[z,j,32768]}(),E=n.context;this.gridBuffer=E.createVertexBuffer(p,i.bc.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=i.bd.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=i.bd.simpleSegment(0,0,p.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Zs(c.map),this.orthoMatrix=i.bz(),i.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.aj,0,i.aj,0,1);const M=E.gl;this._overlapStencilMode=new Nr({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $o(c.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,p){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const x=n.terrain.properties,S=n.terrain.drapeRenderMode===0,E=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const M=n.terrain&&n.terrain.scope,R=x.get("source"),z=S?this._mockSourceCache:n.getSourceCache(R,M);if(!z)return void i.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=z,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(c,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const c=this._previousCameraAltitude,p=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const S=n.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(S);let M=S-this._previousZoom;const R=this._previousUpdateTimestamp;let z=S;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(S-z)>.5&&(M=.5*(S-z+M)),M*x<0&&(z+=M)),this._evaluationZoom=z;const j=E.getExaggeration(z),G=j===E.getExaggeration(Math.max(0,z-.1));if(G&&Math.abs(j-this._exaggeration)<.01)return j;let U=Math.min(.1,.00375*(this._updateTimestamp-R));return(G||j<.1||Math.abs(M)<1e-4)&&(U=Math.min(.2,4*U)),i.ai(this._exaggeration,j,U)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(R=>{const z=c.getTileByID(R).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(R,z){const j=z.transform.pointCoordinate(z.transform.getCameraPoint()),G=new i.P(j.x,j.y);R.sort((U,q)=>{if(q.overscaledZ-U.overscaledZ)return q.overscaledZ-U.overscaledZ;const re=new i.P(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Y=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ne=G.mult(1<<U.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(re)-ne.distSqr(Y)})})(x,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const R in E){const z=E[R];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[R],S),z.usedForTerrain))continue;const j=n[R];z.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[c.id]=x.map(R=>new uc(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const z=this.terrainTileForTile[R.key];if(!z)continue;const j=z.tileID.key;j in M||(this._visibleDemTiles.push(z),M[j]=j)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),qc(this.painter,x,S))}}_prepareDemTileUniforms(n,c,p,x){if(!c||c.demTexture==null)return!1;const S=n.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-S.z),M=x||"";return p[`u_dem_tl${M}`]=[S.x*E%1,S.y*E%1],p[`u_dem_scale${M}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const S=x.dem.tree.minimums[0];return S>0&&n++,p+S},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new i.du({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new i.T(n,x,c.R32F,{premultiply:!1}),S}setupElevationDraw(n,c,p){const x=this.painter.context,S=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let M=null,R=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,re=p.morphing.dstDemTile;z=p.morphing.phase,q&&re&&(this._prepareDemTileUniforms(n,q,E,"_prev")&&(R=q),this._prepareDemTileUniforms(n,re,E)&&(M=re))}const j=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let G=null;var U;if(this.enabled?R&&M?(G=M.demTexture,x.activeTexture.set(S.TEXTURE4),R.demTexture.bind(j(R),S.CLAMP_TO_EDGE),E.u_dem_lerp=z):(M=this.terrainTileForTile[n.tileID.key],G=this._prepareDemTileUniforms(n,M,E)?M.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,x.activeTexture.set(S.TEXTURE2),G&&(E.u_dem_size=(U=G).size[0]===1?1:U.size[0]-2,G.bind(j(M),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,E),p&&p.useMeterToDem&&M){const q=(1<<M.tileID.canonical.z)*i.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,q)}}globeUniformValues(n,c,p){const x=n.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,i.aj,0),u_tile_br_up:x.upVector(c,i.aj,i.aj),u_tile_bl_up:x.upVector(c,0,i.aj),u_tile_up_scale:p?i.dv(1):x.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,p=this.painter.context;n.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,S,E,M,R){if(x.transform.projection.name==="globe")(function(z,j,G,U,q){const re=z.context,Y=re.gl;let ne,oe;const ce=z.transform,ge=i.dl(z,re,ce),xe=(st,it)=>{if(oe===it)return;const mt=[Dl[it],"PROJECTION_GLOBE_VIEW"];ge&&mt.push("CUSTOM_ANTIALIASING");const Ue=z.isTileAffectedByFog(st);ne=z.getOrCreateProgram("globeRaster",{defines:mt,overrideFog:Ue}),oe=it},Ce=z.colorModeForRenderPass(),Ae=new Kt(Y.LEQUAL,Kt.ReadWrite,z.depthRangeFor3D);ka.update(q);const Te=i.dm(ce),be=[i.aD(ce.center.lng),i.aH(ce.center.lat)],Ie=z.globeSharedBuffers,Re=[ce.width*i.q.devicePixelRatio,ce.height*i.q.devicePixelRatio],Be=Float32Array.from(ce.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const st=z.transform,it=ts(st.zoom,j.exaggeration(),j.sourceCache._source.tileSize);oe=-1;const mt=Y.TRIANGLES;for(const Ue of U){const Je=G.getTile(Ue),Le=Nr.disabled,lt=j.prevTerrainTileForTile[Ue.key],Ye=j.terrainTileForTile[Ue.key];jh(lt,Ye)&&ka.newMorphing(Ue.key,lt,Ye,q,250),re.activeTexture.set(Y.TEXTURE0),Je.texture&&Je.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const pt=ka.getMorphValuesForProxy(Ue.key),It=pt?1:0;pt&&i.L(Ge,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:i.dk(pt.phase)}});const ct=i.dn(Ue.canonical),wt=i.dp(ct.getCenter().lat),Vt=i.dq(Ue.canonical,ct,wt,st.worldSize/st._pixelsPerMercatorPixel),qt=i.bh(i.dr(Ue.canonical)),Bt=Lu(st.expandedFarZProjMatrix,Be,Te,qt,i.ah(st.zoom),be,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,Re,it,st._farZ,Vt);if(xe(Ue,It),ne&&(j.setupElevationDraw(Je,ne,Ge),z.uploadCommonUniforms(re,ne,Ue.toUnwrapped()),Ie)){const[Xt,cr,gr]=Ie.getGridBuffers(wt,it!==0);ne.draw(z,mt,Ae,Le,Ce,Ar.backCCW,Bt,"globe_raster",Xt,cr,gr)}}}if(Ie&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&st.push("CUSTOM_ANTIALIASING"),ne=z.getOrCreateProgram("globeRaster",{defines:st});for(const it of U){const{x:mt,y:Ue,z:Je}=it.canonical,Le=Ue===0,lt=Ue===(1<<Je)-1,[Ye,pt,It,ct]=Ie.getPoleBuffers(Je,!1);if(ct&&(Le||lt)){const wt=G.getTile(it);re.activeTexture.set(Y.TEXTURE0),wt.texture&&wt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let Vt=i.ds(Je,mt,ce);const qt=i.bh(i.dr(it.canonical)),Bt=(Xt,cr)=>Xt.draw(z,Y.TRIANGLES,Ae,Nr.disabled,Ce,Ar.disabled,Lu(ce.expandedFarZProjMatrix,Vt,Vt,qt,0,be,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Re,0,ce._farZ),"globe_pole_raster",cr,It,ct);j.setupElevationDraw(wt,ne,Ge),z.uploadCommonUniforms(re,ne,it.toUnwrapped()),Le&&z.renderDefaultNorthPole&&Bt(ne,Ye),lt&&z.renderDefaultSouthPole&&(Vt=i.cE(i.bz(),Vt,[1,-1,1]),Bt(ne,pt))}}}})(x,S,E,M,R);else{const z=x.context,j=z.gl;let G,U;const q=x.shadowRenderer,re=sa(x,x.longestCutoffRange),Y=Ce=>{if(U===Ce)return;const Ae=[];Ae.push(Dl[Ce]),re.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),q&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&Ae.push("NORMAL_OFFSET")),G=x.getOrCreateProgram("terrainRaster",{defines:Ae}),U=Ce},ne=x.colorModeForRenderPass(),oe=new Kt(j.LEQUAL,Kt.ReadWrite,x.depthRangeFor3D);ka.update(R);const ce=x.transform,ge=ts(ce.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let xe=[0,0,0];if(q){const Ce=x.style.directionalLight,Ae=x.style.ambientLight;Ce&&Ae&&(xe=ac(x.style,Ce,Ae))}{U=-1;const Ce=j.TRIANGLES,[Ae,Te]=[S.gridIndexBuffer,S.gridSegments];for(const be of M){const Ie=E.getTile(be),Re=Nr.disabled,Be=S.prevTerrainTileForTile[be.key],Ge=S.terrainTileForTile[be.key];jh(Be,Ge)&&ka.newMorphing(be.key,Be,Ge,R,250),z.activeTexture.set(j.TEXTURE0),Ie.texture&&Ie.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const st=ka.getMorphValuesForProxy(be.key),it=st?1:0;let mt;st&&(mt={morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:i.dk(st.phase)}});const Ue=Zc(be.projMatrix,rs(be.canonical,ce.renderWorldCopies)?ge/10:ge,xe);if(Y(it),!G)continue;S.setupElevationDraw(Ie,G,mt);const Je=be.toUnwrapped();q&&q.setupShadows(Je,G),x.uploadCommonUniforms(z,G,Je,null,re),G.draw(x,Ce,oe,Re,ne,Ar.backCCW,Ue,"terrain_raster",S.gridBuffer,Ae,Te)}}}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),M=c.style.order,R=[];let z=0;for(const j of S){const G=x.getTileByID(j.proxyTileKey),U=x.proxyCachedFBO[j.key]?x.proxyCachedFBO[j.key][n]:void 0,q=U!==void 0?x.renderCache[U]:this.pool[z++],re=U!==void 0;if(G.texture=q.tex,re&&!q.dirty){R.push(G.tileID);continue}let Y;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:i.am.transparent,stencil:0}),q.dirty=!1);for(let ne=E.start;ne<=E.end;++ne){const oe=c.style._mergedLayers[M[ne]];if(oe.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(oe),ge=ce?this.proxyToSource[j.key][ce.id]:[j];if(!ge)continue;const xe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(q,ge,oe,ce),Y=ce?ce.id:null),c.renderLayer(c,ce,oe,xe)}if(this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const oe=c.style._mergedLayers[M[ne]];if(oe.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(oe),ge=ce?this.proxyToSource[j.key][ce.id]:[j];if(!ge)continue;const xe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(q,ge,oe,ce),Y=ce?ce.id:null),c.renderLayer(c,ce,oe,xe)}this.renderedToTile?(q.dirty=!0,R.push(G.tileID)):re||--z,z===5&&(z=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(n){const c=n.order.length;let p=-1,x=c;for(let S=0;S<c;++S)this._style.isLayerDraped(n._mergedLayers[n.order[S]])?p=Math.max(p,S):x=Math.min(x,S);return x>p}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const E=S.tileID,M=1<<E.overscaledZ,{x:R,y:z}=E.canonical,j=R/M,G=(R+1)/M,U=z/M,q=(z+1)/M;return{minx:j,miny:U,maxx:G,maxy:q,t:S.dem.tree.raycastRoot(j,U,G,q,n,c,p),tile:S}});x.sort((S,E)=>(S.t!==null?S.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const S of x){if(S.t==null)return null;const E=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,n,c,p);if(E!=null)return E}return null}_createFBO(){const n=this.painter.context,c=n.gl,p=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const x=new i.T(n,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const S=n.createFramebuffer(p[0],p[1],!0,null);return S.colorAttachment.set(x.texture),S.depthAttachment=new Vd(n,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:S,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._mergedLayers[n],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const p of this._style.getSources())if(p instanceof Bo){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(S&&!c[S.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ab){c[S.id]=!0;for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][S.id];if(M)for(const R of M)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Gs){n=!0;break}if(!n)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(!S||c[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][S.id];if(R)for(const z of R){const j=bs(S.getTile(z),S.findLoadedParent(z,0),S,this.painter.transform,E);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(S.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,c=n.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,S=0,E=this._style._mergedLayers[n[S]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++S<c;)E=this._style._mergedLayers[n[S]];for(;S<c;++S){const M=this._style._mergedLayers[n[S]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?x===void 0&&(x=S):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),x!==void 0&&(p.push({start:x,end:S-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:S-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every(R=>R>M.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<E.length;++M){const R=Object.values(E[M]);c.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const M=p[E];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){const R=n[M.key],z=this.proxyToSource[M.key];let j=0;for(const G in z){const U=z[G],q=R[G];if(!q||q.length!==U.length||U.some((re,Y)=>re!==q[Y]||x[G]&&x[G].hasOwnProperty(re.key))){j=-1;break}++j}for(const G in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][G]].dirty=j<0||j!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((E,M)=>M.end-M.start-(E.end-E.start));for(const E of S)for(const M of p){if(c.proxyCachedFBO[M.key])continue;let R=c.renderCachePool.pop();R===void 0&&c.renderCache.length<50&&(R=c.renderCache.length,c.renderCache.push(this._createFBO())),R!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][E.start]=R,c.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,E=S.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Nr.disabled}_renderTileClippingMasks(n,c){const p=this.painter,x=this.painter.context,S=x.gl;p._tileClippingMaskIDs={},x.setColorMode(ln.disabled),x.setDepthMode(Kt.disabled);const E=p.getOrCreateProgram("clippingMask");for(const M of n){const R=p._tileClippingMaskIDs[M.key]=--c;E.draw(p,S.TRIANGLES,Kt.disabled,new Nr({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),ln.disabled,Ar.disabled,oa(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const p=[n.x,n.y,1,1];i.aA(p,p,c.pixelMatrixInverse),i.cw(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,S=i.c6(1,c.center.lat),E=[x[0],x[1],x[2]/S,0],M=i.cX([],p.slice(0,3),E);i.au(M,M);const R=this.raycast(E,M,this._exaggeration);return R!==null&&R?(i.bE(E,E,M,R),E[3]=E[2],E[2]*=S,E):null}_setupProxiedCoordsForOrtho(n,c,p){if(n.getSource()instanceof i.aP)return this._setupProxiedCoordsForImageSource(n,c,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],S=this.proxyCoords;for(let R=0;R<S.length;R++){const z=S[R],j=this._findTileCoveringTileID(z,n);if(j){const G=this._createProxiedId(z,j,p[z.key]&&p[z.key][n.id]);x.push(G),this.proxyToSource[z.key][n.id]=[G]}}let E=!1;const M=new Set;for(let R=0;R<c.length;R++){const z=n.getTile(c[R]);if(!z||!z.hasData())continue;const j=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==z.tileID.canonical.z){const G=this.proxyToSource[j.tileID.key][n.id],U=this._createProxiedId(j.tileID,z,p[j.tileID.key]&&p[j.tileID.key][n.id]);G?G.splice(G.length-1,0,U):this.proxyToSource[j.tileID.key][n.id]=[U];const q=this.proxyToSource[j.tileID.key][n.id];M.has(q)||M.add(q),x.push(U),E=!0}}if(this._sourceTilesOverlap[n.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const R of M)R.sort((z,j)=>j.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(n,c,p){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],S=this.proxyCoords,E=n.getSource(),M=E.tileID;if(!M)return;const R=new i.P(M.x,M.y)._div(1<<M.z),z=E.coordinates.map(i.ac.fromLngLat).reduce((G,U)=>(G.min.x=Math.min(G.min.x,U.x-R.x),G.min.y=Math.min(G.min.y,U.y-R.y),G.max.x=Math.max(G.max.x,U.x-R.x),G.max.y=Math.max(G.max.y,U.y-R.y),G),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(G,U)=>{const q=G.wrap+G.canonical.x/(1<<G.canonical.z),re=G.canonical.y/(1<<G.canonical.z),Y=i.aj/(1<<G.canonical.z),ne=U.wrap+U.canonical.x/(1<<U.canonical.z),oe=U.canonical.y/(1<<U.canonical.z);return q+Y<ne+z.min.x||q>ne+z.max.x||re+Y<oe+z.min.y||re>oe+z.max.y};for(let G=0;G<S.length;G++){const U=S[G];for(let q=0;q<c.length;q++){const re=n.getTile(c[q]);if(!re||!re.hasData()||j(U,re.tileID))continue;const Y=this._createProxiedId(U,re,p[U.key]&&p[U.key][n.id]),ne=this.proxyToSource[U.key][n.id];ne?ne.push(Y):this.proxyToSource[U.key][n.id]=[Y],x.push(Y)}}}_createProxiedId(n,c,p){let x=this.orthoMatrix;if(p){const S=p.find(E=>E.key===c.tileID.key);if(S)return S}if(c.tileID.key!==n.key){const S=n.canonical.z-c.tileID.canonical.z;let E,M,R;x=i.bz();const z=c.tileID.wrap-n.wrap<<n.overscaledZ;S>0?(E=i.aj>>S,M=E*((c.tileID.canonical.x<<S)-n.canonical.x+z),R=E*((c.tileID.canonical.y<<S)-n.canonical.y)):(E=i.aj<<-S,M=i.aj*(c.tileID.canonical.x-(n.canonical.x+z<<-S)),R=i.aj*(c.tileID.canonical.y-(n.canonical.y<<-S))),i.c5(x,0,E,0,E,0,1),i.bo(x,x,[M,R,0])}return new uc(c.tileID,n.key,x)}_findTileCoveringTileID(n,c){let p=c.getTile(n);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],S=x[n.key];if(p=S?c.getTileByID(S):null,p&&p.hasData()||S===null)return p;let E=p?p.tileID:n,M=E.overscaledZ;const R=c.getSource().minzoom,z=[];if(!S){const G=c.getSource().maxzoom;if(n.canonical.z>=G){const U=n.canonical.z-G;c.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,c.transform.tileZoom),E=new i.aM(M,n.wrap,G,n.canonical.x>>U,n.canonical.y>>U)):U!==0&&(M=G,E=new i.aM(M,n.wrap,G,n.canonical.x>>U,n.canonical.y>>U))}E.key!==n.key&&(z.push(E.key),p=c.getTile(E))}const j=G=>{z.forEach(U=>{x[U]=G}),z.length=0};for(M-=1;M>=R&&(!p||!p.hasData());M--){p&&j(p.tileID.key);const G=E.calculateScaledKey(M);if(p=c.getTileByID(G),p&&p.hasData())break;const U=x[G];if(U===null)break;U===void 0?z.push(G):p=c.getTileByID(U)}return j(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[c.key]=!0}}function zu(f,n,c){const p=function(M,R,z){const j=i.bG(R,M),G=i.bG(z,[.2126,.7152,.0722]),U=(re,Y,ne)=>(1-ne)*re+ne*Y,q=U(1-.3*Math.min(G,1),1,Math.min(j+1,1));return U(.92,1,Math.asin(i.ay(R[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],n),x=[0,0,0];i.bY(x,c.slice(0,3),p);const S=[0,0,0];i.bY(S,n.slice(0,3),f[2]);const E=[0,0,0];return i.cV(E,x,S),i.cY(E)}const Wf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Zf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ju{static cacheKey(n,c,p,x){let S=`${c}${x?x.cacheKey:""}`;for(const E of p)n.usedDefines.includes(E)&&(S+=`/${E}`);return S}constructor(n,c,p,x,S,E){const M=n.gl;this.program=M.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...E];const R=x?x.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(R);let j=x?x.defines():[];j=j.concat(E.map(ne=>`#define ${ne}`));const G=`#version 300 es
`;let U=G+j.concat("precision mediump float;",hl,Ph.fragmentSource).join(`
`);for(const ne of p.fragmentIncludes)U+=`
${Nu[ne]}`;U+=`
${p.fragmentSource}`;let q=G+j.concat("precision highp float;",hl,Ph.vertexSource).join(`
`);for(const ne of p.vertexIncludes)q+=`
${Nu[ne]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const re=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(re,U),M.compileShader(re),M.attachShader(this.program,re);const Y=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Y,q),M.compileShader(Y),M.attachShader(this.program,Y),this.attributes={},this.numAttributes=z.length;for(let ne=0;ne<this.numAttributes;ne++)if(z[ne]){const oe=z[ne].startsWith("a_")?z[ne]:`a_${z[ne]}`;M.bindAttribLocation(this.program,ne,oe),this.attributes[oe]=ne}M.linkProgram(this.program),M.deleteShader(Y),M.deleteShader(re),this.fixedUniforms=S(n),this.binderUniforms=x?x.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ne=>({u_instanceID:new i.c8(ne)}))(n)),(E.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(ne=>({u_dem:new i.c8(ne),u_dem_prev:new i.c8(ne),u_dem_tl:new i.cb(ne),u_dem_scale:new i.ca(ne),u_dem_tl_prev:new i.cb(ne),u_dem_scale_prev:new i.ca(ne),u_dem_size:new i.ca(ne),u_dem_lerp:new i.ca(ne),u_exaggeration:new i.ca(ne),u_depth:new i.c8(ne),u_depth_size_inv:new i.cb(ne),u_depth_range_unpack:new i.cb(ne),u_occluder_half_size:new i.ca(ne),u_occlusion_depth_offset:new i.ca(ne),u_meter_to_dem:new i.ca(ne),u_label_plane_matrix_inv:new i.cc(ne)}))(n)),E.includes("GLOBE")&&(this.globeUniforms=(ne=>({u_tile_tl_up:new i.c9(ne),u_tile_tr_up:new i.c9(ne),u_tile_br_up:new i.c9(ne),u_tile_bl_up:new i.c9(ne),u_tile_up_scale:new i.ca(ne)}))(n)),E.includes("FOG")&&(this.fogUniforms=(ne=>({u_fog_matrix:new i.cc(ne),u_fog_range:new i.cb(ne),u_fog_color:new i.cQ(ne),u_fog_horizon_blend:new i.ca(ne),u_fog_vertical_limit:new i.cb(ne),u_fog_temporal_offset:new i.ca(ne),u_frustum_tl:new i.c9(ne),u_frustum_tr:new i.c9(ne),u_frustum_br:new i.c9(ne),u_frustum_bl:new i.c9(ne),u_globe_pos:new i.c9(ne),u_globe_radius:new i.ca(ne),u_globe_transition:new i.ca(ne),u_is_globe:new i.c8(ne),u_viewport:new i.cb(ne)}))(n)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ne=>({u_cutoff_params:new i.cQ(ne)}))(n)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ne=>({u_lighting_ambient_color:new i.c9(ne),u_lighting_directional_dir:new i.c9(ne),u_lighting_directional_color:new i.c9(ne),u_ground_radiance:new i.c9(ne)}))(n)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ne=>({u_light_matrix_0:new i.cc(ne),u_light_matrix_1:new i.cc(ne),u_fade_range:new i.cb(ne),u_shadow_normal_offset:new i.c9(ne),u_shadow_intensity:new i.ca(ne),u_shadow_texel_size:new i.ca(ne),u_shadow_map_resolution:new i.ca(ne),u_shadow_direction:new i.c9(ne),u_shadow_bias:new i.c9(ne),u_shadowmap_0:new i.c8(ne),u_shadowmap_1:new i.c8(ne)}))(n))}}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(n,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(n,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(n,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;n.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(n,c,p,x,S,E,M,R,z,j){const G=n.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const U=n.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||n._terrain&&n._terrain.renderingToTexture||!Wf.includes(this.name))||!(!G.layers3D||!Zf.includes(this.name))))return;const q=U.gl,re=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,S,U);if(!re)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const ne=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});U.program.set(ne.program);const oe=(xe,Ce,Ae)=>{if(Ce[xe]&&Ae[xe])for(const Te in Ce[xe])Ae[xe][Te]&&Ae[xe][Te].set(Ae.program,Te,Ce[xe][Te].current)};z&&z.setUniforms(ne.program,U,ne.binderUniforms,M,{zoom:R}),oe("fixedUniforms",this,ne),oe("terrainUniforms",this,ne),oe("globeUniforms",this,ne),oe("fogUniforms",this,ne),oe("lightsUniforms",this,ne),oe("shadowUniforms",this,ne),re.bind(),U.setColorMode(new ln([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],i.am.transparent,[!0,!0,!0,!1])),U.setDepthMode(new Kt(c.func===q.LESS?q.LEQUAL:c.func,Kt.ReadOnly,c.range)),U.setStencilMode(Nr.disabled);const ce=3*E.primitiveLength*2,ge=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const xe=j||1;for(let Ce=0;Ce<xe;++Ce)ne.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,ge)}else j&&j>1?q.drawElementsInstanced(q.LINES,ce,q.UNSIGNED_SHORT,ge,j):q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,ge);S.bind(),U.program.set(this.program),U.setDepthMode(c),U.setStencilMode(p),U.setColorMode(x)}checkUniforms(n,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${x} not set but required by ${c} being defined`)}}draw(n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne){const oe=n.context,ce=oe.gl;if(this.failedToCreate)return;oe.program.set(this.program),oe.setDepthMode(p),oe.setStencilMode(x),oe.setColorMode(S),oe.setCullFace(E);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,M[Ce]);re&&re.setUniforms(this.program,oe,this.binderUniforms,U,{zoom:q});const ge={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[c];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const xe=ne&&ne>0?1:void 0;for(const Ce of G.get()){const Ae=Ce.vaos||(Ce.vaos={});if((Ae[R]||(Ae[R]=new Gc)).bind(oe,this,z,re?re.getPaintVertexBuffers():[],j,Ce.vertexOffset,Y||[],xe),this.forceManualRenderingForInstanceIDShaders){const Te=ne||1;for(let be=0;be<Te;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),j?ce.drawElements(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2):ce.drawArrays(c,Ce.vertexOffset,Ce.vertexLength)}else ne&&ne>1?ce.drawElementsInstanced(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2,ne):j?ce.drawElements(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2):ce.drawArrays(c,Ce.vertexOffset,Ce.vertexLength);c===ce.TRIANGLES&&j&&this._drawDebugWireframe(n,p,x,S,j,Ce,U,q,re,ne)}}}function Fh(f,n,c=0){const p=Math.pow(2,n.tileID.overscaledZ),x=n.tileSize*Math.pow(2,f.transform.tileZoom)/p,S=x*(n.tileID.canonical.x+n.tileID.wrap*p),E=x*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.aw(n,1,f.transform.tileZoom),u_pixel_coord_upper:[S>>16,E>>16],u_pixel_coord_lower:[65535&S,65535&E],u_pattern_transition:c}}const aa={terrain:0,flat:1},Bh=i.bz(),Fu=(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe)=>{const ce=n.style.light,ge=ce.properties.get("position"),xe=[ge.x,ge.y,ge.z],Ce=i.dx();ce.properties.get("anchor")==="viewport"&&(i.dy(Ce,-n.transform.angle),i.dz(xe,xe,Ce));const Ae=ce.properties.get("color").toPremultipliedRenderColor(null),Te=n.transform,be={u_matrix:f,u_lightpos:xe,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:aa[z],u_base_type:aa[j],u_ao:x,u_edge_radius:S,u_width_scale:E,u_flood_light_color:re,u_vertical_scale:Y,u_flood_light_intensity:ne,u_ground_shadow_factor:oe};return Te.projection.name==="globe"&&(be.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],be.u_zoom_transition=G,be.u_inv_rot_matrix=q,be.u_merc_center=U,be.u_up_dir=Te.projection.upVector(new i.cp(0,0,0),U[0]*i.aj,U[1]*i.aj),be.u_height_lift=R),be},vm=(f,n,c,p,x,S)=>({u_matrix:f,u_edge_radius:n,u_width_scale:c,u_vertical_scale:p,u_height_type:aa[x],u_base_type:aa[S]}),kg=(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe)=>{const ce=Fu(f,n,c,p,x,S,E,M,z,j,G,U,q,re,Y,ne,1,[0,0,0]),ge={u_height_factor:-Math.pow(2,M.overscaledZ)/R.tileSize/8};return i.h(ce,Fh(n,R,oe),ge)},la=(f,n,c)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:c}),Bu=(f,n,c,p,x,S=0)=>i.h(la(f,n,x),Fh(c,p,S)),Vh=(f,n,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:n,u_ground_shadow_factor:p}),Xf=(f,n,c,p,x,S,E=0)=>i.h(Bu(f,n,c,p,S,E),{u_world:x}),Kf=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),Ho=(f,n,c,p,x)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),Qa=(f,n,c,p)=>{const x=i.aj/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.getCameraToCenterDistance(p),u_extrude_scale:[n.pixelsToGLUnits[0]/x,n.pixelsToGLUnits[1]/x]}},Ol=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),fl=i.bz(),Ll=(f,n,c,p,x,S,E)=>{const M=f.transform,R=M.projection.name==="globe",z=R?i.dA(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:i.aw(c,1,S),j={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:fl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){j.u_inv_rot_matrix=p,j.u_merc_center=x,j.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],j.u_zoom_transition=i.ah(M.zoom);const G=x[0]*i.aj,U=x[1]*i.aj;j.u_up_dir=M.projection.upVector(new i.cp(0,0,0),G,U)}return j};function Pa(f,[n,c,p,x],[S,E]){if(S===E)return[0,0,0,0];const M=255*(f-1)/(f*(E-S));return[n*M,c*M,p*M,x*M]}function Yf(f,n,[c,p]){return c===p?0:.5/f+(n-c)*(f-1)/(f*(p-c))}const Ud=(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce,ge,xe)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:j.mix,u_opacity:j.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:i.dC(G.paint.get("raster-saturation")),u_contrast_factor:i.dB(G.paint.get("raster-contrast")),u_spin_weights:Jf(G.paint.get("raster-hue-rotate")),u_perspective_transform:U,u_raster_elevation:q,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:R,u_colorization_mix:Pa(i.dD,Y,oe),u_colorization_offset:Yf(i.dD,ne,oe),u_color_ramp:re,u_texture_offset:[ge/(ce+2*ge),ce/(ce+2*ge)],u_texture_res:[ce+2*ge,ce+2*ge],u_emissive_strength:xe});function Jf(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const Ls=.05,Xs=(f,n,c,p,x,S,E,M,R,z,j,G)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:R}),ls=(f,n,c,p,x,S,E,M,R,z)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:c,u_velocity:p,u_color_ramp:S,u_velocity_res:x,u_max_speed:E,u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ls,Ls]}),so=(f,n,c,p,x,S,E,M,R,z)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:S,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ls,Ls]}),$d=i.bz(),Uh=(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce,ge,xe,Ce,Ae,Te)=>{const be=x.transform,Ie={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(ce),u_rotate_symbol:+c,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+z,u_elevation_from_sea:R?1:0,u_pitch_with_map:+p,u_texsize:j,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$d,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$d,u_up_vector:[0,-1,0],u_color_adj_mat:Ce,u_icon_transition:Ae||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(ce)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:ge,u_inv_matrix:i.bi(i.bz(),E),u_normal_scale:xe};return ce.name==="globe"&&(Ie.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Ie.u_zoom_transition=re,Ie.u_inv_rot_matrix=ne,Ie.u_merc_center=Y,Ie.u_camera_forward=be._camera.forward(),Ie.u_ecef_origin=i.dE(be.globeMatrix,q.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(be.globeMatrix),Ie.u_up_vector=oe),Ie},Hd=(f,n,c,p)=>({u_matrix:f,u_emissive_strength:n,u_opacity:c,u_color:p}),Gd=(f,n,c,p,x,S,E,M,R)=>i.h(function(z,j,G,U,q,re){const{width:Y,height:ne}=U.imageManager.getPixelSize(j),oe=Math.pow(2,re.tileID.overscaledZ),ce=re.tileSize*Math.pow(2,U.transform.tileZoom)/oe,ge=ce*(re.tileID.canonical.x+re.tileID.wrap*oe),xe=ce*re.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[Y,ne],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:q?[U.transform.width,-1*U.transform.height]:[1/i.aw(re,1,U.transform.tileZoom),1/i.aw(re,1,U.transform.tileZoom)],u_pixel_coord_upper:[ge>>16,xe>>16],u_pixel_coord_lower:[65535&ge,65535&xe]}}(0,S,E,p,M,R),{u_matrix:f,u_emissive_strength:n,u_opacity:c}),$h=new Float32Array(i.bx([])),Xc=(f,n,c,p,x,S,E,M,R,z,j,G,U,q=[0,0,0],re)=>{const Y=x.style.light,ne=Y.properties.get("position"),oe=[-ne.x,-ne.y,ne.z],ce=i.dx();Y.properties.get("anchor")==="viewport"&&(i.dy(ce,-x.transform.angle),i.dz(oe,oe,ce));const ge=j.alphaMode==="MASK",xe=Y.properties.get("color").toNonPremultipliedRenderColor(null),Ce=U.paint.get("model-ambient-occlusion-intensity"),Ae=U.paint.get("model-color").constantOr(i.am.white).toNonPremultipliedRenderColor(null);return Ae.a=U.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:c,u_node_matrix:p||$h,u_lightpos:oe,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_camera_pos:q,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:z,u_baseColorTexture:Io.BaseColor,u_metallicRoughnessTexture:Io.MetallicRoughness,u_normalTexture:Io.Normal,u_occlusionTexture:Io.Occlusion,u_emissionTexture:Io.Emission,u_lutTexture:Io.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Ce,u_emissive_strength:G,u_occlusionTextureTransform:re||[0,0,0,0]}},bm=(f,n=$h,c=$h)=>({u_matrix:f,u_instance:n,u_node_matrix:c}),Vu={fillExtrusion:f=>({u_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_vertical_gradient:new i.ca(f),u_opacity:new i.ca(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_ao:new i.cb(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_up_dir:new i.c9(f),u_height_lift:new i.ca(f),u_flood_light_color:new i.c9(f),u_vertical_scale:new i.ca(f),u_flood_light_intensity:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),fillExtrusionDepth:f=>({u_matrix:new i.cc(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_vertical_scale:new i.ca(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f)}),fillExtrusionPattern:f=>({u_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_vertical_gradient:new i.ca(f),u_height_factor:new i.ca(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_ao:new i.cb(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_up_dir:new i.c9(f),u_height_lift:new i.ca(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_opacity:new i.ca(f),u_pattern_transition:new i.ca(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.cc(f),u_opacity:new i.ca(f),u_ao_pass:new i.ca(f),u_meter_to_tile:new i.ca(f),u_ao:new i.cb(f),u_flood_light_intensity:new i.ca(f),u_flood_light_color:new i.c9(f),u_attenuation:new i.ca(f),u_edge_radius:new i.ca(f),u_fb:new i.c8(f),u_fb_size:new i.ca(f),u_dynamic_offset:new i.ca(f)}),fill:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),fillPattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_pattern_transition:new i.ca(f)}),fillOutline:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_world:new i.cb(f),u_ground_shadow_factor:new i.c9(f)}),fillOutlinePattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_world:new i.cb(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_pattern_transition:new i.ca(f)}),building:f=>({u_matrix:new i.cc(f),u_normal_matrix:new i.cc(f),u_opacity:new i.ca(f)}),buildingDepth:f=>({u_matrix:new i.cc(f)}),elevatedStructuresDepth:f=>({u_matrix:new i.cc(f),u_depth_bias:new i.ca(f)}),elevatedStructures:f=>({u_matrix:new i.cc(f),u_ground_shadow_factor:new i.c9(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new i.cc(f),u_camera_pos:new i.c9(f),u_depth_bias:new i.ca(f),u_height_scale:new i.ca(f),u_reset_depth:new i.ca(f)}),circle:i.dH,collisionBox:f=>({u_matrix:new i.cc(f),u_camera_to_center_distance:new i.ca(f),u_extrude_scale:new i.cb(f)}),collisionCircle:f=>({u_matrix:new i.cc(f),u_inv_matrix:new i.cc(f),u_camera_to_center_distance:new i.ca(f),u_viewport_size:new i.cb(f)}),debug:f=>({u_color:new i.di(f),u_matrix:new i.cc(f),u_overlay:new i.c8(f),u_overlay_scale:new i.ca(f)}),clippingMask:f=>({u_matrix:new i.cc(f)}),heatmap:f=>({u_extrude_scale:new i.ca(f),u_intensity:new i.ca(f),u_matrix:new i.cc(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_up_dir:new i.c9(f)}),heatmapTexture:f=>({u_image:new i.c8(f),u_color_ramp:new i.c8(f),u_opacity:new i.ca(f)}),hillshade:f=>({u_matrix:new i.cc(f),u_image:new i.c8(f),u_latrange:new i.cb(f),u_light:new i.cb(f),u_shadow:new i.di(f),u_highlight:new i.di(f),u_emissive_strength:new i.ca(f),u_accent:new i.di(f)}),hillshadePrepare:f=>({u_matrix:new i.cc(f),u_image:new i.c8(f),u_dimension:new i.cb(f),u_zoom:new i.ca(f)}),line:i.dG,linePattern:i.dF,raster:f=>({u_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_grid_matrix:new i.dj(f),u_tl_parent:new i.cb(f),u_scale_parent:new i.ca(f),u_fade_t:new i.ca(f),u_opacity:new i.ca(f),u_image0:new i.c8(f),u_image1:new i.c8(f),u_brightness_low:new i.ca(f),u_brightness_high:new i.ca(f),u_saturation_factor:new i.ca(f),u_contrast_factor:new i.ca(f),u_spin_weights:new i.c9(f),u_perspective_transform:new i.cb(f),u_raster_elevation:new i.ca(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_cutoff_params:new i.cQ(f),u_colorization_mix:new i.cQ(f),u_colorization_offset:new i.ca(f),u_color_ramp:new i.c8(f),u_texture_offset:new i.cb(f),u_texture_res:new i.cb(f),u_emissive_strength:new i.ca(f)}),rasterParticle:f=>({u_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_grid_matrix:new i.dj(f),u_tl_parent:new i.cb(f),u_scale_parent:new i.ca(f),u_fade_t:new i.ca(f),u_opacity:new i.ca(f),u_image0:new i.c8(f),u_image1:new i.c8(f),u_raster_elevation:new i.ca(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_cutoff_params:new i.cQ(f)}),rasterParticleTexture:f=>({u_texture:new i.c8(f),u_opacity:new i.ca(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.c8(f),u_particle_texture_side_len:new i.ca(f),u_tile_offset:new i.cb(f),u_velocity:new i.c8(f),u_color_ramp:new i.c8(f),u_velocity_res:new i.cb(f),u_max_speed:new i.ca(f),u_uv_offset:new i.cb(f),u_data_scale:new i.cb(f),u_data_offset:new i.ca(f),u_particle_pos_scale:new i.ca(f),u_particle_pos_offset:new i.cb(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.c8(f),u_particle_texture_side_len:new i.ca(f),u_velocity:new i.c8(f),u_velocity_res:new i.cb(f),u_max_speed:new i.ca(f),u_speed_factor:new i.ca(f),u_reset_rate:new i.ca(f),u_rand_seed:new i.ca(f),u_uv_offset:new i.cb(f),u_data_scale:new i.cb(f),u_data_offset:new i.ca(f),u_particle_pos_scale:new i.ca(f),u_particle_pos_offset:new i.cb(f)}),symbol:f=>({u_is_size_zoom_constant:new i.c8(f),u_is_size_feature_constant:new i.c8(f),u_size_t:new i.ca(f),u_size:new i.ca(f),u_camera_to_center_distance:new i.ca(f),u_rotate_symbol:new i.c8(f),u_aspect_ratio:new i.ca(f),u_fade_change:new i.ca(f),u_matrix:new i.cc(f),u_label_plane_matrix:new i.cc(f),u_coord_matrix:new i.cc(f),u_is_text:new i.c8(f),u_elevation_from_sea:new i.c8(f),u_pitch_with_map:new i.c8(f),u_texsize:new i.cb(f),u_texsize_icon:new i.cb(f),u_texture:new i.c8(f),u_texture_icon:new i.c8(f),u_gamma_scale:new i.ca(f),u_device_pixel_ratio:new i.ca(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_camera_forward:new i.c9(f),u_tile_matrix:new i.cc(f),u_up_vector:new i.c9(f),u_ecef_origin:new i.c9(f),u_is_halo:new i.c8(f),u_icon_transition:new i.ca(f),u_color_adj_mat:new i.cc(f),u_scale_factor:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_inv_matrix:new i.cc(f),u_normal_scale:new i.ca(f)}),background:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_opacity:new i.ca(f),u_color:new i.di(f)}),backgroundPattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_opacity:new i.ca(f),u_image:new i.c8(f),u_pattern_tl:new i.cb(f),u_pattern_br:new i.cb(f),u_texsize:new i.cb(f),u_pattern_size:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_pattern_units_to_pixels:new i.cb(f)}),terrainRaster:f=>({u_matrix:new i.cc(f),u_image0:new i.c8(f),u_skirt_height:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),skybox:f=>({u_matrix:new i.cc(f),u_sun_direction:new i.c9(f),u_cubemap:new i.c8(f),u_opacity:new i.ca(f),u_temporal_offset:new i.ca(f)}),skyboxGradient:f=>({u_matrix:new i.cc(f),u_color_ramp:new i.c8(f),u_center_direction:new i.c9(f),u_radius:new i.ca(f),u_opacity:new i.ca(f),u_temporal_offset:new i.ca(f)}),skyboxCapture:f=>({u_matrix_3f:new i.dj(f),u_sun_direction:new i.c9(f),u_sun_intensity:new i.ca(f),u_color_tint_r:new i.cQ(f),u_color_tint_m:new i.cQ(f),u_luminance:new i.ca(f)}),globeRaster:f=>({u_proj_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_image0:new i.c8(f),u_grid_matrix:new i.dj(f),u_skirt_height:new i.ca(f),u_far_z_cutoff:new i.ca(f),u_frustum_tl:new i.c9(f),u_frustum_tr:new i.c9(f),u_frustum_br:new i.c9(f),u_frustum_bl:new i.c9(f),u_globe_pos:new i.c9(f),u_globe_radius:new i.ca(f),u_viewport:new i.cb(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.c9(f),u_frustum_tr:new i.c9(f),u_frustum_br:new i.c9(f),u_frustum_bl:new i.c9(f),u_horizon:new i.ca(f),u_transition:new i.ca(f),u_fadeout_range:new i.ca(f),u_color:new i.cQ(f),u_high_color:new i.cQ(f),u_space_color:new i.cQ(f),u_temporal_offset:new i.ca(f),u_horizon_angle:new i.ca(f)}),model:f=>({u_matrix:new i.cc(f),u_lighting_matrix:new i.cc(f),u_normal_matrix:new i.cc(f),u_node_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_camera_pos:new i.c9(f),u_opacity:new i.ca(f),u_baseColorFactor:new i.cQ(f),u_emissiveFactor:new i.cQ(f),u_metallicFactor:new i.ca(f),u_roughnessFactor:new i.ca(f),u_baseTextureIsAlpha:new i.c8(f),u_alphaMask:new i.c8(f),u_alphaCutoff:new i.ca(f),u_baseColorTexture:new i.c8(f),u_metallicRoughnessTexture:new i.c8(f),u_normalTexture:new i.c8(f),u_occlusionTexture:new i.c8(f),u_emissionTexture:new i.c8(f),u_lutTexture:new i.c8(f),u_color_mix:new i.cQ(f),u_aoIntensity:new i.ca(f),u_emissive_strength:new i.ca(f),u_occlusionTextureTransform:new i.cQ(f)}),modelDepth:f=>({u_matrix:new i.cc(f),u_instance:new i.cc(f),u_node_matrix:new i.cc(f)}),groundShadow:f=>({u_matrix:new i.cc(f),u_ground_shadow_factor:new i.c9(f)}),stars:f=>({u_matrix:new i.cc(f),u_up:new i.c9(f),u_right:new i.c9(f),u_intensity_multiplier:new i.ca(f)}),snowParticle:f=>({u_modelview:new i.cc(f),u_projection:new i.cc(f),u_time:new i.ca(f),u_cam_pos:new i.c9(f),u_velocityConeAperture:new i.ca(f),u_velocity:new i.ca(f),u_horizontalOscillationRadius:new i.ca(f),u_horizontalOscillationRate:new i.ca(f),u_boxSize:new i.ca(f),u_billboardSize:new i.ca(f),u_simpleShapeParameters:new i.cb(f),u_screenSize:new i.cb(f),u_thinningCenterPos:new i.cb(f),u_thinningShape:new i.c9(f),u_thinningAffectedRatio:new i.ca(f),u_thinningParticleOffset:new i.ca(f),u_particleColor:new i.cQ(f),u_direction:new i.c9(f)}),rainParticle:f=>({u_modelview:new i.cc(f),u_projection:new i.cc(f),u_time:new i.ca(f),u_cam_pos:new i.c9(f),u_texScreen:new i.c8(f),u_velocityConeAperture:new i.ca(f),u_velocity:new i.ca(f),u_boxSize:new i.ca(f),u_rainDropletSize:new i.cb(f),u_distortionStrength:new i.ca(f),u_rainDirection:new i.c9(f),u_color:new i.cQ(f),u_screenSize:new i.cb(f),u_thinningCenterPos:new i.cb(f),u_thinningShape:new i.c9(f),u_thinningAffectedRatio:new i.ca(f),u_thinningParticleOffset:new i.ca(f),u_shapeDirectionalPower:new i.ca(f),u_shapeNormalPower:new i.ca(f),u_mode:new i.ca(f)}),vignette:f=>({u_vignetteShape:new i.c9(f),u_vignetteColor:new i.cQ(f)}),occlusion:f=>({u_matrix:new i.cc(f),u_anchorPos:new i.c9(f),u_screenSizePx:new i.cb(f),u_occluderSizePx:new i.cb(f),u_color:new i.cQ(f)})};class ca{constructor(n,c,p,x){this.id=ca.uniqueIdxCounter,ca.uniqueIdxCounter++,this.context=n;const S=n.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=ca.uniqueIdxCounter,ca.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ca.uniqueIdxCounter=0;const Wy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qd{constructor(n,c,p,x,S,E){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=n;const M=n.gl;this.buffer=M.createBuffer(),n.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||S||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let p=0;p<this.attributes.length;p++){const x=c.attributes[this.attributes[p].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,c,p){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],E=c.attributes[S.name];E!==void 0&&n.vertexAttribPointer(E,S.components,n[Wy[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(n,c,p){for(let x=0;x<this.attributes.length;x++){const S=c.attributes[this.attributes[x].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(S,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hh{constructor(n,c,p,x,S){this.context=n,this.width=c,this.height=p;const E=this.framebuffer=n.gl.createFramebuffer();x&&(this.colorAttachment=new Ig(n,E)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new Mg(n,E):new Ou(n,E))}destroy(){const n=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&n.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&n.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&n.deleteTexture(c)}n.deleteFramebuffer(this.framebuffer)}}class Pg{constructor(n,c){this.gl=n,this.clearColor=new pm(this),this.clearDepth=new es(this),this.clearStencil=new mm(this),this.colorMask=new Vf(this),this.depthMask=new jd(this),this.stencilMask=new Ag(this),this.stencilFunc=new Uf(this),this.stencilOp=new Fd(this),this.stencilTest=new Du(this),this.depthRange=new Rh(this),this.depthTest=new gm(this),this.depthFunc=new ym(this),this.blend=new $f(this),this.blendFunc=new Hf(this),this.blendColor=new Ml(this),this.blendEquation=new cc(this),this.cullFace=new Nh(this),this.cullFaceSide=new Dh(this),this.frontFace=new Wc(this),this.program=new Gf(this),this.activeTexture=new _m(this),this.viewport=new xm(this),this.bindFramebuffer=new Oh(this),this.bindRenderbuffer=new qf(this),this.bindTexture=new Lh(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Bd(this),this.bindVertexArrayOES=new Pl(this),this.pixelStoreUnpack=new dl(this),this.pixelStoreUnpackPremultiplyAlpha=new zh(this),this.pixelStoreUnpackFlipY=new Rl(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c,p){return new ca(this,n,c,p)}createVertexBuffer(n,c,p,x,S){return new qd(this,n,c,p,x,S)}createRenderbuffer(n,c,p){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,n,c,p),this.bindRenderbuffer.set(null),S}createFramebuffer(n,c,p,x){return new Hh(this,n,c,p,x)}clear({color:n,depth:c,stencil:p,colorMask:x}){const S=this.gl;let E=0;n&&(E|=S.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(E|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(E|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),S.clear(E)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){i.bv(n.blendFunction,ln.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Uu;function hc(f,n,c,p,x,S,E){const M=f.context,R=M.gl,z=f.transform,j=f.getOrCreateProgram("collisionBox"),G=[];let U=0,q=0;for(let xe=0;xe<p.length;xe++){const Ce=p[xe],Ae=n.getTile(Ce),Te=Ae.getBucket(c);if(!Te)continue;const be=Ir(Ce,Te,z);let Ie=be;x[0]===0&&x[1]===0||(Ie=f.translatePosMatrix(be,Ae,x,S));const Re=E?Te.textCollisionBox:Te.iconCollisionBox,Be=Te.collisionCircleArray;if(Be.length>0){const Ge=i.bz(),st=Ie;i.cB(Ge,Te.placementInvProjMatrix,z.glCoordMatrix),i.cB(Ge,Ge,Te.placementViewportMatrix),G.push({circleArray:Be,circleOffset:q,transform:st,invTransform:Ge,projection:Te.getProjection()}),U+=Be.length/4,q=U}Re&&(f.terrain&&f.terrain.setupElevationDraw(Ae,j),j.draw(f,R.LINES,Kt.disabled,Nr.disabled,f.colorModeForRenderPass(),Ar.disabled,Qa(Ie,z,Ae,Te.getProjection()),c.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,z.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!E||!G.length)return;const re=f.getOrCreateProgram("collisionCircle"),Y=new i.dI;Y.resize(4*U),Y._trim();let ne=0;for(const xe of G)for(let Ce=0;Ce<xe.circleArray.length/4;Ce++){const Ae=4*Ce,Te=xe.circleArray[Ae+0],be=xe.circleArray[Ae+1],Ie=xe.circleArray[Ae+2],Re=xe.circleArray[Ae+3];Y.emplace(ne++,Te,be,Ie,Re,0),Y.emplace(ne++,Te,be,Ie,Re,1),Y.emplace(ne++,Te,be,Ie,Re,2),Y.emplace(ne++,Te,be,Ie,Re,3)}(!Uu||Uu.length<2*U)&&(Uu=function(xe){const Ce=2*xe,Ae=new i.a_;Ae.resize(Ce),Ae._trim();for(let Te=0;Te<Ce;Te++){const be=6*Te;Ae.uint16[be+0]=4*Te+0,Ae.uint16[be+1]=4*Te+1,Ae.uint16[be+2]=4*Te+2,Ae.uint16[be+3]=4*Te+2,Ae.uint16[be+4]=4*Te+3,Ae.uint16[be+5]=4*Te+0}return Ae}(U));const oe=M.createIndexBuffer(Uu,!0),ce=M.createVertexBuffer(Y,i.dJ.members,!0);for(const xe of G){const Ce={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(ge=z).getCameraToCenterDistance(xe.projection),u_viewport_size:[ge.width,ge.height]};re.draw(f,R.TRIANGLES,Kt.disabled,Nr.disabled,f.colorModeForRenderPass(),Ar.disabled,Ce,c.id,ce,oe,i.bd.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,z.zoom)}var ge;ce.destroy(),oe.destroy()}const zl=i.bz();function Kc(f){const n=f._camera.getWorldToCamera(f.worldSize,1),c=i.az([],n,f.globeMatrix);i.bi(c,c);const p=[0,0,0],x=[0,1,0,0];return i.aA(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],i.au(p,p),p}function Yc({width:f,height:n,anchor:c,textOffset:p,textScale:x},S){const{horizontalAlign:E,verticalAlign:M}=i.bT(c),R=-(E-.5)*f,z=-(M-.5)*n,j=i.bU(c,p);return new i.P((R/x+j[0])*S,(z/x+j[1])*S)}function $u(f,n,c,p,x,S,E,M,R,z){const j=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,U=f.icon.dynamicLayoutVertexArray,q={},re=f.getProjection(),Y=Sh(E,re,x),ne=x.elevation,oe=re.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ce=0;ce<j.length;ce++){const ge=j.get(ce),{tileAnchorX:xe,tileAnchorY:Ce,numGlyphs:Ae}=ge,Te=ge.hidden||!ge.crossTileID||f.allowVerticalPlacement&&!ge.placedOrientation?null:p[ge.crossTileID];if(Te){let be=0,Ie=0,Re=0;if(ne){const lt=ne?ne.getAtTileOffset(E,xe,Ce):0,[Ye,pt,It]=re.upVector(E.canonical,xe,Ce);be=lt*Ye*oe,Ie=lt*pt*oe,Re=lt*It*oe}let[Be,Ge,st,it]=ta(ge.projectedAnchorX+be,ge.projectedAnchorY+Ie,ge.projectedAnchorZ+Re,c?Y:S);const mt=Su(x.getCameraToCenterDistance(re),it);let Ue=i.bJ(f.textSizeData,R,ge)*mt/i.bO;c&&(Ue*=f.tilePixelRatio/M);const Je=Yc(Te,Ue);c?({x:Be,y:Ge,z:st}=re.projectTilePoint(xe+Je.x,Ce+Je.y,E.canonical),[Be,Ge,st]=ta(Be+be,Ge+Ie,st+Re,S)):(n&&Je._rotate(-x.angle),Be+=Je.x,Ge+=Je.y,st=0);const Le=f.allowVerticalPlacement&&ge.placedOrientation===i.bI.vertical?Math.PI/2:0;for(let lt=0;lt<Ae;lt++)i.bL(G,Be,Ge,st,Le);z&&ge.associatedIconIndex>=0&&(q[ge.associatedIconIndex]={x:Be,y:Ge,z:st,angle:Le})}else qs(Ae,G)}if(z){U.clear();const ce=f.icon.placedSymbolArray;for(let ge=0;ge<ce.length;ge++){const xe=ce.get(ge),{numGlyphs:Ce}=xe,Ae=q[ge];if(xe.hidden||!Ae)qs(Ce,U);else{const{x:Te,y:be,z:Ie,angle:Re}=Ae;for(let Be=0;Be<Ce;Be++)i.bL(U,Te,be,Ie,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData(U)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function Jc(f,n,c,p,x,S,E={}){const M=c.paint.get("icon-translate"),R=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),j=c.paint.get("text-translate-anchor"),G=c.layout.get("icon-rotation-alignment"),U=c.layout.get("text-rotation-alignment"),q=c.layout.get("icon-pitch-alignment"),re=c.layout.get("text-pitch-alignment"),Y=c.layout.get("icon-keep-upright"),ne=c.layout.get("text-keep-upright"),oe=c.paint.get("icon-color-saturation"),ce=c.paint.get("icon-color-contrast"),ge=c.paint.get("icon-color-brightness-min"),xe=c.paint.get("icon-color-brightness-max"),Ce=c.layout.get("symbol-elevation-reference")==="sea",Ae=f.context,Te=Ae.gl,be=f.transform,Ie=G==="map",Re=U==="map",Be=q==="map",Ge=re==="map",st=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const mt=f.depthModeForSublayer(0,Kt.ReadOnly),Ue=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),Je=[i.aD(be.center.lng),i.aH(be.center.lat)],Le=c.layout.get("text-variable-anchor"),lt=be.projection.name==="globe",Ye=[],pt=[0,-1,0];for(const It of p){const ct=n.getTile(It),wt=ct.getBucket(c);if(!wt||wt.projection.name==="mercator"&&lt||wt.fullyClipped)continue;const Vt=wt.projection.name==="globe",qt=Vt?i.ah(be.zoom):0,Bt=Sh(It,wt.getProjection(),be),Xt=be.calculatePixelsToTileUnitsMatrix(ct),cr=Le&&wt.hasTextData(),gr=wt.hasIconTextFit()&&cr&&wt.hasIconData(),Or=wt.getProjection().createInversionMatrix(be,It.canonical),Qr=(1<<ct.tileID.canonical.z)*i.aj/f.transform.worldSize,wn=ui=>{let Ln=[0,0,0];if(ui){const Fi=f.style.directionalLight,bn=f.style.ambientLight;Fi&&bn&&(Ln=ac(f.style,Fi,bn))}return Ln},oi=ui=>{be.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||f.terrain)&&(ui.push("DEPTH_D24"),ui.push("DEPTH_OCCLUSION"))},Vn=()=>{const ui=Ie&&c.layout.get("symbol-placement")!=="point",Ln=[];oi(Ln);const Fi=ui||gr,bn=wt.elevationType==="road"&&Be,Bi=f.shadowRenderer,mi=bn&&!!Bi&&Bi.enabled,Gn=wn(mi),hi=bn?Ue:mt,Xr=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Be&&Ln.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(Ln.push("PROJECTION_GLOBE_VIEW"),Fi&&Ln.push("PROJECTED_POS_ON_VIEWPORT")),Xr>0&&Ln.push("ICON_TRANSITION"),wt.icon.zOffsetVertexBuffer&&Ln.push("Z_OFFSET"),oe===0&&ce===0&&ge===0&&xe===1||Ln.push("COLOR_ADJUSTMENT"),wt.sdfIcons&&Ln.push("RENDER_SDF"),mi&&Ln.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),bn&&wt.icon.orientationVertexBuffer&&Ln.push("ELEVATED_ROADS");const Gi=wt.icon.programConfigurations.get(c.id),Bs=f.getOrCreateProgram("symbol",{config:Gi,defines:Ln}),wi=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Dn=wt.iconSizeData,Zo=i.bH(Dn,be.zoom),Ro=Be||!be.isOrthographic,Oa=tc(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt),ws=bh(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt),da=f.translatePosMatrix(ws,ct,M,z,!0),Xo=f.translatePosMatrix(Bt,ct,M,z),Ko=Fi?zl:Oa,fa=Ie&&!Be&&!ui;let pa=pt;!lt&&!be.mercatorFromTransition||Ie||(pa=Kc(be));const su=Vt?pa:pt,uf=c.getColorAdjustmentMatrix(oe,ce,ge,xe),ou=Uh(Dn.kind,Zo,fa,Be,f,Xo,Ko,da,Ce,!1,wi,[0,0],0,It,qt,Je,Or,su,wt.getProjection(),Gn,Qr,uf,Xr,null),Om=ct.imageAtlasTexture?ct.imageAtlasTexture:null,rh=c.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,vp=wt.sdfIcons||f.options.rotating||f.options.zooming||rh||Ro?Te.LINEAR:Te.NEAREST,hf=wt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,xl=f.terrain&&Be&&ui?i.bi(i.bz(),Oa):zl;if(ui&&wt.icon){const bc=be.elevation,Wl=bc?bc.getAtTileOffsetFunc(It,be.center.lat,be.worldSize,wt.getProjection()):null,wc=Rf(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt);cl(wt,Bt,f,!1,wc,ws,Be,Y,Wl,It)}return{program:Bs,buffers:wt.icon,uniformValues:ou,atlasTexture:Om,atlasTextureIcon:null,atlasInterpolation:vp,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:hf,depthMode:hi,tile:ct,renderWithShadows:mi,labelPlaneMatrixInv:xl}},Pn=()=>{const ui=Re&&c.layout.get("symbol-placement")!=="point",Ln=[],Fi=ui||Le||gr,bn=wt.elevationType==="road"&&Ge,Bi=f.shadowRenderer,mi=bn&&!!Bi&&Bi.enabled,Gn=wn(mi),hi=bn?Ue:mt;f.terrainRenderModeElevated()&&Ge&&Ln.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(Ln.push("PROJECTION_GLOBE_VIEW"),Fi&&Ln.push("PROJECTED_POS_ON_VIEWPORT")),wt.text.zOffsetVertexBuffer&&Ln.push("Z_OFFSET"),wt.iconsInText&&Ln.push("RENDER_TEXT_AND_SYMBOL"),Ln.push("RENDER_SDF"),mi&&Ln.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),bn&&wt.text.orientationVertexBuffer&&Ln.push("ELEVATED_ROADS"),oi(Ln);const Xr=wt.text.programConfigurations.get(c.id),Gi=f.getOrCreateProgram("symbol",{config:Xr,defines:Ln});let Bs,wi=[0,0],Dn=null;const Zo=wt.textSizeData;wt.iconsInText&&(wi=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Dn=ct.imageAtlasTexture?ct.imageAtlasTexture:null,Bs=Ge||!be.isOrthographic||f.options.rotating||f.options.zooming||Zo.kind==="composite"||Zo.kind==="camera"?Te.LINEAR:Te.NEAREST);const Ro=ct.glyphAtlasTexture?ct.glyphAtlasTexture.size:[0,0],Oa=c.layout.get("text-size-scale-range"),ws=i.ay(f.scaleFactor,Oa[0],Oa[1]),da=i.bH(Zo,be.zoom,ws),Xo=tc(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt),Ko=bh(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt),fa=f.translatePosMatrix(Ko,ct,R,j,!0),pa=f.translatePosMatrix(Bt,ct,R,j),su=Fi?zl:Xo,uf=Re&&!Ge&&!ui;let ou=pt;!lt&&!be.mercatorFromTransition||Re||(ou=Kc(be));const Om=Uh(Zo.kind,da,uf,Ge,f,pa,su,fa,Ce,!0,Ro,wi,0,It,qt,Je,Or,Vt?ou:pt,wt.getProjection(),Gn,Qr,null,null,ws),rh=ct.glyphAtlasTexture?ct.glyphAtlasTexture:null,vp=Te.LINEAR,hf=c.paint.get("text-halo-width").constantOr(1)!==0,xl=f.terrain&&Ge&&ui?i.bi(i.bz(),Xo):zl;if(ui&&wt.text){const bc=be.elevation,Wl=bc?bc.getAtTileOffsetFunc(It,be.center.lat,be.worldSize,wt.getProjection()):null,wc=Rf(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt);cl(wt,Bt,f,!0,wc,Ko,Ge,ne,Wl,It)}return{program:Gi,buffers:wt.text,uniformValues:Om,atlasTexture:rh,atlasTextureIcon:Dn,atlasInterpolation:vp,atlasInterpolationIcon:Bs,isSDF:!0,hasHalo:hf,depthMode:hi,tile:ct,renderWithShadows:mi,labelPlaneMatrixInv:xl}},$i=wt.icon.segments.get().length,Vr=wt.text.segments.get().length,en=$i&&!E.onlyText?Vn():null,un=Vr&&!E.onlyIcons?Pn():null,ai=c.paint.get("icon-opacity").constantOr(1),Ji=c.paint.get("text-opacity").constantOr(1);if(st&&wt.canOverlap){it=!0;const ui=ai&&!E.onlyText?wt.icon.segments.get():[],Ln=Ji&&!E.onlyIcons?wt.text.segments.get():[];for(const Fi of ui)Ye.push({segments:new i.bd([Fi]),sortKey:Fi.sortKey,state:en});for(const Fi of Ln)Ye.push({segments:new i.bd([Fi]),sortKey:Fi.sortKey,state:un})}else E.onlyText||Ye.push({segments:ai?wt.icon.segments:new i.bd([]),sortKey:0,state:en}),E.onlyIcons||Ye.push({segments:Ji?wt.text.segments:new i.bd([]),sortKey:0,state:un})}it&&Ye.sort((It,ct)=>It.sortKey-ct.sortKey);for(const It of Ye){const ct=It.state;if(ct)if(f.terrain?f.terrain.setupElevationDraw(ct.tile,ct.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ct.labelPlaneMatrixInv}):f.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,ct.program),Ae.activeTexture.set(Te.TEXTURE0),ct.atlasTexture&&ct.atlasTexture.bind(ct.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),ct.atlasTextureIcon&&(Ae.activeTexture.set(Te.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),ct.renderWithShadows&&f.shadowRenderer.setupShadows(ct.tile.tileID.toUnwrapped(),ct.program,"vector-tile",ct.tile.tileID.overscaledZ),f.uploadCommonLightUniforms(f.context,ct.program),ct.hasHalo){const wt=ct.uniformValues;wt.u_is_halo=1,Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,wt,2),wt.u_is_halo=0}else{if(ct.isSDF){const wt=ct.uniformValues;ct.hasHalo&&(wt.u_is_halo=1,Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,wt,1)),wt.u_is_halo=0}Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,ct.uniformValues,1)}}}function Qc(f,n,c,p,x,S,E,M,R,z){const j=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,S,E,M,Ar.disabled,R,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),j,z)}function Gh(f,n){const c=1<<f.canonical.z,p=(n.x*c-f.canonical.x-f.wrap*c)*i.aj,x=(n.y*c-f.canonical.y)*i.aj,S=i.dS(n.z,n.y);return i.cS(p,x,S)}function Wd(f,n,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const S=f.context.gl,E=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),M=new Kt(f.context.gl.GREATER,Kt.ReadWrite,f.depthRangeFor3D),R=function(q){const re=i.cJ(q.pitch);let Y=.01;return q.isOrthographic&&(Y=i.ai(1e-4,Y,i.cN(re>=Ms?1:re/Ms))),2*Y}(f.transform),z=f.transform.getFreeCameraOptions().position,j="elevatedStructuresDepthReconstruct",G=f.getOrCreateProgram(j,{defines:["DEPTH_RECONSTRUCTION"]}),U=f.getOrCreateProgram(j);for(const q of p){const re=n.getTile(q),Y=re.getBucket(c);if(!Y)continue;const ne=Y.elevatedStructures;if(!ne)continue;const oe=Y.elevationBufferData.heightRange,ce=Gh(q.toUnwrapped(),z),ge=f.translatePosMatrix(q.projMatrix,re,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let xe,Ce,Ae,Te;if(x==="initialize"){if(!oe||oe.min>=1||ne.depthSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,R,1,0),Ce=E,Ae=ne.depthSegments,Te=G}else if(x==="reset"){if(!oe||oe.min>=0||ne.maskSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,0,0,1),Ce=M,Ae=ne.maskSegments,Te=G}else if(x==="geometry"){if(ne.depthSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,R,1,0),Ce=E,Ae=ne.depthSegments,Te=U}Te.draw(f,S.TRIANGLES,Ce,Nr.disabled,ln.disabled,Ar.disabled,xe,c.id,ne.vertexBuffer,ne.indexBuffer,Ae,c.paint,f.transform.zoom)}}function eu(f,n,c){const{painter:p,sourceCache:x,layer:S,coords:E,colorMode:M,elevationType:R,terrainEnabled:z,pass:j}=f,G=p.context.gl,U=S.paint.get("fill-pattern"),q=S.paint.get("fill-pattern-cross-fade"),re=U.constantOr(null);let Y=R;R!=="road"||n&&!z||(Y="none");const ne=Y==="road",oe=f.painter.shadowRenderer,ce=ne&&!!oe&&oe.enabled,ge=new Kt(p.context.gl.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D);let xe=[0,0,0];if(ce){const Te=p.style.directionalLight,be=p.style.ambientLight;Te&&be&&(xe=ac(p.style,Te,be))}const Ce=U&&U.constantOr(1),Ae=(Te,be)=>{let Ie,Re,Be,Ge,st;be?(Ie=Ce&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=G.LINES):(Ie=Ce?"fillPattern":"fill",Be=G.TRIANGLES);for(const it of E){const mt=x.getTile(it);if(Ce&&!mt.patternsLoaded())continue;const Ue=mt.getBucket(S);if(!Ue)continue;const Je=n?Ue.elevationBufferData:Ue.bufferData;if(Je.isEmpty())continue;p.prepareDrawTile();const Le=Je.programConfigurations.get(S.id),lt=p.isTileAffectedByFog(it),Ye=[],pt=[];ne&&(Ye.push("ELEVATED_ROADS"),pt.push(Je.elevatedLayoutVertexBuffer)),ce&&Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ce&&(p.context.activeTexture.set(G.TEXTURE0),mt.imageAtlasTexture&&mt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Le.updatePaintBuffers());let It=!1;if(re&&mt.imageAtlas){const Bt=mt.imageAtlas,Xt=i.dN.from(re),cr=Xt.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),gr=Xt.getSecondary(),Or=Bt.patternPositions.get(cr),Qr=gr?Bt.patternPositions.get(gr.scaleSelf(i.q.devicePixelRatio).toString()):null;It=!!Or&&!!Qr,Or&&Le.setConstantPatternPositions(Or,Qr)}q>0&&(It||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&Ye.push("FILL_PATTERN_TRANSITION");const ct=p.getOrCreateProgram(Ie,{config:Le,overrideFog:lt,defines:Ye}),wt=p.translatePosMatrix(it.projMatrix,mt,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));ce&&oe.setupShadows(mt.tileID.toUnwrapped(),ct,"vector-tile",mt.tileID.overscaledZ);const Vt=S.paint.get("fill-emissive-strength");if(be){Ge=Je.lineIndexBuffer,st=Je.lineSegments;const Bt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];Re=Ie==="fillOutlinePattern"&&Ce?Xf(wt,Vt,p,mt,Bt,xe,q):Vh(wt,Vt,Bt,xe)}else Ge=Je.indexBuffer,st=Je.triangleSegments,Re=Ce?Bu(wt,Vt,p,mt,xe,q):la(wt,Vt,xe);p.uploadCommonUniforms(p.context,ct,it.toUnwrapped());let qt=Te;(R==="road"&&!z||R==="offset")&&(qt=ge),ct.draw(p,Be,qt,c||p.stencilModeForClipping(it),M,Ar.disabled,Re,S.id,Je.layoutVertexBuffer,Ge,st,S.paint,p.transform.zoom,Le,pt)}};p.renderPass===j&&Ae(p.depthModeForSublayer(1,p.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly),!1),Y==="none"&&p.renderPass==="translucent"&&S.paint.get("fill-antialias")&&Ae(p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly),!0)}function zs(f,n,c,p,x,S,E,M){c.resetLayerRenderingStats(f);const R=f.context,z=R.gl,j=f.transform,G=c.paint.get("fill-extrusion-pattern"),U=c.paint.get("fill-extrusion-pattern-cross-fade"),q=G.constantOr(null),re=G.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),ne=f.style.enable3dLights(),oe=c.paint.get(ne&&!re?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],ge=c.layout.get("fill-extrusion-edge-radius"),xe=ge>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ce=xe?0:ge,Ae=j.projection.name==="globe"?i.dV():0,Te=j.projection.name==="globe",be=Te?i.ah(j.zoom):0,Ie=[i.aD(j.center.lng),i.aH(j.center.lat)],Re=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Be=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Re?null:c.lut).toArray01().slice(0,3),Ge=c.paint.get("fill-extrusion-flood-light-intensity"),st=c.paint.get("fill-extrusion-vertical-scale"),it=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,mt=c.paint.get("fill-extrusion-height-alignment"),Ue=c.paint.get("fill-extrusion-base-alignment"),Je=sa(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let lt;Te&&Le.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Le.push("FAUX_AO"),xe&&Le.push("ZERO_ROOF_RADIUS"),M&&Le.push("HAS_CENTROID"),Ge>0&&Le.push("FLOOD_LIGHT"),Je.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),it&&Le.push("RENDER_WALL_MODE");const Ye=f.renderPass==="shadow",pt=f.shadowRenderer,It=Ye&&!!pt,ct=Ye?Ar.disabled:Ar.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let wt=[0,0,0];if(pt){const Bt=f.style.directionalLight,Xt=f.style.ambientLight;Bt&&Xt&&(wt=ac(f.style,Bt,Xt)),Ye||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),pt.useNormalOffset&&Le.push("NORMAL_OFFSET")),lt=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Vt=It?"fillExtrusionDepth":re?"fillExtrusionPattern":"fillExtrusion",qt=c.getLayerRenderingStats();for(const Bt of p){const Xt=n.getTile(Bt),cr=Xt.getBucket(c);if(!cr||cr.projection.name!==j.projection.name)continue;let gr=!1;pt&&(gr=pt.getMaxCascadeForTile(Bt.toUnwrapped())===0);const Or=f.isTileAffectedByFog(Bt),Qr=cr.programConfigurations.get(c.id);let wn=!1;if(q&&Xt.imageAtlas){const un=Xt.imageAtlas,ai=i.dN.from(q),Ji=ai.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),ui=ai.getSecondary(),Ln=un.patternPositions.get(Ji),Fi=ui?un.patternPositions.get(ui.scaleSelf(i.q.devicePixelRatio).toString()):null;wn=!!Ln&&!!Fi,Ln&&Qr.setConstantPatternPositions(Ln,Fi)}U>0&&(wn||Qr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Le.push("FILL_EXTRUSION_PATTERN_TRANSITION");const oi=f.getOrCreateProgram(Vt,{config:Qr,defines:gr?lt:Le,overrideFog:Or});if(f.terrain&&f.terrain.setupElevationDraw(Xt,oi,{useMeterToDem:!0}),!cr.centroidVertexBuffer){const un=oi.attributes.a_centroid_pos;un!==void 0&&z.vertexAttrib2f(un,0,0)}!Ye&&pt&&pt.setupShadows(Xt.tileID.toUnwrapped(),oi,"vector-tile",Xt.tileID.overscaledZ),re&&(f.context.activeTexture.set(z.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Qr.updatePaintBuffers());const Vn=c.paint.get("fill-extrusion-vertical-gradient"),Pn=1/cr.tileToMeter;let $i;if(Ye&&pt){if(Fl(Xt.tileID,cr,f))continue;const un=pt.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());$i=vm(un,Ce,Pn,st,mt,Ue)}else{const un=f.translatePosMatrix(Bt.expandedProjMatrix,Xt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ai=j.projection.createInversionMatrix(j,Bt.canonical);$i=re?kg(un,f,Vn,Y,ce,Ce,Pn,Bt,Xt,Ae,mt,Ue,be,Ie,ai,Be,st,U):Fu(un,f,Vn,Y,ce,Ce,Pn,Bt,Ae,mt,Ue,be,Ie,ai,Be,st,Ge,wt)}f.uploadCommonUniforms(R,oi,Bt.toUnwrapped(),null,Je);let Vr=cr.segments;if(j.projection.name==="mercator"&&!Ye&&(Vr=cr.getVisibleSegments(Xt.tileID,f.terrain,f.transform.getFrustum(0)),!Vr.get().length))continue;if(qt)if(Ye)for(const un of Vr.get())qt.numRenderedVerticesInShadowPass+=un.primitiveLength;else for(const un of Vr.get())qt.numRenderedVerticesInTransparentPass+=un.primitiveLength;const en=[];(f.terrain||M)&&en.push(cr.centroidVertexBuffer),Te&&en.push(cr.layoutVertexExtBuffer),it&&en.push(cr.wallVertexBuffer),oi.draw(f,R.gl.TRIANGLES,x,S,E,ct,$i,c.id,cr.layoutVertexBuffer,cr.indexBuffer,Vr,c.paint,f.transform.zoom,Qr,en)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Go(f,n,c,p,x,S,E,M,R,z,j,G,U,q,re,Y,ne,oe,ce){const ge=f.context,xe=ge.gl,Ce=f.transform,Ae=f.transform.zoom,Te=[],be=sa(f,c.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(Te.push("CLEAR_SUBPASS"),ce&&(Te.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(xe.TEXTURE0),ce.bind(xe.LINEAR,xe.CLAMP_TO_EDGE))):z==="sdf"&&Te.push("SDF_SUBPASS"),ne&&Te.push("HAS_CENTROID"),be.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const Ie=c.layout.get("fill-extrusion-edge-radius"),Re=(Be,Ge,st,it,mt)=>{const Ue=Ge.programConfigurations.get(c.id),Je=f.isTileAffectedByFog(Be),Le=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Te,overrideFog:Je}),lt=((pt,It,ct,wt,Vt,qt,Bt,Xt,cr,gr,Or)=>({u_matrix:It,u_opacity:ct,u_ao_pass:wt?1:0,u_meter_to_tile:Vt,u_ao:qt,u_flood_light_intensity:Bt,u_flood_light_color:Xt,u_attenuation:cr,u_edge_radius:gr,u_fb:0,u_fb_size:Or,u_dynamic_offset:1}))(0,it,j,R,mt,[G,U*mt],q,re,Y,Ae>=17?0:Ie*mt,ce?ce.size[0]:0),Ye=[];ne&&Ye.push(Ge.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ge,Le,Be.toUnwrapped(),null,be),Le.draw(f,ge.gl.TRIANGLES,x,S,E,M,lt,c.id,Ge.vertexBuffer,Ge.indexBuffer,st,c.paint,Ae,Ue,Ye)};for(const Be of p){const Ge=n.getTile(Be),st=Ge.getBucket(c);if(!st||st.projection.name!==Ce.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const it=st.groundEffect,mt=1/st.tileToMeter;{const Ue=f.translatePosMatrix(Be.projMatrix,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Je=it.getDefaultSegment();Re(Be,it,Je,Ue,mt)}if(oe)for(let Ue=0;Ue<4;Ue++){const Je=i.dT[Ue](Be),Le=n.getTile(Je);if(!Le)continue;const lt=Le.getBucket(c);if(!lt||lt.projection.name!==Ce.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const Ye=lt.groundEffect;let pt,It;Ue===0?(pt=[-8192,0,0],It=1):Ue===1?(pt=[i.aj,0,0],It=0):Ue===2?(pt=[0,-8192,0],It=3):(pt=[0,i.aj,0],It=2);const ct=Ye.regionSegments[It];if(!ct)continue;const wt=new Float32Array(16);i.bo(wt,Be.projMatrix,pt),Re(Be,Ye,ct,f.translatePosMatrix(wt,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),mt)}}}function Zt(f,n,c,p,x,S,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=S?S.findDEMTileFor(c):null;if(!(M&&M.dem||E))return;S&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const R=oe=>new i.P(Math.ceil((oe+i.dX)*i.dY),0),z=oe=>{const ce=n.getSource().minzoom,ge=Ce=>{const Ae=n.getTileByID(Ce);if(Ae&&Ae.hasData())return Ae.getBucket(x)},xe=[0,-1,1];for(const Ce of xe){if(oe.overscaledZ+Ce<ce)continue;const Ae=ge(oe.calculateScaledKey(oe.overscaledZ+Ce));if(Ae)return Ae}},j=[0,0,0],G=(oe,ce)=>(j[0]=Math.min(oe.min.y,ce.min.y),j[1]=Math.max(oe.max.y,ce.max.y),j[2]=i.aj-ce.min.x>oe.max.x?ce.min.x-i.aj:oe.max.x,j),U=(oe,ce)=>(j[0]=Math.min(oe.min.x,ce.min.x),j[1]=Math.max(oe.max.x,ce.max.x),j[2]=i.aj-ce.min.y>oe.max.y?ce.min.y-i.aj:oe.max.y,j),q=[(oe,ce)=>G(oe,ce),(oe,ce)=>G(ce,oe),(oe,ce)=>U(oe,ce),(oe,ce)=>U(ce,oe)],re=(oe,ce,ge,xe,Ce,Ae,Te)=>{if(!S)return 0;const be=[[Ae?ge:oe,Ae?oe:ge,0],[Ae?ge:ce,Ae?ce:ge,0]],Ie=Te<0?i.aj+Te:Te,Re=[Ae?Ie:(oe+ce)/2,Ae?(oe+ce)/2:Ie,0];return ge===0&&Te<0||ge!==0&&Te>0?S.getForTilePoints(Ce,[Re],!0,xe):be.push(Re),S.getForTilePoints(c,be,!0,M),Math.max(be[0][2],be[1][2],Re[2])/S.exaggeration()};for(let oe=0;oe<4;oe++){const ce=p.borderFeatureIndices[oe];if(ce.length===0)continue;const ge=i.dT[oe](c),xe=z(ge);if(!(xe&&xe instanceof i.dU))continue;const Ce=S?S.findDEMTileFor(ge):null;if(!(Ce&&Ce.dem||E)||(S&&Ce&&Ce.dem&&p.borderDEMTileTimestamp[oe]!==Ce.dem._timestamp&&(p.borderDoneWithNeighborZ[oe]=-1,p.borderDEMTileTimestamp[oe]=Ce.dem._timestamp),p.borderDoneWithNeighborZ[oe]===xe.canonical.z))continue;xe.centroidVertexArray.length===0&&xe.createCentroidsBuffer();const Ae=(oe<2?1:5)-oe,Te=xe.borderDoneWithNeighborZ[Ae]!==p.canonical.z,be=xe.borderFeatureIndices[Ae];let Ie=0;if(p.canonical.z!==xe.canonical.z){for(const Re of ce)p.showCentroid(p.featuresOnBorder[Re]);if(Te)for(const Re of be)xe.showCentroid(xe.featuresOnBorder[Re]);p.borderDoneWithNeighborZ[oe]=xe.canonical.z,xe.borderDoneWithNeighborZ[Ae]=p.canonical.z}for(const Re of ce){const Be=p.featuresOnBorder[Re],Ge=p.centroidData[Be.centroidDataIndex],st=Be.borders[oe];let it;for(;Ie<be.length;){it=xe.featuresOnBorder[be[Ie]];const mt=it.borders[Ae];if(mt[1]>st[0]+3||mt[0]>st[0]-3)break;xe.showCentroid(it),Ie++}if(it&&Ie<be.length){const mt=Ie;let Ue=0;for(;!(it.borders[Ae][0]>st[1]-3)&&(Ue++,++Ie!==be.length);)it=xe.featuresOnBorder[be[Ie]];it=xe.featuresOnBorder[be[mt]];let Je=!1;if(Ue>=1){const Ye=it.borders[Ae];Math.abs(st[0]-Ye[0])<3&&Math.abs(st[1]-Ye[1])<3&&(Ue=1,Je=!0,Ie=mt+1)}else if(Ue===0){p.showCentroid(Be);continue}const Le=xe.centroidData[it.centroidDataIndex];E&&Je&&(((Y=Ge).flags|(ne=Le).flags)&i.dW?(Y.flags|=i.dW,ne.flags|=i.dW):(Y.flags&=2147483647,ne.flags&=2147483647));const lt=Be.intersectsCount()>1||it.intersectsCount()>1;if(Ue>1)Ie=mt,Ge.centroidXY=Le.centroidXY=new i.P(0,0);else if(Ce&&Ce.dem&&!lt){const Ye=q[oe](Ge,Le),pt=oe%2?i.aj-1:0,It=re(Ye[0],Math.min(i.aj-1,Ye[1]),pt,Ce,ge,oe<2,Ye[2]);Ge.centroidXY=Le.centroidXY=R(It)}else lt?Ge.centroidXY=Le.centroidXY=new i.P(0,0):(Ge.centroidXY=p.encodeBorderCentroid(Be),Le.centroidXY=xe.encodeBorderCentroid(it));p.writeCentroidToBuffer(Ge),xe.writeCentroidToBuffer(Le)}else p.showCentroid(Be)}p.borderDoneWithNeighborZ[oe]=xe.canonical.z,xe.borderDoneWithNeighborZ[Ae]=p.canonical.z}var Y,ne;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const wm=[1,0,0],jl=[0,1,0],qo=[0,0,1];function Fl(f,n,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const S=f.toUnwrapped(),E=p.tileSize*x._cascades[c.currentShadowCascade].scale;let M=n.maxHeight;if(p.elevation){const Y=p.elevation.getMinMaxForTile(f);Y&&(M+=Y.max)}const R=[...x.shadowDirection];R[2]=-R[2];const z=x.computeSimplifiedTileShadowVolume(S,M,E,R);if(!z)return!1;const j=[wm,jl,qo,R,[R[0],0,R[2]],[0,R[1],R[2]]],G=p.projection.name==="globe",U=p.scaleZoom(E),q=i.cn.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,U,!G),re=x.getCurrentCascadeFrustum();return q.intersectsPrecise(z.vertices,z.planes,j)===0||re.intersectsPrecise(z.vertices,z.planes,j)===0}function xr(f){return[f[0]*i.dZ,f[1]*i.dZ,f[2]*i.dZ,0]}function Ra(f,n,c,p,x,S,E,M,R){const z=p.getSource(),j=c.globeSharedBuffers;if(!j)return;let G,U,q;if(n&&(G=p.getTile(n)),z instanceof i.aP?(U=z.texture,q=i.ds(0,0,c.transform)):G&&n&&(U=G.texture,q=i.ds(n.canonical.z,n.canonical.x,c.transform)),!U||!q)return;f||(q=i.cE(i.bz(),q,[1,-1,1]));const re=c.context,Y=re.gl,ne=x.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,oe=c.colorModeForDrapableLayerRenderPass(S),ce=E.defines;ce.push("GLOBE_POLES");const ge=new Kt(Y.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D),xe=Float32Array.from(c.transform.expandedFarZProjMatrix),Ce=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),re.activeTexture.set(Y.TEXTURE0),U.bind(ne,Y.CLAMP_TO_EDGE),re.activeTexture.set(Y.TEXTURE1),U.bind(ne,Y.CLAMP_TO_EDGE),"useMipmap"in U&&re.extTextureFilterAnisotropic&&c.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[Ae,Te,be,Ie]=n?j.getPoleBuffers(n.canonical.z,!1):j.getPoleBuffers(0,!0),Re=x.paint.get("raster-elevation");let Be;f?(Be=Ae,c.renderDefaultNorthPole=Re!==0):(Be=Te,c.renderDefaultSouthPole=Re!==0);const Ge=xr(E.mix),st=((mt,Ue,Je,Le,lt,Ye,pt,It,ct,wt,Vt,qt,Bt)=>Ud(mt,Ue,Je,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],It,2,wt,Vt,qt,1,0,Bt))(xe,Ce,q,i.ah(c.transform.zoom),0,x,0,Re,0,Ge,E.offset,E.range,S),it=c.getOrCreateProgram("raster",{defines:ce});c.uploadCommonUniforms(re,it,null),it.draw(c,Y.TRIANGLES,ge,R,oe,M,st,x.id,Be,be,Ie)}function tu(f){const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,S=n+x;return[n,c,(S-x-n)/p,(S-n)/p]}function Qf(f,n,c,p){if(f)return n instanceof kc&&f instanceof vu?n.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:xr(p.mix),offset:p.offset,buffer:0,tileSize:1}}var ep=i.d_([{name:"a_index",type:"Int16",components:1}]);class Zd{constructor(n,c,p,x){const S={width:p[0],height:p[1],data:null},E=n.gl;this.targetColorTexture=new i.T(n,S,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(n,S,E.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(n,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const S=new i.d$;S.reserve(x);for(let E=0;E<x;E++)S.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(S,ep.members,!0),this.particleSegment=i.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Rg(f,n,c){if(!f)return null;const p=n.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:x,mix:S,offset:E,tileSize:M,buffer:R,format:z}=p;if(!x||!z)return null;let j=!1;return z==="uint32"&&(j=!0,S[3]=0,S=Pa(i.e0,S,[0,c.paint.get("raster-particle-max-speed")]),E=Yf(i.e0,E,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[R/(M+2*R),M/(M+2*R)],tileSize:M,scalarData:j,scale:S,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function qh(f){const n=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-n,x=.2*f.height,S=n+x;return[n,c,(S-x-n)/p,(S-n)/p]}const Bl=new i.am(1,0,0,1),Xd=new i.am(0,1,0,1),oo=new i.am(0,0,1,1),dc=new i.am(1,0,1,1),ao=new i.am(0,1,1,1);function ua(f,n,c,p,x,S){for(let E=0;E<c.length;E++)if(x){const z=new i.am(p.r*.8,p.g*.8,p.b*.8,1);ru(f,n,c[E],p,-1,-1,S),ru(f,n,c[E],p,-1,1,S),ru(f,n,c[E],p,1,1,S),ru(f,n,c[E],p,1,-1,S),ru(f,n,c[E],z,0,0,S)}else ru(f,n,c[E],p,0,0,S)}function ru(f,n,c,p,x,S,E){const M=f.context,R=f.transform,z=M.gl,j=R.projection.name==="globe",G=j?["PROJECTION_GLOBE_VIEW"]:[];let U=i.bw(c.projMatrix);if(j&&i.ah(R.zoom)>0){const Ge=i.bg(c.canonical,R),st=i.e1(Ge);U=i.az(new Float32Array(16),R.globeMatrix,st),i.az(U,R.projMatrix,U)}const q=i.bz();q[12]+=2*x/(i.q.devicePixelRatio*R.width),q[13]+=2*S/(i.q.devicePixelRatio*R.height),i.az(U,q,U);const re=f.getOrCreateProgram("debug",{defines:G}),Y=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(Y,re);const ne=Kt.disabled,oe=Nr.disabled,ce=f.colorModeForRenderPass(),ge="$debug";M.activeTexture.set(z.TEXTURE0),f.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),j?Y._makeGlobeTileDebugBuffers(f.context,R):Y._makeDebugTileBoundsBuffers(f.context,R.projection);const xe=Y._tileDebugBuffer||f.debugBuffer,Ce=Y._tileDebugIndexBuffer||f.debugIndexBuffer,Ae=Y._tileDebugSegments||f.debugSegments;if(re.draw(f,z.LINE_STRIP,ne,oe,ce,Ar.disabled,Ol(U,p.toPremultipliedRenderColor(null)),ge,xe,Ce,Ae,null,null,null,[Y._globeTileDebugBorderBuffer]),E){const Ge=Y.latestRawTileData,st=Math.floor((Ge&&Ge.byteLength||0)/1024);let it=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(it+=` => ${c.overscaledZ}`),it+=` ${Y.state}`,it+=` ${st}kb`,function(mt,Ue){mt.initDebugOverlayCanvas();const Je=mt.debugOverlayCanvas,Le=mt.context.gl,lt=mt.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,Je.width,Je.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(Ue,5,5),lt.strokeText(Ue,5,5),mt.debugOverlayTexture.update(Je),mt.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(f,it)}const Te=n.getTile(c).tileSize,be=512/Math.min(Te,512)*(c.overscaledZ/R.zoom)*.5,Ie=Y._tileDebugTextBuffer||f.debugBuffer,Re=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Be=Y._tileDebugTextSegments||f.debugSegments;re.draw(f,z.TRIANGLES,ne,oe,ln.alphaBlended,Ar.disabled,Ol(U,i.am.transparent.toPremultipliedRenderColor(null),be),ge,Ie,Re,Be,null,null,null,[Y._globeTileDebugTextBuffer])}function Wh(f,n,c,p){fc(f,0,n+c/2,f.transform.width,c,p)}function ns(f,n,c,p){fc(f,n-c/2,0,c,f.transform.height,p)}function fc(f,n,c,p,x,S){const E=f.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*i.q.devicePixelRatio,c*i.q.devicePixelRatio,p*i.q.devicePixelRatio,x*i.q.devicePixelRatio),E.clear({color:S}),M.disable(M.SCISSOR_TEST)}const tp=i.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pl}=tp;function Hn(f,n,c,p){f.emplaceBack(n,c,p)}class Hu{constructor(n){this.vertexArray=new i.e2,this.indices=new i.a_,Hn(this.vertexArray,-1,-1,1),Hn(this.vertexArray,1,-1,1),Hn(this.vertexArray,-1,1,1),Hn(this.vertexArray,1,1,1),Hn(this.vertexArray,-1,-1,-1),Hn(this.vertexArray,1,-1,-1),Hn(this.vertexArray,-1,1,-1),Hn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pl),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=i.bd.simpleSegment(0,0,36,12)}}function ha(f,n,c,p,x,S){const E=f.context.gl,M=n.paint.get("sky-atmosphere-color"),R=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),j=((G,U,q,re,Y)=>({u_matrix_3f:G,u_sun_direction:U,u_sun_intensity:q,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(i.e4(i.dx(),p),x,z,M.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+S,n.skyboxTexture,0),c.draw(f,E.TRIANGLES,Kt.disabled,Nr.disabled,ln.unblended,Ar.frontCW,j,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const ds=i.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class js{constructor(n){const c=new i.e5;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new i.a_;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,ds.members),this.indexBuffer=n.createIndexBuffer(p),this.segments=i.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ks=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class rp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Vl{constructor(n){this.colorModeAlphaBlendedWriteRGB=new ln([1,Cu,1,Cu],i.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ln([1,0,1,0],i.am.transparent,[!1,!1,!1,!0]),this.params=new rp,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){const c=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new js(c);const p=this.params.sizeRange,x=this.params.intensityRange,S=function(j){const G=i.e7(30),U=[];for(let q=0;q<j;++q){const re=2*Math.PI*G(),Y=Math.acos(1-2*G())-.5*Math.PI;U.push(i.cS(Math.cos(Y)*Math.cos(re),Math.cos(Y)*Math.sin(re),Math.sin(Y)))}return U}(this.params.starsCount),E=i.e7(300),M=new i.e6,R=new i.a_;let z=0;for(let j=0;j<S.length;++j){const G=i.bY([],S[j],200),U=Math.max(0,1+.01*p*(1*E()-.5)),q=Math.max(0,1+.01*x*(1*E()-.5));M.emplaceBack(G[0],G[1],G[2],-1,-1,U,q),M.emplaceBack(G[0],G[1],G[2],1,-1,U,q),M.emplaceBack(G[0],G[1],G[2],1,1,U,q),M.emplaceBack(G[0],G[1],G[2],-1,1,U,q),R.emplaceBack(z+0,z+1,z+2),R.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(M,Ks.members),this.starsIdx=c.createIndexBuffer(R),this.starsSegments=i.bd.simpleSegment(0,0,M.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,c){const p=n.context,x=p.gl,S=n.transform,E=new Kt(x.LEQUAL,Kt.ReadOnly,[0,1]),M=i.ah(S.zoom),R=n.style.getLut(c.scope),z=c.properties.get("color-use-theme")==="none",j=c.properties.get("color").toNonPremultipliedRenderColor(z?null:R).toArray01(),G=c.properties.get("high-color-use-theme")==="none",U=c.properties.get("high-color").toNonPremultipliedRenderColor(G?null:R).toArray01(),q=c.properties.get("space-color-use-theme")==="none",re=c.properties.get("space-color").toNonPremultipliedRenderColor(q?null:R).toArray01(),Y=5e-4,ne=i.e8(c.properties.get("horizon-blend"),0,1,Y,.25),oe=i.dl(n,p,S)&&ne===Y?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,ce=n.frameCounter/1e3%1,ge=i.ae(S.globeCenterInViewSpace),xe=Math.sqrt(Math.pow(ge,2)-Math.pow(oe,2)),Ce=Math.acos(xe/ge),Ae=Te=>{const be=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&be.push("ALPHA_PASS");const Ie=n.getOrCreateProgram("globeAtmosphere",{defines:be}),Re=((Ge,st,it,mt,Ue,Je,Le,lt,Ye,pt,It,ct)=>({u_frustum_tl:Ge,u_frustum_tr:st,u_frustum_br:it,u_frustum_bl:mt,u_horizon:Ue,u_transition:Je,u_fadeout_range:Le,u_color:lt,u_high_color:Ye,u_space_color:pt,u_temporal_offset:It,u_horizon_angle:ct}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,M,ne,j,U,re,ce,Ce);n.uploadCommonUniforms(p,Ie);const Be=this.atmosphereBuffer;Be&&Ie.draw(n,x.TRIANGLES,E,Nr.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ar.backCW,Re,Te?"atmosphere_glow_alpha":"atmosphere_glow",Be.vertexBuffer,Be.indexBuffer,Be.segments)};Ae(!1),Ae(!0)}drawStars(n,c){const p=i.ay(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=n.context,S=x.gl,E=n.transform,M=n.getOrCreateProgram("stars"),R=i.b_([]);i.c0(R,R,-E._pitch),i.b$(R,R,-E.angle),i.c0(R,R,i.al(E._center.lat)),i.e9(R,R,-i.al(E._center.lng));const z=i.c3(new Float32Array(16),R),j=i.az([],E.starsProjMatrix,z),G=i.e4([],z),U=i.ea([],G),q=[0,1,0];i.dz(q,q,U),i.bY(q,q,this.params.sizeMultiplier);const re=[1,0,0];i.dz(re,re,U),i.bY(re,re,this.params.sizeMultiplier);const Y=(ne=q,oe=re,ce=p,{u_matrix:Float32Array.from(j),u_up:ne,u_right:oe,u_intensity_multiplier:ce});var ne,oe,ce;n.uploadCommonUniforms(x,M),this.starsVx&&this.starsIdx&&M.draw(n,S.TRIANGLES,Kt.disabled,Nr.disabled,this.colorModeAlphaBlendedWriteRGB,Ar.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ml(f,n){const c=[...f],p=n.cameraWorldSizeForFog/n.worldSize,x=i.bx([]);return i.cE(x,x,[p,p,1]),i.az(c,x,c),i.az(c,n.worldToFogMatrix,c),c}function Tt(f,n,c,p,x){const S=c.material,E=p.context,{baseColorTexture:M,metallicRoughnessTexture:R}=S.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:j,emissionTexture:G}=S;function U(re,Y,ne){if(re&&(f.push(Y),E.activeTexture.set(E.gl.TEXTURE0+ne),re.gfxTexture)){const{minFilter:oe,magFilter:ce,wrapS:ge,wrapT:xe}=re.sampler;re.gfxTexture.bindExtraParam(oe,ce,ge,xe)}}U(M,"HAS_TEXTURE_u_baseColorTexture",Io.BaseColor),U(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Io.MetallicRoughness),U(z,"HAS_TEXTURE_u_normalTexture",Io.Normal),U(j,"HAS_TEXTURE_u_occlusionTexture",Io.Occlusion),U(G,"HAS_TEXTURE_u_emissionTexture",Io.Emission),x&&(x.texture||(x.texture=new i.eh(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Io.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(c.pbrBuffer)),S.alphaMode!=="OPAQUE"&&S.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||f.push("DIFFUSE_SHADED");const q=p.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function zt(f,n,c,p,x,S){const E=c.paint.get("model-opacity").constantOr(1),M=n.context,R=new Kt(n.context.gl.LEQUAL,Kt.ReadWrite,n.depthRangeFor3D),z=n.transform,j=f.mesh,G=j.material,U=G.pbrMetallicRoughness,q=n.style.fog;let re;re=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.az([],p.zScaleMatrix,f.nodeModelMatrix),i.az(re,p.negCameraPosMatrix,re);const Y=i.bi([],re);i.ee(Y,Y);const ne=c.paint.get("model-color-use-theme").constantOr("default")==="none",oe=c.paint.get("model-emissive-strength").constantOr(0),ce=Xc(new Float32Array(f.worldViewProjection),new Float32Array(re),new Float32Array(Y),null,n,E,U.baseColorFactor,G.emissiveFactor,U.metallicFactor,U.roughnessFactor,G,oe,c),ge={defines:[]},xe=[],Ce=n.shadowRenderer;Ce&&(Ce.useNormalOffset=!1),Tt(ge.defines,xe,j,n,ne?null:c.lut);let Ae=null;if(q){const Ie=ml(f.nodeModelMatrix,n.transform);if(Ae=new Float32Array(Ie),z.projection.name!=="globe"){const Re=j.aabb.min,Be=j.aabb.max,[Ge,st]=q.getOpacityForBounds(Ie,Re[0],Re[1],Be[0],Be[1]);ge.overrideFog=Ge>=Ze||st>=Ze}}const Te=sa(n,c.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&ge.defines.push("RENDER_CUTOFF");const be=n.getOrCreateProgram("model",ge);n.uploadCommonUniforms(M,be,null,Ae,Te),n.renderPass!=="shadow"&&Ce&&Ce.setupShadowsFromMatrix(f.nodeModelMatrix,be),be.draw(n,M.gl.TRIANGLES,R,x,S,j.material.doubleSided?Ar.disabled:Ar.backCCW,ce,c.id,j.vertexBuffer,j.indexBuffer,j.segments,c.paint,n.transform.zoom,void 0,xe)}function pc(f,n,c,p,x,S,E){let M;M=f.projection.name==="globe"?i.ed(c,f):[...c],i.az(M,M,n.matrix);const R=i.az([],p,M);if(n.meshes)for(const z of n.meshes){if(z.material.alphaMode!=="BLEND"){E.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:R,nodeModelMatrix:M});continue}const j=i.ad([],z.centroid,R);!f.isOrthographic&&j[2]<=0||S.push({mesh:z,depth:j[2],modelIndex:x,worldViewProjection:R,nodeModelMatrix:M})}if(n.children)for(const z of n.children)pc(f,z,c,p,x,S,E)}function Di(f,n,c,p){const x=c.shadowRenderer;if(!x)return;const S=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),M=x.calculateShadowPassMatrixFromMatrix(n),R=bm(M);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,S,Nr.disabled,E,Ar.backCCW,R,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function $e(f,n,c){const p=n.updateZoomBasedPaintProperties(),x=function(S,E,M){let R,z,j,G=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&G>0){const U=S.terrain,q=U.findDEMTileFor(M);q&&q.dem?R=i.ei.create(U,M,q):G=0}if(G===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),G===E.validForExaggeration&&(G===0||R&&R._demTile&&R._demTile.tileID===E.validForDEMTile.id&&R._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const U in E.instancesPerModel){const q=E.instancesPerModel[U];for(let re=0;re<q.instancedDataArray.length;++re){const Y=(R?G*R.getElevationAt(0|q.instancedDataArray.float32[16*re],0|q.instancedDataArray.float32[16*re+1],!0,!0):0)+q.instancesEvaluatedElevation[re];q.instancedDataArray.float32[16*re+6]=Y,z=z?Math.min(E.terrainElevationMin,Y):Y,j=j?Math.max(E.terrainElevationMax,Y):Y}}return E.terrainElevationMin=z||0,E.terrainElevationMax=j||0,E.validForExaggeration=G,E.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,n,c);(p||x)&&(n.uploaded=!1,n.upload(f.context))}const Fs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cW([0,0,0],[i.aj,i.aj,0])};function Wo(f,n){const c=1<<f.canonical.z,p=n.getFreeCameraOptions().position,x=n.elevation,S=f.canonical.x/c,E=(f.canonical.x+1)/c,M=f.canonical.y/c,R=(f.canonical.y+1)/c;let z=n._centerAltitude;if(x){const q=x.getMinMaxForTile(f);q&&q.max>z&&(z=q.max)}const j=i.ay(p.x,S,E)-p.x,G=i.ay(p.y,M,R)-p.y,U=i.c6(z,n.center.lat)-p.z;return n._zoomFromMercatorZ(Math.sqrt(j*j+G*G+U*U))}function nu(f,n,c,p,x,S,E){const M=f.context,R=f.renderPass==="shadow",z=f.shadowRenderer,j=R&&z?z.getShadowPassDepthMode():new Kt(M.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),G=f.isTileAffectedByFog(S);if(c.meshes)for(const U of c.meshes){const q=["MODEL_POSITION_ON_GPU"],re=[];let Y,ne,oe;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ce=sa(f,n.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),R&&z)Y=f.getOrCreateProgram("modelDepth",{defines:q}),ne=bm(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.matrix)),oe=z.getShadowPassColorMode();else{Tt(q,re,U,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),Y=f.getOrCreateProgram("model",{defines:q,overrideFog:G});const xe=U.material,Ce=xe.pbrMetallicRoughness,Ae=n.paint.get("model-opacity").constantOr(1),Te=n.paint.get("model-emissive-strength").constantOr(0);ne=Xc(S.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,f,Ae,Ce.baseColorFactor,xe.emissiveFactor,Ce.metallicFactor,Ce.roughnessFactor,xe,Te,n,x),z&&(E.shadowUniformsInitialized?Y.setShadowUniformValues(M,z.getShadowUniformValues()):(z.setupShadows(S.toUnwrapped(),Y,"model-tile",S.overscaledZ),E.shadowUniformsInitialized=!0)),oe=ce.shouldRenderCutoff||Ae<1||xe.alphaMode!=="OPAQUE"?ln.alphaBlended:ln.unblended}f.uploadCommonUniforms(M,Y,S.toUnwrapped(),null,ce);const ge=U.material.doubleSided?Ar.disabled:Ar.backCCW;if(p.instancedDataArray.length>20)re.push(p.instancedDataBuffer),Y.draw(f,M.gl.TRIANGLES,j,Nr.disabled,oe,ge,ne,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,f.transform.zoom,void 0,re,p.instancedDataArray.length);else{const xe=R?"u_instance":"u_normal_matrix";for(let Ce=0;Ce<p.instancedDataArray.length;++Ce)ne[xe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ce,16),Y.draw(f,M.gl.TRIANGLES,j,Nr.disabled,oe,ge,ne,n.id,U.vertexBuffer,U.indexBuffer,U.segments,n.paint,f.transform.zoom,void 0,re)}}if(c.children)for(const U of c.children)nu(f,n,U,p,x,S,E)}const Kd=[1,-1,1];function np(f,n,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const S=c.shadowRenderer,E=n.aabb;let M=!0,R=f.maxHeight;if(R===0){let j=0;for(const G in f.instancesPerModel){const U=x.getModel(G,p);U?j=Math.max(j,Math.max(Math.max(U.aabb.max[0],U.aabb.max[1]),U.aabb.max[2])):M=!1}R=f.maxScale*j*1.41+f.maxVerticalOffset,M&&(f.maxHeight=R)}E.max[2]=R,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,i.ad(E.min,E.min,n.tileMatrix),i.ad(E.max,E.max,n.tileMatrix);const z=E.intersects(S.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=z===2),z===0}function Sm(f,n){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],S=f.uniformValues.u_cutoff_params[3];return p===c||S===x?1:i.ay(((n-c)/(p-c)-x)/(S-x),0,1)}function Gu(f,n,c,p){if(n.pitch<20)return 1;const x=n.getWorldToCameraMatrix();i.az(x,x,f);const S=i.ej(c.min[0],c.min[1],c.min[2],1);let E=i.aA(i.ek(),S,x),M=E,R=E;S[1]=c.max[1],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R,S[0]=c.max[0],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R,S[1]=c.min[1],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R;const z=i.ay(p[0],0,1),j=100*n.pixelsPerMeter*i.ay(p[1],0,1),G=i.ay(p[2],0,1),U=i.el(i.ek(),M,R,z),q=Math.tan(.5*n.fovX),re=-U[2]*q;if(j===0)return U[1]<-Math.abs(re)?G:1;const Y=(-Math.abs(re)-U[1])/j,ne=(ce,ge,xe)=>(1-xe)*ce+xe*ge,oe=i.ay(ne(1,G,Y),G,1);return ne(1,oe,i.ay((n.pitch-20)/20,0,1))}class Ng{}class Dg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,c,p){{const G=this._storage.get(c.id);if(G)return G.lastUsedFrameIdx=n,G.buf}const x=p.gl,S=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(S),M=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const R=new i.en;for(let G=0;G<S/2;G+=3){const U=M[G],q=M[G+1],re=M[G+2];R.emplaceBack(U,q),R.emplaceBack(q,re),R.emplaceBack(re,U)}const z=p.bindVertexArrayOES.current,j=new Ng;return j.buf=new ca(p,R),j.lastUsedFrameIdx=n,this._storage.set(c.id,j),p.bindVertexArrayOES.set(z),j.buf}update(n){for(const[c,p]of this._storage)n-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[n,c]of this._storage)c.buf.destroy(),this._storage.delete(n)}}class Tm{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Yd=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ip{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class sp{constructor(n,c){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Zh=i.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Jd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,c){const p=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new i.eo,M=new i.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(E,Zh.members),this.vignetteIdx=n.context.createIndexBuffer(M)}const x=i.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,p);const E={u_vignetteShape:(S={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:S.vignetteColor};p.draw(n,n.context.gl.TRIANGLES,Kt.disabled,Nr.disabled,ln.alphaBlended,Ar.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var S}}class iu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,c){const p=n.getFreeCameraOptions().position,x=p.toAltitude(),S=p.toLngLat(),E=i.al(S.lng),M=i.al(S.lat),R=n.pixelsPerMeter/c,z=E*i.eq,j=i.eq*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const G=-this._offsetYPrev+j,U=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*R,this._accumulatedOffsetY+=G*R,this._accumulatedElevation+=U*R,this._offsetXPrev=z,this._offsetYPrev=j,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ul(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function op(f){const n=i.e7(1323123451230),c=[];for(let p=0;p<f;++p){const x=2*n()-1,S=2*n()-1,E=2*n()-1;c.push(i.cS(x,S,E))}return c}function $l(f,n,c,p,x){const S=i.ay((x-c)/(p-c),0,1);return(1-S)*f+S*n}class lo{constructor(n){this._movement=new iu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Jd,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,c){const p=n.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,S=i.b_([]);i.c0(S,S,i.al(90)-p._pitch),i.b$(S,S,-p.angle);const E=i.c3(new Float32Array(16),S),M=i.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=i.ee([],M),z=i.az([],R,E),j=Date.now()/1e3;return this._accumulatedTimeFromStart+=(j-this._prevTime)*c,this._prevTime=j,{projectionMatrix:x,modelviewMatrix:z}}}class Og extends lo{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new sp(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=op(this.particlesCount),x=new i.er,S=new i.a_;let E=0;const M=i.e7(1323123451230);for(let R=0;R<p.length;++R){const z=p[R],j=[2*M()-1,M(),M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...j),x.emplaceBack(z[0],z[1],z[2],1,-1,...j),x.emplaceBack(z[0],z[1],z[2],1,1,...j),x.emplaceBack(z[0],z[1],z[2],-1,1,...j),S.emplaceBack(E+0,E+1,E+2),S.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,Yd.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=n.transform.zoom;if(c.revealStart>p)return;const x=$l(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const S=structuredClone(this._params);let E=[-S.direction.x,S.direction.y,-100];i.au(E,E);const M=structuredClone(this._vignetteParams);M.strength*=x,S.overrideStyleParameters||(S.intensity=n.style.rain.state.density,S.timeFactor=n.style.rain.state.intensity,S.color=structuredClone(n.style.rain.state.color),E=structuredClone(n.style.rain.state.direction),S.screenThinning.intensity=n.style.rain.state.centerThinning,S.dropletSizeX=n.style.rain.state.dropletSize[0],S.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],S.distortionStrength=100*n.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(n.style.rain.state.vignetteColor));const R=this.updateOnRender(n,S.timeFactor),z=n.context,j=z.gl,G=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new i.T(z,{width:n.width,height:n.height,data:null},j.RGBA8)),S.distortionStrength>0&&(z.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),j.copyTexSubImage2D(j.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const U=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(z,U),z.activeTexture.set(j.TEXTURE0),this.screenTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const q=[S.color.r,S.color.g,S.color.b,S.color.a],re=(Y,ne)=>{const oe=Ul(this._movement.getPosition(),Y),ce=S.dropletSizeX,ge=S.dropletSizeX*S.dropletSizeYScale,xe=n.width/2,Ce=n.height/2,Ae=$l(0,S.screenThinning.start,0,1,S.screenThinning.intensity),Te=$l(.001,S.screenThinning.range,0,1,S.screenThinning.intensity),be=$l(0,S.screenThinning.particleOffset,0,1,S.screenThinning.intensity),Ie=(Re={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:S.velocityConeAperture,velocity:S.velocity,boxSize:Y,rainDropletSize:[ce,ge],distortionStrength:S.distortionStrength,rainDirection:E,color:q,screenSize:[G.width,G.height],thinningCenterPos:[xe,Ce],thinningShape:[Ae,Te,Math.pow(10,S.screenThinning.fadePower)],thinningAffectedRatio:S.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:S.shapeDirPower,shapeNormalPower:S.shapeNormalPower,mode:ne?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;const Be=Math.round(S.intensity*this.particlesCount),Ge=i.bd.simpleSegment(0,0,4*Be,2*Be);U.draw(n,j.TRIANGLES,Kt.disabled,Nr.disabled,ln.alphaBlended,Ar.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};S.distortionStrength>0&&re(S.boxSize,!0),re(S.boxSize,!1),this._vignette.draw(n,M)}}const Xh=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class pi extends lo{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new sp(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const c=n.context;if(!this.particlesVx){const p=op(this.particlesCount),x=new i.es,S=new i.a_;let E=0;const M=i.e7(1323123451230);for(let R=0;R<p.length;++R){const z=p[R],j=M(),G=M(),U=M(),q=[R/p.length,j,G,U],re=[M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...q,...re),x.emplaceBack(z[0],z[1],z[2],1,-1,...q,...re),x.emplaceBack(z[0],z[1],z[2],1,1,...q,...re),x.emplaceBack(z[0],z[1],z[2],-1,1,...q,...re),S.emplaceBack(E+0,E+1,E+2),S.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,Xh.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];i.au(p,p);const x=structuredClone(this._vignetteParams),S=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=n.transform.zoom;if(S.revealStart>E)return;const M=$l(0,1,S.revealStart,S.revealStart+S.revealRange,E);x.strength*=M,c.overrideStyleParameters||(c.intensity=n.style.snow.state.density,c.timeFactor=n.style.snow.state.intensity,c.color=structuredClone(n.style.snow.state.color),p=structuredClone(n.style.snow.state.direction),c.screenThinning.intensity=n.style.snow.state.centerThinning,c.billboardSize=2.79*n.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(n.style.snow.state.vignetteColor));const R=this.updateOnRender(n,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=n.context,j=z.gl,G=n.transform,U=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(z,U),((q,re,Y)=>{const ne=Ul(this._movement.getPosition(),q),oe=G.width/2,ce=G.height/2,ge=$l(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),xe=$l(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ce=$l(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Ae=(Te={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:q,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[G.width,G.height],thinningCenterPos:[oe,ce],thinningShape:[ge,xe,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ce,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:p},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const be=Math.round(Y.intensity*this.particlesCount),Ie=i.bd.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&U.draw(n,j.TRIANGLES,Kt.disabled,Nr.disabled,ln.alphaBlended,Ar.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ie)})(c.boxSize,0,c),this._vignette.draw(n,x)}}const Tn={symbol:function(f,n,c,p,x){if(f.renderPass!=="translucent")return;const S=Nr.disabled,E=f.colorModeForRenderPass(),M=c.layout.get("text-variable-anchor"),R=c.layout.get("text-size-scale-range"),z=i.ay(f.scaleFactor,R[0],R[1]);M&&function(U,q,re,Y,ne,oe,ce,ge){const xe=q.transform,Ce=ne==="map",Ae=oe==="map";for(const Te of U){const be=Y.getTile(Te),Ie=be.getBucket(re);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Re=i.bH(Ie.textSizeData,xe.zoom,ge),Be=Sh(Te,Ie.getProjection(),xe),Ge=xe.calculatePixelsToTileUnitsMatrix(be),st=tc(Be,be.tileID.canonical,Ae,Ce,xe,Ie.getProjection(),Ge),it=Ie.hasIconTextFit()&&Ie.hasIconData();Re&&$u(Ie,Ce,Ae,ce,xe,st,Te,Math.pow(2,xe.zoom-be.tileID.overscaledZ),Re,it)}}(p,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,z);const j=c.paint.get("icon-opacity").constantOr(1)!==0,G=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(j||G)?Jc(f,n,c,p,S,E):(j&&Jc(f,n,c,p,S,E,{onlyIcons:!0}),G&&Jc(f,n,c,p,S,E,{onlyText:!0})),n.map.showCollisionBoxes&&(hc(f,n,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),hc(f,n,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),S=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0,R=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(S.constantOr(1)===0||E.constantOr(1)===0))return;const z=f.context,j=z.gl,G=f.transform,U=!(!f.terrain||!f.terrain.enabled),q=c.layout.get("circle-elevation-reference"),re=f.depthModeForSublayer(0,Kt.ReadOnly),Y=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),ne=q==="none"||U?re:Y,oe=Nr.disabled,ce=f.colorModeForDrapableLayerRenderPass(R),ge=G.projection.name==="globe",xe=[i.aD(G.center.lng),i.aH(G.center.lat)],Ce=[];for(let Te=0;Te<p.length;Te++){const be=p[Te],Ie=n.getTile(be),Re=Ie.getBucket(c);if(!Re||Re.projection.name!==G.projection.name)continue;const Be=Re.programConfigurations.get(c.id),Ge=Re.layoutVertexBuffer,st=Re.globeExtVertexBuffer,it=Re.indexBuffer,mt=i.dK(c),Ue=[st],Je=f.isTileAffectedByFog(be);ge&&mt.push("PROJECTION_GLOBE_VIEW"),mt.push("DEPTH_D24"),f.terrain&&G.depthOcclusionForSymbolsAndCircles&&mt.push("DEPTH_OCCLUSION"),Re.hasElevation&&(mt.push("ELEVATED_ROADS"),Ue.push(Re.elevatedLayoutVertexBuffer));const Le=f.getOrCreateProgram("circle",{config:Be,defines:mt,overrideFog:Je}),lt=G.projection.createInversionMatrix(G,be.canonical),Ye={programConfiguration:Be,program:Le,layoutVertexBuffer:Ge,dynamicBuffers:Ue,indexBuffer:it,uniformValues:i.dL(f,be,Ie,lt,xe,c),tile:Ie};if(M){const pt=Re.segments.get();for(const It of pt)Ce.push({segments:new i.bd([It]),sortKey:It.sortKey,state:Ye})}else Ce.push({segments:Re.segments,sortKey:0,state:Ye})}M&&Ce.sort((Te,be)=>Te.sortKey-be.sortKey);const Ae={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const Te of Ce){const{programConfiguration:be,program:Ie,layoutVertexBuffer:Re,dynamicBuffers:Be,indexBuffer:Ge,uniformValues:st,tile:it}=Te.state,mt=Te.segments;f.terrain&&f.terrain.setupElevationDraw(it,Ie,Ae),f.uploadCommonUniforms(z,Ie,it.tileID.toUnwrapped()),Ie.draw(f,j.TRIANGLES,ne,oe,ce,Ar.disabled,st,c.id,Re,Ge,mt,c.paint,G.zoom,be,Be)}},heatmap:function(f,n,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,S=x.gl,E=Nr.disabled,M=new ln([S.ONE,S.ONE,S.ONE,S.ONE],i.am.transparent,[!0,!0,!0,!0]);(function(q,re,Y,ne){const oe=q.gl,ce=re.width*ne,ge=re.height*ne;q.activeTexture.set(oe.TEXTURE1),q.viewport.set([0,0,ce,ge]);let xe=Y.heatmapFbo;if(!xe||xe&&(xe.width!==ce||xe.height!==ge)){xe&&xe.destroy();const Ce=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,Ce),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),xe=Y.heatmapFbo=q.createFramebuffer(ce,ge,!0,null),function(Ae,Te,be,Ie,Re,Be){const Ge=Ae.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Re,Be,0,Ge.RGBA,Ae.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Ie.colorAttachment.set(be)}(q,0,Ce,xe,ce,ge)}else oe.bindTexture(oe.TEXTURE_2D,xe.colorAttachment.get()),q.bindFramebuffer.set(xe.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:i.am.transparent});const R=f.transform,z=R.projection.name==="globe",j=z?["PROJECTION_GLOBE_VIEW"]:[],G=z?Ar.frontCCW:Ar.disabled,U=[i.aD(R.center.lng),i.aH(R.center.lat)];for(let q=0;q<p.length;q++){const re=p[q];if(n.hasRenderableParent(re))continue;const Y=n.getTile(re),ne=Y.getBucket(c);if(!ne||ne.projection.name!==R.projection.name)continue;const oe=f.isTileAffectedByFog(re),ce=ne.programConfigurations.get(c.id),ge=f.getOrCreateProgram("heatmap",{config:ce,defines:j,overrideFog:oe}),{zoom:xe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,ge),f.uploadCommonUniforms(x,ge,re.toUnwrapped());const Ce=R.projection.createInversionMatrix(R,re.canonical);ge.draw(f,S.TRIANGLES,Kt.disabled,E,M,G,Ll(f,re,Y,Ce,U,xe,c.paint.get("heatmap-intensity")),c.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,c.paint,f.transform.zoom,ce,z?[ne.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,S){const E=x.context,M=E.gl,R=S.heatmapFbo;if(!R)return;E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),E.activeTexture.set(M.TEXTURE1);let z=S.colorRampTexture;z||(z=S.colorRampTexture=new i.T(E,S.colorRamp,M.RGBA8)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,M.TRIANGLES,Kt.disabled,Nr.disabled,x.colorModeForRenderPass(),Ar.disabled,((j,G,U,q)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,S),S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(f,c))},line:function(f,n,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),S=c.paint.get("line-width");if(x.constantOr(1)===0||S.constantOr(1)===0)return;const E=c.paint.get("line-emissive-strength"),M=c.paint.get("line-occlusion-opacity"),R=c.layout.get("line-elevation-reference"),z=c.layout.get("line-width-unit")==="meters",j=R==="sea",G=!(!f.terrain||!f.terrain.enabled),U=f.context,q=U.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const re=c.layout.get("line-cross-slope"),Y=re!==void 0,ne=re<1,oe=f.colorModeForDrapableLayerRenderPass(E),ce=f.terrain&&f.terrain.renderingToTexture,ge=ce?1:i.q.devicePixelRatio,xe=c.paint.get("line-dasharray"),Ce=xe.constantOr(1),Ae=c.layout.get("line-cap"),Te=xe.constantOr(null),be=Ae.constantOr(null),Ie=c.paint.get("line-pattern"),Re=Ie.constantOr(1),Be=c.paint.get("line-pattern-cross-fade"),Ge=Ie.constantOr(null),st=c.paint.get("line-opacity").constantOr(1);let it=!Re&&st!==1||f.depthOcclusion&&M>0&&M<1;const mt=c.paint.get("line-gradient"),Ue=Re?"linePattern":"line",Je=i.dM(c);let Le;if(ce&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(it=!1),M!==0&&f.depthOcclusion){const It=c.paint._values["line-opacity"];It&&It.value&&It.value.kind==="constant"?Le=It.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}S.value.kind!=="constant"&&S.value.isLineProgressConstant===!1&&Je.push("VARIABLE_LINE_WIDTH");const lt=(It,ct,wt,Vt,qt,Bt)=>{for(const Xt of It){const cr=n.getTile(Xt);if(Re&&!cr.patternsLoaded())continue;const gr=cr.getBucket(c);if(!gr||gr.elevationType!=="none"&&!qt||gr.elevationType==="none"&&qt)continue;f.prepareDrawTile();const Or=[...ct],Qr=f.shadowRenderer,wn=gr.elevationType==="road"&&!!Qr&&Qr.enabled;let oi=[0,0,0];if(wn){const bn=f.style.directionalLight,Bi=f.style.ambientLight;bn&&Bi&&(oi=ac(f.style,bn,Bi)),Or.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Vn=gr.programConfigurations.get(c.id);let Pn=!1;if(Ge&&cr.imageAtlas){const bn=i.dN.from(Ge),Bi=bn.getPrimary().scaleSelf(ge).toString(),mi=cr.imageAtlas.patternPositions.get(Bi),Gn=bn.getSecondary(),hi=Gn?cr.imageAtlas.patternPositions.get(Gn.scaleSelf(ge).toString()):null;Pn=!!mi&&!!hi,mi&&Vn.setConstantPatternPositions(mi,hi)}Be>0&&(Pn||Vn.getPatternTransitionVertexBuffer("line-pattern"))&&Or.push("LINE_PATTERN_TRANSITION");const $i=f.isTileAffectedByFog(Xt),Vr=f.getOrCreateProgram(Ue,{config:Vn,defines:Or,overrideFog:$i,overrideRtt:!qt&&void 0});if(!Re&&Te&&be&&cr.lineAtlas){const bn=cr.lineAtlas.getDash(Te,be);bn&&Vn.setConstantPatternPositions(bn)}wn&&Qr.setupShadows(cr.tileID.toUnwrapped(),Vr,"vector-tile",cr.tileID.overscaledZ);let[en,un]=c.paint.get("line-trim-offset");(be==="round"||be==="square")&&en!==un&&(en===0&&(en-=1),un===1&&(un+=1));const ai=ce?Xt.projMatrix:null,Ji=z?1/gr.tileToMeter/i.aw(cr,1,f.transform.zoom):1,ui=z?1/gr.tileToMeter/i.aw(cr,1,Math.floor(f.transform.zoom)):1,Ln=Re?i.dO(f,cr,c,ai,ge,Ji,ui,[en,un],oi,Be):i.dP(f,cr,c,ai,gr.lineClipsArray.length,ge,Ji,ui,[en,un],oi);if(mt){const bn=gr.gradients[c.id];let Bi=bn.texture;if(c.gradientVersion!==bn.version){let mi=256;if(c.stepInterpolant){const Gn=n.getSource().maxzoom,hi=Xt.canonical.z===Gn?Math.ceil(1<<f.transform.maxZoom-Xt.canonical.z):1;mi=i.ay(i.dQ(gr.maxLineLength/i.aj*1024*hi),256,U.maxTextureSize)}bn.gradient=i.dR({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:mi,image:bn.gradient||void 0,clips:gr.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new i.T(U,bn.gradient,q.RGBA8),bn.version=c.gradientVersion,Bi=bn.texture}U.activeTexture.set(q.TEXTURE1),Bi.bind(c.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Ce&&(U.activeTexture.set(q.TEXTURE0),cr.lineAtlasTexture&&cr.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Vn.updatePaintBuffers()),Re&&(U.activeTexture.set(q.TEXTURE0),cr.imageAtlasTexture&&cr.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Vn.updatePaintBuffers()),qt&&!j&&f.terrain.setupElevationDraw(cr,Vr),f.uploadCommonUniforms(U,Vr,Xt.toUnwrapped());const Fi=bn=>{Le!=null&&(Le.value=st*M),Vr.draw(f,q.TRIANGLES,wt,bn,oe,Ar.disabled,Ln,c.id,gr.layoutVertexBuffer,gr.indexBuffer,gr.segments,c.paint,f.transform.zoom,Vn,[gr.layoutVertexBuffer2,gr.patternVertexBuffer,gr.zOffsetVertexBuffer]),Le!=null&&(Le.value=st)};if(it&&!qt){const bn=f.stencilModeForClipping(Xt).ref;bn===0&&ce&&U.clear({stencil:0});const Bi={func:q.EQUAL,mask:255};Ln.u_alpha_discard_threshold=.8,Fi(new Nr(Bi,bn,255,q.KEEP,q.KEEP,q.INVERT)),Ln.u_alpha_discard_threshold=0,Fi(new Nr(Bi,bn,255,q.KEEP,q.KEEP,q.KEEP))}else Ln.u_alpha_discard_threshold=it&&qt&&Bt?.8:0,Fi(qt?Vt:f.stencilModeForClipping(Xt))}};let Ye=f.depthModeForSublayer(0,Kt.ReadOnly);const pt=new Kt(f.depthOcclusion?q.GREATER:q.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const It=!ce&&f.terrain;M!==0&&It?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):It?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):lt(p,Je,Ye,Nr.disabled,!1,!0)}if(c.hasElevatedBuckets){R==="hd-road-markup"?G||(Ye=pt,Je.push("ELEVATED_ROADS")):(Je.push("ELEVATED"),Ye=pt,Y&&Je.push(ne?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),j&&Je.push("ELEVATION_REFERENCE_SEA"));const It=it?f.stencilModeFor3D():Nr.disabled;f.forceTerrainMode=!0,lt(p,Je,Ye,It,!0,!0),it&&lt(p,Je,Ye,It,!0,!1),f.forceTerrainMode=!1}it&&(f.resetStencilClippingMasks(),ce&&U.clear({stencil:0})),M===0||f.depthOcclusion||ce||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,c,p){const x=c.paint.get("fill-color"),S=c.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const E=c.paint.get("fill-emissive-strength"),M=f.colorModeForDrapableLayerRenderPass(E),R=c.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&x.constantOr(i.am.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";let j="none";c.layout.get("fill-elevation-reference")!=="none"?j="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(j="offset");const G=!(!f.terrain||!f.terrain.enabled),U={painter:f,sourceCache:n,layer:c,coords:p,colorMode:M,elevationType:j,terrainEnabled:G,pass:z};if(f.renderPass!=="shadow")if(j!=="offset"){if(eu(U,!1),j==="road"){const q=!G&&f.renderPass==="translucent";q&&Wd(f,n,c,p,"geometry"),eu(U,!0,Nr.disabled),q&&function(re){const{painter:Y,sourceCache:ne,layer:oe,coords:ce,colorMode:ge}=re,xe=Y.context.gl,Ce=re.painter.shadowRenderer,Ae=!!Ce&&Ce.enabled,Te=new Kt(Y.context.gl.LEQUAL,Kt.ReadOnly,Y.depthRangeFor3D);let be=[0,0,0];if(Ae){const Re=Y.style.directionalLight,Be=Y.style.ambientLight;Re&&Be&&(be=ac(Y.style,Re,Be))}const Ie=Re=>{for(const Be of ce){const Ge=ne.getTile(Be),st=Ge.getBucket(oe);if(!st)continue;const it=st.elevatedStructures;if(!it)continue;let mt,Ue;if(Re?(mt=it.renderableBridgeSegments,Ue=it.bridgeProgramConfigurations.get(oe.id)):(mt=it.renderableTunnelSegments,Ue=it.tunnelProgramConfigurations.get(oe.id)),!mt||mt.segments[0].primitiveLength===0)continue;Ue.updatePaintBuffers(),Y.prepareDrawTile();const Je=Y.isTileAffectedByFog(Be),Le=[];Ae&&Le.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const lt=Y.getOrCreateProgram("elevatedStructures",{config:Ue,overrideFog:Je,defines:Le}),Ye=Y.translatePosMatrix(Be.projMatrix,Ge,oe.paint.get("fill-translate"),oe.paint.get("fill-translate-anchor"));Ae&&Ce.setupShadows(Ge.tileID.toUnwrapped(),lt,"vector-tile",Ge.tileID.overscaledZ);const pt=Kf(Ye,be);Y.uploadCommonUniforms(Y.context,lt,Be.toUnwrapped()),lt.draw(Y,xe.TRIANGLES,Te,Nr.disabled,ge,Ar.backCCW,pt,oe.id,it.vertexBuffer,it.indexBuffer,mt,oe.paint,Y.transform.zoom,Ue,[it.vertexBufferNormal])}};Ie(!0),Ie(!1)}(U)}}else eu(U,!1,f.stencilModeFor3D());else f.shadowRenderer&&j==="road"&&!G&&function(q){const{painter:re,sourceCache:Y,layer:ne,coords:oe}=q,ce=re.context.gl,ge=q.painter.shadowRenderer;for(const xe of oe){const Ce=Y.getTile(xe),Ae=Ce.getBucket(ne);if(!Ae)continue;const Te=Ae.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;re.prepareDrawTile();const be=Ae.bufferData.programConfigurations.get(ne.id),Ie=re.isTileAffectedByFog(xe),Re=re.getOrCreateProgram("elevatedStructuresDepth",{config:be,overrideFog:Ie}),Be=ge.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());re.uploadCommonUniforms(re.context,Re,xe.toUnwrapped());const Ge={u_matrix:Be,u_depth_bias:.001};Re.draw(re,ce.TRIANGLES,ge.getShadowPassDepthMode(),Nr.disabled,ge.getShadowPassColorMode(),Ar.disabled,Ge,ne.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,ne.paint,re.transform.zoom,be)}}(U)},"fill-extrusion":function(f,n,c,p){const x=c.paint.get("fill-extrusion-opacity"),S=f.context,E=S.gl,M=f.terrain,R=M&&M.renderingToTexture;if(x===0)return;const z=f.conflationActive&&f.style.isLayerClipped(c,n.getSource()),j=f.style.order.indexOf(c.fqid);if(z&&function(G,U,q,re,Y){for(const ne of re){const oe=U.getTile(ne).getBucket(q);oe&&(oe.updateReplacement(ne,G.replacementSource,Y),oe.uploadCentroid(G.context))}}(f,n,c,p,j),M||z)for(const G of p){const U=n.getTile(G).getBucket(c);U&&Zt(f.context,n,G,U,c,M,z)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(M&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const U=G.getShadowPassDepthMode(),q=G.getShadowPassColorMode();zs(f,n,c,p,U,Nr.disabled,q,z)}else if(f.renderPass==="translucent"){const G=!c.paint.get("fill-extrusion-pattern").constantOr(1),U=c.paint.get("fill-extrusion-color").constantOr(i.am.white);if(!R&&U.a!==0){const q=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D);x===1&&G?zs(f,n,c,p,q,Nr.disabled,ln.unblended,z):(zs(f,n,c,p,q,Nr.disabled,ln.disabled,z),zs(f,n,c,p,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),z),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!M&&f.transform.projection.name!=="globe"||R)){const q=c.paint.get("fill-extrusion-opacity"),re=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=c.paint.get("fill-extrusion-flood-light-intensity"),oe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(oe?null:c.lut).toArray01().slice(0,3),ge=re>0&&Y>0,xe=ne>0,Ce=(Te,be,Ie)=>(1-Ie)*Te+Ie*be,Ae=Te=>{const be=f.depthModeForSublayer(1,Kt.ReadOnly,E.LEQUAL,!0),Ie=c.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=Ce(.1,3,Ie),Be=f._showOverdrawInspector;if(!Be){const Ge=new Nr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),st=new ln([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0],E.MIN);Go(f,n,c,p,be,Ge,st,Ar.disabled,Te,"sdf",q,re,Y,ne,ce,Re,z,!1)}{const Ge=Be?Nr.disabled:new Nr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),st=Be?f.colorModeForRenderPass():new ln([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],i.am.transparent,[!0,!0,!0,!0]);Go(f,n,c,p,be,Ge,st,Ar.disabled,Te,"color",q,re,Y,ne,ce,Re,z,!1)}};if(R){const Te=(be,Ie,Re)=>{const Be=f.depthModeForSublayer(1,Kt.ReadOnly,E.LEQUAL,!1),Ge=c.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),st=Ce(.1,3,Ge);{const it=new ln([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0]);Go(f,n,c,p,Be,Nr.disabled,it,Ar.disabled,be,"clear",q,re,Y,ne,ce,st,z,Ie)}{const it=new Nr({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),mt=new ln([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0],E.MIN);Go(f,n,c,p,Be,it,mt,Ar.disabled,be,"sdf",q,re,Y,ne,ce,st,z,Ie)}{const it=be?E.ZERO:E.ONE_MINUS_DST_ALPHA,mt=new Nr({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Ue=new ln([it,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],i.am.transparent,[!0,!0,!0,!0]);Go(f,n,c,p,Be,mt,Ue,Ar.disabled,be,"color",q,re,Y,ne,ce,st,z,Ie)}{const it=new ln([E.ONE,E.ONE,E.ONE,be?E.ZERO:E.ONE],i.am.transparent,[!1,!1,!1,!0],be?E.FUNC_ADD:E.MAX);Go(f,n,c,p,Be,Nr.disabled,it,Ar.disabled,be,"clear",q,re,Y,ne,ce,st,z,Ie,Re)}};if(ge||xe){let be;if(f.prepareDrawTile(),M){const Ie=M.drapeBufferSize[0],Re=M.drapeBufferSize[1];be=M.framebufferCopyTexture,be&&(!be||be.size[0]===Ie&&be.size[1]===Re)||(be&&be.destroy(),be=M.framebufferCopyTexture=new i.T(S,new i.r({width:Ie,height:Re}),E.RGBA8)),be.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Ie,Re)}ge&&Te(!0,!1,be),xe&&Te(!1,!0,be)}}else ge&&Ae(!0),xe&&Ae(!1),(ge||xe)&&f.resetStencilClippingMasks()}}},building:function(f,n,c,p){},hillshade:function(f,n,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,S=f.terrain&&f.terrain.renderingToTexture,[E,M]=f.renderPass!=="translucent"||S?[{},p]:f.stencilConfigForOverlap(p);for(const R of M){const z=n.getTile(R);if(z.needsHillshadePrepare&&f.renderPass==="offscreen")qy(f,z,c);else if(f.renderPass==="translucent"){const j=f.depthModeForSublayer(0,Kt.ReadOnly),G=c.paint.get("hillshade-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(G),q=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):E[R.overscaledZ];Gy(f,R,z,c,j,q,U)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,p,x,S){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",M=c.paint.get("raster-elevation")!==0,R=M&&E;if(f.renderElevatedRasterBackface&&!R)return;const z=f.context,j=z.gl,G=n.getSource(),U=function(Ae,Te,be,Ie){const Re=Te.paint.get("raster-color"),Be=Ae.type==="raster-array",Ge=[],st=Te.paint.get("raster-resampling"),it=Te.paint.get("raster-color-mix");let mt=Te.paint.get("raster-color-range");const Ue=[it[0],it[1],it[2],0],Je=it[3];let Le=st==="nearest"?Ie.NEAREST:Ie.LINEAR;if(Be&&(Ge.push("RASTER_ARRAY"),Re||Ge.push("RASTER_COLOR"),st==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Le=Ie.NEAREST,!mt&&Ae.rasterLayers)){const lt=Ae.rasterLayers.find(({id:Ye})=>Ye===Te.sourceLayer);lt&&lt.fields&&lt.fields.range&&(mt=lt.fields.range)}if(mt=mt||[0,1],Re){Ge.push("RASTER_COLOR"),be.activeTexture.set(Ie.TEXTURE2),Te.updateColorRamp(mt);let lt=Te.colorRampTexture;lt||(lt=Te.colorRampTexture=new i.T(be,Te.colorRamp,Ie.RGBA8)),lt.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:Ue,range:mt,offset:Je,defines:Ge,resampling:Le}}(G,c,z,j);if(G instanceof i.aP&&!p.length&&!E)return;const q=c.paint.get("raster-emissive-strength"),re=f.colorModeForDrapableLayerRenderPass(q),Y=f.terrain&&f.terrain.renderingToTexture,ne=!f.options.moving,oe=c.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(G instanceof i.aP&&!p.length&&(G.onNorthPole||G.onSouthPole)){const Ae=M?f.stencilModeFor3D():Nr.disabled;return void Ra(!!G.onNorthPole,null,f,n,c,q,U,Ar.disabled,Ae)}if(!p.length)return;const[ce,ge]=G instanceof i.aP||Y?[{},p]:f.stencilConfigForOverlap(p),xe=ge[ge.length-1].overscaledZ;R&&U.defines.push("PROJECTION_GLOBE_VIEW"),M&&U.defines.push("RENDER_CUTOFF");const Ce=(Ae,Te,be)=>{for(const Ie of Ae){const Re=Ie.toUnwrapped(),Be=n.getTile(Ie);if(Y&&(!Be||!Be.hasData()))continue;z.activeTexture.set(j.TEXTURE0);const Ge=Qf(Be,G,c,U);if(!Ge||!Ge.texture)continue;const{texture:st,mix:it,offset:mt,tileSize:Ue,buffer:Je}=Ge;let Le,lt;Y?(Le=Kt.disabled,lt=Ie.projMatrix):M?(Le=new Kt(j.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),lt=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Re,ne)):(Le=f.depthModeForSublayer(Ie.overscaledZ-xe,c.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,j.LESS),lt=f.transform.calculateProjMatrix(Re,ne));const Ye=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(Ie):ce[Ie.overscaledZ],pt=S?0:c.paint.get("raster-fade-duration");Be.registerFadeDuration(pt);const It=n.findLoadedParent(Ie,0),ct=bs(Be,It,n,f.transform,pt);let wt,Vt;f.terrain&&f.terrain.prepareDrawTile(),z.activeTexture.set(j.TEXTURE0),st.bind(oe,j.CLAMP_TO_EDGE),z.activeTexture.set(j.TEXTURE1),It?(It.texture&&It.texture.bind(oe,j.CLAMP_TO_EDGE),wt=Math.pow(2,It.tileID.overscaledZ-Be.tileID.overscaledZ),Vt=[Be.tileID.canonical.x*wt%1,Be.tileID.canonical.y*wt%1]):st.bind(oe,j.CLAMP_TO_EDGE),"useMipmap"in st&&z.extTextureFilterAnisotropic&&f.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const qt=f.transform;let Bt;const Xt=M?tu(qt):[0,0,0,0];let cr,gr,Or,Qr,wn,oi=0;if(R&&G instanceof i.aP&&G.coordinates.length>3)cr=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0)))),gr=Float32Array.from(qt.globeMatrix),Or=Float32Array.from(i.dm(qt)),Qr=[i.aD(qt.center.lng),i.aH(qt.center.lat)],Bt=G.elevatedGlobePerspectiveTransform,wn=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Vr=i.dn(Ie.canonical);oi=i.dp(Vr.getCenter().lat),cr=Float32Array.from(i.bh(i.dr(Ie.canonical))),gr=Float32Array.from(qt.globeMatrix),Or=Float32Array.from(i.dm(qt)),Qr=[i.aD(qt.center.lng),i.aH(qt.center.lat)],Bt=[0,0],wn=Float32Array.from(i.dq(Ie.canonical,Vr,oi,qt.worldSize/qt._pixelsPerMercatorPixel))}else Bt=G instanceof i.aP?G.perspectiveTransform:[0,0],cr=new Float32Array(16),gr=new Float32Array(9),Or=new Float32Array(16),Qr=[0,0],wn=new Float32Array(9);const Vn=Ud(lt,cr,gr,Or,wn,Vt||[0,0],i.ah(f.transform.zoom),Qr,Xt,wt||1,ct,c,Bt,M?c.paint.get("raster-elevation"):0,2,it,mt,U.range,Ue,Je,q),Pn=f.isTileAffectedByFog(Ie),$i=f.getOrCreateProgram("raster",{defines:U.defines,overrideFog:Pn});if(f.uploadCommonUniforms(z,$i,Re),G instanceof i.aP){const Vr=G.elevatedGlobeVertexBuffer,en=G.elevatedGlobeIndexBuffer;if(Y||!E)G.boundsBuffer&&G.boundsSegments&&$i.draw(f,j.TRIANGLES,Le,Nr.disabled,re,Ar.disabled,Vn,c.id,G.boundsBuffer,f.quadTriangleIndexBuffer,G.boundsSegments);else if(Vr&&en){const un=qt.zoom<=i.cL?G.elevatedGlobeSegments:G.getSegmentsForLongitude(qt.center.lng);un&&$i.draw(f,j.TRIANGLES,Le,Nr.disabled,re,Te,Vn,c.id,Vr,en,un)}}else if(R){Le=new Kt(j.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);const Vr=f.globeSharedBuffers;if(Vr){const[en,un,ai]=Vr.getGridBuffers(oi,!1);$i.draw(f,j.TRIANGLES,Le,be||Ye,f.colorModeForRenderPass(),Te,Vn,c.id,en,un,ai)}}else{const{tileBoundsBuffer:Vr,tileBoundsIndexBuffer:en,tileBoundsSegments:un}=f.getTileBoundsBuffers(Be);$i.draw(f,j.TRIANGLES,Le,Ye,re,Ar.disabled,Vn,c.id,Vr,en,un)}}if(!(G instanceof i.aP)&&R)for(const Ie of Ae){const Re=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&Ra(!0,Ie,f,n,c,q,U,Te,be||Nr.disabled),Re&&Ra(!1,Ie,f,n,c,q,U,Te===Ar.frontCW?Ar.backCW:Ar.frontCW,be||Nr.disabled)}};R?Ce(ge,f.renderElevatedRasterBackface?Ar.backCW:Ar.frontCW,f.stencilModeFor3D()):Ce(ge,Ar.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,c,p,x,S){f.renderPass==="offscreen"&&function(E,M,R,z){if(!z.length)return;const j=E.context,G=j.gl,U=M.getSource();if(!(U instanceof kc))return;const q=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let re=R.particlePositionRGBAImage;if(!re||re.width!==q){const ge=function(xe){const Ce=xe*xe,Ae=new Uint8Array(4*Ce),Te=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let Ie=0;Ie<Ce;Ie++){const Re=be*(Te(2*Ie+0)+Ls),Be=be*(Te(2*Ie+1)+Ls),Ge=255*Re%1,st=255*Be%1,it=Ge,mt=Be-st/255,Ue=st;Ae[4*Ie+0]=255*(Re-Ge/255),Ae[4*Ie+1]=255*it,Ae[4*Ie+2]=255*mt,Ae[4*Ie+3]=255*Ue}return Ae}(q);re=R.particlePositionRGBAImage=new i.r({width:q,height:q},ge)}let Y=R.particleFramebuffer;Y?Y.width!==q&&(Y.destroy(),Y=R.particleFramebuffer=j.createFramebuffer(q,q,!0,null)):Y=R.particleFramebuffer=j.createFramebuffer(q,q,!0,null);const ne=[];for(const ge of z){const xe=M.getTile(ge);if(!(xe instanceof vu))continue;const Ce=Rg(xe,U,R);if(!Ce)continue;const Ae=[xe.tileSize,xe.tileSize];let Te=R.tileFramebuffer;Te||(Te=R.tileFramebuffer=j.createFramebuffer(Ae[0],Ae[1],!0,null));let be=xe.rasterParticleState;be||(be=xe.rasterParticleState=new Zd(j,ge,Ae,re));const Ie=be.update(R.lastInvalidatedAt);be.particleTextureDimension!==q&&be.updateParticleTexture(ge,re);const Re=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Re;const Be=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Be,ne.push([ge,Ce,be,Ie])}if(ne.length===0)return;const oe=i.q.now(),ce=R.previousDrawTimestamp?.001*(oe-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=oe,R.hasColorMap()){j.activeTexture.set(G.TEXTURE0+2);let ge=R.colorRampTexture;ge||(ge=R.colorRampTexture=new i.T(j,R.colorRamp,G.RGBA8)),ge.bind(G.LINEAR,G.CLAMP_TO_EDGE)}j.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(ge,xe,Ce){const Ae=ge.context,Te=Ae.gl,be=xe.tileFramebuffer;Ae.activeTexture.set(Te.TEXTURE0);const Ie={u_texture:0,u_opacity:1.05*(Be=xe.paint.get("raster-particle-fade-opacity-factor"))/(Be+.05)},Re=ge.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Be;for(const Ge of Ce){const[,,st,it]=Ge;be.colorAttachment.set(st.targetColorTexture.texture),Ae.viewport.set([0,0,be.width,be.height]),Ae.clear({color:i.am.transparent}),it&&(st.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Re.draw(ge,Te.TRIANGLES,Kt.disabled,Nr.disabled,ln.alphaBlended,Ar.disabled,Ie,xe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments))}}(E,R,ne),function(ge,xe,Ce,Ae){const Te=ge.context,be=Te.gl,Ie=Ce.tileFramebuffer,Re=ge.transform.projection.name==="globe",Be=Ce.paint.get("raster-particle-max-speed");for(const Ge of Ae){const[st,it,mt]=Ge;Te.activeTexture.set(be.TEXTURE0+0),it.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ie.colorAttachment.set(mt.targetColorTexture.texture);const Ue=ge.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});Te.activeTexture.set(be.TEXTURE0+1);const Je=it.scalarData?[]:[0,1,2,3].map(Ye=>i.dT[Ye](st));Je.push(st);const Le=st.canonical.x,lt=st.canonical.y;for(const Ye of Je){const pt=xe.getTile(Re?Ye.wrapped():Ye);if(!pt)continue;const It=pt.rasterParticleState;if(!It)continue;const ct=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-st.wrap),wt=Ye.canonical.y;It.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Vt=ls(1,It.particleTexture0.size[0],[ct-Le,wt-lt],0,it.texture.size,2,Be,it.textureOffset,it.scale,it.offset);Ue.draw(ge,be.POINTS,Kt.disabled,Nr.disabled,ln.alphaBlended,Ar.disabled,Vt,Ce.id,It.particleIndexBuffer,void 0,It.particleSegment)}}}(E,M,R,ne),j.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(ge,xe,Ce,Ae){const Te=ge.context,be=Te.gl,Ie=xe.paint.get("raster-particle-max-speed"),Re=Ae*xe.paint.get("raster-particle-speed-factor")*.15,Be=function(st){return Math.pow(st,6)}(.01+1*xe.paint.get("raster-particle-reset-rate-factor")),Ge=xe.particleFramebuffer;Te.viewport.set([0,0,Ge.width,Ge.height]);for(const st of Ce){const[,it,mt]=st;Te.activeTexture.set(be.TEXTURE0+0),it.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Te.activeTexture.set(be.TEXTURE0+1);const Ue=mt.particleTexture0;Ue.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Je=so(1,Ue.size[0],0,it.texture.size,Ie,Re,Be,it.textureOffset,it.scale,it.offset);Ge.colorAttachment.set(mt.particleTexture1.texture),Te.clear({color:i.am.transparent}),ge.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(ge,be.TRIANGLES,Kt.disabled,Nr.disabled,ln.unblended,Ar.disabled,Je,xe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments)}}(E,R,ne,ce)}(f,n,c,p),f.renderPass==="translucent"&&(function(E,M,R,z,j){const G=E.context,U=G.gl,q=M.getSource().tileSize,re=5*(1-i.af(i.cx,i.cx+1,E.transform.zoom))*q+R.paint.get("raster-particle-elevation"),Y=!E.options.moving,ne=E.transform.projection.name==="globe";if(!z.length)return;const[oe,ce]=E.stencilConfigForOverlap(z),ge=[];ne&&ge.push("PROJECTION_GLOBE_VIEW");const xe=E.stencilModeFor3D();for(const Ce of ce){const Ae=Ce.toUnwrapped(),Te=M.getTile(Ce);if(!Te.rasterParticleState)continue;const be=Te.rasterParticleState,Ie=100;Te.registerFadeDuration(Ie);const Re=M.findLoadedParent(Ce,0),Be=bs(Te,Re,M,E.transform,Ie);let Ge,st;E.terrain&&E.terrain.prepareDrawTile(),G.activeTexture.set(U.TEXTURE0),be.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),G.activeTexture.set(U.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ge=Math.pow(2,Re.tileID.overscaledZ-Te.tileID.overscaledZ),st=[Te.tileID.canonical.x*Ge%1,Te.tileID.canonical.y*Ge%1]):be.targetColorTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const it=ne?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ae,Y),mt=E.transform,Ue=qh(mt),Je=i.dn(Ce.canonical),Le=i.dp(Je.getCenter().lat);let lt,Ye,pt,It,ct;ne?(lt=Float32Array.from(i.bh(i.dr(Ce.canonical))),Ye=Float32Array.from(mt.globeMatrix),pt=Float32Array.from(i.dm(mt)),It=[i.aD(mt.center.lng),i.aH(mt.center.lat)],ct=Float32Array.from(i.dq(Ce.canonical,Je,Le,mt.worldSize/mt._pixelsPerMercatorPixel))):(lt=new Float32Array(16),Ye=new Float32Array(9),pt=new Float32Array(16),It=[0,0],ct=new Float32Array(9));const wt=Xs(it,lt,Ye,pt,ct,st||[0,0],i.ah(E.transform.zoom),It,Ue,Ge||1,Be,re),Vt=E.isTileAffectedByFog(Ce),qt=E.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:Vt});if(E.uploadCommonUniforms(G,qt,Ae),ne){const Bt=new Kt(U.LEQUAL,Kt.ReadOnly,E.depthRangeFor3D),Xt=0,cr=E.globeSharedBuffers;if(cr){const[gr,Or,Qr]=cr.getGridBuffers(Le,Xt!==0);qt.draw(E,U.TRIANGLES,Bt,xe,ln.alphaBlended,E.renderElevatedRasterBackface?Ar.frontCCW:Ar.backCCW,wt,R.id,gr,Or,Qr)}}else{const Bt=E.depthModeForSublayer(0,Kt.ReadOnly),Xt=oe[Ce.overscaledZ],{tileBoundsBuffer:cr,tileBoundsIndexBuffer:gr,tileBoundsSegments:Or}=E.getTileBoundsBuffers(Te);qt.draw(E,U.TRIANGLES,Bt,Xt,ln.alphaBlended,Ar.disabled,wt,R.id,cr,gr,Or)}}E.resetStencilClippingMasks()}(f,n,c,p),f.style.map.triggerRepaint())},background:function(f,n,c,p){const x=c.paint.get("background-color"),S=c.paint.get("background-color-use-theme").constantOr("default")==="none",E=c.paint.get("background-opacity"),M=c.paint.get("background-emissive-strength"),R=c.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const z=f.context,j=z.gl,G=f.transform,U=G.tileSize,q=c.paint.get("background-pattern");let re;if(q!==void 0&&(q===null||(re=f.imageManager.getPattern(i.I.from(q.toString()),c.scope,f.style.getLut(c.scope)),!re)))return;const Y=!q&&x.a===1&&E===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const ne=Nr.disabled,oe=f.depthModeForSublayer(0,Y==="opaque"?Kt.ReadWrite:Kt.ReadOnly),ce=f.colorModeForDrapableLayerRenderPass(M),ge=q?"backgroundPattern":"background";let xe,Ce=p;if(Ce||(xe=f.getBackgroundTiles(),Ce=Object.values(xe).map(Ae=>Ae.tileID)),q&&(z.activeTexture.set(j.TEXTURE0),f.imageManager.bind(f.context,c.scope)),R){const Ae=f.getOrCreateProgram(ge,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(i.bx([])),be=new i.aM(0,0,0,0,0),Ie=q?Gd(Te,M,E,f,0,c.scope,re,R,{tileID:be,tileSize:U}):Hd(Te,M,E,x.toPremultipliedRenderColor(S?null:c.lut));Ae.draw(f,j.TRIANGLES,oe,ne,ce,Ar.disabled,Ie,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Ae of Ce){const Te=f.isTileAffectedByFog(Ae),be=f.getOrCreateProgram(ge,{overrideFog:Te}),Ie=Ae.toUnwrapped(),Re=p?Ae.projMatrix:f.transform.calculateProjMatrix(Ie);f.prepareDrawTile();const Be=n?n.getTile(Ae):xe?xe[Ae.key]:new Dc(Ae,U,G.zoom,f),Ge=q?Gd(Re,M,E,f,0,c.scope,re,R,{tileID:Ae,tileSize:U}):Hd(Re,M,E,x.toPremultipliedRenderColor(S?null:c.lut));f.uploadCommonUniforms(z,be,Ie);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:it,tileBoundsSegments:mt}=f.getTileBoundsBuffers(Be);be.draw(f,j.TRIANGLES,oe,ne,ce,Ar.disabled,Ge,c.id,st,it,mt)}},sky:function(f,n,c){const p=f._atmosphere?i.ah(f.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const S=f.context,E=c.paint.get("sky-type"),M=new Kt(S.gl.LEQUAL,Kt.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(z,j,G,U){const q=z.context,re=q.gl;let Y=j.skyboxFbo;if(!Y){Y=j.skyboxFbo=q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new Hu(q),j.skyboxTexture=q.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,j.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let ge=0;ge<6;++ge)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Y.framebuffer),q.viewport.set([0,0,32,32]);const ne=j.getCenter(z,!0),oe=z.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);i.bx(ce),i.e3(ce,ce,.5*-Math.PI),ha(z,j,oe,ce,ne,0),i.bx(ce),i.e3(ce,ce,.5*Math.PI),ha(z,j,oe,ce,ne,1),i.bx(ce),i.cG(ce,ce,.5*-Math.PI),ha(z,j,oe,ce,ne,2),i.bx(ce),i.cG(ce,ce,.5*Math.PI),ha(z,j,oe,ce,ne,3),i.bx(ce),ha(z,j,oe,ce,ne,4),i.bx(ce),i.e3(ce,ce,Math.PI),ha(z,j,oe,ce,ne,5),q.viewport.set([0,0,z.width,z.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(z,j,G,U,q){const re=z.context,Y=re.gl,ne=z.transform,oe=z.getOrCreateProgram("skybox");re.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,j.skyboxTexture);const ce=((ge,xe,Ce,Ae,Te)=>({u_matrix:ge,u_sun_direction:xe,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Te}))(ne.skyboxMatrix,j.getCenter(z,!1),0,U,q);z.uploadCommonUniforms(re,oe),oe.draw(z,Y.TRIANGLES,G,Nr.disabled,z.colorModeForRenderPass(),Ar.backCW,ce,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,c,M,x,R):E==="gradient"&&f.renderPass==="sky"&&function(z,j,G,U,q){const re=z.context,Y=re.gl,ne=z.transform,oe=z.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Hu(re)),re.activeTexture.set(Y.TEXTURE0);let ce=j.colorRampTexture;ce||(ce=j.colorRampTexture=new i.T(re,j.colorRamp,Y.RGBA8)),ce.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const ge=((xe,Ce,Ae,Te,be)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:Ce,u_radius:i.al(Ae),u_opacity:Te,u_temporal_offset:be}))(ne.skyboxMatrix,j.getCenter(z,!1),j.paint.get("sky-gradient-radius"),U,q);z.uploadCommonUniforms(re,oe),oe.draw(z,Y.TRIANGLES,G,Nr.disabled,z.colorModeForRenderPass(),Ar.backCW,ge,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(f,c,M,x,R)},custom:function(f,n,c,p){const x=f.context,S=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(n)){if(f.renderPass==="offscreen"){const E=S.prerender;if(E){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;E.call(S,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.ah(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else E.call(S,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const M=S.renderToTile;if(M){const R=p[0].canonical,z={x:R.x+p[0].wrap*(S.wrapTileId?0:1<<R.z),y:R.y,z:R.z};x.setDepthMode(Kt.disabled),x.setStencilMode(Nr.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),M.call(S,x.gl,z),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(Nr.disabled);const E=S.renderingMode==="3d"?new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Kt.ReadOnly);if(x.setDepthMode(E),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;S.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.ah(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else S.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,c,p){if(f.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1);if(x===0)return;const S=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!S||f.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const E=f.shadowRenderer,M=c.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,M||(E.enabled=!1));const R=()=>{E&&(E.useNormalOffset=!0,M||(E.enabled=!0))},z=n.getSource();if(f.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(oe,ce,ge,xe,Ce){const Ae=oe.transform;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Te=Ae.getFreeCameraOptions().position;if(!oe.modelManager)return;const be=oe.modelManager;ge.modelManager=be;const Ie=oe.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Re=ge._unevaluatedLayout._values["model-id"],Be=Object.assign({},ge.layout.get("model-id").parameters),Ge=oe.style.order.indexOf(ge.fqid);for(const st of xe){const it=ce.getTile(st).getBucket(ge);if(!it||it.projection.name!==Ae.projection.name)continue;const mt=it.getModelUris();mt&&!it.modelsRequested&&(be.addModelsFromBucket(mt,Ce),it.modelsRequested=!0);const Ue=Wo(st,Ae);Be.zoom=Ue;const Je=Re.possiblyEvaluate(Be);if($e(oe,it,st),Fs.shadowUniformsInitialized=!1,Fs.useSingleShadowCascade=!!Ie&&Ie.getMaxCascadeForTile(st.toUnwrapped())===0,oe.renderPass==="shadow"&&Ie){if(oe.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const Ye=Ae.calculatePosMatrix(st.toUnwrapped(),Ae.worldSize);if(Fs.tileMatrix.set(Ye),Fs.shadowTileMatrix=Float32Array.from(Ie.calculateShadowPassMatrixFromMatrix(Ye)),Fs.aabb.min.fill(0),Fs.aabb.max[0]=Fs.aabb.max[1]=i.aj,Fs.aabb.max[2]=0,np(it,Fs,oe,ge.scope))continue}const Le=1<<st.canonical.z,lt=[((Te.x-st.wrap)*Le-st.canonical.x)*i.aj,(Te.y*Le-st.canonical.y)*i.aj,Te.z*Le*i.aj];oe.conflationActive&&Object.keys(it.instancesPerModel).length>0&&oe.style.isLayerClipped(ge,ce.getSource())&&it.updateReplacement(st,oe.replacementSource,Ge,Ce)&&(it.uploaded=!1,it.upload(oe.context));for(let Ye in it.instancesPerModel){const pt=it.instancesPerModel[Ye];pt.features.length>0&&(Ye=Je.evaluate(pt.features[0].feature,{}));const It=be.getModel(Ye,Ce);if(It||be.hasURLBeenRequested(Ye)||it.modelUris.includes(Ye)||(it.modelUris.push(Ye),it.modelsRequested=!1),It&&It.uploaded)for(const ct of It.nodes)nu(oe,ge,ct,pt,lt,st,Fs)}}}(f,n,c,p,z.type==="vector"?c.scope:""),void R();if(!z.loaded())return;if(z.type==="batched-model")return function(oe,ce,ge,xe){ge.resetLayerRenderingStats(oe);const Ce=oe.context,Ae=oe.transform,Te=oe.style.fog,be=oe.shadowRenderer;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Ie=oe.transform.getFreeCameraOptions().position,Re=i.bY([],[Ie.x,Ie.y,Ie.z],oe.transform.worldSize),Be=i.eb([],Re),Ge=i.bx([]),st=i.ec(Ae.center.lat,Ae.zoom),it=i.bn([],[1,1,1/st]);i.bo(Ge,Ge,Be);const mt=ge.paint.get("model-opacity").constantOr(1),Ue=new Kt(Ce.gl.LEQUAL,Kt.ReadWrite,oe.depthRangeFor3D),Je=new Kt(Ce.gl.LEQUAL,Kt.ReadOnly,oe.depthRangeFor3D),Le=new i.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),lt=oe.renderPass==="shadow",Ye=lt&&be?be.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),pt=ge.paint.get("model-front-cutoff"),It=pt[2]<1,ct=sa(oe,ge.paint.get("model-cutoff-fade-range")),wt=ge.getLayerRenderingStats();(function(Vt,qt,Bt,Xt){const cr=Vt.terrain?Vt.terrain.exaggeration():0,gr=Vt.transform.zoom;for(const Or of Xt){const Qr=qt.getTile(Or).getBucket(Bt);Qr&&(Qr.setFilter(Bt.filter),Vt.conflationActive&&Qr.updateReplacement(Or,Vt.replacementSource),Qr.evaluateTransform(Vt,Bt),Vt.terrain&&cr>0&&Qr.elevationUpdate(Vt.terrain,cr,Or,Bt.source),Qr.needsReEvaluation(Vt,gr,Bt)&&Qr.evaluate(Bt))}})(oe,ce,ge,xe),function(){let Vt,qt,Bt;It?(Vt=xe.length-1,qt=-1,Bt=-1):(Vt=0,qt=xe.length,Bt=1);const Xt=new Float64Array(16),cr=i.ef(),gr=new i.P(0,0);for(let Or=Vt;Or!==qt;Or+=Bt){const Qr=xe[Or],wn=ce.getTile(Qr).getBucket(ge);if(!wn||!wn.uploaded)continue;let oi=!1;be&&(oi=be.getMaxCascadeForTile(Qr.toUnwrapped())===0);const Vn=Ae.calculatePosMatrix(Qr.toUnwrapped(),Ae.worldSize),Pn=wn.modelTraits;!lt&&It&&(i.bi(Xt,Vn),i.ad(cr,Re,Xt),gr.x=cr[0],gr.y=cr[1]);const $i=[];wn.setFilter(ge.filter);for(const Vr of wn.getNodesInfo()){if(Vr.hiddenByReplacement||!Vr.node.meshes)continue;const en=Vr.node;let un=0;oe.terrain&&en.elevation&&(un=en.elevation*oe.terrain.exaggeration());const ai=(()=>{const Gi=Vr.aabb;return Le.min=[...Gi.min],Le.max=[...Gi.max],Le.min[2]+=un,Le.max[2]+=un,i.ad(Le.min,Le.min,Vn),i.ad(Le.max,Le.max,Vn),Le})(),Ji=Vr.evaluatedScale;if(Ji[0]<=1&&Ji[1]<=1&&Ji[2]<=1&&ai.intersects(Ye)===0)continue;if(!lt&&It){const Gi=.16666666666666666;Vr.cameraCollisionOpacity=Re[0]>ai.min[0]&&Re[0]<ai.max[0]&&Re[1]>ai.min[1]&&Re[1]<ai.max[1]&&Re[2]*st<ai.max[2]&&en.footprint&&i.bS(gr,en.footprint)?Math.max(Vr.cameraCollisionOpacity-Gi,0):Math.min(1,Vr.cameraCollisionOpacity+Gi)}const ui=[...Vn],Ln=1/i.cU(Qr.canonical),Fi=en.anchor?en.anchor[0]:0,bn=en.anchor?en.anchor[1]:0;i.bo(ui,ui,[Fi*(Ji[0]-1)+Vr.evaluatedTranslation[0]*Ln,bn*(Ji[1]-1)+Vr.evaluatedTranslation[1]*Ln,un+Vr.evaluatedTranslation[2]]),i.ci(Ji,i.eg)||i.cE(ui,ui,Ji);const Bi=i.az([],ui,en.matrix),mi=i.az([],Ae.expandedFarZProjMatrix,Bi),Gn=i.az([],Ae.expandedFarZProjMatrix,ui),hi=i.aA([],[Fi,bn,un,1],mi)[2];en.hidden=!1;let Xr=mt;lt||(It&&(Xr*=Vr.cameraCollisionOpacity,Xr*=Gu(ui,Ae,Vr.aabb,pt)),Xr*=Sm(ct,hi)),Xr!==0?$i.push({nodeInfo:Vr,depth:hi,opacity:Xr,wvpForNode:mi,wvpForTile:Gn,nodeModelMatrix:Bi,tileModelMatrix:ui}):en.hidden=!0}lt||$i.sort((Vr,en)=>!It||Vr.opacity===1&&en.opacity===1?Vr.depth<en.depth?-1:1:Vr.opacity===1?-1:en.opacity===1?1:Vr.depth>en.depth?-1:1);for(const Vr of $i){const en=Vr.nodeInfo,un=en.node;let ai=i.az([],it,Vr.tileModelMatrix);i.az(ai,Ge,ai);const Ji=i.bi([],ai);i.ee(Ji,Ji),i.cE(Ji,Ji,Kd),ai=i.az(ai,ai,un.matrix);const ui=oe.renderPass==="light-beam",Ln=ge.paint.get("model-color-use-theme").constantOr("default")==="none",Fi=Pn&i.em.HasMapboxMeshFeatures,bn=Fi?0:en.evaluatedRMEA[0][2];for(let Bi=0;Bi<un.meshes.length;++Bi){const mi=un.meshes[Bi],Gn=Bi===un.lightMeshIndex;let hi=Vr.wvpForNode;if(Gn){if(!ui&&!oe.terrain&&oe.shadowRenderer){oe.currentLayer<oe.firstLightBeamLayer&&(oe.firstLightBeamLayer=oe.currentLayer);continue}hi=Vr.wvpForTile}else if(ui)continue;const Xr={defines:[]},Gi=[];if(!lt&&be&&(be.useNormalOffset=!!mi.normalBuffer),Tt(Xr.defines,Gi,mi,oe,Ln?null:ge.lut),Fi||Xr.defines.push("DIFFUSE_SHADED"),oi&&Xr.defines.push("SHADOWS_SINGLE_CASCADE"),wt&&(lt?wt.numRenderedVerticesInShadowPass+=mi.vertexArray.length:wt.numRenderedVerticesInTransparentPass+=mi.vertexArray.length),lt){Di(mi,Vr.nodeModelMatrix,oe,ge);continue}let Bs=null;if(Te){const ws=ml(Vr.nodeModelMatrix,oe.transform);if(Bs=new Float32Array(ws),Ae.projection.name!=="globe"){const da=mi.aabb.min,Xo=mi.aabb.max,[Ko,fa]=Te.getOpacityForBounds(ws,da[0],da[1],Xo[0],Xo[1]);Xr.overrideFog=Ko>=Ze||fa>=Ze}}const wi=mi.material;let Dn;wi.occlusionTexture&&wi.occlusionTexture.offsetScale&&(Dn=wi.occlusionTexture.offsetScale,Xr.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Zo=oe.getOrCreateProgram("model",Xr);!lt&&be&&be.setupShadowsFromMatrix(Vr.tileModelMatrix,Zo,be.useNormalOffset),oe.uploadCommonUniforms(Ce,Zo,null,Bs);const Ro=wi.pbrMetallicRoughness;Ro.metallicFactor=.9,Ro.roughnessFactor=.5;const Oa=Xc(new Float32Array(hi),new Float32Array(ai),new Float32Array(Ji),new Float32Array(un.matrix),oe,Vr.opacity,Ro.baseColorFactor,wi.emissiveFactor,Ro.metallicFactor,Ro.roughnessFactor,wi,bn,ge,[0,0,0],Dn);!Gn&&(en.hasTranslucentParts||Vr.opacity<1)&&Zo.draw(oe,Ce.gl.TRIANGLES,Ue,Nr.disabled,ln.disabled,Ar.backCCW,Oa,ge.id,mi.vertexBuffer,mi.indexBuffer,mi.segments,ge.paint,oe.transform.zoom,void 0,Gi),Zo.draw(oe,Ce.gl.TRIANGLES,Gn?Je:Ue,Nr.disabled,Gn||Vr.opacity<1||en.hasTranslucentParts?ln.alphaBlended:ln.unblended,Ar.backCCW,Oa,ge.id,mi.vertexBuffer,mi.indexBuffer,mi.segments,ge.paint,oe.transform.zoom,void 0,Gi)}}}}()}(f,n,c,p),void R();if(z.type!=="model")return;const j=z.getModels(),G=[],U=f.transform.getFreeCameraOptions().position,q=i.bY([],[U.x,U.y,U.z],f.transform.worldSize);i.eb(q,q);const re=[],Y=[];let ne=0;for(const oe of j){const ce=c.paint.get("model-rotation").constantOr(null),ge=c.paint.get("model-scale").constantOr(null),xe=c.paint.get("model-translation").constantOr(null);oe.computeModelMatrix(f,ce,ge,xe,!0,!0,!1);const Ce=i.bx([]),Ae=i.ec(oe.position.lat,f.transform.zoom),Te=i.bn([],[1,1,1/Ae]);i.bo(Ce,Ce,q),G.push({zScaleMatrix:Te,negCameraPosMatrix:Ce});for(const be of oe.nodes)pc(f.transform,be,oe.matrix,f.transform.expandedFarZProjMatrix,ne,re,Y);ne++}if(re.sort((oe,ce)=>ce.depth-oe.depth),f.renderPass!=="shadow"){if(x===1)for(const oe of Y)zt(oe,f,c,G[oe.modelIndex],Nr.disabled,f.colorModeForRenderPass());else{for(const oe of Y)zt(oe,f,c,G[oe.modelIndex],Nr.disabled,ln.disabled);for(const oe of Y)zt(oe,f,c,G[oe.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const oe of re)zt(oe,f,c,G[oe.modelIndex],Nr.disabled,f.colorModeForRenderPass());R()}else{for(const oe of Y)Di(oe.mesh,oe.nodeModelMatrix,f,c);for(const oe of re)Di(oe.mesh,oe.nodeModelMatrix,f,c);R()}}},ap={line:function(f,n,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const p=n.getVisibleCoordinates();for(const x of p){const S=n.getTile(x).getBucket(f);if(S&&(S.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,c){const p=n.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const S of x)S.upload(c.context)},raster:function(f,n,c){const p=n.getSource();if(!(p instanceof kc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-array-band")||p.getInitialBand(x);if(S==null)return;const E=n.getIds().map(M=>n.getTileByID(M));for(const M of E)M.updateNeeded(x,S)&&p.prepareTile(M,x,S)},"raster-particle":function(f,n,c){const p=n.getSource();if(!(p instanceof kc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(S==null)return;const E=n.getIds().map(M=>n.getTileByID(M));for(const M of E)M.updateNeeded(x,S)&&p.prepareTile(M,x,S)}},Hl={fill:Wd},Kh={fill:function(f,n,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=f.context.gl,S=new Kt(x.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),E=new Nr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),M=f.transform.getFreeCameraOptions().position,R=f.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const z of p){const j=n.getTile(z),G=j.getBucket(c);if(!G)continue;const U=G.elevatedStructures;if(!U||U.maskSegments.segments[0].primitiveLength===0)continue;const q=Gh(z.toUnwrapped(),M),re=f.translatePosMatrix(z.projMatrix,j,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Y=Ho(re,q,0,0,0);R.draw(f,x.TRIANGLES,S,E,ln.disabled,Ar.disabled,Y,c.id,U.vertexBuffer,U.indexBuffer,U.maskSegments,c.paint,f.transform.zoom)}}};class Yh{constructor(n,c,p,x,S,E){this.context=new Pg(n,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=S,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of M)this._debugParams.enabledLayers[z]=!0;S.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),S.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),S.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),S.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of M)S.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Tm(S),this.setup(),this.numSublayers=ro.maxUnderzooming+ro.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Vy(this),this._wireframeDebugCache=new Dg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,R,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=E}updateTerrain(n,c){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new io(this,n));const x=this._terrain;this.transform.elevation=p?x:null,x.update(n,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const S=p+.78*(x-p);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new io(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,c){if(this.width=n*i.q.devicePixelRatio,this.height=c*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const n=this.context,c=new i.ba;c.emplaceBack(0,0),c.emplaceBack(i.aj,0),c.emplaceBack(0,i.aj),c.emplaceBack(i.aj,i.aj),this.tileExtentBuffer=n.createVertexBuffer(c,i.bc.members),this.tileExtentSegments=i.bd.simpleSegment(0,0,4,2);const p=new i.ba;p.emplaceBack(0,0),p.emplaceBack(i.aj,0),p.emplaceBack(0,i.aj),p.emplaceBack(i.aj,i.aj),this.debugBuffer=n.createVertexBuffer(p,i.bc.members),this.debugSegments=i.bd.simpleSegment(0,0,4,5);const x=new i.ba;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,i.bc.members),this.viewportSegments=i.bd.simpleSegment(0,0,4,2);const S=new i.aZ;S.emplaceBack(0,0,0,0),S.emplaceBack(i.aj,0,i.aj,0),S.emplaceBack(0,i.aj,0,i.aj),S.emplaceBack(i.aj,i.aj,i.aj,i.aj),this.mercatorBoundsBuffer=n.createVertexBuffer(S,i.bf.members),this.mercatorBoundsSegments=i.bd.simpleSegment(0,0,4,2);const E=new i.a_;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(E);const M=new i.bb;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new i.T(n,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=i.bz();const R=this.context.gl;this.stencilClearMode=new Nr({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,Kt.disabled,this.stencilClearMode,ln.disabled,Ar.disabled,oa(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,p){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of p)if(this._tileClippingMaskIDs[R.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const x=this.context,S=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(ln.disabled),x.setDepthMode(Kt.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const R=c.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:G,tileBoundsSegments:U}=this.getTileBoundsBuffers(R);E.draw(this,S.TRIANGLES,Kt.disabled,new Nr({func:S.ALWAYS,mask:0},z,255,S.KEEP,S.KEEP,S.REPLACE),ln.disabled,Ar.disabled,oa(M.projMatrix),"$clipping",j,G,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new Nr({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new Nr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,p=n.sort((E,M)=>M.overscaledZ-E.overscaledZ),x=p[p.length-1].overscaledZ,S=p[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const E={};for(let M=0;M<S;M++)E[M+x]=new Nr({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[E,p]}return[{[x]:Nr.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new ln([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new i.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ln.unblended:ln.alphaBlended}colorModeForDrapableLayerRenderPass(n){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ln([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.am(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,c,p,x=!1){if(this.depthOcclusion)return new Kt(this.context.gl.GREATER,Kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Kt.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Kt(p||this.context.gl.LEQUAL,c,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),S=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Hh(this.context,c,p,!1,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:p,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),n.bindTexture(n.TEXTURE_2D,S),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,c,p,0,0,c,p,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((n,c)=>n+c/this._fpsHistory.length,0))}render(n,c){const p=i.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=c;const x=this.style._mergedLayers,S=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(S).filter(Ue=>{const Je=x[Ue];return!(Je.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Je.type]});let M=E(),R=!1,z=!1;for(const Ue of M){const Je=x[Ue];Je.type==="circle"&&(R=!0),Je.type==="symbol"&&(Je.hasInitialOcclusionOpacityProperties?z=!0:R=!0)}let j=M.map(Ue=>x[Ue]);const G=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let U=0,q=!1;for(const Ue in G){const Je=G[Ue];Je.used&&(Je.prepare(this.context),Je.getSource().usedInConflation&&++U)}let re=!1;for(const Ue of j)Ue.isHidden(this.transform.zoom)||(Ue.type==="clip"&&(re=!0),this.prepareLayer(Ue));const Y={},ne={},oe={},ce={},ge={};for(const Ue in G){const Je=G[Ue];Y[Ue]=Je.getVisibleCoordinates(),ne[Ue]=Y[Ue].slice().reverse(),oe[Ue]=Je.getVisibleCoordinates(!0).reverse(),ce[Ue]=Je.getShadowCasterCoordinates(),ge[Ue]=Je.sortCoordinatesByDistance(Y[Ue])}const xe=Ue=>{const Je=this.style.getLayerSourceCache(Ue);return Je&&Je.used?Je.getSource():null};if(U||re||this._clippingActiveLastFrame){const Ue=[],Je=[];let Le=0;for(const lt of j)this.isSourceForClippingOrConflation(lt,xe(lt))&&(Ue.push(lt),Je.push(Le)),Le++;if(Ue&&(re||Ue.length>1)||this._clippingActiveLastFrame){re=!1;const lt=[];for(let Ye=0;Ye<Ue.length;Ye++){const pt=Ue[Ye],It=Je[Ye],ct=this.style.getLayerSourceCache(pt);if(!ct||!ct.used||!ct.getSource().usedInConflation&&pt.type!=="clip")continue;let wt=i.eu,Vt=i.bQ.None;const qt=[];let Bt=!0;if(pt.type==="clip"){wt=It;for(const Xt of pt.layout.get("clip-layer-types"))Vt|=Xt==="model"?i.bQ.Model:Xt==="symbol"?i.bQ.Symbol:i.bQ.FillExtrusion;for(const Xt of pt.layout.get("clip-layer-scope"))qt.push(Xt);pt.isHidden(this.transform.zoom)?Bt=!1:re=!0}Bt&&lt.push({layer:pt.fqid,cache:ct,order:wt,clipMask:Vt,clipScope:qt})}this.replacementSource.setSources(lt),q=!0}}this._clippingActiveLastFrame=re,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ue=0;Ue<j.length;Ue++){const Je=j[Ue],Le=Je.cutoffRange();if(this.longestCutoffRange=Math.max(Le,this.longestCutoffRange),Le>0){const lt=xe(Je);lt&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom)),Je.minzoom&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom))}Je.is3D(S)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ue),this._lastOcclusionLayer=Ue)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0,M=E(),j=M.map(Ue=>x[Ue]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ue in G)for(const Je of Y[Ue]){let Le={min:0,max:0};this.terrain&&(Le=this.terrain.getMinMaxForTile(Je)||Le),Ae.addShadowReceiver(Je.toUnwrapped(),Le.min,Le.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Vl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new pi(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),be&&!this._rain&&(this._rain=new Og(this)),!be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Zn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ue of j){const Je=n.getLayerSourceCache(Ue);if(!Ue.hasOffscreenPass()||Ue.isHidden(this.transform.zoom))continue;const Le=Je?ne[Je.id]:void 0;(Ue.type==="custom"||Ue.type==="raster"||Ue.type==="raster-particle"||Ue.isSky()||Le&&Le.length)&&this.renderLayer(this,Je,Ue,Le)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(c.showOverdrawInspector)return i.am.black;const Ue=this.style.fog;if(Ue&&this.transform.projection.supportsFog){const Je=this.style.getLut(Ue.scope);if(!Ie){const Le=Ue.properties.get("color-use-theme")==="none",lt=Ue.properties.get("color").toNonPremultipliedRenderColor(Le?null:Je).toArray01();return new i.am(...lt)}if(Ie){const Le=Ue.properties.get("space-color-use-theme")==="none",lt=Ue.properties.get("space-color").toNonPremultipliedRenderColor(Le?null:Je).toArray01();return new i.am(...lt)}}return i.am.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Ue=j[this.currentLayer],Je=n.getLayerSourceCache(Ue);if(Ue.isSky())continue;const Le=Je?(Ue.is3D(S)?ge:ne)[Je.id]:void 0;this._renderTileClippingMasks(Ue,Je,Le),this.renderLayer(this,Je,Ue,Le)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Ue=j[this.currentLayer],Je=n.getLayerSourceCache(Ue);Ue.isSky()&&this.renderLayer(this,Je,Ue,Je?ne[Je.id]:void 0)}function Be(Ue,Je){let Le;return Je&&(Le=(Ue.type==="symbol"?oe:Ue.is3D(S)?ge:ne)[Je.id]),Le}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Ue=j[this.currentLayer];if(Ue.type==="raster"||Ue.type==="raster-particle"){const Je=n.getLayerSourceCache(Ue);this.renderLayer(this,Je,Ue,Be(Ue,Je))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;Ae&&(Ge=Ae.getShadowCastingLayerCount());let st=!1,it=-1;for(let Ue=0;Ue<M.length;++Ue){const Je=j[Ue];Je.isHidden(this.transform.zoom)||Je.is3D(S)&&(it=Ue)}z&&it===-1&&(R=!0);let mt=!1;for(;this.currentLayer<M.length;){const Ue=j[this.currentLayer],Je=n.getLayerSourceCache(Ue);if(Ue.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ue)){if(Ue.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!mt&&Ue.is3D(S)&&!S){const Le=this.currentLayer,lt=Ye=>{for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const pt=j[this.currentLayer];if(Hl[pt.type]){const It=this.style.getLayerSourceCache(pt);Hl[pt.type](this,It,pt,Be(pt,It),Ye)}}};lt("initialize"),lt("reset"),this.currentLayer=Le,mt=!0}if(R&&!st&&this.terrain&&!this.transform.isOrthographic&&(st=!0,this.blitDepth()),z&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ue,Je,Je?Y[Je.id]:void 0),this.renderLayer(this,Je,Ue,Be(Ue,Je)),!this.terrain&&Ae&&Ge>0&&Ue.hasShadowPass()&&--Ge==0){{this.clearStencil();const Le=this.currentLayer;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const lt=j[this.currentLayer];if(Kh[lt.type]){const Ye=this.style.getLayerSourceCache(lt);Kh[lt.type](this,Ye,lt,Be(lt,Ye))}}this.currentLayer=Le}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Le=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Le;this.currentLayer++){const lt=j[this.currentLayer];if(!lt.hasLightBeamPass())continue;const Ye=n.getLayerSourceCache(lt);this.renderLayer(this,Ye,lt,Ye?ne[Ye.id]:void 0)}this.currentLayer=Le,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Le=this.currentLayer;this.depthOcclusion=!0;for(const lt of this.layersWithOcclusionOpacity){this.currentLayer=lt;const Ye=j[this.currentLayer],pt=n.getLayerSourceCache(Ye),It=pt?ne[pt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ye,pt,pt?Y[pt.id]:void 0),this.renderLayer(this,pt,Ye,It)}this.depthOcclusion=!1,this.currentLayer=Le,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ue=null;j.forEach(Je=>{const Le=n.getLayerSourceCache(Je);Le&&!Je.isHidden(this.transform.zoom)&&Le.getVisibleCoordinates().length&&(!Ue||Ue.getSource().maxzoom<Le.getSource().maxzoom)&&(Ue=Le)}),Ue&&this.options.showTileBoundaries&&ua(this,Ue,Ue.getVisibleCoordinates(),i.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ua(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ue){const Je=Ue.transform.padding;Wh(Ue,Ue.transform.height-(Je.top||0),3,Bl),Wh(Ue,Je.bottom||0,3,Xd),ns(Ue,Je.left||0,3,oo),ns(Ue,Ue.transform.width-(Je.right||0),3,dc);const Le=Ue.transform.centerPoint;(function(lt,Ye,pt,It){fc(lt,Ye-1,pt-10,2,20,It),fc(lt,Ye-10,pt-1,20,2,It)})(Ue,Le.x,Ue.transform.height-Le.y,ao)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(n.type);if(ap[n.type]&&(p||this.terrain&&n.type==="custom")){const x=this.style.getLayerSourceCache(n);ap[n.type](n,x,this)}this.gpuTimingEnd()}renderLayer(n,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)&&(!n.terrain||p.type!=="custom")||p.type==="clip"||Tn[p.type](n,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(n.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const p in n){const x=n[p],S=this.context.extTimerQuery,E=S.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(x.query),c[p]=E}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of n)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(n,c,p,x,S){if(!p[0]&&!p[1])return n;const E=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),j=Math.cos(E);p=[p[0]*j-p[1]*z,p[0]*z+p[1]*j]}const M=[S?p[0]:i.aw(c,p[0],this.transform.zoom),S?p[1]:i.aw(c,p[1],this.transform.zoom),0],R=new Float32Array(16);return i.bo(R,n,M),R}saveTileTexture(n){const c=n.size[0],p=this._tileTextures[c];p?p.push(n):this._tileTextures[c]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,S=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||S.push("FOG","FOG_DITHERING"),x&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(n,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,S=this.currentGlobalDefines(n,c&&c.overrideFog,c&&c.overrideRtt).concat(p),E=ju.cacheKey(zd[n],n,S,x);return this.cache[E]||(this.cache[E]=new ju(this.context,n,zd[n],x,Vu[n],S)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const S=((E,M,R)=>{const z=E.properties.get("direction"),j=E.properties.get("color-use-theme")==="none",G=E.properties.get("color").toNonPremultipliedRenderColor(j?null:R.getLut(E.scope)).toArray01(),U=E.properties.get("intensity"),q=M.properties.get("color-use-theme")==="none",re=M.properties.get("color").toNonPremultipliedRenderColor(q?null:R.getLut(M.scope)).toArray01(),Y=M.properties.get("intensity"),ne=[z.x,z.y,z.z],oe=i.dw(re,Y),ce=i.dw(G,U);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:ne,u_lighting_directional_color:ce,u_ground_radiance:zu(ne,ce,oe)}})(p,x,this.style);c.setLightsUniformValues(n,S)}}}uploadCommonUniforms(n,c,p,x,S){if(this.uploadCommonLightUniforms(n,c),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const M=E.getOpacity(this.transform.pitch),R=((z,j,G,U,q,re,Y,ne,oe,ce,ge,xe)=>{const Ce=z.transform,Ae=j.properties.get("color-use-theme")==="none",Te=j.properties.get("color").toNonPremultipliedRenderColor(Ae?null:z.style.getLut(j.scope)).toArray01();Te[3]=U;const be=z.frameCounter/1e3%1,[Ie,Re]=j.properties.get("vertical-range");return{u_fog_matrix:G?Ce.calculateFogTileMatrix(G):xe||z.identityMat,u_fog_range:j.getFovAdjustedRange(Ce._fov),u_fog_color:Te,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Re),Re],u_fog_temporal_offset:be,u_frustum_tl:q,u_frustum_tr:re,u_frustum_br:Y,u_frustum_bl:ne,u_globe_pos:oe,u_globe_radius:ce,u_viewport:ge,u_globe_transition:i.ah(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,E,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],x);c.setFogUniformValues(n,R)}S&&c.setCutoffUniformValues(n,S.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=n[x.key]||new Dc(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,c){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[n.key];return c||(this._cachedTileFogOpacities[n.key]=c=this.style.fog.getOpacityForTile(n)),c[0]>=Ze||c[1]>=Ze}setupDepthForOcclusion(n,c,p){const x=this.context,S=x.gl,E=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(S.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),x.activeTexture.set(S.TEXTURE0),E||c.setTerrainUniformValues(x,p)}}function mc(f,n){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,n),c=!1)};return()=>(c=!0,p||x(),p)}class Em{constructor(n){this._hashName=n&&encodeURIComponent(n),i.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=mc(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=lp(n);if(this._hashName){const p=this._hashName;let x=!1;const S=location.hash.slice(1).split("&").map(E=>{const M=E.split("=")[0];return M===p?(x=!0,`${M}=${c}`):E}).filter(E=>E);return x||S.push(`${p}=${c}`),`#${S.join("&")}`}return`#${c}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function lp(f,n){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),E=Math.round(c.lng*S)/S,M=Math.round(c.lat*S)/S,R=f.getBearing(),z=f.getPitch();let j=n?`/${E}/${M}/${p}`:`${p}/${M}/${E}`;return(R||z)&&(j+="/"+Math.round(10*R)/10),z&&(j+=`/${Math.round(z)}`),j}const qu={linearity:.3,easing:i.ew(0,0,.3,1)},cp=i.h({deceleration:2500,maxSpeed:1400},qu),gl=i.h({deceleration:20,maxSpeed:1400},qu),yl=i.h({deceleration:1e3,maxSpeed:360},qu),Qd=i.h({deceleration:1e3,maxSpeed:90},qu);class up{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=i.q.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const S=Mo(c.pan.mag(),p,i.h({},cp,n||{}));x.offset=c.pan.mult(S.amount/c.pan.mag()),x.center=this._map.transform.center,Jh(x,S)}if(c.zoom){const S=Mo(c.zoom,p,gl);x.zoom=this._map.transform.zoom+S.amount,Jh(x,S)}if(c.bearing){const S=Mo(c.bearing,p,yl);x.bearing=this._map.transform.bearing+i.ay(S.amount,-179,179),Jh(x,S)}if(c.pitch){const S=Mo(c.pitch,p,Qd);x.pitch=this._map.transform.pitch+S.amount,Jh(x,S)}if(x.zoom||x.bearing){const S=c.pinchAround===void 0?c.around:c.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Jh(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Mo(f,n,c){const{maxSpeed:p,linearity:x,deceleration:S}=c,E=i.ay(f*x/(n/1e3),-p,p),M=Math.abs(E)/(S*x);return{easing:c.easing,duration:1e3*M,amount:E*(M/2)}}class Ps extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p,x={}){const S=Rt(c.getCanvasContainer(),p),E=c.unproject(S);super(n,i.h({point:S,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class gc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,p){const x=n==="touchend"?p.changedTouches:p.touches,S=hr(c.getCanvasContainer(),x),E=S.map(R=>c.unproject(R)),M=S.reduce((R,z,j,G)=>R.add(z.div(G.length)),new i.P(0,0));super(n,{points:S,point:M,lngLats:E,lngLat:c.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class yc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class hp{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new yc(this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Ps(n.type,this._map,n))}mouseup(n){this._map.fire(new Ps(n.type,this._map,n))}preclick(n){const c=i.h({},n);c.type="preclick",this._map.fire(new Ps(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Ps(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Ps(n.type,this._map,n))}mouseover(n){this._map.fire(new Ps(n.type,this._map,n))}mouseout(n){this._map.fire(new Ps(n.type,this._map,n))}touchstart(n){return this._firePreventable(new gc(n.type,this._map,n))}touchmove(n){this._map.fire(new gc(n.type,this._map,n))}touchend(n){this._map.fire(new gc(n.type,this._map,n))}touchcancel(n){this._map.fire(new gc(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ef{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Ps(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ps("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Ps(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tf{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(ht(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const p=c,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const E=Math.min(x.x,p.x),M=Math.max(x.x,p.x),R=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${R}px)`,this._box.style.width=M-E+"px",this._box.style.height=z-R+"px")})}mouseupWindow(n,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&n.button===0){if(this.reset(),kt(),p.x!==x.x||p.y!==x.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:n})),{cameraAnimation:S=>S.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new i.A(n,{originalEvent:c}))}}function Gl(f,n){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=n[p];return c}class Rs{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const S=new i.P(0,0);for(const E of x)S._add(E);return S.div(x.length)}(c),this.touches=Gl(p,c)))}touchmove(n,c,p){if(this.aborted||!this.centroid)return;const x=Gl(p,c);for(const S in this.touches){const E=x[S];(!E||E.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(n,c,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Wu{constructor(n){this.singleTap=new Rs(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,p){this.singleTap.touchstart(n,c,p)}touchmove(n,c,p){this.singleTap.touchmove(n,c,p)}touchend(n,c,p){const x=this.singleTap.touchend(n,c,p);if(x){const S=n.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(S&&E||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Cm{constructor(){this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,p){this._zoomIn.touchstart(n,c,p),this._zoomOut.touchstart(n,c,p)}touchmove(n,c,p){this._zoomIn.touchmove(n,c,p),this._zoomOut.touchmove(n,c,p)}touchend(n,c,p){const x=this._zoomIn.touchend(n,c,p),S=this._zoomOut.touchend(n,c,p);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:n})}):S?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(S)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const dp={0:1,2:2},_c={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const p=Tr(n);this._correctButton(n,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(n,c){const p=this._lastPoint;if(p){if(n.preventDefault(),this._eventButton!=null&&function(x,S){const E=dp[S];return x.buttons===void 0||(x.buttons&E)!==E}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(n){this._lastPoint&&Tr(n)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fp extends Qh{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class rf extends Qh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?_c[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=.8*(c.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class Zu extends Qh{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?_c[n.pitchRotateKey]:void 0}_correctButton(n,c){return this._pitchRotateKey?c===0&&n[this._pitchRotateKey]:c===0&&n.ctrlKey||c===2}_move(n,c){const p=-.5*(c.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class ko{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(n,c,p){return this._calculateTransform(n,c,p)}touchmove(n,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,p)}}touchend(n,c,p){this._calculateTransform(n,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,p){p.length>0&&(this._active=!0);const x=Gl(p,c),S=new i.P(0,0),E=new i.P(0,0);let M=0;for(const z in x){const j=x[z],G=this._touches[z];G&&(S._add(j),E._add(j.sub(G)),M++,x[z]=j)}if(this._touches=x,M<this._minTouches||!E.mag())return;const R=E.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ys{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,p){return{}}touchstart(n,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,p){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[S,E]=x,M=Xu(p,c,S),R=Xu(p,c,E);if(!M||!R)return;const z=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],z,n)}touchend(n,c,p){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,E=Xu(p,c,x),M=Xu(p,c,S);E&&M||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xu(f,n,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return n[p]}function ed(f,n){return Math.log(f/n)/Math.LN2}class pp extends Ys{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ed(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ed(this._distance,p),pinchAround:c}}}function nf(f,n){return 180*f.angleWith(n)/Math.PI}class Am extends Ys{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const p=this._vector;if(this._vector=n[0].sub(n[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:nf(this._vector,p),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=nf(n,p);return Math.abs(x)<c}}function td(f){return Math.abs(f.y)>Math.abs(f.x)}class Im extends Ys{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,td(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,p){const x=this._lastPoints;if(!x)return;const S=n[0].sub(x[0]),E=n[1].sub(x[1]);return this._map._cooperativeGestures&&!i.ex()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(S,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(S.y+E.y)/2*-.5})}gestureBeginsVertically(n,c,p){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,S=c.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=n.y>0==c.y>0;return td(n)&&td(c)&&E}}const mp={panStep:100,bearingStep:15,pitchStep:10};class Mm{constructor(){const n=mp;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,p=0,x=0,S=0,E=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),S=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),S=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),E=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:km,zoom:c?Math.round(R)+c*(n.shiftKey?2:1):R,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-E*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function km(f){return f*(2-f)}const sf=4.000244140625,gp=1/450;class Pm{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=gp,i.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||i.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=i.q.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%sf==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Rt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>sf?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&j!==0&&(j=1/j);const G=c(),U=Math.pow(2,G),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*j))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,S=this._easing;let E,M=!1;if(this._type==="wheel"&&x&&S){const z=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),j=S(z);E=i.ai(x,p,j),z<1?this._frameId||(this._frameId=!0):M=!0}else E=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=E-c();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=i.ey;if(this._prevEase){const p=this._prevEase,x=(i.q.now()-p.start)/p.duration,S=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(S*S+1e-4)*.01,M=Math.sqrt(.0729-E*E);c=i.ew(E,M,.25,1)}return this._prevEase={start:i.q.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class yp{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class of{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lg{constructor(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,c,p))}touchmove(n,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(n,c,p)}touchend(n,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(n,c,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rm{constructor(n,c,p){this._el=n,this._mousePan=c,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nm{constructor(n,c,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zg{constructor(n,c,p,x){this._el=n,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ku=f=>f.zoom||f.drag||f.pitch||f.rotate;class si extends i.A{}class jg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const p=i.at([],c,n);this.radius=i.ae(p[2]<0?i.eA([],p,this.constants):[p[0],p[1],0])}projectRay(n){i.eA(n,n,this.constants),i.au(n,n),i.eB(n,n,this.constants);const c=i.bY([],n,this.radius);if(c[2]>0){const p=i.bY([],[0,0,1],i.bG(c,[0,0,1])),x=i.bY([],i.au([],[c[0],c[1],0]),this.radius),S=i.cV([],c,i.bY([],i.at([],i.cV([],x,p),c),2));c[0]=S[0],c[1]=S[1]}return c}}function af(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class lf{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new up(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new jg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aV(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,E]of this._listeners){const M=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(S,M,E)}}destroy(){for(const[n,c,p]of this._listeners){const x=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(c,x,p)}}_addDefaultHandlers(n){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new hp(c,n));const x=c.boxZoom=new tf(c,n);this._add("boxZoom",x);const S=new Cm,E=new of;c.doubleClickZoom=new yp(E,S),this._add("tapZoom",S),this._add("clickZoom",E);const M=new Lg;this._add("tapDragZoom",M);const R=c.touchPitch=new Im(c);this._add("touchPitch",R);const z=new rf(n),j=new Zu(n);c.dragRotate=new Nm(n,z,j),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const G=new fp(n),U=new ko(c,n);c.dragPan=new Rm(p,G,U),this._add("mousePan",G),this._add("touchPan",U,["touchZoom","touchRotate"]);const q=new Am,re=new pp;c.touchZoomRotate=new zg(p,re,q,M),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ef(c));const Y=c.scrollZoom=new Pm(c,this);this._add("scrollZoom",Y,["mousePan"]);const ne=c.keyboard=new Mm;this._add("keyboard",ne);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[oe]&&c[oe].enable(n[oe])}_add(n,c,p){this._handlers.push({handlerName:n,handler:c,allowed:p}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ku(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,p){for(const x in n)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const p of n)this._el.contains(p.target)&&c.push(p);return c}handleEvent(n,c){this._updatingCamera=!0;const p=n.type==="renderFrame",x=p?void 0:n,S={needsRenderFrame:!1},E={},M={},R=n.touches?this._getMapTouches(n.touches):void 0,z=R?hr(this._el,R):p?void 0:Rt(this._el,n);for(const{handlerName:U,handler:q,allowed:re}of this._handlers){if(!q.isEnabled())continue;let Y;this._blockedByActive(M,re,U)?q.reset():q[c||n.type]&&(Y=q[c||n.type](n,z,R),this.mergeHandlerResult(S,E,Y,U,x),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||q.isActive())&&(M[U]=q)}const j={};for(const U in this._previousActiveHandlers)M[U]||(j[U]=x);this._previousActiveHandlers=M,(Object.keys(j).length||af(S))&&(this._changes.push([S,E,j]),this._triggerRenderFrame()),(Object.keys(M).length||af(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(n,c,p,x,S){if(!p)return;i.h(n,p);const E={handlerName:x,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(c.zoom=E),p.panDelta!==void 0&&(c.drag=E),p.pitchDelta!==void 0&&(c.pitch=E),p.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const n={},c={},p={};for(const[x,S,E]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new i.P(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),i.h(c,S),i.h(p,E);this._updateMapTransform(n,c,p),this._changes=[]}_updateMapTransform(n,c,p){const x=this._map,S=x.transform,E=ce=>[ce.x,ce.y,ce.z];if((ce=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!af(n)){const ce=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ce!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!af(n))return void this._fireEvents(c,p,!0);let{panDelta:M,zoomDelta:R,bearingDelta:z,pitchDelta:j,around:G,aroundCoord:U,pinchAround:q}=n;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),q!==void 0&&(G=q),(R||(ce=>c[ce]&&!this._eventsInProgress[ce])("drag"))&&G&&(this._dragOrigin=E(S.pointCoordinate3D(G)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,z&&(S.bearing+=z),j&&(S.pitch+=j),S._updateCameraState();const re=[0,0,0];if(M)if(S.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(G).dir),ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(G.sub(M)).dir);re[0]=ge[0]-ce[0],re[1]=ge[1]-ce[1]}else{const ce=S.pointCoordinate(G);if(S.projection.name==="globe"){M=M.rotate(-S.angle);const ge=S._pixelsPerMercatorPixel/S.worldSize;re[0]=-M.x*i.ez(i.aY(ce.y))*ge,re[1]=-M.y*i.ez(S.center.lat)*ge}else{const ge=S.pointCoordinate(G.sub(M));ce&&ge&&(re[0]=ge.x-ce.x,re[1]=ge.y-ce.y)}}const Y=S.zoom,ne=[0,0,0];if(R){const ce=E(U||S.pointCoordinate3D(G)),ge={dir:i.au([],i.at([],ce,S._camera.position))};if(ge.dir[2]<0){const xe=S.zoomDeltaToMovement(ce,R);i.bY(ne,ge.dir,xe)}}const oe=i.cV(re,re,ne);S._translateCameraConstrained(oe),R&&Math.abs(S.zoom-Y)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,p,!0)}_fireEvents(n,c,p){const x=Ku(this._eventsInProgress),S=Ku(n),E={};for(const j in n){const{originalEvent:G}=n[j];this._eventsInProgress[j]||(E[`${j}start`]=G),this._eventsInProgress[j]=n[j]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const j in E)this._fireEvent(j,E[j]);S&&this._fireEvent("move",S.originalEvent);for(const j in n){const{originalEvent:G}=n[j];this._fireEvent(j,G)}const M={};let R;for(const j in this._eventsInProgress){const{handlerName:G,originalEvent:U}=this._eventsInProgress[j];this._handlersById[G].isActive()||(delete this._eventsInProgress[j],R=c[G]||U,M[`${j}end`]=R)}for(const j in M)this._fireEvent(j,M[j]);const z=Ku(this._eventsInProgress);if(p&&(x||S)&&!z){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;j?(G(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:R})):(this._map.fire(new i.A("moveend",{originalEvent:R})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new i.A(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new si("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rd extends i.E{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aV(["_renderFrameCallback"],this)}getCenter(){return new i.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,p){return n=i.P.convert(n).mult(-1),this.panTo(this.transform.center,i.h({offset:n},c),p)}panTo(n,c,p){return this.easeTo(i.h({center:n},c),p)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,p){return this.easeTo(i.h({zoom:n},c),p)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,p){return this.easeTo(i.h({bearing:n},c),p)}resetNorth(n,c){return this.rotateTo(0,i.h({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(i.h({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=i.aG.convert(n);const p=c&&c.bearing||0,x=c&&c.pitch||0,S=n.getNorthWest(),E=n.getSouthEast();return this._cameraForBounds(this.transform,S,E,p,x,c)}_extendPadding(n){const c={top:0,right:0,bottom:0,left:0};return n==null?i.h({},c,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:i.h({},c,n)}_extendCameraOptions(n){return(n=i.h({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>n.aspect?p/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,p,x,S,E){const M=n.clone(),R=this._extendCameraOptions(E);M.bearing=x,M.pitch=S;const z=i.cd.convert(c),j=i.cd.convert(p),G=.5*(z.lat+j.lat),U=.5*(z.lng+j.lng),q=i.eC(G,U),re=i.au([],q),Y=i.au([],i.bF([],re,[0,1,0])),ne=i.bF([],Y,re),oe=[Y[0],Y[1],Y[2],0,ne[0],ne[1],ne[2],0,re[0],re[1],re[2],0,0,0,0,1],ce=[q,i.eC(z.lat,z.lng),i.eC(j.lat,z.lng),i.eC(j.lat,j.lng),i.eC(z.lat,j.lng),i.eC(G,z.lng),i.eC(G,j.lng),i.eC(z.lat,U),i.eC(j.lat,U)];let ge=i.cW.fromPoints(ce.map(Ye=>[i.bG(Y,Ye),i.bG(ne,Ye),i.bG(re,Ye)]));const xe=i.ad([],ge.center,oe);i.eD(xe)===0&&i.eE(xe,0,0,1),i.au(xe,xe),i.bY(xe,xe,i.aB),M.center=i.eF(xe);const Ce=M.getWorldToCameraMatrix(),Ae=i.bi(new Float64Array(16),Ce);ge=i.cW.applyTransform(ge,i.az([],Ce,oe));const Te=this._extendAABB(ge,M,R,x);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=Te,i.ad(xe,xe,Ce);const be=.5*(ge.max[2]-ge.min[2]),Ie=this._minimumAABBFrustumDistance(M,ge),Re=i.bY([],[0,0,1],be),Be=i.cV(Re,xe,Re),Ge=Ie+(M.pitch===0?0:i.bD(xe,Be)),st=M.globeCenterInViewSpace,it=i.at([],xe,[st[0],st[1],st[2]]);i.au(it,it),i.bY(it,it,Ge);const mt=i.cV([],xe,it);i.ad(mt,mt,Ae);const Ue=i.eq/i.aB,Je=i.ae(mt),Le=i.c6(Math.max(Je*Ue-i.eq,Number.EPSILON),0),lt=Math.min(M.zoomFromMercatorZAdjusted(Le),R.maxZoom);return lt>.5*(i.cL+i.cx)?(M.setProjection({name:"mercator"}),M.zoom=lt,this._cameraForBounds(M,c,p,x,S,E)):{center:M.center,zoom:lt,bearing:x,pitch:S}}_extendAABB(n,c,p,x){const S=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=E,R=S,z=S,j=E,G=c.width-(R+z),U=c.height-(M+j),q=i.at([],n.max,n.min),re=Math.min(G/q[0],U/q[1]),Y=Math.min(c.scaleZoom(c.scale*re),p.maxZoom);if(isNaN(Y))return null;const ne=c.scale/c.zoomScale(Y),oe=new i.cW([n.min[0]-R*ne,n.min[1]-j*ne,n.min[2]],[n.max[0]+z*ne,n.max[1]+M*ne,n.max[2]]),ce=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.al(x));return oe.center[0]-=ce.x*ne,oe.center[1]+=ce.y*ne,oe}queryTerrainElevation(n,c){const p=this.transform.elevation;return p?(c=i.h({},{exaggerated:!0},c),p.getAtPoint(i.ac.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,p,x,S,E){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,p,x,S,E);const M=n.clone(),R=this._extendCameraOptions(E);M.bearing=x,M.pitch=S;const z=i.cd.convert(c),j=i.cd.convert(p),G=new i.cd(z.lng,j.lat),U=new i.cd(j.lng,z.lat),q=M.project(z),re=M.project(j),Y=this.queryTerrainElevation(z),ne=this.queryTerrainElevation(j),oe=this.queryTerrainElevation(G),ce=this.queryTerrainElevation(U),ge=[[q.x,q.y,Math.min(Y||0,ne||0,oe||0,ce||0)],[re.x,re.y,Math.max(Y||0,ne||0,oe||0,ce||0)]];let xe=i.cW.fromPoints(ge);const Ce=M.getWorldToCameraMatrix(),Ae=i.bi(new Float64Array(16),Ce);xe=i.cW.applyTransform(xe,Ce);const Te=this._extendAABB(xe,M,R,x);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=Te;const be=.5*i.at([],xe.max,xe.min)[2],Ie=this._minimumAABBFrustumDistance(M,xe),Re=[0,0,1,0];i.aA(Re,Re,Ce),i.eG(Re,Re);const Be=i.bY([],Re,Ie+be),Ge=i.cV([],xe.center,Be);i.ad(xe.center,xe.center,Ae),i.ad(Ge,Ge,Ae);const st=M.unproject(new i.P(xe.center[0],xe.center[1])),it=i.eH(M.projection,st),mt=Math.pow(2,it),Ue=Math.min(M._zoomFromMercatorZ(Ge[2]*M.pixelsPerMeter*mt/M.worldSize),R.maxZoom);return M.mercatorFromTransition&&Ue<.5*(i.cL+i.cx)?(M.setProjection({name:"globe"}),M.zoom=Ue,this._cameraForBounds(M,c,p,x,S,E)):{center:st,zoom:Ue,bearing:x,pitch:S}}fitBounds(n,c,p){const x=this.cameraForBounds(n,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(n,c,p,x,S){const E=i.P.convert(n),M=i.P.convert(c),R=new i.P(Math.min(E.x,M.x),Math.min(E.y,M.y)),z=new i.P(Math.max(E.x,M.x),Math.max(E.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,M))return this;const j=this.transform.pointLocation3D(R),G=this.transform.pointLocation3D(z),U=this.transform.pointLocation3D(new i.P(R.x,z.y)),q=this.transform.pointLocation3D(new i.P(z.x,R.y)),re=[Math.min(j.lng,G.lng,U.lng,q.lng),Math.min(j.lat,G.lat,U.lat,q.lat)],Y=[Math.max(j.lng,G.lng,U.lng,q.lng),Math.max(j.lat,G.lat,U.lat,q.lat)],ne=x&&x.pitch?x.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,re,Y,p,ne,x);return this._fitInternal(oe,x,S)}_fitInternal(n,c,p){return n?(c=i.h(n,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(n,c){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,E=!1;"zoom"in n&&p.zoom!==+n.zoom&&(x=!0,p.zoom=+n.zoom),n.center!==void 0&&(p.center=i.cd.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(S=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(E=!0,p.pitch=+n.pitch);const M=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!p.isPaddingEqual(M))if(n.retainPadding===!1){const R=p.clone();R.padding=M,p.setLocationAtPoint(p.center,R.centerPoint)}else p.padding=M;return n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),x&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),S&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),E&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Dm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(Dm),this;this.stop();const x=p.zoom,S=p.pitch,E=p.bearing;p.setFreeCameraOptions(n);const M=x!==p.zoom,R=S!==p.pitch,z=E!==p.bearing;return this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),M&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),z&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),R&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=i.h({offset:[0,0],duration:500,easing:i.ey},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const p=this.transform,x=this.getZoom(),S=this.getBearing(),E=this.getPitch(),M=this.getPadding(),R="zoom"in n?+n.zoom:x,z="bearing"in n?this._normalizeBearing(n.bearing,S):S,j="pitch"in n?+n.pitch:E,G=this._extendPadding(n.padding),U=i.P.convert(n.offset);let q,re,Y;if(p.projection.name==="globe"){const Re=i.ac.fromLngLat(p.center),Be=U.rotate(-p.angle);Re.x+=Be.x/p.worldSize,Re.y+=Be.y/p.worldSize;const Ge=Re.toLngLat(),st=i.cd.convert(n.center||Ge);this._normalizeCenter(st),q=p.centerPoint.add(Be),re=new i.P(Re.x,Re.y).mult(p.worldSize),Y=new i.P(i.aD(st.lng),i.aH(st.lat)).mult(p.worldSize).sub(re)}else{q=p.centerPoint.add(U);const Re=p.pointLocation(q),Be=i.cd.convert(n.center||Re);this._normalizeCenter(Be),re=p.project(Re),Y=p.project(Be).sub(re)}const ne=p.zoomScale(R-x);let oe,ce;n.around&&(oe=i.cd.convert(n.around),ce=p.locationPoint(oe));const ge=this._zooming||R!==x,xe=this._rotating||S!==z,Ce=this._pitching||j!==E,Ae=!p.isPaddingEqual(G),Te=n.retainPadding===!1?p.clone():p,be=Re=>Be=>{if(ge&&(Re.zoom=i.ai(x,R,Be)),xe&&(Re.bearing=i.ai(S,z,Be)),Ce&&(Re.pitch=i.ai(E,j,Be)),Ae&&(Te.interpolatePadding(M,G,Be),q=Te.centerPoint.add(U)),oe)Re.setLocationAtPoint(oe,ce);else{const Ge=Re.zoomScale(Re.zoom-x),st=R>x?Math.min(2,ne):Math.max(.5,ne),it=Math.pow(st,1-Be),mt=Re.unproject(re.add(Y.mult(Be*it)).mult(Ge));Re.setLocationAtPoint(Re.renderWorldCopies?mt.wrap():mt,q)}return n.preloadOnly||this._fireMoveEvents(c),Re};if(n.preloadOnly){const Re=this._emulate(be,n.duration,p);return this._preloadTiles(Re),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=xe,this._pitching=Ce,this._padding=Ae,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,Ie),this._ease(be(p),Re=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Re)},n),this}_prepareEase(n,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new i.A("movestart",n)),this._zooming&&!p.zooming&&this.fire(new i.A("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new i.A("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new i.A("pitchstart",n))}_fireMoveEvents(n){this.fire(new i.A("move",n)),this._zooming&&this.fire(new i.A("zoom",n)),this._rotating&&this.fire(new i.A("rotate",n)),this._pitching&&this.fire(new i.A("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.A("zoomend",n)),x&&this.fire(new i.A("rotateend",n)),S&&this.fire(new i.A("pitchend",n)),this.fire(new i.A("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const Ye=i.aF(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ye,c)}this.stop(),n=i.h({offset:[0,0],speed:1.2,curve:1.42,easing:i.ey},n);const p=this.transform,x=this.getZoom(),S=this.getBearing(),E=this.getPitch(),M=this.getPadding(),R="zoom"in n?i.ay(+n.zoom,p.minZoom,p.maxZoom):x,z="bearing"in n?this._normalizeBearing(n.bearing,S):S,j="pitch"in n?+n.pitch:E,G=this._extendPadding(n.padding),U=p.zoomScale(R-x),q=i.P.convert(n.offset);let re=p.centerPoint.add(q);const Y=p.pointLocation(re),ne=i.cd.convert(n.center||Y);this._normalizeCenter(ne);const oe=p.project(Y),ce=p.project(ne).sub(oe);let ge=n.curve;const xe=Math.max(p.width,p.height),Ce=xe/U,Ae=ce.mag();if("minZoom"in n){const Ye=i.ay(Math.min(n.minZoom,x,R),p.minZoom,p.maxZoom),pt=xe/p.zoomScale(Ye-x);ge=Math.sqrt(pt/Ae*2)}const Te=ge*ge;function be(Ye){const pt=(Ce*Ce-xe*xe+(Ye?-1:1)*Te*Te*Ae*Ae)/(2*(Ye?Ce:xe)*Te*Ae);return Math.log(Math.sqrt(pt*pt+1)-pt)}function Ie(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Re(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Be=be(0);let Ge=function(Ye){return Re(Be)/Re(Be+ge*Ye)},st=function(Ye){return xe*((Re(Be)*(Ie(pt=Be+ge*Ye)/Re(pt))-Ie(Be))/Te)/Ae;var pt},it=(be(1)-Be)/ge;if(Math.abs(Ae)<1e-6||!isFinite(it)){if(Math.abs(xe-Ce)<1e-6)return this.easeTo(n,c);const Ye=Ce<xe?-1:1;it=Math.abs(Math.log(Ce/xe))/ge,st=function(){return 0},Ge=function(pt){return Math.exp(Ye*ge*pt)}}n.duration="duration"in n?+n.duration:1e3*it/("screenSpeed"in n?+n.screenSpeed/ge:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const mt=S!==z,Ue=j!==E,Je=!p.isPaddingEqual(G),Le=n.retainPadding===!1?p.clone():p,lt=Ye=>pt=>{const It=pt*it,ct=1/Ge(It);Ye.zoom=pt===1?R:x+Ye.scaleZoom(ct),mt&&(Ye.bearing=i.ai(S,z,pt)),Ue&&(Ye.pitch=i.ai(E,j,pt)),Je&&(Le.interpolatePadding(M,G,pt),re=Le.centerPoint.add(q));const wt=pt===1?ne:Ye.unproject(oe.add(ce.mult(st(It))).mult(ct));return Ye.setLocationAtPoint(Ye.renderWorldCopies?wt.wrap():wt,re),Ye._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),Ye};if(n.preloadOnly){const Ye=this._emulate(lt,n.duration,p);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=mt,this._pitching=Ue,this._padding=Je,this._prepareEase(c,!1),this._ease(lt(p),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,c,p){p.animate===!1||p.duration===0?(n(1),c()):(this._easeStart=i.q.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=i.bX(n,-180,180);const p=Math.abs(n-c);return Math.abs(n-360-c)<p&&(n-=360),Math.abs(n+360-c)<p&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=n.lng-c.center.lng;n.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,p){const x=Math.ceil(15*c/1e3),S=[],E=n(p.clone());for(let M=0;M<=x;M++){const R=E(M/x);S.push(R.clone())}return S}_preloadTiles(n,c){}}class Yu{constructor(n={}){this.options=n,i.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact,p=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=W("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(n){const p=c.reduce((x,S,E)=>(S.value&&(x+=`${S.key}=${S.value}${E<c.length-1?"&":""}`),x),"?");n.href=`${i.e.FEEDBACK_URL}/${p}#${lp(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const S=c[x];if(S.used){const E=S.getSource();E.attribution&&n.indexOf(E.attribution)<0&&n.push(E.attribution)}}n.sort((x,S)=>x.length-S.length),n=n.filter((x,S)=>{for(let E=S+1;E<n.length;E++)if(n[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Js{constructor(){i.aV(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=W("div","mapboxgl-ctrl");const c=W("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const p=n[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class cf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class xc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=i.dk((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,p){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+p}}const Ju={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Xn extends i.A{constructor(n,c,p,x){const{point:S,lngLat:E,originalEvent:M,target:R}=n;super(n.type,{point:S,lngLat:E,originalEvent:M,target:R}),this.preventDefault=()=>{n.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class ql{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,c){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(n,i.b3(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const S=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,c)):S.size===0&&this.map.on(x,this.handleType),S.size===0&&this.interactionsByType.set(x,S),S.set(n,c),this.typeById.set(n,x)}get(n){const c=this.typeById.get(n);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(n):void 0}remove(n){const c=this.typeById.get(n);if(!c)return;this.typeById.delete(n),this.filters.delete(n);const p=this.interactionsByType.get(c);p&&(p.delete(n),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(n,c){const p=[];for(const[x,S]of c)S.target&&p.push({targetId:x,target:S.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(n,p,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());c.length&&(n.type="mouseenter",this.handleType(n,c));const p=new Map;for(const[x,{feature:S}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(S.id,S);p.size&&(n.type="mouseleave",this.handleType(n,Array.from(p.values())))}handleOut(n){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(n.type="mouseleave",this.handleType(n,c)),this.hoveredFeatures.clear()}handleType(n,c){const p=n.type==="mouseenter";if(p&&!this.interactionsByType.has(n.type))return void i.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(n.type)).reverse(),S=!!c;c=c||this.queryTargets(n.point,x);let E=!1;const M=new Set;for(const R of c){for(const[z,j]of x){if(!j.target)continue;const G=R.variants?R.variants[z]:null;if(G){for(const U of G){if(Nc(U,R,M,z))continue;const q=new i.de(R,U),re=Rc(U,R,z);S&&(q.state=this.map.getFeatureState(q));const Y=p?this.prevHoveredFeatures.get(re):null,ne=new Xn(n,z,j,q),oe=Y?Y.stop:j.handler(ne);if(p&&this.hoveredFeatures.set(re,{feature:R,stop:oe}),oe!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[R,z]of x){const{handler:j,target:G}=z;if(!G&&j(new Xn(n,R,z,null))!==!1)break}}}function qr(f,n){if(Array.isArray(f)&&Array.isArray(n)){const c=new Set(f),p=new Set(n);return c.size===p.size&&f.every(x=>p.has(x))}return i.bv(f,n)}const vc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},_p={showCompass:!0,showZoom:!0,visualizePitch:!1};class Fg{constructor(n,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new rf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new Zu({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),i.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),ht()}move(n,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(n,c),S=x&&x.bearingDelta;if(S&&p.setBearing(p.getBearing()+S),this.mousePitch){const E=this.mousePitch.mousemoveWindow(n,c),M=E&&E.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(i.h({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Rt(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Rt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=hr(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=hr(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function nd(f,n,c){if(f=new i.cd(f.lng,f.lat),n){const p=new i.cd(f.lng-360,f.lat),x=new i.cd(f.lng+360,f.lat),S=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint3D(f).distSqr(n),M=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint3D(p).distSqr(n)<E&&(M||Math.abs(p.lng-c.center.lng)<S)?f=p:c.locationPoint3D(x).distSqr(n)<E&&(M||Math.abs(x.lng-c.center.lng)<S)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Na={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class eh extends i.E{constructor(n,c){super(),(n instanceof HTMLElement||c)&&(n=i.h({element:n},c)),i.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:S=1,draggable:E=!1,clickTolerance:M=0,rotation:R=Na.rotation,rotationAlignment:z=Na.rotationAlignment,pitchAlignment:j=Na.pitchAlignment,occludedOpacity:G=Na.occludedOpacity,altitude:U=Na.altitude}=n||{};this._anchor=p,this._color=x,this._scale=S,this._draggable=E,this._clickTolerance=M,this._rotation=R,this._rotationAlignment=z,this._pitchAlignment=j,this._occludedOpacity=G,this._altitude=U,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=i.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Y=>{Y.preventDefault()}),this._element.addEventListener("mousedown",Y=>{Y.preventDefault()});const q=this._element.classList;for(const Y in Qu)q.remove(`mapboxgl-marker-anchor-${Y}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const re=n&&n.className?n.className.trim().split(/\s+/):[];q.add(...re),this._popup=null}_createDefaultMarker(){const n=W("div"),c=ie("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const p=ie("radialGradient",{id:"shadowGradient"},ie("defs",{},c));ie("stop",{offset:"10%","stop-opacity":.4},p),ie("stop",{offset:"100%","stop-opacity":.05},p),ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=i.cd.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||Na.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,p=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const p=n.unproject(c,this._altitude),x=n.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(p)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const p=n.unproject(c,this._altitude);let x;n._showingGlobe()&&i.eK(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(p),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Qu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!n||p!=="map")return"";if(!c._showingGlobe()){const R=c.getPitch();return R?`rotateX(${R}deg)`:""}const x=i.cJ(i.eL(c.transform,this._lngLat)),S=n.sub(i.eM(c.transform)),E=Math.abs(S.x)+Math.abs(S.y);if(E===0)return"";const M=x/E;return`rotateX(${-S.y*M}deg) rotateY(${S.x*M}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const S=c.project(new i.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=c.project(new i.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(S);p=i.cJ(Math.atan2(E.y,E.x))-90}else p=-c.getBearing();else if(x==="horizon"){const S=i.af(4,6,c.getZoom()),E=i.eM(c.transform);E.y+=S*c.transform.height;const M=n.sub(E),R=i.cJ(Math.atan2(M.y,M.x));p=(R>90?R-270:R+90)*(1-S)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=nd(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=i.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const S=this._clickTolerance||c._clickTolerance;if(n.point.dist(p)<S)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,p=this._pos;c&&p&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(p),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||Na.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||Na.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||Na.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||Na.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},id={maxWidth:100,unit:"metric"},th={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_l={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Da=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yi(f=new i.P(0,0),n="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new i.P(0,f);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[n]||[0,0])}return{version:A,supported:J.supported,setRTLTextPlugin:i.eQ,getRTLTextPluginStatus:i.eP,Map:class extends rd{constructor(f){D.mark(P.create);const n=f;if((f=i.h({},vc,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.eI(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Lf(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new cf,this._domRenderTaskQueue=new cf,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.a$(),this._locale=i.h({},Ju,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Ft(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,i.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ip),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lf(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Uy(this),f.hash&&(this._hash=new Em(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,i.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Yu({customAttribution:f.customAttribution})),this._logoControl=new Js,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.A(`${c.dataType}dataloading`,c))}),this._interactions=new ql(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return n.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new i.A("movestart",f)).fire(new i.A("move",f)),this.fire(new i.A("resize",f)),n&&this.fire(new i.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(n=>n.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let c;n==="globe"&&f.zoom>=i.cx?(f.setMercatorFromTransition(),c=!0):n==="mercator"&&f.zoom<i.cx&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;return n=f.name==="globe"&&this.transform.zoom>=i.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(i.cd.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(i.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,c){const p=x=>{let S=[];if(Array.isArray(n)){const E=n.filter(M=>this.getLayer(M));S=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else S=this.queryRenderedFeatures(x,{target:n});return S};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:E=>{const M=p(E.point);M.length?x||(x=!0,c.call(this,new Ps(f,this,E.originalEvent,{features:M}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:c,targets:n,delegates:{mousemove:M=>{p(M.point).length?x=!0:x&&(x=!1,c.call(this,new Ps(f,this,M.originalEvent)))},mouseout:M=>{x&&(x=!1,c.call(this,new Ps(f,this,M.originalEvent)))}}}}{const x=S=>{const E=p(S.point);E.length&&(S.features=E,c.call(this,S),delete S.features)};return{listener:c,targets:n,delegates:{[f]:x}}}}on(f,n,c){if(typeof n=="function"||c===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,n,c){if(typeof n=="function"||c===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._createDelegatedListener(f,n,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,n,c){if(typeof n=="function"||c===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let S=0;S<x.length;S++){const E=x[S];if(E.listener===c&&qr(E.targets,n)){for(const M in E.delegates)this.off(M,E.delegates[M]);return x.splice(S,1),this}}})(p),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof i.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const S=this.style.queryRenderedFeatures(f,void 0,this.transform),E=this.style.queryRenderedFeatureset(f,void 0,this.transform);return S.concat(E)}let c=!0;if(n.target&&(c=this._isTargetValid(n.target),c&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let p=!0;if(n.layers&&Array.isArray(n.layers)){for(const S of n.layers)if(!this._isValidId(S)){p=!1;break}if(p&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,n,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),x}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&i.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=i.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,(c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=i.h({},n);n&&n.config&&(c.initialConfig=n.config,delete c.config),this.style=new xo(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.d8(f)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:S,content:E}={}){this._lazyInitEmptyStyle();const M=i.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:R,height:z,data:j}=i.q.getImageData(n);this.style.addImage(M,{data:new i.r({width:R,height:z},j),pixelRatio:c,stretchX:x,stretchY:S,content:E,sdf:p,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:z}=n,j=n;this.style.addImage(M,{data:new i.r({width:R,height:z},new Uint8Array(j.data)),pixelRatio:c,stretchX:x,stretchY:S,content:E,sdf:p,usvg:!1,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const c=i.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?i.q.getImageData(n):n,{width:S,height:E,data:M}=x;if(S===void 0||E===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||E!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${S}, ${E})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const R=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new i.r({width:S,height:E},new Uint8Array(M)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(M,R),this.style.updateImage(c,p,z)}hasImage(f){return f?!!this.style&&!!this.style.getImage(i.I.from(f)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(i.I.from(f))}loadImage(f,n){i.o(this._requestManager.transformRequest(f,i.R.Image),(c,p)=>{n(c,p instanceof HTMLImageElement?i.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch(c=>this.fire(new i.z(new Error("Failed to add import",c)))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,c),this._update(!0)):this}setFilter(f,n,c={}){return this._isValidId(f)?(this.style.setFilter(f,n,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,c,p),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,c,p),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,c){return this.style.setConfigProperty(f,n,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.cd.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,p,x,S=this._container;for(;S&&(!p||!x);){const E=window.getComputedStyle(S).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),S=S.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=W("div","mapboxgl-canvas-container",f);this._canvas=W("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=W("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=W("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=i.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=i.h({},J.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(ri(n,!0),this.painter=new Yh(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.l.testSupport(n)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new i.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=i.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,j=this.transform.pitch,G=i.q.now(),U=new i.aa(z,{now:G,fadeDuration:S,pitch:j,transition:this.style.transition,worldview:this._worldview});this.style.update(U)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,D.mark(P.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const z=i.q.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const j=x.getQueryParameter(n,x.QUERY_RESULT)/1e6;x.deleteQuery(n),this.fire(new i.A("gpu-timing-frame",{cpuTime:z,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(z);this.fire(new i.A("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:j}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(R||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,D.mark(P.fullLoad),this._performanceMetricsCollection&&$r(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=f;const E=Math.abs(x-S);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(S),c(S);this._averageElevation.easeTo(S,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(S),c(S)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){Fr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Br||f.status===401)){const n=this.painter.context.gl;ri(n,!1),this._logoControl instanceof Js&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Zr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&ar(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(S){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,S,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(f,n,c){let p=c[1]-c[0];const x=f.length/4;for(let S=0;S<n.length;S++){const E=n[S];let M=0;for(let R=0;R<E.length;R+=4)E[R]===f[R]&&E[R+1]===f[R+1]&&E[R+2]===f[R+2]&&E[R+3]===f[R+3]&&(M+=1);p+=(c[S+2]-c[S+1])*(1-M/x)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Zn.delete(this.painter.context.gl),Cr.remove(),kr.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.q.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return i.bt(n,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,n){i.eJ(f,n)}get version(){return A}},NavigationControl:class{constructor(f={}){this.options=i.h({},_p,f),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(i.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),c=n===f.getMaxZoom(),p=n===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fg(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const c=W("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(f={}){super();const n=navigator.geolocation;this.options=i.h({geolocation:n},xp,f),i.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=mc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",f)),this._finish()}}_updateCamera(f){const n=new i.cd(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=i.h({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new i.cd(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=i.c6(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new eh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new eh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yu,ScaleControl:class{constructor(f={}){this.options=i.h({},id,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,p=n._containerWidth/2-f/2,x=n.unproject([p,c]),S=n.unproject([p+f,c]),E=x.distanceTo(S);if(this.options.unit==="imperial"){const M=3.2808*E;M>5280?this._setScale(f,M/5280,"mile"):this._setScale(f,M,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,n,c){this._map._requestDomTask(()=>{const p=function(S){const E=Math.pow(10,`${Math.floor(S)}`.length-1);let M=S/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(R){const z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(M),E*M}(n),x=p/n;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${th[c]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(f){super(),this.options=i.h(Object.create(_l),f),this._altitude=this.options.altitude,i.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.cd.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const c=this._closeButton=W("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,p=this._pos;if(!n||!c||!p)return"bottom";const x=c.offsetWidth,S=c.offsetHeight,E=p.x<x/2,M=p.x>n.transform.width-x/2;if(p.y+f<S)return E?"top-left":M?"top-right":"top";if(p.y>n.transform.height-S){if(E)return"bottom-left";if(M)return"bottom-right"}return E?"left":M?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=W("div","mapboxgl-popup",n.getContainer()),this._tip=W("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nd(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof i.P?f:n.project(this._lngLat,this._altitude),S=Yi(this.options.offset),E=this._anchor=this._getAnchor(S.y),M=Yi(this.options.offset,E),R=x.add(M).round();n._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Qu[E]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=i.eK(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Da);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:eh,Style:xo,LngLat:i.cd,LngLatBounds:i.aG,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Mu,Evented:i.E,config:i.e,prewarm:i.eO,clearPrewarmedResources:i.eN,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(f){i.e.ACCESS_TOKEN=f},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(f){i.e.API_URL=f},get workerCount(){return i.eX.workerCount},set workerCount(f){i.eX.workerCount=f},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.eW(f)},get workerUrl(){return i.eV.workerUrl},set workerUrl(f){i.eV.workerUrl=f},get workerClass(){return i.eV.workerClass},set workerClass(f){i.eV.workerClass=f},get workerParams(){return i.eV.workerParams},set workerParams(f){i.eV.workerParams=f},get dracoUrl(){return i.eU()},set dracoUrl(f){i.eT(f)},get meshoptUrl(){return i.eS()},set meshoptUrl(f){i.eR(f)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var v=h;return v})}(Kv)),Kv.exports}var i$=n$();const Km=c1(i$),s$=()=>{const r=ee.useRef(null),t=ee.useRef(null),[s,l]=ee.useState(""),[h,m]=ee.useState(""),[v,i]=ee.useState(!1),A=[{name:"Saudi Arabia",coordinates:[45.0792,23.8859]},{name:"UAE",coordinates:[54.3773,24.4539]},{name:"Jordan",coordinates:[36.2384,30.5852]},{name:"Egypt",coordinates:[30.8025,26.8206]},{name:"Tunisia",coordinates:[9.5375,33.8869]},{name:"Morocco",coordinates:[-7.0926,31.7917]},{name:"Algeria",coordinates:[1.6596,28.0339]},{name:"Pakistan",coordinates:[69.3451,30.3753]}],P=[{name:"Nigeria",coordinates:[8.6753,9.082]},{name:"Cameroon",coordinates:[12.3547,7.3697]}],D=()=>{!r.current||!s||(Km.accessToken=s,t.current=new Km.Map({container:r.current,style:"mapbox://styles/mapbox/dark-v11",center:[25,25],zoom:2.5,pitch:0}),t.current.addControl(new Km.NavigationControl({visualizePitch:!0}),"top-right"),t.current.on("load",()=>{A.forEach(F=>{const $=document.createElement("div");$.className="primary-marker",$.style.cssText=`
          background-color: #3b82f6;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
          cursor: pointer;
        `,new Km.Marker($).setLngLat(F.coordinates).setPopup(new Km.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${F.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Primary Focus</p>
                </div>
              `)).addTo(t.current)}),P.forEach(F=>{const $=document.createElement("div");$.className="secondary-marker",$.style.cssText=`
          background-color: #10b981;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          border: 2px solid white;
          box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
          cursor: pointer;
        `,new Km.Marker($).setLngLat(F.coordinates).setPopup(new Km.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${F.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Secondary Focus</p>
                </div>
              `)).addTo(t.current)}),t.current.addSource("africa-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-20,40],[55,40],[55,-35],[-20,-35],[-20,40]]]},properties:{}}]}}),t.current.addLayer({id:"africa-highlight",type:"fill",source:"africa-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}}),t.current.addSource("middle-east-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[25,45],[75,45],[75,10],[25,10],[25,45]]]},properties:{}}]}}),t.current.addLayer({id:"middle-east-highlight",type:"fill",source:"middle-east-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}})}),i(!0))};return ee.useEffect(()=>{s&&!v&&D()},[s,v]),ee.useEffect(()=>()=>{t.current&&t.current.remove()},[]),s?b.jsx("div",{className:"py-20 bg-gray-900 text-white",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),b.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Strategic investment regions across Africa and the Middle East"})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[b.jsx("div",{className:"lg:col-span-3",children:b.jsx("div",{className:"relative rounded-lg overflow-hidden shadow-2xl",children:b.jsx("div",{ref:r,className:"w-full h-96 lg:h-[500px]"})})}),b.jsxs("div",{className:"space-y-6",children:[b.jsxs(Rn,{className:"bg-gray-800 border-gray-700",children:[b.jsxs(Yn,{children:[b.jsx(Jn,{className:"text-white text-lg",children:"Primary Focus"}),b.jsx(ys,{className:"text-gray-300",children:"Core investment markets"})]}),b.jsx(Qn,{children:b.jsx("div",{className:"space-y-2",children:A.map((F,$)=>b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),b.jsx("span",{className:"text-gray-300 text-sm",children:F.name})]},$))})})]}),b.jsxs(Rn,{className:"bg-gray-800 border-gray-700",children:[b.jsxs(Yn,{children:[b.jsx(Jn,{className:"text-white text-lg",children:"Secondary Focus"}),b.jsx(ys,{className:"text-gray-300",children:"Selective opportunities"})]}),b.jsx(Qn,{children:b.jsx("div",{className:"space-y-2",children:P.map((F,$)=>b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),b.jsx("span",{className:"text-gray-300 text-sm",children:F.name})]},$))})})]}),b.jsxs(Rn,{className:"bg-gray-800 border-gray-700",children:[b.jsxs(Yn,{children:[b.jsx(Jn,{className:"text-white text-lg",children:"Opportunistic"}),b.jsx(ys,{className:"text-gray-300",children:"Broader regional approach"})]}),b.jsx(Qn,{children:b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),b.jsx("span",{className:"text-gray-300 text-sm",children:"African Markets"})]}),b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),b.jsx("span",{className:"text-gray-300 text-sm",children:"Middle East"})]})]})})]})]})]})]})}):b.jsx("div",{className:"py-20 bg-gray-900 text-white",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),b.jsx("p",{className:"text-xl text-gray-300",children:"Strategic investment regions across Africa and the Middle East"})]}),b.jsx("div",{className:"max-w-3xl mx-auto px-4",children:b.jsx(Rn,{className:"bg-gray-800 border-gray-700 overflow-hidden rounded-xl",children:b.jsx("img",{src:"/lovable-uploads/map.jpg",alt:"Map",className:"w-full h-auto object-contain"})})})]})})},o$=()=>{const r=[{name:"Agritech and Food Security",icon:_I,description:"Supporting innovative solutions for sustainable agriculture, precision farming, and food security across Africa"},{name:"Waste Management",icon:vB,description:"Investing in circular economy solutions, waste-to-energy technologies, and sustainable waste processing systems"},{name:"E-Mobility",icon:oS,description:"Accelerating electric vehicle adoption, charging infrastructure, and sustainable transportation solutions"},{name:"RE Optimization",icon:dB,description:"Enhancing renewable energy efficiency through smart grid technologies and energy storage solutions"},{name:"Clean Industries",icon:ig,description:"Transforming industrial processes through clean technologies and sustainable manufacturing practices"},{name:"Sustainable Supply Chain",icon:EB,description:"Building transparent, efficient, and environmentally responsible supply chain solutions"}],t=[{title:"$40M Fund Size",description:"Targeting sustainability and climate tech startups from ideation to series A",icon:dP},{title:"Regional Focus",description:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan",icon:yB},{title:"Beyond Capital",description:"Venture building, expert guidance, and globalnetworkaccess",icon:ig}];return b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:["Powering the Future of Sustainability",b.jsxs("span",{className:"block",children:["and Climate Tech Across ",b.jsx("span",{className:"gradient-text",children:"MENA+"})]})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-4",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges."}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]})})}),b.jsx("section",{className:"py-20",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Fund Highlights"}),b.jsx("p",{className:"text-xl text-gray-600",children:"Strategic investment focused on maximum impact"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:t.map((s,l)=>{const h=s.icon;return b.jsx(Rn,{className:"text-center hover:shadow-lg transition-shadow",children:b.jsxs(Yn,{children:[b.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:b.jsx(h,{className:"h-8 w-8 text-primary"})}),b.jsx(Jn,{className:"text-xl",children:s.title}),b.jsx(ys,{className:"text-base",children:s.description})]})},l)})})]})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Investment Focus"}),b.jsx("p",{className:"text-xl text-gray-600",children:"Six key sectors driving climate innovation across Africa"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:r.map((s,l)=>{const h=s.icon;return b.jsx(Rn,{className:"text-center hover:shadow-lg transition-shadow",children:b.jsxs(Yn,{children:[b.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:b.jsx(h,{className:"h-8 w-8 text-primary"})}),b.jsx(Jn,{className:"text-lg",children:s.name}),b.jsx(ys,{className:"text-sm text-gray-600 mt-2",children:s.description})]})},l)})})]})}),b.jsx(s$,{}),b.jsx("section",{className:"py-20 bg-white",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Impact and Sustainability"}),b.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our commitment to responsible investing drives positive environmental and social outcomes"})]}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto",children:[b.jsxs(Rn,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[b.jsxs(Yn,{children:[b.jsx("div",{className:"w-16 h-16  bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:b.jsx(_I,{className:"h-8 w-8 text-primary"})}),b.jsx(Jn,{className:"text-xl text-center",children:"ESG Considerations"})]}),b.jsx(Qn,{children:b.jsxs(ys,{className:"text-base text-gray-600 space-y-4",children:[b.jsx("p",{children:"Investing with Purpose and Responsibility At Betaventures, ESG (Environmental, Social, and Governance) principles are embedded into every investment decision we make."}),b.jsxs("ul",{className:"space-y-2",children:[b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"Rigorous impact assessments for every portfolio company"})]}),b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"Tailored ESG action plans to improve performance over time"})]}),b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"Clear reporting on local and regional impact"})]}),b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:" Active advocacy for responsible innovation and sustainablegrowth"})]})]})]})})]}),b.jsxs(Rn,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[b.jsxs(Yn,{children:[b.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:b.jsx(ig,{className:"h-8 w-8 text-primary"})}),b.jsx(Jn,{className:"text-xl text-center",children:"Gender Lens Investing"})]}),b.jsx(Qn,{children:b.jsxs(ys,{className:"text-base text-gray-600 space-y-4",children:[b.jsx("p",{children:"We are committed to building a more inclusive and equitable startup ecosystem. Betaventures aims for at least 40% of its portfolio to be made up of startups founded or co-founded by women."}),b.jsxs("ul",{className:"space-y-2",children:[b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"To further support this mission, we are committing 1% of the funds carry to programs that empower girls and women in tech across theMENA+region."})]}),b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"Promoting workplace diversity and inclusion"})]}),b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{children:"Creating products and services that benefit women"})]})]})]})})]})]})]})}),b.jsx("section",{className:"py-20 bg-gradient-to-r from-blue-600 via-primary to-cyan-500 text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Ready to Transform Climate Tech?"}),b.jsx("p",{className:"text-xl mb-12 opacity-90 max-w-2xl mx-auto",children:"Join us in building the future of climate technology across Africa"}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[b.jsxs(Rn,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[b.jsxs(Yn,{className:"text-center pb-4",children:[b.jsx(Jn,{className:"text-white text-xl mb-2",children:"For Startups"}),b.jsx(ys,{className:"text-white/80",children:"Apply for funding and join our ecosystem"})]}),b.jsx(Qn,{className:"text-center",children:b.jsx(fr,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})})]}),b.jsxs(Rn,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[b.jsxs(Yn,{className:"text-center pb-4",children:[b.jsx(Jn,{className:"text-white text-xl mb-2",children:"For Investors"}),b.jsx(ys,{className:"text-white/80",children:"Partner with us to drive climate impact"})]}),b.jsx(Qn,{className:"text-center",children:b.jsx(fr,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})})]})]}),b.jsx("div",{className:"text-center mt-12",children:b.jsx(fr,{asChild:!0,variant:"secondary",size:"lg",className:"bg-white/20 backdrop-blur border-white/30 text-white hover:bg-white hover:text-primary font-semibold rounded-xl",children:b.jsx("a",{href:"https://betaventuresfund1.decilehub.com/",target:"_blank",rel:"noopener noreferrer",children:"Learn More About Betaventures"})})})]})})]})},a$=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all");ee.useEffect(()=>{(async()=>{try{const P=await nl.getCaseStudies();t(P)}catch(P){console.error("Error fetching case studies:",P)}finally{l(!1)}})()},[]);const v=["all",...Array.from(new Set(r.map(A=>A.industry)))],i=h==="all"?r:r.filter(A=>A.industry===h);return s?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:[b.jsx("span",{className:"gradient-text",children:"Our"})," Portfolio"]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Discover how we've helped startups overcome challenges, secure funding, and achieve remarkable growth. These are the stories of innovation, perseverance, and success."})]})})}),b.jsx("section",{className:"py-8 border-b",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:v.map(A=>b.jsx("button",{onClick:()=>m(A),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${h===A?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A==="all"?"All Industries":A},A))})})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"grid grid-cols-1 gap-12",children:i.map((A,P)=>b.jsx(Rn,{className:`overflow-hidden  hover:shadow-xl transition-all duration-300 ${P%2===1?"lg:flex-row-reverse":""}`,children:b.jsxs("div",{className:"lg:flex",children:[b.jsx("div",{className:"lg:w-1/2",children:b.jsx("div",{className:"aspect-video lg:aspect-square",children:b.jsx("img",{src:A.image,alt:A.companyName,className:"w-full h-full object-cover"})})}),b.jsxs("div",{className:"lg:w-1/2 p-8",children:[b.jsxs(Yn,{className:"p-0 mb-6",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsx(Jn,{className:"text-2xl",children:A.companyName}),b.jsx(_a,{variant:"secondary",children:A.industry})]}),b.jsx(ys,{className:"text-base",children:A.description})]}),b.jsxs(Qn,{className:"p-0 space-y-6",children:[b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"The Challenge"}),b.jsx("p",{className:"text-gray-600 text-sm",children:A.challenge})]}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Our Solution"}),b.jsx("p",{className:"text-gray-600 text-sm",children:A.solution})]})]}),b.jsxs("div",{children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Results"}),b.jsx("ul",{className:"space-y-2",children:A.results.map((D,F)=>b.jsxs("li",{className:"flex items-start text-sm",children:[b.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),b.jsx("span",{className:"text-gray-600",children:D})]},F))})]}),A.testimonial?.quote?.trim()&&b.jsxs("div",{className:"bg-primary/5 p-6 rounded-lg",children:[b.jsxs("blockquote",{className:"text-gray-700 italic mb-4",children:['"',A.testimonial.quote,'"']}),b.jsxs("div",{className:"flex items-center",children:[b.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-4",children:b.jsx("span",{className:"text-primary font-semibold text-lg",children:A.testimonial.author?.charAt(0)||""})}),b.jsxs("div",{children:[b.jsx("div",{className:"font-semibold text-gray-900",children:A.testimonial.author}),b.jsx("div",{className:"text-sm text-gray-600",children:A.testimonial.position})]})]})]}),b.jsx("div",{className:"flex flex-wrap gap-2",children:A.tags.map((D,F)=>b.jsx(_a,{variant:"outline",className:"text-xs",children:D},F))})]})]})]})},A.id))})})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-12",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Impact"}),b.jsx("p",{className:"text-xl text-gray-600",children:"Numbers that showcase our commitment to startup success"})]}),b.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-8",children:[{value:"250+",label:"Startups Supported"},{value:"10+",label:"Innovation Programs"},{value:"12",label:"Startups from scratch"}].map((A,P)=>b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"text-3xl md:text-4xl font-bold text-primary mb-2",children:A.value}),b.jsx("div",{className:"text-gray-600 text-sm",children:A.label})]},P))})]})})]})},l$=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all"),[v,i]=ee.useState(""),[A,P]=ee.useState(!1),[D,F]=ee.useState(!1);ee.useEffect(()=>{(async()=>{try{const fe=await nl.getBlogPosts();t(fe)}catch(fe){console.error("Error fetching blog posts:",fe)}finally{l(!1)}})()},[]);const $=["all",...Array.from(new Set(r.map(ie=>ie.category)))],K=h==="all"?r:r.filter(ie=>ie.category===h),J=ie=>new Date(ie).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),W=async ie=>{if(ie.preventDefault(),!!v){P(!0);try{(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:v,subject:"Newsletter",message:"",status:"unread"})})).ok&&(F(!0),i(""),setTimeout(()=>F(!1),3e3))}catch(fe){console.error("Newsletter subscription error:",fe)}finally{P(!1)}}};return s?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[b.jsx(fr,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:b.jsxs(Mi,{to:"/",className:"flex items-center space-x-2",children:[b.jsx(pd,{size:16}),b.jsx("span",{children:"Back to Home"})]})}),b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",b.jsx("span",{className:"gradient-text",children:"Insights"})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Stay updated with the latest trends, tips, and insights from the startup world. Our experts share knowledge to help you navigate your entrepreneurial journey."})]})})}),b.jsx("section",{className:"py-8 border-b",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:$.map(ie=>b.jsx("button",{onClick:()=>m(ie),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${h===ie?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:ie==="all"?"All Categories":ie},ie))})})}),K.length>0&&b.jsx("section",{className:"py-16",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"mb-8",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Featured Article"}),b.jsx("p",{className:"text-gray-600",children:"Our latest insights on startup growth and innovation"})]}),b.jsx(Rn,{className:"overflow-hidden hover:shadow-xl transition-shadow",children:b.jsxs("div",{className:"md:flex",children:[b.jsx("div",{className:"md:w-1/2",children:b.jsx("img",{src:K[0].image,alt:K[0].title,className:"w-full h-64 md:h-full object-cover"})}),b.jsxs("div",{className:"md:w-1/2 p-8",children:[b.jsxs(Yn,{className:"p-0 mb-4",children:[b.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[b.jsx(_a,{children:K[0].category}),b.jsx("span",{className:"text-sm text-gray-500",children:J(K[0].publishDate)})]}),b.jsx(Jn,{className:"text-2xl md:text-3xl mb-4",children:K[0].title}),b.jsx(ys,{className:"text-base",children:K[0].excerpt})]}),b.jsx(Qn,{className:"p-0",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:b.jsx("span",{className:"text-primary font-semibold",children:K[0].author.charAt(0)})}),b.jsxs("div",{children:[b.jsx("div",{className:"font-medium text-gray-900",children:K[0].author}),b.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),b.jsx(Mi,{to:`/blog/${K[0].id}`,className:"text-primary hover:text-primary/80 font-medium text-sm",children:"Read More "})]})})]})]})})]})}),b.jsx("section",{className:"py-16",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:K.slice(1).map(ie=>b.jsxs(Rn,{className:"overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[b.jsx("div",{className:"aspect-video",children:b.jsx("img",{src:ie.image,alt:ie.title,className:"w-full h-full object-cover"})}),b.jsxs(Yn,{className:"pb-4",children:[b.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[b.jsx(_a,{variant:"secondary",className:"text-xs",children:ie.category}),b.jsx("span",{className:"text-xs text-gray-500",children:J(ie.publishDate)})]}),b.jsx(Jn,{className:"text-lg leading-tight mb-2",children:ie.title}),b.jsx(ys,{className:"text-sm line-clamp-3",children:ie.excerpt})]}),b.jsxs(Qn,{className:"pt-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("div",{className:"w-8 h-8 bg-primary/20 rounded-full flex items-center justify-center mr-2",children:b.jsx("span",{className:"text-primary font-semibold text-sm",children:ie.author.charAt(0)})}),b.jsx("span",{className:"text-sm text-gray-600",children:ie.author})]}),b.jsx(Mi,{to:`/blog/${ie.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read "})]}),b.jsx("div",{className:"flex flex-wrap gap-1 mt-4",children:ie.tags.slice(0,3).map((fe,Pe)=>b.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:fe},Pe))})]})]},ie.id))})})}),b.jsx("section",{className:"py-20 bg-primary text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Stay Updated"}),b.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[b.jsxs("form",{onSubmit:W,className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[b.jsx("input",{type:"email",placeholder:"Enter your email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:v,onChange:ie=>i(ie.target.value),required:!0}),b.jsx("button",{type:"submit",disabled:A,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:A?"Subscribing...":"Subscribe"})]}),D&&b.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]})})]})},c$=()=>{const{id:r}=x6(),[t,s]=ee.useState(null),[l,h]=ee.useState(!0),[m,v]=ee.useState([]),{toast:i}=ky();ee.useEffect(()=>{(async()=>{try{const K=await nl.getBlogPosts(),J=K.find(W=>W.id===r);if(s(J||null),J){const W=K.filter(ie=>ie.category===J.category&&ie.id!==J.id).slice(0,3);v(W)}}catch(K){console.error("Error fetching blog post:",K)}finally{h(!1)}})()},[r]);const A=$=>new Date($).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),P=$=>{const J=$.split(" ").length;return`${Math.ceil(J/200)} min read`},D=async()=>{const $=window.location.href,K={title:t?.title||"Blog Post",text:t?.excerpt||"",url:$};if(navigator.share&&/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))try{await navigator.share(K),i({title:"Shared successfully",description:"The blog post has been shared!"})}catch{F($)}else F($)},F=async $=>{try{await navigator.clipboard.writeText($),i({title:"Link copied!",description:"Blog post link has been copied to clipboard."})}catch{const J=document.createElement("textarea");J.value=$,document.body.appendChild(J),J.focus(),J.select();try{document.execCommand("copy"),i({title:"Link copied!",description:"Blog post link has been copied to clipboard."})}catch{i({title:"Share failed",description:"Unable to copy link. Please copy the URL manually.",variant:"destructive"})}document.body.removeChild(J)}};return l?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):t?b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsxs(Mi,{to:"/blog",className:"inline-flex items-center text-primary hover:text-primary/80 mb-6",children:[b.jsx(pd,{className:"mr-2 h-4 w-4"}),"Back to Blog"]}),b.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[b.jsx(_a,{children:t.category}),b.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(iS,{className:"h-4 w-4"}),A(t.publishDate)]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(AB,{className:"h-4 w-4"}),t.author]}),b.jsxs("div",{className:"flex items-center gap-1",children:[b.jsx(hB,{className:"h-4 w-4"}),P(t.content)]})]})]}),b.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:t.title}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-8",children:t.excerpt}),b.jsxs("div",{className:"flex items-center gap-4",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:b.jsx("span",{className:"text-primary font-semibold text-lg",children:t.author.charAt(0)})}),b.jsxs("div",{children:[b.jsx("div",{className:"font-medium text-gray-900",children:t.author}),b.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),b.jsxs(fr,{variant:"outline",size:"sm",className:"ml-auto",onClick:D,children:[b.jsx(bB,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})}),b.jsx("section",{className:"py-8",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"max-w-4xl mx-auto",children:b.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:b.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover"})})})})}),b.jsx("section",{className:"py-8",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsx("div",{className:"prose prose-lg max-w-none",children:b.jsx("div",{className:"text-gray-700 leading-relaxed space-y-6",children:b.jsx("p",{children:t.content})})}),b.jsx("div",{className:"flex flex-wrap gap-2 mt-12 pt-8 border-t",children:t.tags.map(($,K)=>b.jsx(_a,{variant:"secondary",className:"text-sm",children:$},K))})]})})}),m.length>0&&b.jsx("section",{className:"py-16 bg-gray-50",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-8",children:"Related Articles"}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:m.map($=>b.jsxs(Rn,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[b.jsx("div",{className:"aspect-video",children:b.jsx("img",{src:$.image,alt:$.title,className:"w-full h-full object-cover"})}),b.jsxs(Qn,{className:"p-6",children:[b.jsx(_a,{variant:"secondary",className:"mb-3 text-xs",children:$.category}),b.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:$.title}),b.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:$.excerpt}),b.jsx(Mi,{to:`/blog/${$.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read More "})]})]},$.id))})]})})})]}):b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Blog Post Not Found"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"The blog post you're looking for doesn't exist."}),b.jsx(Mi,{to:"/blog",children:b.jsxs(fr,{children:[b.jsx(pd,{className:"mr-2 h-4 w-4"}),"Back to Blog"]})})]})})},u$=()=>{const[r,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all");ee.useEffect(()=>{(async()=>{try{const F=await nl.getEvents();t(F)}catch(F){console.error("Error fetching events:",F)}finally{l(!1)}})()},[]);const v=["all","workshop","webinar","networking","pitch"],i=h==="all"?r:r.filter(D=>D.type===h),A=D=>new Date(D).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),P=D=>({workshop:"bg-blue-100 text-blue-800",webinar:"bg-green-100 text-green-800",networking:"bg-purple-100 text-purple-800",pitch:"bg-orange-100 text-orange-800"})[D]||"bg-gray-100 text-gray-800";return s?b.jsx("div",{className:"min-h-screen flex items-center justify-center",children:b.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[b.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Upcoming ",b.jsx("span",{className:"gradient-text",children:"Events"})]}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Join our community events, workshops, and networking sessions designed to accelerate your startup journey. Connect with fellow entrepreneurs, investors, and industry experts."})]})})}),b.jsx("section",{className:"py-8 border-b",children:b.jsx("div",{className:"container-width section-padding",children:b.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:v.map(D=>b.jsx("button",{onClick:()=>m(D),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors capitalize ${h===D?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:D==="all"?"All Events":D},D))})})}),b.jsx("section",{className:"py-20",children:b.jsx("div",{className:"container-width section-padding",children:i.length===0?b.jsxs("div",{className:"text-center py-20",children:[b.jsx(iS,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No events found"}),b.jsx("p",{className:"text-gray-600",children:"Check back soon for upcoming events!"})]}):b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map((D,F)=>b.jsx(Rn,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 ${F===0?"md:col-span-2 lg:col-span-2":""}`,children:b.jsxs("div",{className:`${F===0?"md:flex":""}`,children:[b.jsx("div",{className:`${F===0?"md:w-1/2":""} aspect-video`,children:b.jsx("img",{src:D.image,alt:D.title,className:"w-full h-full object-cover"})}),b.jsxs("div",{className:`${F===0?"md:w-1/2":""} p-6`,children:[b.jsxs(Yn,{className:"p-0 mb-4",children:[b.jsxs("div",{className:"flex items-center justify-between mb-3",children:[b.jsx(_a,{className:`capitalize ${P(D.type)}`,children:D.type}),b.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[b.jsx(iS,{className:"h-4 w-4 mr-1"}),D.time]})]}),b.jsx(Jn,{className:`${F===0?"text-2xl":"text-lg"} mb-2`,children:D.title}),b.jsx(ys,{className:"text-sm",children:D.description})]}),b.jsxs(Qn,{className:"p-0 space-y-4",children:[b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{className:"flex items-start",children:[b.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Date:"}),b.jsx("span",{className:"text-gray-600",children:A(D.date)})]}),b.jsxs("div",{className:"flex items-start",children:[b.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Location:"}),b.jsx("span",{className:"text-gray-600",children:D.location})]})]}),b.jsx(fr,{className:"w-full",size:F===0?"lg":"default",children:b.jsx("a",{href:D.registrationUrl,target:"_blank",rel:"noopener noreferrer",children:b.jsx(fr,{className:"w-full",size:F===0?"lg":"default",children:"Register Now"})})})]})]})]})},D.id))})})}),b.jsx("section",{className:"py-20 bg-gray-50",children:b.jsxs("div",{className:"container-width section-padding",children:[b.jsxs("div",{className:"text-center mb-16",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Types of Events"}),b.jsx("p",{className:"text-xl text-gray-600",children:"We host various types of events to support your entrepreneurial journey"})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{type:"Workshops",description:"Hands-on learning sessions covering essential startup skills and technologies",icon:""},{type:"Webinars",description:"Online sessions with industry experts sharing insights and best practices",icon:""},{type:"Networking",description:"Connect with fellow entrepreneurs, mentors, and potential partners",icon:""},{type:"Pitch Events",description:"Opportunities to present your startup to investors and get feedback",icon:""}].map((D,F)=>b.jsxs(Rn,{className:"text-center p-6",children:[b.jsx("div",{className:"text-4xl mb-4",children:D.icon}),b.jsx("h3",{className:"text-lg font-semibold mb-2",children:D.type}),b.jsx("p",{className:"text-gray-600 text-sm",children:D.description})]},F))})]})}),b.jsx("section",{className:"py-20 bg-primary text-white",children:b.jsxs("div",{className:"container-width section-padding text-center",children:[b.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Want to Host an Event?"}),b.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Partner with us to organize workshops, networking events, or speaking sessions for our startup community."}),b.jsx(fr,{size:"lg",variant:"secondary",children:"Partner With Us"})]})})]})},h$=()=>{const[r,t]=ee.useState({name:"",email:"",company:"",program:"",message:""}),[s,l]=ee.useState(!1),{toast:h}=ky(),m=i=>{const{name:A,value:P}=i.target;t(D=>({...D,[A]:P}))},v=async i=>{if(i.preventDefault(),l(!0),!/^[a-zA-Z0-9._%+-]+@(?!gmail\.com$|yahoo\.com$|hotmail\.com$|outlook\.com$|icloud\.com$)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r.email)){h({title:"Invalid Email",description:"Please use your company email address (no Gmail, Yahoo, Outlook, etc.)",variant:"destructive"}),l(!1);return}try{const P=await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r.name,email:r.email,subject:r.program||r.company||"General Inquiry",message:r.message,timestamp:new Date,status:"unread"})});if(!P.ok){const D=await P.json();throw new Error(D.error||"Failed to send message")}h({title:"Message sent successfully!",description:"We'll get back to you within 48 hours."}),t({name:"",email:"",company:"",program:"",message:""})}catch(P){console.error("Submission error:",P),h({title:"Submission failed",description:P.message||"There was a problem sending your message. Please use your company email address (no Gmail, Yahoo, Outlook, etc.",variant:"destructive"})}finally{l(!1)}};return b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[b.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:b.jsxs("span",{className:"block",children:["Get In ",b.jsx("span",{className:"gradient-text",children:"Touch"})]})}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-4",children:"Ready to transform your ideas into reality?"}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"Let's discuss how Betawaves can support you in your journey."})]})})}),b.jsx("section",{className:"py-20",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16",children:[b.jsx("div",{className:"space-y-8",children:b.jsxs("div",{className:"space-y-6",children:[b.jsxs(Rn,{className:"p-6",children:[b.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Our Locations"}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium",children:"UAE, Dubai"}),b.jsx("p",{className:"text-gray-600 text-sm",children:"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"})]}),b.jsx("div",{})]})]}),b.jsxs(Rn,{className:"p-6",children:[b.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Contact"}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"General Inquiries:"}),b.jsx("br",{}),b.jsx("a",{href:"mailto:hello@betawaves.io",className:"text-primary hover:underline",children:"hello@betawaves.io"})]}),b.jsxs("div",{children:[b.jsx("span",{className:"font-medium",children:"Phone:"}),b.jsx("br",{}),b.jsx("a",{className:"text-primary hover:underline",children:"+971 58 829 0773"})]})]})]})]})}),b.jsx("div",{children:b.jsxs(Rn,{children:[b.jsxs(Yn,{children:[b.jsx(Jn,{className:"text-2xl",children:"Send us a message"}),b.jsx(ys,{children:"Fill out the form below and we'll get back to you within 48 hours."})]}),b.jsx(Qn,{children:b.jsxs("form",{onSubmit:v,className:"space-y-6",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"name",children:"Full Name *"}),b.jsx(Jr,{id:"name",name:"name",value:r.name,onChange:m,required:!0,className:"mt-1"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"email",children:"Company Email Address *"}),b.jsx(Jr,{id:"email",name:"email",type:"email",value:r.email,onChange:m,required:!0,className:"mt-1",pattern:"^[a-zA-Z0-9._%+-]+@(?!gmail\\.com$|yahoo\\.com$|hotmail\\.com$|outlook\\.com$|icloud\\.com$)[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",title:"Please use your company email address (e.g., no Gmail, Yahoo, or Hotmail)"})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"company",children:"Company Name *"}),b.jsx(Jr,{id:"company",name:"company",required:!0,value:r.company,onChange:m,className:"mt-1"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"program",children:"Interest *"}),b.jsxs("select",{id:"program",name:"program",required:!0,value:r.program,onChange:m,className:"mt-1 w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[b.jsx("option",{value:"",children:"Select a program"}),b.jsx("option",{value:"Products",children:"Products"}),b.jsx("option",{value:"Innovation Consulting",children:"Innovation Consulting"}),b.jsx("option",{value:"Investment",children:"Investment"}),b.jsx("option",{value:"Other",children:"Other"})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"message",children:"Message *"}),b.jsx(fo,{id:"message",name:"message",value:r.message,onChange:m,required:!0,rows:5,className:"mt-1",placeholder:"Tell us about your startup, your goals, and how we can help..."})]}),b.jsx(fr,{type:"submit",className:"w-full",size:"lg",disabled:s,children:s?"Sending...":"Send Message"})]})})]})})]})})})]})};function d$(r,t=[]){let s=[];function l(m,v){const i=ee.createContext(v),A=s.length;s=[...s,v];function P(F){const{scope:$,children:K,...J}=F,W=$?.[r][A]||i,ie=ee.useMemo(()=>J,Object.values(J));return b.jsx(W.Provider,{value:ie,children:K})}function D(F,$){const K=$?.[r][A]||i,J=ee.useContext(K);if(J)return J;if(v!==void 0)return v;throw new Error(`\`${F}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(v=>ee.createContext(v));return function(i){const A=i?.[r]||m;return ee.useMemo(()=>({[`__scope${r}`]:{...i,[r]:A}}),[i,A])}};return h.scopeName=r,[l,f$(h,...t)]}function f$(...r){const t=r[0];if(r.length===1)return t;const s=()=>{const l=r.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const v=l.reduce((i,{useScope:A,scopeName:P})=>{const F=A(m)[`__scope${P}`];return{...i,...F}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:v}),[v])}};return s.scopeName=t.scopeName,s}var bw="rovingFocusGroup.onEntryFocus",p$={bubbles:!1,cancelable:!0},A1="RovingFocusGroup",[IS,$N,m$]=oT(A1),[g$,HN]=d$(A1,[m$]),[y$,_$]=g$(A1),GN=ee.forwardRef((r,t)=>b.jsx(IS.Provider,{scope:r.__scopeRovingFocusGroup,children:b.jsx(IS.Slot,{scope:r.__scopeRovingFocusGroup,children:b.jsx(x$,{...r,ref:t})})}));GN.displayName=A1;var x$=ee.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:s,orientation:l,loop:h=!1,dir:m,currentTabStopId:v,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:A,onEntryFocus:P,preventScrollOnEntryFocus:D=!1,...F}=r,$=ee.useRef(null),K=xs(t,$),J=jT(m),[W=null,ie]=hg({prop:v,defaultProp:i,onChange:A}),[fe,Pe]=ee.useState(!1),Fe=Jl(P),ht=$N(s),at=ee.useRef(!1),[Dt,kt]=ee.useState(0);return ee.useEffect(()=>{const Rt=$.current;if(Rt)return Rt.addEventListener(bw,Fe),()=>Rt.removeEventListener(bw,Fe)},[Fe]),b.jsx(y$,{scope:s,orientation:l,dir:J,loop:h,currentTabStopId:W,onItemFocus:ee.useCallback(Rt=>ie(Rt),[ie]),onItemShiftTab:ee.useCallback(()=>Pe(!0),[]),onFocusableItemAdd:ee.useCallback(()=>kt(Rt=>Rt+1),[]),onFocusableItemRemove:ee.useCallback(()=>kt(Rt=>Rt-1),[]),children:b.jsx(vi.div,{tabIndex:fe||Dt===0?-1:0,"data-orientation":l,...F,ref:K,style:{outline:"none",...r.style},onMouseDown:jn(r.onMouseDown,()=>{at.current=!0}),onFocus:jn(r.onFocus,Rt=>{const hr=!at.current;if(Rt.target===Rt.currentTarget&&hr&&!fe){const Tr=new CustomEvent(bw,p$);if(Rt.currentTarget.dispatchEvent(Tr),!Tr.defaultPrevented){const _r=ht().filter(Yt=>Yt.focusable),Sr=_r.find(Yt=>Yt.active),Br=_r.find(Yt=>Yt.id===W),br=[Sr,Br,..._r].filter(Boolean).map(Yt=>Yt.ref.current);ZN(br,D)}}at.current=!1}),onBlur:jn(r.onBlur,()=>Pe(!1))})})}),qN="RovingFocusGroupItem",WN=ee.forwardRef((r,t)=>{const{__scopeRovingFocusGroup:s,focusable:l=!0,active:h=!1,tabStopId:m,...v}=r,i=$p(),A=m||i,P=_$(qN,s),D=P.currentTabStopId===A,F=$N(s),{onFocusableItemAdd:$,onFocusableItemRemove:K}=P;return ee.useEffect(()=>{if(l)return $(),()=>K()},[l,$,K]),b.jsx(IS.ItemSlot,{scope:s,id:A,focusable:l,active:h,children:b.jsx(vi.span,{tabIndex:D?0:-1,"data-orientation":P.orientation,...v,ref:t,onMouseDown:jn(r.onMouseDown,J=>{l?P.onItemFocus(A):J.preventDefault()}),onFocus:jn(r.onFocus,()=>P.onItemFocus(A)),onKeyDown:jn(r.onKeyDown,J=>{if(J.key==="Tab"&&J.shiftKey){P.onItemShiftTab();return}if(J.target!==J.currentTarget)return;const W=w$(J,P.orientation,P.dir);if(W!==void 0){if(J.metaKey||J.ctrlKey||J.altKey||J.shiftKey)return;J.preventDefault();let fe=F().filter(Pe=>Pe.focusable).map(Pe=>Pe.ref.current);if(W==="last")fe.reverse();else if(W==="prev"||W==="next"){W==="prev"&&fe.reverse();const Pe=fe.indexOf(J.currentTarget);fe=P.loop?S$(fe,Pe+1):fe.slice(Pe+1)}setTimeout(()=>ZN(fe))}})})})});WN.displayName=qN;var v$={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function b$(r,t){return t!=="rtl"?r:r==="ArrowLeft"?"ArrowRight":r==="ArrowRight"?"ArrowLeft":r}function w$(r,t,s){const l=b$(r.key,s);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return v$[l]}function ZN(r,t=!1){const s=document.activeElement;for(const l of r)if(l===s||(l.focus({preventScroll:t}),document.activeElement!==s))return}function S$(r,t){return r.map((s,l)=>r[(t+l)%r.length])}var T$=GN,E$=WN,BT="Tabs",[C$,yX]=Ry(BT,[HN]),XN=HN(),[A$,VT]=C$(BT),KN=ee.forwardRef((r,t)=>{const{__scopeTabs:s,value:l,onValueChange:h,defaultValue:m,orientation:v="horizontal",dir:i,activationMode:A="automatic",...P}=r,D=jT(i),[F,$]=hg({prop:l,onChange:h,defaultProp:m});return b.jsx(A$,{scope:s,baseId:$p(),value:F,onValueChange:$,orientation:v,dir:D,activationMode:A,children:b.jsx(vi.div,{dir:D,"data-orientation":v,...P,ref:t})})});KN.displayName=BT;var YN="TabsList",JN=ee.forwardRef((r,t)=>{const{__scopeTabs:s,loop:l=!0,...h}=r,m=VT(YN,s),v=XN(s);return b.jsx(T$,{asChild:!0,...v,orientation:m.orientation,dir:m.dir,loop:l,children:b.jsx(vi.div,{role:"tablist","aria-orientation":m.orientation,...h,ref:t})})});JN.displayName=YN;var QN="TabsTrigger",eD=ee.forwardRef((r,t)=>{const{__scopeTabs:s,value:l,disabled:h=!1,...m}=r,v=VT(QN,s),i=XN(s),A=nD(v.baseId,l),P=iD(v.baseId,l),D=l===v.value;return b.jsx(E$,{asChild:!0,...i,focusable:!h,active:D,children:b.jsx(vi.button,{type:"button",role:"tab","aria-selected":D,"aria-controls":P,"data-state":D?"active":"inactive","data-disabled":h?"":void 0,disabled:h,id:A,...m,ref:t,onMouseDown:jn(r.onMouseDown,F=>{!h&&F.button===0&&F.ctrlKey===!1?v.onValueChange(l):F.preventDefault()}),onKeyDown:jn(r.onKeyDown,F=>{[" ","Enter"].includes(F.key)&&v.onValueChange(l)}),onFocus:jn(r.onFocus,()=>{const F=v.activationMode!=="manual";!D&&!h&&F&&v.onValueChange(l)})})})});eD.displayName=QN;var tD="TabsContent",rD=ee.forwardRef((r,t)=>{const{__scopeTabs:s,value:l,forceMount:h,children:m,...v}=r,i=VT(tD,s),A=nD(i.baseId,l),P=iD(i.baseId,l),D=l===i.value,F=ee.useRef(D);return ee.useEffect(()=>{const $=requestAnimationFrame(()=>F.current=!1);return()=>cancelAnimationFrame($)},[]),b.jsx(wg,{present:h||D,children:({present:$})=>b.jsx(vi.div,{"data-state":D?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":A,hidden:!$,id:P,tabIndex:0,...v,ref:t,style:{...r.style,animationDuration:F.current?"0s":void 0},children:$&&m})})});rD.displayName=tD;function nD(r,t){return`${r}-trigger-${t}`}function iD(r,t){return`${r}-content-${t}`}var I$=KN,sD=JN,oD=eD,aD=rD;const M$=I$,lD=ee.forwardRef(({className:r,...t},s)=>b.jsx(sD,{ref:s,className:ki("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",r),...t}));lD.displayName=sD.displayName;const cd=ee.forwardRef(({className:r,...t},s)=>b.jsx(oD,{ref:s,className:ki("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",r),...t}));cd.displayName=oD.displayName;const hu=ee.forwardRef(({className:r,...t},s)=>b.jsx(aD,{ref:s,className:ki("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),...t}));hu.displayName=aD.displayName;const k$=({onLogout:r,onStyleSettingsOpen:t,onPopupManagementOpen:s})=>b.jsx("div",{className:"bg-white shadow-sm border-b",children:b.jsx("div",{className:"container-width section-padding",children:b.jsxs("div",{className:"py-6 flex justify-between items-center",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Content Management Dashboard"}),b.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your website content from this dashboard"})]}),b.jsxs("div",{className:"flex gap-2",children:[b.jsxs(fr,{variant:"outline",onClick:s,className:"flex items-center gap-2",children:[b.jsx(_B,{size:16}),"Popup"]}),b.jsxs(fr,{variant:"outline",onClick:t,className:"flex items-center gap-2",children:[b.jsx(xB,{size:16}),"Style Settings"]}),b.jsxs(fr,{variant:"outline",onClick:r,className:"flex items-center gap-2",children:[b.jsx(gB,{size:16}),"Logout"]})]})]})})}),P$=({services:r,teamMembers:t,products:s,funds:l,messages:h,caseStudies:m,blogPosts:v,consulting:i})=>b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-7 gap-6 mb-7",children:[b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Consultings"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:i.length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Active Consultings"})]})]}),b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Team"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Team members"})]})]}),b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Products"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Active products"})]})]}),b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Messages"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:h.filter(A=>A.status==="unread").length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Unread messages"})]})]}),b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Portfolio"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Published studies"})]})]}),b.jsxs(Rn,{children:[b.jsx(Yn,{className:"pb-2",children:b.jsx(Jn,{className:"text-sm text-gray-600",children:"Blog Posts"})}),b.jsxs(Qn,{children:[b.jsx("div",{className:"text-2xl font-bold text-primary",children:v.length}),b.jsx("p",{className:"text-sm text-gray-600",children:"Published posts"})]})]})]}),R$=({isOpen:r,onClose:t,onSubmit:s,service:l})=>{const[h,m]=ee.useState({title:l?.title||"",description:l?.description||"",duration:l?.duration||"",eligibility:l?.eligibility||"",features:l?.features.join(`
`)||"",icon:l?.icon||"home",category:l?.category||"incubation",presentationUrl:l?.presentationUrl||""});ee.useEffect(()=>{m(l?{title:l.title||"",description:l.description||"",duration:l.duration||"",eligibility:l.eligibility||"",features:Array.isArray(l.features)?l.features.join(`
`):"",icon:l.icon||"home",category:l.category||"incubation",presentationUrl:l.presentationUrl||""}:{title:"",description:"",duration:"",eligibility:"",features:"",icon:"home",category:"incubation",presentationUrl:""})},[l,r]);const v=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim()!=="")}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Program":"Add New Program"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"title",children:"Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"category",children:"Category"}),b.jsxs("select",{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[b.jsx("option",{value:"incubation",children:"Incubation"}),b.jsx("option",{value:"acceleration",children:"Acceleration"}),b.jsx("option",{value:"mentorship",children:"Mentorship"}),b.jsx("option",{value:"funding",children:"Funding"})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"duration",children:"Duration"}),b.jsx(Jr,{id:"duration",value:h.duration,onChange:i=>m(A=>({...A,duration:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"eligibility",children:"Eligibility"}),b.jsx(Jr,{id:"eligibility",value:h.eligibility,onChange:i=>m(A=>({...A,eligibility:i.target.value})),required:!0})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"presentationUrl",children:"Link Redirection URL"}),b.jsx(Jr,{id:"presentationUrl",value:h.presentationUrl,onChange:i=>m(A=>({...A,presentationUrl:i.target.value})),placeholder:"https://www.hubspot.fr"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"features",children:"Features (one per line)"}),b.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),placeholder:"Enter each feature on a new line",rows:4})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"icon",children:"Icon"}),b.jsxs("select",{id:"icon",value:h.icon,onChange:i=>m(A=>({...A,icon:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[b.jsx("option",{value:"home",children:"Home"}),b.jsx("option",{value:"arrow-up",children:"Arrow Up"}),b.jsx("option",{value:"book",children:"Book"}),b.jsx("option",{value:"users",children:"Users"})]})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:l?"Update Program":"Add Program"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},N$=({isOpen:r,onClose:t,onSubmit:s,consulting:l})=>{const[h,m]=ee.useState({title:l?.title||"",description:l?.description||"",eligibility:l?.eligibility||"",features:l?.features.join(`
`)||"",icon:l?.icon||"home",category:l?.category||"strategy",directUrl:l?.directUrl||""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,eligibility:l.eligibility,features:l.features.join(`
`),icon:l.icon,category:l.category,directUrl:l.directUrl||""}:{title:"",description:"",eligibility:"",features:"",icon:"home",category:"strategy",directUrl:""})},[l,r]);const v=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim()!=="")}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Consulting":"Add New Consulting"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"title",children:"Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"category",children:"Category"}),b.jsxs("select",{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[b.jsx("option",{value:"strategy",children:"Strategy"}),b.jsx("option",{value:"product",children:"Product"}),b.jsx("option",{value:"marketing",children:"Marketing"}),b.jsx("option",{value:"funding",children:"Funding"})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"eligibility",children:"Duration"}),b.jsx(Jr,{id:"eligibility",value:h.eligibility,onChange:i=>m(A=>({...A,eligibility:i.target.value}))})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"directUrl",children:"Link Redirection URL"}),b.jsx(Jr,{id:"directUrl",value:h.directUrl,onChange:i=>m(A=>({...A,directUrl:i.target.value})),placeholder:"https://yourconsultinglink.com"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"features",children:"Features (one per line)"}),b.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),rows:4})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"icon",children:"Icon"}),b.jsxs("select",{id:"icon",value:h.icon,onChange:i=>m(A=>({...A,icon:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[b.jsx("option",{value:"home",children:"Home"}),b.jsx("option",{value:"target",children:"Target"}),b.jsx("option",{value:"lightbulb",children:"Lightbulb"}),b.jsx("option",{value:"users",children:"Users"})]})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:l?"Update Consulting":"Add Consulting"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},D$=({isOpen:r,onClose:t,onSubmit:s,product:l})=>{const[h,m]=ee.useState({name:l?.name||"",description:l?.description||"",category:l?.category||"",price:l?.price||"",features:l?.features?.join(`
`)||"",image:l?.image||"",status:l?.status||"active"});ee.useEffect(()=>{m(l?{name:l?.name||"",description:l?.description||"",category:l?.category||"",price:l?.price||"",features:l?.features?.join(`
`)||"",image:l?.image||"",status:l?.status||"active"}:{name:"",description:"",category:"",price:"",features:"",image:"",status:"active"})},[l,r]);const v=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim())}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Product":"Add New Product"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"name",children:"Product Name"}),b.jsx(Jr,{id:"name",value:h.name,onChange:i=>m(A=>({...A,name:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"category",children:"Category"}),b.jsx(Jr,{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),required:!0})]})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"price",children:"Price"}),b.jsx(Jr,{id:"price",value:h.price,onChange:i=>m(A=>({...A,price:i.target.value})),placeholder:"$99/month"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"status",children:"Status"}),b.jsxs(Cf,{value:h.status,onValueChange:i=>m(A=>({...A,status:i})),children:[b.jsx(gd,{children:b.jsx(Af,{})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"active",children:"Active"}),b.jsx(ps,{value:"inactive",children:"Inactive"}),b.jsx(ps,{value:"coming-soon",children:"Coming Soon"})]})]})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"features",children:"Features (one per line)"}),b.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),placeholder:`Feature 1
Feature 2
Feature 3`,required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"image",children:"Link Redirection URL"}),b.jsx(Jr,{id:"image",type:"url",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:l?"Update Product":"Add Product"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},O$=({isOpen:r,onClose:t,onSubmit:s,fund:l})=>{const[h,m]=ee.useState({name:l?.name||"",description:l?.description||"",totalSize:l?.totalSize||"",currentRaise:l?.currentRaise||"",targetCompanies:l?.targetCompanies||"",stage:l?.stage||"",sectors:l?.sectors?.join(", ")||"",status:l?.status||"fundraising"});ee.useEffect(()=>{m(l?{name:l?.name||"",description:l?.description||"",totalSize:l?.totalSize||"",currentRaise:l?.currentRaise||"",targetCompanies:l?.targetCompanies||"",stage:l?.stage||"",sectors:l?.sectors?.join(", ")||"",status:l?.status||"fundraising"}:{name:"",description:"",totalSize:"",currentRaise:"",targetCompanies:"",stage:"",sectors:"",status:"fundraising"})},[l,r]);const v=i=>{i.preventDefault(),s({...h,sectors:h.sectors.split(",").map(A=>A.trim()).filter(A=>A)}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Fund":"Add New Fund"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"name",children:"Fund Name"}),b.jsx(Jr,{id:"name",value:h.name,onChange:i=>m(A=>({...A,name:i.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"totalSize",children:"Total Fund Size"}),b.jsx(Jr,{id:"totalSize",value:h.totalSize,onChange:i=>m(A=>({...A,totalSize:i.target.value})),placeholder:"$50M",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"currentRaise",children:"Current Raise"}),b.jsx(Jr,{id:"currentRaise",value:h.currentRaise,onChange:i=>m(A=>({...A,currentRaise:i.target.value})),placeholder:"$35M",required:!0})]})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"targetCompanies",children:"Target Companies"}),b.jsx(Jr,{id:"targetCompanies",value:h.targetCompanies,onChange:i=>m(A=>({...A,targetCompanies:i.target.value})),placeholder:"25-30",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"stage",children:"Investment Stage"}),b.jsx(Jr,{id:"stage",value:h.stage,onChange:i=>m(A=>({...A,stage:i.target.value})),placeholder:"Pre-seed to Seed",required:!0})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"sectors",children:"Sectors (comma-separated)"}),b.jsx(Jr,{id:"sectors",value:h.sectors,onChange:i=>m(A=>({...A,sectors:i.target.value})),placeholder:"FinTech, HealthTech, AI/ML, SaaS",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"status",children:"Status"}),b.jsxs(Cf,{value:h.status,onValueChange:i=>m(A=>({...A,status:i})),children:[b.jsx(gd,{children:b.jsx(Af,{})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"fundraising",children:"Fundraising"}),b.jsx(ps,{value:"deployed",children:"Deployed"}),b.jsx(ps,{value:"closed",children:"Closed"})]})]})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:l?"Update Fund":"Add Fund"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},L$=({isOpen:r,onClose:t,onSubmit:s,caseStudy:l})=>{const[h,m]=ee.useState({companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}});ee.useEffect(()=>{m(l?{companyName:l.companyName,industry:l.industry,description:l.description,challenge:l.challenge,solution:l.solution,results:l.results.join(`
`),tags:l.tags.join(", "),image:l.image,testimonial:l.testimonial}:{companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}})},[l,r]);const v=async P=>{P.preventDefault();const D=h.results.split(`
`).map($=>$.trim()).filter($=>$),F=h.tags.split(",").map($=>$.trim()).filter($=>$);s({...h,results:D,tags:F}),t()},[i,A]=ee.useState(h.image);return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Case Study":"Add New Case Study"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"companyName",children:"Company Name"}),b.jsx(Jr,{id:"companyName",value:h.companyName,onChange:P=>m(D=>({...D,companyName:P.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"industry",children:"Industry"}),b.jsx(Jr,{id:"industry",value:h.industry,onChange:P=>m(D=>({...D,industry:P.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:P=>m(D=>({...D,description:P.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"challenge",children:"Challenge"}),b.jsx(fo,{id:"challenge",value:h.challenge,onChange:P=>m(D=>({...D,challenge:P.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"solution",children:"Solution"}),b.jsx(fo,{id:"solution",value:h.solution,onChange:P=>m(D=>({...D,solution:P.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"results",children:"Results (one per line)"}),b.jsx(fo,{id:"results",value:h.results,onChange:P=>m(D=>({...D,results:P.target.value})),placeholder:"Enter each result on a new line",rows:4,required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"tags",children:"Tags (comma-separated)"}),b.jsx(Jr,{id:"tags",value:h.tags,onChange:P=>m(D=>({...D,tags:P.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"image",children:"Image URL"}),b.jsx(Jr,{id:"image",type:"url",value:h.image,onChange:P=>{m(D=>({...D,image:P.target.value})),A(P.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),i&&b.jsx("img",{src:i,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{children:"Testimonial"}),b.jsxs("div",{className:"space-y-2 border p-4 rounded",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"testimonialQuote",children:"Quote"}),b.jsx(fo,{id:"testimonialQuote",value:h.testimonial.quote,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,quote:P.target.value}})),placeholder:"Enter testimonial quote"})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"testimonialAuthor",children:"Author"}),b.jsx(Jr,{id:"testimonialAuthor",value:h.testimonial.author,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,author:P.target.value}})),placeholder:"Author name"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"testimonialPosition",children:"Position"}),b.jsx(Jr,{id:"testimonialPosition",value:h.testimonial.position,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,position:P.target.value}})),placeholder:"Author position"})]})]})]})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsxs(fr,{type:"submit",children:[l?"Update":"Add"," Case Study"]}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})};var ww={exports:{}},Sw={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cM;function z$(){if(cM)return Sw;cM=1;var r=fx();function t(F,$){return F===$&&(F!==0||1/F===1/$)||F!==F&&$!==$}var s=typeof Object.is=="function"?Object.is:t,l=r.useState,h=r.useEffect,m=r.useLayoutEffect,v=r.useDebugValue;function i(F,$){var K=$(),J=l({inst:{value:K,getSnapshot:$}}),W=J[0].inst,ie=J[1];return m(function(){W.value=K,W.getSnapshot=$,A(W)&&ie({inst:W})},[F,K,$]),h(function(){return A(W)&&ie({inst:W}),F(function(){A(W)&&ie({inst:W})})},[F]),v(K),K}function A(F){var $=F.getSnapshot;F=F.value;try{var K=$();return!s(F,K)}catch{return!0}}function P(F,$){return $()}var D=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?P:i;return Sw.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:D,Sw}var uM;function cD(){return uM||(uM=1,ww.exports=z$()),ww.exports}var uD=cD();function La(r){this.content=r}La.prototype={constructor:La,find:function(r){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===r)return t;return-1},get:function(r){var t=this.find(r);return t==-1?void 0:this.content[t+1]},update:function(r,t,s){var l=s&&s!=r?this.remove(s):this,h=l.find(r),m=l.content.slice();return h==-1?m.push(s||r,t):(m[h+1]=t,s&&(m[h]=s)),new La(m)},remove:function(r){var t=this.find(r);if(t==-1)return this;var s=this.content.slice();return s.splice(t,2),new La(s)},addToStart:function(r,t){return new La([r,t].concat(this.remove(r).content))},addToEnd:function(r,t){var s=this.remove(r).content.slice();return s.push(r,t),new La(s)},addBefore:function(r,t,s){var l=this.remove(t),h=l.content.slice(),m=l.find(r);return h.splice(m==-1?h.length:m,0,t,s),new La(h)},forEach:function(r){for(var t=0;t<this.content.length;t+=2)r(this.content[t],this.content[t+1])},prepend:function(r){return r=La.from(r),r.size?new La(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=La.from(r),r.size?new La(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var t=this;r=La.from(r);for(var s=0;s<r.content.length;s+=2)t=t.remove(r.content[s]);return t},toObject:function(){var r={};return this.forEach(function(t,s){r[t]=s}),r},get size(){return this.content.length>>1}};La.from=function(r){if(r instanceof La)return r;var t=[];if(r)for(var s in r)t.push(s,r[s]);return new La(t)};function hD(r,t,s){for(let l=0;;l++){if(l==r.childCount||l==t.childCount)return r.childCount==t.childCount?null:s;let h=r.child(l),m=t.child(l);if(h==m){s+=h.nodeSize;continue}if(!h.sameMarkup(m))return s;if(h.isText&&h.text!=m.text){for(let v=0;h.text[v]==m.text[v];v++)s++;return s}if(h.content.size||m.content.size){let v=hD(h.content,m.content,s+1);if(v!=null)return v}s+=h.nodeSize}}function dD(r,t,s,l){for(let h=r.childCount,m=t.childCount;;){if(h==0||m==0)return h==m?null:{a:s,b:l};let v=r.child(--h),i=t.child(--m),A=v.nodeSize;if(v==i){s-=A,l-=A;continue}if(!v.sameMarkup(i))return{a:s,b:l};if(v.isText&&v.text!=i.text){let P=0,D=Math.min(v.text.length,i.text.length);for(;P<D&&v.text[v.text.length-P-1]==i.text[i.text.length-P-1];)P++,s--,l--;return{a:s,b:l}}if(v.content.size||i.content.size){let P=dD(v.content,i.content,s-1,l-1);if(P)return P}s-=A,l-=A}}class dr{constructor(t,s){if(this.content=t,this.size=s||0,s==null)for(let l=0;l<t.length;l++)this.size+=t[l].nodeSize}nodesBetween(t,s,l,h=0,m){for(let v=0,i=0;i<s;v++){let A=this.content[v],P=i+A.nodeSize;if(P>t&&l(A,h+i,m||null,v)!==!1&&A.content.size){let D=i+1;A.nodesBetween(Math.max(0,t-D),Math.min(A.content.size,s-D),l,h+D)}i=P}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,s,l,h){let m="",v=!0;return this.nodesBetween(t,s,(i,A)=>{let P=i.isText?i.text.slice(Math.max(t,A)-A,s-A):i.isLeaf?h?typeof h=="function"?h(i):h:i.type.spec.leafText?i.type.spec.leafText(i):"":"";i.isBlock&&(i.isLeaf&&P||i.isTextblock)&&l&&(v?v=!1:m+=l),m+=P},0),m}append(t){if(!t.size)return this;if(!this.size)return t;let s=this.lastChild,l=t.firstChild,h=this.content.slice(),m=0;for(s.isText&&s.sameMarkup(l)&&(h[h.length-1]=s.withText(s.text+l.text),m=1);m<t.content.length;m++)h.push(t.content[m]);return new dr(h,this.size+t.size)}cut(t,s=this.size){if(t==0&&s==this.size)return this;let l=[],h=0;if(s>t)for(let m=0,v=0;v<s;m++){let i=this.content[m],A=v+i.nodeSize;A>t&&((v<t||A>s)&&(i.isText?i=i.cut(Math.max(0,t-v),Math.min(i.text.length,s-v)):i=i.cut(Math.max(0,t-v-1),Math.min(i.content.size,s-v-1))),l.push(i),h+=i.nodeSize),v=A}return new dr(l,h)}cutByIndex(t,s){return t==s?dr.empty:t==0&&s==this.content.length?this:new dr(this.content.slice(t,s))}replaceChild(t,s){let l=this.content[t];if(l==s)return this;let h=this.content.slice(),m=this.size+s.nodeSize-l.nodeSize;return h[t]=s,new dr(h,m)}addToStart(t){return new dr([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new dr(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let s=0;s<this.content.length;s++)if(!this.content[s].eq(t.content[s]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let s=this.content[t];if(!s)throw new RangeError("Index "+t+" out of range for "+this);return s}maybeChild(t){return this.content[t]||null}forEach(t){for(let s=0,l=0;s<this.content.length;s++){let h=this.content[s];t(h,l,s),l+=h.nodeSize}}findDiffStart(t,s=0){return hD(this,t,s)}findDiffEnd(t,s=this.size,l=t.size){return dD(this,t,s,l)}findIndex(t){if(t==0)return Ev(0,t);if(t==this.size)return Ev(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let s=0,l=0;;s++){let h=this.child(s),m=l+h.nodeSize;if(m>=t)return m==t?Ev(s+1,m):Ev(s,l);l=m}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,s){if(!s)return dr.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new dr(s.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return dr.empty;let s,l=0;for(let h=0;h<t.length;h++){let m=t[h];l+=m.nodeSize,h&&m.isText&&t[h-1].sameMarkup(m)?(s||(s=t.slice(0,h)),s[s.length-1]=m.withText(s[s.length-1].text+m.text)):s&&s.push(m)}return new dr(s||t,l)}static from(t){if(!t)return dr.empty;if(t instanceof dr)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new dr([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}dr.empty=new dr([],0);const Tw={index:0,offset:0};function Ev(r,t){return Tw.index=r,Tw.offset=t,Tw}function b0(r,t){if(r===t)return!0;if(!(r&&typeof r=="object")||!(t&&typeof t=="object"))return!1;let s=Array.isArray(r);if(Array.isArray(t)!=s)return!1;if(s){if(r.length!=t.length)return!1;for(let l=0;l<r.length;l++)if(!b0(r[l],t[l]))return!1}else{for(let l in r)if(!(l in t)||!b0(r[l],t[l]))return!1;for(let l in t)if(!(l in r))return!1}return!0}let _s=class MS{constructor(t,s){this.type=t,this.attrs=s}addToSet(t){let s,l=!1;for(let h=0;h<t.length;h++){let m=t[h];if(this.eq(m))return t;if(this.type.excludes(m.type))s||(s=t.slice(0,h));else{if(m.type.excludes(this.type))return t;!l&&m.type.rank>this.type.rank&&(s||(s=t.slice(0,h)),s.push(this),l=!0),s&&s.push(m)}}return s||(s=t.slice()),l||s.push(this),s}removeFromSet(t){for(let s=0;s<t.length;s++)if(this.eq(t[s]))return t.slice(0,s).concat(t.slice(s+1));return t}isInSet(t){for(let s=0;s<t.length;s++)if(this.eq(t[s]))return!0;return!1}eq(t){return this==t||this.type==t.type&&b0(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let s in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,s){if(!s)throw new RangeError("Invalid input for Mark.fromJSON");let l=t.marks[s.type];if(!l)throw new RangeError(`There is no mark type ${s.type} in this schema`);let h=l.create(s.attrs);return l.checkAttrs(h.attrs),h}static sameSet(t,s){if(t==s)return!0;if(t.length!=s.length)return!1;for(let l=0;l<t.length;l++)if(!t[l].eq(s[l]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return MS.none;if(t instanceof MS)return[t];let s=t.slice();return s.sort((l,h)=>l.type.rank-h.type.rank),s}};_s.none=[];class w0 extends Error{}class Yr{constructor(t,s,l){this.content=t,this.openStart=s,this.openEnd=l}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,s){let l=pD(this.content,t+this.openStart,s);return l&&new Yr(l,this.openStart,this.openEnd)}removeBetween(t,s){return new Yr(fD(this.content,t+this.openStart,s+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,s){if(!s)return Yr.empty;let l=s.openStart||0,h=s.openEnd||0;if(typeof l!="number"||typeof h!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Yr(dr.fromJSON(t,s.content),l,h)}static maxOpen(t,s=!0){let l=0,h=0;for(let m=t.firstChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.firstChild)l++;for(let m=t.lastChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.lastChild)h++;return new Yr(t,l,h)}}Yr.empty=new Yr(dr.empty,0,0);function fD(r,t,s){let{index:l,offset:h}=r.findIndex(t),m=r.maybeChild(l),{index:v,offset:i}=r.findIndex(s);if(h==t||m.isText){if(i!=s&&!r.child(v).isText)throw new RangeError("Removing non-flat range");return r.cut(0,t).append(r.cut(s))}if(l!=v)throw new RangeError("Removing non-flat range");return r.replaceChild(l,m.copy(fD(m.content,t-h-1,s-h-1)))}function pD(r,t,s,l){let{index:h,offset:m}=r.findIndex(t),v=r.maybeChild(h);if(m==t||v.isText)return r.cut(0,t).append(s).append(r.cut(t));let i=pD(v.content,t-m-1,s);return i&&r.replaceChild(h,v.copy(i))}function j$(r,t,s){if(s.openStart>r.depth)throw new w0("Inserted content deeper than insertion position");if(r.depth-s.openStart!=t.depth-s.openEnd)throw new w0("Inconsistent open depths");return mD(r,t,s,0)}function mD(r,t,s,l){let h=r.index(l),m=r.node(l);if(h==t.index(l)&&l<r.depth-s.openStart){let v=mD(r,t,s,l+1);return m.copy(m.content.replaceChild(h,v))}else if(s.content.size)if(!s.openStart&&!s.openEnd&&r.depth==l&&t.depth==l){let v=r.parent,i=v.content;return og(v,i.cut(0,r.parentOffset).append(s.content).append(i.cut(t.parentOffset)))}else{let{start:v,end:i}=F$(s,r);return og(m,yD(r,v,i,t,l))}else return og(m,S0(r,t,l))}function gD(r,t){if(!t.type.compatibleContent(r.type))throw new w0("Cannot join "+t.type.name+" onto "+r.type.name)}function kS(r,t,s){let l=r.node(s);return gD(l,t.node(s)),l}function sg(r,t){let s=t.length-1;s>=0&&r.isText&&r.sameMarkup(t[s])?t[s]=r.withText(t[s].text+r.text):t.push(r)}function V_(r,t,s,l){let h=(t||r).node(s),m=0,v=t?t.index(s):h.childCount;r&&(m=r.index(s),r.depth>s?m++:r.textOffset&&(sg(r.nodeAfter,l),m++));for(let i=m;i<v;i++)sg(h.child(i),l);t&&t.depth==s&&t.textOffset&&sg(t.nodeBefore,l)}function og(r,t){return r.type.checkContent(t),r.copy(t)}function yD(r,t,s,l,h){let m=r.depth>h&&kS(r,t,h+1),v=l.depth>h&&kS(s,l,h+1),i=[];return V_(null,r,h,i),m&&v&&t.index(h)==s.index(h)?(gD(m,v),sg(og(m,yD(r,t,s,l,h+1)),i)):(m&&sg(og(m,S0(r,t,h+1)),i),V_(t,s,h,i),v&&sg(og(v,S0(s,l,h+1)),i)),V_(l,null,h,i),new dr(i)}function S0(r,t,s){let l=[];if(V_(null,r,s,l),r.depth>s){let h=kS(r,t,s+1);sg(og(h,S0(r,t,s+1)),l)}return V_(t,null,s,l),new dr(l)}function F$(r,t){let s=t.depth-r.openStart,h=t.node(s).copy(r.content);for(let m=s-1;m>=0;m--)h=t.node(m).copy(dr.from(h));return{start:h.resolveNoCache(r.openStart+s),end:h.resolveNoCache(h.content.size-r.openEnd-s)}}class rx{constructor(t,s,l){this.pos=t,this.path=s,this.parentOffset=l,this.depth=s.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,s=this.index(this.depth);if(s==t.childCount)return null;let l=this.pos-this.path[this.path.length-1],h=t.child(s);return l?t.child(s).cut(l):h}get nodeBefore(){let t=this.index(this.depth),s=this.pos-this.path[this.path.length-1];return s?this.parent.child(t).cut(0,s):t==0?null:this.parent.child(t-1)}posAtIndex(t,s){s=this.resolveDepth(s);let l=this.path[s*3],h=s==0?0:this.path[s*3-1]+1;for(let m=0;m<t;m++)h+=l.child(m).nodeSize;return h}marks(){let t=this.parent,s=this.index();if(t.content.size==0)return _s.none;if(this.textOffset)return t.child(s).marks;let l=t.maybeChild(s-1),h=t.maybeChild(s);if(!l){let i=l;l=h,h=i}let m=l.marks;for(var v=0;v<m.length;v++)m[v].type.spec.inclusive===!1&&(!h||!m[v].isInSet(h.marks))&&(m=m[v--].removeFromSet(m));return m}marksAcross(t){let s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;let l=s.marks,h=t.parent.maybeChild(t.index());for(var m=0;m<l.length;m++)l[m].type.spec.inclusive===!1&&(!h||!l[m].isInSet(h.marks))&&(l=l[m--].removeFromSet(l));return l}sharedDepth(t){for(let s=this.depth;s>0;s--)if(this.start(s)<=t&&this.end(s)>=t)return s;return 0}blockRange(t=this,s){if(t.pos<this.pos)return t.blockRange(this);for(let l=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);l>=0;l--)if(t.pos<=this.end(l)&&(!s||s(this.node(l))))return new T0(this,t,l);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let s=1;s<=this.depth;s++)t+=(t?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return t+":"+this.parentOffset}static resolve(t,s){if(!(s>=0&&s<=t.content.size))throw new RangeError("Position "+s+" out of range");let l=[],h=0,m=s;for(let v=t;;){let{index:i,offset:A}=v.content.findIndex(m),P=m-A;if(l.push(v,i,h+A),!P||(v=v.child(i),v.isText))break;m=P-1,h+=A+1}return new rx(s,l,m)}static resolveCached(t,s){let l=hM.get(t);if(l)for(let m=0;m<l.elts.length;m++){let v=l.elts[m];if(v.pos==s)return v}else hM.set(t,l=new B$);let h=l.elts[l.i]=rx.resolve(t,s);return l.i=(l.i+1)%V$,h}}class B${constructor(){this.elts=[],this.i=0}}const V$=12,hM=new WeakMap;class T0{constructor(t,s,l){this.$from=t,this.$to=s,this.depth=l}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const U$=Object.create(null);let Gp=class PS{constructor(t,s,l,h=_s.none){this.type=t,this.attrs=s,this.marks=h,this.content=l||dr.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,s,l,h=0){this.content.nodesBetween(t,s,l,h,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,s,l,h){return this.content.textBetween(t,s,l,h)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,s,l){return this.type==t&&b0(this.attrs,s||t.defaultAttrs||U$)&&_s.sameSet(this.marks,l||_s.none)}copy(t=null){return t==this.content?this:new PS(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new PS(this.type,this.attrs,this.content,t)}cut(t,s=this.content.size){return t==0&&s==this.content.size?this:this.copy(this.content.cut(t,s))}slice(t,s=this.content.size,l=!1){if(t==s)return Yr.empty;let h=this.resolve(t),m=this.resolve(s),v=l?0:h.sharedDepth(s),i=h.start(v),P=h.node(v).content.cut(h.pos-i,m.pos-i);return new Yr(P,h.depth-v,m.depth-v)}replace(t,s,l){return j$(this.resolve(t),this.resolve(s),l)}nodeAt(t){for(let s=this;;){let{index:l,offset:h}=s.content.findIndex(t);if(s=s.maybeChild(l),!s)return null;if(h==t||s.isText)return s;t-=h+1}}childAfter(t){let{index:s,offset:l}=this.content.findIndex(t);return{node:this.content.maybeChild(s),index:s,offset:l}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:s,offset:l}=this.content.findIndex(t);if(l<t)return{node:this.content.child(s),index:s,offset:l};let h=this.content.child(s-1);return{node:h,index:s-1,offset:l-h.nodeSize}}resolve(t){return rx.resolveCached(this,t)}resolveNoCache(t){return rx.resolve(this,t)}rangeHasMark(t,s,l){let h=!1;return s>t&&this.nodesBetween(t,s,m=>(l.isInSet(m.marks)&&(h=!0),!h)),h}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),_D(this.marks,t)}contentMatchAt(t){let s=this.type.contentMatch.matchFragment(this.content,0,t);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s}canReplace(t,s,l=dr.empty,h=0,m=l.childCount){let v=this.contentMatchAt(t).matchFragment(l,h,m),i=v&&v.matchFragment(this.content,s);if(!i||!i.validEnd)return!1;for(let A=h;A<m;A++)if(!this.type.allowsMarks(l.child(A).marks))return!1;return!0}canReplaceWith(t,s,l,h){if(h&&!this.type.allowsMarks(h))return!1;let m=this.contentMatchAt(t).matchType(l),v=m&&m.matchFragment(this.content,s);return v?v.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=_s.none;for(let s=0;s<this.marks.length;s++){let l=this.marks[s];l.type.checkAttrs(l.attrs),t=l.addToSet(t)}if(!_s.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(s=>s.type.name)}`);this.content.forEach(s=>s.check())}toJSON(){let t={type:this.type.name};for(let s in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(s=>s.toJSON())),t}static fromJSON(t,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");let l;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");l=s.marks.map(t.markFromJSON)}if(s.type=="text"){if(typeof s.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(s.text,l)}let h=dr.fromJSON(t,s.content),m=t.nodeType(s.type).create(s.attrs,h,l);return m.type.checkAttrs(m.attrs),m}};Gp.prototype.text=void 0;class E0 extends Gp{constructor(t,s,l,h){if(super(t,s,null,h),!l)throw new RangeError("Empty text nodes are not allowed");this.text=l}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):_D(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,s){return this.text.slice(t,s)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new E0(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new E0(this.type,this.attrs,t,this.marks)}cut(t=0,s=this.text.length){return t==0&&s==this.text.length?this:this.withText(this.text.slice(t,s))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function _D(r,t){for(let s=r.length-1;s>=0;s--)t=r[s].type.name+"("+t+")";return t}class yg{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,s){let l=new $$(t,s);if(l.next==null)return yg.empty;let h=xD(l);l.next&&l.err("Unexpected trailing text");let m=K$(X$(h));return Y$(m,l),m}matchType(t){for(let s=0;s<this.next.length;s++)if(this.next[s].type==t)return this.next[s].next;return null}matchFragment(t,s=0,l=t.childCount){let h=this;for(let m=s;h&&m<l;m++)h=h.matchType(t.child(m).type);return h}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:s}=this.next[t];if(!(s.isText||s.hasRequiredAttrs()))return s}return null}compatible(t){for(let s=0;s<this.next.length;s++)for(let l=0;l<t.next.length;l++)if(this.next[s].type==t.next[l].type)return!0;return!1}fillBefore(t,s=!1,l=0){let h=[this];function m(v,i){let A=v.matchFragment(t,l);if(A&&(!s||A.validEnd))return dr.from(i.map(P=>P.createAndFill()));for(let P=0;P<v.next.length;P++){let{type:D,next:F}=v.next[P];if(!(D.isText||D.hasRequiredAttrs())&&h.indexOf(F)==-1){h.push(F);let $=m(F,i.concat(D));if($)return $}}return null}return m(this,[])}findWrapping(t){for(let l=0;l<this.wrapCache.length;l+=2)if(this.wrapCache[l]==t)return this.wrapCache[l+1];let s=this.computeWrapping(t);return this.wrapCache.push(t,s),s}computeWrapping(t){let s=Object.create(null),l=[{match:this,type:null,via:null}];for(;l.length;){let h=l.shift(),m=h.match;if(m.matchType(t)){let v=[];for(let i=h;i.type;i=i.via)v.push(i.type);return v.reverse()}for(let v=0;v<m.next.length;v++){let{type:i,next:A}=m.next[v];!i.isLeaf&&!i.hasRequiredAttrs()&&!(i.name in s)&&(!h.type||A.validEnd)&&(l.push({match:i.contentMatch,type:i,via:h}),s[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function s(l){t.push(l);for(let h=0;h<l.next.length;h++)t.indexOf(l.next[h].next)==-1&&s(l.next[h].next)}return s(this),t.map((l,h)=>{let m=h+(l.validEnd?"*":" ")+" ";for(let v=0;v<l.next.length;v++)m+=(v?", ":"")+l.next[v].type.name+"->"+t.indexOf(l.next[v].next);return m}).join(`
`)}}yg.empty=new yg(!0);class $${constructor(t,s){this.string=t,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function xD(r){let t=[];do t.push(H$(r));while(r.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function H$(r){let t=[];do t.push(G$(r));while(r.next&&r.next!=")"&&r.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function G$(r){let t=Z$(r);for(;;)if(r.eat("+"))t={type:"plus",expr:t};else if(r.eat("*"))t={type:"star",expr:t};else if(r.eat("?"))t={type:"opt",expr:t};else if(r.eat("{"))t=q$(r,t);else break;return t}function dM(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");let t=Number(r.next);return r.pos++,t}function q$(r,t){let s=dM(r),l=s;return r.eat(",")&&(r.next!="}"?l=dM(r):l=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:s,max:l,expr:t}}function W$(r,t){let s=r.nodeTypes,l=s[t];if(l)return[l];let h=[];for(let m in s){let v=s[m];v.isInGroup(t)&&h.push(v)}return h.length==0&&r.err("No node type or group '"+t+"' found"),h}function Z$(r){if(r.eat("(")){let t=xD(r);return r.eat(")")||r.err("Missing closing paren"),t}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{let t=W$(r,r.next).map(s=>(r.inline==null?r.inline=s.isInline:r.inline!=s.isInline&&r.err("Mixing inline and block content"),{type:"name",value:s}));return r.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function X$(r){let t=[[]];return h(m(r,0),s()),t;function s(){return t.push([])-1}function l(v,i,A){let P={term:A,to:i};return t[v].push(P),P}function h(v,i){v.forEach(A=>A.to=i)}function m(v,i){if(v.type=="choice")return v.exprs.reduce((A,P)=>A.concat(m(P,i)),[]);if(v.type=="seq")for(let A=0;;A++){let P=m(v.exprs[A],i);if(A==v.exprs.length-1)return P;h(P,i=s())}else if(v.type=="star"){let A=s();return l(i,A),h(m(v.expr,A),A),[l(A)]}else if(v.type=="plus"){let A=s();return h(m(v.expr,i),A),h(m(v.expr,A),A),[l(A)]}else{if(v.type=="opt")return[l(i)].concat(m(v.expr,i));if(v.type=="range"){let A=i;for(let P=0;P<v.min;P++){let D=s();h(m(v.expr,A),D),A=D}if(v.max==-1)h(m(v.expr,A),A);else for(let P=v.min;P<v.max;P++){let D=s();l(A,D),h(m(v.expr,A),D),A=D}return[l(A)]}else{if(v.type=="name")return[l(i,void 0,v.value)];throw new Error("Unknown expr type")}}}}function vD(r,t){return t-r}function fM(r,t){let s=[];return l(t),s.sort(vD);function l(h){let m=r[h];if(m.length==1&&!m[0].term)return l(m[0].to);s.push(h);for(let v=0;v<m.length;v++){let{term:i,to:A}=m[v];!i&&s.indexOf(A)==-1&&l(A)}}}function K$(r){let t=Object.create(null);return s(fM(r,0));function s(l){let h=[];l.forEach(v=>{r[v].forEach(({term:i,to:A})=>{if(!i)return;let P;for(let D=0;D<h.length;D++)h[D][0]==i&&(P=h[D][1]);fM(r,A).forEach(D=>{P||h.push([i,P=[]]),P.indexOf(D)==-1&&P.push(D)})})});let m=t[l.join(",")]=new yg(l.indexOf(r.length-1)>-1);for(let v=0;v<h.length;v++){let i=h[v][1].sort(vD);m.next.push({type:h[v][0],next:t[i.join(",")]||s(i)})}return m}}function Y$(r,t){for(let s=0,l=[r];s<l.length;s++){let h=l[s],m=!h.validEnd,v=[];for(let i=0;i<h.next.length;i++){let{type:A,next:P}=h.next[i];v.push(A.name),m&&!(A.isText||A.hasRequiredAttrs())&&(m=!1),l.indexOf(P)==-1&&l.push(P)}m&&t.err("Only non-generatable nodes ("+v.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function bD(r){let t=Object.create(null);for(let s in r){let l=r[s];if(!l.hasDefault)return null;t[s]=l.default}return t}function wD(r,t){let s=Object.create(null);for(let l in r){let h=t&&t[l];if(h===void 0){let m=r[l];if(m.hasDefault)h=m.default;else throw new RangeError("No value supplied for attribute "+l)}s[l]=h}return s}function SD(r,t,s,l){for(let h in t)if(!(h in r))throw new RangeError(`Unsupported attribute ${h} for ${s} of type ${h}`);for(let h in r){let m=r[h];m.validate&&m.validate(t[h])}}function TD(r,t){let s=Object.create(null);if(t)for(let l in t)s[l]=new Q$(r,l,t[l]);return s}let pM=class ED{constructor(t,s,l){this.name=t,this.schema=s,this.spec=l,this.markSet=null,this.groups=l.group?l.group.split(" "):[],this.attrs=TD(t,l.attrs),this.defaultAttrs=bD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(l.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==yg.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:wD(this.attrs,t)}create(t=null,s,l){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Gp(this,this.computeAttrs(t),dr.from(s),_s.setFrom(l))}createChecked(t=null,s,l){return s=dr.from(s),this.checkContent(s),new Gp(this,this.computeAttrs(t),s,_s.setFrom(l))}createAndFill(t=null,s,l){if(t=this.computeAttrs(t),s=dr.from(s),s.size){let v=this.contentMatch.fillBefore(s);if(!v)return null;s=v.append(s)}let h=this.contentMatch.matchFragment(s),m=h&&h.fillBefore(dr.empty,!0);return m?new Gp(this,t,s.append(m),_s.setFrom(l)):null}validContent(t){let s=this.contentMatch.matchFragment(t);if(!s||!s.validEnd)return!1;for(let l=0;l<t.childCount;l++)if(!this.allowsMarks(t.child(l).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){SD(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let s=0;s<t.length;s++)if(!this.allowsMarkType(t[s].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let s;for(let l=0;l<t.length;l++)this.allowsMarkType(t[l].type)?s&&s.push(t[l]):s||(s=t.slice(0,l));return s?s.length?s:_s.none:t}static compile(t,s){let l=Object.create(null);t.forEach((m,v)=>l[m]=new ED(m,s,v));let h=s.spec.topNode||"doc";if(!l[h])throw new RangeError("Schema is missing its top node type ('"+h+"')");if(!l.text)throw new RangeError("Every schema needs a 'text' type");for(let m in l.text.attrs)throw new RangeError("The text node type should not have attributes");return l}};function J$(r,t,s){let l=s.split("|");return h=>{let m=h===null?"null":typeof h;if(l.indexOf(m)<0)throw new RangeError(`Expected value of type ${l} for attribute ${t} on type ${r}, got ${m}`)}}class Q${constructor(t,s,l){this.hasDefault=Object.prototype.hasOwnProperty.call(l,"default"),this.default=l.default,this.validate=typeof l.validate=="string"?J$(t,s,l.validate):l.validate}get isRequired(){return!this.hasDefault}}class I1{constructor(t,s,l,h){this.name=t,this.rank=s,this.schema=l,this.spec=h,this.attrs=TD(t,h.attrs),this.excluded=null;let m=bD(this.attrs);this.instance=m?new _s(this,m):null}create(t=null){return!t&&this.instance?this.instance:new _s(this,wD(this.attrs,t))}static compile(t,s){let l=Object.create(null),h=0;return t.forEach((m,v)=>l[m]=new I1(m,h++,s,v)),l}removeFromSet(t){for(var s=0;s<t.length;s++)t[s].type==this&&(t=t.slice(0,s).concat(t.slice(s+1)),s--);return t}isInSet(t){for(let s=0;s<t.length;s++)if(t[s].type==this)return t[s]}checkAttrs(t){SD(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class CD{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let s=this.spec={};for(let h in t)s[h]=t[h];s.nodes=La.from(t.nodes),s.marks=La.from(t.marks||{}),this.nodes=pM.compile(this.spec.nodes,this),this.marks=I1.compile(this.spec.marks,this);let l=Object.create(null);for(let h in this.nodes){if(h in this.marks)throw new RangeError(h+" can not be both a node and a mark");let m=this.nodes[h],v=m.spec.content||"",i=m.spec.marks;if(m.contentMatch=l[v]||(l[v]=yg.parse(v,this.nodes)),m.inlineContent=m.contentMatch.inlineContent,m.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!m.isInline||!m.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=m}m.markSet=i=="_"?null:i?mM(this,i.split(" ")):i==""||!m.inlineContent?[]:null}for(let h in this.marks){let m=this.marks[h],v=m.spec.excludes;m.excluded=v==null?[m]:v==""?[]:mM(this,v.split(" "))}this.nodeFromJSON=h=>Gp.fromJSON(this,h),this.markFromJSON=h=>_s.fromJSON(this,h),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,s=null,l,h){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof pM){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(s,l,h)}text(t,s){let l=this.nodes.text;return new E0(l,l.defaultAttrs,t,_s.setFrom(s))}mark(t,s){return typeof t=="string"&&(t=this.marks[t]),t.create(s)}nodeType(t){let s=this.nodes[t];if(!s)throw new RangeError("Unknown node type: "+t);return s}}function mM(r,t){let s=[];for(let l=0;l<t.length;l++){let h=t[l],m=r.marks[h],v=m;if(m)s.push(m);else for(let i in r.marks){let A=r.marks[i];(h=="_"||A.spec.group&&A.spec.group.split(" ").indexOf(h)>-1)&&s.push(v=A)}if(!v)throw new SyntaxError("Unknown mark type: '"+t[l]+"'")}return s}function eH(r){return r.tag!=null}function tH(r){return r.style!=null}class qp{constructor(t,s){this.schema=t,this.rules=s,this.tags=[],this.styles=[];let l=this.matchedStyles=[];s.forEach(h=>{if(eH(h))this.tags.push(h);else if(tH(h)){let m=/[^=]*/.exec(h.style)[0];l.indexOf(m)<0&&l.push(m),this.styles.push(h)}}),this.normalizeLists=!this.tags.some(h=>{if(!/^(ul|ol)\b/.test(h.tag)||!h.node)return!1;let m=t.nodes[h.node];return m.contentMatch.matchType(m)})}parse(t,s={}){let l=new yM(this,s,!1);return l.addAll(t,_s.none,s.from,s.to),l.finish()}parseSlice(t,s={}){let l=new yM(this,s,!0);return l.addAll(t,_s.none,s.from,s.to),Yr.maxOpen(l.finish())}matchTag(t,s,l){for(let h=l?this.tags.indexOf(l)+1:0;h<this.tags.length;h++){let m=this.tags[h];if(iH(t,m.tag)&&(m.namespace===void 0||t.namespaceURI==m.namespace)&&(!m.context||s.matchesContext(m.context))){if(m.getAttrs){let v=m.getAttrs(t);if(v===!1)continue;m.attrs=v||void 0}return m}}}matchStyle(t,s,l,h){for(let m=h?this.styles.indexOf(h)+1:0;m<this.styles.length;m++){let v=this.styles[m],i=v.style;if(!(i.indexOf(t)!=0||v.context&&!l.matchesContext(v.context)||i.length>t.length&&(i.charCodeAt(t.length)!=61||i.slice(t.length+1)!=s))){if(v.getAttrs){let A=v.getAttrs(s);if(A===!1)continue;v.attrs=A||void 0}return v}}}static schemaRules(t){let s=[];function l(h){let m=h.priority==null?50:h.priority,v=0;for(;v<s.length;v++){let i=s[v];if((i.priority==null?50:i.priority)<m)break}s.splice(v,0,h)}for(let h in t.marks){let m=t.marks[h].spec.parseDOM;m&&m.forEach(v=>{l(v=_M(v)),v.mark||v.ignore||v.clearMark||(v.mark=h)})}for(let h in t.nodes){let m=t.nodes[h].spec.parseDOM;m&&m.forEach(v=>{l(v=_M(v)),v.node||v.ignore||v.mark||(v.node=h)})}return s}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new qp(t,qp.schemaRules(t)))}}const AD={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},rH={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ID={ol:!0,ul:!0},nx=1,RS=2,U_=4;function gM(r,t,s){return t!=null?(t?nx:0)|(t==="full"?RS:0):r&&r.whitespace=="pre"?nx|RS:s&~U_}class Cv{constructor(t,s,l,h,m,v){this.type=t,this.attrs=s,this.marks=l,this.solid=h,this.options=v,this.content=[],this.activeMarks=_s.none,this.match=m||(v&U_?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let s=this.type.contentMatch.fillBefore(dr.from(t));if(s)this.match=this.type.contentMatch.matchFragment(s);else{let l=this.type.contentMatch,h;return(h=l.findWrapping(t.type))?(this.match=l,h):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&nx)){let l=this.content[this.content.length-1],h;if(l&&l.isText&&(h=/[ \t\r\n\u000c]+$/.exec(l.text))){let m=l;l.text.length==h[0].length?this.content.pop():this.content[this.content.length-1]=m.withText(m.text.slice(0,m.text.length-h[0].length))}}let s=dr.from(this.content);return!t&&this.match&&(s=s.append(this.match.fillBefore(dr.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!AD.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class yM{constructor(t,s,l){this.parser=t,this.options=s,this.isOpen=l,this.open=0,this.localPreserveWS=!1;let h=s.topNode,m,v=gM(null,s.preserveWhitespace,0)|(l?U_:0);h?m=new Cv(h.type,h.attrs,_s.none,!0,s.topMatch||h.type.contentMatch,v):l?m=new Cv(null,null,_s.none,!0,null,v):m=new Cv(t.schema.topNodeType,null,_s.none,!0,null,v),this.nodes=[m],this.find=s.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,s){t.nodeType==3?this.addTextNode(t,s):t.nodeType==1&&this.addElement(t,s)}addTextNode(t,s){let l=t.nodeValue,h=this.top,m=h.options&RS?"full":this.localPreserveWS||(h.options&nx)>0;if(m==="full"||h.inlineContext(t)||/[^ \t\r\n\u000c]/.test(l)){if(m)m!=="full"?l=l.replace(/\r?\n|\r/g," "):l=l.replace(/\r\n?/g,`
`);else if(l=l.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(l)&&this.open==this.nodes.length-1){let v=h.content[h.content.length-1],i=t.previousSibling;(!v||i&&i.nodeName=="BR"||v.isText&&/[ \t\r\n\u000c]$/.test(v.text))&&(l=l.slice(1))}l&&this.insertNode(this.parser.schema.text(l),s,!/\S/.test(l)),this.findInText(t)}else this.findInside(t)}addElement(t,s,l){let h=this.localPreserveWS,m=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let v=t.nodeName.toLowerCase(),i;ID.hasOwnProperty(v)&&this.parser.normalizeLists&&nH(t);let A=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,l));e:if(A?A.ignore:rH.hasOwnProperty(v))this.findInside(t),this.ignoreFallback(t,s);else if(!A||A.skip||A.closeParent){A&&A.closeParent?this.open=Math.max(0,this.open-1):A&&A.skip.nodeType&&(t=A.skip);let P,D=this.needsBlock;if(AD.hasOwnProperty(v))m.content.length&&m.content[0].isInline&&this.open&&(this.open--,m=this.top),P=!0,m.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,s);break e}let F=A&&A.skip?s:this.readStyles(t,s);F&&this.addAll(t,F),P&&this.sync(m),this.needsBlock=D}else{let P=this.readStyles(t,s);P&&this.addElementByRule(t,A,P,A.consuming===!1?i:void 0)}this.localPreserveWS=h}leafFallback(t,s){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),s)}ignoreFallback(t,s){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),s,!0)}readStyles(t,s){let l=t.style;if(l&&l.length)for(let h=0;h<this.parser.matchedStyles.length;h++){let m=this.parser.matchedStyles[h],v=l.getPropertyValue(m);if(v)for(let i=void 0;;){let A=this.parser.matchStyle(m,v,this,i);if(!A)break;if(A.ignore)return null;if(A.clearMark?s=s.filter(P=>!A.clearMark(P)):s=s.concat(this.parser.schema.marks[A.mark].create(A.attrs)),A.consuming===!1)i=A;else break}}return s}addElementByRule(t,s,l,h){let m,v;if(s.node)if(v=this.parser.schema.nodes[s.node],v.isLeaf)this.insertNode(v.create(s.attrs),l,t.nodeName=="BR")||this.leafFallback(t,l);else{let A=this.enter(v,s.attrs||null,l,s.preserveWhitespace);A&&(m=!0,l=A)}else{let A=this.parser.schema.marks[s.mark];l=l.concat(A.create(s.attrs))}let i=this.top;if(v&&v.isLeaf)this.findInside(t);else if(h)this.addElement(t,l,h);else if(s.getContent)this.findInside(t),s.getContent(t,this.parser.schema).forEach(A=>this.insertNode(A,l,!1));else{let A=t;typeof s.contentElement=="string"?A=t.querySelector(s.contentElement):typeof s.contentElement=="function"?A=s.contentElement(t):s.contentElement&&(A=s.contentElement),this.findAround(t,A,!0),this.addAll(A,l),this.findAround(t,A,!1)}m&&this.sync(i)&&this.open--}addAll(t,s,l,h){let m=l||0;for(let v=l?t.childNodes[l]:t.firstChild,i=h==null?null:t.childNodes[h];v!=i;v=v.nextSibling,++m)this.findAtPoint(t,m),this.addDOM(v,s);this.findAtPoint(t,m)}findPlace(t,s,l){let h,m;for(let v=this.open,i=0;v>=0;v--){let A=this.nodes[v],P=A.findWrapping(t);if(P&&(!h||h.length>P.length+i)&&(h=P,m=A,!P.length))break;if(A.solid){if(l)break;i+=2}}if(!h)return null;this.sync(m);for(let v=0;v<h.length;v++)s=this.enterInner(h[v],null,s,!1);return s}insertNode(t,s,l){if(t.isInline&&this.needsBlock&&!this.top.type){let m=this.textblockFromContext();m&&(s=this.enterInner(m,null,s))}let h=this.findPlace(t,s,l);if(h){this.closeExtra();let m=this.top;m.match&&(m.match=m.match.matchType(t.type));let v=_s.none;for(let i of h.concat(t.marks))(m.type?m.type.allowsMarkType(i.type):xM(i.type,t.type))&&(v=i.addToSet(v));return m.content.push(t.mark(v)),!0}return!1}enter(t,s,l,h){let m=this.findPlace(t.create(s),l,!1);return m&&(m=this.enterInner(t,s,l,!0,h)),m}enterInner(t,s,l,h=!1,m){this.closeExtra();let v=this.top;v.match=v.match&&v.match.matchType(t);let i=gM(t,m,v.options);v.options&U_&&v.content.length==0&&(i|=U_);let A=_s.none;return l=l.filter(P=>(v.type?v.type.allowsMarkType(P.type):xM(P.type,t))?(A=P.addToSet(A),!1):!0),this.nodes.push(new Cv(t,s,A,h,null,i)),this.open++,l}closeExtra(t=!1){let s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let s=this.open;s>=0;s--){if(this.nodes[s]==t)return this.open=s,!0;this.localPreserveWS&&(this.nodes[s].options|=nx)}return!1}get currentPos(){this.closeExtra();let t=0;for(let s=this.open;s>=0;s--){let l=this.nodes[s].content;for(let h=l.length-1;h>=0;h--)t+=l[h].nodeSize;s&&t++}return t}findAtPoint(t,s){if(this.find)for(let l=0;l<this.find.length;l++)this.find[l].node==t&&this.find[l].offset==s&&(this.find[l].pos=this.currentPos)}findInside(t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)}findAround(t,s,l){if(t!=s&&this.find)for(let h=0;h<this.find.length;h++)this.find[h].pos==null&&t.nodeType==1&&t.contains(this.find[h].node)&&s.compareDocumentPosition(this.find[h].node)&(l?2:4)&&(this.find[h].pos=this.currentPos)}findInText(t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==t&&(this.find[s].pos=this.currentPos-(t.nodeValue.length-this.find[s].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let s=t.split("/"),l=this.options.context,h=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),m=-(l?l.depth+1:0)+(h?0:1),v=(i,A)=>{for(;i>=0;i--){let P=s[i];if(P==""){if(i==s.length-1||i==0)continue;for(;A>=m;A--)if(v(i-1,A))return!0;return!1}else{let D=A>0||A==0&&h?this.nodes[A].type:l&&A>=m?l.node(A-m).type:null;if(!D||D.name!=P&&!D.isInGroup(P))return!1;A--}}return!0};return v(s.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let s=t.depth;s>=0;s--){let l=t.node(s).contentMatchAt(t.indexAfter(s)).defaultType;if(l&&l.isTextblock&&l.defaultAttrs)return l}for(let s in this.parser.schema.nodes){let l=this.parser.schema.nodes[s];if(l.isTextblock&&l.defaultAttrs)return l}}}function nH(r){for(let t=r.firstChild,s=null;t;t=t.nextSibling){let l=t.nodeType==1?t.nodeName.toLowerCase():null;l&&ID.hasOwnProperty(l)&&s?(s.appendChild(t),t=s):l=="li"?s=t:l&&(s=null)}}function iH(r,t){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,t)}function _M(r){let t={};for(let s in r)t[s]=r[s];return t}function xM(r,t){let s=t.schema.nodes;for(let l in s){let h=s[l];if(!h.allowsMarkType(r))continue;let m=[],v=i=>{m.push(i);for(let A=0;A<i.edgeCount;A++){let{type:P,next:D}=i.edge(A);if(P==t||m.indexOf(D)<0&&v(D))return!0}};if(v(h.contentMatch))return!0}}class Tg{constructor(t,s){this.nodes=t,this.marks=s}serializeFragment(t,s={},l){l||(l=Ew(s).createDocumentFragment());let h=l,m=[];return t.forEach(v=>{if(m.length||v.marks.length){let i=0,A=0;for(;i<m.length&&A<v.marks.length;){let P=v.marks[A];if(!this.marks[P.type.name]){A++;continue}if(!P.eq(m[i][0])||P.type.spec.spanning===!1)break;i++,A++}for(;i<m.length;)h=m.pop()[1];for(;A<v.marks.length;){let P=v.marks[A++],D=this.serializeMark(P,v.isInline,s);D&&(m.push([P,h]),h.appendChild(D.dom),h=D.contentDOM||D.dom)}}h.appendChild(this.serializeNodeInner(v,s))}),l}serializeNodeInner(t,s){let{dom:l,contentDOM:h}=Yv(Ew(s),this.nodes[t.type.name](t),null,t.attrs);if(h){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,s,h)}return l}serializeNode(t,s={}){let l=this.serializeNodeInner(t,s);for(let h=t.marks.length-1;h>=0;h--){let m=this.serializeMark(t.marks[h],t.isInline,s);m&&((m.contentDOM||m.dom).appendChild(l),l=m.dom)}return l}serializeMark(t,s,l={}){let h=this.marks[t.type.name];return h&&Yv(Ew(l),h(t,s),null,t.attrs)}static renderSpec(t,s,l=null,h){return Yv(t,s,l,h)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Tg(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let s=vM(t.nodes);return s.text||(s.text=l=>l.text),s}static marksFromSchema(t){return vM(t.marks)}}function vM(r){let t={};for(let s in r){let l=r[s].spec.toDOM;l&&(t[s]=l)}return t}function Ew(r){return r.document||window.document}const bM=new WeakMap;function sH(r){let t=bM.get(r);return t===void 0&&bM.set(r,t=oH(r)),t}function oH(r){let t=null;function s(l){if(l&&typeof l=="object")if(Array.isArray(l))if(typeof l[0]=="string")t||(t=[]),t.push(l);else for(let h=0;h<l.length;h++)s(l[h]);else for(let h in l)s(l[h])}return s(r),t}function Yv(r,t,s,l){if(typeof t=="string")return{dom:r.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let h=t[0],m;if(typeof h!="string")throw new RangeError("Invalid array passed to renderSpec");if(l&&(m=sH(l))&&m.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let v=h.indexOf(" ");v>0&&(s=h.slice(0,v),h=h.slice(v+1));let i,A=s?r.createElementNS(s,h):r.createElement(h),P=t[1],D=1;if(P&&typeof P=="object"&&P.nodeType==null&&!Array.isArray(P)){D=2;for(let F in P)if(P[F]!=null){let $=F.indexOf(" ");$>0?A.setAttributeNS(F.slice(0,$),F.slice($+1),P[F]):F=="style"&&A.style?A.style.cssText=P[F]:A.setAttribute(F,P[F])}}for(let F=D;F<t.length;F++){let $=t[F];if($===0){if(F<t.length-1||F>D)throw new RangeError("Content hole must be the only child of its parent node");return{dom:A,contentDOM:A}}else{let{dom:K,contentDOM:J}=Yv(r,$,s,l);if(A.appendChild(K),J){if(i)throw new RangeError("Multiple content holes");i=J}}}return{dom:A,contentDOM:i}}const MD=65535,kD=Math.pow(2,16);function aH(r,t){return r+t*kD}function wM(r){return r&MD}function lH(r){return(r-(r&MD))/kD}const PD=1,RD=2,Jv=4,ND=8;class NS{constructor(t,s,l){this.pos=t,this.delInfo=s,this.recover=l}get deleted(){return(this.delInfo&ND)>0}get deletedBefore(){return(this.delInfo&(PD|Jv))>0}get deletedAfter(){return(this.delInfo&(RD|Jv))>0}get deletedAcross(){return(this.delInfo&Jv)>0}}class Cc{constructor(t,s=!1){if(this.ranges=t,this.inverted=s,!t.length&&Cc.empty)return Cc.empty}recover(t){let s=0,l=wM(t);if(!this.inverted)for(let h=0;h<l;h++)s+=this.ranges[h*3+2]-this.ranges[h*3+1];return this.ranges[l*3]+s+lH(t)}mapResult(t,s=1){return this._map(t,s,!1)}map(t,s=1){return this._map(t,s,!0)}_map(t,s,l){let h=0,m=this.inverted?2:1,v=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let A=this.ranges[i]-(this.inverted?h:0);if(A>t)break;let P=this.ranges[i+m],D=this.ranges[i+v],F=A+P;if(t<=F){let $=P?t==A?-1:t==F?1:s:s,K=A+h+($<0?0:D);if(l)return K;let J=t==(s<0?A:F)?null:aH(i/3,t-A),W=t==A?RD:t==F?PD:Jv;return(s<0?t!=A:t!=F)&&(W|=ND),new NS(K,W,J)}h+=D-P}return l?t+h:new NS(t+h,0,null)}touches(t,s){let l=0,h=wM(s),m=this.inverted?2:1,v=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let A=this.ranges[i]-(this.inverted?l:0);if(A>t)break;let P=this.ranges[i+m],D=A+P;if(t<=D&&i==h*3)return!0;l+=this.ranges[i+v]-P}return!1}forEach(t){let s=this.inverted?2:1,l=this.inverted?1:2;for(let h=0,m=0;h<this.ranges.length;h+=3){let v=this.ranges[h],i=v-(this.inverted?m:0),A=v+(this.inverted?0:m),P=this.ranges[h+s],D=this.ranges[h+l];t(i,i+P,A,A+D),m+=D-P}}invert(){return new Cc(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?Cc.empty:new Cc(t<0?[0,-t,0]:[0,0,t])}}Cc.empty=new Cc([]);class ix{constructor(t,s,l=0,h=t?t.length:0){this.mirror=s,this.from=l,this.to=h,this._maps=t||[],this.ownData=!(t||s)}get maps(){return this._maps}slice(t=0,s=this.maps.length){return new ix(this._maps,this.mirror,t,s)}appendMap(t,s){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),s!=null&&this.setMirror(this._maps.length-1,s)}appendMapping(t){for(let s=0,l=this._maps.length;s<t._maps.length;s++){let h=t.getMirror(s);this.appendMap(t._maps[s],h!=null&&h<s?l+h:void 0)}}getMirror(t){if(this.mirror){for(let s=0;s<this.mirror.length;s++)if(this.mirror[s]==t)return this.mirror[s+(s%2?-1:1)]}}setMirror(t,s){this.mirror||(this.mirror=[]),this.mirror.push(t,s)}appendMappingInverted(t){for(let s=t.maps.length-1,l=this._maps.length+t._maps.length;s>=0;s--){let h=t.getMirror(s);this.appendMap(t._maps[s].invert(),h!=null&&h>s?l-h-1:void 0)}}invert(){let t=new ix;return t.appendMappingInverted(this),t}map(t,s=1){if(this.mirror)return this._map(t,s,!0);for(let l=this.from;l<this.to;l++)t=this._maps[l].map(t,s);return t}mapResult(t,s=1){return this._map(t,s,!1)}_map(t,s,l){let h=0;for(let m=this.from;m<this.to;m++){let v=this._maps[m],i=v.mapResult(t,s);if(i.recover!=null){let A=this.getMirror(m);if(A!=null&&A>m&&A<this.to){m=A,t=this._maps[A].recover(i.recover);continue}}h|=i.delInfo,t=i.pos}return l?t:new NS(t,h,null)}}const Cw=Object.create(null);class al{getMap(){return Cc.empty}merge(t){return null}static fromJSON(t,s){if(!s||!s.stepType)throw new RangeError("Invalid input for Step.fromJSON");let l=Cw[s.stepType];if(!l)throw new RangeError(`No step type ${s.stepType} defined`);return l.fromJSON(t,s)}static jsonID(t,s){if(t in Cw)throw new RangeError("Duplicate use of step JSON ID "+t);return Cw[t]=s,s.prototype.jsonID=t,s}}class zo{constructor(t,s){this.doc=t,this.failed=s}static ok(t){return new zo(t,null)}static fail(t){return new zo(null,t)}static fromReplace(t,s,l,h){try{return zo.ok(t.replace(s,l,h))}catch(m){if(m instanceof w0)return zo.fail(m.message);throw m}}}function UT(r,t,s){let l=[];for(let h=0;h<r.childCount;h++){let m=r.child(h);m.content.size&&(m=m.copy(UT(m.content,t,m))),m.isInline&&(m=t(m,s,h)),l.push(m)}return dr.fromArray(l)}class Bp extends al{constructor(t,s,l){super(),this.from=t,this.to=s,this.mark=l}apply(t){let s=t.slice(this.from,this.to),l=t.resolve(this.from),h=l.node(l.sharedDepth(this.to)),m=new Yr(UT(s.content,(v,i)=>!v.isAtom||!i.type.allowsMarkType(this.mark.type)?v:v.mark(this.mark.addToSet(v.marks)),h),s.openStart,s.openEnd);return zo.fromReplace(t,this.from,this.to,m)}invert(){return new hh(this.from,this.to,this.mark)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deleted&&l.deleted||s.pos>=l.pos?null:new Bp(s.pos,l.pos,this.mark)}merge(t){return t instanceof Bp&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Bp(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Bp(s.from,s.to,t.markFromJSON(s.mark))}}al.jsonID("addMark",Bp);class hh extends al{constructor(t,s,l){super(),this.from=t,this.to=s,this.mark=l}apply(t){let s=t.slice(this.from,this.to),l=new Yr(UT(s.content,h=>h.mark(this.mark.removeFromSet(h.marks)),t),s.openStart,s.openEnd);return zo.fromReplace(t,this.from,this.to,l)}invert(){return new Bp(this.from,this.to,this.mark)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deleted&&l.deleted||s.pos>=l.pos?null:new hh(s.pos,l.pos,this.mark)}merge(t){return t instanceof hh&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new hh(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new hh(s.from,s.to,t.markFromJSON(s.mark))}}al.jsonID("removeMark",hh);class Vp extends al{constructor(t,s){super(),this.pos=t,this.mark=s}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at mark step's position");let l=s.type.create(s.attrs,null,this.mark.addToSet(s.marks));return zo.fromReplace(t,this.pos,this.pos+1,new Yr(dr.from(l),0,s.isLeaf?0:1))}invert(t){let s=t.nodeAt(this.pos);if(s){let l=this.mark.addToSet(s.marks);if(l.length==s.marks.length){for(let h=0;h<s.marks.length;h++)if(!s.marks[h].isInSet(l))return new Vp(this.pos,s.marks[h]);return new Vp(this.pos,this.mark)}}return new _g(this.pos,this.mark)}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new Vp(s.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Vp(s.pos,t.markFromJSON(s.mark))}}al.jsonID("addNodeMark",Vp);class _g extends al{constructor(t,s){super(),this.pos=t,this.mark=s}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at mark step's position");let l=s.type.create(s.attrs,null,this.mark.removeFromSet(s.marks));return zo.fromReplace(t,this.pos,this.pos+1,new Yr(dr.from(l),0,s.isLeaf?0:1))}invert(t){let s=t.nodeAt(this.pos);return!s||!this.mark.isInSet(s.marks)?this:new Vp(this.pos,this.mark)}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new _g(s.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new _g(s.pos,t.markFromJSON(s.mark))}}al.jsonID("removeNodeMark",_g);class ya extends al{constructor(t,s,l,h=!1){super(),this.from=t,this.to=s,this.slice=l,this.structure=h}apply(t){return this.structure&&DS(t,this.from,this.to)?zo.fail("Structure replace would overwrite content"):zo.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Cc([this.from,this.to-this.from,this.slice.size])}invert(t){return new ya(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deletedAcross&&l.deletedAcross?null:new ya(s.pos,Math.max(s.pos,l.pos),this.slice,this.structure)}merge(t){if(!(t instanceof ya)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let s=this.slice.size+t.slice.size==0?Yr.empty:new Yr(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ya(this.from,this.to+(t.to-t.from),s,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let s=this.slice.size+t.slice.size==0?Yr.empty:new Yr(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ya(t.from,this.to,s,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ya(s.from,s.to,Yr.fromJSON(t,s.slice),!!s.structure)}}al.jsonID("replace",ya);class xa extends al{constructor(t,s,l,h,m,v,i=!1){super(),this.from=t,this.to=s,this.gapFrom=l,this.gapTo=h,this.slice=m,this.insert=v,this.structure=i}apply(t){if(this.structure&&(DS(t,this.from,this.gapFrom)||DS(t,this.gapTo,this.to)))return zo.fail("Structure gap-replace would overwrite content");let s=t.slice(this.gapFrom,this.gapTo);if(s.openStart||s.openEnd)return zo.fail("Gap is not a flat range");let l=this.slice.insertAt(this.insert,s.content);return l?zo.fromReplace(t,this.from,this.to,l):zo.fail("Content does not fit in gap")}getMap(){return new Cc([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let s=this.gapTo-this.gapFrom;return new xa(this.from,this.from+this.slice.size+s,this.from+this.insert,this.from+this.insert+s,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1),h=this.from==this.gapFrom?s.pos:t.map(this.gapFrom,-1),m=this.to==this.gapTo?l.pos:t.map(this.gapTo,1);return s.deletedAcross&&l.deletedAcross||h<s.pos||m>l.pos?null:new xa(s.pos,l.pos,h,m,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number"||typeof s.gapFrom!="number"||typeof s.gapTo!="number"||typeof s.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new xa(s.from,s.to,s.gapFrom,s.gapTo,Yr.fromJSON(t,s.slice),s.insert,!!s.structure)}}al.jsonID("replaceAround",xa);function DS(r,t,s){let l=r.resolve(t),h=s-t,m=l.depth;for(;h>0&&m>0&&l.indexAfter(m)==l.node(m).childCount;)m--,h--;if(h>0){let v=l.node(m).maybeChild(l.indexAfter(m));for(;h>0;){if(!v||v.isLeaf)return!0;v=v.firstChild,h--}}return!1}function cH(r,t,s,l){let h=[],m=[],v,i;r.doc.nodesBetween(t,s,(A,P,D)=>{if(!A.isInline)return;let F=A.marks;if(!l.isInSet(F)&&D.type.allowsMarkType(l.type)){let $=Math.max(P,t),K=Math.min(P+A.nodeSize,s),J=l.addToSet(F);for(let W=0;W<F.length;W++)F[W].isInSet(J)||(v&&v.to==$&&v.mark.eq(F[W])?v.to=K:h.push(v=new hh($,K,F[W])));i&&i.to==$?i.to=K:m.push(i=new Bp($,K,l))}}),h.forEach(A=>r.step(A)),m.forEach(A=>r.step(A))}function uH(r,t,s,l){let h=[],m=0;r.doc.nodesBetween(t,s,(v,i)=>{if(!v.isInline)return;m++;let A=null;if(l instanceof I1){let P=v.marks,D;for(;D=l.isInSet(P);)(A||(A=[])).push(D),P=D.removeFromSet(P)}else l?l.isInSet(v.marks)&&(A=[l]):A=v.marks;if(A&&A.length){let P=Math.min(i+v.nodeSize,s);for(let D=0;D<A.length;D++){let F=A[D],$;for(let K=0;K<h.length;K++){let J=h[K];J.step==m-1&&F.eq(h[K].style)&&($=J)}$?($.to=P,$.step=m):h.push({style:F,from:Math.max(i,t),to:P,step:m})}}}),h.forEach(v=>r.step(new hh(v.from,v.to,v.style)))}function $T(r,t,s,l=s.contentMatch,h=!0){let m=r.doc.nodeAt(t),v=[],i=t+1;for(let A=0;A<m.childCount;A++){let P=m.child(A),D=i+P.nodeSize,F=l.matchType(P.type);if(!F)v.push(new ya(i,D,Yr.empty));else{l=F;for(let $=0;$<P.marks.length;$++)s.allowsMarkType(P.marks[$].type)||r.step(new hh(i,D,P.marks[$]));if(h&&P.isText&&s.whitespace!="pre"){let $,K=/\r?\n|\r/g,J;for(;$=K.exec(P.text);)J||(J=new Yr(dr.from(s.schema.text(" ",s.allowedMarks(P.marks))),0,0)),v.push(new ya(i+$.index,i+$.index+$[0].length,J))}}i=D}if(!l.validEnd){let A=l.fillBefore(dr.empty,!0);r.replace(i,i,new Yr(A,0,0))}for(let A=v.length-1;A>=0;A--)r.step(v[A])}function hH(r,t,s){return(t==0||r.canReplace(t,r.childCount))&&(s==r.childCount||r.canReplace(0,s))}function Fy(r){let s=r.parent.content.cutByIndex(r.startIndex,r.endIndex);for(let l=r.depth;;--l){let h=r.$from.node(l),m=r.$from.index(l),v=r.$to.indexAfter(l);if(l<r.depth&&h.canReplace(m,v,s))return l;if(l==0||h.type.spec.isolating||!hH(h,m,v))break}return null}function dH(r,t,s){let{$from:l,$to:h,depth:m}=t,v=l.before(m+1),i=h.after(m+1),A=v,P=i,D=dr.empty,F=0;for(let J=m,W=!1;J>s;J--)W||l.index(J)>0?(W=!0,D=dr.from(l.node(J).copy(D)),F++):A--;let $=dr.empty,K=0;for(let J=m,W=!1;J>s;J--)W||h.after(J+1)<h.end(J)?(W=!0,$=dr.from(h.node(J).copy($)),K++):P++;r.step(new xa(A,P,v,i,new Yr(D.append($),F,K),D.size-F,!0))}function HT(r,t,s=null,l=r){let h=fH(r,t),m=h&&pH(l,t);return m?h.map(SM).concat({type:t,attrs:s}).concat(m.map(SM)):null}function SM(r){return{type:r,attrs:null}}function fH(r,t){let{parent:s,startIndex:l,endIndex:h}=r,m=s.contentMatchAt(l).findWrapping(t);if(!m)return null;let v=m.length?m[0]:t;return s.canReplaceWith(l,h,v)?m:null}function pH(r,t){let{parent:s,startIndex:l,endIndex:h}=r,m=s.child(l),v=t.contentMatch.findWrapping(m.type);if(!v)return null;let A=(v.length?v[v.length-1]:t).contentMatch;for(let P=l;A&&P<h;P++)A=A.matchType(s.child(P).type);return!A||!A.validEnd?null:v}function mH(r,t,s){let l=dr.empty;for(let v=s.length-1;v>=0;v--){if(l.size){let i=s[v].type.contentMatch.matchFragment(l);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}l=dr.from(s[v].type.create(s[v].attrs,l))}let h=t.start,m=t.end;r.step(new xa(h,m,h,m,new Yr(l,0,0),s.length,!0))}function gH(r,t,s,l,h){if(!l.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let m=r.steps.length;r.doc.nodesBetween(t,s,(v,i)=>{let A=typeof h=="function"?h(v):h;if(v.isTextblock&&!v.hasMarkup(l,A)&&yH(r.doc,r.mapping.slice(m).map(i),l)){let P=null;if(l.schema.linebreakReplacement){let K=l.whitespace=="pre",J=!!l.contentMatch.matchType(l.schema.linebreakReplacement);K&&!J?P=!1:!K&&J&&(P=!0)}P===!1&&OD(r,v,i,m),$T(r,r.mapping.slice(m).map(i,1),l,void 0,P===null);let D=r.mapping.slice(m),F=D.map(i,1),$=D.map(i+v.nodeSize,1);return r.step(new xa(F,$,F+1,$-1,new Yr(dr.from(l.create(A,null,v.marks)),0,0),1,!0)),P===!0&&DD(r,v,i,m),!1}})}function DD(r,t,s,l){t.forEach((h,m)=>{if(h.isText){let v,i=/\r?\n|\r/g;for(;v=i.exec(h.text);){let A=r.mapping.slice(l).map(s+1+m+v.index);r.replaceWith(A,A+1,t.type.schema.linebreakReplacement.create())}}})}function OD(r,t,s,l){t.forEach((h,m)=>{if(h.type==h.type.schema.linebreakReplacement){let v=r.mapping.slice(l).map(s+1+m);r.replaceWith(v,v+1,t.type.schema.text(`
`))}})}function yH(r,t,s){let l=r.resolve(t),h=l.index();return l.parent.canReplaceWith(h,h+1,s)}function _H(r,t,s,l,h){let m=r.doc.nodeAt(t);if(!m)throw new RangeError("No node at given position");s||(s=m.type);let v=s.create(l,null,h||m.marks);if(m.isLeaf)return r.replaceWith(t,t+m.nodeSize,v);if(!s.validContent(m.content))throw new RangeError("Invalid content for node type "+s.name);r.step(new xa(t,t+m.nodeSize,t+1,t+m.nodeSize-1,new Yr(dr.from(v),0,0),1,!0))}function wf(r,t,s=1,l){let h=r.resolve(t),m=h.depth-s,v=l&&l[l.length-1]||h.parent;if(m<0||h.parent.type.spec.isolating||!h.parent.canReplace(h.index(),h.parent.childCount)||!v.type.validContent(h.parent.content.cutByIndex(h.index(),h.parent.childCount)))return!1;for(let P=h.depth-1,D=s-2;P>m;P--,D--){let F=h.node(P),$=h.index(P);if(F.type.spec.isolating)return!1;let K=F.content.cutByIndex($,F.childCount),J=l&&l[D+1];J&&(K=K.replaceChild(0,J.type.create(J.attrs)));let W=l&&l[D]||F;if(!F.canReplace($+1,F.childCount)||!W.type.validContent(K))return!1}let i=h.indexAfter(m),A=l&&l[0];return h.node(m).canReplaceWith(i,i,A?A.type:h.node(m+1).type)}function xH(r,t,s=1,l){let h=r.doc.resolve(t),m=dr.empty,v=dr.empty;for(let i=h.depth,A=h.depth-s,P=s-1;i>A;i--,P--){m=dr.from(h.node(i).copy(m));let D=l&&l[P];v=dr.from(D?D.type.create(D.attrs,v):h.node(i).copy(v))}r.step(new ya(t,t,new Yr(m.append(v),s,s),!0))}function om(r,t){let s=r.resolve(t),l=s.index();return LD(s.nodeBefore,s.nodeAfter)&&s.parent.canReplace(l,l+1)}function vH(r,t){t.content.size||r.type.compatibleContent(t.type);let s=r.contentMatchAt(r.childCount),{linebreakReplacement:l}=r.type.schema;for(let h=0;h<t.childCount;h++){let m=t.child(h),v=m.type==l?r.type.schema.nodes.text:m.type;if(s=s.matchType(v),!s||!r.type.allowsMarks(m.marks))return!1}return s.validEnd}function LD(r,t){return!!(r&&t&&!r.isLeaf&&vH(r,t))}function M1(r,t,s=-1){let l=r.resolve(t);for(let h=l.depth;;h--){let m,v,i=l.index(h);if(h==l.depth?(m=l.nodeBefore,v=l.nodeAfter):s>0?(m=l.node(h+1),i++,v=l.node(h).maybeChild(i)):(m=l.node(h).maybeChild(i-1),v=l.node(h+1)),m&&!m.isTextblock&&LD(m,v)&&l.node(h).canReplace(i,i+1))return t;if(h==0)break;t=s<0?l.before(h):l.after(h)}}function bH(r,t,s){let l=null,{linebreakReplacement:h}=r.doc.type.schema,m=r.doc.resolve(t-s),v=m.node().type;if(h&&v.inlineContent){let D=v.whitespace=="pre",F=!!v.contentMatch.matchType(h);D&&!F?l=!1:!D&&F&&(l=!0)}let i=r.steps.length;if(l===!1){let D=r.doc.resolve(t+s);OD(r,D.node(),D.before(),i)}v.inlineContent&&$T(r,t+s-1,v,m.node().contentMatchAt(m.index()),l==null);let A=r.mapping.slice(i),P=A.map(t-s);if(r.step(new ya(P,A.map(t+s,-1),Yr.empty,!0)),l===!0){let D=r.doc.resolve(P);DD(r,D.node(),D.before(),r.steps.length)}return r}function wH(r,t,s){let l=r.resolve(t);if(l.parent.canReplaceWith(l.index(),l.index(),s))return t;if(l.parentOffset==0)for(let h=l.depth-1;h>=0;h--){let m=l.index(h);if(l.node(h).canReplaceWith(m,m,s))return l.before(h+1);if(m>0)return null}if(l.parentOffset==l.parent.content.size)for(let h=l.depth-1;h>=0;h--){let m=l.indexAfter(h);if(l.node(h).canReplaceWith(m,m,s))return l.after(h+1);if(m<l.node(h).childCount)return null}return null}function zD(r,t,s){let l=r.resolve(t);if(!s.content.size)return t;let h=s.content;for(let m=0;m<s.openStart;m++)h=h.firstChild.content;for(let m=1;m<=(s.openStart==0&&s.size?2:1);m++)for(let v=l.depth;v>=0;v--){let i=v==l.depth?0:l.pos<=(l.start(v+1)+l.end(v+1))/2?-1:1,A=l.index(v)+(i>0?1:0),P=l.node(v),D=!1;if(m==1)D=P.canReplace(A,A,h);else{let F=P.contentMatchAt(A).findWrapping(h.firstChild.type);D=F&&P.canReplaceWith(A,A,F[0])}if(D)return i==0?l.pos:i<0?l.before(v+1):l.after(v+1)}return null}function k1(r,t,s=t,l=Yr.empty){if(t==s&&!l.size)return null;let h=r.resolve(t),m=r.resolve(s);return jD(h,m,l)?new ya(t,s,l):new SH(h,m,l).fit()}function jD(r,t,s){return!s.openStart&&!s.openEnd&&r.start()==t.start()&&r.parent.canReplace(r.index(),t.index(),s.content)}class SH{constructor(t,s,l){this.$from=t,this.$to=s,this.unplaced=l,this.frontier=[],this.placed=dr.empty;for(let h=0;h<=t.depth;h++){let m=t.node(h);this.frontier.push({type:m.type,match:m.contentMatchAt(t.indexAfter(h))})}for(let h=t.depth;h>0;h--)this.placed=dr.from(t.node(h).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let P=this.findFittable();P?this.placeNodes(P):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),s=this.placed.size-this.depth-this.$from.depth,l=this.$from,h=this.close(t<0?this.$to:l.doc.resolve(t));if(!h)return null;let m=this.placed,v=l.depth,i=h.depth;for(;v&&i&&m.childCount==1;)m=m.firstChild.content,v--,i--;let A=new Yr(m,v,i);return t>-1?new xa(l.pos,t,this.$to.pos,this.$to.end(),A,s):A.size||l.pos!=this.$to.pos?new ya(l.pos,h.pos,A):null}findFittable(){let t=this.unplaced.openStart;for(let s=this.unplaced.content,l=0,h=this.unplaced.openEnd;l<t;l++){let m=s.firstChild;if(s.childCount>1&&(h=0),m.type.spec.isolating&&h<=l){t=l;break}s=m.content}for(let s=1;s<=2;s++)for(let l=s==1?t:this.unplaced.openStart;l>=0;l--){let h,m=null;l?(m=Aw(this.unplaced.content,l-1).firstChild,h=m.content):h=this.unplaced.content;let v=h.firstChild;for(let i=this.depth;i>=0;i--){let{type:A,match:P}=this.frontier[i],D,F=null;if(s==1&&(v?P.matchType(v.type)||(F=P.fillBefore(dr.from(v),!1)):m&&A.compatibleContent(m.type)))return{sliceDepth:l,frontierDepth:i,parent:m,inject:F};if(s==2&&v&&(D=P.findWrapping(v.type)))return{sliceDepth:l,frontierDepth:i,parent:m,wrap:D};if(m&&P.matchType(m.type))break}}}openMore(){let{content:t,openStart:s,openEnd:l}=this.unplaced,h=Aw(t,s);return!h.childCount||h.firstChild.isLeaf?!1:(this.unplaced=new Yr(t,s+1,Math.max(l,h.size+s>=t.size-l?s+1:0)),!0)}dropNode(){let{content:t,openStart:s,openEnd:l}=this.unplaced,h=Aw(t,s);if(h.childCount<=1&&s>0){let m=t.size-s<=s+h.size;this.unplaced=new Yr(L_(t,s-1,1),s-1,m?s-1:l)}else this.unplaced=new Yr(L_(t,s,1),s,l)}placeNodes({sliceDepth:t,frontierDepth:s,parent:l,inject:h,wrap:m}){for(;this.depth>s;)this.closeFrontierNode();if(m)for(let W=0;W<m.length;W++)this.openFrontierNode(m[W]);let v=this.unplaced,i=l?l.content:v.content,A=v.openStart-t,P=0,D=[],{match:F,type:$}=this.frontier[s];if(h){for(let W=0;W<h.childCount;W++)D.push(h.child(W));F=F.matchFragment(h)}let K=i.size+t-(v.content.size-v.openEnd);for(;P<i.childCount;){let W=i.child(P),ie=F.matchType(W.type);if(!ie)break;P++,(P>1||A==0||W.content.size)&&(F=ie,D.push(FD(W.mark($.allowedMarks(W.marks)),P==1?A:0,P==i.childCount?K:-1)))}let J=P==i.childCount;J||(K=-1),this.placed=z_(this.placed,s,dr.from(D)),this.frontier[s].match=F,J&&K<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let W=0,ie=i;W<K;W++){let fe=ie.lastChild;this.frontier.push({type:fe.type,match:fe.contentMatchAt(fe.childCount)}),ie=fe.content}this.unplaced=J?t==0?Yr.empty:new Yr(L_(v.content,t-1,1),t-1,K<0?v.openEnd:t-1):new Yr(L_(v.content,t,P),v.openStart,v.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],s;if(!t.type.isTextblock||!Iw(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(s=this.findCloseLevel(this.$to))&&s.depth==this.depth)return-1;let{depth:l}=this.$to,h=this.$to.after(l);for(;l>1&&h==this.$to.end(--l);)++h;return h}findCloseLevel(t){e:for(let s=Math.min(this.depth,t.depth);s>=0;s--){let{match:l,type:h}=this.frontier[s],m=s<t.depth&&t.end(s+1)==t.pos+(t.depth-(s+1)),v=Iw(t,s,h,l,m);if(v){for(let i=s-1;i>=0;i--){let{match:A,type:P}=this.frontier[i],D=Iw(t,i,P,A,!0);if(!D||D.childCount)continue e}return{depth:s,fit:v,move:m?t.doc.resolve(t.after(s+1)):t}}}}close(t){let s=this.findCloseLevel(t);if(!s)return null;for(;this.depth>s.depth;)this.closeFrontierNode();s.fit.childCount&&(this.placed=z_(this.placed,s.depth,s.fit)),t=s.move;for(let l=s.depth+1;l<=t.depth;l++){let h=t.node(l),m=h.type.contentMatch.fillBefore(h.content,!0,t.index(l));this.openFrontierNode(h.type,h.attrs,m)}return t}openFrontierNode(t,s=null,l){let h=this.frontier[this.depth];h.match=h.match.matchType(t),this.placed=z_(this.placed,this.depth,dr.from(t.create(s,l))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let s=this.frontier.pop().match.fillBefore(dr.empty,!0);s.childCount&&(this.placed=z_(this.placed,this.frontier.length,s))}}function L_(r,t,s){return t==0?r.cutByIndex(s,r.childCount):r.replaceChild(0,r.firstChild.copy(L_(r.firstChild.content,t-1,s)))}function z_(r,t,s){return t==0?r.append(s):r.replaceChild(r.childCount-1,r.lastChild.copy(z_(r.lastChild.content,t-1,s)))}function Aw(r,t){for(let s=0;s<t;s++)r=r.firstChild.content;return r}function FD(r,t,s){if(t<=0)return r;let l=r.content;return t>1&&(l=l.replaceChild(0,FD(l.firstChild,t-1,l.childCount==1?s-1:0))),t>0&&(l=r.type.contentMatch.fillBefore(l).append(l),s<=0&&(l=l.append(r.type.contentMatch.matchFragment(l).fillBefore(dr.empty,!0)))),r.copy(l)}function Iw(r,t,s,l,h){let m=r.node(t),v=h?r.indexAfter(t):r.index(t);if(v==m.childCount&&!s.compatibleContent(m.type))return null;let i=l.fillBefore(m.content,!0,v);return i&&!TH(s,m.content,v)?i:null}function TH(r,t,s){for(let l=s;l<t.childCount;l++)if(!r.allowsMarks(t.child(l).marks))return!0;return!1}function EH(r){return r.spec.defining||r.spec.definingForContent}function CH(r,t,s,l){if(!l.size)return r.deleteRange(t,s);let h=r.doc.resolve(t),m=r.doc.resolve(s);if(jD(h,m,l))return r.step(new ya(t,s,l));let v=VD(h,r.doc.resolve(s));v[v.length-1]==0&&v.pop();let i=-(h.depth+1);v.unshift(i);for(let $=h.depth,K=h.pos-1;$>0;$--,K--){let J=h.node($).type.spec;if(J.defining||J.definingAsContext||J.isolating)break;v.indexOf($)>-1?i=$:h.before($)==K&&v.splice(1,0,-$)}let A=v.indexOf(i),P=[],D=l.openStart;for(let $=l.content,K=0;;K++){let J=$.firstChild;if(P.push(J),K==l.openStart)break;$=J.content}for(let $=D-1;$>=0;$--){let K=P[$],J=EH(K.type);if(J&&!K.sameMarkup(h.node(Math.abs(i)-1)))D=$;else if(J||!K.type.isTextblock)break}for(let $=l.openStart;$>=0;$--){let K=($+D+1)%(l.openStart+1),J=P[K];if(J)for(let W=0;W<v.length;W++){let ie=v[(W+A)%v.length],fe=!0;ie<0&&(fe=!1,ie=-ie);let Pe=h.node(ie-1),Fe=h.index(ie-1);if(Pe.canReplaceWith(Fe,Fe,J.type,J.marks))return r.replace(h.before(ie),fe?m.after(ie):s,new Yr(BD(l.content,0,l.openStart,K),K,l.openEnd))}}let F=r.steps.length;for(let $=v.length-1;$>=0&&(r.replace(t,s,l),!(r.steps.length>F));$--){let K=v[$];K<0||(t=h.before(K),s=m.after(K))}}function BD(r,t,s,l,h){if(t<s){let m=r.firstChild;r=r.replaceChild(0,m.copy(BD(m.content,t+1,s,l,m)))}if(t>l){let m=h.contentMatchAt(0),v=m.fillBefore(r).append(r);r=v.append(m.matchFragment(v).fillBefore(dr.empty,!0))}return r}function AH(r,t,s,l){if(!l.isInline&&t==s&&r.doc.resolve(t).parent.content.size){let h=wH(r.doc,t,l.type);h!=null&&(t=s=h)}r.replaceRange(t,s,new Yr(dr.from(l),0,0))}function IH(r,t,s){let l=r.doc.resolve(t),h=r.doc.resolve(s),m=VD(l,h);for(let v=0;v<m.length;v++){let i=m[v],A=v==m.length-1;if(A&&i==0||l.node(i).type.contentMatch.validEnd)return r.delete(l.start(i),h.end(i));if(i>0&&(A||l.node(i-1).canReplace(l.index(i-1),h.indexAfter(i-1))))return r.delete(l.before(i),h.after(i))}for(let v=1;v<=l.depth&&v<=h.depth;v++)if(t-l.start(v)==l.depth-v&&s>l.end(v)&&h.end(v)-s!=h.depth-v&&l.start(v-1)==h.start(v-1)&&l.node(v-1).canReplace(l.index(v-1),h.index(v-1)))return r.delete(l.before(v),s);r.delete(t,s)}function VD(r,t){let s=[],l=Math.min(r.depth,t.depth);for(let h=l;h>=0;h--){let m=r.start(h);if(m<r.pos-(r.depth-h)||t.end(h)>t.pos+(t.depth-h)||r.node(h).type.spec.isolating||t.node(h).type.spec.isolating)break;(m==t.start(h)||h==r.depth&&h==t.depth&&r.parent.inlineContent&&t.parent.inlineContent&&h&&t.start(h-1)==m-1)&&s.push(h)}return s}class _y extends al{constructor(t,s,l){super(),this.pos=t,this.attr=s,this.value=l}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at attribute step's position");let l=Object.create(null);for(let m in s.attrs)l[m]=s.attrs[m];l[this.attr]=this.value;let h=s.type.create(l,null,s.marks);return zo.fromReplace(t,this.pos,this.pos+1,new Yr(dr.from(h),0,s.isLeaf?0:1))}getMap(){return Cc.empty}invert(t){return new _y(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new _y(s.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,s){if(typeof s.pos!="number"||typeof s.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new _y(s.pos,s.attr,s.value)}}al.jsonID("attr",_y);class sx extends al{constructor(t,s){super(),this.attr=t,this.value=s}apply(t){let s=Object.create(null);for(let h in t.attrs)s[h]=t.attrs[h];s[this.attr]=this.value;let l=t.type.create(s,t.content,t.marks);return zo.ok(l)}getMap(){return Cc.empty}invert(t){return new sx(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,s){if(typeof s.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new sx(s.attr,s.value)}}al.jsonID("docAttr",sx);let Sy=class extends Error{};Sy=function r(t){let s=Error.call(this,t);return s.__proto__=r.prototype,s};Sy.prototype=Object.create(Error.prototype);Sy.prototype.constructor=Sy;Sy.prototype.name="TransformError";class UD{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new ix}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let s=this.maybeStep(t);if(s.failed)throw new Sy(s.failed);return this}maybeStep(t){let s=t.apply(this.doc);return s.failed||this.addStep(t,s.doc),s}get docChanged(){return this.steps.length>0}addStep(t,s){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=s}replace(t,s=t,l=Yr.empty){let h=k1(this.doc,t,s,l);return h&&this.step(h),this}replaceWith(t,s,l){return this.replace(t,s,new Yr(dr.from(l),0,0))}delete(t,s){return this.replace(t,s,Yr.empty)}insert(t,s){return this.replaceWith(t,t,s)}replaceRange(t,s,l){return CH(this,t,s,l),this}replaceRangeWith(t,s,l){return AH(this,t,s,l),this}deleteRange(t,s){return IH(this,t,s),this}lift(t,s){return dH(this,t,s),this}join(t,s=1){return bH(this,t,s),this}wrap(t,s){return mH(this,t,s),this}setBlockType(t,s=t,l,h=null){return gH(this,t,s,l,h),this}setNodeMarkup(t,s,l=null,h){return _H(this,t,s,l,h),this}setNodeAttribute(t,s,l){return this.step(new _y(t,s,l)),this}setDocAttribute(t,s){return this.step(new sx(t,s)),this}addNodeMark(t,s){return this.step(new Vp(t,s)),this}removeNodeMark(t,s){let l=this.doc.nodeAt(t);if(!l)throw new RangeError("No node at position "+t);if(s instanceof _s)s.isInSet(l.marks)&&this.step(new _g(t,s));else{let h=l.marks,m,v=[];for(;m=s.isInSet(h);)v.push(new _g(t,m)),h=m.removeFromSet(h);for(let i=v.length-1;i>=0;i--)this.step(v[i])}return this}split(t,s=1,l){return xH(this,t,s,l),this}addMark(t,s,l){return cH(this,t,s,l),this}removeMark(t,s,l){return uH(this,t,s,l),this}clearIncompatible(t,s,l){return $T(this,t,s,l),this}}const Mw=Object.create(null);class xi{constructor(t,s,l){this.$anchor=t,this.$head=s,this.ranges=l||[new MH(t.min(s),t.max(s))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let s=0;s<t.length;s++)if(t[s].$from.pos!=t[s].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,s=Yr.empty){let l=s.content.lastChild,h=null;for(let i=0;i<s.openEnd;i++)h=l,l=l.lastChild;let m=t.steps.length,v=this.ranges;for(let i=0;i<v.length;i++){let{$from:A,$to:P}=v[i],D=t.mapping.slice(m);t.replaceRange(D.map(A.pos),D.map(P.pos),i?Yr.empty:s),i==0&&CM(t,m,(l?l.isInline:h&&h.isTextblock)?-1:1)}}replaceWith(t,s){let l=t.steps.length,h=this.ranges;for(let m=0;m<h.length;m++){let{$from:v,$to:i}=h[m],A=t.mapping.slice(l),P=A.map(v.pos),D=A.map(i.pos);m?t.deleteRange(P,D):(t.replaceRangeWith(P,D,s),CM(t,l,s.isInline?-1:1))}}static findFrom(t,s,l=!1){let h=t.parent.inlineContent?new ti(t):cy(t.node(0),t.parent,t.pos,t.index(),s,l);if(h)return h;for(let m=t.depth-1;m>=0;m--){let v=s<0?cy(t.node(0),t.node(m),t.before(m+1),t.index(m),s,l):cy(t.node(0),t.node(m),t.after(m+1),t.index(m)+1,s,l);if(v)return v}return null}static near(t,s=1){return this.findFrom(t,s)||this.findFrom(t,-s)||new Ic(t.node(0))}static atStart(t){return cy(t,t,0,0,1)||new Ic(t)}static atEnd(t){return cy(t,t,t.content.size,t.childCount,-1)||new Ic(t)}static fromJSON(t,s){if(!s||!s.type)throw new RangeError("Invalid input for Selection.fromJSON");let l=Mw[s.type];if(!l)throw new RangeError(`No selection type ${s.type} defined`);return l.fromJSON(t,s)}static jsonID(t,s){if(t in Mw)throw new RangeError("Duplicate use of selection JSON ID "+t);return Mw[t]=s,s.prototype.jsonID=t,s}getBookmark(){return ti.between(this.$anchor,this.$head).getBookmark()}}xi.prototype.visible=!0;class MH{constructor(t,s){this.$from=t,this.$to=s}}let TM=!1;function EM(r){!TM&&!r.parent.inlineContent&&(TM=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+r.parent.type.name+")"))}class ti extends xi{constructor(t,s=t){EM(t),EM(s),super(t,s)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,s){let l=t.resolve(s.map(this.head));if(!l.parent.inlineContent)return xi.near(l);let h=t.resolve(s.map(this.anchor));return new ti(h.parent.inlineContent?h:l,l)}replace(t,s=Yr.empty){if(super.replace(t,s),s==Yr.empty){let l=this.$from.marksAcross(this.$to);l&&t.ensureMarks(l)}}eq(t){return t instanceof ti&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new P1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,s){if(typeof s.anchor!="number"||typeof s.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ti(t.resolve(s.anchor),t.resolve(s.head))}static create(t,s,l=s){let h=t.resolve(s);return new this(h,l==s?h:t.resolve(l))}static between(t,s,l){let h=t.pos-s.pos;if((!l||h)&&(l=h>=0?1:-1),!s.parent.inlineContent){let m=xi.findFrom(s,l,!0)||xi.findFrom(s,-l,!0);if(m)s=m.$head;else return xi.near(s,l)}return t.parent.inlineContent||(h==0?t=s:(t=(xi.findFrom(t,-l,!0)||xi.findFrom(t,l,!0)).$anchor,t.pos<s.pos!=h<0&&(t=s))),new ti(t,s)}}xi.jsonID("text",ti);class P1{constructor(t,s){this.anchor=t,this.head=s}map(t){return new P1(t.map(this.anchor),t.map(this.head))}resolve(t){return ti.between(t.resolve(this.anchor),t.resolve(this.head))}}class kn extends xi{constructor(t){let s=t.nodeAfter,l=t.node(0).resolve(t.pos+s.nodeSize);super(t,l),this.node=s}map(t,s){let{deleted:l,pos:h}=s.mapResult(this.anchor),m=t.resolve(h);return l?xi.near(m):new kn(m)}content(){return new Yr(dr.from(this.node),0,0)}eq(t){return t instanceof kn&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new GT(this.anchor)}static fromJSON(t,s){if(typeof s.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new kn(t.resolve(s.anchor))}static create(t,s){return new kn(t.resolve(s))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}kn.prototype.visible=!1;xi.jsonID("node",kn);class GT{constructor(t){this.anchor=t}map(t){let{deleted:s,pos:l}=t.mapResult(this.anchor);return s?new P1(l,l):new GT(l)}resolve(t){let s=t.resolve(this.anchor),l=s.nodeAfter;return l&&kn.isSelectable(l)?new kn(s):xi.near(s)}}class Ic extends xi{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,s=Yr.empty){if(s==Yr.empty){t.delete(0,t.doc.content.size);let l=xi.atStart(t.doc);l.eq(t.selection)||t.setSelection(l)}else super.replace(t,s)}toJSON(){return{type:"all"}}static fromJSON(t){return new Ic(t)}map(t){return new Ic(t)}eq(t){return t instanceof Ic}getBookmark(){return kH}}xi.jsonID("all",Ic);const kH={map(){return this},resolve(r){return new Ic(r)}};function cy(r,t,s,l,h,m=!1){if(t.inlineContent)return ti.create(r,s);for(let v=l-(h>0?0:1);h>0?v<t.childCount:v>=0;v+=h){let i=t.child(v);if(i.isAtom){if(!m&&kn.isSelectable(i))return kn.create(r,s-(h<0?i.nodeSize:0))}else{let A=cy(r,i,s+h,h<0?i.childCount:0,h,m);if(A)return A}s+=i.nodeSize*h}return null}function CM(r,t,s){let l=r.steps.length-1;if(l<t)return;let h=r.steps[l];if(!(h instanceof ya||h instanceof xa))return;let m=r.mapping.maps[l],v;m.forEach((i,A,P,D)=>{v==null&&(v=D)}),r.setSelection(xi.near(r.doc.resolve(v),s))}const AM=1,Av=2,IM=4;class PH extends UD{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|AM)&~Av,this.storedMarks=null,this}get selectionSet(){return(this.updated&AM)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Av,this}ensureMarks(t){return _s.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Av)>0}addStep(t,s){super.addStep(t,s),this.updated=this.updated&~Av,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,s=!0){let l=this.selection;return s&&(t=t.mark(this.storedMarks||(l.empty?l.$from.marks():l.$from.marksAcross(l.$to)||_s.none))),l.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,s,l){let h=this.doc.type.schema;if(s==null)return t?this.replaceSelectionWith(h.text(t),!0):this.deleteSelection();{if(l==null&&(l=s),l=l??s,!t)return this.deleteRange(s,l);let m=this.storedMarks;if(!m){let v=this.doc.resolve(s);m=l==s?v.marks():v.marksAcross(this.doc.resolve(l))}return this.replaceRangeWith(s,l,h.text(t,m)),this.selection.empty||this.setSelection(xi.near(this.selection.$to)),this}}setMeta(t,s){return this.meta[typeof t=="string"?t:t.key]=s,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=IM,this}get scrolledIntoView(){return(this.updated&IM)>0}}function MM(r,t){return!t||!r?r:r.bind(t)}class j_{constructor(t,s,l){this.name=t,this.init=MM(s.init,l),this.apply=MM(s.apply,l)}}const RH=[new j_("doc",{init(r){return r.doc||r.schema.topNodeType.createAndFill()},apply(r){return r.doc}}),new j_("selection",{init(r,t){return r.selection||xi.atStart(t.doc)},apply(r){return r.selection}}),new j_("storedMarks",{init(r){return r.storedMarks||null},apply(r,t,s,l){return l.selection.$cursor?r.storedMarks:null}}),new j_("scrollToSelection",{init(){return 0},apply(r,t){return r.scrolledIntoView?t+1:t}})];class kw{constructor(t,s){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=RH.slice(),s&&s.forEach(l=>{if(this.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");this.plugins.push(l),this.pluginsByKey[l.key]=l,l.spec.state&&this.fields.push(new j_(l.key,l.spec.state,l))})}}class fy{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,s=-1){for(let l=0;l<this.config.plugins.length;l++)if(l!=s){let h=this.config.plugins[l];if(h.spec.filterTransaction&&!h.spec.filterTransaction.call(h,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let s=[t],l=this.applyInner(t),h=null;for(;;){let m=!1;for(let v=0;v<this.config.plugins.length;v++){let i=this.config.plugins[v];if(i.spec.appendTransaction){let A=h?h[v].n:0,P=h?h[v].state:this,D=A<s.length&&i.spec.appendTransaction.call(i,A?s.slice(A):s,P,l);if(D&&l.filterTransaction(D,v)){if(D.setMeta("appendedTransaction",t),!h){h=[];for(let F=0;F<this.config.plugins.length;F++)h.push(F<v?{state:l,n:s.length}:{state:this,n:0})}s.push(D),l=l.applyInner(D),m=!0}h&&(h[v]={state:l,n:s.length})}}if(!m)return{state:l,transactions:s}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let s=new fy(this.config),l=this.config.fields;for(let h=0;h<l.length;h++){let m=l[h];s[m.name]=m.apply(t,this[m.name],this,s)}return s}get tr(){return new PH(this)}static create(t){let s=new kw(t.doc?t.doc.type.schema:t.schema,t.plugins),l=new fy(s);for(let h=0;h<s.fields.length;h++)l[s.fields[h].name]=s.fields[h].init(t,l);return l}reconfigure(t){let s=new kw(this.schema,t.plugins),l=s.fields,h=new fy(s);for(let m=0;m<l.length;m++){let v=l[m].name;h[v]=this.hasOwnProperty(v)?this[v]:l[m].init(t,h)}return h}toJSON(t){let s={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(s.storedMarks=this.storedMarks.map(l=>l.toJSON())),t&&typeof t=="object")for(let l in t){if(l=="doc"||l=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let h=t[l],m=h.spec.state;m&&m.toJSON&&(s[l]=m.toJSON.call(h,this[h.key]))}return s}static fromJSON(t,s,l){if(!s)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let h=new kw(t.schema,t.plugins),m=new fy(h);return h.fields.forEach(v=>{if(v.name=="doc")m.doc=Gp.fromJSON(t.schema,s.doc);else if(v.name=="selection")m.selection=xi.fromJSON(m.doc,s.selection);else if(v.name=="storedMarks")s.storedMarks&&(m.storedMarks=s.storedMarks.map(t.schema.markFromJSON));else{if(l)for(let i in l){let A=l[i],P=A.spec.state;if(A.key==v.name&&P&&P.fromJSON&&Object.prototype.hasOwnProperty.call(s,i)){m[v.name]=P.fromJSON.call(A,t,s[i],m);return}}m[v.name]=v.init(t,m)}}),m}}function $D(r,t,s){for(let l in r){let h=r[l];h instanceof Function?h=h.bind(t):l=="handleDOMEvents"&&(h=$D(h,t,{})),s[l]=h}return s}class po{constructor(t){this.spec=t,this.props={},t.props&&$D(t.props,this,this.props),this.key=t.key?t.key.key:HD("plugin")}getState(t){return t[this.key]}}const Pw=Object.create(null);function HD(r){return r in Pw?r+"$"+ ++Pw[r]:(Pw[r]=0,r+"$")}class ba{constructor(t="key"){this.key=HD(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const za=function(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t},Ty=function(r){let t=r.assignedSlot||r.parentNode;return t&&t.nodeType==11?t.host:t};let OS=null;const vf=function(r,t,s){let l=OS||(OS=document.createRange());return l.setEnd(r,s??r.nodeValue.length),l.setStart(r,t||0),l},NH=function(){OS=null},xg=function(r,t,s,l){return s&&(kM(r,t,s,l,-1)||kM(r,t,s,l,1))},DH=/^(img|br|input|textarea|hr)$/i;function kM(r,t,s,l,h){for(var m;;){if(r==s&&t==l)return!0;if(t==(h<0?0:mu(r))){let v=r.parentNode;if(!v||v.nodeType!=1||vx(r)||DH.test(r.nodeName)||r.contentEditable=="false")return!1;t=za(r)+(h<0?0:1),r=v}else if(r.nodeType==1){let v=r.childNodes[t+(h<0?-1:0)];if(v.nodeType==1&&v.contentEditable=="false")if(!((m=v.pmViewDesc)===null||m===void 0)&&m.ignoreForSelection)t+=h;else return!1;else r=v,t=h<0?mu(r):0}else return!1}}function mu(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function OH(r,t){for(;;){if(r.nodeType==3&&t)return r;if(r.nodeType==1&&t>0){if(r.contentEditable=="false")return null;r=r.childNodes[t-1],t=mu(r)}else if(r.parentNode&&!vx(r))t=za(r),r=r.parentNode;else return null}}function LH(r,t){for(;;){if(r.nodeType==3&&t<r.nodeValue.length)return r;if(r.nodeType==1&&t<r.childNodes.length){if(r.contentEditable=="false")return null;r=r.childNodes[t],t=0}else if(r.parentNode&&!vx(r))t=za(r)+1,r=r.parentNode;else return null}}function zH(r,t,s){for(let l=t==0,h=t==mu(r);l||h;){if(r==s)return!0;let m=za(r);if(r=r.parentNode,!r)return!1;l=l&&m==0,h=h&&m==mu(r)}}function vx(r){let t;for(let s=r;s&&!(t=s.pmViewDesc);s=s.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==r||t.contentDOM==r)}const R1=function(r){return r.focusNode&&xg(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset)};function Jm(r,t){let s=document.createEvent("Event");return s.initEvent("keydown",!0,!0),s.keyCode=r,s.key=s.code=t,s}function jH(r){let t=r.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function FH(r,t,s){if(r.caretPositionFromPoint)try{let l=r.caretPositionFromPoint(t,s);if(l)return{node:l.offsetNode,offset:Math.min(mu(l.offsetNode),l.offset)}}catch{}if(r.caretRangeFromPoint){let l=r.caretRangeFromPoint(t,s);if(l)return{node:l.startContainer,offset:Math.min(mu(l.startContainer),l.startOffset)}}}const _d=typeof navigator<"u"?navigator:null,PM=typeof document<"u"?document:null,am=_d&&_d.userAgent||"",LS=/Edge\/(\d+)/.exec(am),GD=/MSIE \d/.exec(am),zS=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(am),Yl=!!(GD||zS||LS),Wp=GD?document.documentMode:zS?+zS[1]:LS?+LS[1]:0,ph=!Yl&&/gecko\/(\d+)/i.test(am);ph&&+(/Firefox\/(\d+)/.exec(am)||[0,0])[1];const jS=!Yl&&/Chrome\/(\d+)/.exec(am),il=!!jS,qD=jS?+jS[1]:0,wl=!Yl&&!!_d&&/Apple Computer/.test(_d.vendor),Ey=wl&&(/Mobile\/\w+/.test(am)||!!_d&&_d.maxTouchPoints>2),pu=Ey||(_d?/Mac/.test(_d.platform):!1),BH=_d?/Win/.test(_d.platform):!1,bf=/Android \d/.test(am),bx=!!PM&&"webkitFontSmoothing"in PM.documentElement.style,VH=bx?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function UH(r){let t=r.defaultView&&r.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function gf(r,t){return typeof r=="number"?r:r[t]}function $H(r){let t=r.getBoundingClientRect(),s=t.width/r.offsetWidth||1,l=t.height/r.offsetHeight||1;return{left:t.left,right:t.left+r.clientWidth*s,top:t.top,bottom:t.top+r.clientHeight*l}}function RM(r,t,s){let l=r.someProp("scrollThreshold")||0,h=r.someProp("scrollMargin")||5,m=r.dom.ownerDocument;for(let v=s||r.dom;v;){if(v.nodeType!=1){v=Ty(v);continue}let i=v,A=i==m.body,P=A?UH(m):$H(i),D=0,F=0;if(t.top<P.top+gf(l,"top")?F=-(P.top-t.top+gf(h,"top")):t.bottom>P.bottom-gf(l,"bottom")&&(F=t.bottom-t.top>P.bottom-P.top?t.top+gf(h,"top")-P.top:t.bottom-P.bottom+gf(h,"bottom")),t.left<P.left+gf(l,"left")?D=-(P.left-t.left+gf(h,"left")):t.right>P.right-gf(l,"right")&&(D=t.right-P.right+gf(h,"right")),D||F)if(A)m.defaultView.scrollBy(D,F);else{let K=i.scrollLeft,J=i.scrollTop;F&&(i.scrollTop+=F),D&&(i.scrollLeft+=D);let W=i.scrollLeft-K,ie=i.scrollTop-J;t={left:t.left-W,top:t.top-ie,right:t.right-W,bottom:t.bottom-ie}}let $=A?"fixed":getComputedStyle(v).position;if(/^(fixed|sticky)$/.test($))break;v=$=="absolute"?v.offsetParent:Ty(v)}}function HH(r){let t=r.dom.getBoundingClientRect(),s=Math.max(0,t.top),l,h;for(let m=(t.left+t.right)/2,v=s+1;v<Math.min(innerHeight,t.bottom);v+=5){let i=r.root.elementFromPoint(m,v);if(!i||i==r.dom||!r.dom.contains(i))continue;let A=i.getBoundingClientRect();if(A.top>=s-20){l=i,h=A.top;break}}return{refDOM:l,refTop:h,stack:WD(r.dom)}}function WD(r){let t=[],s=r.ownerDocument;for(let l=r;l&&(t.push({dom:l,top:l.scrollTop,left:l.scrollLeft}),r!=s);l=Ty(l));return t}function GH({refDOM:r,refTop:t,stack:s}){let l=r?r.getBoundingClientRect().top:0;ZD(s,l==0?0:l-t)}function ZD(r,t){for(let s=0;s<r.length;s++){let{dom:l,top:h,left:m}=r[s];l.scrollTop!=h+t&&(l.scrollTop=h+t),l.scrollLeft!=m&&(l.scrollLeft=m)}}let ay=null;function qH(r){if(r.setActive)return r.setActive();if(ay)return r.focus(ay);let t=WD(r);r.focus(ay==null?{get preventScroll(){return ay={preventScroll:!0},!0}}:void 0),ay||(ay=!1,ZD(t,0))}function XD(r,t){let s,l=2e8,h,m=0,v=t.top,i=t.top,A,P;for(let D=r.firstChild,F=0;D;D=D.nextSibling,F++){let $;if(D.nodeType==1)$=D.getClientRects();else if(D.nodeType==3)$=vf(D).getClientRects();else continue;for(let K=0;K<$.length;K++){let J=$[K];if(J.top<=v&&J.bottom>=i){v=Math.max(J.bottom,v),i=Math.min(J.top,i);let W=J.left>t.left?J.left-t.left:J.right<t.left?t.left-J.right:0;if(W<l){s=D,l=W,h=W&&s.nodeType==3?{left:J.right<t.left?J.right:J.left,top:t.top}:t,D.nodeType==1&&W&&(m=F+(t.left>=(J.left+J.right)/2?1:0));continue}}else J.top>t.top&&!A&&J.left<=t.left&&J.right>=t.left&&(A=D,P={left:Math.max(J.left,Math.min(J.right,t.left)),top:J.top});!s&&(t.left>=J.right&&t.top>=J.top||t.left>=J.left&&t.top>=J.bottom)&&(m=F+1)}}return!s&&A&&(s=A,h=P,l=0),s&&s.nodeType==3?WH(s,h):!s||l&&s.nodeType==1?{node:r,offset:m}:XD(s,h)}function WH(r,t){let s=r.nodeValue.length,l=document.createRange();for(let h=0;h<s;h++){l.setEnd(r,h+1),l.setStart(r,h);let m=Np(l,1);if(m.top!=m.bottom&&qT(t,m))return{node:r,offset:h+(t.left>=(m.left+m.right)/2?1:0)}}return{node:r,offset:0}}function qT(r,t){return r.left>=t.left-1&&r.left<=t.right+1&&r.top>=t.top-1&&r.top<=t.bottom+1}function ZH(r,t){let s=r.parentNode;return s&&/^li$/i.test(s.nodeName)&&t.left<r.getBoundingClientRect().left?s:r}function XH(r,t,s){let{node:l,offset:h}=XD(t,s),m=-1;if(l.nodeType==1&&!l.firstChild){let v=l.getBoundingClientRect();m=v.left!=v.right&&s.left>(v.left+v.right)/2?1:-1}return r.docView.posFromDOM(l,h,m)}function KH(r,t,s,l){let h=-1;for(let m=t,v=!1;m!=r.dom;){let i=r.docView.nearestDesc(m,!0),A;if(!i)return null;if(i.dom.nodeType==1&&(i.node.isBlock&&i.parent||!i.contentDOM)&&((A=i.dom.getBoundingClientRect()).width||A.height)&&(i.node.isBlock&&i.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(i.dom.nodeName)&&(!v&&A.left>l.left||A.top>l.top?h=i.posBefore:(!v&&A.right<l.left||A.bottom<l.top)&&(h=i.posAfter),v=!0),!i.contentDOM&&h<0&&!i.node.isText))return(i.node.isBlock?l.top<(A.top+A.bottom)/2:l.left<(A.left+A.right)/2)?i.posBefore:i.posAfter;m=i.dom.parentNode}return h>-1?h:r.docView.posFromDOM(t,s,-1)}function KD(r,t,s){let l=r.childNodes.length;if(l&&s.top<s.bottom)for(let h=Math.max(0,Math.min(l-1,Math.floor(l*(t.top-s.top)/(s.bottom-s.top))-2)),m=h;;){let v=r.childNodes[m];if(v.nodeType==1){let i=v.getClientRects();for(let A=0;A<i.length;A++){let P=i[A];if(qT(t,P))return KD(v,t,P)}}if((m=(m+1)%l)==h)break}return r}function YH(r,t){let s=r.dom.ownerDocument,l,h=0,m=FH(s,t.left,t.top);m&&({node:l,offset:h}=m);let v=(r.root.elementFromPoint?r.root:s).elementFromPoint(t.left,t.top),i;if(!v||!r.dom.contains(v.nodeType!=1?v.parentNode:v)){let P=r.dom.getBoundingClientRect();if(!qT(t,P)||(v=KD(r.dom,t,P),!v))return null}if(wl)for(let P=v;l&&P;P=Ty(P))P.draggable&&(l=void 0);if(v=ZH(v,t),l){if(ph&&l.nodeType==1&&(h=Math.min(h,l.childNodes.length),h<l.childNodes.length)){let D=l.childNodes[h],F;D.nodeName=="IMG"&&(F=D.getBoundingClientRect()).right<=t.left&&F.bottom>t.top&&h++}let P;bx&&h&&l.nodeType==1&&(P=l.childNodes[h-1]).nodeType==1&&P.contentEditable=="false"&&P.getBoundingClientRect().top>=t.top&&h--,l==r.dom&&h==l.childNodes.length-1&&l.lastChild.nodeType==1&&t.top>l.lastChild.getBoundingClientRect().bottom?i=r.state.doc.content.size:(h==0||l.nodeType!=1||l.childNodes[h-1].nodeName!="BR")&&(i=KH(r,l,h,t))}i==null&&(i=XH(r,v,t));let A=r.docView.nearestDesc(v,!0);return{pos:i,inside:A?A.posAtStart-A.border:-1}}function NM(r){return r.top<r.bottom||r.left<r.right}function Np(r,t){let s=r.getClientRects();if(s.length){let l=s[t<0?0:s.length-1];if(NM(l))return l}return Array.prototype.find.call(s,NM)||r.getBoundingClientRect()}const JH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function YD(r,t,s){let{node:l,offset:h,atom:m}=r.docView.domFromPos(t,s<0?-1:1),v=bx||ph;if(l.nodeType==3)if(v&&(JH.test(l.nodeValue)||(s<0?!h:h==l.nodeValue.length))){let A=Np(vf(l,h,h),s);if(ph&&h&&/\s/.test(l.nodeValue[h-1])&&h<l.nodeValue.length){let P=Np(vf(l,h-1,h-1),-1);if(P.top==A.top){let D=Np(vf(l,h,h+1),-1);if(D.top!=A.top)return R_(D,D.left<P.left)}}return A}else{let A=h,P=h,D=s<0?1:-1;return s<0&&!h?(P++,D=-1):s>=0&&h==l.nodeValue.length?(A--,D=1):s<0?A--:P++,R_(Np(vf(l,A,P),D),D<0)}if(!r.state.doc.resolve(t-(m||0)).parent.inlineContent){if(m==null&&h&&(s<0||h==mu(l))){let A=l.childNodes[h-1];if(A.nodeType==1)return Rw(A.getBoundingClientRect(),!1)}if(m==null&&h<mu(l)){let A=l.childNodes[h];if(A.nodeType==1)return Rw(A.getBoundingClientRect(),!0)}return Rw(l.getBoundingClientRect(),s>=0)}if(m==null&&h&&(s<0||h==mu(l))){let A=l.childNodes[h-1],P=A.nodeType==3?vf(A,mu(A)-(v?0:1)):A.nodeType==1&&(A.nodeName!="BR"||!A.nextSibling)?A:null;if(P)return R_(Np(P,1),!1)}if(m==null&&h<mu(l)){let A=l.childNodes[h];for(;A.pmViewDesc&&A.pmViewDesc.ignoreForCoords;)A=A.nextSibling;let P=A?A.nodeType==3?vf(A,0,v?0:1):A.nodeType==1?A:null:null;if(P)return R_(Np(P,-1),!0)}return R_(Np(l.nodeType==3?vf(l):l,-s),s>=0)}function R_(r,t){if(r.width==0)return r;let s=t?r.left:r.right;return{top:r.top,bottom:r.bottom,left:s,right:s}}function Rw(r,t){if(r.height==0)return r;let s=t?r.top:r.bottom;return{top:s,bottom:s,left:r.left,right:r.right}}function JD(r,t,s){let l=r.state,h=r.root.activeElement;l!=t&&r.updateState(t),h!=r.dom&&r.focus();try{return s()}finally{l!=t&&r.updateState(l),h!=r.dom&&h&&h.focus()}}function QH(r,t,s){let l=t.selection,h=s=="up"?l.$from:l.$to;return JD(r,t,()=>{let{node:m}=r.docView.domFromPos(h.pos,s=="up"?-1:1);for(;;){let i=r.docView.nearestDesc(m,!0);if(!i)break;if(i.node.isBlock){m=i.contentDOM||i.dom;break}m=i.dom.parentNode}let v=YD(r,h.pos,1);for(let i=m.firstChild;i;i=i.nextSibling){let A;if(i.nodeType==1)A=i.getClientRects();else if(i.nodeType==3)A=vf(i,0,i.nodeValue.length).getClientRects();else continue;for(let P=0;P<A.length;P++){let D=A[P];if(D.bottom>D.top+1&&(s=="up"?v.top-D.top>(D.bottom-v.top)*2:D.bottom-v.bottom>(v.bottom-D.top)*2))return!1}}return!0})}const eG=/[\u0590-\u08ac]/;function tG(r,t,s){let{$head:l}=t.selection;if(!l.parent.isTextblock)return!1;let h=l.parentOffset,m=!h,v=h==l.parent.content.size,i=r.domSelection();return i?!eG.test(l.parent.textContent)||!i.modify?s=="left"||s=="backward"?m:v:JD(r,t,()=>{let{focusNode:A,focusOffset:P,anchorNode:D,anchorOffset:F}=r.domSelectionRange(),$=i.caretBidiLevel;i.modify("move",s,"character");let K=l.depth?r.docView.domAfterPos(l.before()):r.dom,{focusNode:J,focusOffset:W}=r.domSelectionRange(),ie=J&&!K.contains(J.nodeType==1?J:J.parentNode)||A==J&&P==W;try{i.collapse(D,F),A&&(A!=D||P!=F)&&i.extend&&i.extend(A,P)}catch{}return $!=null&&(i.caretBidiLevel=$),ie}):l.pos==l.start()||l.pos==l.end()}let DM=null,OM=null,LM=!1;function rG(r,t,s){return DM==t&&OM==s?LM:(DM=t,OM=s,LM=s=="up"||s=="down"?QH(r,t,s):tG(r,t,s))}const gu=0,zM=1,Qm=2,xd=3;class wx{constructor(t,s,l,h){this.parent=t,this.children=s,this.dom=l,this.contentDOM=h,this.dirty=gu,l.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,s,l){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let s=0;s<this.children.length;s++)t+=this.children[s].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let s=0,l=this.posAtStart;;s++){let h=this.children[s];if(h==t)return l;l+=h.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,s,l){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(l<0){let m,v;if(t==this.contentDOM)m=t.childNodes[s-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;m=t.previousSibling}for(;m&&!((v=m.pmViewDesc)&&v.parent==this);)m=m.previousSibling;return m?this.posBeforeChild(v)+v.size:this.posAtStart}else{let m,v;if(t==this.contentDOM)m=t.childNodes[s];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;m=t.nextSibling}for(;m&&!((v=m.pmViewDesc)&&v.parent==this);)m=m.nextSibling;return m?this.posBeforeChild(v):this.posAtEnd}let h;if(t==this.dom&&this.contentDOM)h=s>za(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))h=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(s==0)for(let m=t;;m=m.parentNode){if(m==this.dom){h=!1;break}if(m.previousSibling)break}if(h==null&&s==t.childNodes.length)for(let m=t;;m=m.parentNode){if(m==this.dom){h=!0;break}if(m.nextSibling)break}}return h??l>0?this.posAtEnd:this.posAtStart}nearestDesc(t,s=!1){for(let l=!0,h=t;h;h=h.parentNode){let m=this.getDesc(h),v;if(m&&(!s||m.node))if(l&&(v=m.nodeDOM)&&!(v.nodeType==1?v.contains(t.nodeType==1?t:t.parentNode):v==t))l=!1;else return m}}getDesc(t){let s=t.pmViewDesc;for(let l=s;l;l=l.parent)if(l==this)return s}posFromDOM(t,s,l){for(let h=t;h;h=h.parentNode){let m=this.getDesc(h);if(m)return m.localPosFromDOM(t,s,l)}return-1}descAt(t){for(let s=0,l=0;s<this.children.length;s++){let h=this.children[s],m=l+h.size;if(l==t&&m!=l){for(;!h.border&&h.children.length;)for(let v=0;v<h.children.length;v++){let i=h.children[v];if(i.size){h=i;break}}return h}if(t<m)return h.descAt(t-l-h.border);l=m}}domFromPos(t,s){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let l=0,h=0;for(let m=0;l<this.children.length;l++){let v=this.children[l],i=m+v.size;if(i>t||v instanceof eO){h=t-m;break}m=i}if(h)return this.children[l].domFromPos(h-this.children[l].border,s);for(let m;l&&!(m=this.children[l-1]).size&&m instanceof QD&&m.side>=0;l--);if(s<=0){let m,v=!0;for(;m=l?this.children[l-1]:null,!(!m||m.dom.parentNode==this.contentDOM);l--,v=!1);return m&&s&&v&&!m.border&&!m.domAtom?m.domFromPos(m.size,s):{node:this.contentDOM,offset:m?za(m.dom)+1:0}}else{let m,v=!0;for(;m=l<this.children.length?this.children[l]:null,!(!m||m.dom.parentNode==this.contentDOM);l++,v=!1);return m&&v&&!m.border&&!m.domAtom?m.domFromPos(0,s):{node:this.contentDOM,offset:m?za(m.dom):this.contentDOM.childNodes.length}}}parseRange(t,s,l=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:s,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let h=-1,m=-1;for(let v=l,i=0;;i++){let A=this.children[i],P=v+A.size;if(h==-1&&t<=P){let D=v+A.border;if(t>=D&&s<=P-A.border&&A.node&&A.contentDOM&&this.contentDOM.contains(A.contentDOM))return A.parseRange(t,s,D);t=v;for(let F=i;F>0;F--){let $=this.children[F-1];if($.size&&$.dom.parentNode==this.contentDOM&&!$.emptyChildAt(1)){h=za($.dom)+1;break}t-=$.size}h==-1&&(h=0)}if(h>-1&&(P>s||i==this.children.length-1)){s=P;for(let D=i+1;D<this.children.length;D++){let F=this.children[D];if(F.size&&F.dom.parentNode==this.contentDOM&&!F.emptyChildAt(-1)){m=za(F.dom);break}s+=F.size}m==-1&&(m=this.contentDOM.childNodes.length);break}v=P}return{node:this.contentDOM,from:t,to:s,fromOffset:h,toOffset:m}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let s=this.children[t<0?0:this.children.length-1];return s.size==0||s.emptyChildAt(t)}domAfterPos(t){let{node:s,offset:l}=this.domFromPos(t,0);if(s.nodeType!=1||l==s.childNodes.length)throw new RangeError("No node after pos "+t);return s.childNodes[l]}setSelection(t,s,l,h=!1){let m=Math.min(t,s),v=Math.max(t,s);for(let K=0,J=0;K<this.children.length;K++){let W=this.children[K],ie=J+W.size;if(m>J&&v<ie)return W.setSelection(t-J-W.border,s-J-W.border,l,h);J=ie}let i=this.domFromPos(t,t?-1:1),A=s==t?i:this.domFromPos(s,s?-1:1),P=l.root.getSelection(),D=l.domSelectionRange(),F=!1;if((ph||wl)&&t==s){let{node:K,offset:J}=i;if(K.nodeType==3){if(F=!!(J&&K.nodeValue[J-1]==`
`),F&&J==K.nodeValue.length)for(let W=K,ie;W;W=W.parentNode){if(ie=W.nextSibling){ie.nodeName=="BR"&&(i=A={node:ie.parentNode,offset:za(ie)+1});break}let fe=W.pmViewDesc;if(fe&&fe.node&&fe.node.isBlock)break}}else{let W=K.childNodes[J-1];F=W&&(W.nodeName=="BR"||W.contentEditable=="false")}}if(ph&&D.focusNode&&D.focusNode!=A.node&&D.focusNode.nodeType==1){let K=D.focusNode.childNodes[D.focusOffset];K&&K.contentEditable=="false"&&(h=!0)}if(!(h||F&&wl)&&xg(i.node,i.offset,D.anchorNode,D.anchorOffset)&&xg(A.node,A.offset,D.focusNode,D.focusOffset))return;let $=!1;if((P.extend||t==s)&&!F){P.collapse(i.node,i.offset);try{t!=s&&P.extend(A.node,A.offset),$=!0}catch{}}if(!$){if(t>s){let J=i;i=A,A=J}let K=document.createRange();K.setEnd(A.node,A.offset),K.setStart(i.node,i.offset),P.removeAllRanges(),P.addRange(K)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,s){for(let l=0,h=0;h<this.children.length;h++){let m=this.children[h],v=l+m.size;if(l==v?t<=v&&s>=l:t<v&&s>l){let i=l+m.border,A=v-m.border;if(t>=i&&s<=A){this.dirty=t==l||s==v?Qm:zM,t==i&&s==A&&(m.contentLost||m.dom.parentNode!=this.contentDOM)?m.dirty=xd:m.markDirty(t-i,s-i);return}else m.dirty=m.dom==m.contentDOM&&m.dom.parentNode==this.contentDOM&&!m.children.length?Qm:xd}l=v}this.dirty=Qm}markParentsDirty(){let t=1;for(let s=this.parent;s;s=s.parent,t++){let l=t==1?Qm:zM;s.dirty<l&&(s.dirty=l)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}}class QD extends wx{constructor(t,s,l,h){let m,v=s.type.toDOM;if(typeof v=="function"&&(v=v(l,()=>{if(!m)return h;if(m.parent)return m.parent.posBeforeChild(m)})),!s.type.spec.raw){if(v.nodeType!=1){let i=document.createElement("span");i.appendChild(v),v=i}v.contentEditable="false",v.classList.add("ProseMirror-widget")}super(t,[],v,null),this.widget=s,this.widget=s,m=this}matchesWidget(t){return this.dirty==gu&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let s=this.widget.spec.stopEvent;return s?s(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class nG extends wx{constructor(t,s,l,h){super(t,[],s,null),this.textDOM=l,this.text=h}get size(){return this.text.length}localPosFromDOM(t,s){return t!=this.textDOM?this.posAtStart+(s?this.size:0):this.posAtStart+s}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class vg extends wx{constructor(t,s,l,h,m){super(t,[],l,h),this.mark=s,this.spec=m}static create(t,s,l,h){let m=h.nodeViews[s.type.name],v=m&&m(s,h,l);return(!v||!v.dom)&&(v=Tg.renderSpec(document,s.type.spec.toDOM(s,l),null,s.attrs)),new vg(t,s,v.dom,v.contentDOM||v.dom,v)}parseRule(){return this.dirty&xd||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=xd&&this.mark.eq(t)}markDirty(t,s){if(super.markDirty(t,s),this.dirty!=gu){let l=this.parent;for(;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=gu}}slice(t,s,l){let h=vg.create(this.parent,this.mark,!0,l),m=this.children,v=this.size;s<v&&(m=BS(m,s,v,l)),t>0&&(m=BS(m,0,t,l));for(let i=0;i<m.length;i++)m[i].parent=h;return h.children=m,h}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Zp extends wx{constructor(t,s,l,h,m,v,i,A,P){super(t,[],m,v),this.node=s,this.outerDeco=l,this.innerDeco=h,this.nodeDOM=i}static create(t,s,l,h,m,v){let i=m.nodeViews[s.type.name],A,P=i&&i(s,m,()=>{if(!A)return v;if(A.parent)return A.parent.posBeforeChild(A)},l,h),D=P&&P.dom,F=P&&P.contentDOM;if(s.isText){if(!D)D=document.createTextNode(s.text);else if(D.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else D||({dom:D,contentDOM:F}=Tg.renderSpec(document,s.type.spec.toDOM(s),null,s.attrs));!F&&!s.isText&&D.nodeName!="BR"&&(D.hasAttribute("contenteditable")||(D.contentEditable="false"),s.type.spec.draggable&&(D.draggable=!0));let $=D;return D=nO(D,l,s),P?A=new iG(t,s,l,h,D,F||null,$,P,m,v+1):s.isText?new N1(t,s,l,h,D,$,m):new Zp(t,s,l,h,D,F||null,$,m,v+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let s=this.children.length-1;s>=0;s--){let l=this.children[s];if(this.dom.contains(l.dom.parentNode)){t.contentElement=l.dom.parentNode;break}}t.contentElement||(t.getContent=()=>dr.empty)}return t}matchesNode(t,s,l){return this.dirty==gu&&t.eq(this.node)&&C0(s,this.outerDeco)&&l.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,s){let l=this.node.inlineContent,h=s,m=t.composing?this.localCompositionInfo(t,s):null,v=m&&m.pos>-1?m:null,i=m&&m.pos<0,A=new oG(this,v&&v.node,t);cG(this.node,this.innerDeco,(P,D,F)=>{P.spec.marks?A.syncToMarks(P.spec.marks,l,t):P.type.side>=0&&!F&&A.syncToMarks(D==this.node.childCount?_s.none:this.node.child(D).marks,l,t),A.placeWidget(P,t,h)},(P,D,F,$)=>{A.syncToMarks(P.marks,l,t);let K;A.findNodeMatch(P,D,F,$)||i&&t.state.selection.from>h&&t.state.selection.to<h+P.nodeSize&&(K=A.findIndexWithChild(m.node))>-1&&A.updateNodeAt(P,D,F,K,t)||A.updateNextNode(P,D,F,t,$,h)||A.addNode(P,D,F,t,h),h+=P.nodeSize}),A.syncToMarks([],l,t),this.node.isTextblock&&A.addTextblockHacks(),A.destroyRest(),(A.changed||this.dirty==Qm)&&(v&&this.protectLocalComposition(t,v),tO(this.contentDOM,this.children,t),Ey&&uG(this.dom))}localCompositionInfo(t,s){let{from:l,to:h}=t.state.selection;if(!(t.state.selection instanceof ti)||l<s||h>s+this.node.content.size)return null;let m=t.input.compositionNode;if(!m||!this.dom.contains(m.parentNode))return null;if(this.node.inlineContent){let v=m.nodeValue,i=hG(this.node.content,v,l-s,h-s);return i<0?null:{node:m,pos:i,text:v}}else return{node:m,pos:-1,text:""}}protectLocalComposition(t,{node:s,pos:l,text:h}){if(this.getDesc(s))return;let m=s;for(;m.parentNode!=this.contentDOM;m=m.parentNode){for(;m.previousSibling;)m.parentNode.removeChild(m.previousSibling);for(;m.nextSibling;)m.parentNode.removeChild(m.nextSibling);m.pmViewDesc&&(m.pmViewDesc=void 0)}let v=new nG(this,m,s,h);t.input.compositionNodes.push(v),this.children=BS(this.children,l,l+h.length,t,v)}update(t,s,l,h){return this.dirty==xd||!t.sameMarkup(this.node)?!1:(this.updateInner(t,s,l,h),!0)}updateInner(t,s,l,h){this.updateOuterDeco(s),this.node=t,this.innerDeco=l,this.contentDOM&&this.updateChildren(h,this.posAtStart),this.dirty=gu}updateOuterDeco(t){if(C0(t,this.outerDeco))return;let s=this.nodeDOM.nodeType!=1,l=this.dom;this.dom=rO(this.dom,this.nodeDOM,FS(this.outerDeco,this.node,s),FS(t,this.node,s)),this.dom!=l&&(l.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function jM(r,t,s,l,h){nO(l,t,r);let m=new Zp(void 0,r,t,s,l,l,l,h,0);return m.contentDOM&&m.updateChildren(h,0),m}class N1 extends Zp{constructor(t,s,l,h,m,v,i){super(t,s,l,h,m,null,v,i,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,s,l,h){return this.dirty==xd||this.dirty!=gu&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(s),(this.dirty!=gu||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,h.trackWrites==this.nodeDOM&&(h.trackWrites=null)),this.node=t,this.dirty=gu,!0)}inParent(){let t=this.parent.contentDOM;for(let s=this.nodeDOM;s;s=s.parentNode)if(s==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,s,l){return t==this.nodeDOM?this.posAtStart+Math.min(s,this.node.text.length):super.localPosFromDOM(t,s,l)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,s,l){let h=this.node.cut(t,s),m=document.createTextNode(h.text);return new N1(this.parent,h,this.outerDeco,this.innerDeco,m,m,l)}markDirty(t,s){super.markDirty(t,s),this.dom!=this.nodeDOM&&(t==0||s==this.nodeDOM.nodeValue.length)&&(this.dirty=xd)}get domAtom(){return!1}isText(t){return this.node.text==t}}class eO extends wx{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==gu&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class iG extends Zp{constructor(t,s,l,h,m,v,i,A,P,D){super(t,s,l,h,m,v,i,P,D),this.spec=A}update(t,s,l,h){if(this.dirty==xd)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let m=this.spec.update(t,s,l);return m&&this.updateInner(t,s,l,h),m}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,s,l,h)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,s,l,h){this.spec.setSelection?this.spec.setSelection(t,s,l.root):super.setSelection(t,s,l,h)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function tO(r,t,s){let l=r.firstChild,h=!1;for(let m=0;m<t.length;m++){let v=t[m],i=v.dom;if(i.parentNode==r){for(;i!=l;)l=FM(l),h=!0;l=l.nextSibling}else h=!0,r.insertBefore(i,l);if(v instanceof vg){let A=l?l.previousSibling:r.lastChild;tO(v.contentDOM,v.children,s),l=A?A.nextSibling:r.firstChild}}for(;l;)l=FM(l),h=!0;h&&s.trackWrites==r&&(s.trackWrites=null)}const $_=function(r){r&&(this.nodeName=r)};$_.prototype=Object.create(null);const eg=[new $_];function FS(r,t,s){if(r.length==0)return eg;let l=s?eg[0]:new $_,h=[l];for(let m=0;m<r.length;m++){let v=r[m].type.attrs;if(v){v.nodeName&&h.push(l=new $_(v.nodeName));for(let i in v){let A=v[i];A!=null&&(s&&h.length==1&&h.push(l=new $_(t.isInline?"span":"div")),i=="class"?l.class=(l.class?l.class+" ":"")+A:i=="style"?l.style=(l.style?l.style+";":"")+A:i!="nodeName"&&(l[i]=A))}}}return h}function rO(r,t,s,l){if(s==eg&&l==eg)return t;let h=t;for(let m=0;m<l.length;m++){let v=l[m],i=s[m];if(m){let A;i&&i.nodeName==v.nodeName&&h!=r&&(A=h.parentNode)&&A.nodeName.toLowerCase()==v.nodeName||(A=document.createElement(v.nodeName),A.pmIsDeco=!0,A.appendChild(h),i=eg[0]),h=A}sG(h,i||eg[0],v)}return h}function sG(r,t,s){for(let l in t)l!="class"&&l!="style"&&l!="nodeName"&&!(l in s)&&r.removeAttribute(l);for(let l in s)l!="class"&&l!="style"&&l!="nodeName"&&s[l]!=t[l]&&r.setAttribute(l,s[l]);if(t.class!=s.class){let l=t.class?t.class.split(" ").filter(Boolean):[],h=s.class?s.class.split(" ").filter(Boolean):[];for(let m=0;m<l.length;m++)h.indexOf(l[m])==-1&&r.classList.remove(l[m]);for(let m=0;m<h.length;m++)l.indexOf(h[m])==-1&&r.classList.add(h[m]);r.classList.length==0&&r.removeAttribute("class")}if(t.style!=s.style){if(t.style){let l=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,h;for(;h=l.exec(t.style);)r.style.removeProperty(h[1])}s.style&&(r.style.cssText+=s.style)}}function nO(r,t,s){return rO(r,r,eg,FS(t,s,r.nodeType!=1))}function C0(r,t){if(r.length!=t.length)return!1;for(let s=0;s<r.length;s++)if(!r[s].type.eq(t[s].type))return!1;return!0}function FM(r){let t=r.nextSibling;return r.parentNode.removeChild(r),t}class oG{constructor(t,s,l){this.lock=s,this.view=l,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=aG(t.node.content,t)}destroyBetween(t,s){if(t!=s){for(let l=t;l<s;l++)this.top.children[l].destroy();this.top.children.splice(t,s-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,s,l){let h=0,m=this.stack.length>>1,v=Math.min(m,t.length);for(;h<v&&(h==m-1?this.top:this.stack[h+1<<1]).matchesMark(t[h])&&t[h].type.spec.spanning!==!1;)h++;for(;h<m;)this.destroyRest(),this.top.dirty=gu,this.index=this.stack.pop(),this.top=this.stack.pop(),m--;for(;m<t.length;){this.stack.push(this.top,this.index+1);let i=-1;for(let A=this.index;A<Math.min(this.index+3,this.top.children.length);A++){let P=this.top.children[A];if(P.matchesMark(t[m])&&!this.isLocked(P.dom)){i=A;break}}if(i>-1)i>this.index&&(this.changed=!0,this.destroyBetween(this.index,i)),this.top=this.top.children[this.index];else{let A=vg.create(this.top,t[m],s,l);this.top.children.splice(this.index,0,A),this.top=A,this.changed=!0}this.index=0,m++}}findNodeMatch(t,s,l,h){let m=-1,v;if(h>=this.preMatch.index&&(v=this.preMatch.matches[h-this.preMatch.index]).parent==this.top&&v.matchesNode(t,s,l))m=this.top.children.indexOf(v,this.index);else for(let i=this.index,A=Math.min(this.top.children.length,i+5);i<A;i++){let P=this.top.children[i];if(P.matchesNode(t,s,l)&&!this.preMatch.matched.has(P)){m=i;break}}return m<0?!1:(this.destroyBetween(this.index,m),this.index++,!0)}updateNodeAt(t,s,l,h,m){let v=this.top.children[h];return v.dirty==xd&&v.dom==v.contentDOM&&(v.dirty=Qm),v.update(t,s,l,m)?(this.destroyBetween(this.index,h),this.index++,!0):!1}findIndexWithChild(t){for(;;){let s=t.parentNode;if(!s)return-1;if(s==this.top.contentDOM){let l=t.pmViewDesc;if(l){for(let h=this.index;h<this.top.children.length;h++)if(this.top.children[h]==l)return h}return-1}t=s}}updateNextNode(t,s,l,h,m,v){for(let i=this.index;i<this.top.children.length;i++){let A=this.top.children[i];if(A instanceof Zp){let P=this.preMatch.matched.get(A);if(P!=null&&P!=m)return!1;let D=A.dom,F,$=this.isLocked(D)&&!(t.isText&&A.node&&A.node.isText&&A.nodeDOM.nodeValue==t.text&&A.dirty!=xd&&C0(s,A.outerDeco));if(!$&&A.update(t,s,l,h))return this.destroyBetween(this.index,i),A.dom!=D&&(this.changed=!0),this.index++,!0;if(!$&&(F=this.recreateWrapper(A,t,s,l,h,v)))return this.destroyBetween(this.index,i),this.top.children[this.index]=F,F.contentDOM&&(F.dirty=Qm,F.updateChildren(h,v+1),F.dirty=gu),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,s,l,h,m,v){if(t.dirty||s.isAtom||!t.children.length||!t.node.content.eq(s.content)||!C0(l,t.outerDeco)||!h.eq(t.innerDeco))return null;let i=Zp.create(this.top,s,l,h,m,v);if(i.contentDOM){i.children=t.children,t.children=[];for(let A of i.children)A.parent=i}return t.destroy(),i}addNode(t,s,l,h,m){let v=Zp.create(this.top,t,s,l,h,m);v.contentDOM&&v.updateChildren(h,m+1),this.top.children.splice(this.index++,0,v),this.changed=!0}placeWidget(t,s,l){let h=this.index<this.top.children.length?this.top.children[this.index]:null;if(h&&h.matchesWidget(t)&&(t==h.widget||!h.widget.type.toDOM.parentNode))this.index++;else{let m=new QD(this.top,t,s,l);this.top.children.splice(this.index++,0,m),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],s=this.top;for(;t instanceof vg;)s=t,t=s.children[s.children.length-1];(!t||!(t instanceof N1)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((wl||il)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",s),this.addHackNode("BR",this.top))}addHackNode(t,s){if(s==this.top&&this.index<s.children.length&&s.children[this.index].matchesHack(t))this.index++;else{let l=document.createElement(t);t=="IMG"&&(l.className="ProseMirror-separator",l.alt=""),t=="BR"&&(l.className="ProseMirror-trailingBreak");let h=new eO(this.top,[],l,null);s!=this.top?s.children.push(h):s.children.splice(this.index++,0,h),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function aG(r,t){let s=t,l=s.children.length,h=r.childCount,m=new Map,v=[];e:for(;h>0;){let i;for(;;)if(l){let P=s.children[l-1];if(P instanceof vg)s=P,l=P.children.length;else{i=P,l--;break}}else{if(s==t)break e;l=s.parent.children.indexOf(s),s=s.parent}let A=i.node;if(A){if(A!=r.child(h-1))break;--h,m.set(i,h),v.push(i)}}return{index:h,matched:m,matches:v.reverse()}}function lG(r,t){return r.type.side-t.type.side}function cG(r,t,s,l){let h=t.locals(r),m=0;if(h.length==0){for(let P=0;P<r.childCount;P++){let D=r.child(P);l(D,h,t.forChild(m,D),P),m+=D.nodeSize}return}let v=0,i=[],A=null;for(let P=0;;){let D,F;for(;v<h.length&&h[v].to==m;){let ie=h[v++];ie.widget&&(D?(F||(F=[D])).push(ie):D=ie)}if(D)if(F){F.sort(lG);for(let ie=0;ie<F.length;ie++)s(F[ie],P,!!A)}else s(D,P,!!A);let $,K;if(A)K=-1,$=A,A=null;else if(P<r.childCount)K=P,$=r.child(P++);else break;for(let ie=0;ie<i.length;ie++)i[ie].to<=m&&i.splice(ie--,1);for(;v<h.length&&h[v].from<=m&&h[v].to>m;)i.push(h[v++]);let J=m+$.nodeSize;if($.isText){let ie=J;v<h.length&&h[v].from<ie&&(ie=h[v].from);for(let fe=0;fe<i.length;fe++)i[fe].to<ie&&(ie=i[fe].to);ie<J&&(A=$.cut(ie-m),$=$.cut(0,ie-m),J=ie,K=-1)}else for(;v<h.length&&h[v].to<J;)v++;let W=$.isInline&&!$.isLeaf?i.filter(ie=>!ie.inline):i.slice();l($,W,t.forChild(m,$),K),m=J}}function uG(r){if(r.nodeName=="UL"||r.nodeName=="OL"){let t=r.style.cssText;r.style.cssText=t+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=t}}function hG(r,t,s,l){for(let h=0,m=0;h<r.childCount&&m<=l;){let v=r.child(h++),i=m;if(m+=v.nodeSize,!v.isText)continue;let A=v.text;for(;h<r.childCount;){let P=r.child(h++);if(m+=P.nodeSize,!P.isText)break;A+=P.text}if(m>=s){if(m>=l&&A.slice(l-t.length-i,l-i)==t)return l-t.length;let P=i<l?A.lastIndexOf(t,l-i-1):-1;if(P>=0&&P+t.length+i>=s)return i+P;if(s==l&&A.length>=l+t.length-i&&A.slice(l-i,l-i+t.length)==t)return l}}return-1}function BS(r,t,s,l,h){let m=[];for(let v=0,i=0;v<r.length;v++){let A=r[v],P=i,D=i+=A.size;P>=s||D<=t?m.push(A):(P<t&&m.push(A.slice(0,t-P,l)),h&&(m.push(h),h=void 0),D>s&&m.push(A.slice(s-P,A.size,l)))}return m}function WT(r,t=null){let s=r.domSelectionRange(),l=r.state.doc;if(!s.focusNode)return null;let h=r.docView.nearestDesc(s.focusNode),m=h&&h.size==0,v=r.docView.posFromDOM(s.focusNode,s.focusOffset,1);if(v<0)return null;let i=l.resolve(v),A,P;if(R1(s)){for(A=v;h&&!h.node;)h=h.parent;let F=h.node;if(h&&F.isAtom&&kn.isSelectable(F)&&h.parent&&!(F.isInline&&zH(s.focusNode,s.focusOffset,h.dom))){let $=h.posBefore;P=new kn(v==$?i:l.resolve($))}}else{if(s instanceof r.dom.ownerDocument.defaultView.Selection&&s.rangeCount>1){let F=v,$=v;for(let K=0;K<s.rangeCount;K++){let J=s.getRangeAt(K);F=Math.min(F,r.docView.posFromDOM(J.startContainer,J.startOffset,1)),$=Math.max($,r.docView.posFromDOM(J.endContainer,J.endOffset,-1))}if(F<0)return null;[A,v]=$==r.state.selection.anchor?[$,F]:[F,$],i=l.resolve(v)}else A=r.docView.posFromDOM(s.anchorNode,s.anchorOffset,1);if(A<0)return null}let D=l.resolve(A);if(!P){let F=t=="pointer"||r.state.selection.head<i.pos&&!m?1:-1;P=ZT(r,D,i,F)}return P}function iO(r){return r.editable?r.hasFocus():oO(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function Sf(r,t=!1){let s=r.state.selection;if(sO(r,s),!!iO(r)){if(!t&&r.input.mouseDown&&r.input.mouseDown.allowDefault&&il){let l=r.domSelectionRange(),h=r.domObserver.currentSelection;if(l.anchorNode&&h.anchorNode&&xg(l.anchorNode,l.anchorOffset,h.anchorNode,h.anchorOffset)){r.input.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)fG(r);else{let{anchor:l,head:h}=s,m,v;BM&&!(s instanceof ti)&&(s.$from.parent.inlineContent||(m=VM(r,s.from)),!s.empty&&!s.$from.parent.inlineContent&&(v=VM(r,s.to))),r.docView.setSelection(l,h,r,t),BM&&(m&&UM(m),v&&UM(v)),s.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&dG(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}const BM=wl||il&&qD<63;function VM(r,t){let{node:s,offset:l}=r.docView.domFromPos(t,0),h=l<s.childNodes.length?s.childNodes[l]:null,m=l?s.childNodes[l-1]:null;if(wl&&h&&h.contentEditable=="false")return Nw(h);if((!h||h.contentEditable=="false")&&(!m||m.contentEditable=="false")){if(h)return Nw(h);if(m)return Nw(m)}}function Nw(r){return r.contentEditable="true",wl&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function UM(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function dG(r){let t=r.dom.ownerDocument;t.removeEventListener("selectionchange",r.input.hideSelectionGuard);let s=r.domSelectionRange(),l=s.anchorNode,h=s.anchorOffset;t.addEventListener("selectionchange",r.input.hideSelectionGuard=()=>{(s.anchorNode!=l||s.anchorOffset!=h)&&(t.removeEventListener("selectionchange",r.input.hideSelectionGuard),setTimeout(()=>{(!iO(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function fG(r){let t=r.domSelection(),s=document.createRange();if(!t)return;let l=r.cursorWrapper.dom,h=l.nodeName=="IMG";h?s.setStart(l.parentNode,za(l)+1):s.setStart(l,0),s.collapse(!0),t.removeAllRanges(),t.addRange(s),!h&&!r.state.selection.visible&&Yl&&Wp<=11&&(l.disabled=!0,l.disabled=!1)}function sO(r,t){if(t instanceof kn){let s=r.docView.descAt(t.from);s!=r.lastSelectedViewDesc&&($M(r),s&&s.selectNode(),r.lastSelectedViewDesc=s)}else $M(r)}function $M(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=void 0)}function ZT(r,t,s,l){return r.someProp("createSelectionBetween",h=>h(r,t,s))||ti.between(t,s,l)}function HM(r){return r.editable&&!r.hasFocus()?!1:oO(r)}function oO(r){let t=r.domSelectionRange();if(!t.anchorNode)return!1;try{return r.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(r.editable||r.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function pG(r){let t=r.docView.domFromPos(r.state.selection.anchor,0),s=r.domSelectionRange();return xg(t.node,t.offset,s.anchorNode,s.anchorOffset)}function VS(r,t){let{$anchor:s,$head:l}=r.selection,h=t>0?s.max(l):s.min(l),m=h.parent.inlineContent?h.depth?r.doc.resolve(t>0?h.after():h.before()):null:h;return m&&xi.findFrom(m,t)}function Dp(r,t){return r.dispatch(r.state.tr.setSelection(t).scrollIntoView()),!0}function GM(r,t,s){let l=r.state.selection;if(l instanceof ti)if(s.indexOf("s")>-1){let{$head:h}=l,m=h.textOffset?null:t<0?h.nodeBefore:h.nodeAfter;if(!m||m.isText||!m.isLeaf)return!1;let v=r.state.doc.resolve(h.pos+m.nodeSize*(t<0?-1:1));return Dp(r,new ti(l.$anchor,v))}else if(l.empty){if(r.endOfTextblock(t>0?"forward":"backward")){let h=VS(r.state,t);return h&&h instanceof kn?Dp(r,h):!1}else if(!(pu&&s.indexOf("m")>-1)){let h=l.$head,m=h.textOffset?null:t<0?h.nodeBefore:h.nodeAfter,v;if(!m||m.isText)return!1;let i=t<0?h.pos-m.nodeSize:h.pos;return m.isAtom||(v=r.docView.descAt(i))&&!v.contentDOM?kn.isSelectable(m)?Dp(r,new kn(t<0?r.state.doc.resolve(h.pos-m.nodeSize):h)):bx?Dp(r,new ti(r.state.doc.resolve(t<0?i:i+m.nodeSize))):!1:!1}}else return!1;else{if(l instanceof kn&&l.node.isInline)return Dp(r,new ti(t>0?l.$to:l.$from));{let h=VS(r.state,t);return h?Dp(r,h):!1}}}function A0(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function H_(r,t){let s=r.pmViewDesc;return s&&s.size==0&&(t<0||r.nextSibling||r.nodeName!="BR")}function ly(r,t){return t<0?mG(r):gG(r)}function mG(r){let t=r.domSelectionRange(),s=t.focusNode,l=t.focusOffset;if(!s)return;let h,m,v=!1;for(ph&&s.nodeType==1&&l<A0(s)&&H_(s.childNodes[l],-1)&&(v=!0);;)if(l>0){if(s.nodeType!=1)break;{let i=s.childNodes[l-1];if(H_(i,-1))h=s,m=--l;else if(i.nodeType==3)s=i,l=s.nodeValue.length;else break}}else{if(aO(s))break;{let i=s.previousSibling;for(;i&&H_(i,-1);)h=s.parentNode,m=za(i),i=i.previousSibling;if(i)s=i,l=A0(s);else{if(s=s.parentNode,s==r.dom)break;l=0}}}v?US(r,s,l):h&&US(r,h,m)}function gG(r){let t=r.domSelectionRange(),s=t.focusNode,l=t.focusOffset;if(!s)return;let h=A0(s),m,v;for(;;)if(l<h){if(s.nodeType!=1)break;let i=s.childNodes[l];if(H_(i,1))m=s,v=++l;else break}else{if(aO(s))break;{let i=s.nextSibling;for(;i&&H_(i,1);)m=i.parentNode,v=za(i)+1,i=i.nextSibling;if(i)s=i,l=0,h=A0(s);else{if(s=s.parentNode,s==r.dom)break;l=h=0}}}m&&US(r,m,v)}function aO(r){let t=r.pmViewDesc;return t&&t.node&&t.node.isBlock}function yG(r,t){for(;r&&t==r.childNodes.length&&!vx(r);)t=za(r)+1,r=r.parentNode;for(;r&&t<r.childNodes.length;){let s=r.childNodes[t];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;r=s,t=0}}function _G(r,t){for(;r&&!t&&!vx(r);)t=za(r),r=r.parentNode;for(;r&&t;){let s=r.childNodes[t-1];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;r=s,t=r.childNodes.length}}function US(r,t,s){if(t.nodeType!=3){let m,v;(v=yG(t,s))?(t=v,s=0):(m=_G(t,s))&&(t=m,s=m.nodeValue.length)}let l=r.domSelection();if(!l)return;if(R1(l)){let m=document.createRange();m.setEnd(t,s),m.setStart(t,s),l.removeAllRanges(),l.addRange(m)}else l.extend&&l.extend(t,s);r.domObserver.setCurSelection();let{state:h}=r;setTimeout(()=>{r.state==h&&Sf(r)},50)}function qM(r,t){let s=r.state.doc.resolve(t);if(!(il||BH)&&s.parent.inlineContent){let h=r.coordsAtPos(t);if(t>s.start()){let m=r.coordsAtPos(t-1),v=(m.top+m.bottom)/2;if(v>h.top&&v<h.bottom&&Math.abs(m.left-h.left)>1)return m.left<h.left?"ltr":"rtl"}if(t<s.end()){let m=r.coordsAtPos(t+1),v=(m.top+m.bottom)/2;if(v>h.top&&v<h.bottom&&Math.abs(m.left-h.left)>1)return m.left>h.left?"ltr":"rtl"}}return getComputedStyle(r.dom).direction=="rtl"?"rtl":"ltr"}function WM(r,t,s){let l=r.state.selection;if(l instanceof ti&&!l.empty||s.indexOf("s")>-1||pu&&s.indexOf("m")>-1)return!1;let{$from:h,$to:m}=l;if(!h.parent.inlineContent||r.endOfTextblock(t<0?"up":"down")){let v=VS(r.state,t);if(v&&v instanceof kn)return Dp(r,v)}if(!h.parent.inlineContent){let v=t<0?h:m,i=l instanceof Ic?xi.near(v,t):xi.findFrom(v,t);return i?Dp(r,i):!1}return!1}function ZM(r,t){if(!(r.state.selection instanceof ti))return!0;let{$head:s,$anchor:l,empty:h}=r.state.selection;if(!s.sameParent(l))return!0;if(!h)return!1;if(r.endOfTextblock(t>0?"forward":"backward"))return!0;let m=!s.textOffset&&(t<0?s.nodeBefore:s.nodeAfter);if(m&&!m.isText){let v=r.state.tr;return t<0?v.delete(s.pos-m.nodeSize,s.pos):v.delete(s.pos,s.pos+m.nodeSize),r.dispatch(v),!0}return!1}function XM(r,t,s){r.domObserver.stop(),t.contentEditable=s,r.domObserver.start()}function xG(r){if(!wl||r.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:s}=r.domSelectionRange();if(t&&t.nodeType==1&&s==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let l=t.firstChild;XM(r,l,"true"),setTimeout(()=>XM(r,l,"false"),20)}return!1}function vG(r){let t="";return r.ctrlKey&&(t+="c"),r.metaKey&&(t+="m"),r.altKey&&(t+="a"),r.shiftKey&&(t+="s"),t}function bG(r,t){let s=t.keyCode,l=vG(t);if(s==8||pu&&s==72&&l=="c")return ZM(r,-1)||ly(r,-1);if(s==46&&!t.shiftKey||pu&&s==68&&l=="c")return ZM(r,1)||ly(r,1);if(s==13||s==27)return!0;if(s==37||pu&&s==66&&l=="c"){let h=s==37?qM(r,r.state.selection.from)=="ltr"?-1:1:-1;return GM(r,h,l)||ly(r,h)}else if(s==39||pu&&s==70&&l=="c"){let h=s==39?qM(r,r.state.selection.from)=="ltr"?1:-1:1;return GM(r,h,l)||ly(r,h)}else{if(s==38||pu&&s==80&&l=="c")return WM(r,-1,l)||ly(r,-1);if(s==40||pu&&s==78&&l=="c")return xG(r)||WM(r,1,l)||ly(r,1);if(l==(pu?"m":"c")&&(s==66||s==73||s==89||s==90))return!0}return!1}function XT(r,t){r.someProp("transformCopied",K=>{t=K(t,r)});let s=[],{content:l,openStart:h,openEnd:m}=t;for(;h>1&&m>1&&l.childCount==1&&l.firstChild.childCount==1;){h--,m--;let K=l.firstChild;s.push(K.type.name,K.attrs!=K.type.defaultAttrs?K.attrs:null),l=K.content}let v=r.someProp("clipboardSerializer")||Tg.fromSchema(r.state.schema),i=fO(),A=i.createElement("div");A.appendChild(v.serializeFragment(l,{document:i}));let P=A.firstChild,D,F=0;for(;P&&P.nodeType==1&&(D=dO[P.nodeName.toLowerCase()]);){for(let K=D.length-1;K>=0;K--){let J=i.createElement(D[K]);for(;A.firstChild;)J.appendChild(A.firstChild);A.appendChild(J),F++}P=A.firstChild}P&&P.nodeType==1&&P.setAttribute("data-pm-slice",`${h} ${m}${F?` -${F}`:""} ${JSON.stringify(s)}`);let $=r.someProp("clipboardTextSerializer",K=>K(t,r))||t.content.textBetween(0,t.content.size,`

`);return{dom:A,text:$,slice:t}}function lO(r,t,s,l,h){let m=h.parent.type.spec.code,v,i;if(!s&&!t)return null;let A=t&&(l||m||!s);if(A){if(r.someProp("transformPastedText",$=>{t=$(t,m||l,r)}),m)return t?new Yr(dr.from(r.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):Yr.empty;let F=r.someProp("clipboardTextParser",$=>$(t,h,l,r));if(F)i=F;else{let $=h.marks(),{schema:K}=r.state,J=Tg.fromSchema(K);v=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(W=>{let ie=v.appendChild(document.createElement("p"));W&&ie.appendChild(J.serializeNode(K.text(W,$)))})}}else r.someProp("transformPastedHTML",F=>{s=F(s,r)}),v=EG(s),bx&&CG(v);let P=v&&v.querySelector("[data-pm-slice]"),D=P&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(P.getAttribute("data-pm-slice")||"");if(D&&D[3])for(let F=+D[3];F>0;F--){let $=v.firstChild;for(;$&&$.nodeType!=1;)$=$.nextSibling;if(!$)break;v=$}if(i||(i=(r.someProp("clipboardParser")||r.someProp("domParser")||qp.fromSchema(r.state.schema)).parseSlice(v,{preserveWhitespace:!!(A||D),context:h,ruleFromNode($){return $.nodeName=="BR"&&!$.nextSibling&&$.parentNode&&!wG.test($.parentNode.nodeName)?{ignore:!0}:null}})),D)i=AG(KM(i,+D[1],+D[2]),D[4]);else if(i=Yr.maxOpen(SG(i.content,h),!0),i.openStart||i.openEnd){let F=0,$=0;for(let K=i.content.firstChild;F<i.openStart&&!K.type.spec.isolating;F++,K=K.firstChild);for(let K=i.content.lastChild;$<i.openEnd&&!K.type.spec.isolating;$++,K=K.lastChild);i=KM(i,F,$)}return r.someProp("transformPasted",F=>{i=F(i,r)}),i}const wG=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function SG(r,t){if(r.childCount<2)return r;for(let s=t.depth;s>=0;s--){let h=t.node(s).contentMatchAt(t.index(s)),m,v=[];if(r.forEach(i=>{if(!v)return;let A=h.findWrapping(i.type),P;if(!A)return v=null;if(P=v.length&&m.length&&uO(A,m,i,v[v.length-1],0))v[v.length-1]=P;else{v.length&&(v[v.length-1]=hO(v[v.length-1],m.length));let D=cO(i,A);v.push(D),h=h.matchType(D.type),m=A}}),v)return dr.from(v)}return r}function cO(r,t,s=0){for(let l=t.length-1;l>=s;l--)r=t[l].create(null,dr.from(r));return r}function uO(r,t,s,l,h){if(h<r.length&&h<t.length&&r[h]==t[h]){let m=uO(r,t,s,l.lastChild,h+1);if(m)return l.copy(l.content.replaceChild(l.childCount-1,m));if(l.contentMatchAt(l.childCount).matchType(h==r.length-1?s.type:r[h+1]))return l.copy(l.content.append(dr.from(cO(s,r,h+1))))}}function hO(r,t){if(t==0)return r;let s=r.content.replaceChild(r.childCount-1,hO(r.lastChild,t-1)),l=r.contentMatchAt(r.childCount).fillBefore(dr.empty,!0);return r.copy(s.append(l))}function $S(r,t,s,l,h,m){let v=t<0?r.firstChild:r.lastChild,i=v.content;return r.childCount>1&&(m=0),h<l-1&&(i=$S(i,t,s,l,h+1,m)),h>=s&&(i=t<0?v.contentMatchAt(0).fillBefore(i,m<=h).append(i):i.append(v.contentMatchAt(v.childCount).fillBefore(dr.empty,!0))),r.replaceChild(t<0?0:r.childCount-1,v.copy(i))}function KM(r,t,s){return t<r.openStart&&(r=new Yr($S(r.content,-1,t,r.openStart,0,r.openEnd),t,r.openEnd)),s<r.openEnd&&(r=new Yr($S(r.content,1,s,r.openEnd,0,0),r.openStart,s)),r}const dO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let YM=null;function fO(){return YM||(YM=document.implementation.createHTMLDocument("title"))}let Dw=null;function TG(r){let t=window.trustedTypes;return t?(Dw||(Dw=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:s=>s})),Dw.createHTML(r)):r}function EG(r){let t=/^(\s*<meta [^>]*>)*/.exec(r);t&&(r=r.slice(t[0].length));let s=fO().createElement("div"),l=/<([a-z][^>\s]+)/i.exec(r),h;if((h=l&&dO[l[1].toLowerCase()])&&(r=h.map(m=>"<"+m+">").join("")+r+h.map(m=>"</"+m+">").reverse().join("")),s.innerHTML=TG(r),h)for(let m=0;m<h.length;m++)s=s.querySelector(h[m])||s;return s}function CG(r){let t=r.querySelectorAll(il?"span:not([class]):not([style])":"span.Apple-converted-space");for(let s=0;s<t.length;s++){let l=t[s];l.childNodes.length==1&&l.textContent==""&&l.parentNode&&l.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),l)}}function AG(r,t){if(!r.size)return r;let s=r.content.firstChild.type.schema,l;try{l=JSON.parse(t)}catch{return r}let{content:h,openStart:m,openEnd:v}=r;for(let i=l.length-2;i>=0;i-=2){let A=s.nodes[l[i]];if(!A||A.hasRequiredAttrs())break;h=dr.from(A.create(l[i+1],h)),m++,v++}return new Yr(h,m,v)}const Sl={},Tl={},IG={touchstart:!0,touchmove:!0};class MG{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function kG(r){for(let t in Sl){let s=Sl[t];r.dom.addEventListener(t,r.input.eventHandlers[t]=l=>{RG(r,l)&&!KT(r,l)&&(r.editable||!(l.type in Tl))&&s(r,l)},IG[t]?{passive:!0}:void 0)}wl&&r.dom.addEventListener("input",()=>null),HS(r)}function Up(r,t){r.input.lastSelectionOrigin=t,r.input.lastSelectionTime=Date.now()}function PG(r){r.domObserver.stop();for(let t in r.input.eventHandlers)r.dom.removeEventListener(t,r.input.eventHandlers[t]);clearTimeout(r.input.composingTimeout),clearTimeout(r.input.lastIOSEnterFallbackTimeout)}function HS(r){r.someProp("handleDOMEvents",t=>{for(let s in t)r.input.eventHandlers[s]||r.dom.addEventListener(s,r.input.eventHandlers[s]=l=>KT(r,l))})}function KT(r,t){return r.someProp("handleDOMEvents",s=>{let l=s[t.type];return l?l(r,t)||t.defaultPrevented:!1})}function RG(r,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let s=t.target;s!=r.dom;s=s.parentNode)if(!s||s.nodeType==11||s.pmViewDesc&&s.pmViewDesc.stopEvent(t))return!1;return!0}function NG(r,t){!KT(r,t)&&Sl[t.type]&&(r.editable||!(t.type in Tl))&&Sl[t.type](r,t)}Tl.keydown=(r,t)=>{let s=t;if(r.input.shiftKey=s.keyCode==16||s.shiftKey,!mO(r,s)&&(r.input.lastKeyCode=s.keyCode,r.input.lastKeyCodeTime=Date.now(),!(bf&&il&&s.keyCode==13)))if(s.keyCode!=229&&r.domObserver.forceFlush(),Ey&&s.keyCode==13&&!s.ctrlKey&&!s.altKey&&!s.metaKey){let l=Date.now();r.input.lastIOSEnter=l,r.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{r.input.lastIOSEnter==l&&(r.someProp("handleKeyDown",h=>h(r,Jm(13,"Enter"))),r.input.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",l=>l(r,s))||bG(r,s)?s.preventDefault():Up(r,"key")};Tl.keyup=(r,t)=>{t.keyCode==16&&(r.input.shiftKey=!1)};Tl.keypress=(r,t)=>{let s=t;if(mO(r,s)||!s.charCode||s.ctrlKey&&!s.altKey||pu&&s.metaKey)return;if(r.someProp("handleKeyPress",h=>h(r,s))){s.preventDefault();return}let l=r.state.selection;if(!(l instanceof ti)||!l.$from.sameParent(l.$to)){let h=String.fromCharCode(s.charCode),m=()=>r.state.tr.insertText(h).scrollIntoView();!/[\r\n]/.test(h)&&!r.someProp("handleTextInput",v=>v(r,l.$from.pos,l.$to.pos,h,m))&&r.dispatch(m()),s.preventDefault()}};function D1(r){return{left:r.clientX,top:r.clientY}}function DG(r,t){let s=t.x-r.clientX,l=t.y-r.clientY;return s*s+l*l<100}function YT(r,t,s,l,h){if(l==-1)return!1;let m=r.state.doc.resolve(l);for(let v=m.depth+1;v>0;v--)if(r.someProp(t,i=>v>m.depth?i(r,s,m.nodeAfter,m.before(v),h,!0):i(r,s,m.node(v),m.before(v),h,!1)))return!0;return!1}function xy(r,t,s){if(r.focused||r.focus(),r.state.selection.eq(t))return;let l=r.state.tr.setSelection(t);l.setMeta("pointer",!0),r.dispatch(l)}function OG(r,t){if(t==-1)return!1;let s=r.state.doc.resolve(t),l=s.nodeAfter;return l&&l.isAtom&&kn.isSelectable(l)?(xy(r,new kn(s)),!0):!1}function LG(r,t){if(t==-1)return!1;let s=r.state.selection,l,h;s instanceof kn&&(l=s.node);let m=r.state.doc.resolve(t);for(let v=m.depth+1;v>0;v--){let i=v>m.depth?m.nodeAfter:m.node(v);if(kn.isSelectable(i)){l&&s.$from.depth>0&&v>=s.$from.depth&&m.before(s.$from.depth+1)==s.$from.pos?h=m.before(s.$from.depth):h=m.before(v);break}}return h!=null?(xy(r,kn.create(r.state.doc,h)),!0):!1}function zG(r,t,s,l,h){return YT(r,"handleClickOn",t,s,l)||r.someProp("handleClick",m=>m(r,t,l))||(h?LG(r,s):OG(r,s))}function jG(r,t,s,l){return YT(r,"handleDoubleClickOn",t,s,l)||r.someProp("handleDoubleClick",h=>h(r,t,l))}function FG(r,t,s,l){return YT(r,"handleTripleClickOn",t,s,l)||r.someProp("handleTripleClick",h=>h(r,t,l))||BG(r,s,l)}function BG(r,t,s){if(s.button!=0)return!1;let l=r.state.doc;if(t==-1)return l.inlineContent?(xy(r,ti.create(l,0,l.content.size)),!0):!1;let h=l.resolve(t);for(let m=h.depth+1;m>0;m--){let v=m>h.depth?h.nodeAfter:h.node(m),i=h.before(m);if(v.inlineContent)xy(r,ti.create(l,i+1,i+1+v.content.size));else if(kn.isSelectable(v))xy(r,kn.create(l,i));else continue;return!0}}function JT(r){return I0(r)}const pO=pu?"metaKey":"ctrlKey";Sl.mousedown=(r,t)=>{let s=t;r.input.shiftKey=s.shiftKey;let l=JT(r),h=Date.now(),m="singleClick";h-r.input.lastClick.time<500&&DG(s,r.input.lastClick)&&!s[pO]&&r.input.lastClick.button==s.button&&(r.input.lastClick.type=="singleClick"?m="doubleClick":r.input.lastClick.type=="doubleClick"&&(m="tripleClick")),r.input.lastClick={time:h,x:s.clientX,y:s.clientY,type:m,button:s.button};let v=r.posAtCoords(D1(s));v&&(m=="singleClick"?(r.input.mouseDown&&r.input.mouseDown.done(),r.input.mouseDown=new VG(r,v,s,!!l)):(m=="doubleClick"?jG:FG)(r,v.pos,v.inside,s)?s.preventDefault():Up(r,"pointer"))};class VG{constructor(t,s,l,h){this.view=t,this.pos=s,this.event=l,this.flushed=h,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!l[pO],this.allowDefault=l.shiftKey;let m,v;if(s.inside>-1)m=t.state.doc.nodeAt(s.inside),v=s.inside;else{let D=t.state.doc.resolve(s.pos);m=D.parent,v=D.depth?D.before():0}const i=h?null:l.target,A=i?t.docView.nearestDesc(i,!0):null;this.target=A&&A.dom.nodeType==1?A.dom:null;let{selection:P}=t.state;(l.button==0&&m.type.spec.draggable&&m.type.spec.selectable!==!1||P instanceof kn&&P.from<=v&&P.to>v)&&(this.mightDrag={node:m,pos:v,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ph&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Up(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Sf(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let s=this.pos;this.view.state.doc!=this.startDoc&&(s=this.view.posAtCoords(D1(t))),this.updateAllowDefault(t),this.allowDefault||!s?Up(this.view,"pointer"):zG(this.view,s.pos,s.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||wl&&this.mightDrag&&!this.mightDrag.node.isAtom||il&&!this.view.state.selection.visible&&Math.min(Math.abs(s.pos-this.view.state.selection.from),Math.abs(s.pos-this.view.state.selection.to))<=2)?(xy(this.view,xi.near(this.view.state.doc.resolve(s.pos))),t.preventDefault()):Up(this.view,"pointer")}move(t){this.updateAllowDefault(t),Up(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}Sl.touchstart=r=>{r.input.lastTouch=Date.now(),JT(r),Up(r,"pointer")};Sl.touchmove=r=>{r.input.lastTouch=Date.now(),Up(r,"pointer")};Sl.contextmenu=r=>JT(r);function mO(r,t){return r.composing?!0:wl&&Math.abs(t.timeStamp-r.input.compositionEndedAt)<500?(r.input.compositionEndedAt=-2e8,!0):!1}const UG=bf?5e3:-1;Tl.compositionstart=Tl.compositionupdate=r=>{if(!r.composing){r.domObserver.flush();let{state:t}=r,s=t.selection.$to;if(t.selection instanceof ti&&(t.storedMarks||!s.textOffset&&s.parentOffset&&s.nodeBefore.marks.some(l=>l.type.spec.inclusive===!1)))r.markCursor=r.state.storedMarks||s.marks(),I0(r,!0),r.markCursor=null;else if(I0(r,!t.selection.empty),ph&&t.selection.empty&&s.parentOffset&&!s.textOffset&&s.nodeBefore.marks.length){let l=r.domSelectionRange();for(let h=l.focusNode,m=l.focusOffset;h&&h.nodeType==1&&m!=0;){let v=m<0?h.lastChild:h.childNodes[m-1];if(!v)break;if(v.nodeType==3){let i=r.domSelection();i&&i.collapse(v,v.nodeValue.length);break}else h=v,m=-1}}r.input.composing=!0}gO(r,UG)};Tl.compositionend=(r,t)=>{r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=t.timeStamp,r.input.compositionPendingChanges=r.domObserver.pendingRecords().length?r.input.compositionID:0,r.input.compositionNode=null,r.input.compositionPendingChanges&&Promise.resolve().then(()=>r.domObserver.flush()),r.input.compositionID++,gO(r,20))};function gO(r,t){clearTimeout(r.input.composingTimeout),t>-1&&(r.input.composingTimeout=setTimeout(()=>I0(r),t))}function yO(r){for(r.composing&&(r.input.composing=!1,r.input.compositionEndedAt=HG());r.input.compositionNodes.length>0;)r.input.compositionNodes.pop().markParentsDirty()}function $G(r){let t=r.domSelectionRange();if(!t.focusNode)return null;let s=OH(t.focusNode,t.focusOffset),l=LH(t.focusNode,t.focusOffset);if(s&&l&&s!=l){let h=l.pmViewDesc,m=r.domObserver.lastChangedTextNode;if(s==m||l==m)return m;if(!h||!h.isText(l.nodeValue))return l;if(r.input.compositionNode==l){let v=s.pmViewDesc;if(!(!v||!v.isText(s.nodeValue)))return l}}return s||l}function HG(){let r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function I0(r,t=!1){if(!(bf&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),yO(r),t||r.docView&&r.docView.dirty){let s=WT(r),l=r.state.selection;return s&&!s.eq(l)?r.dispatch(r.state.tr.setSelection(s)):(r.markCursor||t)&&!l.$from.node(l.$from.sharedDepth(l.to)).inlineContent?r.dispatch(r.state.tr.deleteSelection()):r.updateState(r.state),!0}return!1}}function GG(r,t){if(!r.dom.parentNode)return;let s=r.dom.parentNode.appendChild(document.createElement("div"));s.appendChild(t),s.style.cssText="position: fixed; left: -10000px; top: 10px";let l=getSelection(),h=document.createRange();h.selectNodeContents(t),r.dom.blur(),l.removeAllRanges(),l.addRange(h),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),r.focus()},50)}const ox=Yl&&Wp<15||Ey&&VH<604;Sl.copy=Tl.cut=(r,t)=>{let s=t,l=r.state.selection,h=s.type=="cut";if(l.empty)return;let m=ox?null:s.clipboardData,v=l.content(),{dom:i,text:A}=XT(r,v);m?(s.preventDefault(),m.clearData(),m.setData("text/html",i.innerHTML),m.setData("text/plain",A)):GG(r,i),h&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function qG(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function WG(r,t){if(!r.dom.parentNode)return;let s=r.input.shiftKey||r.state.selection.$from.parent.type.spec.code,l=r.dom.parentNode.appendChild(document.createElement(s?"textarea":"div"));s||(l.contentEditable="true"),l.style.cssText="position: fixed; left: -10000px; top: 10px",l.focus();let h=r.input.shiftKey&&r.input.lastKeyCode!=45;setTimeout(()=>{r.focus(),l.parentNode&&l.parentNode.removeChild(l),s?ax(r,l.value,null,h,t):ax(r,l.textContent,l.innerHTML,h,t)},50)}function ax(r,t,s,l,h){let m=lO(r,t,s,l,r.state.selection.$from);if(r.someProp("handlePaste",A=>A(r,h,m||Yr.empty)))return!0;if(!m)return!1;let v=qG(m),i=v?r.state.tr.replaceSelectionWith(v,l):r.state.tr.replaceSelection(m);return r.dispatch(i.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function _O(r){let t=r.getData("text/plain")||r.getData("Text");if(t)return t;let s=r.getData("text/uri-list");return s?s.replace(/\r?\n/g," "):""}Tl.paste=(r,t)=>{let s=t;if(r.composing&&!bf)return;let l=ox?null:s.clipboardData,h=r.input.shiftKey&&r.input.lastKeyCode!=45;l&&ax(r,_O(l),l.getData("text/html"),h,s)?s.preventDefault():WG(r,s)};class xO{constructor(t,s,l){this.slice=t,this.move=s,this.node=l}}const ZG=pu?"altKey":"ctrlKey";function vO(r,t){let s=r.someProp("dragCopies",l=>!l(t));return s??!t[ZG]}Sl.dragstart=(r,t)=>{let s=t,l=r.input.mouseDown;if(l&&l.done(),!s.dataTransfer)return;let h=r.state.selection,m=h.empty?null:r.posAtCoords(D1(s)),v;if(!(m&&m.pos>=h.from&&m.pos<=(h instanceof kn?h.to-1:h.to))){if(l&&l.mightDrag)v=kn.create(r.state.doc,l.mightDrag.pos);else if(s.target&&s.target.nodeType==1){let F=r.docView.nearestDesc(s.target,!0);F&&F.node.type.spec.draggable&&F!=r.docView&&(v=kn.create(r.state.doc,F.posBefore))}}let i=(v||r.state.selection).content(),{dom:A,text:P,slice:D}=XT(r,i);(!s.dataTransfer.files.length||!il||qD>120)&&s.dataTransfer.clearData(),s.dataTransfer.setData(ox?"Text":"text/html",A.innerHTML),s.dataTransfer.effectAllowed="copyMove",ox||s.dataTransfer.setData("text/plain",P),r.dragging=new xO(D,vO(r,s),v)};Sl.dragend=r=>{let t=r.dragging;window.setTimeout(()=>{r.dragging==t&&(r.dragging=null)},50)};Tl.dragover=Tl.dragenter=(r,t)=>t.preventDefault();Tl.drop=(r,t)=>{let s=t,l=r.dragging;if(r.dragging=null,!s.dataTransfer)return;let h=r.posAtCoords(D1(s));if(!h)return;let m=r.state.doc.resolve(h.pos),v=l&&l.slice;v?r.someProp("transformPasted",J=>{v=J(v,r)}):v=lO(r,_O(s.dataTransfer),ox?null:s.dataTransfer.getData("text/html"),!1,m);let i=!!(l&&vO(r,s));if(r.someProp("handleDrop",J=>J(r,s,v||Yr.empty,i))){s.preventDefault();return}if(!v)return;s.preventDefault();let A=v?zD(r.state.doc,m.pos,v):m.pos;A==null&&(A=m.pos);let P=r.state.tr;if(i){let{node:J}=l;J?J.replace(P):P.deleteSelection()}let D=P.mapping.map(A),F=v.openStart==0&&v.openEnd==0&&v.content.childCount==1,$=P.doc;if(F?P.replaceRangeWith(D,D,v.content.firstChild):P.replaceRange(D,D,v),P.doc.eq($))return;let K=P.doc.resolve(D);if(F&&kn.isSelectable(v.content.firstChild)&&K.nodeAfter&&K.nodeAfter.sameMarkup(v.content.firstChild))P.setSelection(new kn(K));else{let J=P.mapping.map(A);P.mapping.maps[P.mapping.maps.length-1].forEach((W,ie,fe,Pe)=>J=Pe),P.setSelection(ZT(r,K,P.doc.resolve(J)))}r.focus(),r.dispatch(P.setMeta("uiEvent","drop"))};Sl.focus=r=>{r.input.lastFocus=Date.now(),r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(()=>{r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.domSelectionRange())&&Sf(r)},20))};Sl.blur=(r,t)=>{let s=t;r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),s.relatedTarget&&r.dom.contains(s.relatedTarget)&&r.domObserver.currentSelection.clear(),r.focused=!1)};Sl.beforeinput=(r,t)=>{if(il&&bf&&t.inputType=="deleteContentBackward"){r.domObserver.flushSoon();let{domChangeCount:l}=r.input;setTimeout(()=>{if(r.input.domChangeCount!=l||(r.dom.blur(),r.focus(),r.someProp("handleKeyDown",m=>m(r,Jm(8,"Backspace")))))return;let{$cursor:h}=r.state.selection;h&&h.pos>0&&r.dispatch(r.state.tr.delete(h.pos-1,h.pos).scrollIntoView())},50)}};for(let r in Tl)Sl[r]=Tl[r];function lx(r,t){if(r==t)return!0;for(let s in r)if(r[s]!==t[s])return!1;for(let s in t)if(!(s in r))return!1;return!0}class M0{constructor(t,s){this.toDOM=t,this.spec=s||ag,this.side=this.spec.side||0}map(t,s,l,h){let{pos:m,deleted:v}=t.mapResult(s.from+h,this.side<0?-1:1);return v?null:new bl(m-l,m-l,this)}valid(){return!0}eq(t){return this==t||t instanceof M0&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&lx(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Xp{constructor(t,s){this.attrs=t,this.spec=s||ag}map(t,s,l,h){let m=t.map(s.from+h,this.spec.inclusiveStart?-1:1)-l,v=t.map(s.to+h,this.spec.inclusiveEnd?1:-1)-l;return m>=v?null:new bl(m,v,this)}valid(t,s){return s.from<s.to}eq(t){return this==t||t instanceof Xp&&lx(this.attrs,t.attrs)&&lx(this.spec,t.spec)}static is(t){return t.type instanceof Xp}destroy(){}}class QT{constructor(t,s){this.attrs=t,this.spec=s||ag}map(t,s,l,h){let m=t.mapResult(s.from+h,1);if(m.deleted)return null;let v=t.mapResult(s.to+h,-1);return v.deleted||v.pos<=m.pos?null:new bl(m.pos-l,v.pos-l,this)}valid(t,s){let{index:l,offset:h}=t.content.findIndex(s.from),m;return h==s.from&&!(m=t.child(l)).isText&&h+m.nodeSize==s.to}eq(t){return this==t||t instanceof QT&&lx(this.attrs,t.attrs)&&lx(this.spec,t.spec)}destroy(){}}class bl{constructor(t,s,l){this.from=t,this.to=s,this.type=l}copy(t,s){return new bl(t,s,this.type)}eq(t,s=0){return this.type.eq(t.type)&&this.from+s==t.from&&this.to+s==t.to}map(t,s,l){return this.type.map(t,this,s,l)}static widget(t,s,l){return new bl(t,t,new M0(s,l))}static inline(t,s,l,h){return new bl(t,s,new Xp(l,h))}static node(t,s,l,h){return new bl(t,s,new QT(l,h))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xp}get widget(){return this.type instanceof M0}}const uy=[],ag={};class eo{constructor(t,s){this.local=t.length?t:uy,this.children=s.length?s:uy}static create(t,s){return s.length?k0(s,t,0,ag):rl}find(t,s,l){let h=[];return this.findInner(t??0,s??1e9,h,0,l),h}findInner(t,s,l,h,m){for(let v=0;v<this.local.length;v++){let i=this.local[v];i.from<=s&&i.to>=t&&(!m||m(i.spec))&&l.push(i.copy(i.from+h,i.to+h))}for(let v=0;v<this.children.length;v+=3)if(this.children[v]<s&&this.children[v+1]>t){let i=this.children[v]+1;this.children[v+2].findInner(t-i,s-i,l,h+i,m)}}map(t,s,l){return this==rl||t.maps.length==0?this:this.mapInner(t,s,0,0,l||ag)}mapInner(t,s,l,h,m){let v;for(let i=0;i<this.local.length;i++){let A=this.local[i].map(t,l,h);A&&A.type.valid(s,A)?(v||(v=[])).push(A):m.onRemove&&m.onRemove(this.local[i].spec)}return this.children.length?XG(this.children,v||[],t,s,l,h,m):v?new eo(v.sort(lg),uy):rl}add(t,s){return s.length?this==rl?eo.create(t,s):this.addInner(t,s,0):this}addInner(t,s,l){let h,m=0;t.forEach((i,A)=>{let P=A+l,D;if(D=wO(s,i,P)){for(h||(h=this.children.slice());m<h.length&&h[m]<A;)m+=3;h[m]==A?h[m+2]=h[m+2].addInner(i,D,P+1):h.splice(m,0,A,A+i.nodeSize,k0(D,i,P+1,ag)),m+=3}});let v=bO(m?SO(s):s,-l);for(let i=0;i<v.length;i++)v[i].type.valid(t,v[i])||v.splice(i--,1);return new eo(v.length?this.local.concat(v).sort(lg):this.local,h||this.children)}remove(t){return t.length==0||this==rl?this:this.removeInner(t,0)}removeInner(t,s){let l=this.children,h=this.local;for(let m=0;m<l.length;m+=3){let v,i=l[m]+s,A=l[m+1]+s;for(let D=0,F;D<t.length;D++)(F=t[D])&&F.from>i&&F.to<A&&(t[D]=null,(v||(v=[])).push(F));if(!v)continue;l==this.children&&(l=this.children.slice());let P=l[m+2].removeInner(v,i+1);P!=rl?l[m+2]=P:(l.splice(m,3),m-=3)}if(h.length){for(let m=0,v;m<t.length;m++)if(v=t[m])for(let i=0;i<h.length;i++)h[i].eq(v,s)&&(h==this.local&&(h=this.local.slice()),h.splice(i--,1))}return l==this.children&&h==this.local?this:h.length||l.length?new eo(h,l):rl}forChild(t,s){if(this==rl)return this;if(s.isLeaf)return eo.empty;let l,h;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=t){this.children[i]==t&&(l=this.children[i+2]);break}let m=t+1,v=m+s.content.size;for(let i=0;i<this.local.length;i++){let A=this.local[i];if(A.from<v&&A.to>m&&A.type instanceof Xp){let P=Math.max(m,A.from)-m,D=Math.min(v,A.to)-m;P<D&&(h||(h=[])).push(A.copy(P,D))}}if(h){let i=new eo(h.sort(lg),uy);return l?new zp([i,l]):i}return l||rl}eq(t){if(this==t)return!0;if(!(t instanceof eo)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let s=0;s<this.local.length;s++)if(!this.local[s].eq(t.local[s]))return!1;for(let s=0;s<this.children.length;s+=3)if(this.children[s]!=t.children[s]||this.children[s+1]!=t.children[s+1]||!this.children[s+2].eq(t.children[s+2]))return!1;return!0}locals(t){return e2(this.localsInner(t))}localsInner(t){if(this==rl)return uy;if(t.inlineContent||!this.local.some(Xp.is))return this.local;let s=[];for(let l=0;l<this.local.length;l++)this.local[l].type instanceof Xp||s.push(this.local[l]);return s}forEachSet(t){t(this)}}eo.empty=new eo([],[]);eo.removeOverlap=e2;const rl=eo.empty;class zp{constructor(t){this.members=t}map(t,s){const l=this.members.map(h=>h.map(t,s,ag));return zp.from(l)}forChild(t,s){if(s.isLeaf)return eo.empty;let l=[];for(let h=0;h<this.members.length;h++){let m=this.members[h].forChild(t,s);m!=rl&&(m instanceof zp?l=l.concat(m.members):l.push(m))}return zp.from(l)}eq(t){if(!(t instanceof zp)||t.members.length!=this.members.length)return!1;for(let s=0;s<this.members.length;s++)if(!this.members[s].eq(t.members[s]))return!1;return!0}locals(t){let s,l=!0;for(let h=0;h<this.members.length;h++){let m=this.members[h].localsInner(t);if(m.length)if(!s)s=m;else{l&&(s=s.slice(),l=!1);for(let v=0;v<m.length;v++)s.push(m[v])}}return s?e2(l?s:s.sort(lg)):uy}static from(t){switch(t.length){case 0:return rl;case 1:return t[0];default:return new zp(t.every(s=>s instanceof eo)?t:t.reduce((s,l)=>s.concat(l instanceof eo?l:l.members),[]))}}forEachSet(t){for(let s=0;s<this.members.length;s++)this.members[s].forEachSet(t)}}function XG(r,t,s,l,h,m,v){let i=r.slice();for(let P=0,D=m;P<s.maps.length;P++){let F=0;s.maps[P].forEach(($,K,J,W)=>{let ie=W-J-(K-$);for(let fe=0;fe<i.length;fe+=3){let Pe=i[fe+1];if(Pe<0||$>Pe+D-F)continue;let Fe=i[fe]+D-F;K>=Fe?i[fe+1]=$<=Fe?-2:-1:$>=D&&ie&&(i[fe]+=ie,i[fe+1]+=ie)}F+=ie}),D=s.maps[P].map(D,-1)}let A=!1;for(let P=0;P<i.length;P+=3)if(i[P+1]<0){if(i[P+1]==-2){A=!0,i[P+1]=-1;continue}let D=s.map(r[P]+m),F=D-h;if(F<0||F>=l.content.size){A=!0;continue}let $=s.map(r[P+1]+m,-1),K=$-h,{index:J,offset:W}=l.content.findIndex(F),ie=l.maybeChild(J);if(ie&&W==F&&W+ie.nodeSize==K){let fe=i[P+2].mapInner(s,ie,D+1,r[P]+m+1,v);fe!=rl?(i[P]=F,i[P+1]=K,i[P+2]=fe):(i[P+1]=-2,A=!0)}else A=!0}if(A){let P=KG(i,r,t,s,h,m,v),D=k0(P,l,0,v);t=D.local;for(let F=0;F<i.length;F+=3)i[F+1]<0&&(i.splice(F,3),F-=3);for(let F=0,$=0;F<D.children.length;F+=3){let K=D.children[F];for(;$<i.length&&i[$]<K;)$+=3;i.splice($,0,D.children[F],D.children[F+1],D.children[F+2])}}return new eo(t.sort(lg),i)}function bO(r,t){if(!t||!r.length)return r;let s=[];for(let l=0;l<r.length;l++){let h=r[l];s.push(new bl(h.from+t,h.to+t,h.type))}return s}function KG(r,t,s,l,h,m,v){function i(A,P){for(let D=0;D<A.local.length;D++){let F=A.local[D].map(l,h,P);F?s.push(F):v.onRemove&&v.onRemove(A.local[D].spec)}for(let D=0;D<A.children.length;D+=3)i(A.children[D+2],A.children[D]+P+1)}for(let A=0;A<r.length;A+=3)r[A+1]==-1&&i(r[A+2],t[A]+m+1);return s}function wO(r,t,s){if(t.isLeaf)return null;let l=s+t.nodeSize,h=null;for(let m=0,v;m<r.length;m++)(v=r[m])&&v.from>s&&v.to<l&&((h||(h=[])).push(v),r[m]=null);return h}function SO(r){let t=[];for(let s=0;s<r.length;s++)r[s]!=null&&t.push(r[s]);return t}function k0(r,t,s,l){let h=[],m=!1;t.forEach((i,A)=>{let P=wO(r,i,A+s);if(P){m=!0;let D=k0(P,i,s+A+1,l);D!=rl&&h.push(A,A+i.nodeSize,D)}});let v=bO(m?SO(r):r,-s).sort(lg);for(let i=0;i<v.length;i++)v[i].type.valid(t,v[i])||(l.onRemove&&l.onRemove(v[i].spec),v.splice(i--,1));return v.length||h.length?new eo(v,h):rl}function lg(r,t){return r.from-t.from||r.to-t.to}function e2(r){let t=r;for(let s=0;s<t.length-1;s++){let l=t[s];if(l.from!=l.to)for(let h=s+1;h<t.length;h++){let m=t[h];if(m.from==l.from){m.to!=l.to&&(t==r&&(t=r.slice()),t[h]=m.copy(m.from,l.to),JM(t,h+1,m.copy(l.to,m.to)));continue}else{m.from<l.to&&(t==r&&(t=r.slice()),t[s]=l.copy(l.from,m.from),JM(t,h,l.copy(m.from,l.to)));break}}}return t}function JM(r,t,s){for(;t<r.length&&lg(s,r[t])>0;)t++;r.splice(t,0,s)}function Ow(r){let t=[];return r.someProp("decorations",s=>{let l=s(r.state);l&&l!=rl&&t.push(l)}),r.cursorWrapper&&t.push(eo.create(r.state.doc,[r.cursorWrapper.deco])),zp.from(t)}const YG={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},JG=Yl&&Wp<=11;class QG{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class eq{constructor(t,s){this.view=t,this.handleDOMChange=s,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new QG,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(l=>{for(let h=0;h<l.length;h++)this.queue.push(l[h]);Yl&&Wp<=11&&l.some(h=>h.type=="childList"&&h.removedNodes.length||h.type=="characterData"&&h.oldValue.length>h.target.nodeValue.length)?this.flushSoon():this.flush()}),JG&&(this.onCharData=l=>{this.queue.push({target:l.target,type:"characterData",oldValue:l.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,YG)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let s=0;s<t.length;s++)this.queue.push(t[s]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(HM(this.view)){if(this.suppressingSelectionUpdates)return Sf(this.view);if(Yl&&Wp<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&xg(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let s=new Set,l;for(let m=t.focusNode;m;m=Ty(m))s.add(m);for(let m=t.anchorNode;m;m=Ty(m))if(s.has(m)){l=m;break}let h=l&&this.view.docView.nearestDesc(l);if(h&&h.ignoreMutation({type:"selection",target:l.nodeType==3?l.parentNode:l}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let s=this.pendingRecords();s.length&&(this.queue=[]);let l=t.domSelectionRange(),h=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(l)&&HM(t)&&!this.ignoreSelectionChange(l),m=-1,v=-1,i=!1,A=[];if(t.editable)for(let D=0;D<s.length;D++){let F=this.registerMutation(s[D],A);F&&(m=m<0?F.from:Math.min(F.from,m),v=v<0?F.to:Math.max(F.to,v),F.typeOver&&(i=!0))}if(ph&&A.length){let D=A.filter(F=>F.nodeName=="BR");if(D.length==2){let[F,$]=D;F.parentNode&&F.parentNode.parentNode==$.parentNode?$.remove():F.remove()}else{let{focusNode:F}=this.currentSelection;for(let $ of D){let K=$.parentNode;K&&K.nodeName=="LI"&&(!F||nq(t,F)!=K)&&$.remove()}}}let P=null;m<0&&h&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&R1(l)&&(P=WT(t))&&P.eq(xi.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Sf(t),this.currentSelection.set(l),t.scrollToSelection()):(m>-1||h)&&(m>-1&&(t.docView.markDirty(m,v),tq(t)),this.handleDOMChange(m,v,i,A),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(l)||Sf(t),this.currentSelection.set(l))}registerMutation(t,s){if(s.indexOf(t.target)>-1)return null;let l=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(l==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!l||l.ignoreMutation(t))return null;if(t.type=="childList"){for(let D=0;D<t.addedNodes.length;D++){let F=t.addedNodes[D];s.push(F),F.nodeType==3&&(this.lastChangedTextNode=F)}if(l.contentDOM&&l.contentDOM!=l.dom&&!l.contentDOM.contains(t.target))return{from:l.posBefore,to:l.posAfter};let h=t.previousSibling,m=t.nextSibling;if(Yl&&Wp<=11&&t.addedNodes.length)for(let D=0;D<t.addedNodes.length;D++){let{previousSibling:F,nextSibling:$}=t.addedNodes[D];(!F||Array.prototype.indexOf.call(t.addedNodes,F)<0)&&(h=F),(!$||Array.prototype.indexOf.call(t.addedNodes,$)<0)&&(m=$)}let v=h&&h.parentNode==t.target?za(h)+1:0,i=l.localPosFromDOM(t.target,v,-1),A=m&&m.parentNode==t.target?za(m):t.target.childNodes.length,P=l.localPosFromDOM(t.target,A,1);return{from:i,to:P}}else return t.type=="attributes"?{from:l.posAtStart-l.border,to:l.posAtEnd+l.border}:(this.lastChangedTextNode=t.target,{from:l.posAtStart,to:l.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let QM=new WeakMap,ek=!1;function tq(r){if(!QM.has(r)&&(QM.set(r,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(r.dom).whiteSpace)!==-1)){if(r.requiresGeckoHackNode=ph,ek)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),ek=!0}}function tk(r,t){let s=t.startContainer,l=t.startOffset,h=t.endContainer,m=t.endOffset,v=r.domAtPos(r.state.selection.anchor);return xg(v.node,v.offset,h,m)&&([s,l,h,m]=[h,m,s,l]),{anchorNode:s,anchorOffset:l,focusNode:h,focusOffset:m}}function rq(r,t){if(t.getComposedRanges){let h=t.getComposedRanges(r.root)[0];if(h)return tk(r,h)}let s;function l(h){h.preventDefault(),h.stopImmediatePropagation(),s=h.getTargetRanges()[0]}return r.dom.addEventListener("beforeinput",l,!0),document.execCommand("indent"),r.dom.removeEventListener("beforeinput",l,!0),s?tk(r,s):null}function nq(r,t){for(let s=t.parentNode;s&&s!=r.dom;s=s.parentNode){let l=r.docView.nearestDesc(s,!0);if(l&&l.node.isBlock)return s}return null}function iq(r,t,s){let{node:l,fromOffset:h,toOffset:m,from:v,to:i}=r.docView.parseRange(t,s),A=r.domSelectionRange(),P,D=A.anchorNode;if(D&&r.dom.contains(D.nodeType==1?D:D.parentNode)&&(P=[{node:D,offset:A.anchorOffset}],R1(A)||P.push({node:A.focusNode,offset:A.focusOffset})),il&&r.input.lastKeyCode===8)for(let ie=m;ie>h;ie--){let fe=l.childNodes[ie-1],Pe=fe.pmViewDesc;if(fe.nodeName=="BR"&&!Pe){m=ie;break}if(!Pe||Pe.size)break}let F=r.state.doc,$=r.someProp("domParser")||qp.fromSchema(r.state.schema),K=F.resolve(v),J=null,W=$.parse(l,{topNode:K.parent,topMatch:K.parent.contentMatchAt(K.index()),topOpen:!0,from:h,to:m,preserveWhitespace:K.parent.type.whitespace=="pre"?"full":!0,findPositions:P,ruleFromNode:sq,context:K});if(P&&P[0].pos!=null){let ie=P[0].pos,fe=P[1]&&P[1].pos;fe==null&&(fe=ie),J={anchor:ie+v,head:fe+v}}return{doc:W,sel:J,from:v,to:i}}function sq(r){let t=r.pmViewDesc;if(t)return t.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(wl&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){let s=document.createElement("div");return s.appendChild(document.createElement("li")),{skip:s}}else if(r.parentNode.lastChild==r||wl&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0};return null}const oq=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function aq(r,t,s,l,h){let m=r.input.compositionPendingChanges||(r.composing?r.input.compositionID:0);if(r.input.compositionPendingChanges=0,t<0){let Rt=r.input.lastSelectionTime>Date.now()-50?r.input.lastSelectionOrigin:null,hr=WT(r,Rt);if(hr&&!r.state.selection.eq(hr)){if(il&&bf&&r.input.lastKeyCode===13&&Date.now()-100<r.input.lastKeyCodeTime&&r.someProp("handleKeyDown",_r=>_r(r,Jm(13,"Enter"))))return;let Tr=r.state.tr.setSelection(hr);Rt=="pointer"?Tr.setMeta("pointer",!0):Rt=="key"&&Tr.scrollIntoView(),m&&Tr.setMeta("composition",m),r.dispatch(Tr)}return}let v=r.state.doc.resolve(t),i=v.sharedDepth(s);t=v.before(i+1),s=r.state.doc.resolve(s).after(i+1);let A=r.state.selection,P=iq(r,t,s),D=r.state.doc,F=D.slice(P.from,P.to),$,K;r.input.lastKeyCode===8&&Date.now()-100<r.input.lastKeyCodeTime?($=r.state.selection.to,K="end"):($=r.state.selection.from,K="start"),r.input.lastKeyCode=null;let J=uq(F.content,P.doc.content,P.from,$,K);if(J&&r.input.domChangeCount++,(Ey&&r.input.lastIOSEnter>Date.now()-225||bf)&&h.some(Rt=>Rt.nodeType==1&&!oq.test(Rt.nodeName))&&(!J||J.endA>=J.endB)&&r.someProp("handleKeyDown",Rt=>Rt(r,Jm(13,"Enter")))){r.input.lastIOSEnter=0;return}if(!J)if(l&&A instanceof ti&&!A.empty&&A.$head.sameParent(A.$anchor)&&!r.composing&&!(P.sel&&P.sel.anchor!=P.sel.head))J={start:A.from,endA:A.to,endB:A.to};else{if(P.sel){let Rt=rk(r,r.state.doc,P.sel);if(Rt&&!Rt.eq(r.state.selection)){let hr=r.state.tr.setSelection(Rt);m&&hr.setMeta("composition",m),r.dispatch(hr)}}return}r.state.selection.from<r.state.selection.to&&J.start==J.endB&&r.state.selection instanceof ti&&(J.start>r.state.selection.from&&J.start<=r.state.selection.from+2&&r.state.selection.from>=P.from?J.start=r.state.selection.from:J.endA<r.state.selection.to&&J.endA>=r.state.selection.to-2&&r.state.selection.to<=P.to&&(J.endB+=r.state.selection.to-J.endA,J.endA=r.state.selection.to)),Yl&&Wp<=11&&J.endB==J.start+1&&J.endA==J.start&&J.start>P.from&&P.doc.textBetween(J.start-P.from-1,J.start-P.from+1)==" "&&(J.start--,J.endA--,J.endB--);let W=P.doc.resolveNoCache(J.start-P.from),ie=P.doc.resolveNoCache(J.endB-P.from),fe=D.resolve(J.start),Pe=W.sameParent(ie)&&W.parent.inlineContent&&fe.end()>=J.endA,Fe;if((Ey&&r.input.lastIOSEnter>Date.now()-225&&(!Pe||h.some(Rt=>Rt.nodeName=="DIV"||Rt.nodeName=="P"))||!Pe&&W.pos<P.doc.content.size&&(!W.sameParent(ie)||!W.parent.inlineContent)&&!/\S/.test(P.doc.textBetween(W.pos,ie.pos,"",""))&&(Fe=xi.findFrom(P.doc.resolve(W.pos+1),1,!0))&&Fe.head>W.pos)&&r.someProp("handleKeyDown",Rt=>Rt(r,Jm(13,"Enter")))){r.input.lastIOSEnter=0;return}if(r.state.selection.anchor>J.start&&cq(D,J.start,J.endA,W,ie)&&r.someProp("handleKeyDown",Rt=>Rt(r,Jm(8,"Backspace")))){bf&&il&&r.domObserver.suppressSelectionUpdates();return}il&&J.endB==J.start&&(r.input.lastChromeDelete=Date.now()),bf&&!Pe&&W.start()!=ie.start()&&ie.parentOffset==0&&W.depth==ie.depth&&P.sel&&P.sel.anchor==P.sel.head&&P.sel.head==J.endA&&(J.endB-=2,ie=P.doc.resolveNoCache(J.endB-P.from),setTimeout(()=>{r.someProp("handleKeyDown",function(Rt){return Rt(r,Jm(13,"Enter"))})},20));let ht=J.start,at=J.endA,Dt=Rt=>{let hr=Rt||r.state.tr.replace(ht,at,P.doc.slice(J.start-P.from,J.endB-P.from));if(P.sel){let Tr=rk(r,hr.doc,P.sel);Tr&&!(il&&r.composing&&Tr.empty&&(J.start!=J.endB||r.input.lastChromeDelete<Date.now()-100)&&(Tr.head==ht||Tr.head==hr.mapping.map(at)-1)||Yl&&Tr.empty&&Tr.head==ht)&&hr.setSelection(Tr)}return m&&hr.setMeta("composition",m),hr.scrollIntoView()},kt;if(Pe){if(W.pos==ie.pos){Yl&&Wp<=11&&W.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(()=>Sf(r),20));let Rt=Dt(r.state.tr.delete(ht,at)),hr=D.resolve(J.start).marksAcross(D.resolve(J.endA));hr&&Rt.ensureMarks(hr),r.dispatch(Rt)}else if(J.endA==J.endB&&(kt=lq(W.parent.content.cut(W.parentOffset,ie.parentOffset),fe.parent.content.cut(fe.parentOffset,J.endA-fe.start())))){let Rt=Dt(r.state.tr);kt.type=="add"?Rt.addMark(ht,at,kt.mark):Rt.removeMark(ht,at,kt.mark),r.dispatch(Rt)}else if(W.parent.child(W.index()).isText&&W.index()==ie.index()-(ie.textOffset?0:1)){let Rt=W.parent.textBetween(W.parentOffset,ie.parentOffset),hr=()=>Dt(r.state.tr.insertText(Rt,ht,at));r.someProp("handleTextInput",Tr=>Tr(r,ht,at,Rt,hr))||r.dispatch(hr())}}else r.dispatch(Dt())}function rk(r,t,s){return Math.max(s.anchor,s.head)>t.content.size?null:ZT(r,t.resolve(s.anchor),t.resolve(s.head))}function lq(r,t){let s=r.firstChild.marks,l=t.firstChild.marks,h=s,m=l,v,i,A;for(let D=0;D<l.length;D++)h=l[D].removeFromSet(h);for(let D=0;D<s.length;D++)m=s[D].removeFromSet(m);if(h.length==1&&m.length==0)i=h[0],v="add",A=D=>D.mark(i.addToSet(D.marks));else if(h.length==0&&m.length==1)i=m[0],v="remove",A=D=>D.mark(i.removeFromSet(D.marks));else return null;let P=[];for(let D=0;D<t.childCount;D++)P.push(A(t.child(D)));if(dr.from(P).eq(r))return{mark:i,type:v}}function cq(r,t,s,l,h){if(s-t<=h.pos-l.pos||Lw(l,!0,!1)<h.pos)return!1;let m=r.resolve(t);if(!l.parent.isTextblock){let i=m.nodeAfter;return i!=null&&s==t+i.nodeSize}if(m.parentOffset<m.parent.content.size||!m.parent.isTextblock)return!1;let v=r.resolve(Lw(m,!0,!0));return!v.parent.isTextblock||v.pos>s||Lw(v,!0,!1)<s?!1:l.parent.content.cut(l.parentOffset).eq(v.parent.content)}function Lw(r,t,s){let l=r.depth,h=t?r.end():r.pos;for(;l>0&&(t||r.indexAfter(l)==r.node(l).childCount);)l--,h++,t=!1;if(s){let m=r.node(l).maybeChild(r.indexAfter(l));for(;m&&!m.isLeaf;)m=m.firstChild,h++}return h}function uq(r,t,s,l,h){let m=r.findDiffStart(t,s);if(m==null)return null;let{a:v,b:i}=r.findDiffEnd(t,s+r.size,s+t.size);if(h=="end"){let A=Math.max(0,m-Math.min(v,i));l-=v+A-m}if(v<m&&r.size<t.size){let A=l<=m&&l>=v?m-l:0;m-=A,m&&m<t.size&&nk(t.textBetween(m-1,m+1))&&(m+=A?1:-1),i=m+(i-v),v=m}else if(i<m){let A=l<=m&&l>=i?m-l:0;m-=A,m&&m<r.size&&nk(r.textBetween(m-1,m+1))&&(m+=A?1:-1),v=m+(v-i),i=m}return{start:m,endA:v,endB:i}}function nk(r){if(r.length!=2)return!1;let t=r.charCodeAt(0),s=r.charCodeAt(1);return t>=56320&&t<=57343&&s>=55296&&s<=56319}class TO{constructor(t,s){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new MG,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=s,this.state=s.state,this.directPlugins=s.plugins||[],this.directPlugins.forEach(lk),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=ok(this),sk(this),this.nodeViews=ak(this),this.docView=jM(this.state.doc,ik(this),Ow(this),this.dom,this),this.domObserver=new eq(this,(l,h,m,v)=>aq(this,l,h,m,v)),this.domObserver.start(),kG(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let s in t)this._props[s]=t[s];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&HS(this);let s=this._props;this._props=t,t.plugins&&(t.plugins.forEach(lk),this.directPlugins=t.plugins),this.updateStateInner(t.state,s)}setProps(t){let s={};for(let l in this._props)s[l]=this._props[l];s.state=this.state;for(let l in t)s[l]=t[l];this.update(s)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,s){var l;let h=this.state,m=!1,v=!1;t.storedMarks&&this.composing&&(yO(this),v=!0),this.state=t;let i=h.plugins!=t.plugins||this._props.plugins!=s.plugins;if(i||this._props.plugins!=s.plugins||this._props.nodeViews!=s.nodeViews){let K=ak(this);dq(K,this.nodeViews)&&(this.nodeViews=K,m=!0)}(i||s.handleDOMEvents!=this._props.handleDOMEvents)&&HS(this),this.editable=ok(this),sk(this);let A=Ow(this),P=ik(this),D=h.plugins!=t.plugins&&!h.doc.eq(t.doc)?"reset":t.scrollToSelection>h.scrollToSelection?"to selection":"preserve",F=m||!this.docView.matchesNode(t.doc,P,A);(F||!t.selection.eq(h.selection))&&(v=!0);let $=D=="preserve"&&v&&this.dom.style.overflowAnchor==null&&HH(this);if(v){this.domObserver.stop();let K=F&&(Yl||il)&&!this.composing&&!h.selection.empty&&!t.selection.empty&&hq(h.selection,t.selection);if(F){let J=il?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=$G(this)),(m||!this.docView.update(t.doc,P,A,this))&&(this.docView.updateOuterDeco(P),this.docView.destroy(),this.docView=jM(t.doc,P,A,this.dom,this)),J&&!this.trackWrites&&(K=!0)}K||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&pG(this))?Sf(this,K):(sO(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(h),!((l=this.dragging)===null||l===void 0)&&l.node&&!h.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,h),D=="reset"?this.dom.scrollTop=0:D=="to selection"?this.scrollToSelection():$&&GH($)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",s=>s(this)))if(this.state.selection instanceof kn){let s=this.docView.domAfterPos(this.state.selection.from);s.nodeType==1&&RM(this,s.getBoundingClientRect(),t)}else RM(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let s=0;s<this.directPlugins.length;s++){let l=this.directPlugins[s];l.spec.view&&this.pluginViews.push(l.spec.view(this))}for(let s=0;s<this.state.plugins.length;s++){let l=this.state.plugins[s];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(let s=0;s<this.pluginViews.length;s++){let l=this.pluginViews[s];l.update&&l.update(this,t)}}updateDraggedNode(t,s){let l=t.node,h=-1;if(this.state.doc.nodeAt(l.from)==l.node)h=l.from;else{let m=l.from+(this.state.doc.content.size-s.doc.content.size);(m>0&&this.state.doc.nodeAt(m))==l.node&&(h=m)}this.dragging=new xO(t.slice,t.move,h<0?void 0:kn.create(this.state.doc,h))}someProp(t,s){let l=this._props&&this._props[t],h;if(l!=null&&(h=s?s(l):l))return h;for(let v=0;v<this.directPlugins.length;v++){let i=this.directPlugins[v].props[t];if(i!=null&&(h=s?s(i):i))return h}let m=this.state.plugins;if(m)for(let v=0;v<m.length;v++){let i=m[v].props[t];if(i!=null&&(h=s?s(i):i))return h}}hasFocus(){if(Yl){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&qH(this.dom),Sf(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let s=this.dom.parentNode;s;s=s.parentNode)if(s.nodeType==9||s.nodeType==11&&s.host)return s.getSelection||(Object.getPrototypeOf(s).getSelection=()=>s.ownerDocument.getSelection()),this._root=s}return t||document}updateRoot(){this._root=null}posAtCoords(t){return YH(this,t)}coordsAtPos(t,s=1){return YD(this,t,s)}domAtPos(t,s=0){return this.docView.domFromPos(t,s)}nodeDOM(t){let s=this.docView.descAt(t);return s?s.nodeDOM:null}posAtDOM(t,s,l=-1){let h=this.docView.posFromDOM(t,s,l);if(h==null)throw new RangeError("DOM position not inside the editor");return h}endOfTextblock(t,s){return rG(this,s||this.state,t)}pasteHTML(t,s){return ax(this,"",t,!1,s||new ClipboardEvent("paste"))}pasteText(t,s){return ax(this,t,null,!0,s||new ClipboardEvent("paste"))}serializeForClipboard(t){return XT(this,t)}destroy(){this.docView&&(PG(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Ow(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,NH())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return NG(this,t)}domSelectionRange(){let t=this.domSelection();return t?wl&&this.root.nodeType===11&&jH(this.dom.ownerDocument)==this.dom&&rq(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}TO.prototype.dispatch=function(r){let t=this._props.dispatchTransaction;t?t.call(this,r):this.updateState(this.state.apply(r))};function ik(r){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(r.editable),r.someProp("attributes",s=>{if(typeof s=="function"&&(s=s(r.state)),s)for(let l in s)l=="class"?t.class+=" "+s[l]:l=="style"?t.style=(t.style?t.style+";":"")+s[l]:!t[l]&&l!="contenteditable"&&l!="nodeName"&&(t[l]=String(s[l]))}),t.translate||(t.translate="no"),[bl.node(0,r.state.doc.content.size,t)]}function sk(r){if(r.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),r.cursorWrapper={dom:t,deco:bl.widget(r.state.selection.from,t,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function ok(r){return!r.someProp("editable",t=>t(r.state)===!1)}function hq(r,t){let s=Math.min(r.$anchor.sharedDepth(r.head),t.$anchor.sharedDepth(t.head));return r.$anchor.start(s)!=t.$anchor.start(s)}function ak(r){let t=Object.create(null);function s(l){for(let h in l)Object.prototype.hasOwnProperty.call(t,h)||(t[h]=l[h])}return r.someProp("nodeViews",s),r.someProp("markViews",s),t}function dq(r,t){let s=0,l=0;for(let h in r){if(r[h]!=t[h])return!0;s++}for(let h in t)l++;return s!=l}function lk(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var em={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},P0={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},fq=typeof navigator<"u"&&/Mac/.test(navigator.platform),pq=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ja=0;ja<10;ja++)em[48+ja]=em[96+ja]=String(ja);for(var ja=1;ja<=24;ja++)em[ja+111]="F"+ja;for(var ja=65;ja<=90;ja++)em[ja]=String.fromCharCode(ja+32),P0[ja]=String.fromCharCode(ja);for(var zw in em)P0.hasOwnProperty(zw)||(P0[zw]=em[zw]);function mq(r){var t=fq&&r.metaKey&&r.shiftKey&&!r.ctrlKey&&!r.altKey||pq&&r.shiftKey&&r.key&&r.key.length==1||r.key=="Unidentified",s=!t&&r.key||(r.shiftKey?P0:em)[r.keyCode]||r.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}const gq=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),yq=typeof navigator<"u"&&/Win/.test(navigator.platform);function _q(r){let t=r.split(/-(?!$)/),s=t[t.length-1];s=="Space"&&(s=" ");let l,h,m,v;for(let i=0;i<t.length-1;i++){let A=t[i];if(/^(cmd|meta|m)$/i.test(A))v=!0;else if(/^a(lt)?$/i.test(A))l=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else if(/^mod$/i.test(A))gq?v=!0:h=!0;else throw new Error("Unrecognized modifier name: "+A)}return l&&(s="Alt-"+s),h&&(s="Ctrl-"+s),v&&(s="Meta-"+s),m&&(s="Shift-"+s),s}function xq(r){let t=Object.create(null);for(let s in r)t[_q(s)]=r[s];return t}function jw(r,t,s=!0){return t.altKey&&(r="Alt-"+r),t.ctrlKey&&(r="Ctrl-"+r),t.metaKey&&(r="Meta-"+r),s&&t.shiftKey&&(r="Shift-"+r),r}function vq(r){return new po({props:{handleKeyDown:EO(r)}})}function EO(r){let t=xq(r);return function(s,l){let h=mq(l),m,v=t[jw(h,l)];if(v&&v(s.state,s.dispatch,s))return!0;if(h.length==1&&h!=" "){if(l.shiftKey){let i=t[jw(h,l,!1)];if(i&&i(s.state,s.dispatch,s))return!0}if((l.altKey||l.metaKey||l.ctrlKey)&&!(yq&&l.ctrlKey&&l.altKey)&&(m=em[l.keyCode])&&m!=h){let i=t[jw(m,l)];if(i&&i(s.state,s.dispatch,s))return!0}}return!1}}const t2=(r,t)=>r.selection.empty?!1:(t&&t(r.tr.deleteSelection().scrollIntoView()),!0);function CO(r,t){let{$cursor:s}=r.selection;return!s||(t?!t.endOfTextblock("backward",r):s.parentOffset>0)?null:s}const AO=(r,t,s)=>{let l=CO(r,s);if(!l)return!1;let h=r2(l);if(!h){let v=l.blockRange(),i=v&&Fy(v);return i==null?!1:(t&&t(r.tr.lift(v,i).scrollIntoView()),!0)}let m=h.nodeBefore;if(LO(r,h,t,-1))return!0;if(l.parent.content.size==0&&(Cy(m,"end")||kn.isSelectable(m)))for(let v=l.depth;;v--){let i=k1(r.doc,l.before(v),l.after(v),Yr.empty);if(i&&i.slice.size<i.to-i.from){if(t){let A=r.tr.step(i);A.setSelection(Cy(m,"end")?xi.findFrom(A.doc.resolve(A.mapping.map(h.pos,-1)),-1):kn.create(A.doc,h.pos-m.nodeSize)),t(A.scrollIntoView())}return!0}if(v==1||l.node(v-1).childCount>1)break}return m.isAtom&&h.depth==l.depth-1?(t&&t(r.tr.delete(h.pos-m.nodeSize,h.pos).scrollIntoView()),!0):!1},bq=(r,t,s)=>{let l=CO(r,s);if(!l)return!1;let h=r2(l);return h?IO(r,h,t):!1},wq=(r,t,s)=>{let l=kO(r,s);if(!l)return!1;let h=n2(l);return h?IO(r,h,t):!1};function IO(r,t,s){let l=t.nodeBefore,h=l,m=t.pos-1;for(;!h.isTextblock;m--){if(h.type.spec.isolating)return!1;let D=h.lastChild;if(!D)return!1;h=D}let v=t.nodeAfter,i=v,A=t.pos+1;for(;!i.isTextblock;A++){if(i.type.spec.isolating)return!1;let D=i.firstChild;if(!D)return!1;i=D}let P=k1(r.doc,m,A,Yr.empty);if(!P||P.from!=m||P instanceof ya&&P.slice.size>=A-m)return!1;if(s){let D=r.tr.step(P);D.setSelection(ti.create(D.doc,m)),s(D.scrollIntoView())}return!0}function Cy(r,t,s=!1){for(let l=r;l;l=t=="start"?l.firstChild:l.lastChild){if(l.isTextblock)return!0;if(s&&l.childCount!=1)return!1}return!1}const MO=(r,t,s)=>{let{$head:l,empty:h}=r.selection,m=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("backward",r):l.parentOffset>0)return!1;m=r2(l)}let v=m&&m.nodeBefore;return!v||!kn.isSelectable(v)?!1:(t&&t(r.tr.setSelection(kn.create(r.doc,m.pos-v.nodeSize)).scrollIntoView()),!0)};function r2(r){if(!r.parent.type.spec.isolating)for(let t=r.depth-1;t>=0;t--){if(r.index(t)>0)return r.doc.resolve(r.before(t+1));if(r.node(t).type.spec.isolating)break}return null}function kO(r,t){let{$cursor:s}=r.selection;return!s||(t?!t.endOfTextblock("forward",r):s.parentOffset<s.parent.content.size)?null:s}const PO=(r,t,s)=>{let l=kO(r,s);if(!l)return!1;let h=n2(l);if(!h)return!1;let m=h.nodeAfter;if(LO(r,h,t,1))return!0;if(l.parent.content.size==0&&(Cy(m,"start")||kn.isSelectable(m))){let v=k1(r.doc,l.before(),l.after(),Yr.empty);if(v&&v.slice.size<v.to-v.from){if(t){let i=r.tr.step(v);i.setSelection(Cy(m,"start")?xi.findFrom(i.doc.resolve(i.mapping.map(h.pos)),1):kn.create(i.doc,i.mapping.map(h.pos))),t(i.scrollIntoView())}return!0}}return m.isAtom&&h.depth==l.depth-1?(t&&t(r.tr.delete(h.pos,h.pos+m.nodeSize).scrollIntoView()),!0):!1},RO=(r,t,s)=>{let{$head:l,empty:h}=r.selection,m=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("forward",r):l.parentOffset<l.parent.content.size)return!1;m=n2(l)}let v=m&&m.nodeAfter;return!v||!kn.isSelectable(v)?!1:(t&&t(r.tr.setSelection(kn.create(r.doc,m.pos)).scrollIntoView()),!0)};function n2(r){if(!r.parent.type.spec.isolating)for(let t=r.depth-1;t>=0;t--){let s=r.node(t);if(r.index(t)+1<s.childCount)return r.doc.resolve(r.after(t+1));if(s.type.spec.isolating)break}return null}const Sq=(r,t)=>{let s=r.selection,l=s instanceof kn,h;if(l){if(s.node.isTextblock||!om(r.doc,s.from))return!1;h=s.from}else if(h=M1(r.doc,s.from,-1),h==null)return!1;if(t){let m=r.tr.join(h);l&&m.setSelection(kn.create(m.doc,h-r.doc.resolve(h).nodeBefore.nodeSize)),t(m.scrollIntoView())}return!0},Tq=(r,t)=>{let s=r.selection,l;if(s instanceof kn){if(s.node.isTextblock||!om(r.doc,s.to))return!1;l=s.to}else if(l=M1(r.doc,s.to,1),l==null)return!1;return t&&t(r.tr.join(l).scrollIntoView()),!0},Eq=(r,t)=>{let{$from:s,$to:l}=r.selection,h=s.blockRange(l),m=h&&Fy(h);return m==null?!1:(t&&t(r.tr.lift(h,m).scrollIntoView()),!0)},NO=(r,t)=>{let{$head:s,$anchor:l}=r.selection;return!s.parent.type.spec.code||!s.sameParent(l)?!1:(t&&t(r.tr.insertText(`
`).scrollIntoView()),!0)};function i2(r){for(let t=0;t<r.edgeCount;t++){let{type:s}=r.edge(t);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}const Cq=(r,t)=>{let{$head:s,$anchor:l}=r.selection;if(!s.parent.type.spec.code||!s.sameParent(l))return!1;let h=s.node(-1),m=s.indexAfter(-1),v=i2(h.contentMatchAt(m));if(!v||!h.canReplaceWith(m,m,v))return!1;if(t){let i=s.after(),A=r.tr.replaceWith(i,i,v.createAndFill());A.setSelection(xi.near(A.doc.resolve(i),1)),t(A.scrollIntoView())}return!0},DO=(r,t)=>{let s=r.selection,{$from:l,$to:h}=s;if(s instanceof Ic||l.parent.inlineContent||h.parent.inlineContent)return!1;let m=i2(h.parent.contentMatchAt(h.indexAfter()));if(!m||!m.isTextblock)return!1;if(t){let v=(!l.parentOffset&&h.index()<h.parent.childCount?l:h).pos,i=r.tr.insert(v,m.createAndFill());i.setSelection(ti.create(i.doc,v+1)),t(i.scrollIntoView())}return!0},OO=(r,t)=>{let{$cursor:s}=r.selection;if(!s||s.parent.content.size)return!1;if(s.depth>1&&s.after()!=s.end(-1)){let m=s.before();if(wf(r.doc,m))return t&&t(r.tr.split(m).scrollIntoView()),!0}let l=s.blockRange(),h=l&&Fy(l);return h==null?!1:(t&&t(r.tr.lift(l,h).scrollIntoView()),!0)};function Aq(r){return(t,s)=>{let{$from:l,$to:h}=t.selection;if(t.selection instanceof kn&&t.selection.node.isBlock)return!l.parentOffset||!wf(t.doc,l.pos)?!1:(s&&s(t.tr.split(l.pos).scrollIntoView()),!0);if(!l.depth)return!1;let m=[],v,i,A=!1,P=!1;for(let K=l.depth;;K--)if(l.node(K).isBlock){A=l.end(K)==l.pos+(l.depth-K),P=l.start(K)==l.pos-(l.depth-K),i=i2(l.node(K-1).contentMatchAt(l.indexAfter(K-1))),m.unshift(A&&i?{type:i}:null),v=K;break}else{if(K==1)return!1;m.unshift(null)}let D=t.tr;(t.selection instanceof ti||t.selection instanceof Ic)&&D.deleteSelection();let F=D.mapping.map(l.pos),$=wf(D.doc,F,m.length,m);if($||(m[0]=i?{type:i}:null,$=wf(D.doc,F,m.length,m)),!$)return!1;if(D.split(F,m.length,m),!A&&P&&l.node(v).type!=i){let K=D.mapping.map(l.before(v)),J=D.doc.resolve(K);i&&l.node(v-1).canReplaceWith(J.index(),J.index()+1,i)&&D.setNodeMarkup(D.mapping.map(l.before(v)),i)}return s&&s(D.scrollIntoView()),!0}}const Iq=Aq(),Mq=(r,t)=>{let{$from:s,to:l}=r.selection,h,m=s.sharedDepth(l);return m==0?!1:(h=s.before(m),t&&t(r.tr.setSelection(kn.create(r.doc,h))),!0)};function kq(r,t,s){let l=t.nodeBefore,h=t.nodeAfter,m=t.index();return!l||!h||!l.type.compatibleContent(h.type)?!1:!l.content.size&&t.parent.canReplace(m-1,m)?(s&&s(r.tr.delete(t.pos-l.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(m,m+1)||!(h.isTextblock||om(r.doc,t.pos))?!1:(s&&s(r.tr.join(t.pos).scrollIntoView()),!0)}function LO(r,t,s,l){let h=t.nodeBefore,m=t.nodeAfter,v,i,A=h.type.spec.isolating||m.type.spec.isolating;if(!A&&kq(r,t,s))return!0;let P=!A&&t.parent.canReplace(t.index(),t.index()+1);if(P&&(v=(i=h.contentMatchAt(h.childCount)).findWrapping(m.type))&&i.matchType(v[0]||m.type).validEnd){if(s){let K=t.pos+m.nodeSize,J=dr.empty;for(let fe=v.length-1;fe>=0;fe--)J=dr.from(v[fe].create(null,J));J=dr.from(h.copy(J));let W=r.tr.step(new xa(t.pos-1,K,t.pos,K,new Yr(J,1,0),v.length,!0)),ie=W.doc.resolve(K+2*v.length);ie.nodeAfter&&ie.nodeAfter.type==h.type&&om(W.doc,ie.pos)&&W.join(ie.pos),s(W.scrollIntoView())}return!0}let D=m.type.spec.isolating||l>0&&A?null:xi.findFrom(t,1),F=D&&D.$from.blockRange(D.$to),$=F&&Fy(F);if($!=null&&$>=t.depth)return s&&s(r.tr.lift(F,$).scrollIntoView()),!0;if(P&&Cy(m,"start",!0)&&Cy(h,"end")){let K=h,J=[];for(;J.push(K),!K.isTextblock;)K=K.lastChild;let W=m,ie=1;for(;!W.isTextblock;W=W.firstChild)ie++;if(K.canReplace(K.childCount,K.childCount,W.content)){if(s){let fe=dr.empty;for(let Fe=J.length-1;Fe>=0;Fe--)fe=dr.from(J[Fe].copy(fe));let Pe=r.tr.step(new xa(t.pos-J.length,t.pos+m.nodeSize,t.pos+ie,t.pos+m.nodeSize-ie,new Yr(fe,J.length,0),0,!0));s(Pe.scrollIntoView())}return!0}}return!1}function zO(r){return function(t,s){let l=t.selection,h=r<0?l.$from:l.$to,m=h.depth;for(;h.node(m).isInline;){if(!m)return!1;m--}return h.node(m).isTextblock?(s&&s(t.tr.setSelection(ti.create(t.doc,r<0?h.start(m):h.end(m)))),!0):!1}}const Pq=zO(-1),Rq=zO(1);function Nq(r,t=null){return function(s,l){let{$from:h,$to:m}=s.selection,v=h.blockRange(m),i=v&&HT(v,r,t);return i?(l&&l(s.tr.wrap(v,i).scrollIntoView()),!0):!1}}function ck(r,t=null){return function(s,l){let h=!1;for(let m=0;m<s.selection.ranges.length&&!h;m++){let{$from:{pos:v},$to:{pos:i}}=s.selection.ranges[m];s.doc.nodesBetween(v,i,(A,P)=>{if(h)return!1;if(!(!A.isTextblock||A.hasMarkup(r,t)))if(A.type==r)h=!0;else{let D=s.doc.resolve(P),F=D.index();h=D.parent.canReplaceWith(F,F+1,r)}})}if(!h)return!1;if(l){let m=s.tr;for(let v=0;v<s.selection.ranges.length;v++){let{$from:{pos:i},$to:{pos:A}}=s.selection.ranges[v];m.setBlockType(i,A,r,t)}l(m.scrollIntoView())}return!0}}function s2(...r){return function(t,s,l){for(let h=0;h<r.length;h++)if(r[h](t,s,l))return!0;return!1}}s2(t2,AO,MO);s2(t2,PO,RO);s2(NO,DO,OO,Iq);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Dq(r,t=null){return function(s,l){let{$from:h,$to:m}=s.selection,v=h.blockRange(m);if(!v)return!1;let i=l?s.tr:null;return Oq(i,v,r,t)?(l&&l(i.scrollIntoView()),!0):!1}}function Oq(r,t,s,l=null){let h=!1,m=t,v=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(s)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let A=v.resolve(t.start-2);m=new T0(A,A,t.depth),t.endIndex<t.parent.childCount&&(t=new T0(t.$from,v.resolve(t.$to.end(t.depth)),t.depth)),h=!0}let i=HT(m,s,l,t);return i?(r&&Lq(r,t,i,h,s),!0):!1}function Lq(r,t,s,l,h){let m=dr.empty;for(let D=s.length-1;D>=0;D--)m=dr.from(s[D].type.create(s[D].attrs,m));r.step(new xa(t.start-(l?2:0),t.end,t.start,t.end,new Yr(m,0,0),s.length,!0));let v=0;for(let D=0;D<s.length;D++)s[D].type==h&&(v=D+1);let i=s.length-v,A=t.start+s.length-(l?2:0),P=t.parent;for(let D=t.startIndex,F=t.endIndex,$=!0;D<F;D++,$=!1)!$&&wf(r.doc,A,i)&&(r.split(A,i),A+=2*i),A+=P.child(D).nodeSize;return r}function zq(r){return function(t,s){let{$from:l,$to:h}=t.selection,m=l.blockRange(h,v=>v.childCount>0&&v.firstChild.type==r);return m?s?l.node(m.depth-1).type==r?jq(t,s,r,m):Fq(t,s,m):!0:!1}}function jq(r,t,s,l){let h=r.tr,m=l.end,v=l.$to.end(l.depth);m<v&&(h.step(new xa(m-1,v,m,v,new Yr(dr.from(s.create(null,l.parent.copy())),1,0),1,!0)),l=new T0(h.doc.resolve(l.$from.pos),h.doc.resolve(v),l.depth));const i=Fy(l);if(i==null)return!1;h.lift(l,i);let A=h.doc.resolve(h.mapping.map(m,-1)-1);return om(h.doc,A.pos)&&A.nodeBefore.type==A.nodeAfter.type&&h.join(A.pos),t(h.scrollIntoView()),!0}function Fq(r,t,s){let l=r.tr,h=s.parent;for(let K=s.end,J=s.endIndex-1,W=s.startIndex;J>W;J--)K-=h.child(J).nodeSize,l.delete(K-1,K+1);let m=l.doc.resolve(s.start),v=m.nodeAfter;if(l.mapping.map(s.end)!=s.start+m.nodeAfter.nodeSize)return!1;let i=s.startIndex==0,A=s.endIndex==h.childCount,P=m.node(-1),D=m.index(-1);if(!P.canReplace(D+(i?0:1),D+1,v.content.append(A?dr.empty:dr.from(h))))return!1;let F=m.pos,$=F+v.nodeSize;return l.step(new xa(F-(i?1:0),$+(A?1:0),F+1,$-1,new Yr((i?dr.empty:dr.from(h.copy(dr.empty))).append(A?dr.empty:dr.from(h.copy(dr.empty))),i?0:1,A?0:1),i?0:1)),t(l.scrollIntoView()),!0}function Bq(r){return function(t,s){let{$from:l,$to:h}=t.selection,m=l.blockRange(h,P=>P.childCount>0&&P.firstChild.type==r);if(!m)return!1;let v=m.startIndex;if(v==0)return!1;let i=m.parent,A=i.child(v-1);if(A.type!=r)return!1;if(s){let P=A.lastChild&&A.lastChild.type==i.type,D=dr.from(P?r.create():null),F=new Yr(dr.from(r.create(null,dr.from(i.type.create(null,D)))),P?3:1,0),$=m.start,K=m.end;s(t.tr.step(new xa($-(P?3:1),K,$,K,F,1,!0)).scrollIntoView())}return!0}}var Vq=Object.defineProperty,jO=(r,t)=>{for(var s in t)Vq(r,s,{get:t[s],enumerable:!0})};function O1(r){const{state:t,transaction:s}=r;let{selection:l}=s,{doc:h}=s,{storedMarks:m}=s;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return m},get selection(){return l},get doc(){return h},get tr(){return l=s.selection,h=s.doc,m=s.storedMarks,s}}}var L1=class{constructor(r){this.editor=r.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=r.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:r,editor:t,state:s}=this,{view:l}=t,{tr:h}=s,m=this.buildProps(h);return Object.fromEntries(Object.entries(r).map(([v,i])=>[v,(...P)=>{const D=i(...P)(m);return!h.getMeta("preventDispatch")&&!this.hasCustomState&&l.dispatch(h),D}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(r,t=!0){const{rawCommands:s,editor:l,state:h}=this,{view:m}=l,v=[],i=!!r,A=r||h.tr,P=()=>(!i&&t&&!A.getMeta("preventDispatch")&&!this.hasCustomState&&m.dispatch(A),v.every(F=>F===!0)),D={...Object.fromEntries(Object.entries(s).map(([F,$])=>[F,(...J)=>{const W=this.buildProps(A,t),ie=$(...J)(W);return v.push(ie),D}])),run:P};return D}createCan(r){const{rawCommands:t,state:s}=this,l=!1,h=r||s.tr,m=this.buildProps(h,l);return{...Object.fromEntries(Object.entries(t).map(([i,A])=>[i,(...P)=>A(...P)({...m,dispatch:void 0})])),chain:()=>this.createChain(h,l)}}buildProps(r,t=!0){const{rawCommands:s,editor:l,state:h}=this,{view:m}=l,v={tr:r,editor:l,view:m,state:O1({state:h,transaction:r}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(r,t),can:()=>this.createCan(r),get commands(){return Object.fromEntries(Object.entries(s).map(([i,A])=>[i,(...P)=>A(...P)(v)]))}};return v}},Uq=class{constructor(){this.callbacks={}}on(r,t){return this.callbacks[r]||(this.callbacks[r]=[]),this.callbacks[r].push(t),this}emit(r,...t){const s=this.callbacks[r];return s&&s.forEach(l=>l.apply(this,t)),this}off(r,t){const s=this.callbacks[r];return s&&(t?this.callbacks[r]=s.filter(l=>l!==t):delete this.callbacks[r]),this}once(r,t){const s=(...l)=>{this.off(r,s),t.apply(this,l)};return this.on(r,s)}removeAllListeners(){this.callbacks={}}};function FO(r,t){const s=new UD(r);return t.forEach(l=>{l.steps.forEach(h=>{s.step(h)})}),s}var BO=r=>{const t=r.childNodes;for(let s=t.length-1;s>=0;s-=1){const l=t[s];l.nodeType===3&&l.nodeValue&&/^(\n\s\s|\n)$/.test(l.nodeValue)?r.removeChild(l):l.nodeType===1&&BO(l)}return r};function Iv(r){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${r}</body>`,s=new window.DOMParser().parseFromString(t,"text/html").body;return BO(s)}function cx(r,t,s){if(r instanceof Gp||r instanceof dr)return r;s={slice:!0,parseOptions:{},...s};const l=typeof r=="object"&&r!==null,h=typeof r=="string";if(l)try{if(Array.isArray(r)&&r.length>0)return dr.fromArray(r.map(i=>t.nodeFromJSON(i)));const v=t.nodeFromJSON(r);return s.errorOnInvalidContent&&v.check(),v}catch(m){if(s.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:m});return console.warn("[tiptap warn]: Invalid content.","Passed value:",r,"Error:",m),cx("",t,s)}if(h){if(s.errorOnInvalidContent){let v=!1,i="";const A=new CD({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:P=>(v=!0,i=typeof P=="string"?P:P.outerHTML,null)}]}})});if(s.slice?qp.fromSchema(A).parseSlice(Iv(r),s.parseOptions):qp.fromSchema(A).parse(Iv(r),s.parseOptions),s.errorOnInvalidContent&&v)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${i}`)})}const m=qp.fromSchema(t);return s.slice?m.parseSlice(Iv(r),s.parseOptions).content:m.parse(Iv(r),s.parseOptions)}return cx("",t,s)}function GS(r,t,s={},l={}){return cx(r,t,{slice:!1,parseOptions:s,errorOnInvalidContent:l.errorOnInvalidContent})}function $q(r){for(let t=0;t<r.edgeCount;t+=1){const{type:s}=r.edge(t);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}function Hq(r,t,s){const l=[];return r.nodesBetween(t.from,t.to,(h,m)=>{s(h)&&l.push({node:h,pos:m})}),l}function Gq(r,t){for(let s=r.depth;s>0;s-=1){const l=r.node(s);if(t(l))return{pos:s>0?r.before(s):0,start:r.start(s),depth:s,node:l}}}function z1(r){return t=>Gq(t.$from,r)}function Cn(r,t,s){return r.config[t]===void 0&&r.parent?Cn(r.parent,t,s):typeof r.config[t]=="function"?r.config[t].bind({...s,parent:r.parent?Cn(r.parent,t,s):null}):r.config[t]}function o2(r){return r.map(t=>{const s={name:t.name,options:t.options,storage:t.storage},l=Cn(t,"addExtensions",s);return l?[t,...o2(l())]:t}).flat(10)}function a2(r,t){const s=Tg.fromSchema(t).serializeFragment(r),h=document.implementation.createHTMLDocument().createElement("div");return h.appendChild(s),h.innerHTML}function VO(r){return typeof r=="function"}function cs(r,t=void 0,...s){return VO(r)?t?r.bind(t)(...s):r(...s):r}function qq(r={}){return Object.keys(r).length===0&&r.constructor===Object}function ux(r){const t=r.filter(h=>h.type==="extension"),s=r.filter(h=>h.type==="node"),l=r.filter(h=>h.type==="mark");return{baseExtensions:t,nodeExtensions:s,markExtensions:l}}function UO(r){const t=[],{nodeExtensions:s,markExtensions:l}=ux(r),h=[...s,...l],m={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return r.forEach(v=>{const i={name:v.name,options:v.options,storage:v.storage,extensions:h},A=Cn(v,"addGlobalAttributes",i);if(!A)return;A().forEach(D=>{D.types.forEach(F=>{Object.entries(D.attributes).forEach(([$,K])=>{t.push({type:F,name:$,attribute:{...m,...K}})})})})}),h.forEach(v=>{const i={name:v.name,options:v.options,storage:v.storage},A=Cn(v,"addAttributes",i);if(!A)return;const P=A();Object.entries(P).forEach(([D,F])=>{const $={...m,...F};typeof $?.default=="function"&&($.default=$.default()),$?.isRequired&&$?.default===void 0&&delete $.default,t.push({type:v.name,name:D,attribute:$})})}),t}function So(...r){return r.filter(t=>!!t).reduce((t,s)=>{const l={...t};return Object.entries(s).forEach(([h,m])=>{if(!l[h]){l[h]=m;return}if(h==="class"){const i=m?String(m).split(" "):[],A=l[h]?l[h].split(" "):[],P=i.filter(D=>!A.includes(D));l[h]=[...A,...P].join(" ")}else if(h==="style"){const i=m?m.split(";").map(D=>D.trim()).filter(Boolean):[],A=l[h]?l[h].split(";").map(D=>D.trim()).filter(Boolean):[],P=new Map;A.forEach(D=>{const[F,$]=D.split(":").map(K=>K.trim());P.set(F,$)}),i.forEach(D=>{const[F,$]=D.split(":").map(K=>K.trim());P.set(F,$)}),l[h]=Array.from(P.entries()).map(([D,F])=>`${D}: ${F}`).join("; ")}else l[h]=m}),l},{})}function R0(r,t){return t.filter(s=>s.type===r.type.name).filter(s=>s.attribute.rendered).map(s=>s.attribute.renderHTML?s.attribute.renderHTML(r.attrs)||{}:{[s.name]:r.attrs[s.name]}).reduce((s,l)=>So(s,l),{})}function Wq(r){return typeof r!="string"?r:r.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(r):r==="true"?!0:r==="false"?!1:r}function uk(r,t){return"style"in r?r:{...r,getAttrs:s=>{const l=r.getAttrs?r.getAttrs(s):r.attrs;if(l===!1)return!1;const h=t.reduce((m,v)=>{const i=v.attribute.parseHTML?v.attribute.parseHTML(s):Wq(s.getAttribute(v.name));return i==null?m:{...m,[v.name]:i}},{});return{...l,...h}}}}function hk(r){return Object.fromEntries(Object.entries(r).filter(([t,s])=>t==="attrs"&&qq(s)?!1:s!=null))}function Zq(r,t){var s;const l=UO(r),{nodeExtensions:h,markExtensions:m}=ux(r),v=(s=h.find(P=>Cn(P,"topNode")))==null?void 0:s.name,i=Object.fromEntries(h.map(P=>{const D=l.filter(fe=>fe.type===P.name),F={name:P.name,options:P.options,storage:P.storage,editor:t},$=r.reduce((fe,Pe)=>{const Fe=Cn(Pe,"extendNodeSchema",F);return{...fe,...Fe?Fe(P):{}}},{}),K=hk({...$,content:cs(Cn(P,"content",F)),marks:cs(Cn(P,"marks",F)),group:cs(Cn(P,"group",F)),inline:cs(Cn(P,"inline",F)),atom:cs(Cn(P,"atom",F)),selectable:cs(Cn(P,"selectable",F)),draggable:cs(Cn(P,"draggable",F)),code:cs(Cn(P,"code",F)),whitespace:cs(Cn(P,"whitespace",F)),linebreakReplacement:cs(Cn(P,"linebreakReplacement",F)),defining:cs(Cn(P,"defining",F)),isolating:cs(Cn(P,"isolating",F)),attrs:Object.fromEntries(D.map(fe=>{var Pe,Fe;return[fe.name,{default:(Pe=fe?.attribute)==null?void 0:Pe.default,validate:(Fe=fe?.attribute)==null?void 0:Fe.validate}]}))}),J=cs(Cn(P,"parseHTML",F));J&&(K.parseDOM=J.map(fe=>uk(fe,D)));const W=Cn(P,"renderHTML",F);W&&(K.toDOM=fe=>W({node:fe,HTMLAttributes:R0(fe,D)}));const ie=Cn(P,"renderText",F);return ie&&(K.toText=ie),[P.name,K]})),A=Object.fromEntries(m.map(P=>{const D=l.filter(ie=>ie.type===P.name),F={name:P.name,options:P.options,storage:P.storage,editor:t},$=r.reduce((ie,fe)=>{const Pe=Cn(fe,"extendMarkSchema",F);return{...ie,...Pe?Pe(P):{}}},{}),K=hk({...$,inclusive:cs(Cn(P,"inclusive",F)),excludes:cs(Cn(P,"excludes",F)),group:cs(Cn(P,"group",F)),spanning:cs(Cn(P,"spanning",F)),code:cs(Cn(P,"code",F)),attrs:Object.fromEntries(D.map(ie=>{var fe,Pe;return[ie.name,{default:(fe=ie?.attribute)==null?void 0:fe.default,validate:(Pe=ie?.attribute)==null?void 0:Pe.validate}]}))}),J=cs(Cn(P,"parseHTML",F));J&&(K.parseDOM=J.map(ie=>uk(ie,D)));const W=Cn(P,"renderHTML",F);return W&&(K.toDOM=ie=>W({mark:ie,HTMLAttributes:R0(ie,D)})),[P.name,K]}));return new CD({topNode:v,nodes:i,marks:A})}function Xq(r){const t=r.filter((s,l)=>r.indexOf(s)!==l);return Array.from(new Set(t))}function l2(r){return r.sort((s,l)=>{const h=Cn(s,"priority")||100,m=Cn(l,"priority")||100;return h>m?-1:h<m?1:0})}function $O(r){const t=l2(o2(r)),s=Xq(t.map(l=>l.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(l=>`'${l}'`).join(", ")}]. This can lead to issues.`),t}function HO(r,t,s){const{from:l,to:h}=t,{blockSeparator:m=`

`,textSerializers:v={}}=s||{};let i="";return r.nodesBetween(l,h,(A,P,D,F)=>{var $;A.isBlock&&P>l&&(i+=m);const K=v?.[A.type.name];if(K)return D&&(i+=K({node:A,pos:P,parent:D,index:F,range:t})),!1;A.isText&&(i+=($=A?.text)==null?void 0:$.slice(Math.max(l,P)-P,h-P))}),i}function Kq(r,t){const s={from:0,to:r.content.size};return HO(r,s,t)}function GO(r){return Object.fromEntries(Object.entries(r.nodes).filter(([,t])=>t.spec.toText).map(([t,s])=>[t,s.spec.toText]))}function Mf(r,t){if(typeof r=="string"){if(!t.marks[r])throw Error(`There is no mark type named '${r}'. Maybe you forgot to add the extension?`);return t.marks[r]}return r}function qO(r,t){const s=Mf(t,r.schema),{from:l,to:h,empty:m}=r.selection,v=[];m?(r.storedMarks&&v.push(...r.storedMarks),v.push(...r.selection.$head.marks())):r.doc.nodesBetween(l,h,A=>{v.push(...A.marks)});const i=v.find(A=>A.type.name===s.name);return i?{...i.attrs}:{}}function jo(r,t){if(typeof r=="string"){if(!t.nodes[r])throw Error(`There is no node type named '${r}'. Maybe you forgot to add the extension?`);return t.nodes[r]}return r}function Yq(r,t){const s=jo(t,r.schema),{from:l,to:h}=r.selection,m=[];r.doc.nodesBetween(l,h,i=>{m.push(i)});const v=m.reverse().find(i=>i.type.name===s.name);return v?{...v.attrs}:{}}function j1(r,t){return t.nodes[r]?"node":t.marks[r]?"mark":null}function WO(r,t){const s=j1(typeof t=="string"?t:t.name,r.schema);return s==="node"?Yq(r,t):s==="mark"?qO(r,t):{}}function Jq(r,t=JSON.stringify){const s={};return r.filter(l=>{const h=t(l);return Object.prototype.hasOwnProperty.call(s,h)?!1:s[h]=!0})}function Qq(r){const t=Jq(r);return t.length===1?t:t.filter((s,l)=>!t.filter((m,v)=>v!==l).some(m=>s.oldRange.from>=m.oldRange.from&&s.oldRange.to<=m.oldRange.to&&s.newRange.from>=m.newRange.from&&s.newRange.to<=m.newRange.to))}function ZO(r){const{mapping:t,steps:s}=r,l=[];return t.maps.forEach((h,m)=>{const v=[];if(h.ranges.length)h.forEach((i,A)=>{v.push({from:i,to:A})});else{const{from:i,to:A}=s[m];if(i===void 0||A===void 0)return;v.push({from:i,to:A})}v.forEach(({from:i,to:A})=>{const P=t.slice(m).map(i,-1),D=t.slice(m).map(A),F=t.invert().map(P,-1),$=t.invert().map(D);l.push({oldRange:{from:F,to:$},newRange:{from:P,to:D}})})}),Qq(l)}function c2(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function N0(r,t,s={strict:!0}){const l=Object.keys(t);return l.length?l.every(h=>s.strict?t[h]===r[h]:c2(t[h])?t[h].test(r[h]):t[h]===r[h]):!0}function XO(r,t,s={}){return r.find(l=>l.type===t&&N0(Object.fromEntries(Object.keys(s).map(h=>[h,l.attrs[h]])),s))}function dk(r,t,s={}){return!!XO(r,t,s)}function u2(r,t,s){var l;if(!r||!t)return;let h=r.parent.childAfter(r.parentOffset);if((!h.node||!h.node.marks.some(D=>D.type===t))&&(h=r.parent.childBefore(r.parentOffset)),!h.node||!h.node.marks.some(D=>D.type===t)||(s=s||((l=h.node.marks[0])==null?void 0:l.attrs),!XO([...h.node.marks],t,s)))return;let v=h.index,i=r.start()+h.offset,A=v+1,P=i+h.node.nodeSize;for(;v>0&&dk([...r.parent.child(v-1).marks],t,s);)v-=1,i-=r.parent.child(v).nodeSize;for(;A<r.parent.childCount&&dk([...r.parent.child(A).marks],t,s);)P+=r.parent.child(A).nodeSize,A+=1;return{from:i,to:P}}function h2(r,t,s){const l=[];return r===t?s.resolve(r).marks().forEach(h=>{const m=s.resolve(r),v=u2(m,h.type);v&&l.push({mark:h,...v})}):s.nodesBetween(r,t,(h,m)=>{!h||h?.nodeSize===void 0||l.push(...h.marks.map(v=>({from:m,to:m+h.nodeSize,mark:v})))}),l}var eW=(r,t,s,l=20)=>{const h=r.doc.resolve(s);let m=l,v=null;for(;m>0&&v===null;){const i=h.node(m);i?.type.name===t?v=i:m-=1}return[v,m]};function Fw(r,t){return t.nodes[r]||t.marks[r]||null}function Qv(r,t,s){return Object.fromEntries(Object.entries(s).filter(([l])=>{const h=r.find(m=>m.type===t&&m.name===l);return h?h.attribute.keepOnSplit:!1}))}var tW=(r,t=500)=>{let s="";const l=r.parentOffset;return r.parent.nodesBetween(Math.max(0,l-t),l,(h,m,v,i)=>{var A,P;const D=((P=(A=h.type.spec).toText)==null?void 0:P.call(A,{node:h,pos:m,parent:v,index:i}))||h.textContent||"%leaf%";s+=h.isAtom&&!h.isText?D:D.slice(0,Math.max(0,l-m))}),s};function qS(r,t,s={}){const{empty:l,ranges:h}=r.selection,m=t?Mf(t,r.schema):null;if(l)return!!(r.storedMarks||r.selection.$from.marks()).filter(F=>m?m.name===F.type.name:!0).find(F=>N0(F.attrs,s,{strict:!1}));let v=0;const i=[];if(h.forEach(({$from:F,$to:$})=>{const K=F.pos,J=$.pos;r.doc.nodesBetween(K,J,(W,ie)=>{if(!W.isText&&!W.marks.length)return;const fe=Math.max(K,ie),Pe=Math.min(J,ie+W.nodeSize),Fe=Pe-fe;v+=Fe,i.push(...W.marks.map(ht=>({mark:ht,from:fe,to:Pe})))})}),v===0)return!1;const A=i.filter(F=>m?m.name===F.mark.type.name:!0).filter(F=>N0(F.mark.attrs,s,{strict:!1})).reduce((F,$)=>F+$.to-$.from,0),P=i.filter(F=>m?F.mark.type!==m&&F.mark.type.excludes(m):!0).reduce((F,$)=>F+$.to-$.from,0);return(A>0?A+P:A)>=v}function tm(r,t,s={}){const{from:l,to:h,empty:m}=r.selection,v=t?jo(t,r.schema):null,i=[];r.doc.nodesBetween(l,h,(F,$)=>{if(F.isText)return;const K=Math.max(l,$),J=Math.min(h,$+F.nodeSize);i.push({node:F,from:K,to:J})});const A=h-l,P=i.filter(F=>v?v.name===F.node.type.name:!0).filter(F=>N0(F.node.attrs,s,{strict:!1}));return m?!!P.length:P.reduce((F,$)=>F+$.to-$.from,0)>=A}function rW(r,t,s={}){if(!t)return tm(r,null,s)||qS(r,null,s);const l=j1(t,r.schema);return l==="node"?tm(r,t,s):l==="mark"?qS(r,t,s):!1}var nW=(r,t)=>{const{$from:s,$to:l,$anchor:h}=r.selection;if(t){const m=z1(i=>i.type.name===t)(r.selection);if(!m)return!1;const v=r.doc.resolve(m.pos+1);return h.pos+1===v.end()}return!(l.parentOffset<l.parent.nodeSize-2||s.pos!==l.pos)},iW=r=>{const{$from:t,$to:s}=r.selection;return!(t.parentOffset>0||t.pos!==s.pos)};function fk(r,t){return Array.isArray(t)?t.some(s=>(typeof s=="string"?s:s.name)===r.name):t}function pk(r,t){const{nodeExtensions:s}=ux(t),l=s.find(v=>v.name===r);if(!l)return!1;const h={name:l.name,options:l.options,storage:l.storage},m=cs(Cn(l,"group",h));return typeof m!="string"?!1:m.split(" ").includes("list")}function F1(r,{checkChildren:t=!0,ignoreWhitespace:s=!1}={}){var l;if(s){if(r.type.name==="hardBreak")return!0;if(r.isText)return/^\s*$/m.test((l=r.text)!=null?l:"")}if(r.isText)return!r.text;if(r.isAtom||r.isLeaf)return!1;if(r.content.childCount===0)return!0;if(t){let h=!0;return r.content.forEach(m=>{h!==!1&&(F1(m,{ignoreWhitespace:s,checkChildren:t})||(h=!1))}),h}return!1}function KO(r){return r instanceof kn}function YO(r){return r instanceof ti}function tg(r=0,t=0,s=0){return Math.min(Math.max(r,t),s)}function JO(r,t=null){if(!t)return null;const s=xi.atStart(r),l=xi.atEnd(r);if(t==="start"||t===!0)return s;if(t==="end")return l;const h=s.from,m=l.to;return t==="all"?ti.create(r,tg(0,h,m),tg(r.content.size,h,m)):ti.create(r,tg(t,h,m),tg(t,h,m))}function sW(r,t,s){const l=r.steps.length-1;if(l<t)return;const h=r.steps[l];if(!(h instanceof ya||h instanceof xa))return;const m=r.mapping.maps[l];let v=0;m.forEach((i,A,P,D)=>{v===0&&(v=D)}),r.setSelection(xi.near(r.doc.resolve(v),s))}var B1=class{constructor(r){this.find=r.find,this.handler=r.handler}},oW=(r,t)=>{if(c2(t))return t.exec(r);const s=t(r);if(!s)return null;const l=[s.text];return l.index=s.index,l.input=r,l.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),l.push(s.replaceWith)),l};function Mv(r){var t;const{editor:s,from:l,to:h,text:m,rules:v,plugin:i}=r,{view:A}=s;if(A.composing)return!1;const P=A.state.doc.resolve(l);if(P.parent.type.spec.code||(t=P.nodeBefore||P.nodeAfter)!=null&&t.marks.find($=>$.type.spec.code))return!1;let D=!1;const F=tW(P)+m;return v.forEach($=>{if(D)return;const K=oW(F,$.find);if(!K)return;const J=A.state.tr,W=O1({state:A.state,transaction:J}),ie={from:l-(K[0].length-m.length),to:h},{commands:fe,chain:Pe,can:Fe}=new L1({editor:s,state:W});$.handler({state:W,range:ie,match:K,commands:fe,chain:Pe,can:Fe})===null||!J.steps.length||(J.setMeta(i,{transform:J,from:l,to:h,text:m}),A.dispatch(J),D=!0)}),D}function aW(r){const{editor:t,rules:s}=r,l=new po({state:{init(){return null},apply(h,m,v){const i=h.getMeta(l);if(i)return i;const A=h.getMeta("applyInputRules");return!!A&&setTimeout(()=>{let{text:D}=A;typeof D=="string"?D=D:D=a2(dr.from(D),v.schema);const{from:F}=A,$=F+D.length;Mv({editor:t,from:F,to:$,text:D,rules:s,plugin:l})}),h.selectionSet||h.docChanged?null:m}},props:{handleTextInput(h,m,v,i){return Mv({editor:t,from:m,to:v,text:i,rules:s,plugin:l})},handleDOMEvents:{compositionend:h=>(setTimeout(()=>{const{$cursor:m}=h.state.selection;m&&Mv({editor:t,from:m.pos,to:m.pos,text:"",rules:s,plugin:l})}),!1)},handleKeyDown(h,m){if(m.key!=="Enter")return!1;const{$cursor:v}=h.state.selection;return v?Mv({editor:t,from:v.pos,to:v.pos,text:`
`,rules:s,plugin:l}):!1}},isInputRules:!0});return l}function lW(r){return Object.prototype.toString.call(r).slice(8,-1)}function kv(r){return lW(r)!=="Object"?!1:r.constructor===Object&&Object.getPrototypeOf(r)===Object.prototype}function QO(r,t){const s={...r};return kv(r)&&kv(t)&&Object.keys(t).forEach(l=>{kv(t[l])&&kv(r[l])?s[l]=QO(r[l],t[l]):s[l]=t[l]}),s}var d2=class{constructor(r={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...r},this.name=this.config.name}get options(){return{...cs(Cn(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...cs(Cn(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(r={}){const t=this.extend({...this.config,addOptions:()=>QO(this.options,r)});return t.name=this.name,t.parent=this.parent,t}extend(r={}){const t=new this.constructor({...this.config,...r});return t.parent=this,this.child=t,t.name="name"in r?r.name:t.parent.name,t}},lm=class eL extends d2{constructor(){super(...arguments),this.type="mark"}static create(t={}){const s=typeof t=="function"?t():t;return new eL(s)}static handleExit({editor:t,mark:s}){const{tr:l}=t.state,h=t.state.selection.$from;if(h.pos===h.end()){const v=h.marks();if(!!!v.find(P=>P?.type.name===s.name))return!1;const A=v.find(P=>P?.type.name===s.name);return A&&l.removeStoredMark(A),l.insertText(" ",h.pos),t.view.dispatch(l),!0}return!1}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}};function cW(r){return typeof r=="number"}var uW=class{constructor(r){this.find=r.find,this.handler=r.handler}},hW=(r,t,s)=>{if(c2(t))return[...r.matchAll(t)];const l=t(r,s);return l?l.map(h=>{const m=[h.text];return m.index=h.index,m.input=r,m.data=h.data,h.replaceWith&&(h.text.includes(h.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),m.push(h.replaceWith)),m}):[]};function dW(r){const{editor:t,state:s,from:l,to:h,rule:m,pasteEvent:v,dropEvent:i}=r,{commands:A,chain:P,can:D}=new L1({editor:t,state:s}),F=[];return s.doc.nodesBetween(l,h,(K,J)=>{if(!K.isTextblock||K.type.spec.code)return;const W=Math.max(l,J),ie=Math.min(h,J+K.content.size),fe=K.textBetween(W-J,ie-J,void 0,"");hW(fe,m.find,v).forEach(Fe=>{if(Fe.index===void 0)return;const ht=W+Fe.index+1,at=ht+Fe[0].length,Dt={from:s.tr.mapping.map(ht),to:s.tr.mapping.map(at)},kt=m.handler({state:s,range:Dt,match:Fe,commands:A,chain:P,can:D,pasteEvent:v,dropEvent:i});F.push(kt)})}),F.every(K=>K!==null)}var Pv=null,fW=r=>{var t;const s=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=s.clipboardData)==null||t.setData("text/html",r),s};function pW(r){const{editor:t,rules:s}=r;let l=null,h=!1,m=!1,v=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,i;try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}const A=({state:D,from:F,to:$,rule:K,pasteEvt:J})=>{const W=D.tr,ie=O1({state:D,transaction:W});if(!(!dW({editor:t,state:ie,from:Math.max(F-1,0),to:$.b-1,rule:K,pasteEvent:J,dropEvent:i})||!W.steps.length)){try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}return v=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,W}};return s.map(D=>new po({view(F){const $=J=>{var W;l=(W=F.dom.parentElement)!=null&&W.contains(J.target)?F.dom.parentElement:null,l&&(Pv=t)},K=()=>{Pv&&(Pv=null)};return window.addEventListener("dragstart",$),window.addEventListener("dragend",K),{destroy(){window.removeEventListener("dragstart",$),window.removeEventListener("dragend",K)}}},props:{handleDOMEvents:{drop:(F,$)=>{if(m=l===F.dom.parentElement,i=$,!m){const K=Pv;K?.isEditable&&setTimeout(()=>{const J=K.state.selection;J&&K.commands.deleteRange({from:J.from,to:J.to})},10)}return!1},paste:(F,$)=>{var K;const J=(K=$.clipboardData)==null?void 0:K.getData("text/html");return v=$,h=!!J?.includes("data-pm-slice"),!1}}},appendTransaction:(F,$,K)=>{const J=F[0],W=J.getMeta("uiEvent")==="paste"&&!h,ie=J.getMeta("uiEvent")==="drop"&&!m,fe=J.getMeta("applyPasteRules"),Pe=!!fe;if(!W&&!ie&&!Pe)return;if(Pe){let{text:at}=fe;typeof at=="string"?at=at:at=a2(dr.from(at),K.schema);const{from:Dt}=fe,kt=Dt+at.length,Rt=fW(at);return A({rule:D,state:K,from:Dt,to:{b:kt},pasteEvt:Rt})}const Fe=$.doc.content.findDiffStart(K.doc.content),ht=$.doc.content.findDiffEnd(K.doc.content);if(!(!cW(Fe)||!ht||Fe===ht.b))return A({rule:D,state:K,from:Fe,to:ht,pasteEvt:v})}}))}var V1=class{constructor(r,t){this.splittableMarks=[],this.editor=t,this.extensions=$O(r),this.schema=Zq(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((r,t)=>{const s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:Fw(t.name,this.schema)},l=Cn(t,"addCommands",s);return l?{...r,...l()}:r},{})}get plugins(){const{editor:r}=this,t=l2([...this.extensions].reverse()),s=[],l=[],h=t.map(m=>{const v={name:m.name,options:m.options,storage:this.editor.extensionStorage[m.name],editor:r,type:Fw(m.name,this.schema)},i=[],A=Cn(m,"addKeyboardShortcuts",v);let P={};if(m.type==="mark"&&Cn(m,"exitable",v)&&(P.ArrowRight=()=>lm.handleExit({editor:r,mark:m})),A){const J=Object.fromEntries(Object.entries(A()).map(([W,ie])=>[W,()=>ie({editor:r})]));P={...P,...J}}const D=vq(P);i.push(D);const F=Cn(m,"addInputRules",v);fk(m,r.options.enableInputRules)&&F&&s.push(...F());const $=Cn(m,"addPasteRules",v);fk(m,r.options.enablePasteRules)&&$&&l.push(...$());const K=Cn(m,"addProseMirrorPlugins",v);if(K){const J=K();i.push(...J)}return i}).flat();return[aW({editor:r,rules:s}),...pW({editor:r,rules:l}),...h]}get attributes(){return UO(this.extensions)}get nodeViews(){const{editor:r}=this,{nodeExtensions:t}=ux(this.extensions);return Object.fromEntries(t.filter(s=>!!Cn(s,"addNodeView")).map(s=>{const l=this.attributes.filter(i=>i.type===s.name),h={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:r,type:jo(s.name,this.schema)},m=Cn(s,"addNodeView",h);if(!m)return[];const v=(i,A,P,D,F)=>{const $=R0(i,l);return m()({node:i,view:A,getPos:P,decorations:D,innerDecorations:F,editor:r,extension:s,HTMLAttributes:$})};return[s.name,v]}))}get markViews(){const{editor:r}=this,{markExtensions:t}=ux(this.extensions);return Object.fromEntries(t.filter(s=>!!Cn(s,"addMarkView")).map(s=>{const l=this.attributes.filter(i=>i.type===s.name),h={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:r,type:Mf(s.name,this.schema)},m=Cn(s,"addMarkView",h);if(!m)return[];const v=(i,A,P)=>{const D=R0(i,l);return m()({mark:i,view:A,inline:P,editor:r,extension:s,HTMLAttributes:D,updateAttributes:F=>{k9(i,r,F)}})};return[s.name,v]}))}setupExtensions(){const r=this.extensions;this.editor.extensionStorage=Object.fromEntries(r.map(t=>[t.name,t.storage])),r.forEach(t=>{var s;const l={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:Fw(t.name,this.schema)};t.type==="mark"&&((s=cs(Cn(t,"keepOnSplit",l)))==null||s)&&this.splittableMarks.push(t.name);const h=Cn(t,"onBeforeCreate",l),m=Cn(t,"onCreate",l),v=Cn(t,"onUpdate",l),i=Cn(t,"onSelectionUpdate",l),A=Cn(t,"onTransaction",l),P=Cn(t,"onFocus",l),D=Cn(t,"onBlur",l),F=Cn(t,"onDestroy",l);h&&this.editor.on("beforeCreate",h),m&&this.editor.on("create",m),v&&this.editor.on("update",v),i&&this.editor.on("selectionUpdate",i),A&&this.editor.on("transaction",A),P&&this.editor.on("focus",P),D&&this.editor.on("blur",D),F&&this.editor.on("destroy",F)})}};V1.resolve=$O;V1.sort=l2;V1.flatten=o2;var mW={};jO(mW,{ClipboardTextSerializer:()=>rL,Commands:()=>sL,Delete:()=>oL,Drop:()=>aL,Editable:()=>lL,FocusEvents:()=>uL,Keymap:()=>hL,Paste:()=>dL,Tabindex:()=>fL,focusEventsPluginKey:()=>cL});var Es=class tL extends d2{constructor(){super(...arguments),this.type="extension"}static create(t={}){const s=typeof t=="function"?t():t;return new tL(s)}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}},rL=Es.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new po({key:new ba("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:r}=this,{state:t,schema:s}=r,{doc:l,selection:h}=t,{ranges:m}=h,v=Math.min(...m.map(D=>D.$from.pos)),i=Math.max(...m.map(D=>D.$to.pos)),A=GO(s);return HO(l,{from:v,to:i},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:A})}}})]}}),nL={};jO(nL,{blur:()=>gW,clearContent:()=>yW,clearNodes:()=>_W,command:()=>xW,createParagraphNear:()=>vW,cut:()=>bW,deleteCurrentNode:()=>wW,deleteNode:()=>SW,deleteRange:()=>TW,deleteSelection:()=>EW,enter:()=>CW,exitCode:()=>AW,extendMarkRange:()=>IW,first:()=>MW,focus:()=>PW,forEach:()=>RW,insertContent:()=>NW,insertContentAt:()=>OW,joinBackward:()=>jW,joinDown:()=>zW,joinForward:()=>FW,joinItemBackward:()=>BW,joinItemForward:()=>VW,joinTextblockBackward:()=>UW,joinTextblockForward:()=>$W,joinUp:()=>LW,keyboardShortcut:()=>GW,lift:()=>qW,liftEmptyBlock:()=>WW,liftListItem:()=>ZW,newlineInCode:()=>XW,resetAttributes:()=>KW,scrollIntoView:()=>YW,selectAll:()=>JW,selectNodeBackward:()=>QW,selectNodeForward:()=>e9,selectParentNode:()=>t9,selectTextblockEnd:()=>r9,selectTextblockStart:()=>n9,setContent:()=>i9,setMark:()=>o9,setMeta:()=>a9,setNode:()=>l9,setNodeSelection:()=>c9,setTextSelection:()=>u9,sinkListItem:()=>h9,splitBlock:()=>d9,splitListItem:()=>f9,toggleList:()=>p9,toggleMark:()=>m9,toggleNode:()=>g9,toggleWrap:()=>y9,undoInputRule:()=>_9,unsetAllMarks:()=>x9,unsetMark:()=>v9,updateAttributes:()=>b9,wrapIn:()=>w9,wrapInList:()=>S9});var gW=()=>({editor:r,view:t})=>(requestAnimationFrame(()=>{var s;r.isDestroyed||(t.dom.blur(),(s=window?.getSelection())==null||s.removeAllRanges())}),!0),yW=(r=!0)=>({commands:t})=>t.setContent("",{emitUpdate:r}),_W=()=>({state:r,tr:t,dispatch:s})=>{const{selection:l}=t,{ranges:h}=l;return s&&h.forEach(({$from:m,$to:v})=>{r.doc.nodesBetween(m.pos,v.pos,(i,A)=>{if(i.type.isText)return;const{doc:P,mapping:D}=t,F=P.resolve(D.map(A)),$=P.resolve(D.map(A+i.nodeSize)),K=F.blockRange($);if(!K)return;const J=Fy(K);if(i.type.isTextblock){const{defaultType:W}=F.parent.contentMatchAt(F.index());t.setNodeMarkup(K.start,W)}(J||J===0)&&t.lift(K,J)})}),!0},xW=r=>t=>r(t),vW=()=>({state:r,dispatch:t})=>DO(r,t),bW=(r,t)=>({editor:s,tr:l})=>{const{state:h}=s,m=h.doc.slice(r.from,r.to);l.deleteRange(r.from,r.to);const v=l.mapping.map(t);return l.insert(v,m.content),l.setSelection(new ti(l.doc.resolve(Math.max(v-1,0)))),!0},wW=()=>({tr:r,dispatch:t})=>{const{selection:s}=r,l=s.$anchor.node();if(l.content.size>0)return!1;const h=r.selection.$anchor;for(let m=h.depth;m>0;m-=1)if(h.node(m).type===l.type){if(t){const i=h.before(m),A=h.after(m);r.delete(i,A).scrollIntoView()}return!0}return!1},SW=r=>({tr:t,state:s,dispatch:l})=>{const h=jo(r,s.schema),m=t.selection.$anchor;for(let v=m.depth;v>0;v-=1)if(m.node(v).type===h){if(l){const A=m.before(v),P=m.after(v);t.delete(A,P).scrollIntoView()}return!0}return!1},TW=r=>({tr:t,dispatch:s})=>{const{from:l,to:h}=r;return s&&t.delete(l,h),!0},EW=()=>({state:r,dispatch:t})=>t2(r,t),CW=()=>({commands:r})=>r.keyboardShortcut("Enter"),AW=()=>({state:r,dispatch:t})=>Cq(r,t),IW=(r,t={})=>({tr:s,state:l,dispatch:h})=>{const m=Mf(r,l.schema),{doc:v,selection:i}=s,{$from:A,from:P,to:D}=i;if(h){const F=u2(A,m,t);if(F&&F.from<=P&&F.to>=D){const $=ti.create(v,F.from,F.to);s.setSelection($)}}return!0},MW=r=>t=>{const s=typeof r=="function"?r(t):r;for(let l=0;l<s.length;l+=1)if(s[l](t))return!0;return!1};function kW(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function f2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var PW=(r=null,t={})=>({editor:s,view:l,tr:h,dispatch:m})=>{t={scrollIntoView:!0,...t};const v=()=>{(f2()||kW())&&l.dom.focus(),requestAnimationFrame(()=>{s.isDestroyed||(l.focus(),t?.scrollIntoView&&s.commands.scrollIntoView())})};if(l.hasFocus()&&r===null||r===!1)return!0;if(m&&r===null&&!YO(s.state.selection))return v(),!0;const i=JO(h.doc,r)||s.state.selection,A=s.state.selection.eq(i);return m&&(A||h.setSelection(i),A&&h.storedMarks&&h.setStoredMarks(h.storedMarks),v()),!0},RW=(r,t)=>s=>r.every((l,h)=>t(l,{...s,index:h})),NW=(r,t)=>({tr:s,commands:l})=>l.insertContentAt({from:s.selection.from,to:s.selection.to},r,t),DW=r=>!("type"in r),OW=(r,t,s)=>({tr:l,dispatch:h,editor:m})=>{var v;if(h){s={parseOptions:m.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...s};let i;const{selection:A}=m.state,P=fe=>{m.emit("contentError",{editor:m,error:fe,disableCollaboration:()=>{"collaboration"in m.storage&&typeof m.storage.collaboration=="object"&&m.storage.collaboration&&(m.storage.collaboration.isDisabled=!0)}})},D={preserveWhitespace:"full",...s.parseOptions};if(!s.errorOnInvalidContent&&!m.options.enableContentCheck&&m.options.emitContentError)try{cx(t,m.schema,{parseOptions:D,errorOnInvalidContent:!0})}catch(fe){P(fe)}try{i=cx(t,m.schema,{parseOptions:D,errorOnInvalidContent:(v=s.errorOnInvalidContent)!=null?v:m.options.enableContentCheck})}catch(fe){return P(fe),!1}let{from:F,to:$}=typeof r=="number"?{from:r,to:r}:{from:r.from,to:r.to},K=!0,J=!0;if((DW(i)?i:[i]).forEach(fe=>{fe.check(),K=K?fe.isText&&fe.marks.length===0:!1,J=J?fe.isBlock:!1}),F===$&&J){const{parent:fe}=l.doc.resolve(F);fe.isTextblock&&!fe.type.spec.code&&!fe.childCount&&(F-=1,$+=1)}let ie;if(K){if(Array.isArray(t))ie=t.map(fe=>fe.text||"").join("");else if(t instanceof dr){let fe="";t.forEach(Pe=>{Pe.text&&(fe+=Pe.text)}),ie=fe}else typeof t=="object"&&t&&t.text?ie=t.text:ie=t;l.insertText(ie,F,$)}else{ie=i;const fe=A.$from.parentOffset===0,Pe=A.$from.node().isText||A.$from.node().isTextblock,Fe=A.$from.node().content.size>0;fe&&Pe&&Fe&&(F=Math.max(0,F-1)),l.replaceWith(F,$,ie)}s.updateSelection&&sW(l,l.steps.length-1,-1),s.applyInputRules&&l.setMeta("applyInputRules",{from:F,text:ie}),s.applyPasteRules&&l.setMeta("applyPasteRules",{from:F,text:ie})}return!0},LW=()=>({state:r,dispatch:t})=>Sq(r,t),zW=()=>({state:r,dispatch:t})=>Tq(r,t),jW=()=>({state:r,dispatch:t})=>AO(r,t),FW=()=>({state:r,dispatch:t})=>PO(r,t),BW=()=>({state:r,dispatch:t,tr:s})=>{try{const l=M1(r.doc,r.selection.$from.pos,-1);return l==null?!1:(s.join(l,2),t&&t(s),!0)}catch{return!1}},VW=()=>({state:r,dispatch:t,tr:s})=>{try{const l=M1(r.doc,r.selection.$from.pos,1);return l==null?!1:(s.join(l,2),t&&t(s),!0)}catch{return!1}},UW=()=>({state:r,dispatch:t})=>bq(r,t),$W=()=>({state:r,dispatch:t})=>wq(r,t);function iL(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function HW(r){const t=r.split(/-(?!$)/);let s=t[t.length-1];s==="Space"&&(s=" ");let l,h,m,v;for(let i=0;i<t.length-1;i+=1){const A=t[i];if(/^(cmd|meta|m)$/i.test(A))v=!0;else if(/^a(lt)?$/i.test(A))l=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else if(/^mod$/i.test(A))f2()||iL()?v=!0:h=!0;else throw new Error(`Unrecognized modifier name: ${A}`)}return l&&(s=`Alt-${s}`),h&&(s=`Ctrl-${s}`),v&&(s=`Meta-${s}`),m&&(s=`Shift-${s}`),s}var GW=r=>({editor:t,view:s,tr:l,dispatch:h})=>{const m=HW(r).split(/-(?!$)/),v=m.find(P=>!["Alt","Ctrl","Meta","Shift"].includes(P)),i=new KeyboardEvent("keydown",{key:v==="Space"?" ":v,altKey:m.includes("Alt"),ctrlKey:m.includes("Ctrl"),metaKey:m.includes("Meta"),shiftKey:m.includes("Shift"),bubbles:!0,cancelable:!0}),A=t.captureTransaction(()=>{s.someProp("handleKeyDown",P=>P(s,i))});return A?.steps.forEach(P=>{const D=P.map(l.mapping);D&&h&&l.maybeStep(D)}),!0},qW=(r,t={})=>({state:s,dispatch:l})=>{const h=jo(r,s.schema);return tm(s,h,t)?Eq(s,l):!1},WW=()=>({state:r,dispatch:t})=>OO(r,t),ZW=r=>({state:t,dispatch:s})=>{const l=jo(r,t.schema);return zq(l)(t,s)},XW=()=>({state:r,dispatch:t})=>NO(r,t);function mk(r,t){const s=typeof t=="string"?[t]:t;return Object.keys(r).reduce((l,h)=>(s.includes(h)||(l[h]=r[h]),l),{})}var KW=(r,t)=>({tr:s,state:l,dispatch:h})=>{let m=null,v=null;const i=j1(typeof r=="string"?r:r.name,l.schema);return i?(i==="node"&&(m=jo(r,l.schema)),i==="mark"&&(v=Mf(r,l.schema)),h&&s.selection.ranges.forEach(A=>{l.doc.nodesBetween(A.$from.pos,A.$to.pos,(P,D)=>{m&&m===P.type&&s.setNodeMarkup(D,void 0,mk(P.attrs,t)),v&&P.marks.length&&P.marks.forEach(F=>{v===F.type&&s.addMark(D,D+P.nodeSize,v.create(mk(F.attrs,t)))})})}),!0):!1},YW=()=>({tr:r,dispatch:t})=>(t&&r.scrollIntoView(),!0),JW=()=>({tr:r,dispatch:t})=>{if(t){const s=new Ic(r.doc);r.setSelection(s)}return!0},QW=()=>({state:r,dispatch:t})=>MO(r,t),e9=()=>({state:r,dispatch:t})=>RO(r,t),t9=()=>({state:r,dispatch:t})=>Mq(r,t),r9=()=>({state:r,dispatch:t})=>Rq(r,t),n9=()=>({state:r,dispatch:t})=>Pq(r,t),i9=(r,{errorOnInvalidContent:t,emitUpdate:s=!0,parseOptions:l={}}={})=>({editor:h,tr:m,dispatch:v,commands:i})=>{const{doc:A}=m;if(l.preserveWhitespace!=="full"){const P=GS(r,h.schema,l,{errorOnInvalidContent:t??h.options.enableContentCheck});return v&&m.replaceWith(0,A.content.size,P).setMeta("preventUpdate",!s),!0}return v&&m.setMeta("preventUpdate",!s),i.insertContentAt({from:0,to:A.content.size},r,{parseOptions:l,errorOnInvalidContent:t??h.options.enableContentCheck})};function s9(r,t,s){var l;const{selection:h}=t;let m=null;if(YO(h)&&(m=h.$cursor),m){const i=(l=r.storedMarks)!=null?l:m.marks();return!!s.isInSet(i)||!i.some(A=>A.type.excludes(s))}const{ranges:v}=h;return v.some(({$from:i,$to:A})=>{let P=i.depth===0?r.doc.inlineContent&&r.doc.type.allowsMarkType(s):!1;return r.doc.nodesBetween(i.pos,A.pos,(D,F,$)=>{if(P)return!1;if(D.isInline){const K=!$||$.type.allowsMarkType(s),J=!!s.isInSet(D.marks)||!D.marks.some(W=>W.type.excludes(s));P=K&&J}return!P}),P})}var o9=(r,t={})=>({tr:s,state:l,dispatch:h})=>{const{selection:m}=s,{empty:v,ranges:i}=m,A=Mf(r,l.schema);if(h)if(v){const P=qO(l,A);s.addStoredMark(A.create({...P,...t}))}else i.forEach(P=>{const D=P.$from.pos,F=P.$to.pos;l.doc.nodesBetween(D,F,($,K)=>{const J=Math.max(K,D),W=Math.min(K+$.nodeSize,F);$.marks.find(fe=>fe.type===A)?$.marks.forEach(fe=>{A===fe.type&&s.addMark(J,W,A.create({...fe.attrs,...t}))}):s.addMark(J,W,A.create(t))})});return s9(l,s,A)},a9=(r,t)=>({tr:s})=>(s.setMeta(r,t),!0),l9=(r,t={})=>({state:s,dispatch:l,chain:h})=>{const m=jo(r,s.schema);let v;return s.selection.$anchor.sameParent(s.selection.$head)&&(v=s.selection.$anchor.parent.attrs),m.isTextblock?h().command(({commands:i})=>ck(m,{...v,...t})(s)?!0:i.clearNodes()).command(({state:i})=>ck(m,{...v,...t})(i,l)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},c9=r=>({tr:t,dispatch:s})=>{if(s){const{doc:l}=t,h=tg(r,0,l.content.size),m=kn.create(l,h);t.setSelection(m)}return!0},u9=r=>({tr:t,dispatch:s})=>{if(s){const{doc:l}=t,{from:h,to:m}=typeof r=="number"?{from:r,to:r}:r,v=ti.atStart(l).from,i=ti.atEnd(l).to,A=tg(h,v,i),P=tg(m,v,i),D=ti.create(l,A,P);t.setSelection(D)}return!0},h9=r=>({state:t,dispatch:s})=>{const l=jo(r,t.schema);return Bq(l)(t,s)};function gk(r,t){const s=r.storedMarks||r.selection.$to.parentOffset&&r.selection.$from.marks();if(s){const l=s.filter(h=>t?.includes(h.type.name));r.tr.ensureMarks(l)}}var d9=({keepMarks:r=!0}={})=>({tr:t,state:s,dispatch:l,editor:h})=>{const{selection:m,doc:v}=t,{$from:i,$to:A}=m,P=h.extensionManager.attributes,D=Qv(P,i.node().type.name,i.node().attrs);if(m instanceof kn&&m.node.isBlock)return!i.parentOffset||!wf(v,i.pos)?!1:(l&&(r&&gk(s,h.extensionManager.splittableMarks),t.split(i.pos).scrollIntoView()),!0);if(!i.parent.isBlock)return!1;const F=A.parentOffset===A.parent.content.size,$=i.depth===0?void 0:$q(i.node(-1).contentMatchAt(i.indexAfter(-1)));let K=F&&$?[{type:$,attrs:D}]:void 0,J=wf(t.doc,t.mapping.map(i.pos),1,K);if(!K&&!J&&wf(t.doc,t.mapping.map(i.pos),1,$?[{type:$}]:void 0)&&(J=!0,K=$?[{type:$,attrs:D}]:void 0),l){if(J&&(m instanceof ti&&t.deleteSelection(),t.split(t.mapping.map(i.pos),1,K),$&&!F&&!i.parentOffset&&i.parent.type!==$)){const W=t.mapping.map(i.before()),ie=t.doc.resolve(W);i.node(-1).canReplaceWith(ie.index(),ie.index()+1,$)&&t.setNodeMarkup(t.mapping.map(i.before()),$)}r&&gk(s,h.extensionManager.splittableMarks),t.scrollIntoView()}return J},f9=(r,t={})=>({tr:s,state:l,dispatch:h,editor:m})=>{var v;const i=jo(r,l.schema),{$from:A,$to:P}=l.selection,D=l.selection.node;if(D&&D.isBlock||A.depth<2||!A.sameParent(P))return!1;const F=A.node(-1);if(F.type!==i)return!1;const $=m.extensionManager.attributes;if(A.parent.content.size===0&&A.node(-1).childCount===A.indexAfter(-1)){if(A.depth===2||A.node(-3).type!==i||A.index(-2)!==A.node(-2).childCount-1)return!1;if(h){let fe=dr.empty;const Pe=A.index(-1)?1:A.index(-2)?2:3;for(let Rt=A.depth-Pe;Rt>=A.depth-3;Rt-=1)fe=dr.from(A.node(Rt).copy(fe));const Fe=A.indexAfter(-1)<A.node(-2).childCount?1:A.indexAfter(-2)<A.node(-3).childCount?2:3,ht={...Qv($,A.node().type.name,A.node().attrs),...t},at=((v=i.contentMatch.defaultType)==null?void 0:v.createAndFill(ht))||void 0;fe=fe.append(dr.from(i.createAndFill(null,at)||void 0));const Dt=A.before(A.depth-(Pe-1));s.replace(Dt,A.after(-Fe),new Yr(fe,4-Pe,0));let kt=-1;s.doc.nodesBetween(Dt,s.doc.content.size,(Rt,hr)=>{if(kt>-1)return!1;Rt.isTextblock&&Rt.content.size===0&&(kt=hr+1)}),kt>-1&&s.setSelection(ti.near(s.doc.resolve(kt))),s.scrollIntoView()}return!0}const K=P.pos===A.end()?F.contentMatchAt(0).defaultType:null,J={...Qv($,F.type.name,F.attrs),...t},W={...Qv($,A.node().type.name,A.node().attrs),...t};s.delete(A.pos,P.pos);const ie=K?[{type:i,attrs:J},{type:K,attrs:W}]:[{type:i,attrs:J}];if(!wf(s.doc,A.pos,2))return!1;if(h){const{selection:fe,storedMarks:Pe}=l,{splittableMarks:Fe}=m.extensionManager,ht=Pe||fe.$to.parentOffset&&fe.$from.marks();if(s.split(A.pos,2,ie).scrollIntoView(),!ht||!h)return!0;const at=ht.filter(Dt=>Fe.includes(Dt.type.name));s.ensureMarks(at)}return!0},Bw=(r,t)=>{const s=z1(v=>v.type===t)(r.selection);if(!s)return!0;const l=r.doc.resolve(Math.max(0,s.pos-1)).before(s.depth);if(l===void 0)return!0;const h=r.doc.nodeAt(l);return s.node.type===h?.type&&om(r.doc,s.pos)&&r.join(s.pos),!0},Vw=(r,t)=>{const s=z1(v=>v.type===t)(r.selection);if(!s)return!0;const l=r.doc.resolve(s.start).after(s.depth);if(l===void 0)return!0;const h=r.doc.nodeAt(l);return s.node.type===h?.type&&om(r.doc,l)&&r.join(l),!0},p9=(r,t,s,l={})=>({editor:h,tr:m,state:v,dispatch:i,chain:A,commands:P,can:D})=>{const{extensions:F,splittableMarks:$}=h.extensionManager,K=jo(r,v.schema),J=jo(t,v.schema),{selection:W,storedMarks:ie}=v,{$from:fe,$to:Pe}=W,Fe=fe.blockRange(Pe),ht=ie||W.$to.parentOffset&&W.$from.marks();if(!Fe)return!1;const at=z1(Dt=>pk(Dt.type.name,F))(W);if(Fe.depth>=1&&at&&Fe.depth-at.depth<=1){if(at.node.type===K)return P.liftListItem(J);if(pk(at.node.type.name,F)&&K.validContent(at.node.content)&&i)return A().command(()=>(m.setNodeMarkup(at.pos,K),!0)).command(()=>Bw(m,K)).command(()=>Vw(m,K)).run()}return!s||!ht||!i?A().command(()=>D().wrapInList(K,l)?!0:P.clearNodes()).wrapInList(K,l).command(()=>Bw(m,K)).command(()=>Vw(m,K)).run():A().command(()=>{const Dt=D().wrapInList(K,l),kt=ht.filter(Rt=>$.includes(Rt.type.name));return m.ensureMarks(kt),Dt?!0:P.clearNodes()}).wrapInList(K,l).command(()=>Bw(m,K)).command(()=>Vw(m,K)).run()},m9=(r,t={},s={})=>({state:l,commands:h})=>{const{extendEmptyMarkRange:m=!1}=s,v=Mf(r,l.schema);return qS(l,v,t)?h.unsetMark(v,{extendEmptyMarkRange:m}):h.setMark(v,t)},g9=(r,t,s={})=>({state:l,commands:h})=>{const m=jo(r,l.schema),v=jo(t,l.schema),i=tm(l,m,s);let A;return l.selection.$anchor.sameParent(l.selection.$head)&&(A=l.selection.$anchor.parent.attrs),i?h.setNode(v,A):h.setNode(m,{...A,...s})},y9=(r,t={})=>({state:s,commands:l})=>{const h=jo(r,s.schema);return tm(s,h,t)?l.lift(h):l.wrapIn(h,t)},_9=()=>({state:r,dispatch:t})=>{const s=r.plugins;for(let l=0;l<s.length;l+=1){const h=s[l];let m;if(h.spec.isInputRules&&(m=h.getState(r))){if(t){const v=r.tr,i=m.transform;for(let A=i.steps.length-1;A>=0;A-=1)v.step(i.steps[A].invert(i.docs[A]));if(m.text){const A=v.doc.resolve(m.from).marks();v.replaceWith(m.from,m.to,r.schema.text(m.text,A))}else v.delete(m.from,m.to)}return!0}}return!1},x9=()=>({tr:r,dispatch:t})=>{const{selection:s}=r,{empty:l,ranges:h}=s;return l||t&&h.forEach(m=>{r.removeMark(m.$from.pos,m.$to.pos)}),!0},v9=(r,t={})=>({tr:s,state:l,dispatch:h})=>{var m;const{extendEmptyMarkRange:v=!1}=t,{selection:i}=s,A=Mf(r,l.schema),{$from:P,empty:D,ranges:F}=i;if(!h)return!0;if(D&&v){let{from:$,to:K}=i;const J=(m=P.marks().find(ie=>ie.type===A))==null?void 0:m.attrs,W=u2(P,A,J);W&&($=W.from,K=W.to),s.removeMark($,K,A)}else F.forEach($=>{s.removeMark($.$from.pos,$.$to.pos,A)});return s.removeStoredMark(A),!0},b9=(r,t={})=>({tr:s,state:l,dispatch:h})=>{let m=null,v=null;const i=j1(typeof r=="string"?r:r.name,l.schema);return i?(i==="node"&&(m=jo(r,l.schema)),i==="mark"&&(v=Mf(r,l.schema)),h&&s.selection.ranges.forEach(A=>{const P=A.$from.pos,D=A.$to.pos;let F,$,K,J;s.selection.empty?l.doc.nodesBetween(P,D,(W,ie)=>{m&&m===W.type&&(K=Math.max(ie,P),J=Math.min(ie+W.nodeSize,D),F=ie,$=W)}):l.doc.nodesBetween(P,D,(W,ie)=>{ie<P&&m&&m===W.type&&(K=Math.max(ie,P),J=Math.min(ie+W.nodeSize,D),F=ie,$=W),ie>=P&&ie<=D&&(m&&m===W.type&&s.setNodeMarkup(ie,void 0,{...W.attrs,...t}),v&&W.marks.length&&W.marks.forEach(fe=>{if(v===fe.type){const Pe=Math.max(ie,P),Fe=Math.min(ie+W.nodeSize,D);s.addMark(Pe,Fe,v.create({...fe.attrs,...t}))}}))}),$&&(F!==void 0&&s.setNodeMarkup(F,void 0,{...$.attrs,...t}),v&&$.marks.length&&$.marks.forEach(W=>{v===W.type&&s.addMark(K,J,v.create({...W.attrs,...t}))}))}),!0):!1},w9=(r,t={})=>({state:s,dispatch:l})=>{const h=jo(r,s.schema);return Nq(h,t)(s,l)},S9=(r,t={})=>({state:s,dispatch:l})=>{const h=jo(r,s.schema);return Dq(h,t)(s,l)},sL=Es.create({name:"commands",addCommands(){return{...nL}}}),oL=Es.create({name:"delete",onUpdate({transaction:r,appendedTransactions:t}){var s,l,h;const m=()=>{var v,i,A,P;if((P=(A=(i=(v=this.editor.options.coreExtensionOptions)==null?void 0:v.delete)==null?void 0:i.filterTransaction)==null?void 0:A.call(i,r))!=null?P:r.getMeta("y-sync$"))return;const D=FO(r.before,[r,...t]);ZO(D).forEach(K=>{D.mapping.mapResult(K.oldRange.from).deletedAfter&&D.mapping.mapResult(K.oldRange.to).deletedBefore&&D.before.nodesBetween(K.oldRange.from,K.oldRange.to,(J,W)=>{const ie=W+J.nodeSize-2,fe=K.oldRange.from<=W&&ie<=K.oldRange.to;this.editor.emit("delete",{type:"node",node:J,from:W,to:ie,newFrom:D.mapping.map(W),newTo:D.mapping.map(ie),deletedRange:K.oldRange,newRange:K.newRange,partial:!fe,editor:this.editor,transaction:r,combinedTransform:D})})});const $=D.mapping;D.steps.forEach((K,J)=>{var W,ie;if(K instanceof hh){const fe=$.slice(J).map(K.from,-1),Pe=$.slice(J).map(K.to),Fe=$.invert().map(fe,-1),ht=$.invert().map(Pe),at=(W=D.doc.nodeAt(fe-1))==null?void 0:W.marks.some(kt=>kt.eq(K.mark)),Dt=(ie=D.doc.nodeAt(Pe))==null?void 0:ie.marks.some(kt=>kt.eq(K.mark));this.editor.emit("delete",{type:"mark",mark:K.mark,from:K.from,to:K.to,deletedRange:{from:Fe,to:ht},newRange:{from:fe,to:Pe},partial:!!(Dt||at),editor:this.editor,transaction:r,combinedTransform:D})}})};(h=(l=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:l.async)==null||h?setTimeout(m,0):m()}}),aL=Es.create({name:"drop",addProseMirrorPlugins(){return[new po({key:new ba("tiptapDrop"),props:{handleDrop:(r,t,s,l)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:s,moved:l})}}})]}}),lL=Es.create({name:"editable",addProseMirrorPlugins(){return[new po({key:new ba("editable"),props:{editable:()=>this.editor.options.editable}})]}}),cL=new ba("focusEvents"),uL=Es.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:r}=this;return[new po({key:cL,props:{handleDOMEvents:{focus:(t,s)=>{r.isFocused=!0;const l=r.state.tr.setMeta("focus",{event:s}).setMeta("addToHistory",!1);return t.dispatch(l),!1},blur:(t,s)=>{r.isFocused=!1;const l=r.state.tr.setMeta("blur",{event:s}).setMeta("addToHistory",!1);return t.dispatch(l),!1}}}})]}}),hL=Es.create({name:"keymap",addKeyboardShortcuts(){const r=()=>this.editor.commands.first(({commands:v})=>[()=>v.undoInputRule(),()=>v.command(({tr:i})=>{const{selection:A,doc:P}=i,{empty:D,$anchor:F}=A,{pos:$,parent:K}=F,J=F.parent.isTextblock&&$>0?i.doc.resolve($-1):F,W=J.parent.type.spec.isolating,ie=F.pos-F.parentOffset,fe=W&&J.parent.childCount===1?ie===F.pos:xi.atStart(P).from===$;return!D||!K.type.isTextblock||K.textContent.length||!fe||fe&&F.parent.type.name==="paragraph"?!1:v.clearNodes()}),()=>v.deleteSelection(),()=>v.joinBackward(),()=>v.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:v})=>[()=>v.deleteSelection(),()=>v.deleteCurrentNode(),()=>v.joinForward(),()=>v.selectNodeForward()]),l={Enter:()=>this.editor.commands.first(({commands:v})=>[()=>v.newlineInCode(),()=>v.createParagraphNear(),()=>v.liftEmptyBlock(),()=>v.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:r,"Mod-Backspace":r,"Shift-Backspace":r,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},h={...l},m={...l,"Ctrl-h":r,"Alt-Backspace":r,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return f2()||iL()?m:h},addProseMirrorPlugins(){return[new po({key:new ba("clearDocument"),appendTransaction:(r,t,s)=>{if(r.some(W=>W.getMeta("composition")))return;const l=r.some(W=>W.docChanged)&&!t.doc.eq(s.doc),h=r.some(W=>W.getMeta("preventClearDocument"));if(!l||h)return;const{empty:m,from:v,to:i}=t.selection,A=xi.atStart(t.doc).from,P=xi.atEnd(t.doc).to;if(m||!(v===A&&i===P)||!F1(s.doc))return;const $=s.tr,K=O1({state:s,transaction:$}),{commands:J}=new L1({editor:this.editor,state:K});if(J.clearNodes(),!!$.steps.length)return $}})]}}),dL=Es.create({name:"paste",addProseMirrorPlugins(){return[new po({key:new ba("tiptapPaste"),props:{handlePaste:(r,t,s)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:s})}}})]}}),fL=Es.create({name:"tabindex",addProseMirrorPlugins(){return[new po({key:new ba("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),T9=class hy{constructor(t,s,l=!1,h=null){this.currentNode=null,this.actualDepth=null,this.isBlock=l,this.resolvedPos=t,this.editor=s,this.currentNode=h}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!=null?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let s=this.from,l=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}s=this.from+1,l=this.to-1}this.editor.commands.insertContentAt({from:s,to:l},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),s=this.resolvedPos.doc.resolve(t);return new hy(s,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new hy(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new hy(t,this.editor)}get children(){const t=[];return this.node.content.forEach((s,l)=>{const h=s.isBlock&&!s.isTextblock,m=s.isAtom&&!s.isText,v=this.pos+l+(m?0:1);if(v<0||v>this.resolvedPos.doc.nodeSize-2)return;const i=this.resolvedPos.doc.resolve(v);if(!h&&i.depth<=this.depth)return;const A=new hy(i,this.editor,h,h?s:null);h&&(A.actualDepth=this.depth+1),t.push(new hy(i,this.editor,h,h?s:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,s={}){let l=null,h=this.parent;for(;h&&!l;){if(h.node.type.name===t)if(Object.keys(s).length>0){const m=h.node.attrs,v=Object.keys(s);for(let i=0;i<v.length;i+=1){const A=v[i];if(m[A]!==s[A])break}}else l=h;h=h.parent}return l}querySelector(t,s={}){return this.querySelectorAll(t,s,!0)[0]||null}querySelectorAll(t,s={},l=!1){let h=[];if(!this.children||this.children.length===0)return h;const m=Object.keys(s);return this.children.forEach(v=>{l&&h.length>0||(v.node.type.name===t&&m.every(A=>s[A]===v.node.attrs[A])&&h.push(v),!(l&&h.length>0)&&(h=h.concat(v.querySelectorAll(t,s,l))))}),h}setAttribute(t){const{tr:s}=this.editor.state;s.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(s)}},E9=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function C9(r,t,s){const l=document.querySelector("style[data-tiptap-style]");if(l!==null)return l;const h=document.createElement("style");return t&&h.setAttribute("nonce",t),h.setAttribute("data-tiptap-style",""),h.innerHTML=r,document.getElementsByTagName("head")[0].appendChild(h),h}var A9=class extends Uq{constructor(r={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:l})=>{throw l},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(r),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:l,slice:h,moved:m})=>this.options.onDrop(l,h,m)),this.on("paste",({event:l,slice:h})=>this.options.onPaste(l,h)),this.on("delete",this.options.onDelete);const t=this.createDoc(),s=JO(t,this.options.autofocus);this.editorState=fy.create({doc:t,schema:this.schema,selection:s||void 0}),this.options.element&&this.mount(this.options.element)}mount(r){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(r),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){var r;if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}this.editorView=null,this.isInitialized=!1,(r=this.css)==null||r.remove(),this.css=null}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=C9(E9,this.options.injectNonce))}setOptions(r={}){this.options={...this.options,...r},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(r,t=!0){this.setOptions({editable:r}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:r=>{this.editorState=r},dispatch:r=>{this.editorState=this.state.apply(r)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(r,t)=>{if(t==="state")return this.editorState;if(t in r)return Reflect.get(r,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(r,t){const s=VO(t)?t(r,[...this.state.plugins]):[...this.state.plugins,r],l=this.state.reconfigure({plugins:s});return this.view.updateState(l),l}unregisterPlugin(r){if(this.isDestroyed)return;const t=this.state.plugins;let s=t;if([].concat(r).forEach(h=>{const m=typeof h=="string"?`${h}$`:h.key;s=s.filter(v=>!v.key.startsWith(m))}),t.length===s.length)return;const l=this.state.reconfigure({plugins:s});return this.view.updateState(l),l}createExtensionManager(){var r,t;const l=[...this.options.enableCoreExtensions?[lL,rL.configure({blockSeparator:(t=(r=this.options.coreExtensionOptions)==null?void 0:r.clipboardTextSerializer)==null?void 0:t.blockSeparator}),sL,uL,hL,fL,aL,dL,oL].filter(h=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[h.name]!==!1:!0):[],...this.options.extensions].filter(h=>["extension","node","mark"].includes(h?.type));this.extensionManager=new V1(l,this)}createCommandManager(){this.commandManager=new L1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let r;try{r=GS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(s=>s.name!=="collaboration"),this.createExtensionManager()}}),r=GS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return r}createView(r){var t;this.editorView=new TO(r,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)==null?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass(),this.injectCSS();const l=this.view.dom;l.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(r){this.isCapturingTransaction=!0,r(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(r){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=r;return}r.steps.forEach(P=>{var D;return(D=this.capturedTransaction)==null?void 0:D.step(P)});return}const{state:t,transactions:s}=this.state.applyTransaction(r),l=!this.state.selection.eq(t.selection),h=s.includes(r),m=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:r,nextState:t}),!h)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:r,appendedTransactions:s.slice(1)}),l&&this.emit("selectionUpdate",{editor:this,transaction:r});const v=s.findLast(P=>P.getMeta("focus")||P.getMeta("blur")),i=v?.getMeta("focus"),A=v?.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:v}),A&&this.emit("blur",{editor:this,event:A.event,transaction:v}),!(r.getMeta("preventUpdate")||!s.some(P=>P.docChanged)||m.doc.eq(t.doc))&&this.emit("update",{editor:this,transaction:r,appendedTransactions:s.slice(1)})}getAttributes(r){return WO(this.state,r)}isActive(r,t){const s=typeof r=="string"?r:null,l=typeof r=="string"?t:r;return rW(this.state,s,l)}getJSON(){return this.state.doc.toJSON()}getHTML(){return a2(this.state.doc.content,this.schema)}getText(r){const{blockSeparator:t=`

`,textSerializers:s={}}=r||{};return Kq(this.state.doc,{blockSeparator:t,textSerializers:{...GO(this.schema),...s}})}get isEmpty(){return F1(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var r,t;return(t=(r=this.editorView)==null?void 0:r.isDestroyed)!=null?t:!0}$node(r,t){var s;return((s=this.$doc)==null?void 0:s.querySelector(r,t))||null}$nodes(r,t){var s;return((s=this.$doc)==null?void 0:s.querySelectorAll(r,t))||null}$pos(r){const t=this.state.doc.resolve(r);return new T9(t,this)}get $doc(){return this.$pos(0)}};function Ay(r){return new B1({find:r.find,handler:({state:t,range:s,match:l})=>{const h=cs(r.getAttributes,void 0,l);if(h===!1||h===null)return null;const{tr:m}=t,v=l[l.length-1],i=l[0];if(v){const A=i.search(/\S/),P=s.from+i.indexOf(v),D=P+v.length;if(h2(s.from,s.to,t.doc).filter(K=>K.mark.type.excluded.find(W=>W===r.type&&W!==K.mark.type)).filter(K=>K.to>P).length)return null;D<s.to&&m.delete(D,s.to),P>s.from&&m.delete(s.from+A,P);const $=s.from+A+v.length;m.addMark(s.from+A,$,r.type.create(h||{})),m.removeStoredMark(r.type)}}})}function I9(r){return new B1({find:r.find,handler:({state:t,range:s,match:l})=>{const h=cs(r.getAttributes,void 0,l)||{},{tr:m}=t,v=s.from;let i=s.to;const A=r.type.create(h);if(l[1]){const P=l[0].lastIndexOf(l[1]);let D=v+P;D>i?D=i:i=D+l[1].length;const F=l[0][l[0].length-1];m.insertText(F,v+l[0].length-1),m.replaceWith(D,i,A)}else if(l[0]){const P=r.type.isInline?v:v-1;m.insert(P,r.type.create(h)).delete(m.mapping.map(v),m.mapping.map(i))}m.scrollIntoView()}})}function WS(r){return new B1({find:r.find,handler:({state:t,range:s,match:l})=>{const h=t.doc.resolve(s.from),m=cs(r.getAttributes,void 0,l)||{};if(!h.node(-1).canReplaceWith(h.index(-1),h.indexAfter(-1),r.type))return null;t.tr.delete(s.from,s.to).setBlockType(s.from,s.from,r.type,m)}})}function Iy(r){return new B1({find:r.find,handler:({state:t,range:s,match:l,chain:h})=>{const m=cs(r.getAttributes,void 0,l)||{},v=t.tr.delete(s.from,s.to),A=v.doc.resolve(s.from).blockRange(),P=A&&HT(A,r.type,m);if(!P)return null;if(v.wrap(A,P),r.keepMarks&&r.editor){const{selection:F,storedMarks:$}=t,{splittableMarks:K}=r.editor.extensionManager,J=$||F.$to.parentOffset&&F.$from.marks();if(J){const W=J.filter(ie=>K.includes(ie.type.name));v.ensureMarks(W)}}if(r.keepAttributes){const F=r.type.name==="bulletList"||r.type.name==="orderedList"?"listItem":"taskList";h().updateAttributes(F,m).run()}const D=v.doc.resolve(s.from-1).nodeBefore;D&&D.type===r.type&&om(v.doc,s.from-1)&&(!r.joinPredicate||r.joinPredicate(l,D))&&v.join(s.from-1)}})}function M9(r,t){const{selection:s}=r,{$from:l}=s;if(s instanceof kn){const m=l.index();return l.parent.canReplaceWith(m,m+1,t)}let h=l.depth;for(;h>=0;){const m=l.index(h);if(l.node(h).contentMatchAt(m).matchType(t))return!0;h-=1}return!1}function k9(r,t,s={}){const{state:l}=t,{doc:h,tr:m}=l,v=r;h.descendants((i,A)=>{const P=m.mapping.map(A),D=m.mapping.map(A)+i.nodeSize;let F=null;if(i.marks.forEach(K=>{if(K!==v)return!1;F=K}),!F)return;let $=!1;if(Object.keys(s).forEach(K=>{s[K]!==F.attrs[K]&&($=!0)}),$){const K=r.type.create({...r.attrs,...s});m.removeMark(P,D,r.type),m.addMark(P,D,K)}}),m.docChanged&&t.view.dispatch(m)}var Mc=class pL extends d2{constructor(){super(...arguments),this.type="node"}static create(t={}){const s=typeof t=="function"?t():t;return new pL(s)}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}};function bg(r){return new uW({find:r.find,handler:({state:t,range:s,match:l,pasteEvent:h})=>{const m=cs(r.getAttributes,void 0,l,h);if(m===!1||m===null)return null;const{tr:v}=t,i=l[l.length-1],A=l[0];let P=s.to;if(i){const D=A.search(/\S/),F=s.from+A.indexOf(i),$=F+i.length;if(h2(s.from,s.to,t.doc).filter(J=>J.mark.type.excluded.find(ie=>ie===r.type&&ie!==J.mark.type)).filter(J=>J.to>F).length)return null;$<s.to&&v.delete($,s.to),F>s.from&&v.delete(s.from+D,F),P=s.from+D+i.length,v.addMark(s.from+D,P,r.type.create(m||{})),v.removeStoredMark(r.type)}}})}var Uw,yk;function P9(){return yk||(yk=1,Uw=function r(t,s){if(t===s)return!0;if(t&&s&&typeof t=="object"&&typeof s=="object"){if(t.constructor!==s.constructor)return!1;var l,h,m;if(Array.isArray(t)){if(l=t.length,l!=s.length)return!1;for(h=l;h--!==0;)if(!r(t[h],s[h]))return!1;return!0}if(t instanceof Map&&s instanceof Map){if(t.size!==s.size)return!1;for(h of t.entries())if(!s.has(h[0]))return!1;for(h of t.entries())if(!r(h[1],s.get(h[0])))return!1;return!0}if(t instanceof Set&&s instanceof Set){if(t.size!==s.size)return!1;for(h of t.entries())if(!s.has(h[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(s)){if(l=t.length,l!=s.length)return!1;for(h=l;h--!==0;)if(t[h]!==s[h])return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if(m=Object.keys(t),l=m.length,l!==Object.keys(s).length)return!1;for(h=l;h--!==0;)if(!Object.prototype.hasOwnProperty.call(s,m[h]))return!1;for(h=l;h--!==0;){var v=m[h];if(!(v==="_owner"&&t.$$typeof)&&!r(t[v],s[v]))return!1}return!0}return t!==t&&s!==s}),Uw}var R9=P9();const N9=c1(R9);var $w={exports:{}},Hw={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _k;function D9(){if(_k)return Hw;_k=1;var r=fx(),t=cD();function s(P,D){return P===D&&(P!==0||1/P===1/D)||P!==P&&D!==D}var l=typeof Object.is=="function"?Object.is:s,h=t.useSyncExternalStore,m=r.useRef,v=r.useEffect,i=r.useMemo,A=r.useDebugValue;return Hw.useSyncExternalStoreWithSelector=function(P,D,F,$,K){var J=m(null);if(J.current===null){var W={hasValue:!1,value:null};J.current=W}else W=J.current;J=i(function(){function fe(Dt){if(!Pe){if(Pe=!0,Fe=Dt,Dt=$(Dt),K!==void 0&&W.hasValue){var kt=W.value;if(K(kt,Dt))return ht=kt}return ht=Dt}if(kt=ht,l(Fe,Dt))return kt;var Rt=$(Dt);return K!==void 0&&K(kt,Rt)?(Fe=Dt,kt):(Fe=Dt,ht=Rt)}var Pe=!1,Fe,ht,at=F===void 0?null:F;return[function(){return fe(D())},at===null?void 0:function(){return fe(at())}]},[D,F,$,K]);var ie=h(P,J[0],J[1]);return v(function(){W.hasValue=!0,W.value=ie},[ie]),A(ie),ie},Hw}var xk;function O9(){return xk||(xk=1,$w.exports=D9()),$w.exports}var L9=O9(),z9=(...r)=>t=>{r.forEach(s=>{typeof s=="function"?s(t):s&&(s.current=t)})},j9=({contentComponent:r})=>{const t=uD.useSyncExternalStore(r.subscribe,r.getSnapshot,r.getServerSnapshot);return b.jsx(b.Fragment,{children:Object.values(t)})};function F9(){const r=new Set;let t={};return{subscribe(s){return r.add(s),()=>{r.delete(s)}},getSnapshot(){return t},getServerSnapshot(){return t},setRenderer(s,l){t={...t,[s]:sT.createPortal(l.reactElement,l.element,s)},r.forEach(h=>h())},removeRenderer(s){const l={...t};delete l[s],t=l,r.forEach(h=>h())}}}var B9=class extends Mr.Component{constructor(r){var t;super(r),this.editorContentRef=Mr.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((t=r.editor)!=null&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const r=this.props.editor;if(r&&!r.isDestroyed&&r.options.element){if(r.contentComponent)return;const t=this.editorContentRef.current;t.append(...r.options.element.childNodes),r.setOptions({element:t}),r.contentComponent=F9(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=r.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),r.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var r;const t=this.props.editor;if(!t||(this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null,!((r=t.options.element)!=null&&r.firstChild)))return;const s=document.createElement("div");s.append(...t.options.element.childNodes),t.setOptions({element:s})}render(){const{editor:r,innerRef:t,...s}=this.props;return b.jsxs(b.Fragment,{children:[b.jsx("div",{ref:z9(t,this.editorContentRef),...s}),r?.contentComponent&&b.jsx(j9,{contentComponent:r.contentComponent})]})}},V9=ee.forwardRef((r,t)=>{const s=Mr.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[r.editor]);return Mr.createElement(B9,{key:s,innerRef:t,...r})}),U9=Mr.memo(V9),$9=typeof window<"u"?ee.useLayoutEffect:ee.useEffect,H9=class{constructor(r){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=r,this.lastSnapshot={editor:r,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(r){return this.subscribers.add(r),()=>{this.subscribers.delete(r)}}watch(r){if(this.editor=r,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(l=>l())},s=this.editor;return s.on("transaction",t),()=>{s.off("transaction",t)}}}};function G9(r){var t;const[s]=ee.useState(()=>new H9(r.editor)),l=L9.useSyncExternalStoreWithSelector(s.subscribe,s.getSnapshot,s.getServerSnapshot,r.selector,(t=r.equalityFn)!=null?t:N9);return $9(()=>s.watch(r.editor),[r.editor,s]),ee.useDebugValue(l),l}var q9=!1,ZS=typeof window>"u",W9=ZS||!!(typeof window<"u"&&window.next),Z9=class mL{constructor(t){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=t,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(t){this.editor=t,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(s=>s())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?ZS||W9?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const t={...this.options.current,onBeforeCreate:(...l)=>{var h,m;return(m=(h=this.options.current).onBeforeCreate)==null?void 0:m.call(h,...l)},onBlur:(...l)=>{var h,m;return(m=(h=this.options.current).onBlur)==null?void 0:m.call(h,...l)},onCreate:(...l)=>{var h,m;return(m=(h=this.options.current).onCreate)==null?void 0:m.call(h,...l)},onDestroy:(...l)=>{var h,m;return(m=(h=this.options.current).onDestroy)==null?void 0:m.call(h,...l)},onFocus:(...l)=>{var h,m;return(m=(h=this.options.current).onFocus)==null?void 0:m.call(h,...l)},onSelectionUpdate:(...l)=>{var h,m;return(m=(h=this.options.current).onSelectionUpdate)==null?void 0:m.call(h,...l)},onTransaction:(...l)=>{var h,m;return(m=(h=this.options.current).onTransaction)==null?void 0:m.call(h,...l)},onUpdate:(...l)=>{var h,m;return(m=(h=this.options.current).onUpdate)==null?void 0:m.call(h,...l)},onContentError:(...l)=>{var h,m;return(m=(h=this.options.current).onContentError)==null?void 0:m.call(h,...l)},onDrop:(...l)=>{var h,m;return(m=(h=this.options.current).onDrop)==null?void 0:m.call(h,...l)},onPaste:(...l)=>{var h,m;return(m=(h=this.options.current).onPaste)==null?void 0:m.call(h,...l)},onDelete:(...l)=>{var h,m;return(m=(h=this.options.current).onDelete)==null?void 0:m.call(h,...l)}};return new A9(t)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(t){return this.subscriptions.add(t),()=>{this.subscriptions.delete(t)}}static compareOptions(t,s){return Object.keys(t).every(l=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(l)?!0:l==="extensions"&&t.extensions&&s.extensions?t.extensions.length!==s.extensions.length?!1:t.extensions.every((h,m)=>{var v;return h===((v=s.extensions)==null?void 0:v[m])}):t[l]===s[l])}onRender(t){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&t.length===0?mL.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(t),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(t){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=t;return}if(this.previousDeps.length===t.length&&this.previousDeps.every((l,h)=>l===t[h]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=t}scheduleDestroy(){const t=this.instanceId,s=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===t){s&&s.setOptions(this.options.current);return}s&&!s.isDestroyed&&(s.destroy(),this.instanceId===t&&this.setEditor(null))},1)}};function X9(r={},t=[]){const s=ee.useRef(r);s.current=r;const[l]=ee.useState(()=>new Z9(s)),h=uD.useSyncExternalStore(l.subscribe,l.getEditor,l.getServerSnapshot);return ee.useDebugValue(h),ee.useEffect(l.onRender(t)),G9({editor:h,selector:({transactionNumber:m})=>r.shouldRerenderOnTransaction===!1||r.shouldRerenderOnTransaction===void 0?null:r.immediatelyRender&&m===0?0:m+1}),h}var K9=ee.createContext({editor:null});K9.Consumer;var Y9=ee.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),J9=()=>ee.useContext(Y9);Mr.forwardRef((r,t)=>{const{onDragStart:s}=J9(),l=r.as||"div";return b.jsx(l,{...r,ref:t,"data-node-view-wrapper":"",onDragStart:s,style:{whiteSpace:"normal",...r.style}})});Mr.createContext({markViewContentRef:()=>{}});var D0=(r,t)=>{if(r==="slot")return 0;if(r instanceof Function)return r(t);const{children:s,...l}=t??{};if(r==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[r,l,s]},Q9=/^\s*>\s$/,e7=Mc.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:r}){return D0("blockquote",{...So(this.options.HTMLAttributes,r),children:D0("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:r})=>r.wrapIn(this.name),toggleBlockquote:()=>({commands:r})=>r.toggleWrap(this.name),unsetBlockquote:()=>({commands:r})=>r.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Iy({find:Q9,type:this.type})]}}),t7=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,r7=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,n7=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,i7=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,s7=lm.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:r=>r.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:r=>r.type.name===this.name},{style:"font-weight",getAttrs:r=>/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}]},renderHTML({HTMLAttributes:r}){return D0("strong",{...So(this.options.HTMLAttributes,r),children:D0("slot",{})})},addCommands(){return{setBold:()=>({commands:r})=>r.setMark(this.name),toggleBold:()=>({commands:r})=>r.toggleMark(this.name),unsetBold:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Ay({find:t7,type:this.type}),Ay({find:n7,type:this.type})]},addPasteRules(){return[bg({find:r7,type:this.type}),bg({find:i7,type:this.type})]}}),o7=/(^|[^`])`([^`]+)`(?!`)/,a7=/(^|[^`])`([^`]+)`(?!`)/g,l7=lm.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:r}){return["code",So(this.options.HTMLAttributes,r),0]},addCommands(){return{setCode:()=>({commands:r})=>r.setMark(this.name),toggleCode:()=>({commands:r})=>r.toggleMark(this.name),unsetCode:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Ay({find:o7,type:this.type})]},addPasteRules(){return[bg({find:a7,type:this.type})]}}),c7=/^```([a-z]+)?[\s\n]$/,u7=/^~~~([a-z]+)?[\s\n]$/,h7=Mc.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:r=>{var t;const{languageClassPrefix:s}=this.options,m=[...((t=r.firstElementChild)==null?void 0:t.classList)||[]].filter(v=>v.startsWith(s)).map(v=>v.replace(s,""))[0];return m||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:r,HTMLAttributes:t}){return["pre",So(this.options.HTMLAttributes,t),["code",{class:r.attrs.language?this.options.languageClassPrefix+r.attrs.language:null},0]]},addCommands(){return{setCodeBlock:r=>({commands:t})=>t.setNode(this.name,r),toggleCodeBlock:r=>({commands:t})=>t.toggleNode(this.name,"paragraph",r)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:r,$anchor:t}=this.editor.state.selection,s=t.pos===1;return!r||t.parent.type.name!==this.name?!1:s||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:r})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=r,{selection:s}=t,{$from:l,empty:h}=s;if(!h||l.parent.type!==this.type)return!1;const m=l.parentOffset===l.parent.nodeSize-2,v=l.parent.textContent.endsWith(`

`);return!m||!v?!1:r.chain().command(({tr:i})=>(i.delete(l.pos-2,l.pos),!0)).exitCode().run()},ArrowDown:({editor:r})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=r,{selection:s,doc:l}=t,{$from:h,empty:m}=s;if(!m||h.parent.type!==this.type||!(h.parentOffset===h.parent.nodeSize-2))return!1;const i=h.after();return i===void 0?!1:l.nodeAt(i)?r.commands.command(({tr:P})=>(P.setSelection(xi.near(l.resolve(i))),!0)):r.commands.exitCode()}}},addInputRules(){return[WS({find:c7,type:this.type,getAttributes:r=>({language:r[1]})}),WS({find:u7,type:this.type,getAttributes:r=>({language:r[1]})})]},addProseMirrorPlugins(){return[new po({key:new ba("codeBlockVSCodeHandler"),props:{handlePaste:(r,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const s=t.clipboardData.getData("text/plain"),l=t.clipboardData.getData("vscode-editor-data"),h=l?JSON.parse(l):void 0,m=h?.mode;if(!s||!m)return!1;const{tr:v,schema:i}=r.state,A=i.text(s.replace(/\r\n?/g,`
`));return v.replaceSelectionWith(this.type.create({language:m},A)),v.selection.$from.parent.type!==this.type&&v.setSelection(ti.near(v.doc.resolve(Math.max(0,v.selection.from-2)))),v.setMeta("paste",!0),r.dispatch(v),!0}}})]}}),d7=Mc.create({name:"doc",topNode:!0,content:"block+"}),f7=Mc.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:r}){return["br",So(this.options.HTMLAttributes,r)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:r,chain:t,state:s,editor:l})=>r.first([()=>r.exitCode(),()=>r.command(()=>{const{selection:h,storedMarks:m}=s;if(h.$from.parent.type.spec.isolating)return!1;const{keepMarks:v}=this.options,{splittableMarks:i}=l.extensionManager,A=m||h.$to.parentOffset&&h.$from.marks();return t().insertContent({type:this.name}).command(({tr:P,dispatch:D})=>{if(D&&A&&v){const F=A.filter($=>i.includes($.type.name));P.ensureMarks(F)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),p7=Mc.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(r=>({tag:`h${r}`,attrs:{level:r}}))},renderHTML({node:r,HTMLAttributes:t}){return[`h${this.options.levels.includes(r.attrs.level)?r.attrs.level:this.options.levels[0]}`,So(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:r=>({commands:t})=>this.options.levels.includes(r.level)?t.setNode(this.name,r):!1,toggleHeading:r=>({commands:t})=>this.options.levels.includes(r.level)?t.toggleNode(this.name,"paragraph",r):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((r,t)=>({...r,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(r=>WS({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${r}})\\s$`),type:this.type,getAttributes:{level:r}}))}}),m7=Mc.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:r}){return["hr",So(this.options.HTMLAttributes,r)]},addCommands(){return{setHorizontalRule:()=>({chain:r,state:t})=>{if(!M9(t,t.schema.nodes[this.name]))return!1;const{selection:s}=t,{$to:l}=s,h=r();return KO(s)?h.insertContentAt(l.pos,{type:this.name}):h.insertContent({type:this.name}),h.command(({tr:m,dispatch:v})=>{var i;if(v){const{$to:A}=m.selection,P=A.end();if(A.nodeAfter)A.nodeAfter.isTextblock?m.setSelection(ti.create(m.doc,A.pos+1)):A.nodeAfter.isBlock?m.setSelection(kn.create(m.doc,A.pos)):m.setSelection(ti.create(m.doc,A.pos));else{const D=(i=A.parent.type.contentMatch.defaultType)==null?void 0:i.create();D&&(m.insert(P,D),m.setSelection(ti.create(m.doc,P+1)))}m.scrollIntoView()}return!0}).run()}}},addInputRules(){return[I9({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),g7=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,y7=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,_7=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,x7=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,v7=lm.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:r=>r.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:r=>r.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:r}){return["em",So(this.options.HTMLAttributes,r),0]},addCommands(){return{setItalic:()=>({commands:r})=>r.setMark(this.name),toggleItalic:()=>({commands:r})=>r.toggleMark(this.name),unsetItalic:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Ay({find:g7,type:this.type}),Ay({find:_7,type:this.type})]},addPasteRules(){return[bg({find:y7,type:this.type}),bg({find:x7,type:this.type})]}});const b7="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",w7="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",My=(r,t)=>{for(const s in t)r[s]=t[s];return r},XS="numeric",KS="ascii",YS="alpha",G_="asciinumeric",F_="alphanumeric",JS="domain",gL="emoji",S7="scheme",T7="slashscheme",Gw="whitespace";function E7(r,t){return r in t||(t[r]=[]),t[r]}function rg(r,t,s){t[XS]&&(t[G_]=!0,t[F_]=!0),t[KS]&&(t[G_]=!0,t[YS]=!0),t[G_]&&(t[F_]=!0),t[YS]&&(t[F_]=!0),t[F_]&&(t[JS]=!0),t[gL]&&(t[JS]=!0);for(const l in t){const h=E7(l,s);h.indexOf(r)<0&&h.push(r)}}function C7(r,t){const s={};for(const l in t)t[l].indexOf(r)>=0&&(s[l]=!0);return s}function Kl(r=null){this.j={},this.jr=[],this.jd=null,this.t=r}Kl.groups={};Kl.prototype={accepts(){return!!this.t},go(r){const t=this,s=t.j[r];if(s)return s;for(let l=0;l<t.jr.length;l++){const h=t.jr[l][0],m=t.jr[l][1];if(m&&h.test(r))return m}return t.jd},has(r,t=!1){return t?r in this.j:!!this.go(r)},ta(r,t,s,l){for(let h=0;h<r.length;h++)this.tt(r[h],t,s,l)},tr(r,t,s,l){l=l||Kl.groups;let h;return t&&t.j?h=t:(h=new Kl(t),s&&l&&rg(t,s,l)),this.jr.push([r,h]),h},ts(r,t,s,l){let h=this;const m=r.length;if(!m)return h;for(let v=0;v<m-1;v++)h=h.tt(r[v]);return h.tt(r[m-1],t,s,l)},tt(r,t,s,l){l=l||Kl.groups;const h=this;if(t&&t.j)return h.j[r]=t,t;const m=t;let v,i=h.go(r);if(i?(v=new Kl,My(v.j,i.j),v.jr.push.apply(v.jr,i.jr),v.jd=i.jd,v.t=i.t):v=new Kl,m){if(l)if(v.t&&typeof v.t=="string"){const A=My(C7(v.t,l),s);rg(m,A,l)}else s&&rg(m,s,l);v.t=m}return h.j[r]=v,v}};const Ci=(r,t,s,l,h)=>r.ta(t,s,l,h),uo=(r,t,s,l,h)=>r.tr(t,s,l,h),vk=(r,t,s,l,h)=>r.ts(t,s,l,h),vr=(r,t,s,l,h)=>r.tt(t,s,l,h),xf="WORD",QS="UWORD",yL="ASCIINUMERICAL",_L="ALPHANUMERICAL",hx="LOCALHOST",eT="TLD",tT="UTLD",e0="SCHEME",dy="SLASH_SCHEME",p2="NUM",rT="WS",m2="NL",q_="OPENBRACE",W_="CLOSEBRACE",O0="OPENBRACKET",L0="CLOSEBRACKET",z0="OPENPAREN",j0="CLOSEPAREN",F0="OPENANGLEBRACKET",B0="CLOSEANGLEBRACKET",V0="FULLWIDTHLEFTPAREN",U0="FULLWIDTHRIGHTPAREN",$0="LEFTCORNERBRACKET",H0="RIGHTCORNERBRACKET",G0="LEFTWHITECORNERBRACKET",q0="RIGHTWHITECORNERBRACKET",W0="FULLWIDTHLESSTHAN",Z0="FULLWIDTHGREATERTHAN",X0="AMPERSAND",K0="APOSTROPHE",Y0="ASTERISK",Op="AT",J0="BACKSLASH",Q0="BACKTICK",e1="CARET",jp="COLON",g2="COMMA",t1="DOLLAR",ud="DOT",r1="EQUALS",y2="EXCLAMATION",du="HYPHEN",Z_="PERCENT",n1="PIPE",i1="PLUS",s1="POUND",X_="QUERY",_2="QUOTE",xL="FULLWIDTHMIDDLEDOT",x2="SEMI",hd="SLASH",K_="TILDE",o1="UNDERSCORE",vL="EMOJI",a1="SYM";var bL=Object.freeze({__proto__:null,ALPHANUMERICAL:_L,AMPERSAND:X0,APOSTROPHE:K0,ASCIINUMERICAL:yL,ASTERISK:Y0,AT:Op,BACKSLASH:J0,BACKTICK:Q0,CARET:e1,CLOSEANGLEBRACKET:B0,CLOSEBRACE:W_,CLOSEBRACKET:L0,CLOSEPAREN:j0,COLON:jp,COMMA:g2,DOLLAR:t1,DOT:ud,EMOJI:vL,EQUALS:r1,EXCLAMATION:y2,FULLWIDTHGREATERTHAN:Z0,FULLWIDTHLEFTPAREN:V0,FULLWIDTHLESSTHAN:W0,FULLWIDTHMIDDLEDOT:xL,FULLWIDTHRIGHTPAREN:U0,HYPHEN:du,LEFTCORNERBRACKET:$0,LEFTWHITECORNERBRACKET:G0,LOCALHOST:hx,NL:m2,NUM:p2,OPENANGLEBRACKET:F0,OPENBRACE:q_,OPENBRACKET:O0,OPENPAREN:z0,PERCENT:Z_,PIPE:n1,PLUS:i1,POUND:s1,QUERY:X_,QUOTE:_2,RIGHTCORNERBRACKET:H0,RIGHTWHITECORNERBRACKET:q0,SCHEME:e0,SEMI:x2,SLASH:hd,SLASH_SCHEME:dy,SYM:a1,TILDE:K_,TLD:eT,UNDERSCORE:o1,UTLD:tT,UWORD:QS,WORD:xf,WS:rT});const yf=/[a-z]/,N_=new RegExp("\\p{L}","u"),qw=new RegExp("\\p{Emoji}","u"),_f=/\d/,Ww=/\s/,bk="\r",Zw=`
`,A7="",I7="",Xw="";let Rv=null,Nv=null;function M7(r=[]){const t={};Kl.groups=t;const s=new Kl;Rv==null&&(Rv=wk(b7)),Nv==null&&(Nv=wk(w7)),vr(s,"'",K0),vr(s,"{",q_),vr(s,"}",W_),vr(s,"[",O0),vr(s,"]",L0),vr(s,"(",z0),vr(s,")",j0),vr(s,"<",F0),vr(s,">",B0),vr(s,"",V0),vr(s,"",U0),vr(s,"",$0),vr(s,"",H0),vr(s,"",G0),vr(s,"",q0),vr(s,"",W0),vr(s,"",Z0),vr(s,"&",X0),vr(s,"*",Y0),vr(s,"@",Op),vr(s,"`",Q0),vr(s,"^",e1),vr(s,":",jp),vr(s,",",g2),vr(s,"$",t1),vr(s,".",ud),vr(s,"=",r1),vr(s,"!",y2),vr(s,"-",du),vr(s,"%",Z_),vr(s,"|",n1),vr(s,"+",i1),vr(s,"#",s1),vr(s,"?",X_),vr(s,'"',_2),vr(s,"/",hd),vr(s,";",x2),vr(s,"~",K_),vr(s,"_",o1),vr(s,"\\",J0),vr(s,"",xL);const l=uo(s,_f,p2,{[XS]:!0});uo(l,_f,l);const h=uo(l,yf,yL,{[G_]:!0}),m=uo(l,N_,_L,{[F_]:!0}),v=uo(s,yf,xf,{[KS]:!0});uo(v,_f,h),uo(v,yf,v),uo(h,_f,h),uo(h,yf,h);const i=uo(s,N_,QS,{[YS]:!0});uo(i,yf),uo(i,_f,m),uo(i,N_,i),uo(m,_f,m),uo(m,yf),uo(m,N_,m);const A=vr(s,Zw,m2,{[Gw]:!0}),P=vr(s,bk,rT,{[Gw]:!0}),D=uo(s,Ww,rT,{[Gw]:!0});vr(s,Xw,D),vr(P,Zw,A),vr(P,Xw,D),uo(P,Ww,D),vr(D,bk),vr(D,Zw),uo(D,Ww,D),vr(D,Xw,D);const F=uo(s,qw,vL,{[gL]:!0});vr(F,"#"),uo(F,qw,F),vr(F,A7,F);const $=vr(F,I7);vr($,"#"),uo($,qw,F);const K=[[yf,v],[_f,h]],J=[[yf,null],[N_,i],[_f,m]];for(let W=0;W<Rv.length;W++)Pp(s,Rv[W],eT,xf,K);for(let W=0;W<Nv.length;W++)Pp(s,Nv[W],tT,QS,J);rg(eT,{tld:!0,ascii:!0},t),rg(tT,{utld:!0,alpha:!0},t),Pp(s,"file",e0,xf,K),Pp(s,"mailto",e0,xf,K),Pp(s,"http",dy,xf,K),Pp(s,"https",dy,xf,K),Pp(s,"ftp",dy,xf,K),Pp(s,"ftps",dy,xf,K),rg(e0,{scheme:!0,ascii:!0},t),rg(dy,{slashscheme:!0,ascii:!0},t),r=r.sort((W,ie)=>W[0]>ie[0]?1:-1);for(let W=0;W<r.length;W++){const ie=r[W][0],Pe=r[W][1]?{[S7]:!0}:{[T7]:!0};ie.indexOf("-")>=0?Pe[JS]=!0:yf.test(ie)?_f.test(ie)?Pe[G_]=!0:Pe[KS]=!0:Pe[XS]=!0,vk(s,ie,ie,Pe)}return vk(s,"localhost",hx,{ascii:!0}),s.jd=new Kl(a1),{start:s,tokens:My({groups:t},bL)}}function wL(r,t){const s=k7(t.replace(/[A-Z]/g,i=>i.toLowerCase())),l=s.length,h=[];let m=0,v=0;for(;v<l;){let i=r,A=null,P=0,D=null,F=-1,$=-1;for(;v<l&&(A=i.go(s[v]));)i=A,i.accepts()?(F=0,$=0,D=i):F>=0&&(F+=s[v].length,$++),P+=s[v].length,m+=s[v].length,v++;m-=F,v-=$,P-=F,h.push({t:D.t,v:t.slice(m-P,m),s:m-P,e:m})}return h}function k7(r){const t=[],s=r.length;let l=0;for(;l<s;){let h=r.charCodeAt(l),m,v=h<55296||h>56319||l+1===s||(m=r.charCodeAt(l+1))<56320||m>57343?r[l]:r.slice(l,l+2);t.push(v),l+=v.length}return t}function Pp(r,t,s,l,h){let m;const v=t.length;for(let i=0;i<v-1;i++){const A=t[i];r.j[A]?m=r.j[A]:(m=new Kl(l),m.jr=h.slice(),r.j[A]=m),r=m}return m=new Kl(s),m.jr=h.slice(),r.j[t[v-1]]=m,m}function wk(r){const t=[],s=[];let l=0,h="0123456789";for(;l<r.length;){let m=0;for(;h.indexOf(r[l+m])>=0;)m++;if(m>0){t.push(s.join(""));for(let v=parseInt(r.substring(l,l+m),10);v>0;v--)s.pop();l+=m}else s.push(r[l]),l++}return t}const dx={defaultProtocol:"http",events:null,format:Sk,formatHref:Sk,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function v2(r,t=null){let s=My({},dx);r&&(s=My(s,r instanceof v2?r.o:r));const l=s.ignoreTags,h=[];for(let m=0;m<l.length;m++)h.push(l[m].toUpperCase());this.o=s,t&&(this.defaultRender=t),this.ignoreTags=h}v2.prototype={o:dx,ignoreTags:[],defaultRender(r){return r},check(r){return this.get("validate",r.toString(),r)},get(r,t,s){const l=t!=null;let h=this.o[r];return h&&(typeof h=="object"?(h=s.t in h?h[s.t]:dx[r],typeof h=="function"&&l&&(h=h(t,s))):typeof h=="function"&&l&&(h=h(t,s.t,s)),h)},getObj(r,t,s){let l=this.o[r];return typeof l=="function"&&t!=null&&(l=l(t,s.t,s)),l},render(r){const t=r.render(this);return(this.get("render",null,r)||this.defaultRender)(t,r.t,r)}};function Sk(r){return r}function SL(r,t){this.t="token",this.v=r,this.tk=t}SL.prototype={isLink:!1,toString(){return this.v},toHref(r){return this.toString()},toFormattedString(r){const t=this.toString(),s=r.get("truncate",t,this),l=r.get("format",t,this);return s&&l.length>s?l.substring(0,s)+"":l},toFormattedHref(r){return r.get("formatHref",this.toHref(r.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(r=dx.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(r),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(r){return{type:this.t,value:this.toFormattedString(r),isLink:this.isLink,href:this.toFormattedHref(r),start:this.startIndex(),end:this.endIndex()}},validate(r){return r.get("validate",this.toString(),this)},render(r){const t=this,s=this.toHref(r.get("defaultProtocol")),l=r.get("formatHref",s,this),h=r.get("tagName",s,t),m=this.toFormattedString(r),v={},i=r.get("className",s,t),A=r.get("target",s,t),P=r.get("rel",s,t),D=r.getObj("attributes",s,t),F=r.getObj("events",s,t);return v.href=l,i&&(v.class=i),A&&(v.target=A),P&&(v.rel=P),D&&My(v,D),{tagName:h,attributes:v,content:m,eventListeners:F}}};function U1(r,t){class s extends SL{constructor(h,m){super(h,m),this.t=r}}for(const l in t)s.prototype[l]=t[l];return s.t=r,s}const Tk=U1("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Ek=U1("text"),P7=U1("nl"),Dv=U1("url",{isLink:!0,toHref(r=dx.defaultProtocol){return this.hasProtocol()?this.v:`${r}://${this.v}`},hasProtocol(){const r=this.tk;return r.length>=2&&r[0].t!==hx&&r[1].t===jp}}),uu=r=>new Kl(r);function R7({groups:r}){const t=r.domain.concat([X0,Y0,Op,J0,Q0,e1,t1,r1,du,p2,Z_,n1,i1,s1,hd,a1,K_,o1]),s=[K0,jp,g2,ud,y2,Z_,X_,_2,x2,F0,B0,q_,W_,L0,O0,z0,j0,V0,U0,$0,H0,G0,q0,W0,Z0],l=[X0,K0,Y0,J0,Q0,e1,t1,r1,du,q_,W_,Z_,n1,i1,s1,X_,hd,a1,K_,o1],h=uu(),m=vr(h,K_);Ci(m,l,m),Ci(m,r.domain,m);const v=uu(),i=uu(),A=uu();Ci(h,r.domain,v),Ci(h,r.scheme,i),Ci(h,r.slashscheme,A),Ci(v,l,m),Ci(v,r.domain,v);const P=vr(v,Op);vr(m,Op,P),vr(i,Op,P),vr(A,Op,P);const D=vr(m,ud);Ci(D,l,m),Ci(D,r.domain,m);const F=uu();Ci(P,r.domain,F),Ci(F,r.domain,F);const $=vr(F,ud);Ci($,r.domain,F);const K=uu(Tk);Ci($,r.tld,K),Ci($,r.utld,K),vr(P,hx,K);const J=vr(F,du);vr(J,du,J),Ci(J,r.domain,F),Ci(K,r.domain,F),vr(K,ud,$),vr(K,du,J);const W=vr(K,jp);Ci(W,r.numeric,Tk);const ie=vr(v,du),fe=vr(v,ud);vr(ie,du,ie),Ci(ie,r.domain,v),Ci(fe,l,m),Ci(fe,r.domain,v);const Pe=uu(Dv);Ci(fe,r.tld,Pe),Ci(fe,r.utld,Pe),Ci(Pe,r.domain,v),Ci(Pe,l,m),vr(Pe,ud,fe),vr(Pe,du,ie),vr(Pe,Op,P);const Fe=vr(Pe,jp),ht=uu(Dv);Ci(Fe,r.numeric,ht);const at=uu(Dv),Dt=uu();Ci(at,t,at),Ci(at,s,Dt),Ci(Dt,t,at),Ci(Dt,s,Dt),vr(Pe,hd,at),vr(ht,hd,at);const kt=vr(i,jp),Rt=vr(A,jp),hr=vr(Rt,hd),Tr=vr(hr,hd);Ci(i,r.domain,v),vr(i,ud,fe),vr(i,du,ie),Ci(A,r.domain,v),vr(A,ud,fe),vr(A,du,ie),Ci(kt,r.domain,at),vr(kt,hd,at),vr(kt,X_,at),Ci(Tr,r.domain,at),Ci(Tr,t,at),vr(Tr,hd,at);const _r=[[q_,W_],[O0,L0],[z0,j0],[F0,B0],[V0,U0],[$0,H0],[G0,q0],[W0,Z0]];for(let Sr=0;Sr<_r.length;Sr++){const[Br,Ft]=_r[Sr],br=vr(at,Br);vr(Dt,Br,br),vr(br,Ft,at);const Yt=uu(Dv);Ci(br,t,Yt);const Er=uu();Ci(br,s),Ci(Yt,t,Yt),Ci(Yt,s,Er),Ci(Er,t,Yt),Ci(Er,s,Er),vr(Yt,Ft,at),vr(Er,Ft,at)}return vr(h,hx,Pe),vr(h,m2,P7),{start:h,tokens:bL}}function N7(r,t,s){let l=s.length,h=0,m=[],v=[];for(;h<l;){let i=r,A=null,P=null,D=0,F=null,$=-1;for(;h<l&&!(A=i.go(s[h].t));)v.push(s[h++]);for(;h<l&&(P=A||i.go(s[h].t));)A=null,i=P,i.accepts()?($=0,F=i):$>=0&&$++,h++,D++;if($<0)h-=D,h<l&&(v.push(s[h]),h++);else{v.length>0&&(m.push(Kw(Ek,t,v)),v=[]),h-=$,D-=$;const K=F.t,J=s.slice(h-D,h);m.push(Kw(K,t,J))}}return v.length>0&&m.push(Kw(Ek,t,v)),m}function Kw(r,t,s){const l=s[0].s,h=s[s.length-1].e,m=t.slice(l,h);return new r(m,s)}const D7=typeof console<"u"&&console&&console.warn||(()=>{}),O7="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Os={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function L7(){return Kl.groups={},Os.scanner=null,Os.parser=null,Os.tokenQueue=[],Os.pluginQueue=[],Os.customSchemes=[],Os.initialized=!1,Os}function Ck(r,t=!1){if(Os.initialized&&D7(`linkifyjs: already initialized - will not register custom scheme "${r}" ${O7}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(r))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Os.customSchemes.push([r,t])}function z7(){Os.scanner=M7(Os.customSchemes);for(let r=0;r<Os.tokenQueue.length;r++)Os.tokenQueue[r][1]({scanner:Os.scanner});Os.parser=R7(Os.scanner.tokens);for(let r=0;r<Os.pluginQueue.length;r++)Os.pluginQueue[r][1]({scanner:Os.scanner,parser:Os.parser});return Os.initialized=!0,Os}function b2(r){return Os.initialized||z7(),N7(Os.parser.start,r,wL(Os.scanner.start,r))}b2.scan=wL;function TL(r,t=null,s=null){if(t&&typeof t=="object"){if(s)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);s=t,t=null}const l=new v2(s),h=b2(r),m=[];for(let v=0;v<h.length;v++){const i=h[v];i.isLink&&(!t||i.t===t)&&l.check(i)&&m.push(i.toFormattedObject(l))}return m}var w2="[\0- -\u2029]",j7=new RegExp(w2),F7=new RegExp(`${w2}$`),B7=new RegExp(w2,"g");function V7(r){return r.length===1?r[0].isLink:r.length===3&&r[1].isLink?["()","[]"].includes(r[0].value+r[2].value):!1}function U7(r){return new po({key:new ba("autolink"),appendTransaction:(t,s,l)=>{const h=t.some(P=>P.docChanged)&&!s.doc.eq(l.doc),m=t.some(P=>P.getMeta("preventAutolink"));if(!h||m)return;const{tr:v}=l,i=FO(s.doc,[...t]);if(ZO(i).forEach(({newRange:P})=>{const D=Hq(l.doc,P,K=>K.isTextblock);let F,$;if(D.length>1)F=D[0],$=l.doc.textBetween(F.pos,F.pos+F.node.nodeSize,void 0," ");else if(D.length){const K=l.doc.textBetween(P.from,P.to," "," ");if(!F7.test(K))return;F=D[0],$=l.doc.textBetween(F.pos,P.to,void 0," ")}if(F&&$){const K=$.split(j7).filter(Boolean);if(K.length<=0)return!1;const J=K[K.length-1],W=F.pos+$.lastIndexOf(J);if(!J)return!1;const ie=b2(J).map(fe=>fe.toObject(r.defaultProtocol));if(!V7(ie))return!1;ie.filter(fe=>fe.isLink).map(fe=>({...fe,from:W+fe.start+1,to:W+fe.end+1})).filter(fe=>l.schema.marks.code?!l.doc.rangeHasMark(fe.from,fe.to,l.schema.marks.code):!0).filter(fe=>r.validate(fe.value)).filter(fe=>r.shouldAutoLink(fe.value)).forEach(fe=>{h2(fe.from,fe.to,l.doc).some(Pe=>Pe.mark.type===r.type)||v.addMark(fe.from,fe.to,r.type.create({href:fe.href}))})}}),!!v.steps.length)return v}})}function $7(r){return new po({key:new ba("handleClickLink"),props:{handleClick:(t,s,l)=>{var h,m;if(l.button!==0||!t.editable)return!1;let v=null;if(l.target instanceof HTMLAnchorElement)v=l.target;else{let D=l.target;const F=[];for(;D.nodeName!=="DIV";)F.push(D),D=D.parentNode;v=F.find($=>$.nodeName==="A")}if(!v)return!1;const i=WO(t.state,r.type.name),A=(h=v?.href)!=null?h:i.href,P=(m=v?.target)!=null?m:i.target;return r.enableClickSelection&&r.editor.commands.extendMarkRange(r.type.name),v&&A?(window.open(A,P),!0):!1}}})}function H7(r){return new po({key:new ba("handlePasteLink"),props:{handlePaste:(t,s,l)=>{const{state:h}=t,{selection:m}=h,{empty:v}=m;if(v)return!1;let i="";l.content.forEach(P=>{i+=P.textContent});const A=TL(i,{defaultProtocol:r.defaultProtocol}).find(P=>P.isLink&&P.value===i);return!i||!A?!1:r.editor.commands.setMark(r.type,{href:A.href})}}})}function Ym(r,t){const s=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(l=>{const h=typeof l=="string"?l:l.scheme;h&&s.push(h)}),!r||r.replace(B7,"").match(new RegExp(`^(?:(?:${s.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var G7=lm.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(r=>{if(typeof r=="string"){Ck(r);return}Ck(r.scheme,r.optionalSlashes)})},onDestroy(){L7()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(r,t)=>!!Ym(r,t.protocols),validate:r=>!!r,shouldAutoLink:r=>!!r}},addAttributes(){return{href:{default:null,parseHTML(r){return r.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:r=>{const t=r.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:s=>!!Ym(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:r}){return this.options.isAllowedUri(r.href,{defaultValidate:t=>!!Ym(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",So(this.options.HTMLAttributes,r),0]:["a",So(this.options.HTMLAttributes,{...r,href:""}),0]},addCommands(){return{setLink:r=>({chain:t})=>{const{href:s}=r;return this.options.isAllowedUri(s,{defaultValidate:l=>!!Ym(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,r).setMeta("preventAutolink",!0).run():!1},toggleLink:r=>({chain:t})=>{const{href:s}=r||{};return s&&!this.options.isAllowedUri(s,{defaultValidate:l=>!!Ym(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:t().toggleMark(this.name,r,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:r})=>r().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[bg({find:r=>{const t=[];if(r){const{protocols:s,defaultProtocol:l}=this.options,h=TL(r).filter(m=>m.isLink&&this.options.isAllowedUri(m.value,{defaultValidate:v=>!!Ym(v,s),protocols:s,defaultProtocol:l}));h.length&&h.forEach(m=>t.push({text:m.value,data:{href:m.href},index:m.start}))}return t},type:this.type,getAttributes:r=>{var t;return{href:(t=r.data)==null?void 0:t.href}}})]},addProseMirrorPlugins(){const r=[],{protocols:t,defaultProtocol:s}=this.options;return this.options.autolink&&r.push(U7({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:l=>this.options.isAllowedUri(l,{defaultValidate:h=>!!Ym(h,t),protocols:t,defaultProtocol:s}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&r.push($7({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&r.push(H7({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),r}}),q7=Object.defineProperty,W7=(r,t)=>{for(var s in t)q7(r,s,{get:t[s],enumerable:!0})},Z7="listItem",Ak="textStyle",Ik=/^\s*([-+*])\s$/,EL=Mc.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:r}){return["ul",So(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleBulletList:()=>({commands:r,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Z7,this.editor.getAttributes(Ak)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let r=Iy({find:Ik,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Iy({find:Ik,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Ak),editor:this.editor})),[r]}}),CL=Mc.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:r}){return["li",So(this.options.HTMLAttributes,r),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),X7={};W7(X7,{findListItemPos:()=>Sx,getNextListDepth:()=>S2,handleBackspace:()=>nT,handleDelete:()=>iT,hasListBefore:()=>AL,hasListItemAfter:()=>K7,hasListItemBefore:()=>IL,listItemHasSubList:()=>ML,nextListIsDeeper:()=>kL,nextListIsHigher:()=>PL});var Sx=(r,t)=>{const{$from:s}=t.selection,l=jo(r,t.schema);let h=null,m=s.depth,v=s.pos,i=null;for(;m>0&&i===null;)h=s.node(m),h.type===l?i=m:(m-=1,v-=1);return i===null?null:{$pos:t.doc.resolve(v),depth:i}},S2=(r,t)=>{const s=Sx(r,t);if(!s)return!1;const[,l]=eW(t,r,s.$pos.pos+4);return l},AL=(r,t,s)=>{const{$anchor:l}=r.selection,h=Math.max(0,l.pos-2),m=r.doc.resolve(h).node();return!(!m||!s.includes(m.type.name))},IL=(r,t)=>{var s;const{$anchor:l}=t.selection,h=t.doc.resolve(l.pos-2);return!(h.index()===0||((s=h.nodeBefore)==null?void 0:s.type.name)!==r)},ML=(r,t,s)=>{if(!s)return!1;const l=jo(r,t.schema);let h=!1;return s.descendants(m=>{m.type===l&&(h=!0)}),h},nT=(r,t,s)=>{if(r.commands.undoInputRule())return!0;if(r.state.selection.from!==r.state.selection.to)return!1;if(!tm(r.state,t)&&AL(r.state,t,s)){const{$anchor:i}=r.state.selection,A=r.state.doc.resolve(i.before()-1),P=[];A.node().descendants(($,K)=>{$.type.name===t&&P.push({node:$,pos:K})});const D=P.at(-1);if(!D)return!1;const F=r.state.doc.resolve(A.start()+D.pos+1);return r.chain().cut({from:i.start()-1,to:i.end()+1},F.end()).joinForward().run()}if(!tm(r.state,t)||!iW(r.state))return!1;const l=Sx(t,r.state);if(!l)return!1;const m=r.state.doc.resolve(l.$pos.pos-2).node(l.depth),v=ML(t,r.state,m);return IL(t,r.state)&&!v?r.commands.joinItemBackward():r.chain().liftListItem(t).run()},kL=(r,t)=>{const s=S2(r,t),l=Sx(r,t);return!l||!s?!1:s>l.depth},PL=(r,t)=>{const s=S2(r,t),l=Sx(r,t);return!l||!s?!1:s<l.depth},iT=(r,t)=>{if(!tm(r.state,t)||!nW(r.state,t))return!1;const{selection:s}=r.state,{$from:l,$to:h}=s;return!s.empty&&l.sameParent(h)?!1:kL(t,r.state)?r.chain().focus(r.state.selection.from+4).lift(t).joinBackward().run():PL(t,r.state)?r.chain().joinForward().joinBackward().run():r.commands.joinItemForward()},K7=(r,t)=>{var s;const{$anchor:l}=t.selection,h=t.doc.resolve(l.pos-l.parentOffset-2);return!(h.index()===h.parent.childCount-1||((s=h.nodeAfter)==null?void 0:s.type.name)!==r)},RL=Es.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:r})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s})=>{r.state.schema.nodes[s]!==void 0&&iT(r,s)&&(t=!0)}),t},"Mod-Delete":({editor:r})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s})=>{r.state.schema.nodes[s]!==void 0&&iT(r,s)&&(t=!0)}),t},Backspace:({editor:r})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:l})=>{r.state.schema.nodes[s]!==void 0&&nT(r,s,l)&&(t=!0)}),t},"Mod-Backspace":({editor:r})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:l})=>{r.state.schema.nodes[s]!==void 0&&nT(r,s,l)&&(t=!0)}),t}}}}),Y7="listItem",Mk="textStyle",kk=/^(\d+)\.\s$/,NL=Mc.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:r=>r.hasAttribute("start")?parseInt(r.getAttribute("start")||"",10):1},type:{default:null,parseHTML:r=>r.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:r}){const{start:t,...s}=r;return t===1?["ol",So(this.options.HTMLAttributes,s),0]:["ol",So(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleOrderedList:()=>({commands:r,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Y7,this.editor.getAttributes(Mk)).run():r.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let r=Iy({find:kk,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,s)=>s.childCount+s.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(r=Iy({find:kk,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Mk)}),joinPredicate:(t,s)=>s.childCount+s.attrs.start===+t[1],editor:this.editor})),[r]}}),J7=/^\s*(\[([( |x])?\])\s$/,Q7=Mc.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:r=>{const t=r.getAttribute("data-checked");return t===""||t==="true"},renderHTML:r=>({"data-checked":r.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:r,HTMLAttributes:t}){return["li",So(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:r.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const r={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...r,Tab:()=>this.editor.commands.sinkListItem(this.name)}:r},addNodeView(){return({node:r,HTMLAttributes:t,getPos:s,editor:l})=>{const h=document.createElement("li"),m=document.createElement("label"),v=document.createElement("span"),i=document.createElement("input"),A=document.createElement("div"),P=()=>{var D,F;i.ariaLabel=((F=(D=this.options.a11y)==null?void 0:D.checkboxLabel)==null?void 0:F.call(D,r,i.checked))||`Task item checkbox for ${r.textContent||"empty task item"}`};return P(),m.contentEditable="false",i.type="checkbox",i.addEventListener("mousedown",D=>D.preventDefault()),i.addEventListener("change",D=>{if(!l.isEditable&&!this.options.onReadOnlyChecked){i.checked=!i.checked;return}const{checked:F}=D.target;l.isEditable&&typeof s=="function"&&l.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:$})=>{const K=s();if(typeof K!="number")return!1;const J=$.doc.nodeAt(K);return $.setNodeMarkup(K,void 0,{...J?.attrs,checked:F}),!0}).run(),!l.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(r,F)||(i.checked=!i.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([D,F])=>{h.setAttribute(D,F)}),h.dataset.checked=r.attrs.checked,i.checked=r.attrs.checked,m.append(i,v),h.append(m,A),Object.entries(t).forEach(([D,F])=>{h.setAttribute(D,F)}),{dom:h,contentDOM:A,update:D=>D.type!==this.type?!1:(h.dataset.checked=D.attrs.checked,i.checked=D.attrs.checked,P(),!0)}}},addInputRules(){return[Iy({find:J7,type:this.type,getAttributes:r=>({checked:r[r.length-1]==="x"})})]}}),eZ=Mc.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:r}){return["ul",So(this.options.HTMLAttributes,r,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:r})=>r.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Es.create({name:"listKit",addExtensions(){const r=[];return this.options.bulletList!==!1&&r.push(EL.configure(this.options.bulletList)),this.options.listItem!==!1&&r.push(CL.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(RL.configure(this.options.listKeymap)),this.options.orderedList!==!1&&r.push(NL.configure(this.options.orderedList)),this.options.taskItem!==!1&&r.push(Q7.configure(this.options.taskItem)),this.options.taskList!==!1&&r.push(eZ.configure(this.options.taskList)),r}});var tZ=Mc.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:r}){return["p",So(this.options.HTMLAttributes,r),0]},addCommands(){return{setParagraph:()=>({commands:r})=>r.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),rZ=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,nZ=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,iZ=lm.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["s",So(this.options.HTMLAttributes,r),0]},addCommands(){return{setStrike:()=>({commands:r})=>r.setMark(this.name),toggleStrike:()=>({commands:r})=>r.toggleMark(this.name),unsetStrike:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Ay({find:rZ,type:this.type})]},addPasteRules(){return[bg({find:nZ,type:this.type})]}}),sZ=Mc.create({name:"text",group:"inline"}),oZ=lm.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:r=>r.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:r}){return["u",So(this.options.HTMLAttributes,r),0]},addCommands(){return{setUnderline:()=>({commands:r})=>r.setMark(this.name),toggleUnderline:()=>({commands:r})=>r.toggleMark(this.name),unsetUnderline:()=>({commands:r})=>r.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function aZ(r={}){return new po({view(t){return new lZ(t,r)}})}class lZ{constructor(t,s){var l;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(l=s.width)!==null&&l!==void 0?l:1,this.color=s.color===!1?void 0:s.color||"black",this.class=s.class,this.handlers=["dragover","dragend","drop","dragleave"].map(h=>{let m=v=>{this[h](v)};return t.dom.addEventListener(h,m),{name:h,handler:m}})}destroy(){this.handlers.forEach(({name:t,handler:s})=>this.editorView.dom.removeEventListener(t,s))}update(t,s){this.cursorPos!=null&&s.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),s=!t.parent.inlineContent,l,h=this.editorView.dom,m=h.getBoundingClientRect(),v=m.width/h.offsetWidth,i=m.height/h.offsetHeight;if(s){let F=t.nodeBefore,$=t.nodeAfter;if(F||$){let K=this.editorView.nodeDOM(this.cursorPos-(F?F.nodeSize:0));if(K){let J=K.getBoundingClientRect(),W=F?J.bottom:J.top;F&&$&&(W=(W+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let ie=this.width/2*i;l={left:J.left,right:J.right,top:W-ie,bottom:W+ie}}}}if(!l){let F=this.editorView.coordsAtPos(this.cursorPos),$=this.width/2*v;l={left:F.left-$,right:F.left+$,top:F.top,bottom:F.bottom}}let A=this.editorView.dom.offsetParent;this.element||(this.element=A.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",s),this.element.classList.toggle("prosemirror-dropcursor-inline",!s);let P,D;if(!A||A==document.body&&getComputedStyle(A).position=="static")P=-pageXOffset,D=-pageYOffset;else{let F=A.getBoundingClientRect(),$=F.width/A.offsetWidth,K=F.height/A.offsetHeight;P=F.left-A.scrollLeft*$,D=F.top-A.scrollTop*K}this.element.style.left=(l.left-P)/v+"px",this.element.style.top=(l.top-D)/i+"px",this.element.style.width=(l.right-l.left)/v+"px",this.element.style.height=(l.bottom-l.top)/i+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let s=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),l=s&&s.inside>=0&&this.editorView.state.doc.nodeAt(s.inside),h=l&&l.type.spec.disableDropCursor,m=typeof h=="function"?h(this.editorView,s,t):h;if(s&&!m){let v=s.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let i=zD(this.editorView.state.doc,v,this.editorView.dragging.slice);i!=null&&(v=i)}this.setCursor(v),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class ho extends xi{constructor(t){super(t,t)}map(t,s){let l=t.resolve(s.map(this.head));return ho.valid(l)?new ho(l):xi.near(l)}content(){return Yr.empty}eq(t){return t instanceof ho&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ho(t.resolve(s.pos))}getBookmark(){return new T2(this.anchor)}static valid(t){let s=t.parent;if(s.isTextblock||!cZ(t)||!uZ(t))return!1;let l=s.type.spec.allowGapCursor;if(l!=null)return l;let h=s.contentMatchAt(t.index()).defaultType;return h&&h.isTextblock}static findGapCursorFrom(t,s,l=!1){e:for(;;){if(!l&&ho.valid(t))return t;let h=t.pos,m=null;for(let v=t.depth;;v--){let i=t.node(v);if(s>0?t.indexAfter(v)<i.childCount:t.index(v)>0){m=i.child(s>0?t.indexAfter(v):t.index(v)-1);break}else if(v==0)return null;h+=s;let A=t.doc.resolve(h);if(ho.valid(A))return A}for(;;){let v=s>0?m.firstChild:m.lastChild;if(!v){if(m.isAtom&&!m.isText&&!kn.isSelectable(m)){t=t.doc.resolve(h+m.nodeSize*s),l=!1;continue e}break}m=v,h+=s;let i=t.doc.resolve(h);if(ho.valid(i))return i}return null}}}ho.prototype.visible=!1;ho.findFrom=ho.findGapCursorFrom;xi.jsonID("gapcursor",ho);class T2{constructor(t){this.pos=t}map(t){return new T2(t.map(this.pos))}resolve(t){let s=t.resolve(this.pos);return ho.valid(s)?new ho(s):xi.near(s)}}function cZ(r){for(let t=r.depth;t>=0;t--){let s=r.index(t),l=r.node(t);if(s==0){if(l.type.spec.isolating)return!0;continue}for(let h=l.child(s-1);;h=h.lastChild){if(h.childCount==0&&!h.inlineContent||h.isAtom||h.type.spec.isolating)return!0;if(h.inlineContent)return!1}}return!0}function uZ(r){for(let t=r.depth;t>=0;t--){let s=r.indexAfter(t),l=r.node(t);if(s==l.childCount){if(l.type.spec.isolating)return!0;continue}for(let h=l.child(s);;h=h.firstChild){if(h.childCount==0&&!h.inlineContent||h.isAtom||h.type.spec.isolating)return!0;if(h.inlineContent)return!1}}return!0}function hZ(){return new po({props:{decorations:mZ,createSelectionBetween(r,t,s){return t.pos==s.pos&&ho.valid(s)?new ho(s):null},handleClick:fZ,handleKeyDown:dZ,handleDOMEvents:{beforeinput:pZ}}})}const dZ=EO({ArrowLeft:Ov("horiz",-1),ArrowRight:Ov("horiz",1),ArrowUp:Ov("vert",-1),ArrowDown:Ov("vert",1)});function Ov(r,t){const s=r=="vert"?t>0?"down":"up":t>0?"right":"left";return function(l,h,m){let v=l.selection,i=t>0?v.$to:v.$from,A=v.empty;if(v instanceof ti){if(!m.endOfTextblock(s)||i.depth==0)return!1;A=!1,i=l.doc.resolve(t>0?i.after():i.before())}let P=ho.findGapCursorFrom(i,t,A);return P?(h&&h(l.tr.setSelection(new ho(P))),!0):!1}}function fZ(r,t,s){if(!r||!r.editable)return!1;let l=r.state.doc.resolve(t);if(!ho.valid(l))return!1;let h=r.posAtCoords({left:s.clientX,top:s.clientY});return h&&h.inside>-1&&kn.isSelectable(r.state.doc.nodeAt(h.inside))?!1:(r.dispatch(r.state.tr.setSelection(new ho(l))),!0)}function pZ(r,t){if(t.inputType!="insertCompositionText"||!(r.state.selection instanceof ho))return!1;let{$from:s}=r.state.selection,l=s.parent.contentMatchAt(s.index()).findWrapping(r.state.schema.nodes.text);if(!l)return!1;let h=dr.empty;for(let v=l.length-1;v>=0;v--)h=dr.from(l[v].createAndFill(null,h));let m=r.state.tr.replace(s.pos,s.pos,new Yr(h,0,0));return m.setSelection(ti.near(m.doc.resolve(s.pos+1))),r.dispatch(m),!1}function mZ(r){if(!(r.selection instanceof ho))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",eo.create(r.doc,[bl.widget(r.selection.head,t,{key:"gapcursor"})])}var l1=200,va=function(){};va.prototype.append=function(t){return t.length?(t=va.from(t),!this.length&&t||t.length<l1&&this.leafAppend(t)||this.length<l1&&t.leafPrepend(this)||this.appendInner(t)):this};va.prototype.prepend=function(t){return t.length?va.from(t).append(this):this};va.prototype.appendInner=function(t){return new gZ(this,t)};va.prototype.slice=function(t,s){return t===void 0&&(t=0),s===void 0&&(s=this.length),t>=s?va.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,s))};va.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};va.prototype.forEach=function(t,s,l){s===void 0&&(s=0),l===void 0&&(l=this.length),s<=l?this.forEachInner(t,s,l,0):this.forEachInvertedInner(t,s,l,0)};va.prototype.map=function(t,s,l){s===void 0&&(s=0),l===void 0&&(l=this.length);var h=[];return this.forEach(function(m,v){return h.push(t(m,v))},s,l),h};va.from=function(t){return t instanceof va?t:t&&t.length?new DL(t):va.empty};var DL=function(r){function t(l){r.call(this),this.values=l}r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t;var s={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(h,m){return h==0&&m==this.length?this:new t(this.values.slice(h,m))},t.prototype.getInner=function(h){return this.values[h]},t.prototype.forEachInner=function(h,m,v,i){for(var A=m;A<v;A++)if(h(this.values[A],i+A)===!1)return!1},t.prototype.forEachInvertedInner=function(h,m,v,i){for(var A=m-1;A>=v;A--)if(h(this.values[A],i+A)===!1)return!1},t.prototype.leafAppend=function(h){if(this.length+h.length<=l1)return new t(this.values.concat(h.flatten()))},t.prototype.leafPrepend=function(h){if(this.length+h.length<=l1)return new t(h.flatten().concat(this.values))},s.length.get=function(){return this.values.length},s.depth.get=function(){return 0},Object.defineProperties(t.prototype,s),t}(va);va.empty=new DL([]);var gZ=function(r){function t(s,l){r.call(this),this.left=s,this.right=l,this.length=s.length+l.length,this.depth=Math.max(s.depth,l.depth)+1}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(l){return l<this.left.length?this.left.get(l):this.right.get(l-this.left.length)},t.prototype.forEachInner=function(l,h,m,v){var i=this.left.length;if(h<i&&this.left.forEachInner(l,h,Math.min(m,i),v)===!1||m>i&&this.right.forEachInner(l,Math.max(h-i,0),Math.min(this.length,m)-i,v+i)===!1)return!1},t.prototype.forEachInvertedInner=function(l,h,m,v){var i=this.left.length;if(h>i&&this.right.forEachInvertedInner(l,h-i,Math.max(m,i)-i,v+i)===!1||m<i&&this.left.forEachInvertedInner(l,Math.min(h,i),m,v)===!1)return!1},t.prototype.sliceInner=function(l,h){if(l==0&&h==this.length)return this;var m=this.left.length;return h<=m?this.left.slice(l,h):l>=m?this.right.slice(l-m,h-m):this.left.slice(l,m).append(this.right.slice(0,h-m))},t.prototype.leafAppend=function(l){var h=this.right.leafAppend(l);if(h)return new t(this.left,h)},t.prototype.leafPrepend=function(l){var h=this.left.leafPrepend(l);if(h)return new t(h,this.right)},t.prototype.appendInner=function(l){return this.left.depth>=Math.max(this.right.depth,l.depth)+1?new t(this.left,new t(this.right,l)):new t(this,l)},t}(va);const yZ=500;class uh{constructor(t,s){this.items=t,this.eventCount=s}popEvent(t,s){if(this.eventCount==0)return null;let l=this.items.length;for(;;l--)if(this.items.get(l-1).selection){--l;break}let h,m;s&&(h=this.remapping(l,this.items.length),m=h.maps.length);let v=t.tr,i,A,P=[],D=[];return this.items.forEach((F,$)=>{if(!F.step){h||(h=this.remapping(l,$+1),m=h.maps.length),m--,D.push(F);return}if(h){D.push(new dd(F.map));let K=F.step.map(h.slice(m)),J;K&&v.maybeStep(K).doc&&(J=v.mapping.maps[v.mapping.maps.length-1],P.push(new dd(J,void 0,void 0,P.length+D.length))),m--,J&&h.appendMap(J,m)}else v.maybeStep(F.step);if(F.selection)return i=h?F.selection.map(h.slice(m)):F.selection,A=new uh(this.items.slice(0,l).append(D.reverse().concat(P)),this.eventCount-1),!1},this.items.length,0),{remaining:A,transform:v,selection:i}}addTransform(t,s,l,h){let m=[],v=this.eventCount,i=this.items,A=!h&&i.length?i.get(i.length-1):null;for(let D=0;D<t.steps.length;D++){let F=t.steps[D].invert(t.docs[D]),$=new dd(t.mapping.maps[D],F,s),K;(K=A&&A.merge($))&&($=K,D?m.pop():i=i.slice(0,i.length-1)),m.push($),s&&(v++,s=void 0),h||(A=$)}let P=v-l.depth;return P>xZ&&(i=_Z(i,P),v-=P),new uh(i.append(m),v)}remapping(t,s){let l=new ix;return this.items.forEach((h,m)=>{let v=h.mirrorOffset!=null&&m-h.mirrorOffset>=t?l.maps.length-h.mirrorOffset:void 0;l.appendMap(h.map,v)},t,s),l}addMaps(t){return this.eventCount==0?this:new uh(this.items.append(t.map(s=>new dd(s))),this.eventCount)}rebased(t,s){if(!this.eventCount)return this;let l=[],h=Math.max(0,this.items.length-s),m=t.mapping,v=t.steps.length,i=this.eventCount;this.items.forEach($=>{$.selection&&i--},h);let A=s;this.items.forEach($=>{let K=m.getMirror(--A);if(K==null)return;v=Math.min(v,K);let J=m.maps[K];if($.step){let W=t.steps[K].invert(t.docs[K]),ie=$.selection&&$.selection.map(m.slice(A+1,K));ie&&i++,l.push(new dd(J,W,ie))}else l.push(new dd(J))},h);let P=[];for(let $=s;$<v;$++)P.push(new dd(m.maps[$]));let D=this.items.slice(0,h).append(P).append(l),F=new uh(D,i);return F.emptyItemCount()>yZ&&(F=F.compress(this.items.length-l.length)),F}emptyItemCount(){let t=0;return this.items.forEach(s=>{s.step||t++}),t}compress(t=this.items.length){let s=this.remapping(0,t),l=s.maps.length,h=[],m=0;return this.items.forEach((v,i)=>{if(i>=t)h.push(v),v.selection&&m++;else if(v.step){let A=v.step.map(s.slice(l)),P=A&&A.getMap();if(l--,P&&s.appendMap(P,l),A){let D=v.selection&&v.selection.map(s.slice(l));D&&m++;let F=new dd(P.invert(),A,D),$,K=h.length-1;($=h.length&&h[K].merge(F))?h[K]=$:h.push(F)}}else v.map&&l--},this.items.length,0),new uh(va.from(h.reverse()),m)}}uh.empty=new uh(va.empty,0);function _Z(r,t){let s;return r.forEach((l,h)=>{if(l.selection&&t--==0)return s=h,!1}),r.slice(s)}class dd{constructor(t,s,l,h){this.map=t,this.step=s,this.selection=l,this.mirrorOffset=h}merge(t){if(this.step&&t.step&&!t.selection){let s=t.step.merge(this.step);if(s)return new dd(s.getMap().invert(),s,this.selection)}}}class Lp{constructor(t,s,l,h,m){this.done=t,this.undone=s,this.prevRanges=l,this.prevTime=h,this.prevComposition=m}}const xZ=20;function vZ(r,t,s,l){let h=s.getMeta(cg),m;if(h)return h.historyState;s.getMeta(SZ)&&(r=new Lp(r.done,r.undone,null,0,-1));let v=s.getMeta("appendedTransaction");if(s.steps.length==0)return r;if(v&&v.getMeta(cg))return v.getMeta(cg).redo?new Lp(r.done.addTransform(s,void 0,l,t0(t)),r.undone,Pk(s.mapping.maps),r.prevTime,r.prevComposition):new Lp(r.done,r.undone.addTransform(s,void 0,l,t0(t)),null,r.prevTime,r.prevComposition);if(s.getMeta("addToHistory")!==!1&&!(v&&v.getMeta("addToHistory")===!1)){let i=s.getMeta("composition"),A=r.prevTime==0||!v&&r.prevComposition!=i&&(r.prevTime<(s.time||0)-l.newGroupDelay||!bZ(s,r.prevRanges)),P=v?Yw(r.prevRanges,s.mapping):Pk(s.mapping.maps);return new Lp(r.done.addTransform(s,A?t.selection.getBookmark():void 0,l,t0(t)),uh.empty,P,s.time,i??r.prevComposition)}else return(m=s.getMeta("rebased"))?new Lp(r.done.rebased(s,m),r.undone.rebased(s,m),Yw(r.prevRanges,s.mapping),r.prevTime,r.prevComposition):new Lp(r.done.addMaps(s.mapping.maps),r.undone.addMaps(s.mapping.maps),Yw(r.prevRanges,s.mapping),r.prevTime,r.prevComposition)}function bZ(r,t){if(!t)return!1;if(!r.docChanged)return!0;let s=!1;return r.mapping.maps[0].forEach((l,h)=>{for(let m=0;m<t.length;m+=2)l<=t[m+1]&&h>=t[m]&&(s=!0)}),s}function Pk(r){let t=[];for(let s=r.length-1;s>=0&&t.length==0;s--)r[s].forEach((l,h,m,v)=>t.push(m,v));return t}function Yw(r,t){if(!r)return null;let s=[];for(let l=0;l<r.length;l+=2){let h=t.map(r[l],1),m=t.map(r[l+1],-1);h<=m&&s.push(h,m)}return s}function wZ(r,t,s){let l=t0(t),h=cg.get(t).spec.config,m=(s?r.undone:r.done).popEvent(t,l);if(!m)return null;let v=m.selection.resolve(m.transform.doc),i=(s?r.done:r.undone).addTransform(m.transform,t.selection.getBookmark(),h,l),A=new Lp(s?i:m.remaining,s?m.remaining:i,null,0,-1);return m.transform.setSelection(v).setMeta(cg,{redo:s,historyState:A})}let Jw=!1,Rk=null;function t0(r){let t=r.plugins;if(Rk!=t){Jw=!1,Rk=t;for(let s=0;s<t.length;s++)if(t[s].spec.historyPreserveItems){Jw=!0;break}}return Jw}const cg=new ba("history"),SZ=new ba("closeHistory");function TZ(r={}){return r={depth:r.depth||100,newGroupDelay:r.newGroupDelay||500},new po({key:cg,state:{init(){return new Lp(uh.empty,uh.empty,null,0,-1)},apply(t,s,l){return vZ(s,l,t,r)}},config:r,props:{handleDOMEvents:{beforeinput(t,s){let l=s.inputType,h=l=="historyUndo"?LL:l=="historyRedo"?zL:null;return h?(s.preventDefault(),h(t.state,t.dispatch)):!1}}}})}function OL(r,t){return(s,l)=>{let h=cg.getState(s);if(!h||(r?h.undone:h.done).eventCount==0)return!1;if(l){let m=wZ(h,s,r);m&&l(t?m.scrollIntoView():m)}return!0}}const LL=OL(!1,!0),zL=OL(!0,!0);Es.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:r=>r.length,wordCounter:r=>r.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=r=>{const t=r?.node||this.editor.state.doc;if((r?.mode||this.options.mode)==="textSize"){const l=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(l)}return t.nodeSize},this.storage.words=r=>{const t=r?.node||this.editor.state.doc,s=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(s)}},addProseMirrorPlugins(){let r=!1;return[new po({key:new ba("characterCount"),appendTransaction:(t,s,l)=>{if(r)return;const h=this.options.limit;if(h==null||h===0){r=!0;return}const m=this.storage.characters({node:l.doc});if(m>h){const v=m-h,i=0,A=v;console.warn(`[CharacterCount] Initial content exceeded limit of ${h} characters. Content was automatically trimmed.`);const P=l.tr.deleteRange(i,A);return r=!0,P}r=!0},filterTransaction:(t,s)=>{const l=this.options.limit;if(!t.docChanged||l===0||l===null||l===void 0)return!0;const h=this.storage.characters({node:s.doc}),m=this.storage.characters({node:t.doc});if(m<=l||h>l&&m>l&&m<=h)return!0;if(h>l&&m>l&&m>h||!t.getMeta("paste"))return!1;const i=t.selection.$head.pos,A=m-l,P=i-A,D=i;return t.deleteRange(P,D),!(this.storage.characters({node:t.doc})>l)}})]}});var EZ=Es.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[aZ(this.options)]}});Es.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new po({key:new ba("focus"),props:{decorations:({doc:r,selection:t})=>{const{isEditable:s,isFocused:l}=this.editor,{anchor:h}=t,m=[];if(!s||!l)return eo.create(r,[]);let v=0;this.options.mode==="deepest"&&r.descendants((A,P)=>{if(A.isText)return;if(!(h>=P&&h<=P+A.nodeSize-1))return!1;v+=1});let i=0;return r.descendants((A,P)=>{if(A.isText||!(h>=P&&h<=P+A.nodeSize-1))return!1;if(i+=1,this.options.mode==="deepest"&&v-i>0||this.options.mode==="shallowest"&&i>1)return this.options.mode==="deepest";m.push(bl.node(P,P+A.nodeSize,{class:this.options.className}))}),eo.create(r,m)}}})]}});var CZ=Es.create({name:"gapCursor",addProseMirrorPlugins(){return[hZ()]},extendNodeSchema(r){var t;const s={name:r.name,options:r.options,storage:r.storage};return{allowGapCursor:(t=cs(Cn(r,"allowGapCursor",s)))!=null?t:null}}});Es.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new po({key:new ba("placeholder"),props:{decorations:({doc:r,selection:t})=>{const s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:l}=t,h=[];if(!s)return null;const m=this.editor.isEmpty;return r.descendants((v,i)=>{const A=l>=i&&l<=i+v.nodeSize,P=!v.isLeaf&&F1(v);if((A||!this.options.showOnlyCurrent)&&P){const D=[this.options.emptyNodeClass];m&&D.push(this.options.emptyEditorClass);const F=bl.node(i,i+v.nodeSize,{class:D.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:v,pos:i,hasAnchor:A}):this.options.placeholder});h.push(F)}return this.options.includeChildren}),eo.create(r,h)}}})]}});Es.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:r,options:t}=this;return[new po({key:new ba("selection"),props:{decorations(s){return s.selection.empty||r.isFocused||!r.isEditable||KO(s.selection)||r.view.dragging?null:eo.create(s.doc,[bl.inline(s.selection.from,s.selection.to,{class:t.className})])}}})]}});function Nk({types:r,node:t}){return t&&Array.isArray(r)&&r.includes(t.type)||t?.type===r}var AZ=Es.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const r=new ba(this.name),t=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(this.options.node).includes(s.name));return[new po({key:r,appendTransaction:(s,l,h)=>{const{doc:m,tr:v,schema:i}=h,A=r.getState(h),P=m.content.size,D=i.nodes[this.options.node];if(A)return v.insert(P,D.create())},state:{init:(s,l)=>{const h=l.tr.doc.lastChild;return!Nk({node:h,types:t})},apply:(s,l)=>{if(!s.docChanged)return l;const h=s.doc.lastChild;return!Nk({node:h,types:t})}}})]}}),IZ=Es.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:r,dispatch:t})=>LL(r,t),redo:()=>({state:r,dispatch:t})=>zL(r,t)}},addProseMirrorPlugins(){return[TZ(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),MZ=Es.create({name:"starterKit",addExtensions(){var r,t,s,l;const h=[];return this.options.bold!==!1&&h.push(s7.configure(this.options.bold)),this.options.blockquote!==!1&&h.push(e7.configure(this.options.blockquote)),this.options.bulletList!==!1&&h.push(EL.configure(this.options.bulletList)),this.options.code!==!1&&h.push(l7.configure(this.options.code)),this.options.codeBlock!==!1&&h.push(h7.configure(this.options.codeBlock)),this.options.document!==!1&&h.push(d7.configure(this.options.document)),this.options.dropcursor!==!1&&h.push(EZ.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&h.push(CZ.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&h.push(f7.configure(this.options.hardBreak)),this.options.heading!==!1&&h.push(p7.configure(this.options.heading)),this.options.undoRedo!==!1&&h.push(IZ.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&h.push(m7.configure(this.options.horizontalRule)),this.options.italic!==!1&&h.push(v7.configure(this.options.italic)),this.options.listItem!==!1&&h.push(CL.configure(this.options.listItem)),this.options.listKeymap!==!1&&h.push(RL.configure((r=this.options)==null?void 0:r.listKeymap)),this.options.link!==!1&&h.push(G7.configure((t=this.options)==null?void 0:t.link)),this.options.orderedList!==!1&&h.push(NL.configure(this.options.orderedList)),this.options.paragraph!==!1&&h.push(tZ.configure(this.options.paragraph)),this.options.strike!==!1&&h.push(iZ.configure(this.options.strike)),this.options.text!==!1&&h.push(sZ.configure(this.options.text)),this.options.underline!==!1&&h.push(oZ.configure((s=this.options)==null?void 0:s.underline)),this.options.trailingNode!==!1&&h.push(AZ.configure((l=this.options)==null?void 0:l.trailingNode)),h}}),kZ=MZ,PZ=r=>{if(!r.children.length)return;const t=r.querySelectorAll("span");t&&t.forEach(s=>{var l,h;const m=s.getAttribute("style"),v=(h=(l=s.parentElement)==null?void 0:l.closest("span"))==null?void 0:h.getAttribute("style");s.setAttribute("style",`${v};${m}`)})},jL=lm.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:r=>r.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&PZ(r),{}):!1}]},renderHTML({HTMLAttributes:r}){return["span",So(this.options.HTMLAttributes,r),0]},addCommands(){return{toggleTextStyle:r=>({commands:t})=>t.toggleMark(this.name,r),removeEmptyTextStyle:()=>({tr:r})=>{const{selection:t}=r;return r.doc.nodesBetween(t.from,t.to,(s,l)=>{if(s.isTextblock)return!0;s.marks.filter(h=>h.type===this.type).some(h=>Object.values(h.attrs).some(m=>!!m))||r.removeMark(l,l+s.nodeSize,this.type)}),!0}}}}),RZ=Es.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:r=>{var t;return(t=r.style.backgroundColor)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:r=>r.backgroundColor?{style:`background-color: ${r.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:r=>({chain:t})=>t().setMark("textStyle",{backgroundColor:r}).run(),unsetBackgroundColor:()=>({chain:r})=>r().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),FL=Es.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:r=>{var t;return(t=r.style.color)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:r=>r.color?{style:`color: ${r.color}`}:{}}}}]},addCommands(){return{setColor:r=>({chain:t})=>t().setMark("textStyle",{color:r}).run(),unsetColor:()=>({chain:r})=>r().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),NZ=Es.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:r=>r.style.fontFamily,renderHTML:r=>r.fontFamily?{style:`font-family: ${r.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:r=>({chain:t})=>t().setMark("textStyle",{fontFamily:r}).run(),unsetFontFamily:()=>({chain:r})=>r().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),DZ=Es.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:r=>r.style.fontSize,renderHTML:r=>r.fontSize?{style:`font-size: ${r.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:r=>({chain:t})=>t().setMark("textStyle",{fontSize:r}).run(),unsetFontSize:()=>({chain:r})=>r().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),OZ=Es.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:r=>r.style.lineHeight,renderHTML:r=>r.lineHeight?{style:`line-height: ${r.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:r=>({chain:t})=>t().setMark("textStyle",{lineHeight:r}).run(),unsetLineHeight:()=>({chain:r})=>r().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});Es.create({name:"textStyleKit",addExtensions(){const r=[];return this.options.backgroundColor!==!1&&r.push(RZ.configure(this.options.backgroundColor)),this.options.color!==!1&&r.push(FL.configure(this.options.color)),this.options.fontFamily!==!1&&r.push(NZ.configure(this.options.fontFamily)),this.options.fontSize!==!1&&r.push(DZ.configure(this.options.fontSize)),this.options.lineHeight!==!1&&r.push(OZ.configure(this.options.lineHeight)),this.options.textStyle!==!1&&r.push(jL.configure(this.options.textStyle)),r}});var LZ=FL;const zZ=({isOpen:r,onClose:t,onSubmit:s,blogPost:l})=>{const[h,m]=ee.useState({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""}),[v,i]=ee.useState("");ee.useEffect(()=>{l?(m({title:l.title,excerpt:l.excerpt,content:l.content,author:l.author,category:l.category,publishDate:l.publishDate,tags:l.tags.join(", "),image:l.image}),i(l.image)):m({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""})},[l,r]);const A=X9({extensions:[kZ,jL,LZ],content:h.content,onUpdate:({editor:D})=>{m(F=>({...F,content:D.getHTML()}))}}),P=async D=>{D.preventDefault();const F=h.tags.split(",").map($=>$.trim()).filter($=>$);s({title:h.title,excerpt:h.excerpt,content:h.content,author:h.author,category:h.category,publishDate:h.publishDate,tags:F,image:h.image}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Blog Post":"Add New Blog Post"})}),b.jsxs("form",{onSubmit:P,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"title",children:"Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:D=>m(F=>({...F,title:D.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"excerpt",children:"Excerpt"}),b.jsx(fo,{id:"excerpt",value:h.excerpt,onChange:D=>m(F=>({...F,excerpt:D.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"content",children:"Content"}),A&&b.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[b.jsx(fr,{type:"button",variant:"outline",onClick:()=>A.chain().focus().toggleBold().run(),className:A.isActive("bold")?"bg-gray-200":"",children:"Bold"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>A.chain().focus().toggleItalic().run(),className:A.isActive("italic")?"bg-gray-200":"",children:"Italic"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>A.chain().focus().toggleUnderline().run(),className:A.isActive("underline")?"bg-gray-200":"",children:"Underline"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>A.chain().focus().toggleBulletList().run(),className:A.isActive("bulletList")?"bg-gray-200":"",children:"Bullet List"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>A.chain().focus().setColor("#F87171").run(),children:"Red"})]}),b.jsx("div",{className:"border rounded p-2 min-h-[200px]",children:b.jsx(U9,{editor:A})})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"author",children:"Author"}),b.jsx(Jr,{id:"author",value:h.author,onChange:D=>m(F=>({...F,author:D.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"category",children:"Category"}),b.jsx(Jr,{id:"category",value:h.category,onChange:D=>m(F=>({...F,category:D.target.value})),required:!0})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"publishDate",children:"Publish Date"}),b.jsx(Jr,{id:"publishDate",type:"date",value:h.publishDate,onChange:D=>m(F=>({...F,publishDate:D.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"tags",children:"Tags (comma-separated)"}),b.jsx(Jr,{id:"tags",value:h.tags,onChange:D=>m(F=>({...F,tags:D.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"image",children:"Image URL"}),b.jsx(Jr,{id:"image",type:"url",value:h.image,onChange:D=>{m(F=>({...F,image:D.target.value})),i(D.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),v&&b.jsx("img",{src:v,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsxs(fr,{type:"submit",children:[l?"Update":"Add"," Blog Post"]}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},jZ=({isOpen:r,onClose:t,onSubmit:s,event:l})=>{const[h,m]=ee.useState({title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,date:l.date,time:l.time,location:l.location,type:l.type,image:l.image,registrationUrl:l.registrationUrl}:{title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""})},[l,r]);const v=i=>{i.preventDefault(),s(h),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Event":"Add New Event"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"title",children:"Event Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"date",children:"Date"}),b.jsx(Jr,{id:"date",type:"date",value:h.date,onChange:i=>m(A=>({...A,date:i.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"time",children:"Time"}),b.jsx(Jr,{id:"time",type:"time",value:h.time,onChange:i=>m(A=>({...A,time:i.target.value})),required:!0})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"location",children:"Location"}),b.jsx(Jr,{id:"location",value:h.location,onChange:i=>m(A=>({...A,location:i.target.value})),placeholder:"Physical address or virtual link",required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"type",children:"Event Type"}),b.jsxs(Cf,{value:h.type,onValueChange:i=>m(A=>({...A,type:i})),children:[b.jsx(gd,{children:b.jsx(Af,{})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"workshop",children:"Workshop"}),b.jsx(ps,{value:"webinar",children:"Webinar"}),b.jsx(ps,{value:"networking",children:"Networking"}),b.jsx(ps,{value:"pitch",children:"Pitch Event"})]})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"image",children:"Image URL"}),b.jsx(Jr,{id:"image",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://example.com/image.jpg"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"registrationUrl",children:"Registration URL"}),b.jsx(Jr,{id:"registrationUrl",value:h.registrationUrl,onChange:i=>m(A=>({...A,registrationUrl:i.target.value})),placeholder:"https://eventbrite.com/your-event",required:!0})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsxs(fr,{type:"submit",children:[l?"Update":"Add"," Event"]}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},FZ=({isOpen:r,onClose:t,onSubmit:s,resource:l})=>{const[h,m]=ee.useState({title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,type:l.type,category:l.category,downloadUrl:l.downloadUrl,image:l.image,tags:l.tags.join(", ")}:{title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""})},[l,r]);const v=i=>{i.preventDefault();const A=h.tags.split(",").map(P=>P.trim()).filter(P=>P);s({title:h.title,description:h.description,type:h.type,category:h.category,downloadUrl:h.downloadUrl,image:h.image,tags:A}),t()};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Resource":"Add New Resource"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"title",children:"Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"category",children:"Category"}),b.jsx(Jr,{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),required:!0})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"type",children:"Type"}),b.jsxs(Cf,{value:h.type,onValueChange:i=>m(A=>({...A,type:i})),children:[b.jsx(gd,{children:b.jsx(Af,{})}),b.jsxs(yd,{children:[b.jsx(ps,{value:"pitch-deck",children:"Pitch Deck"}),b.jsx(ps,{value:"financial-model",children:"Financial Model"}),b.jsx(ps,{value:"presentation",children:"Presentation"}),b.jsx(ps,{value:"guide",children:"Guide"})]})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"downloadUrl",children:"Link Redirection URL"}),b.jsx(Jr,{id:"downloadUrl",value:h.downloadUrl,onChange:i=>m(A=>({...A,downloadUrl:i.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"image",children:"Image URL"}),b.jsx(Jr,{id:"image",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://example.com/image.jpg"})]}),b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"tags",children:"Tags (comma-separated)"}),b.jsx(Jr,{id:"tags",value:h.tags,onChange:i=>m(A=>({...A,tags:i.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsxs(fr,{type:"submit",children:[l?"Update":"Add"," Resource"]}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},BZ=({isOpen:r,onClose:t,onSubmit:s,member:l})=>{const[h,m]=ee.useState({name:l?.name||"",position:l?.position||"",bio:l?.bio||"",image:l?.image||"",linkedin_url:l?.linkedin_url||""});ee.useEffect(()=>{l?(m({name:l.name||"",position:l.position||"",bio:l.bio||"",image:l.image||"",linkedin_url:l.linkedin_url||""}),A(l.image||"")):(m({name:"",position:"",bio:"",image:"",linkedin_url:""}),A(""))},[l,r]),ee.useEffect(()=>{A(h.image)},[h.image]);const v=async P=>{P.preventDefault();let D=h.image;s({name:h.name,position:h.position,bio:h.bio,image:D,linkedin_url:h.linkedin_url||null}),t()},[i,A]=ee.useState(h.image);return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl",children:[b.jsx(Ba,{children:b.jsx(Va,{children:l?"Edit Team Member":"Add New Team Member"})}),b.jsxs("form",{onSubmit:v,className:"space-y-4",children:[b.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"name",children:"Name"}),b.jsx(Jr,{id:"name",value:h.name,onChange:P=>m(D=>({...D,name:P.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"position",children:"Position"}),b.jsx(Jr,{id:"position",value:h.position,onChange:P=>m(D=>({...D,position:P.target.value}))})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"bio",children:"Bio"}),b.jsx(fo,{id:"bio",value:h.bio,onChange:P=>m(D=>({...D,bio:P.target.value}))})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"image",children:"Profile Image URL"}),b.jsx(Jr,{id:"image",type:"url",value:h.image,onChange:P=>{m(D=>({...D,image:P.target.value})),A(P.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),i&&b.jsx("img",{src:i,alt:"Preview",className:"w-24 h-24 object-cover rounded-full border mt-2"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"linkedIn",children:"LinkedIn URL (optional)"}),b.jsx(Jr,{id:"linkedIn",type:"url",value:h.linkedin_url,onChange:P=>m(D=>({...D,linkedin_url:P.target.value})),placeholder:"https://linkedin.com/in/username"})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:l?"Update Member":"Add Member"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},VZ=({isOpen:r,onClose:t,onSubmit:s,currentSettings:l})=>{const[h,m]=ee.useState({heroType:l.heroType??"image",heroImage:l.heroImage??"",heroVideoUrl:l.heroVideoUrl??"",companiesText:l.runningTextCompanies.join(`
`),collaborators:[]});ee.useEffect(()=>{r&&(fetch("http://localhost:3000/api/collaborators").then(J=>J.json()).then(J=>{m(W=>({...W,collaborators:J}))}).catch(J=>{console.error("Failed to load collaborators:",J)}),fetch("http://localhost:3000/api/running-text").then(J=>J.json()).then(J=>{m(W=>({...W,companiesText:J.join(`
`)}))}),fetch("http://localhost:3000/api/style-settings").then(J=>J.json()).then(J=>{m(W=>({...W,heroType:J.hero_type,heroImage:J.hero_image,heroVideoUrl:J.hero_video_url,imagePreview:J.hero_image})),D(J.hero_image)}))},[r]);const v=async J=>{J.preventDefault();let W=h.heroImage;try{await fetch("http://localhost:3000/api/style-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({heroType:h.heroType,heroImage:W,heroVideoUrl:h.heroVideoUrl})})}catch(ie){console.error("Failed to update hero section settings:",ie)}try{await fetch("http://localhost:3000/api/running-text",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({companies:h.companiesText.split(`
`).map(ie=>ie.trim()).filter(ie=>ie!=="")})})}catch(ie){console.error("Failed to update running text companies:",ie)}for(const ie of h.collaborators)try{const fe=`http://localhost:3000/api/collaborators${ie.id?`/${ie.id}`:""}`,Pe=ie.id?"PUT":"POST";if(!(await fetch(fe,{method:Pe,headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)})).ok)throw new Error(`Failed to ${Pe==="POST"?"create":"update"} collaborator`)}catch(fe){console.error("Collaborator save error:",fe)}s({heroType:h.heroType,heroImage:W,heroVideoUrl:h.heroVideoUrl,runningTextCompanies:h.companiesText.split(`
`).map(ie=>ie.trim()).filter(ie=>ie!==""),collaborators:h.collaborators}),t()},[i,A]=ee.useState(null),[P,D]=ee.useState(l.heroImage),F=(J,W,ie)=>{m(fe=>{const Pe=[...fe.collaborators];return Pe[J]={...Pe[J],[W]:ie},{...fe,collaborators:Pe}})},$=()=>{m(J=>({...J,collaborators:[...J.collaborators,{name:"",logo:"",website:""}]}))},K=async J=>{const W=h.collaborators[J];if(W.id)try{await fetch(`http://localhost:3000/api/collaborators/${W.id}`,{method:"DELETE"})}catch(ie){console.error("Failed to delete collaborator:",ie)}m(ie=>{const fe=[...ie.collaborators];return fe.splice(J,1),{...ie,collaborators:fe}})};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:"Style Management"})}),b.jsxs("form",{onSubmit:v,className:"space-y-6",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{children:[b.jsx(ir,{children:"Hero Section Type"}),b.jsxs("select",{value:h.heroType,onChange:J=>m(W=>({...W,heroType:J.target.value})),className:"w-full mt-1 border border-input rounded px-3 py-2",children:[b.jsx("option",{value:"image",children:"Image"}),b.jsx("option",{value:"video",children:"YouTube Video"})]})]}),h.heroType==="image"&&b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"heroImage",children:"Hero Section Image URL"}),b.jsx(Jr,{id:"heroImage",type:"url",value:h.heroImage,onChange:J=>{m(W=>({...W,heroImage:J.target.value})),D(J.target.value)},placeholder:"https://example.com/hero.jpg"}),P&&b.jsx("img",{src:P,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border mt-2"})]}),h.heroType==="video"&&b.jsxs("div",{children:[b.jsx(ir,{htmlFor:"heroVideoUrl",children:"YouTube Video URL"}),b.jsx(Jr,{id:"heroVideoUrl",type:"url",value:h.heroVideoUrl,onChange:J=>m(W=>({...W,heroVideoUrl:J.target.value})),placeholder:"https://www.youtube.com/watch?v=...",required:!0})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"companies",children:"Running Text Companies (one per line)"}),b.jsx(fo,{id:"companies",value:h.companiesText,onChange:J=>m(W=>({...W,companiesText:J.target.value})),placeholder:`Company Name 1
Company Name 2
Company Name 3`,rows:4,required:!0}),b.jsx("p",{className:"text-sm text-gray-500",children:"Enter each company/investor name on a new line. These will appear in the running text above the mission section."})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{children:"Collaborators"}),h.collaborators.map((J,W)=>b.jsxs("div",{className:"flex flex-col md:flex-row gap-2 mb-4 border p-3 rounded-md",children:[b.jsx(Jr,{placeholder:"Name",value:J.name,onChange:ie=>F(W,"name",ie.target.value)}),b.jsx(Jr,{placeholder:"Logo URL",value:J.logo,onChange:ie=>F(W,"logo",ie.target.value)}),b.jsx(Jr,{placeholder:"Website URL",value:J.website,onChange:ie=>F(W,"website",ie.target.value)}),b.jsx(fr,{type:"button",variant:"destructive",onClick:()=>K(W),children:"Remove"})]},W)),b.jsx(fr,{type:"button",variant:"outline",onClick:$,children:"Add Collaborator"})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:"Update Style Settings"}),b.jsx(fr,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})};var E2="Switch",[UZ,_X]=Ry(E2),[$Z,HZ]=UZ(E2),BL=ee.forwardRef((r,t)=>{const{__scopeSwitch:s,name:l,checked:h,defaultChecked:m,required:v,disabled:i,value:A="on",onCheckedChange:P,form:D,...F}=r,[$,K]=ee.useState(null),J=xs(t,Fe=>K(Fe)),W=ee.useRef(!1),ie=$?D||!!$.closest("form"):!0,[fe=!1,Pe]=hg({prop:h,defaultProp:m,onChange:P});return b.jsxs($Z,{scope:s,checked:fe,disabled:i,children:[b.jsx(vi.button,{type:"button",role:"switch","aria-checked":fe,"aria-required":v,"data-state":$L(fe),"data-disabled":i?"":void 0,disabled:i,value:A,...F,ref:J,onClick:jn(r.onClick,Fe=>{Pe(ht=>!ht),ie&&(W.current=Fe.isPropagationStopped(),W.current||Fe.stopPropagation())})}),ie&&b.jsx(GZ,{control:$,bubbles:!W.current,name:l,value:A,checked:fe,required:v,disabled:i,form:D,style:{transform:"translateX(-100%)"}})]})});BL.displayName=E2;var VL="SwitchThumb",UL=ee.forwardRef((r,t)=>{const{__scopeSwitch:s,...l}=r,h=HZ(VL,s);return b.jsx(vi.span,{"data-state":$L(h.checked),"data-disabled":h.disabled?"":void 0,...l,ref:t})});UL.displayName=VL;var GZ=r=>{const{control:t,checked:s,bubbles:l=!0,...h}=r,m=ee.useRef(null),v=iN(s),i=DP(t);return ee.useEffect(()=>{const A=m.current,P=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(P,"checked").set;if(v!==s&&F){const $=new Event("click",{bubbles:l});F.call(A,s),A.dispatchEvent($)}},[v,s,l]),b.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...h,tabIndex:-1,ref:m,style:{...r.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function $L(r){return r?"checked":"unchecked"}var HL=BL,qZ=UL;const vy=ee.forwardRef(({className:r,...t},s)=>b.jsx(HL,{className:ki("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...t,ref:s,children:b.jsx(qZ,{className:ki("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));vy.displayName=HL.displayName;const WZ=({open:r,onOpenChange:t})=>{const[s,l]=ee.useState(null),[h,m]=ee.useState({title:"",subject:"",description:"",image:"",link:"",isActive:!0}),[v,i]=ee.useState(!1);ee.useEffect(()=>{r&&A()},[r]);const A=async()=>{try{const F=await nl.getPopup();F&&(l(F),m({title:F.title,subject:F.subject,description:F.description,image:F.image,link:F.link,isActive:F.isActive}))}catch(F){console.error("Error fetching popup:",F)}},P=(F,$)=>{m(K=>({...K,[F]:$}))},D=async F=>{F.preventDefault(),i(!0);try{await fetch("https://betawaves-back.4bzwio.easypanel.host/api/popup/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:h.title,subject:h.subject,description:h.description,link:h.link,isActive:h.isActive,existingImage:h.image})}),t(!1)}catch($){console.error("Popup update failed",$)}finally{i(!1)}};return b.jsx(ol,{open:r,onOpenChange:t,children:b.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsx(Ba,{children:b.jsx(Va,{children:"Manage Welcome Popup"})}),b.jsxs("form",{onSubmit:D,className:"space-y-6",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"title",children:"Title"}),b.jsx(Jr,{id:"title",value:h.title,onChange:F=>P("title",F.target.value),placeholder:"Enter popup title",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"subject",children:"Subject"}),b.jsx(Jr,{id:"subject",value:h.subject,onChange:F=>P("subject",F.target.value),placeholder:"Enter popup subject",required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"description",children:"Description"}),b.jsx(fo,{id:"description",value:h.description,onChange:F=>P("description",F.target.value),placeholder:"Enter popup description",rows:4,required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"image",children:"Image URL"}),b.jsx(Jr,{id:"image",type:"url",value:h.image,onChange:F=>P("image",F.target.value),placeholder:"https://example.com/image.jpg",required:!0}),h.image&&b.jsx("img",{src:h.image,alt:"Popup preview",className:"w-full h-40 object-cover rounded-md"})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"link",children:"Link (Get Started Button)"}),b.jsx(Jr,{id:"link",value:h.link,onChange:F=>P("link",F.target.value),placeholder:"Enter destination URL",required:!0})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(vy,{id:"isActive",checked:h.isActive,onCheckedChange:F=>P("isActive",!!F)}),b.jsx(ir,{htmlFor:"isActive",children:"Active"})]}),b.jsxs("div",{className:"flex gap-4 pt-4",children:[b.jsx(fr,{type:"submit",disabled:v,className:"flex-1",children:v?"Saving...":"Save Popup"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},ZZ=()=>{const{admins:r,currentAdmin:t,createAdmin:s,deleteAdmin:l}=_x(),[h,m]=ee.useState(!1),[v,i]=ee.useState({username:"",email:"",password:"",confirmPassword:""}),[A,P]=ee.useState(""),D=$=>{if($.preventDefault(),P(""),v.password!==v.confirmPassword){P("Passwords do not match");return}if(v.password.length<6){P("Password must be at least 6 characters");return}s(v.username,v.email,v.password)?(i({username:"",email:"",password:"",confirmPassword:""}),m(!1)):P("Username already exists")},F=$=>{window.confirm("Are you sure you want to delete this admin account?")&&(l($)||alert("Cannot delete currently logged in admin"))};return b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Admin Accounts"}),b.jsxs(ol,{open:h,onOpenChange:m,children:[b.jsx(LT,{asChild:!0,children:b.jsxs(fr,{children:[b.jsx(CB,{className:"mr-2 h-4 w-4"}),"Create Admin"]})}),b.jsxs(Fa,{children:[b.jsx(Ba,{children:b.jsx(Va,{children:"Create New Admin Account"})}),b.jsxs("form",{onSubmit:D,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"username",children:"Username"}),b.jsx(Jr,{id:"username",value:v.username,onChange:$=>i(K=>({...K,username:$.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"email",children:"Email"}),b.jsx(Jr,{id:"email",type:"email",value:v.email,onChange:$=>i(K=>({...K,email:$.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"password",children:"Password"}),b.jsx(Jr,{id:"password",type:"password",value:v.password,onChange:$=>i(K=>({...K,password:$.target.value})),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"confirmPassword",children:"Confirm Password"}),b.jsx(Jr,{id:"confirmPassword",type:"password",value:v.confirmPassword,onChange:$=>i(K=>({...K,confirmPassword:$.target.value})),required:!0})]}),A&&b.jsx("p",{className:"text-red-500 text-sm",children:A}),b.jsxs("div",{className:"flex gap-2",children:[b.jsx(fr,{type:"submit",className:"flex-1",children:"Create Admin"}),b.jsx(fr,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})]})]})}),b.jsx(Qn,{children:b.jsx("div",{className:"space-y-4",children:r.map($=>b.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[b.jsx("div",{className:"flex items-center gap-4",children:b.jsxs("div",{children:[b.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[$.username,t?.id===$.id&&b.jsx(_a,{variant:"default",children:"Current User"})]}),b.jsx("p",{className:"text-sm text-gray-600",children:$.email}),b.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",new Date($.createdAt).toLocaleDateString()]})]})}),t?.id!==$.id&&b.jsx(fr,{variant:"destructive",size:"sm",onClick:()=>F($.id),children:b.jsx(sS,{className:"h-4 w-4"})})]},$.id))})})]})},XZ=()=>{const[r,t]=ee.useState(!1),[s,l]=ee.useState(!1),[h,m]=ee.useState(!1),[v,i]=ee.useState(!1),[A,P]=ee.useState(!1),[D,F]=ee.useState(!1),[$,K]=ee.useState(!1),[J,W]=ee.useState(!1),[ie,fe]=ee.useState(!1),[Pe,Fe]=ee.useState(!1),[ht,at]=ee.useState(!1),[Dt,kt]=ee.useState(!1),[Rt,hr]=ee.useState(),[Tr,_r]=ee.useState(),[Sr,Br]=ee.useState(),[Ft,br]=ee.useState(),[Yt,Er]=ee.useState(),[gt,Jt]=ee.useState(),[Ht,qe]=ee.useState(),[Ct,kr]=ee.useState(),[Zr,Rr]=ee.useState(),{isAdminLoggedIn:ar,logout:lr,loading:$r}=_x(),Cr=w1(),Fr=TT(),{data:Zn=[]}=ah({queryKey:["services"],queryFn:async()=>(await zr.get("/services")).map(Fv),enabled:ar}),{data:ri=[]}=ah({queryKey:["consulting"],queryFn:async()=>(await zr.get("/consulting")).map(D_),enabled:ar}),{data:On=[]}=ah({queryKey:["products"],queryFn:async()=>(await zr.get("/products")).map(Bv),enabled:ar}),{data:vs=[]}=ah({queryKey:["funds"],queryFn:async()=>(await zr.get("/funds")).map(Vv),enabled:ar}),{data:$s=[]}=ah({queryKey:["case-studies"],queryFn:async()=>(await zr.get("/case-studies")).map(Uv),enabled:ar}),{data:Hi=[]}=ah({queryKey:["blog-posts"],queryFn:async()=>(await zr.get("/blog-posts")).map($v),enabled:ar}),{data:mo=[]}=ah({queryKey:["events"],queryFn:async()=>(await zr.get("/events")).map(Gv),enabled:ar}),{data:El=[]}=ah({queryKey:["program-applications"],queryFn:async()=>await zr.get("/program-applications"),enabled:ar}),{data:zi=[]}=ah({queryKey:["resources"],queryFn:async()=>(await zr.get("/resources")).map(Hv),enabled:ar}),{data:Ki=[]}=ah({queryKey:["team-members"],queryFn:async()=>(await zr.get("/team-members")).map(Wv),enabled:ar}),{data:to=[]}=ah({queryKey:["contact-messages"],queryFn:async()=>(await zr.get("/contact-messages")).map(qv),enabled:ar}),Qo=fs({mutationFn:Me=>zr.post("/services",h0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["services"]}),vn({title:"Service created successfully"})},onError:()=>{vn({title:"Failed to create service",variant:"destructive"})}}),To=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/services/${Me}`,h0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["services"]}),vn({title:"Service updated successfully"})},onError:()=>{vn({title:"Failed to update service",variant:"destructive"})}}),Cs=fs({mutationFn:Me=>zr.delete(`/services/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["services"]}),vn({title:"Service deleted successfully"})},onError:()=>{vn({title:"Failed to delete service",variant:"destructive"})}}),Ua=fs({mutationFn:Me=>zr.post("/consulting",u0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["consulting"]}),vn({title:"Consulting created successfully"})},onError:()=>{vn({title:"Failed to create consulting",variant:"destructive"})}}),wa=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/consulting/${Me}`,u0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["consulting"]}),vn({title:"Consulting updated successfully"})},onError:()=>{vn({title:"Failed to update consulting",variant:"destructive"})}}),is=fs({mutationFn:Me=>zr.delete(`/consulting/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["consulting"]}),vn({title:"Consulting deleted successfully"})},onError:()=>{vn({title:"Failed to delete consulting",variant:"destructive"})}}),Sa=fs({mutationFn:Me=>zr.post("/products",d0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["products"]}),vn({title:"Product created successfully"})},onError:()=>{vn({title:"Failed to create product",variant:"destructive"})}}),Hs=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/products/${Me}`,d0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["products"]}),vn({title:"Product updated successfully"})},onError:()=>{vn({title:"Failed to update product",variant:"destructive"})}}),Fo=fs({mutationFn:Me=>zr.delete(`/products/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["products"]}),vn({title:"Product deleted successfully"})},onError:()=>{vn({title:"Failed to delete product",variant:"destructive"})}}),ss=fs({mutationFn:Me=>zr.post("/funds",f0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["funds"]}),vn({title:"Fund created successfully"})},onError:()=>{vn({title:"Failed to create fund",variant:"destructive"})}}),go=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/funds/${Me}`,f0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["funds"]}),vn({title:"Fund updated successfully"})},onError:()=>{vn({title:"Failed to update fund",variant:"destructive"})}}),Ta=fs({mutationFn:Me=>zr.delete(`/funds/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["funds"]}),vn({title:"Fund deleted successfully"})},onError:()=>{vn({title:"Failed to delete fund",variant:"destructive"})}}),Ea=fs({mutationFn:Me=>zr.post("/case-studies",p0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["case-studies"]}),vn({title:"Case study created successfully"})},onError:()=>{vn({title:"Failed to create case study",variant:"destructive"})}}),Ca=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/case-studies/${Me}`,p0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["case-studies"]}),vn({title:"Case study updated successfully"})},onError:()=>{vn({title:"Failed to update case study",variant:"destructive"})}}),As=fs({mutationFn:Me=>zr.delete(`/case-studies/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["case-studies"]}),vn({title:"Case study deleted successfully"})},onError:()=>{vn({title:"Failed to delete case study",variant:"destructive"})}}),$a=fs({mutationFn:Me=>zr.post("/blog-posts",m0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["blog-posts"]}),vn({title:"Blog post created successfully"})},onError:()=>{vn({title:"Failed to create blog post",variant:"destructive"})}}),Dr=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/blog-posts/${Me}`,m0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["blog-posts"]}),vn({title:"Blog post updated successfully"})},onError:()=>{vn({title:"Failed to update blog post",variant:"destructive"})}}),ci=fs({mutationFn:Me=>zr.delete(`/blog-posts/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["blog-posts"]}),vn({title:"Blog post deleted successfully"})},onError:()=>{vn({title:"Failed to delete blog post",variant:"destructive"})}}),di=fs({mutationFn:Me=>zr.post("/events",y0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["events"]}),vn({title:"Event created successfully"})},onError:()=>{vn({title:"Failed to create event",variant:"destructive"})}}),Vi=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/events/${Me}`,y0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["events"]}),vn({title:"Event updated successfully"})},onError:()=>{vn({title:"Failed to update event",variant:"destructive"})}}),Is=fs({mutationFn:Me=>zr.delete(`/events/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["events"]}),vn({title:"Event deleted successfully"})},onError:()=>{vn({title:"Failed to delete event",variant:"destructive"})}}),Ha=fs({mutationFn:Me=>zr.post("/resources",g0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["resources"]}),vn({title:"Resource created successfully"})},onError:()=>{vn({title:"Failed to create resource",variant:"destructive"})}}),Ga=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/resources/${Me}`,g0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["resources"]}),vn({title:"Resource updated successfully"})},onError:()=>{vn({title:"Failed to update resource",variant:"destructive"})}}),Ot=fs({mutationFn:Me=>zr.delete(`/resources/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["resources"]}),vn({title:"Resource deleted successfully"})},onError:()=>{vn({title:"Failed to delete resource",variant:"destructive"})}}),qa=fs({mutationFn:Me=>zr.post("/team-members",_0(Me)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["team-members"]}),vn({title:"Team member created successfully"})},onError:()=>{vn({title:"Failed to create team member",variant:"destructive"})}}),gh=fs({mutationFn:({id:Me,data:Wt})=>zr.put(`/team-members/${Me}`,_0(Wt)),onSuccess:()=>{Fr.invalidateQueries({queryKey:["team-members"]}),vn({title:"Team member updated successfully"})},onError:()=>{vn({title:"Failed to update team member",variant:"destructive"})}}),Ql=fs({mutationFn:Me=>zr.delete(`/team-members/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["team-members"]}),vn({title:"Team member deleted successfully"})},onError:()=>{vn({title:"Failed to delete team member",variant:"destructive"})}}),Sn=fs({mutationFn:Me=>zr.delete(`/contact-messages/${Me}`),onSuccess:()=>{Fr.invalidateQueries({queryKey:["contact-messages"]}),vn({title:"Message deleted successfully"})},onError:()=>{vn({title:"Failed to delete message",variant:"destructive"})}}),Ke=Me=>{Rt?(To.mutate({id:Rt.id,data:Me}),hr(void 0)):Qo.mutate(Me)},le=Me=>{Sr?(Hs.mutate({id:Sr.id,data:Me}),Br(void 0)):Sa.mutate(Me)},ue=Me=>{Ft?(go.mutate({id:Ft.id,data:Me}),br(void 0)):ss.mutate(Me)},ve=Me=>{Yt?(Ca.mutate({id:Yt.id,data:Me}),Er(void 0)):Ea.mutate(Me)},Ne=Me=>{gt?(Dr.mutate({id:gt.id,data:Me}),Jt(void 0)):$a.mutate(Me)},Ee=Me=>{Ht?(Vi.mutate({id:Ht.id,data:Me}),qe(void 0)):di.mutate(Me)},ze=Me=>{Ct?(Ga.mutate({id:Ct.id,data:Me}),kr(void 0)):Ha.mutate(Me)},We=Me=>{const Wt={...Me};Zr?(gh.mutate({id:Zr.id,data:Wt}),Rr(void 0)):qa.mutate(Wt)},je=Me=>{Tr?(wa.mutate({id:Tr.id,data:Me}),_r(void 0)):Ua.mutate(Me)},Xe=()=>{fe(!0)},dt=()=>{kt(!0)},Ze=(Me,Wt,mr,Ur="title",nn)=>b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Me.map(Hr=>b.jsxs(Rn,{className:"h-fit",children:[b.jsx(Yn,{children:b.jsx(Jn,{className:"text-lg",children:String(Hr[Ur])})}),b.jsxs(Qn,{className:"space-y-4",children:[nn&&nn(Hr),b.jsxs("div",{className:"flex gap-2 pt-2",children:[b.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>Wt(Hr),children:[b.jsx(SB,{className:"w-4 h-4 mr-1"}),"Edit"]}),b.jsxs(fr,{variant:"outline",size:"sm",onClick:()=>mr(Hr.id),className:"text-red-600 hover:text-red-700",children:[b.jsx(sS,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},Hr.id))}),Nt=()=>b.jsx("div",{className:"grid grid-cols-1 gap-4",children:to.map(Me=>b.jsxs(Rn,{children:[b.jsxs(Yn,{children:[b.jsx(Jn,{className:"text-lg",children:Me.subject}),b.jsxs("p",{className:"text-sm text-gray-600",children:["From: ",Me.name," (",Me.email,")"]})]}),b.jsxs(Qn,{children:[b.jsx("p",{className:"text-sm text-gray-700 mb-2",children:Me.message}),b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("span",{className:`px-2 py-1 rounded text-xs ${Me.status==="unread"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:Me.status}),b.jsx("span",{className:"text-xs text-gray-500",children:new Date(Me.timestamp).toLocaleDateString()}),b.jsxs(fr,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 ml-2",onClick:()=>{window.confirm("Are you sure you want to delete this message?")&&Sn.mutate(Me.id)},children:[b.jsx(sS,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},Me.id))});if(ee.useEffect(()=>{!$r&&!ar&&Cr("/admin")},[$r,ar,Cr]),$r)return b.jsx("div",{className:"p-10 text-center text-gray-400",children:"Checking admin session..."});if(!ar)return null;const Qt=()=>{lr(),Cr("/admin")};return b.jsxs("div",{className:"min-h-screen bg-gray-50",children:[b.jsx(k$,{onLogout:Qt,onStyleSettingsOpen:Xe,onPopupManagementOpen:dt}),b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsx(P$,{services:Zn,consulting:ri,teamMembers:Ki,products:On,funds:vs,messages:to,caseStudies:$s,blogPosts:Hi,programsApplications:El}),b.jsxs(M$,{defaultValue:"services",className:"mt-9",children:[b.jsxs(lD,{className:"grid w-full grid-cols-5 lg:grid-cols-9",children:[b.jsx(cd,{value:"services",children:"Programs"}),b.jsx(cd,{value:"consulting",children:"Consultings"}),b.jsx(cd,{value:"products",children:"Products"}),b.jsx(cd,{value:"case-studies",children:"Portfolio"}),b.jsx(cd,{value:"blog-posts",children:"Blog Posts"}),b.jsx(cd,{value:"resources",children:"Resources"}),b.jsx(cd,{value:"team",children:"Team"}),b.jsx(cd,{value:"messages",children:"Messages"}),b.jsx(cd,{value:"admins",children:"Admins"})]}),b.jsx(hu,{value:"services",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Programs Management"}),b.jsxs(fr,{onClick:()=>t(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Program"]})]})}),b.jsx(Qn,{children:Ze(Zn,Me=>{hr(Me),t(!0)},Me=>Cs.mutate(Me),"title",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:Me.category}),b.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:Me.duration})]}),b.jsxs("div",{className:"text-xs text-gray-600",children:[b.jsx("strong",{children:"Eligibility:"})," ",Me.eligibility]}),Me.features.length>0&&b.jsxs("div",{className:"text-xs",children:[b.jsx("strong",{children:"Features:"}),b.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[Me.features.slice(0,3).map((Wt,mr)=>b.jsx("li",{children:Wt},mr)),Me.features.length>3&&b.jsxs("li",{children:["... and ",Me.features.length-3," more"]})]})]})]}))})]})}),b.jsx(hu,{value:"consulting",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Consultings Management"}),b.jsxs(fr,{onClick:()=>at(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add a Consult"]})]})}),b.jsx(Qn,{children:Ze(ri,Me=>{_r(Me),at(!0)},Me=>is.mutate(Me),"title",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsx("div",{className:"flex gap-2 flex-wrap",children:b.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:Me.category})}),b.jsxs("div",{className:"text-xs text-gray-600",children:[b.jsx("strong",{children:"Eligibility:"})," ",Me.eligibility]}),Me.features.length>0&&b.jsxs("div",{className:"text-xs",children:[b.jsx("strong",{children:"Features:"}),b.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[Me.features.slice(0,3).map((Wt,mr)=>b.jsx("li",{children:Wt},mr)),Me.features.length>3&&b.jsxs("li",{children:["... and ",Me.features.length-3," more"]})]})]})]}))})]})}),b.jsx(hu,{value:"products",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Products Management"}),b.jsxs(fr,{onClick:()=>l(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})}),b.jsx(Qn,{children:Ze(On,Me=>{Br(Me),l(!0)},Me=>Fo.mutate(Me),"name",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:Me.category}),b.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs",children:Me.price}),b.jsx("span",{className:`px-2 py-1 rounded text-xs ${Me.status==="active"?"bg-green-100 text-green-800":Me.status==="inactive"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:Me.status})]}),Me.features.length>0&&b.jsxs("div",{className:"text-xs",children:[b.jsx("strong",{children:"Features:"}),b.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[Me.features.slice(0,2).map((Wt,mr)=>b.jsx("li",{children:Wt},mr)),Me.features.length>2&&b.jsxs("li",{children:["... and ",Me.features.length-2," more"]})]})]})]}))})]})}),b.jsx(hu,{value:"funds",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Funds Management"}),b.jsxs(fr,{onClick:()=>m(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Fund"]})]})}),b.jsx(Qn,{children:Ze(vs,Me=>{br(Me),m(!0)},Me=>Ta.mutate(Me),"name",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[b.jsxs("div",{children:[b.jsx("strong",{children:"Size:"})," ",Me.totalSize]}),b.jsxs("div",{children:[b.jsx("strong",{children:"Raised:"})," ",Me.currentRaise]}),b.jsxs("div",{children:[b.jsx("strong",{children:"Stage:"})," ",Me.stage]}),b.jsxs("div",{children:[b.jsx("strong",{children:"Companies:"})," ",Me.targetCompanies]})]}),b.jsxs("div",{className:"flex gap-1 flex-wrap",children:[Me.sectors.slice(0,3).map((Wt,mr)=>b.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs",children:Wt},mr)),Me.sectors.length>3&&b.jsxs("span",{className:"text-xs text-gray-500",children:["+",Me.sectors.length-3," more"]})]}),b.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${Me.status==="fundraising"?"bg-blue-100 text-blue-800":Me.status==="deployed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:Me.status})]}))})]})}),b.jsx(hu,{value:"case-studies",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Portfolio Management"}),b.jsxs(fr,{onClick:()=>i(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Portfolio"]})]})}),b.jsx(Qn,{children:Ze($s,Me=>{Er(Me),i(!0)},Me=>As.mutate(Me),"companyName",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsx("span",{className:"bg-teal-100 text-teal-800 px-2 py-1 rounded text-xs",children:Me.industry}),b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsxs("div",{className:"text-xs",children:[b.jsxs("div",{className:"mb-1",children:[b.jsx("strong",{children:"Challenge:"})," ",Me.challenge.substring(0,100),"..."]}),b.jsxs("div",{children:[b.jsx("strong",{children:"Solution:"})," ",Me.solution.substring(0,100),"..."]})]}),Me.results.length>0&&b.jsxs("div",{className:"text-xs",children:[b.jsx("strong",{children:"Results:"}),b.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[Me.results.slice(0,2).map((Wt,mr)=>b.jsx("li",{children:Wt},mr)),Me.results.length>2&&b.jsxs("li",{children:["... and ",Me.results.length-2," more"]})]})]}),b.jsx("div",{className:"flex gap-1 flex-wrap",children:Me.tags.slice(0,3).map((Wt,mr)=>b.jsx("span",{className:"bg-pink-100 text-pink-800 px-2 py-1 rounded text-xs",children:Wt},mr))})]}))})]})}),b.jsx(hu,{value:"blog-posts",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Blog Posts Management"}),b.jsxs(fr,{onClick:()=>P(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Blog Post"]})]})}),b.jsx(Qn,{children:Ze(Hi,Me=>{Jt(Me),P(!0)},Me=>ci.mutate(Me),"title",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx("span",{className:"bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs",children:Me.category}),b.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs",children:["By ",Me.author]})]}),b.jsx("p",{className:"text-gray-700",children:Me.excerpt}),b.jsxs("div",{className:"text-xs text-gray-600",children:["Published: ",new Date(Me.publishDate).toLocaleDateString()]}),b.jsx("div",{className:"flex gap-1 flex-wrap",children:Me.tags.slice(0,3).map((Wt,mr)=>b.jsx("span",{className:"bg-emerald-100 text-emerald-800 px-2 py-1 rounded text-xs",children:Wt},mr))})]}))})]})}),b.jsx(hu,{value:"events",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Events Management"}),b.jsxs(fr,{onClick:()=>F(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Event"]})]})}),b.jsx(Qn,{children:Ze(mo,Me=>{qe(Me),F(!0)},Me=>Is.mutate(Me),"title",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx("span",{className:"bg-violet-100 text-violet-800 px-2 py-1 rounded text-xs",children:Me.type}),b.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs",children:new Date(Me.date).toLocaleDateString()})]}),b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsxs("div",{className:"text-xs",children:[b.jsxs("div",{children:[b.jsx("strong",{children:"Time:"})," ",Me.time]}),b.jsxs("div",{children:[b.jsx("strong",{children:"Location:"})," ",Me.location]})]})]}))})]})}),b.jsx(hu,{value:"resources",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Resources Management"}),b.jsxs(fr,{onClick:()=>K(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Resource"]})]})}),b.jsx(Qn,{children:Ze(zi,Me=>{kr(Me),K(!0)},Me=>Ot.mutate(Me),"title",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{className:"flex gap-2 flex-wrap",children:[b.jsx("span",{className:"bg-rose-100 text-rose-800 px-2 py-1 rounded text-xs",children:Me.type}),b.jsx("span",{className:"bg-slate-100 text-slate-800 px-2 py-1 rounded text-xs",children:Me.category})]}),b.jsx("p",{className:"text-gray-700",children:Me.description}),b.jsx("div",{className:"flex gap-1 flex-wrap",children:Me.tags.slice(0,3).map((Wt,mr)=>b.jsx("span",{className:"bg-lime-100 text-lime-800 px-2 py-1 rounded text-xs",children:Wt},mr))})]}))})]})}),b.jsx(hu,{value:"team",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx(Jn,{children:"Team Members Management"}),b.jsxs(fr,{onClick:()=>W(!0),children:[b.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Team Member"]})]})}),b.jsx(Qn,{children:Ze(Ki,Me=>{Rr(Me),W(!0)},Me=>Ql.mutate(Me),"name",Me=>b.jsxs("div",{className:"space-y-2 text-sm",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx("img",{src:Me.image,alt:Me.name,className:"w-12 h-12 rounded-full object-cover"}),b.jsxs("div",{children:[b.jsx("div",{className:"font-medium",children:Me.position}),Me.linkedin_url&&b.jsx("a",{href:Me.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-xs hover:underline",children:"LinkedIn Profile"})]})]}),b.jsx("p",{className:"text-gray-700",children:Me.bio})]}))})]})}),b.jsx(hu,{value:"messages",className:"mt-6",children:b.jsxs(Rn,{children:[b.jsx(Yn,{children:b.jsx(Jn,{children:"Contact Messages"})}),b.jsx(Qn,{children:Nt()})]})}),b.jsx(hu,{value:"admins",children:b.jsx(ZZ,{})})]})]}),b.jsx(R$,{isOpen:r,onClose:()=>{t(!1),hr(void 0)},onSubmit:Ke,service:Rt}),b.jsx(N$,{isOpen:ht,onClose:()=>{at(!1),_r(void 0)},onSubmit:je,consulting:Tr}),b.jsx(D$,{isOpen:s,onClose:()=>{l(!1),Br(void 0)},onSubmit:le,product:Sr}),b.jsx(O$,{isOpen:h,onClose:()=>{m(!1),br(void 0)},onSubmit:ue,fund:Ft}),b.jsx(L$,{isOpen:v,onClose:()=>{i(!1),Er(void 0)},onSubmit:ve,caseStudy:Yt}),b.jsx(zZ,{isOpen:A,onClose:()=>{P(!1),Jt(void 0)},onSubmit:Ne,blogPost:gt}),b.jsx(jZ,{isOpen:D,onClose:()=>{F(!1),qe(void 0)},onSubmit:Ee,event:Ht}),b.jsx(FZ,{isOpen:$,onClose:()=>{K(!1),kr(void 0)},onSubmit:ze,resource:Ct}),b.jsx(BZ,{isOpen:J,onClose:()=>{W(!1),Rr(void 0)},onSubmit:We,member:Zr}),b.jsx(VZ,{isOpen:ie,onClose:()=>fe(!1),onSubmit:Me=>{localStorage.setItem("styleSettings",JSON.stringify(Me)),vn({title:"Style updated!",description:"The site style settings were successfully updated."})},currentSettings:JSON.parse(localStorage.getItem("styleSettings")||JSON.stringify({heroImage:"",runningTextCompanies:[],collaborators:[]}))}),b.jsx(WZ,{open:Dt,onOpenChange:kt})]})},KZ=()=>{const r=nm();return ee.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",r.pathname)},[r.pathname]),b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:b.jsxs("div",{className:"text-center",children:[b.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),b.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),b.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},YZ=()=>{const[r,t]=ee.useState(""),[s,l]=ee.useState(""),{login:h}=_x(),{toast:m}=ky(),v=w1(),i=async A=>{A.preventDefault();try{await h(r,s)?(m({title:"Login successful",description:"Welcome to the admin dashboard"}),v("/admin/dashboard")):m({title:"Login failed",description:"Invalid username or password",variant:"destructive"})}catch{m({title:"Error",description:"Something went wrong during login",variant:"destructive"})}};return b.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:b.jsxs(Rn,{className:"w-full max-w-md",children:[b.jsxs(Yn,{className:"text-center",children:[b.jsx(Jn,{className:"text-2xl font-bold",children:"Admin Login"}),b.jsx(ys,{children:"Enter your credentials to access the admin dashboard"})]}),b.jsx(Qn,{children:b.jsxs("form",{onSubmit:i,className:"space-y-4",children:[b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"username",children:"Username"}),b.jsx(Jr,{id:"username",type:"text",value:r,onChange:A=>t(A.target.value),required:!0})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(ir,{htmlFor:"password",children:"Password"}),b.jsx(Jr,{id:"password",type:"password",value:s,onChange:A=>l(A.target.value),required:!0})]}),b.jsx(fr,{type:"submit",className:"w-full",children:"Login"})]})})]})})},JZ=()=>{const{pathname:r}=nm();return ee.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[r]),null},QZ=({children:r})=>{const{isAdminLoggedIn:t}=_x();return t?r:b.jsx(D6,{to:"/admin",replace:!0})},eX=()=>{const[r,t]=ee.useState(!1),[s,l]=ee.useState({necessary:!0,analytics:!1,marketing:!1});ee.useEffect(()=>{const D=localStorage.getItem("cookie-consent");if(!D)t(!0);else{const F=JSON.parse(D);l(F),F.analytics&&(h(),m())}},[]);const h=()=>{const D="G-XXXXXXXXXX",F=document.createElement("script");F.async=!0,F.src=`https://www.googletagmanager.com/gtag/js?id=${D}`,document.head.appendChild(F),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",D)},m=()=>{const D=document.createElement("script");D.src="https://js.hs-scripts.com/your-hubspot-id.js",D.async=!0,document.body.appendChild(D)},v=()=>{const D={necessary:!0,analytics:!0,marketing:!0};l(D),localStorage.setItem("cookie-consent",JSON.stringify(D)),t(!1),h(),m()},i=()=>{const D={necessary:!0,analytics:!1,marketing:!1};l(D),localStorage.setItem("cookie-consent",JSON.stringify(D)),t(!1)},A=()=>{localStorage.setItem("cookie-consent",JSON.stringify(s)),t(!1),s.analytics&&(h(),m())},P=(D,F)=>{l($=>({...$,[D]:F}))};return r?b.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",children:b.jsxs(Rn,{className:"mx-auto max-w-4xl border-2 shadow-lg",children:[b.jsxs(Yn,{className:"pb-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx(hP,{className:"h-5 w-5 text-primary"}),b.jsx(Jn,{className:"text-lg",children:"Cookie Preferences"})]}),b.jsx(fr,{variant:"ghost",size:"sm",onClick:i,className:"h-8 w-8 p-0",children:b.jsx(p1,{className:"h-4 w-4"})})]}),b.jsx(ys,{children:"We use cookies to enhance your experience, analyze site traffic, and for marketing purposes. You can customize your preferences or accept all cookies."})]}),b.jsx(Qn,{className:"space-y-4",children:b.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[b.jsxs("div",{className:"flex gap-2",children:[b.jsx(fr,{onClick:v,className:"flex-1 sm:flex-none",children:"Accept All"}),b.jsx(fr,{variant:"outline",onClick:i,className:"flex-1 sm:flex-none",children:"Reject All"})]}),b.jsxs(ol,{children:[b.jsx(LT,{asChild:!0,children:b.jsxs(fr,{variant:"outline",className:"flex items-center gap-2",children:[b.jsx(pP,{className:"h-4 w-4"}),"Customize"]})}),b.jsxs(Fa,{className:"max-w-md",children:[b.jsx(Ba,{children:b.jsx(Va,{children:"Cookie Preferences"})}),b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"space-y-1",children:[b.jsx(ir,{htmlFor:"necessary",children:"Necessary Cookies"}),b.jsx("p",{className:"text-sm text-muted-foreground",children:"Essential for the website to function properly"})]}),b.jsx(vy,{id:"necessary",checked:s.necessary,disabled:!0})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"space-y-1",children:[b.jsx(ir,{htmlFor:"analytics",children:"Analytics Cookies"}),b.jsx("p",{className:"text-sm text-muted-foreground",children:"Help us understand how visitors interact with our website"})]}),b.jsx(vy,{id:"analytics",checked:s.analytics,onCheckedChange:D=>P("analytics",D)})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"space-y-1",children:[b.jsx(ir,{htmlFor:"marketing",children:"Marketing Cookies"}),b.jsx("p",{className:"text-sm text-muted-foreground",children:"Used to deliver relevant advertisements"})]}),b.jsx(vy,{id:"marketing",checked:s.marketing,onCheckedChange:D=>P("marketing",D)})]}),b.jsx(fr,{onClick:A,className:"w-full",children:"Save Preferences"})]})]})]})]})})]})}):null},tX=()=>b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs(Mi,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[b.jsx(pd,{className:"w-4 h-4"}),"Back to Home"]}),b.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Privacy Policy"}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information."})]})}),b.jsx("section",{className:"py-16",children:b.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:b.jsxs("div",{className:"prose prose-lg max-w-none",children:[b.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information We Collect"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We collect information you provide directly to us when you use our services, contact us for support, or request information about our programs and offerings. This may include your name, email address, phone number, and other contact information relevant to the services you are requesting."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"How We Use Your Information"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We use the information we collect to:"}),b.jsxs("ul",{className:"text-gray-600 mb-6 space-y-2",children:[b.jsx("li",{children:" Provide and deliver the services you request"}),b.jsx("li",{children:" Process service applications and inquiries"}),b.jsx("li",{children:" Communicate with you about our services and programs"}),b.jsx("li",{children:" Send you important notices and updates"}),b.jsx("li",{children:" Improve our services and understand usage patterns"}),b.jsx("li",{children:" Respond to your questions and provide customer support"})]}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information Sharing"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy or as required by law."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Data Security"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Cookies and Tracking"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We use cookies and similar technologies to enhance your experience, analyze usage, and provide personalized content. You can control cookie settings through your browser."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your Rights"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"You have the right to request access to, correction of, or deletion of your personal information that we have collected through our services. You may also opt out of certain communications from us by contacting us directly."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Children's Privacy"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Our services are not intended for children under 13. We do not knowingly collect personal information from children under 13."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to This Policy"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We may update this privacy policy from time to time. We will notify you of any changes by posting the new policy on this page."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Us"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"If you have any questions about this privacy policy, please contact us at:"}),b.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:b.jsxs("p",{className:"text-gray-600",children:["Email: hello@betawaves.io",b.jsx("br",{}),"Phone: +971 58 829 0773",b.jsx("br",{}),"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"]})})]})})})]}),rX=()=>b.jsxs("div",{className:"min-h-screen",children:[b.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs(Mi,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[b.jsx(pd,{className:"w-4 h-4"}),"Back to Home"]}),b.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Terms of Service"}),b.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"These terms govern your use of our services and establish the agreement between you and our company."})]})}),b.jsx("section",{className:"py-16",children:b.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:b.jsxs("div",{className:"prose prose-lg max-w-none",children:[b.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acceptance of Terms"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"By using our services, you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use our services."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Description of Services"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We provide professional services including consulting, programs, and solutions tailored to meet your business needs. Our services are delivered through various channels including in-person consultations, digital platforms, and project-based engagements."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Service Agreements"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Specific terms for each service will be outlined in separate service agreements or statements of work. These documents will detail scope, deliverables, timelines, and payment terms for the specific services requested."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Payment Terms"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Payment terms vary by service and will be specified in your service agreement. Generally, payment is due according to the schedule outlined in your agreement. Late payments may result in service suspension or termination."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Intellectual Property"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"All content, materials, and deliverables created specifically for you remain your property. Our proprietary methodologies, tools, and general knowledge remain our intellectual property. Specific ownership terms will be detailed in your service agreement."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Confidentiality"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We respect the confidentiality of your business information and maintain strict confidentiality protocols. We will not disclose your confidential information to third parties without your consent, except as required by law."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Limitation of Liability"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Our liability is limited to the fees paid for the specific service. We are not liable for indirect, incidental, or consequential damages. This limitation applies to the fullest extent permitted by law."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Termination"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"Either party may terminate services according to the terms specified in the service agreement. Upon termination, you remain responsible for payment of services rendered up to the termination date."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Governing Law"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"These terms are governed by the laws of the jurisdiction in which our company operates. Any disputes will be resolved through binding arbitration or in the courts of that jurisdiction."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to Terms"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"We may update these terms from time to time. Updated terms will be posted on our website and will take effect immediately upon posting. Continued use of our services constitutes acceptance of the updated terms."}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Information"}),b.jsx("p",{className:"text-gray-600 mb-6",children:"If you have questions about these terms, please contact us:"}),b.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:b.jsxs("p",{className:"text-gray-600",children:["Email: hello@betawaves.io",b.jsx("br",{}),"Phone: +971 58 829 0773",b.jsx("br",{}),"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"]})})]})})})]}),nX=gx("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),GL=ee.forwardRef(({className:r,variant:t,...s},l)=>b.jsx("div",{ref:l,role:"alert",className:ki(nX({variant:t}),r),...s}));GL.displayName="Alert";const iX=ee.forwardRef(({className:r,...t},s)=>b.jsx("h5",{ref:s,className:ki("mb-1 font-medium leading-none tracking-tight",r),...t}));iX.displayName="AlertTitle";const qL=ee.forwardRef(({className:r,...t},s)=>b.jsx("div",{ref:s,className:ki("text-sm [&_p]:leading-relaxed",r),...t}));qL.displayName="AlertDescription";const sX=()=>{const[r,t]=ee.useState({necessary:!0,analytics:!1,marketing:!1});ee.useEffect(()=>{const v=localStorage.getItem("cookie-consent");if(v){const i=JSON.parse(v);t(i),i.analytics&&(s(),l())}},[]);const s=()=>{const v="G-XXXXXXXXXX",i=document.createElement("script");i.async=!0,i.src=`https://www.googletagmanager.com/gtag/js?id=${v}`,document.head.appendChild(i),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",v)},l=()=>{const v=document.createElement("script");v.src="https://js.hs-scripts.com/your-hubspot-id.js",v.async=!0,document.body.appendChild(v)},h=(v,i)=>{const A={...r,[v]:i};t(A),localStorage.setItem("cookie-consent",JSON.stringify(A)),v==="analytics"&&i&&(s(),l())},m=[{id:"necessary",name:"Necessary Cookies",description:"Essential for the website to function properly. These cookies cannot be disabled as they are required for basic website operations.",icon:wB,required:!0,examples:["Session management","Security tokens","Cookie consent preferences"],duration:"Session / 1 year"},{id:"analytics",name:"Analytics Cookies",description:"Help us understand how visitors interact with our website by collecting and reporting information anonymously.",icon:lB,required:!1,examples:["Google Analytics","Page views","User behavior tracking"],duration:"2 years",thirdParty:"Google LLC"},{id:"marketing",name:"Marketing Cookies",description:"Used to deliver relevant advertisements and track the effectiveness of our marketing campaigns.",icon:TB,required:!1,examples:["Ad targeting","Conversion tracking","Remarketing"],duration:"1 year",thirdParty:"Various advertising partners"}];return b.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/5 py-12",children:b.jsx("div",{className:"container mx-auto px-4",children:b.jsxs(Rn,{className:"max-w-4xl mx-auto",children:[b.jsxs(Yn,{className:"text-center",children:[b.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[b.jsx(hP,{className:"h-8 w-8 text-primary"}),b.jsx(Jn,{className:"text-3xl font-bold text-primary",children:"Cookie Policy"})]}),b.jsxs(ys,{className:"text-lg",children:["Last updated: ",new Date().toLocaleDateString()]})]}),b.jsxs(Qn,{className:"space-y-8",children:[b.jsxs(GL,{children:[b.jsx(mB,{className:"h-4 w-4"}),b.jsx(qL,{children:"You can manage your cookie preferences at any time using the controls below. Changes will be applied immediately and saved to your browser."})]}),b.jsxs("section",{children:[b.jsxs("h2",{className:"text-2xl font-semibold text-primary mb-4 flex items-center gap-2",children:[b.jsx(pP,{className:"h-5 w-5"}),"Manage Your Cookie Preferences"]}),b.jsx("div",{className:"grid gap-6",children:m.map(v=>b.jsxs(Rn,{className:"border-2",children:[b.jsxs(Yn,{className:"pb-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsx(v.icon,{className:"h-5 w-5 text-primary"}),b.jsx(Jn,{className:"text-lg",children:v.name}),v.required&&b.jsx(_a,{variant:"secondary",children:"Required"})]}),b.jsx(vy,{checked:r[v.id],onCheckedChange:i=>h(v.id,i),disabled:v.required})]}),b.jsx(ys,{className:"text-sm",children:v.description})]}),b.jsx(Qn,{className:"pt-0",children:b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[b.jsxs("div",{children:[b.jsx(ir,{className:"font-medium",children:"Examples:"}),b.jsx("ul",{className:"mt-1 space-y-1 text-muted-foreground",children:v.examples.map((i,A)=>b.jsxs("li",{children:[" ",i]},A))})]}),b.jsxs("div",{children:[b.jsx(ir,{className:"font-medium",children:"Duration:"}),b.jsx("p",{className:"mt-1 text-muted-foreground",children:v.duration})]}),v.thirdParty&&b.jsxs("div",{children:[b.jsx(ir,{className:"font-medium",children:"Third Party:"}),b.jsx("p",{className:"mt-1 text-muted-foreground",children:v.thirdParty})]})]})})]},v.id))})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"What Are Cookies"}),b.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Cookies are small text files placed on your device to improve your experience and help us deliver better services."})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"How We Use Cookies"}),b.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-muted-foreground",children:[b.jsx("li",{children:"To ensure our website functions properly and securely"}),b.jsx("li",{children:"To remember your cookie preferences and settings"}),b.jsx("li",{children:"To analyze website usage and improve performance"}),b.jsx("li",{children:"To support marketing and advertising efforts"})]})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Third-Party Services"}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Google Analytics"}),b.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Google Analytics helps us understand user behavior anonymously. Data is aggregated and does not personally identify you."}),b.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",b.jsx("a",{href:"https://policies.google.com/technologies/cookies",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Google Cookie Policy"})]})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold text-lg mb-2",children:"HubSpot"}),b.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We use HubSpot to manage customer relationships and marketing automation. HubSpot cookies help track conversions and personalize content."}),b.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",b.jsx("a",{href:"https://legal.hubspot.com/cookie-policy",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"HubSpot Cookie Policy"})]})]})]})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Browser Settings"}),b.jsx("p",{className:"text-muted-foreground",children:"You can manage cookies in your browser settings. Disabling all cookies may affect your experience."})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Updates"}),b.jsx("p",{className:"text-muted-foreground",children:"This Cookie Policy may be updated occasionally. Please check back regularly for changes."})]}),b.jsxs("section",{children:[b.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Contact Us"}),b.jsx("p",{className:"text-muted-foreground",children:"For questions about our Cookie Policy, contact us through our contact page."})]})]})]})})})},oX=new AV,aX=()=>b.jsx(RV,{client:oX,children:b.jsx(hV,{children:b.jsxs(W6,{children:[b.jsx(c4,{}),b.jsx(j4,{}),b.jsxs($6,{children:[b.jsx(JZ,{}),b.jsxs("div",{className:"min-h-screen flex flex-col",children:[b.jsx(X6,{}),b.jsx("main",{className:"flex-1",children:b.jsxs(L6,{children:[b.jsx(ga,{path:"/",element:b.jsx(y8,{})}),b.jsx(ga,{path:"/programs",element:b.jsx(Y8,{})}),b.jsx(ga,{path:"/consultings",element:b.jsx(J8,{})}),b.jsx(ga,{path:"/products",element:b.jsx(Q8,{})}),b.jsx(ga,{path:"/resources",element:b.jsx(t$,{})}),b.jsx(ga,{path:"/fund",element:b.jsx(o$,{})}),b.jsx(ga,{path:"/case-studies",element:b.jsx(a$,{})}),b.jsx(ga,{path:"/blog",element:b.jsx(l$,{})}),b.jsx(ga,{path:"/blog/:id",element:b.jsx(c$,{})}),b.jsx(ga,{path:"/events",element:b.jsx(u$,{})}),b.jsx(ga,{path:"/contact",element:b.jsx(h$,{})}),b.jsx(ga,{path:"/admin",element:b.jsx(YZ,{})}),b.jsx(ga,{path:"/admin/dashboard",element:b.jsx(QZ,{children:b.jsx(XZ,{})})}),b.jsx(ga,{path:"/privacy-policy",element:b.jsx(tX,{})}),b.jsx(ga,{path:"/terms-of-service",element:b.jsx(rX,{})}),b.jsx(ga,{path:"/cookie-policy",element:b.jsx(sX,{})}),b.jsx(ga,{path:"*",element:b.jsx(KZ,{})})]})}),b.jsx(K6,{})]}),b.jsx(eX,{})]})]})})});cF.createRoot(document.getElementById("root")).render(b.jsx(aX,{}));

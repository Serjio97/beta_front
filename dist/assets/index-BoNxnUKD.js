function hF(n,t){for(var s=0;s<t.length;s++){const l=t[s];if(typeof l!="string"&&!Array.isArray(l)){for(const h in l)if(h!=="default"&&!(h in n)){const m=Object.getOwnPropertyDescriptor(l,h);m&&Object.defineProperty(n,h,m.get?m:{enumerable:!0,get:()=>l[h]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const b of m.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function s(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(h){if(h.ep)return;h.ep=!0;const m=s(h);fetch(h.href,m)}})();function Y0(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hb={exports:{}},D_={},Gb={exports:{}},Li={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JA;function dF(){if(JA)return Li;JA=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),b=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),j=Symbol.iterator;function U(qe){return qe===null||typeof qe!="object"?null:(qe=j&&qe[j]||qe["@@iterator"],typeof qe=="function"?qe:null)}var X={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y=Object.assign,W={};function re(qe,Ct,Pn){this.props=qe,this.context=Ct,this.refs=W,this.updater=Pn||X}re.prototype.isReactComponent={},re.prototype.setState=function(qe,Ct){if(typeof qe!="object"&&typeof qe!="function"&&qe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,qe,Ct,"setState")},re.prototype.forceUpdate=function(qe){this.updater.enqueueForceUpdate(this,qe,"forceUpdate")};function de(){}de.prototype=re.prototype;function Me(qe,Ct,Pn){this.props=qe,this.context=Ct,this.refs=W,this.updater=Pn||X}var Fe=Me.prototype=new de;Fe.constructor=Me,Y(Fe,re.prototype),Fe.isPureReactComponent=!0;var ht=Array.isArray,at=Object.prototype.hasOwnProperty,Dt={current:null},kt={key:!0,ref:!0,__self:!0,__source:!0};function Rt(qe,Ct,Pn){var Zn,Nn={},cn=null,un=null;if(Ct!=null)for(Zn in Ct.ref!==void 0&&(un=Ct.ref),Ct.key!==void 0&&(cn=""+Ct.key),Ct)at.call(Ct,Zn)&&!kt.hasOwnProperty(Zn)&&(Nn[Zn]=Ct[Zn]);var $n=arguments.length-2;if($n===1)Nn.children=Pn;else if(1<$n){for(var An=Array($n),Fn=0;Fn<$n;Fn++)An[Fn]=arguments[Fn+2];Nn.children=An}if(qe&&qe.defaultProps)for(Zn in $n=qe.defaultProps,$n)Nn[Zn]===void 0&&(Nn[Zn]=$n[Zn]);return{$$typeof:n,type:qe,key:cn,ref:un,props:Nn,_owner:Dt.current}}function fn(qe,Ct){return{$$typeof:n,type:qe.type,key:Ct,ref:qe.ref,props:qe.props,_owner:qe._owner}}function En(qe){return typeof qe=="object"&&qe!==null&&qe.$$typeof===n}function xn(qe){var Ct={"=":"=0",":":"=2"};return"$"+qe.replace(/[=:]/g,function(Pn){return Ct[Pn]})}var Tn=/\/+/g;function Bn(qe,Ct){return typeof qe=="object"&&qe!==null&&qe.key!=null?xn(""+qe.key):Ct.toString(36)}function Ft(qe,Ct,Pn,Zn,Nn){var cn=typeof qe;(cn==="undefined"||cn==="boolean")&&(qe=null);var un=!1;if(qe===null)un=!0;else switch(cn){case"string":case"number":un=!0;break;case"object":switch(qe.$$typeof){case n:case t:un=!0}}if(un)return un=qe,Nn=Nn(un),qe=Zn===""?"."+Bn(un,0):Zn,ht(Nn)?(Pn="",qe!=null&&(Pn=qe.replace(Tn,"$&/")+"/"),Ft(Nn,Ct,Pn,"",function(Fn){return Fn})):Nn!=null&&(En(Nn)&&(Nn=fn(Nn,Pn+(!Nn.key||un&&un.key===Nn.key?"":(""+Nn.key).replace(Tn,"$&/")+"/")+qe)),Ct.push(Nn)),1;if(un=0,Zn=Zn===""?".":Zn+":",ht(qe))for(var $n=0;$n<qe.length;$n++){cn=qe[$n];var An=Zn+Bn(cn,$n);un+=Ft(cn,Ct,Pn,An,Nn)}else if(An=U(qe),typeof An=="function")for(qe=An.call(qe),$n=0;!(cn=qe.next()).done;)cn=cn.value,An=Zn+Bn(cn,$n++),un+=Ft(cn,Ct,Pn,An,Nn);else if(cn==="object")throw Ct=String(qe),Error("Objects are not valid as a React child (found: "+(Ct==="[object Object]"?"object with keys {"+Object.keys(qe).join(", ")+"}":Ct)+"). If you meant to render a collection of children, use an array instead.");return un}function wn(qe,Ct,Pn){if(qe==null)return qe;var Zn=[],Nn=0;return Ft(qe,Zn,"","",function(cn){return Ct.call(Pn,cn,Nn++)}),Zn}function Yt(qe){if(qe._status===-1){var Ct=qe._result;Ct=Ct(),Ct.then(function(Pn){(qe._status===0||qe._status===-1)&&(qe._status=1,qe._result=Pn)},function(Pn){(qe._status===0||qe._status===-1)&&(qe._status=2,qe._result=Pn)}),qe._status===-1&&(qe._status=0,qe._result=Ct)}if(qe._status===1)return qe._result.default;throw qe._result}var Cn={current:null},gt={transition:null},Jt={ReactCurrentDispatcher:Cn,ReactCurrentBatchConfig:gt,ReactCurrentOwner:Dt};function Ht(){throw Error("act(...) is not supported in production builds of React.")}return Li.Children={map:wn,forEach:function(qe,Ct,Pn){wn(qe,function(){Ct.apply(this,arguments)},Pn)},count:function(qe){var Ct=0;return wn(qe,function(){Ct++}),Ct},toArray:function(qe){return wn(qe,function(Ct){return Ct})||[]},only:function(qe){if(!En(qe))throw Error("React.Children.only expected to receive a single React element child.");return qe}},Li.Component=re,Li.Fragment=s,Li.Profiler=h,Li.PureComponent=Me,Li.StrictMode=l,Li.Suspense=A,Li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Jt,Li.act=Ht,Li.cloneElement=function(qe,Ct,Pn){if(qe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+qe+".");var Zn=Y({},qe.props),Nn=qe.key,cn=qe.ref,un=qe._owner;if(Ct!=null){if(Ct.ref!==void 0&&(cn=Ct.ref,un=Dt.current),Ct.key!==void 0&&(Nn=""+Ct.key),qe.type&&qe.type.defaultProps)var $n=qe.type.defaultProps;for(An in Ct)at.call(Ct,An)&&!kt.hasOwnProperty(An)&&(Zn[An]=Ct[An]===void 0&&$n!==void 0?$n[An]:Ct[An])}var An=arguments.length-2;if(An===1)Zn.children=Pn;else if(1<An){$n=Array(An);for(var Fn=0;Fn<An;Fn++)$n[Fn]=arguments[Fn+2];Zn.children=$n}return{$$typeof:n,type:qe.type,key:Nn,ref:cn,props:Zn,_owner:un}},Li.createContext=function(qe){return qe={$$typeof:b,_currentValue:qe,_currentValue2:qe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},qe.Provider={$$typeof:m,_context:qe},qe.Consumer=qe},Li.createElement=Rt,Li.createFactory=function(qe){var Ct=Rt.bind(null,qe);return Ct.type=qe,Ct},Li.createRef=function(){return{current:null}},Li.forwardRef=function(qe){return{$$typeof:i,render:qe}},Li.isValidElement=En,Li.lazy=function(qe){return{$$typeof:D,_payload:{_status:-1,_result:qe},_init:Yt}},Li.memo=function(qe,Ct){return{$$typeof:P,type:qe,compare:Ct===void 0?null:Ct}},Li.startTransition=function(qe){var Ct=gt.transition;gt.transition={};try{qe()}finally{gt.transition=Ct}},Li.unstable_act=Ht,Li.useCallback=function(qe,Ct){return Cn.current.useCallback(qe,Ct)},Li.useContext=function(qe){return Cn.current.useContext(qe)},Li.useDebugValue=function(){},Li.useDeferredValue=function(qe){return Cn.current.useDeferredValue(qe)},Li.useEffect=function(qe,Ct){return Cn.current.useEffect(qe,Ct)},Li.useId=function(){return Cn.current.useId()},Li.useImperativeHandle=function(qe,Ct,Pn){return Cn.current.useImperativeHandle(qe,Ct,Pn)},Li.useInsertionEffect=function(qe,Ct){return Cn.current.useInsertionEffect(qe,Ct)},Li.useLayoutEffect=function(qe,Ct){return Cn.current.useLayoutEffect(qe,Ct)},Li.useMemo=function(qe,Ct){return Cn.current.useMemo(qe,Ct)},Li.useReducer=function(qe,Ct,Pn){return Cn.current.useReducer(qe,Ct,Pn)},Li.useRef=function(qe){return Cn.current.useRef(qe)},Li.useState=function(qe){return Cn.current.useState(qe)},Li.useSyncExternalStore=function(qe,Ct,Pn){return Cn.current.useSyncExternalStore(qe,Ct,Pn)},Li.useTransition=function(){return Cn.current.useTransition()},Li.version="18.3.1",Li}var QA;function yx(){return QA||(QA=1,Gb.exports=dF()),Gb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eI;function fF(){if(eI)return D_;eI=1;var n=yx(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,h=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function b(i,A,P){var D,j={},U=null,X=null;P!==void 0&&(U=""+P),A.key!==void 0&&(U=""+A.key),A.ref!==void 0&&(X=A.ref);for(D in A)l.call(A,D)&&!m.hasOwnProperty(D)&&(j[D]=A[D]);if(i&&i.defaultProps)for(D in A=i.defaultProps,A)j[D]===void 0&&(j[D]=A[D]);return{$$typeof:t,type:i,key:U,ref:X,props:j,_owner:h.current}}return D_.Fragment=s,D_.jsx=b,D_.jsxs=b,D_}var tI;function pF(){return tI||(tI=1,Hb.exports=fF()),Hb.exports}var v=pF(),xv={},qb={exports:{}},Xl={},Wb={exports:{}},Zb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nI;function mF(){return nI||(nI=1,function(n){function t(gt,Jt){var Ht=gt.length;gt.push(Jt);e:for(;0<Ht;){var qe=Ht-1>>>1,Ct=gt[qe];if(0<h(Ct,Jt))gt[qe]=Jt,gt[Ht]=Ct,Ht=qe;else break e}}function s(gt){return gt.length===0?null:gt[0]}function l(gt){if(gt.length===0)return null;var Jt=gt[0],Ht=gt.pop();if(Ht!==Jt){gt[0]=Ht;e:for(var qe=0,Ct=gt.length,Pn=Ct>>>1;qe<Pn;){var Zn=2*(qe+1)-1,Nn=gt[Zn],cn=Zn+1,un=gt[cn];if(0>h(Nn,Ht))cn<Ct&&0>h(un,Nn)?(gt[qe]=un,gt[cn]=Ht,qe=cn):(gt[qe]=Nn,gt[Zn]=Ht,qe=Zn);else if(cn<Ct&&0>h(un,Ht))gt[qe]=un,gt[cn]=Ht,qe=cn;else break e}}return Jt}function h(gt,Jt){var Ht=gt.sortIndex-Jt.sortIndex;return Ht!==0?Ht:gt.id-Jt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var m=performance;n.unstable_now=function(){return m.now()}}else{var b=Date,i=b.now();n.unstable_now=function(){return b.now()-i}}var A=[],P=[],D=1,j=null,U=3,X=!1,Y=!1,W=!1,re=typeof setTimeout=="function"?setTimeout:null,de=typeof clearTimeout=="function"?clearTimeout:null,Me=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Fe(gt){for(var Jt=s(P);Jt!==null;){if(Jt.callback===null)l(P);else if(Jt.startTime<=gt)l(P),Jt.sortIndex=Jt.expirationTime,t(A,Jt);else break;Jt=s(P)}}function ht(gt){if(W=!1,Fe(gt),!Y)if(s(A)!==null)Y=!0,Yt(at);else{var Jt=s(P);Jt!==null&&Cn(ht,Jt.startTime-gt)}}function at(gt,Jt){Y=!1,W&&(W=!1,de(Rt),Rt=-1),X=!0;var Ht=U;try{for(Fe(Jt),j=s(A);j!==null&&(!(j.expirationTime>Jt)||gt&&!xn());){var qe=j.callback;if(typeof qe=="function"){j.callback=null,U=j.priorityLevel;var Ct=qe(j.expirationTime<=Jt);Jt=n.unstable_now(),typeof Ct=="function"?j.callback=Ct:j===s(A)&&l(A),Fe(Jt)}else l(A);j=s(A)}if(j!==null)var Pn=!0;else{var Zn=s(P);Zn!==null&&Cn(ht,Zn.startTime-Jt),Pn=!1}return Pn}finally{j=null,U=Ht,X=!1}}var Dt=!1,kt=null,Rt=-1,fn=5,En=-1;function xn(){return!(n.unstable_now()-En<fn)}function Tn(){if(kt!==null){var gt=n.unstable_now();En=gt;var Jt=!0;try{Jt=kt(!0,gt)}finally{Jt?Bn():(Dt=!1,kt=null)}}else Dt=!1}var Bn;if(typeof Me=="function")Bn=function(){Me(Tn)};else if(typeof MessageChannel<"u"){var Ft=new MessageChannel,wn=Ft.port2;Ft.port1.onmessage=Tn,Bn=function(){wn.postMessage(null)}}else Bn=function(){re(Tn,0)};function Yt(gt){kt=gt,Dt||(Dt=!0,Bn())}function Cn(gt,Jt){Rt=re(function(){gt(n.unstable_now())},Jt)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(gt){gt.callback=null},n.unstable_continueExecution=function(){Y||X||(Y=!0,Yt(at))},n.unstable_forceFrameRate=function(gt){0>gt||125<gt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fn=0<gt?Math.floor(1e3/gt):5},n.unstable_getCurrentPriorityLevel=function(){return U},n.unstable_getFirstCallbackNode=function(){return s(A)},n.unstable_next=function(gt){switch(U){case 1:case 2:case 3:var Jt=3;break;default:Jt=U}var Ht=U;U=Jt;try{return gt()}finally{U=Ht}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(gt,Jt){switch(gt){case 1:case 2:case 3:case 4:case 5:break;default:gt=3}var Ht=U;U=gt;try{return Jt()}finally{U=Ht}},n.unstable_scheduleCallback=function(gt,Jt,Ht){var qe=n.unstable_now();switch(typeof Ht=="object"&&Ht!==null?(Ht=Ht.delay,Ht=typeof Ht=="number"&&0<Ht?qe+Ht:qe):Ht=qe,gt){case 1:var Ct=-1;break;case 2:Ct=250;break;case 5:Ct=1073741823;break;case 4:Ct=1e4;break;default:Ct=5e3}return Ct=Ht+Ct,gt={id:D++,callback:Jt,priorityLevel:gt,startTime:Ht,expirationTime:Ct,sortIndex:-1},Ht>qe?(gt.sortIndex=Ht,t(P,gt),s(A)===null&&gt===s(P)&&(W?(de(Rt),Rt=-1):W=!0,Cn(ht,Ht-qe))):(gt.sortIndex=Ct,t(A,gt),Y||X||(Y=!0,Yt(at))),gt},n.unstable_shouldYield=xn,n.unstable_wrapCallback=function(gt){var Jt=U;return function(){var Ht=U;U=Jt;try{return gt.apply(this,arguments)}finally{U=Ht}}}}(Zb)),Zb}var rI;function gF(){return rI||(rI=1,Wb.exports=mF()),Wb.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iI;function yF(){if(iI)return Xl;iI=1;var n=yx(),t=gF();function s(_){for(var w="https://reactjs.org/docs/error-decoder.html?invariant="+_,k=1;k<arguments.length;k++)w+="&args[]="+encodeURIComponent(arguments[k]);return"Minified React error #"+_+"; visit "+w+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,h={};function m(_,w){b(_,w),b(_+"Capture",w)}function b(_,w){for(h[_]=w,_=0;_<w.length;_++)l.add(w[_])}var i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),A=Object.prototype.hasOwnProperty,P=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,D={},j={};function U(_){return A.call(j,_)?!0:A.call(D,_)?!1:P.test(_)?j[_]=!0:(D[_]=!0,!1)}function X(_,w,k,B){if(k!==null&&k.type===0)return!1;switch(typeof w){case"function":case"symbol":return!0;case"boolean":return B?!1:k!==null?!k.acceptsBooleans:(_=_.toLowerCase().slice(0,5),_!=="data-"&&_!=="aria-");default:return!1}}function Y(_,w,k,B){if(w===null||typeof w>"u"||X(_,w,k,B))return!0;if(B)return!1;if(k!==null)switch(k.type){case 3:return!w;case 4:return w===!1;case 5:return isNaN(w);case 6:return isNaN(w)||1>w}return!1}function W(_,w,k,B,Z,se,we){this.acceptsBooleans=w===2||w===3||w===4,this.attributeName=B,this.attributeNamespace=Z,this.mustUseProperty=k,this.propertyName=_,this.type=w,this.sanitizeURL=se,this.removeEmptyString=we}var re={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_){re[_]=new W(_,0,!1,_,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_){var w=_[0];re[w]=new W(w,1,!1,_[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(_){re[_]=new W(_,2,!1,_.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_){re[_]=new W(_,2,!1,_,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_){re[_]=new W(_,3,!1,_.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(_){re[_]=new W(_,3,!0,_,null,!1,!1)}),["capture","download"].forEach(function(_){re[_]=new W(_,4,!1,_,null,!1,!1)}),["cols","rows","size","span"].forEach(function(_){re[_]=new W(_,6,!1,_,null,!1,!1)}),["rowSpan","start"].forEach(function(_){re[_]=new W(_,5,!1,_.toLowerCase(),null,!1,!1)});var de=/[\-:]([a-z])/g;function Me(_){return _[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_){var w=_.replace(de,Me);re[w]=new W(w,1,!1,_,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_){var w=_.replace(de,Me);re[w]=new W(w,1,!1,_,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(_){var w=_.replace(de,Me);re[w]=new W(w,1,!1,_,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(_){re[_]=new W(_,1,!1,_.toLowerCase(),null,!1,!1)}),re.xlinkHref=new W("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(_){re[_]=new W(_,1,!1,_.toLowerCase(),null,!0,!0)});function Fe(_,w,k,B){var Z=re.hasOwnProperty(w)?re[w]:null;(Z!==null?Z.type!==0:B||!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(Y(w,k,Z,B)&&(k=null),B||Z===null?U(w)&&(k===null?_.removeAttribute(w):_.setAttribute(w,""+k)):Z.mustUseProperty?_[Z.propertyName]=k===null?Z.type===3?!1:"":k:(w=Z.attributeName,B=Z.attributeNamespace,k===null?_.removeAttribute(w):(Z=Z.type,k=Z===3||Z===4&&k===!0?"":""+k,B?_.setAttributeNS(B,w,k):_.setAttribute(w,k))))}var ht=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,at=Symbol.for("react.element"),Dt=Symbol.for("react.portal"),kt=Symbol.for("react.fragment"),Rt=Symbol.for("react.strict_mode"),fn=Symbol.for("react.profiler"),En=Symbol.for("react.provider"),xn=Symbol.for("react.context"),Tn=Symbol.for("react.forward_ref"),Bn=Symbol.for("react.suspense"),Ft=Symbol.for("react.suspense_list"),wn=Symbol.for("react.memo"),Yt=Symbol.for("react.lazy"),Cn=Symbol.for("react.offscreen"),gt=Symbol.iterator;function Jt(_){return _===null||typeof _!="object"?null:(_=gt&&_[gt]||_["@@iterator"],typeof _=="function"?_:null)}var Ht=Object.assign,qe;function Ct(_){if(qe===void 0)try{throw Error()}catch(k){var w=k.stack.trim().match(/\n( *(at )?)/);qe=w&&w[1]||""}return`
`+qe+_}var Pn=!1;function Zn(_,w){if(!_||Pn)return"";Pn=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(w)if(w=function(){throw Error()},Object.defineProperty(w.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(w,[])}catch(Et){var B=Et}Reflect.construct(_,[],w)}else{try{w.call()}catch(Et){B=Et}_.call(w.prototype)}else{try{throw Error()}catch(Et){B=Et}_()}}catch(Et){if(Et&&B&&typeof Et.stack=="string"){for(var Z=Et.stack.split(`
`),se=B.stack.split(`
`),we=Z.length-1,He=se.length-1;1<=we&&0<=He&&Z[we]!==se[He];)He--;for(;1<=we&&0<=He;we--,He--)if(Z[we]!==se[He]){if(we!==1||He!==1)do if(we--,He--,0>He||Z[we]!==se[He]){var Qe=`
`+Z[we].replace(" at new "," at ");return _.displayName&&Qe.includes("<anonymous>")&&(Qe=Qe.replace("<anonymous>",_.displayName)),Qe}while(1<=we&&0<=He);break}}}finally{Pn=!1,Error.prepareStackTrace=k}return(_=_?_.displayName||_.name:"")?Ct(_):""}function Nn(_){switch(_.tag){case 5:return Ct(_.type);case 16:return Ct("Lazy");case 13:return Ct("Suspense");case 19:return Ct("SuspenseList");case 0:case 2:case 15:return _=Zn(_.type,!1),_;case 11:return _=Zn(_.type.render,!1),_;case 1:return _=Zn(_.type,!0),_;default:return""}}function cn(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case kt:return"Fragment";case Dt:return"Portal";case fn:return"Profiler";case Rt:return"StrictMode";case Bn:return"Suspense";case Ft:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case xn:return(_.displayName||"Context")+".Consumer";case En:return(_._context.displayName||"Context")+".Provider";case Tn:var w=_.render;return _=_.displayName,_||(_=w.displayName||w.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case wn:return w=_.displayName||null,w!==null?w:cn(_.type)||"Memo";case Yt:w=_._payload,_=_._init;try{return cn(_(w))}catch{}}return null}function un(_){var w=_.type;switch(_.tag){case 24:return"Cache";case 9:return(w.displayName||"Context")+".Consumer";case 10:return(w._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=w.render,_=_.displayName||_.name||"",w.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return w;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return cn(w);case 8:return w===Rt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w}return null}function $n(_){switch(typeof _){case"boolean":case"number":case"string":case"undefined":return _;case"object":return _;default:return""}}function An(_){var w=_.type;return(_=_.nodeName)&&_.toLowerCase()==="input"&&(w==="checkbox"||w==="radio")}function Fn(_){var w=An(_)?"checked":"value",k=Object.getOwnPropertyDescriptor(_.constructor.prototype,w),B=""+_[w];if(!_.hasOwnProperty(w)&&typeof k<"u"&&typeof k.get=="function"&&typeof k.set=="function"){var Z=k.get,se=k.set;return Object.defineProperty(_,w,{configurable:!0,get:function(){return Z.call(this)},set:function(we){B=""+we,se.call(this,we)}}),Object.defineProperty(_,w,{enumerable:k.enumerable}),{getValue:function(){return B},setValue:function(we){B=""+we},stopTracking:function(){_._valueTracker=null,delete _[w]}}}}function Zr(_){_._valueTracker||(_._valueTracker=Fn(_))}function ni(_){if(!_)return!1;var w=_._valueTracker;if(!w)return!0;var k=w.getValue(),B="";return _&&(B=An(_)?_.checked?"true":"false":_.value),_=B,_!==k?(w.setValue(_),!0):!1}function Or(_){if(_=_||(typeof document<"u"?document:void 0),typeof _>"u")return null;try{return _.activeElement||_.body}catch{return _.body}}function vs(_,w){var k=w.checked;return Ht({},w,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:k??_._wrapperState.initialChecked})}function $s(_,w){var k=w.defaultValue==null?"":w.defaultValue,B=w.checked!=null?w.checked:w.defaultChecked;k=$n(w.value!=null?w.value:k),_._wrapperState={initialChecked:B,initialValue:k,controlled:w.type==="checkbox"||w.type==="radio"?w.checked!=null:w.value!=null}}function Hi(_,w){w=w.checked,w!=null&&Fe(_,"checked",w,!1)}function mo(_,w){Hi(_,w);var k=$n(w.value),B=w.type;if(k!=null)B==="number"?(k===0&&_.value===""||_.value!=k)&&(_.value=""+k):_.value!==""+k&&(_.value=""+k);else if(B==="submit"||B==="reset"){_.removeAttribute("value");return}w.hasOwnProperty("value")?zi(_,w.type,k):w.hasOwnProperty("defaultValue")&&zi(_,w.type,$n(w.defaultValue)),w.checked==null&&w.defaultChecked!=null&&(_.defaultChecked=!!w.defaultChecked)}function El(_,w,k){if(w.hasOwnProperty("value")||w.hasOwnProperty("defaultValue")){var B=w.type;if(!(B!=="submit"&&B!=="reset"||w.value!==void 0&&w.value!==null))return;w=""+_._wrapperState.initialValue,k||w===_.value||(_.value=w),_.defaultValue=w}k=_.name,k!==""&&(_.name=""),_.defaultChecked=!!_._wrapperState.initialChecked,k!==""&&(_.name=k)}function zi(_,w,k){(w!=="number"||Or(_.ownerDocument)!==_)&&(k==null?_.defaultValue=""+_._wrapperState.initialValue:_.defaultValue!==""+k&&(_.defaultValue=""+k))}var Ki=Array.isArray;function to(_,w,k,B){if(_=_.options,w){w={};for(var Z=0;Z<k.length;Z++)w["$"+k[Z]]=!0;for(k=0;k<_.length;k++)Z=w.hasOwnProperty("$"+_[k].value),_[k].selected!==Z&&(_[k].selected=Z),Z&&B&&(_[k].defaultSelected=!0)}else{for(k=""+$n(k),w=null,Z=0;Z<_.length;Z++){if(_[Z].value===k){_[Z].selected=!0,B&&(_[Z].defaultSelected=!0);return}w!==null||_[Z].disabled||(w=_[Z])}w!==null&&(w.selected=!0)}}function Qo(_,w){if(w.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ht({},w,{value:void 0,defaultValue:void 0,children:""+_._wrapperState.initialValue})}function To(_,w){var k=w.value;if(k==null){if(k=w.children,w=w.defaultValue,k!=null){if(w!=null)throw Error(s(92));if(Ki(k)){if(1<k.length)throw Error(s(93));k=k[0]}w=k}w==null&&(w=""),k=w}_._wrapperState={initialValue:$n(k)}}function Cs(_,w){var k=$n(w.value),B=$n(w.defaultValue);k!=null&&(k=""+k,k!==_.value&&(_.value=k),w.defaultValue==null&&_.defaultValue!==k&&(_.defaultValue=k)),B!=null&&(_.defaultValue=""+B)}function Ua(_){var w=_.textContent;w===_._wrapperState.initialValue&&w!==""&&w!==null&&(_.value=w)}function wa(_){switch(_){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function is(_,w){return _==null||_==="http://www.w3.org/1999/xhtml"?wa(w):_==="http://www.w3.org/2000/svg"&&w==="foreignObject"?"http://www.w3.org/1999/xhtml":_}var Sa,Hs=function(_){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(w,k,B,Z){MSApp.execUnsafeLocalFunction(function(){return _(w,k,B,Z)})}:_}(function(_,w){if(_.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _)_.innerHTML=w;else{for(Sa=Sa||document.createElement("div"),Sa.innerHTML="<svg>"+w.valueOf().toString()+"</svg>",w=Sa.firstChild;_.firstChild;)_.removeChild(_.firstChild);for(;w.firstChild;)_.appendChild(w.firstChild)}});function Fo(_,w){if(w){var k=_.firstChild;if(k&&k===_.lastChild&&k.nodeType===3){k.nodeValue=w;return}}_.textContent=w}var ss={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},go=["Webkit","ms","Moz","O"];Object.keys(ss).forEach(function(_){go.forEach(function(w){w=w+_.charAt(0).toUpperCase()+_.substring(1),ss[w]=ss[_]})});function Ta(_,w,k){return w==null||typeof w=="boolean"||w===""?"":k||typeof w!="number"||w===0||ss.hasOwnProperty(_)&&ss[_]?(""+w).trim():w+"px"}function Ea(_,w){_=_.style;for(var k in w)if(w.hasOwnProperty(k)){var B=k.indexOf("--")===0,Z=Ta(k,w[k],B);k==="float"&&(k="cssFloat"),B?_.setProperty(k,Z):_[k]=Z}}var Ca=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function As(_,w){if(w){if(Ca[_]&&(w.children!=null||w.dangerouslySetInnerHTML!=null))throw Error(s(137,_));if(w.dangerouslySetInnerHTML!=null){if(w.children!=null)throw Error(s(60));if(typeof w.dangerouslySetInnerHTML!="object"||!("__html"in w.dangerouslySetInnerHTML))throw Error(s(61))}if(w.style!=null&&typeof w.style!="object")throw Error(s(62))}}function $a(_,w){if(_.indexOf("-")===-1)return typeof w.is=="string";switch(_){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var On=null;function ui(_){return _=_.target||_.srcElement||window,_.correspondingUseElement&&(_=_.correspondingUseElement),_.nodeType===3?_.parentNode:_}var fi=null,Vi=null,Is=null;function Ha(_){if(_=Vd(_)){if(typeof fi!="function")throw Error(s(280));var w=_.stateNode;w&&(w=Lu(w),fi(_.stateNode,_.type,w))}}function Ga(_){Vi?Is?Is.push(_):Is=[_]:Vi=_}function Ot(){if(Vi){var _=Vi,w=Is;if(Is=Vi=null,Ha(_),w)for(_=0;_<w.length;_++)Ha(w[_])}}function qa(_,w){return _(w)}function gh(){}var Ql=!1;function Sr(_,w,k){if(Ql)return _(w,k);Ql=!0;try{return qa(_,w,k)}finally{Ql=!1,(Vi!==null||Is!==null)&&(gh(),Ot())}}function Ke(_,w){var k=_.stateNode;if(k===null)return null;var B=Lu(k);if(B===null)return null;k=B[w];e:switch(w){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(B=!B.disabled)||(_=_.type,B=!(_==="button"||_==="input"||_==="select"||_==="textarea")),_=!B;break e;default:_=!1}if(_)return null;if(k&&typeof k!="function")throw Error(s(231,w,typeof k));return k}var le=!1;if(i)try{var ue={};Object.defineProperty(ue,"passive",{get:function(){le=!0}}),window.addEventListener("test",ue,ue),window.removeEventListener("test",ue,ue)}catch{le=!1}function ve(_,w,k,B,Z,se,we,He,Qe){var Et=Array.prototype.slice.call(arguments,3);try{w.apply(k,Et)}catch(dn){this.onError(dn)}}var Ne=!1,Ee=null,ze=!1,We=null,je={onError:function(_){Ne=!0,Ee=_}};function Xe(_,w,k,B,Z,se,we,He,Qe){Ne=!1,Ee=null,ve.apply(je,arguments)}function dt(_,w,k,B,Z,se,we,He,Qe){if(Xe.apply(this,arguments),Ne){if(Ne){var Et=Ee;Ne=!1,Ee=null}else throw Error(s(198));ze||(ze=!0,We=Et)}}function Ze(_){var w=_,k=_;if(_.alternate)for(;w.return;)w=w.return;else{_=w;do w=_,(w.flags&4098)!==0&&(k=w.return),_=w.return;while(_)}return w.tag===3?k:null}function Nt(_){if(_.tag===13){var w=_.memoizedState;if(w===null&&(_=_.alternate,_!==null&&(w=_.memoizedState)),w!==null)return w.dehydrated}return null}function Qt(_){if(Ze(_)!==_)throw Error(s(188))}function ke(_){var w=_.alternate;if(!w){if(w=Ze(_),w===null)throw Error(s(188));return w!==_?null:_}for(var k=_,B=w;;){var Z=k.return;if(Z===null)break;var se=Z.alternate;if(se===null){if(B=Z.return,B!==null){k=B;continue}break}if(Z.child===se.child){for(se=Z.child;se;){if(se===k)return Qt(Z),_;if(se===B)return Qt(Z),w;se=se.sibling}throw Error(s(188))}if(k.return!==B.return)k=Z,B=se;else{for(var we=!1,He=Z.child;He;){if(He===k){we=!0,k=Z,B=se;break}if(He===B){we=!0,B=Z,k=se;break}He=He.sibling}if(!we){for(He=se.child;He;){if(He===k){we=!0,k=se,B=Z;break}if(He===B){we=!0,B=se,k=Z;break}He=He.sibling}if(!we)throw Error(s(189))}}if(k.alternate!==B)throw Error(s(190))}if(k.tag!==3)throw Error(s(188));return k.stateNode.current===k?_:w}function Wt(_){return _=ke(_),_!==null?gn(_):null}function gn(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var w=gn(_);if(w!==null)return w;_=_.sibling}return null}var Un=t.unstable_scheduleCallback,rr=t.unstable_cancelCallback,Hn=t.unstable_shouldYield,ri=t.unstable_requestPaint,mr=t.unstable_now,bi=t.unstable_getCurrentPriorityLevel,Fr=t.unstable_ImmediatePriority,Nr=t.unstable_UserBlockingPriority,ji=t.unstable_NormalPriority,Ui=t.unstable_LowPriority,Ri=t.unstable_IdlePriority,gs=null,hs=null;function yo(_){if(hs&&typeof hs.onCommitFiberRoot=="function")try{hs.onCommitFiberRoot(gs,_,void 0,(_.current.flags&128)===128)}catch{}}var Bo=Math.clz32?Math.clz32:Rf,Gs=Math.log,kc=Math.LN2;function Rf(_){return _>>>=0,_===0?32:31-(Gs(_)/kc|0)|0}var Pc=64,Rc=4194304;function Nc(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function yu(_,w){var k=_.pendingLanes;if(k===0)return 0;var B=0,Z=_.suspendedLanes,se=_.pingedLanes,we=k&268435455;if(we!==0){var He=we&~Z;He!==0?B=Nc(He):(se&=we,se!==0&&(B=Nc(se)))}else we=k&~Z,we!==0?B=Nc(we):se!==0&&(B=Nc(se));if(B===0)return 0;if(w!==0&&w!==B&&(w&Z)===0&&(Z=B&-B,se=w&-w,Z>=se||Z===16&&(se&4194240)!==0))return w;if((B&4)!==0&&(B|=k&16),w=_.entangledLanes,w!==0)for(_=_.entanglements,w&=B;0<w;)k=31-Bo(w),Z=1<<k,B|=_[k],w&=~Z;return B}function _u(_,w){switch(_){case 1:case 2:case 4:return w+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return w+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bd(_,w){for(var k=_.suspendedLanes,B=_.pingedLanes,Z=_.expirationTimes,se=_.pendingLanes;0<se;){var we=31-Bo(se),He=1<<we,Qe=Z[we];Qe===-1?((He&k)===0||(He&B)!==0)&&(Z[we]=_u(He,w)):Qe<=w&&(_.expiredLanes|=He),se&=~He}}function yh(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function Wa(){var _=Pc;return Pc<<=1,(Pc&4194240)===0&&(Pc=64),_}function Vo(_){for(var w=[],k=0;31>k;k++)w.push(_);return w}function Eo(_,w,k){_.pendingLanes|=w,w!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,w=31-Bo(w),_[w]=k}function ec(_,w){var k=_.pendingLanes&~w;_.pendingLanes=w,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=w,_.mutableReadLanes&=w,_.entangledLanes&=w,w=_.entanglements;var B=_.eventTimes;for(_=_.expirationTimes;0<k;){var Z=31-Bo(k),se=1<<Z;w[Z]=0,B[Z]=-1,_[Z]=-1,k&=~se}}function Aa(_,w){var k=_.entangledLanes|=w;for(_=_.entanglements;k;){var B=31-Bo(k),Z=1<<B;Z&w|_[B]&w&&(_[B]|=w),k&=~Z}}var pi=0;function _h(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var ll,xu,Dc,vu,Nf,wd=!1,no=[],ea=null,Za=null,Ia=null,xh=new Map,vh=new Map,Xa=[],Ar="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sd(_,w){switch(_){case"focusin":case"focusout":ea=null;break;case"dragenter":case"dragleave":Za=null;break;case"mouseover":case"mouseout":Ia=null;break;case"pointerover":case"pointerout":xh.delete(w.pointerId);break;case"gotpointercapture":case"lostpointercapture":vh.delete(w.pointerId)}}function Cl(_,w,k,B,Z,se){return _===null||_.nativeEvent!==se?(_={blockedOn:w,domEventName:k,eventSystemFlags:B,nativeEvent:se,targetContainers:[Z]},w!==null&&(w=Vd(w),w!==null&&xu(w)),_):(_.eventSystemFlags|=B,w=_.targetContainers,Z!==null&&w.indexOf(Z)===-1&&w.push(Z),_)}function Td(_,w,k,B,Z){switch(w){case"focusin":return ea=Cl(ea,_,w,k,B,Z),!0;case"dragenter":return Za=Cl(Za,_,w,k,B,Z),!0;case"mouseover":return Ia=Cl(Ia,_,w,k,B,Z),!0;case"pointerover":var se=Z.pointerId;return xh.set(se,Cl(xh.get(se)||null,_,w,k,B,Z)),!0;case"gotpointercapture":return se=Z.pointerId,vh.set(se,Cl(vh.get(se)||null,_,w,k,B,Z)),!0}return!1}function Ig(_){var w=Ou(_.target);if(w!==null){var k=Ze(w);if(k!==null){if(w=k.tag,w===13){if(w=Nt(k),w!==null){_.blockedOn=w,Nf(_.priority,function(){Dc(k)});return}}else if(w===3&&k.stateNode.current.memoizedState.isDehydrated){_.blockedOn=k.tag===3?k.stateNode.containerInfo:null;return}}}_.blockedOn=null}function Oc(_){if(_.blockedOn!==null)return!1;for(var w=_.targetContainers;0<w.length;){var k=Su(_.domEventName,_.eventSystemFlags,w[0],_.nativeEvent);if(k===null){k=_.nativeEvent;var B=new k.constructor(k.type,k);On=B,k.target.dispatchEvent(B),On=null}else return w=Vd(k),w!==null&&xu(w),_.blockedOn=k,!1;w.shift()}return!0}function Lc(_,w,k){Oc(_)&&k.delete(w)}function zc(){wd=!1,ea!==null&&Oc(ea)&&(ea=null),Za!==null&&Oc(Za)&&(Za=null),Ia!==null&&Oc(Ia)&&(Ia=null),xh.forEach(Lc),vh.forEach(Lc)}function bu(_,w){_.blockedOn===w&&(_.blockedOn=null,wd||(wd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,zc)))}function wu(_){function w(Z){return bu(Z,_)}if(0<no.length){bu(no[0],_);for(var k=1;k<no.length;k++){var B=no[k];B.blockedOn===_&&(B.blockedOn=null)}}for(ea!==null&&bu(ea,_),Za!==null&&bu(Za,_),Ia!==null&&bu(Ia,_),xh.forEach(w),vh.forEach(w),k=0;k<Xa.length;k++)B=Xa[k],B.blockedOn===_&&(B.blockedOn=null);for(;0<Xa.length&&(k=Xa[0],k.blockedOn===null);)Ig(k),k.blockedOn===null&&Xa.shift()}var Ka=ht.ReactCurrentBatchConfig,Ed=!0;function tc(_,w,k,B){var Z=pi,se=Ka.transition;Ka.transition=null;try{pi=1,bh(_,w,k,B)}finally{pi=Z,Ka.transition=se}}function Df(_,w,k,B){var Z=pi,se=Ka.transition;Ka.transition=null;try{pi=4,bh(_,w,k,B)}finally{pi=Z,Ka.transition=se}}function bh(_,w,k,B){if(Ed){var Z=Su(_,w,k,B);if(Z===null)Hf(_,w,B,ta,k),Sd(_,B);else if(Td(Z,_,w,k,B))B.stopPropagation();else if(Sd(_,B),w&4&&-1<Ar.indexOf(_)){for(;Z!==null;){var se=Vd(Z);if(se!==null&&ll(se),se=Su(_,w,k,B),se===null&&Hf(_,w,B,ta,k),se===Z)break;Z=se}Z!==null&&B.stopPropagation()}else Hf(_,w,B,null,k)}}var ta=null;function Su(_,w,k,B){if(ta=null,_=ui(B),_=Ou(_),_!==null)if(w=Ze(_),w===null)_=null;else if(k=w.tag,k===13){if(_=Nt(w),_!==null)return _;_=null}else if(k===3){if(w.stateNode.current.memoizedState.isDehydrated)return w.tag===3?w.stateNode.containerInfo:null;_=null}else w!==_&&(_=null);return ta=_,null}function jc(_){switch(_){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bi()){case Fr:return 1;case Nr:return 4;case ji:case Ui:return 16;case Ri:return 536870912;default:return 16}default:return 16}}var cl=null,Cd=null,Tu=null;function Fc(){if(Tu)return Tu;var _,w=Cd,k=w.length,B,Z="value"in cl?cl.value:cl.textContent,se=Z.length;for(_=0;_<k&&w[_]===Z[_];_++);var we=k-_;for(B=1;B<=we&&w[k-B]===Z[se-B];B++);return Tu=Z.slice(_,1<B?1-B:void 0)}function _o(_){var w=_.keyCode;return"charCode"in _?(_=_.charCode,_===0&&w===13&&(_=13)):_=w,_===10&&(_=13),32<=_||_===13?_:0}function wh(){return!0}function Eu(){return!1}function qs(_){function w(k,B,Z,se,we){this._reactName=k,this._targetInst=Z,this.type=B,this.nativeEvent=se,this.target=we,this.currentTarget=null;for(var He in _)_.hasOwnProperty(He)&&(k=_[He],this[He]=k?k(se):se[He]);return this.isDefaultPrevented=(se.defaultPrevented!=null?se.defaultPrevented:se.returnValue===!1)?wh:Eu,this.isPropagationStopped=Eu,this}return Ht(w.prototype,{preventDefault:function(){this.defaultPrevented=!0;var k=this.nativeEvent;k&&(k.preventDefault?k.preventDefault():typeof k.returnValue!="unknown"&&(k.returnValue=!1),this.isDefaultPrevented=wh)},stopPropagation:function(){var k=this.nativeEvent;k&&(k.stopPropagation?k.stopPropagation():typeof k.cancelBubble!="unknown"&&(k.cancelBubble=!0),this.isPropagationStopped=wh)},persist:function(){},isPersistent:wh}),w}var Ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_){return _.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ma=qs(Ir),Ad=Ht({},Ir,{view:0,detail:0}),pm=qs(Ad),Mn,Sh,nc,Al=Ht({},Ad,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Bc,button:0,buttons:0,relatedTarget:function(_){return _.relatedTarget===void 0?_.fromElement===_.srcElement?_.toElement:_.fromElement:_.relatedTarget},movementX:function(_){return"movementX"in _?_.movementX:(_!==nc&&(nc&&_.type==="mousemove"?(Mn=_.screenX-nc.screenX,Sh=_.screenY-nc.screenY):Sh=Mn=0,nc=_),Mn)},movementY:function(_){return"movementY"in _?_.movementY:Sh}}),na=qs(Al),mm=Ht({},Al,{dataTransfer:0}),Th=qs(mm),ln=Ht({},Ad,{relatedTarget:0}),Ur=qs(ln),Br=Ht({},Ir,{animationName:0,elapsedTime:0,pseudoElement:0}),ra=qs(Br),rc=Ht({},Ir,{clipboardData:function(_){return"clipboardData"in _?_.clipboardData:window.clipboardData}}),$r=qs(rc),Of=Ht({},Ir,{data:0}),Eh=qs(Of),Id={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Co={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ds={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gy(_){var w=this.nativeEvent;return w.getModifierState?w.getModifierState(_):(_=ds[_])?!!w[_]:!1}function Bc(){return Gy}var Vc=Ht({},Ad,{key:function(_){if(_.key){var w=Id[_.key]||_.key;if(w!=="Unidentified")return w}return _.type==="keypress"?(_=_o(_),_===13?"Enter":String.fromCharCode(_)):_.type==="keydown"||_.type==="keyup"?Co[_.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Bc,charCode:function(_){return _.type==="keypress"?_o(_):0},keyCode:function(_){return _.type==="keydown"||_.type==="keyup"?_.keyCode:0},which:function(_){return _.type==="keypress"?_o(_):_.type==="keydown"||_.type==="keyup"?_.keyCode:0}}),Md=qs(Vc),Lf=Ht({},Al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ch=qs(Lf),zf=Ht({},Ad,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Bc}),Ao=qs(zf),ic=Ht({},Ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uo=qs(ic),Cu=Ht({},Al,{deltaX:function(_){return"deltaX"in _?_.deltaX:"wheelDeltaX"in _?-_.wheelDeltaX:0},deltaY:function(_){return"deltaY"in _?_.deltaY:"wheelDeltaY"in _?-_.wheelDeltaY:"wheelDelta"in _?-_.wheelDelta:0},deltaZ:0,deltaMode:0}),ar=qs(Cu),Kt=[9,13,27,32],ia=i&&"CompositionEvent"in window,Dn=null;i&&"documentMode"in document&&(Dn=document.documentMode);var as=i&&"TextEvent"in window&&!Dn,Ah=i&&(!ia||Dn&&8<Dn&&11>=Dn),In=" ",Au=!1;function Iu(_,w){switch(_){case"keyup":return Kt.indexOf(w.keyCode)!==-1;case"keydown":return w.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sc(_){return _=_.detail,typeof _=="object"&&"data"in _?_.data:null}var Mu=!1;function Ya(_,w){switch(_){case"compositionend":return sc(w);case"keypress":return w.which!==32?null:(Au=!0,In);case"textInput":return _=w.data,_===In&&Au?null:_;default:return null}}function Io(_,w){if(Mu)return _==="compositionend"||!ia&&Iu(_,w)?(_=Fc(),Tu=Cd=cl=null,Mu=!1,_):null;switch(_){case"paste":return null;case"keypress":if(!(w.ctrlKey||w.altKey||w.metaKey)||w.ctrlKey&&w.altKey){if(w.char&&1<w.char.length)return w.char;if(w.which)return String.fromCharCode(w.which)}return null;case"compositionend":return Ah&&w.locale!=="ko"?null:w.data;default:return null}}var kd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ms(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w==="input"?!!kd[_.type]:w==="textarea"}function jf(_,w,k,B){Ga(B),w=Du(w,"onChange"),0<w.length&&(k=new Ma("onChange","change",null,k,B),_.push({event:k,listeners:w}))}var sa=null,ks=null;function Pd(_){xm(_,0)}function Ff(_){var w=Zc(_);if(ni(w))return _}function qy(_,w){if(_==="change")return w}var oc=!1;if(i){var Uc;if(i){var ac="oninput"in document;if(!ac){var ku=document.createElement("div");ku.setAttribute("oninput","return;"),ac=typeof ku.oninput=="function"}Uc=ac}else Uc=!1;oc=Uc&&(!document.documentMode||9<document.documentMode)}function gm(){sa&&(sa.detachEvent("onpropertychange",Rd),ks=sa=null)}function Rd(_){if(_.propertyName==="value"&&Ff(ks)){var w=[];jf(w,ks,_,ui(_)),Sr(Pd,w)}}function ym(_,w,k){_==="focusin"?(gm(),sa=w,ks=k,sa.attachEvent("onpropertychange",Rd)):_==="focusout"&&gm()}function lc(_){if(_==="selectionchange"||_==="keyup"||_==="keydown")return Ff(ks)}function Wy(_,w){if(_==="click")return Ff(w)}function Zy(_,w){if(_==="input"||_==="change")return Ff(w)}function Mg(_,w){return _===w&&(_!==0||1/_===1/w)||_!==_&&w!==w}var Ja=typeof Object.is=="function"?Object.is:Mg;function ul(_,w){if(Ja(_,w))return!0;if(typeof _!="object"||_===null||typeof w!="object"||w===null)return!1;var k=Object.keys(_),B=Object.keys(w);if(k.length!==B.length)return!1;for(B=0;B<k.length;B++){var Z=k[B];if(!A.call(w,Z)||!Ja(_[Z],w[Z]))return!1}return!0}function Bf(_){for(;_&&_.firstChild;)_=_.firstChild;return _}function _m(_,w){var k=Bf(_);_=0;for(var B;k;){if(k.nodeType===3){if(B=_+k.textContent.length,_<=w&&B>=w)return{node:k,offset:w-_};_=B}e:{for(;k;){if(k.nextSibling){k=k.nextSibling;break e}k=k.parentNode}k=void 0}k=Bf(k)}}function Nd(_,w){return _&&w?_===w?!0:_&&_.nodeType===3?!1:w&&w.nodeType===3?Nd(_,w.parentNode):"contains"in _?_.contains(w):_.compareDocumentPosition?!!(_.compareDocumentPosition(w)&16):!1:!1}function Vf(){for(var _=window,w=Or();w instanceof _.HTMLIFrameElement;){try{var k=typeof w.contentWindow.location.href=="string"}catch{k=!1}if(k)_=w.contentWindow;else break;w=Or(_.document)}return w}function Dd(_){var w=_&&_.nodeName&&_.nodeName.toLowerCase();return w&&(w==="input"&&(_.type==="text"||_.type==="search"||_.type==="tel"||_.type==="url"||_.type==="password")||w==="textarea"||_.contentEditable==="true")}function xo(_){var w=Vf(),k=_.focusedElem,B=_.selectionRange;if(w!==k&&k&&k.ownerDocument&&Nd(k.ownerDocument.documentElement,k)){if(B!==null&&Dd(k)){if(w=B.start,_=B.end,_===void 0&&(_=w),"selectionStart"in k)k.selectionStart=w,k.selectionEnd=Math.min(_,k.value.length);else if(_=(w=k.ownerDocument||document)&&w.defaultView||window,_.getSelection){_=_.getSelection();var Z=k.textContent.length,se=Math.min(B.start,Z);B=B.end===void 0?se:Math.min(B.end,Z),!_.extend&&se>B&&(Z=B,B=se,se=Z),Z=_m(k,se);var we=_m(k,B);Z&&we&&(_.rangeCount!==1||_.anchorNode!==Z.node||_.anchorOffset!==Z.offset||_.focusNode!==we.node||_.focusOffset!==we.offset)&&(w=w.createRange(),w.setStart(Z.node,Z.offset),_.removeAllRanges(),se>B?(_.addRange(w),_.extend(we.node,we.offset)):(w.setEnd(we.node,we.offset),_.addRange(w)))}}for(w=[],_=k;_=_.parentNode;)_.nodeType===1&&w.push({element:_,left:_.scrollLeft,top:_.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<w.length;k++)_=w[k],_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}var Od=i&&"documentMode"in document&&11>=document.documentMode,$c=null,Ld=null,Il=null,Hc=!1;function Uf(_,w,k){var B=k.window===k?k.document:k.nodeType===9?k:k.ownerDocument;Hc||$c==null||$c!==Or(B)||(B=$c,"selectionStart"in B&&Dd(B)?B={start:B.selectionStart,end:B.selectionEnd}:(B=(B.ownerDocument&&B.ownerDocument.defaultView||window).getSelection(),B={anchorNode:B.anchorNode,anchorOffset:B.anchorOffset,focusNode:B.focusNode,focusOffset:B.focusOffset}),Il&&ul(Il,B)||(Il=B,B=Du(Ld,"onSelect"),0<B.length&&(w=new Ma("onSelect","select",null,w,k),_.push({event:w,listeners:B}),w.target=$c)))}function Pu(_,w){var k={};return k[_.toLowerCase()]=w.toLowerCase(),k["Webkit"+_]="webkit"+w,k["Moz"+_]="moz"+w,k}var ro={animationend:Pu("Animation","AnimationEnd"),animationiteration:Pu("Animation","AnimationIteration"),animationstart:Pu("Animation","AnimationStart"),transitionend:Pu("Transition","TransitionEnd")},Ih={},jt={};i&&(jt=document.createElement("div").style,"AnimationEvent"in window||(delete ro.animationend.animation,delete ro.animationiteration.animation,delete ro.animationstart.animation),"TransitionEvent"in window||delete ro.transitionend.transition);function Mh(_){if(Ih[_])return Ih[_];if(!ro[_])return _;var w=ro[_],k;for(k in w)if(w.hasOwnProperty(k)&&k in jt)return Ih[_]=w[k];return _}var Ru=Mh("animationend"),Nu=Mh("animationiteration"),kh=Mh("animationstart"),Ph=Mh("transitionend"),hl=new Map,zd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ws(_,w){hl.set(_,w),m(w,[_])}for(var fr=0;fr<zd.length;fr++){var Gc=zd[fr],Xy=Gc.toLowerCase(),Ky=Gc[0].toUpperCase()+Gc.slice(1);Ws(Xy,"on"+Ky)}Ws(Ru,"onAnimationEnd"),Ws(Nu,"onAnimationIteration"),Ws(kh,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(Ph,"onTransitionEnd"),b("onMouseEnter",["mouseout","mouseover"]),b("onMouseLeave",["mouseout","mouseover"]),b("onPointerEnter",["pointerout","pointerover"]),b("onPointerLeave",["pointerout","pointerover"]),m("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),m("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),m("onBeforeInput",["compositionend","keypress","textInput","paste"]),m("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),m("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yy=new Set("cancel close invalid load scroll toggle".split(" ").concat(qc));function Ni(_,w,k){var B=_.type||"unknown-event";_.currentTarget=k,dt(B,w,void 0,_),_.currentTarget=null}function xm(_,w){w=(w&4)!==0;for(var k=0;k<_.length;k++){var B=_[k],Z=B.event;B=B.listeners;e:{var se=void 0;if(w)for(var we=B.length-1;0<=we;we--){var He=B[we],Qe=He.instance,Et=He.currentTarget;if(He=He.listener,Qe!==se&&Z.isPropagationStopped())break e;Ni(Z,He,Et),se=Qe}else for(we=0;we<B.length;we++){if(He=B[we],Qe=He.instance,Et=He.currentTarget,He=He.listener,Qe!==se&&Z.isPropagationStopped())break e;Ni(Z,He,Et),se=Qe}}}if(ze)throw _=We,ze=!1,We=null,_}function es(_,w){var k=w[Nl];k===void 0&&(k=w[Nl]=new Set);var B=_+"__bubble";k.has(B)||(kg(w,_,2,!1),k.add(B))}function vm(_,w,k){var B=0;w&&(B|=4),kg(k,_,B,w)}var $f="_reactListening"+Math.random().toString(36).slice(2);function jd(_){if(!_[$f]){_[$f]=!0,l.forEach(function(k){k!=="selectionchange"&&(Yy.has(k)||vm(k,!1,_),vm(k,!0,_))});var w=_.nodeType===9?_:_.ownerDocument;w===null||w[$f]||(w[$f]=!0,vm("selectionchange",!1,w))}}function kg(_,w,k,B){switch(jc(w)){case 1:var Z=tc;break;case 4:Z=Df;break;default:Z=bh}k=Z.bind(null,w,k,_),Z=void 0,!le||w!=="touchstart"&&w!=="touchmove"&&w!=="wheel"||(Z=!0),B?Z!==void 0?_.addEventListener(w,k,{capture:!0,passive:Z}):_.addEventListener(w,k,!0):Z!==void 0?_.addEventListener(w,k,{passive:Z}):_.addEventListener(w,k,!1)}function Hf(_,w,k,B,Z){var se=B;if((w&1)===0&&(w&2)===0&&B!==null)e:for(;;){if(B===null)return;var we=B.tag;if(we===3||we===4){var He=B.stateNode.containerInfo;if(He===Z||He.nodeType===8&&He.parentNode===Z)break;if(we===4)for(we=B.return;we!==null;){var Qe=we.tag;if((Qe===3||Qe===4)&&(Qe=we.stateNode.containerInfo,Qe===Z||Qe.nodeType===8&&Qe.parentNode===Z))return;we=we.return}for(;He!==null;){if(we=Ou(He),we===null)return;if(Qe=we.tag,Qe===5||Qe===6){B=se=we;continue e}He=He.parentNode}}B=B.return}Sr(function(){var Et=se,dn=ui(k),mn=[];e:{var an=hl.get(_);if(an!==void 0){var Wn=Ma,tr=_;switch(_){case"keypress":if(_o(k)===0)break e;case"keydown":case"keyup":Wn=Md;break;case"focusin":tr="focus",Wn=Ur;break;case"focusout":tr="blur",Wn=Ur;break;case"beforeblur":case"afterblur":Wn=Ur;break;case"click":if(k.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Wn=na;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Wn=Th;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Wn=Ao;break;case Ru:case Nu:case kh:Wn=ra;break;case Ph:Wn=Uo;break;case"scroll":Wn=pm;break;case"wheel":Wn=ar;break;case"copy":case"cut":case"paste":Wn=$r;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Wn=Ch}var or=(w&4)!==0,Vs=!or&&_==="scroll",yt=or?an!==null?an+"Capture":null:an;or=[];for(var ut=Et,bt;ut!==null;){bt=ut;var Sn=bt.stateNode;if(bt.tag===5&&Sn!==null&&(bt=Sn,yt!==null&&(Sn=Ke(ut,yt),Sn!=null&&or.push(Fd(ut,Sn,bt)))),Vs)break;ut=ut.return}0<or.length&&(an=new Wn(an,tr,null,k,dn),mn.push({event:an,listeners:or}))}}if((w&7)===0){e:{if(an=_==="mouseover"||_==="pointerover",Wn=_==="mouseout"||_==="pointerout",an&&k!==On&&(tr=k.relatedTarget||k.fromElement)&&(Ou(tr)||tr[Rl]))break e;if((Wn||an)&&(an=dn.window===dn?dn:(an=dn.ownerDocument)?an.defaultView||an.parentWindow:window,Wn?(tr=k.relatedTarget||k.toElement,Wn=Et,tr=tr?Ou(tr):null,tr!==null&&(Vs=Ze(tr),tr!==Vs||tr.tag!==5&&tr.tag!==6)&&(tr=null)):(Wn=null,tr=Et),Wn!==tr)){if(or=na,Sn="onMouseLeave",yt="onMouseEnter",ut="mouse",(_==="pointerout"||_==="pointerover")&&(or=Ch,Sn="onPointerLeave",yt="onPointerEnter",ut="pointer"),Vs=Wn==null?an:Zc(Wn),bt=tr==null?an:Zc(tr),an=new or(Sn,ut+"leave",Wn,k,dn),an.target=Vs,an.relatedTarget=bt,Sn=null,Ou(dn)===Et&&(or=new or(yt,ut+"enter",tr,k,dn),or.target=bt,or.relatedTarget=Vs,Sn=or),Vs=Sn,Wn&&tr)t:{for(or=Wn,yt=tr,ut=0,bt=or;bt;bt=Rh(bt))ut++;for(bt=0,Sn=yt;Sn;Sn=Rh(Sn))bt++;for(;0<ut-bt;)or=Rh(or),ut--;for(;0<bt-ut;)yt=Rh(yt),bt--;for(;ut--;){if(or===yt||yt!==null&&or===yt.alternate)break t;or=Rh(or),yt=Rh(yt)}or=null}else or=null;Wn!==null&&bm(mn,an,Wn,or,!1),tr!==null&&Vs!==null&&bm(mn,Vs,tr,or,!0)}}e:{if(an=Et?Zc(Et):window,Wn=an.nodeName&&an.nodeName.toLowerCase(),Wn==="select"||Wn==="input"&&an.type==="file")var dr=qy;else if(Ms(an))if(oc)dr=Zy;else{dr=lc;var pr=ym}else(Wn=an.nodeName)&&Wn.toLowerCase()==="input"&&(an.type==="checkbox"||an.type==="radio")&&(dr=Wy);if(dr&&(dr=dr(_,Et))){jf(mn,dr,k,dn);break e}pr&&pr(_,an,Et),_==="focusout"&&(pr=an._wrapperState)&&pr.controlled&&an.type==="number"&&zi(an,"number",an.value)}switch(pr=Et?Zc(Et):window,_){case"focusin":(Ms(pr)||pr.contentEditable==="true")&&($c=pr,Ld=Et,Il=null);break;case"focusout":Il=Ld=$c=null;break;case"mousedown":Hc=!0;break;case"contextmenu":case"mouseup":case"dragend":Hc=!1,Uf(mn,k,dn);break;case"selectionchange":if(Od)break;case"keydown":case"keyup":Uf(mn,k,dn)}var Er;if(ia)e:{switch(_){case"compositionstart":var zr="onCompositionStart";break e;case"compositionend":zr="onCompositionEnd";break e;case"compositionupdate":zr="onCompositionUpdate";break e}zr=void 0}else Mu?Iu(_,k)&&(zr="onCompositionEnd"):_==="keydown"&&k.keyCode===229&&(zr="onCompositionStart");zr&&(Ah&&k.locale!=="ko"&&(Mu||zr!=="onCompositionStart"?zr==="onCompositionEnd"&&Mu&&(Er=Fc()):(cl=dn,Cd="value"in cl?cl.value:cl.textContent,Mu=!0)),pr=Du(Et,zr),0<pr.length&&(zr=new Eh(zr,_,null,k,dn),mn.push({event:zr,listeners:pr}),Er?zr.data=Er:(Er=sc(k),Er!==null&&(zr.data=Er)))),(Er=as?Ya(_,k):Io(_,k))&&(Et=Du(Et,"onBeforeInput"),0<Et.length&&(dn=new Eh("onBeforeInput","beforeinput",null,k,dn),mn.push({event:dn,listeners:Et}),dn.data=Er))}xm(mn,w)})}function Fd(_,w,k){return{instance:_,listener:w,currentTarget:k}}function Du(_,w){for(var k=w+"Capture",B=[];_!==null;){var Z=_,se=Z.stateNode;Z.tag===5&&se!==null&&(Z=se,se=Ke(_,k),se!=null&&B.unshift(Fd(_,se,Z)),se=Ke(_,w),se!=null&&B.push(Fd(_,se,Z))),_=_.return}return B}function Rh(_){if(_===null)return null;do _=_.return;while(_&&_.tag!==5);return _||null}function bm(_,w,k,B,Z){for(var se=w._reactName,we=[];k!==null&&k!==B;){var He=k,Qe=He.alternate,Et=He.stateNode;if(Qe!==null&&Qe===B)break;He.tag===5&&Et!==null&&(He=Et,Z?(Qe=Ke(k,se),Qe!=null&&we.unshift(Fd(k,Qe,He))):Z||(Qe=Ke(k,se),Qe!=null&&we.push(Fd(k,Qe,He)))),k=k.return}we.length!==0&&_.push({event:w,listeners:we})}var wm=/\r\n?/g,Gf=/\u0000|\uFFFD/g;function qf(_){return(typeof _=="string"?_:""+_).replace(wm,`
`).replace(Gf,"")}function Ml(_,w,k){if(w=qf(w),qf(_)!==w&&k)throw Error(s(425))}function cc(){}var Nh=null,Dh=null;function Wc(_,w){return _==="textarea"||_==="noscript"||typeof w.children=="string"||typeof w.children=="number"||typeof w.dangerouslySetInnerHTML=="object"&&w.dangerouslySetInnerHTML!==null&&w.dangerouslySetInnerHTML.__html!=null}var Wf=typeof setTimeout=="function"?setTimeout:void 0,Sm=typeof clearTimeout=="function"?clearTimeout:void 0,Tm=typeof Promise=="function"?Promise:void 0,Oh=typeof queueMicrotask=="function"?queueMicrotask:typeof Tm<"u"?function(_){return Tm.resolve(null).then(_).catch(Zf)}:Wf;function Zf(_){setTimeout(function(){throw _})}function Lh(_,w){var k=w,B=0;do{var Z=k.nextSibling;if(_.removeChild(k),Z&&Z.nodeType===8)if(k=Z.data,k==="/$"){if(B===0){_.removeChild(Z),wu(w);return}B--}else k!=="$"&&k!=="$?"&&k!=="$!"||B++;k=Z}while(k);wu(w)}function kl(_){for(;_!=null;_=_.nextSibling){var w=_.nodeType;if(w===1||w===3)break;if(w===8){if(w=_.data,w==="$"||w==="$!"||w==="$?")break;if(w==="/$")return null}}return _}function Bd(_){_=_.previousSibling;for(var w=0;_;){if(_.nodeType===8){var k=_.data;if(k==="$"||k==="$!"||k==="$?"){if(w===0)return _;w--}else k==="/$"&&w++}_=_.previousSibling}return null}var Pl=Math.random().toString(36).slice(2),dl="__reactFiber$"+Pl,zh="__reactProps$"+Pl,Rl="__reactContainer$"+Pl,Nl="__reactEvents$"+Pl,Pg="__reactListeners$"+Pl,Rg="__reactHandles$"+Pl;function Ou(_){var w=_[dl];if(w)return w;for(var k=_.parentNode;k;){if(w=k[Rl]||k[dl]){if(k=w.alternate,w.child!==null||k!==null&&k.child!==null)for(_=Bd(_);_!==null;){if(k=_[dl])return k;_=Bd(_)}return w}_=k,k=_.parentNode}return null}function Vd(_){return _=_[dl]||_[Rl],!_||_.tag!==5&&_.tag!==6&&_.tag!==13&&_.tag!==3?null:_}function Zc(_){if(_.tag===5||_.tag===6)return _.stateNode;throw Error(s(33))}function Lu(_){return _[zh]||null}var jh=[],ka=-1;function Dl(_){return{current:_}}function ts(_){0>ka||(_.current=jh[ka],jh[ka]=null,ka--)}function ns(_,w){ka++,jh[ka]=_.current,_.current=w}var oa={},bs=Dl(oa),$o=Dl(!1),Zs=oa;function uc(_,w){var k=_.type.contextTypes;if(!k)return oa;var B=_.stateNode;if(B&&B.__reactInternalMemoizedUnmaskedChildContext===w)return B.__reactInternalMemoizedMaskedChildContext;var Z={},se;for(se in k)Z[se]=w[se];return B&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=w,_.__reactInternalMemoizedMaskedChildContext=Z),Z}function io(_){return _=_.childContextTypes,_!=null}function zu(){ts($o),ts(bs)}function Xf(_,w,k){if(bs.current!==oa)throw Error(s(168));ns(bs,w),ns($o,k)}function Kf(_,w,k){var B=_.stateNode;if(w=w.childContextTypes,typeof B.getChildContext!="function")return k;B=B.getChildContext();for(var Z in B)if(!(Z in w))throw Error(s(108,un(_)||"Unknown",Z));return Ht({},k,B)}function ju(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||oa,Zs=bs.current,ns(bs,_),ns($o,$o.current),!0}function Fh(_,w,k){var B=_.stateNode;if(!B)throw Error(s(169));k?(_=Kf(_,w,Zs),B.__reactInternalMemoizedMergedChildContext=_,ts($o),ts(bs),ns(bs,_)):ts($o),ns($o,k)}var aa=null,Bh=!1,Fu=!1;function Em(_){aa===null?aa=[_]:aa.push(_)}function Ng(_){Bh=!0,Em(_)}function la(){if(!Fu&&aa!==null){Fu=!0;var _=0,w=pi;try{var k=aa;for(pi=1;_<k.length;_++){var B=k[_];do B=B(!0);while(B!==null)}aa=null,Bh=!1}catch(Z){throw aa!==null&&(aa=aa.slice(_+1)),Un(Fr,la),Z}finally{pi=w,Fu=!1}}return null}var Bu=[],Vh=0,Yf=null,Jf=0,Ho=[],Qa=0,Ol=null,fl=1,Ll="";function Pa(_,w){Bu[Vh++]=Jf,Bu[Vh++]=Yf,Yf=_,Jf=w}function Qf(_,w,k){Ho[Qa++]=fl,Ho[Qa++]=Ll,Ho[Qa++]=Ol,Ol=_;var B=fl;_=Ll;var Z=32-Bo(B)-1;B&=~(1<<Z),k+=1;var se=32-Bo(w)+Z;if(30<se){var we=Z-Z%5;se=(B&(1<<we)-1).toString(32),B>>=we,Z-=we,fl=1<<32-Bo(w)+Z|k<<Z|B,Ll=se+_}else fl=1<<se|k<<Z|B,Ll=_}function Ud(_){_.return!==null&&(Pa(_,1),Qf(_,1,0))}function ep(_){for(;_===Yf;)Yf=Bu[--Vh],Bu[Vh]=null,Jf=Bu[--Vh],Bu[Vh]=null;for(;_===Ol;)Ol=Ho[--Qa],Ho[Qa]=null,Ll=Ho[--Qa],Ho[Qa]=null,fl=Ho[--Qa],Ho[Qa]=null}var Ls=null,Xs=null,ls=!1,so=null;function $d(_,w){var k=ws(5,null,null,0);k.elementType="DELETED",k.stateNode=w,k.return=_,w=_.deletions,w===null?(_.deletions=[k],_.flags|=16):w.push(k)}function Uh(_,w){switch(_.tag){case 5:var k=_.type;return w=w.nodeType!==1||k.toLowerCase()!==w.nodeName.toLowerCase()?null:w,w!==null?(_.stateNode=w,Ls=_,Xs=kl(w.firstChild),!0):!1;case 6:return w=_.pendingProps===""||w.nodeType!==3?null:w,w!==null?(_.stateNode=w,Ls=_,Xs=null,!0):!1;case 13:return w=w.nodeType!==8?null:w,w!==null?(k=Ol!==null?{id:fl,overflow:Ll}:null,_.memoizedState={dehydrated:w,treeContext:k,retryLane:1073741824},k=ws(18,null,null,0),k.stateNode=w,k.return=_,_.child=k,Ls=_,Xs=null,!0):!1;default:return!1}}function Hd(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Gd(_){if(ls){var w=Xs;if(w){var k=w;if(!Uh(_,w)){if(Hd(_))throw Error(s(418));w=kl(k.nextSibling);var B=Ls;w&&Uh(_,w)?$d(B,k):(_.flags=_.flags&-4097|2,ls=!1,Ls=_)}}else{if(Hd(_))throw Error(s(418));_.flags=_.flags&-4097|2,ls=!1,Ls=_}}}function $h(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;Ls=_}function Xc(_){if(_!==Ls)return!1;if(!ls)return $h(_),ls=!0,!1;var w;if((w=_.tag!==3)&&!(w=_.tag!==5)&&(w=_.type,w=w!=="head"&&w!=="body"&&!Wc(_.type,_.memoizedProps)),w&&(w=Xs)){if(Hd(_))throw Cm(),Error(s(418));for(;w;)$d(_,w),w=kl(w.nextSibling)}if($h(_),_.tag===13){if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));e:{for(_=_.nextSibling,w=0;_;){if(_.nodeType===8){var k=_.data;if(k==="/$"){if(w===0){Xs=kl(_.nextSibling);break e}w--}else k!=="$"&&k!=="$!"&&k!=="$?"||w++}_=_.nextSibling}Xs=null}}else Xs=Ls?kl(_.stateNode.nextSibling):null;return!0}function Cm(){for(var _=Xs;_;)_=kl(_.nextSibling)}function Vu(){Xs=Ls=null,ls=!1}function ca(_){so===null?so=[_]:so.push(_)}var Jy=ht.ReactCurrentBatchConfig;function qd(_,w,k){if(_=k.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(k._owner){if(k=k._owner,k){if(k.tag!==1)throw Error(s(309));var B=k.stateNode}if(!B)throw Error(s(147,_));var Z=B,se=""+_;return w!==null&&w.ref!==null&&typeof w.ref=="function"&&w.ref._stringRef===se?w.ref:(w=function(we){var He=Z.refs;we===null?delete He[se]:He[se]=we},w._stringRef=se,w)}if(typeof _!="string")throw Error(s(284));if(!k._owner)throw Error(s(290,_))}return _}function Hh(_,w){throw _=Object.prototype.toString.call(w),Error(s(31,_==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":_))}function Dg(_){var w=_._init;return w(_._payload)}function Uu(_){function w(yt,ut){if(_){var bt=yt.deletions;bt===null?(yt.deletions=[ut],yt.flags|=16):bt.push(ut)}}function k(yt,ut){if(!_)return null;for(;ut!==null;)w(yt,ut),ut=ut.sibling;return null}function B(yt,ut){for(yt=new Map;ut!==null;)ut.key!==null?yt.set(ut.key,ut):yt.set(ut.index,ut),ut=ut.sibling;return yt}function Z(yt,ut){return yt=Ko(yt,ut),yt.index=0,yt.sibling=null,yt}function se(yt,ut,bt){return yt.index=bt,_?(bt=yt.alternate,bt!==null?(bt=bt.index,bt<ut?(yt.flags|=2,ut):bt):(yt.flags|=2,ut)):(yt.flags|=1048576,ut)}function we(yt){return _&&yt.alternate===null&&(yt.flags|=2),yt}function He(yt,ut,bt,Sn){return ut===null||ut.tag!==6?(ut=uf(bt,yt.mode,Sn),ut.return=yt,ut):(ut=Z(ut,bt),ut.return=yt,ut)}function Qe(yt,ut,bt,Sn){var dr=bt.type;return dr===kt?dn(yt,ut,bt.props.children,Sn,bt.key):ut!==null&&(ut.elementType===dr||typeof dr=="object"&&dr!==null&&dr.$$typeof===Yt&&Dg(dr)===ut.type)?(Sn=Z(ut,bt.props),Sn.ref=qd(yt,ut,bt),Sn.return=yt,Sn):(Sn=fa(bt.type,bt.key,bt.props,null,yt.mode,Sn),Sn.ref=qd(yt,ut,bt),Sn.return=yt,Sn)}function Et(yt,ut,bt,Sn){return ut===null||ut.tag!==4||ut.stateNode.containerInfo!==bt.containerInfo||ut.stateNode.implementation!==bt.implementation?(ut=ou(bt,yt.mode,Sn),ut.return=yt,ut):(ut=Z(ut,bt.children||[]),ut.return=yt,ut)}function dn(yt,ut,bt,Sn,dr){return ut===null||ut.tag!==7?(ut=pa(bt,yt.mode,Sn,dr),ut.return=yt,ut):(ut=Z(ut,bt),ut.return=yt,ut)}function mn(yt,ut,bt){if(typeof ut=="string"&&ut!==""||typeof ut=="number")return ut=uf(""+ut,yt.mode,bt),ut.return=yt,ut;if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case at:return bt=fa(ut.type,ut.key,ut.props,null,yt.mode,bt),bt.ref=qd(yt,null,ut),bt.return=yt,bt;case Dt:return ut=ou(ut,yt.mode,bt),ut.return=yt,ut;case Yt:var Sn=ut._init;return mn(yt,Sn(ut._payload),bt)}if(Ki(ut)||Jt(ut))return ut=pa(ut,yt.mode,bt,null),ut.return=yt,ut;Hh(yt,ut)}return null}function an(yt,ut,bt,Sn){var dr=ut!==null?ut.key:null;if(typeof bt=="string"&&bt!==""||typeof bt=="number")return dr!==null?null:He(yt,ut,""+bt,Sn);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case at:return bt.key===dr?Qe(yt,ut,bt,Sn):null;case Dt:return bt.key===dr?Et(yt,ut,bt,Sn):null;case Yt:return dr=bt._init,an(yt,ut,dr(bt._payload),Sn)}if(Ki(bt)||Jt(bt))return dr!==null?null:dn(yt,ut,bt,Sn,null);Hh(yt,bt)}return null}function Wn(yt,ut,bt,Sn,dr){if(typeof Sn=="string"&&Sn!==""||typeof Sn=="number")return yt=yt.get(bt)||null,He(ut,yt,""+Sn,dr);if(typeof Sn=="object"&&Sn!==null){switch(Sn.$$typeof){case at:return yt=yt.get(Sn.key===null?bt:Sn.key)||null,Qe(ut,yt,Sn,dr);case Dt:return yt=yt.get(Sn.key===null?bt:Sn.key)||null,Et(ut,yt,Sn,dr);case Yt:var pr=Sn._init;return Wn(yt,ut,bt,pr(Sn._payload),dr)}if(Ki(Sn)||Jt(Sn))return yt=yt.get(bt)||null,dn(ut,yt,Sn,dr,null);Hh(ut,Sn)}return null}function tr(yt,ut,bt,Sn){for(var dr=null,pr=null,Er=ut,zr=ut=0,vo=null;Er!==null&&zr<bt.length;zr++){Er.index>zr?(vo=Er,Er=null):vo=Er.sibling;var Zi=an(yt,Er,bt[zr],Sn);if(Zi===null){Er===null&&(Er=vo);break}_&&Er&&Zi.alternate===null&&w(yt,Er),ut=se(Zi,ut,zr),pr===null?dr=Zi:pr.sibling=Zi,pr=Zi,Er=vo}if(zr===bt.length)return k(yt,Er),ls&&Pa(yt,zr),dr;if(Er===null){for(;zr<bt.length;zr++)Er=mn(yt,bt[zr],Sn),Er!==null&&(ut=se(Er,ut,zr),pr===null?dr=Er:pr.sibling=Er,pr=Er);return ls&&Pa(yt,zr),dr}for(Er=B(yt,Er);zr<bt.length;zr++)vo=Wn(Er,yt,zr,bt[zr],Sn),vo!==null&&(_&&vo.alternate!==null&&Er.delete(vo.key===null?zr:vo.key),ut=se(vo,ut,zr),pr===null?dr=vo:pr.sibling=vo,pr=vo);return _&&Er.forEach(function(sd){return w(yt,sd)}),ls&&Pa(yt,zr),dr}function or(yt,ut,bt,Sn){var dr=Jt(bt);if(typeof dr!="function")throw Error(s(150));if(bt=dr.call(bt),bt==null)throw Error(s(151));for(var pr=dr=null,Er=ut,zr=ut=0,vo=null,Zi=bt.next();Er!==null&&!Zi.done;zr++,Zi=bt.next()){Er.index>zr?(vo=Er,Er=null):vo=Er.sibling;var sd=an(yt,Er,Zi.value,Sn);if(sd===null){Er===null&&(Er=vo);break}_&&Er&&sd.alternate===null&&w(yt,Er),ut=se(sd,ut,zr),pr===null?dr=sd:pr.sibling=sd,pr=sd,Er=vo}if(Zi.done)return k(yt,Er),ls&&Pa(yt,zr),dr;if(Er===null){for(;!Zi.done;zr++,Zi=bt.next())Zi=mn(yt,Zi.value,Sn),Zi!==null&&(ut=se(Zi,ut,zr),pr===null?dr=Zi:pr.sibling=Zi,pr=Zi);return ls&&Pa(yt,zr),dr}for(Er=B(yt,Er);!Zi.done;zr++,Zi=bt.next())Zi=Wn(Er,yt,zr,Zi.value,Sn),Zi!==null&&(_&&Zi.alternate!==null&&Er.delete(Zi.key===null?zr:Zi.key),ut=se(Zi,ut,zr),pr===null?dr=Zi:pr.sibling=Zi,pr=Zi);return _&&Er.forEach(function(N1){return w(yt,N1)}),ls&&Pa(yt,zr),dr}function Vs(yt,ut,bt,Sn){if(typeof bt=="object"&&bt!==null&&bt.type===kt&&bt.key===null&&(bt=bt.props.children),typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case at:e:{for(var dr=bt.key,pr=ut;pr!==null;){if(pr.key===dr){if(dr=bt.type,dr===kt){if(pr.tag===7){k(yt,pr.sibling),ut=Z(pr,bt.props.children),ut.return=yt,yt=ut;break e}}else if(pr.elementType===dr||typeof dr=="object"&&dr!==null&&dr.$$typeof===Yt&&Dg(dr)===pr.type){k(yt,pr.sibling),ut=Z(pr,bt.props),ut.ref=qd(yt,pr,bt),ut.return=yt,yt=ut;break e}k(yt,pr);break}else w(yt,pr);pr=pr.sibling}bt.type===kt?(ut=pa(bt.props.children,yt.mode,Sn,bt.key),ut.return=yt,yt=ut):(Sn=fa(bt.type,bt.key,bt.props,null,yt.mode,Sn),Sn.ref=qd(yt,ut,bt),Sn.return=yt,yt=Sn)}return we(yt);case Dt:e:{for(pr=bt.key;ut!==null;){if(ut.key===pr)if(ut.tag===4&&ut.stateNode.containerInfo===bt.containerInfo&&ut.stateNode.implementation===bt.implementation){k(yt,ut.sibling),ut=Z(ut,bt.children||[]),ut.return=yt,yt=ut;break e}else{k(yt,ut);break}else w(yt,ut);ut=ut.sibling}ut=ou(bt,yt.mode,Sn),ut.return=yt,yt=ut}return we(yt);case Yt:return pr=bt._init,Vs(yt,ut,pr(bt._payload),Sn)}if(Ki(bt))return tr(yt,ut,bt,Sn);if(Jt(bt))return or(yt,ut,bt,Sn);Hh(yt,bt)}return typeof bt=="string"&&bt!==""||typeof bt=="number"?(bt=""+bt,ut!==null&&ut.tag===6?(k(yt,ut.sibling),ut=Z(ut,bt),ut.return=yt,yt=ut):(k(yt,ut),ut=uf(bt,yt.mode,Sn),ut.return=yt,yt=ut),we(yt)):k(yt,ut)}return Vs}var hc=Uu(!0),zl=Uu(!1),Kc=Dl(null),Yc=null,$u=null,Jc=null;function Qc(){Jc=$u=Yc=null}function Gh(_){var w=Kc.current;ts(Kc),_._currentValue=w}function Wd(_,w,k){for(;_!==null;){var B=_.alternate;if((_.childLanes&w)!==w?(_.childLanes|=w,B!==null&&(B.childLanes|=w)):B!==null&&(B.childLanes&w)!==w&&(B.childLanes|=w),_===k)break;_=_.return}}function eu(_,w){Yc=_,Jc=$u=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&w)!==0&&(ko=!0),_.firstContext=null)}function zs(_){var w=_._currentValue;if(Jc!==_)if(_={context:_,memoizedValue:w,next:null},$u===null){if(Yc===null)throw Error(s(308));$u=_,Yc.dependencies={lanes:0,firstContext:_}}else $u=$u.next=_;return w}var Go=null;function Zt(_){Go===null?Go=[_]:Go.push(_)}function Am(_,w,k,B){var Z=w.interleaved;return Z===null?(k.next=k,Zt(w)):(k.next=Z.next,Z.next=k),w.interleaved=k,jl(_,B)}function jl(_,w){_.lanes|=w;var k=_.alternate;for(k!==null&&(k.lanes|=w),k=_,_=_.return;_!==null;)_.childLanes|=w,k=_.alternate,k!==null&&(k.childLanes|=w),k=_,_=_.return;return k.tag===3?k.stateNode:null}var qo=!1;function Fl(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vn(_,w){_=_.updateQueue,w.updateQueue===_&&(w.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Ra(_,w){return{eventTime:_,lane:w,tag:0,payload:null,callback:null,next:null}}function tu(_,w,k){var B=_.updateQueue;if(B===null)return null;if(B=B.shared,(J&2)!==0){var Z=B.pending;return Z===null?w.next=w:(w.next=Z.next,Z.next=w),B.pending=w,jl(_,k)}return Z=B.interleaved,Z===null?(w.next=w,Zt(B)):(w.next=Z.next,Z.next=w),B.interleaved=w,jl(_,k)}function tp(_,w,k){if(w=w.updateQueue,w!==null&&(w=w.shared,(k&4194240)!==0)){var B=w.lanes;B&=_.pendingLanes,k|=B,w.lanes=k,Aa(_,k)}}function np(_,w){var k=_.updateQueue,B=_.alternate;if(B!==null&&(B=B.updateQueue,k===B)){var Z=null,se=null;if(k=k.firstBaseUpdate,k!==null){do{var we={eventTime:k.eventTime,lane:k.lane,tag:k.tag,payload:k.payload,callback:k.callback,next:null};se===null?Z=se=we:se=se.next=we,k=k.next}while(k!==null);se===null?Z=se=w:se=se.next=w}else Z=se=w;k={baseState:B.baseState,firstBaseUpdate:Z,lastBaseUpdate:se,shared:B.shared,effects:B.effects},_.updateQueue=k;return}_=k.lastBaseUpdate,_===null?k.firstBaseUpdate=w:_.next=w,k.lastBaseUpdate=w}function Zd(_,w,k,B){var Z=_.updateQueue;qo=!1;var se=Z.firstBaseUpdate,we=Z.lastBaseUpdate,He=Z.shared.pending;if(He!==null){Z.shared.pending=null;var Qe=He,Et=Qe.next;Qe.next=null,we===null?se=Et:we.next=Et,we=Qe;var dn=_.alternate;dn!==null&&(dn=dn.updateQueue,He=dn.lastBaseUpdate,He!==we&&(He===null?dn.firstBaseUpdate=Et:He.next=Et,dn.lastBaseUpdate=Qe))}if(se!==null){var mn=Z.baseState;we=0,dn=Et=Qe=null,He=se;do{var an=He.lane,Wn=He.eventTime;if((B&an)===an){dn!==null&&(dn=dn.next={eventTime:Wn,lane:0,tag:He.tag,payload:He.payload,callback:He.callback,next:null});e:{var tr=_,or=He;switch(an=w,Wn=k,or.tag){case 1:if(tr=or.payload,typeof tr=="function"){mn=tr.call(Wn,mn,an);break e}mn=tr;break e;case 3:tr.flags=tr.flags&-65537|128;case 0:if(tr=or.payload,an=typeof tr=="function"?tr.call(Wn,mn,an):tr,an==null)break e;mn=Ht({},mn,an);break e;case 2:qo=!0}}He.callback!==null&&He.lane!==0&&(_.flags|=64,an=Z.effects,an===null?Z.effects=[He]:an.push(He))}else Wn={eventTime:Wn,lane:an,tag:He.tag,payload:He.payload,callback:He.callback,next:null},dn===null?(Et=dn=Wn,Qe=mn):dn=dn.next=Wn,we|=an;if(He=He.next,He===null){if(He=Z.shared.pending,He===null)break;an=He,He=an.next,an.next=null,Z.lastBaseUpdate=an,Z.shared.pending=null}}while(!0);if(dn===null&&(Qe=mn),Z.baseState=Qe,Z.firstBaseUpdate=Et,Z.lastBaseUpdate=dn,w=Z.shared.interleaved,w!==null){Z=w;do we|=Z.lane,Z=Z.next;while(Z!==w)}else se===null&&(Z.shared.lanes=0);Te|=we,_.lanes=we,_.memoizedState=mn}}function Og(_,w,k){if(_=w.effects,w.effects=null,_!==null)for(w=0;w<_.length;w++){var B=_[w],Z=B.callback;if(Z!==null){if(B.callback=null,B=k,typeof Z!="function")throw Error(s(191,Z));Z.call(B)}}}var qh={},Bl=Dl(qh),Xd=Dl(qh),oo=Dl(qh);function dc(_){if(_===qh)throw Error(s(174));return _}function ao(_,w){switch(ns(oo,w),ns(Xd,_),ns(Bl,qh),_=w.nodeType,_){case 9:case 11:w=(w=w.documentElement)?w.namespaceURI:is(null,"");break;default:_=_===8?w.parentNode:w,w=_.namespaceURI||null,_=_.tagName,w=is(w,_)}ts(Bl),ns(Bl,w)}function ua(){ts(Bl),ts(Xd),ts(oo)}function nu(_){dc(oo.current);var w=dc(Bl.current),k=is(w,_.type);w!==k&&(ns(Xd,_),ns(Bl,k))}function Wh(_){Xd.current===_&&(ts(Bl),ts(Xd))}var rs=Dl(0);function fc(_){for(var w=_;w!==null;){if(w.tag===13){var k=w.memoizedState;if(k!==null&&(k=k.dehydrated,k===null||k.data==="$?"||k.data==="$!"))return w}else if(w.tag===19&&w.memoizedProps.revealOrder!==void 0){if((w.flags&128)!==0)return w}else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return null;w=w.return}w.sibling.return=w.return,w=w.sibling}return null}var rp=[];function pl(){for(var _=0;_<rp.length;_++)rp[_]._workInProgressVersionPrimary=null;rp.length=0}var Hr=ht.ReactCurrentDispatcher,Hu=ht.ReactCurrentBatchConfig,ha=0,fs=null,js=null,Ks=null,ip=!1,Vl=!1,ml=0,Tt=0;function zt(){throw Error(s(321))}function pc(_,w){if(w===null)return!1;for(var k=0;k<w.length&&k<_.length;k++)if(!Ja(_[k],w[k]))return!1;return!0}function Di(_,w,k,B,Z,se){if(ha=se,fs=w,w.memoizedState=null,w.updateQueue=null,w.lanes=0,Hr.current=_===null||_.memoizedState===null?Qd:dp,_=k(B,Z),Vl){se=0;do{if(Vl=!1,ml=0,25<=se)throw Error(s(301));se+=1,Ks=js=null,w.updateQueue=null,Hr.current=Jh,_=k(B,Z)}while(Vl)}if(Hr.current=yl,w=js!==null&&js.next!==null,ha=0,Ks=js=fs=null,ip=!1,w)throw Error(s(300));return _}function $e(){var _=ml!==0;return ml=0,_}function Fs(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ks===null?fs.memoizedState=Ks=_:Ks=Ks.next=_,Ks}function Wo(){if(js===null){var _=fs.alternate;_=_!==null?_.memoizedState:null}else _=js.next;var w=Ks===null?fs.memoizedState:Ks.next;if(w!==null)Ks=w,js=_;else{if(_===null)throw Error(s(310));js=_,_={memoizedState:js.memoizedState,baseState:js.baseState,baseQueue:js.baseQueue,queue:js.queue,next:null},Ks===null?fs.memoizedState=Ks=_:Ks=Ks.next=_}return Ks}function ru(_,w){return typeof w=="function"?w(_):w}function Kd(_){var w=Wo(),k=w.queue;if(k===null)throw Error(s(311));k.lastRenderedReducer=_;var B=js,Z=B.baseQueue,se=k.pending;if(se!==null){if(Z!==null){var we=Z.next;Z.next=se.next,se.next=we}B.baseQueue=Z=se,k.pending=null}if(Z!==null){se=Z.next,B=B.baseState;var He=we=null,Qe=null,Et=se;do{var dn=Et.lane;if((ha&dn)===dn)Qe!==null&&(Qe=Qe.next={lane:0,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null}),B=Et.hasEagerState?Et.eagerState:_(B,Et.action);else{var mn={lane:dn,action:Et.action,hasEagerState:Et.hasEagerState,eagerState:Et.eagerState,next:null};Qe===null?(He=Qe=mn,we=B):Qe=Qe.next=mn,fs.lanes|=dn,Te|=dn}Et=Et.next}while(Et!==null&&Et!==se);Qe===null?we=B:Qe.next=He,Ja(B,w.memoizedState)||(ko=!0),w.memoizedState=B,w.baseState=we,w.baseQueue=Qe,k.lastRenderedState=B}if(_=k.interleaved,_!==null){Z=_;do se=Z.lane,fs.lanes|=se,Te|=se,Z=Z.next;while(Z!==_)}else Z===null&&(k.lanes=0);return[w.memoizedState,k.dispatch]}function sp(_){var w=Wo(),k=w.queue;if(k===null)throw Error(s(311));k.lastRenderedReducer=_;var B=k.dispatch,Z=k.pending,se=w.memoizedState;if(Z!==null){k.pending=null;var we=Z=Z.next;do se=_(se,we.action),we=we.next;while(we!==Z);Ja(se,w.memoizedState)||(ko=!0),w.memoizedState=se,w.baseQueue===null&&(w.baseState=se),k.lastRenderedState=se}return[se,B]}function Im(){}function Gu(_,w){var k=fs,B=Wo(),Z=w(),se=!Ja(B.memoizedState,Z);if(se&&(B.memoizedState=Z,ko=!0),B=B.queue,$l(Mm.bind(null,k,B,_),[_]),B.getSnapshot!==w||se||Ks!==null&&Ks.memoizedState.tag&1){if(k.flags|=2048,Zh(9,zg.bind(null,k,B,Z,w),void 0,null),ie===null)throw Error(s(349));(ha&30)!==0||Lg(k,w,Z)}return Z}function Lg(_,w,k){_.flags|=16384,_={getSnapshot:w,value:k},w=fs.updateQueue,w===null?(w={lastEffect:null,stores:null},fs.updateQueue=w,w.stores=[_]):(k=w.stores,k===null?w.stores=[_]:k.push(_))}function zg(_,w,k,B){w.value=k,w.getSnapshot=B,Yd(w)&&op(_)}function Mm(_,w,k){return k(function(){Yd(w)&&op(_)})}function Yd(_){var w=_.getSnapshot;_=_.value;try{var k=w();return!Ja(_,k)}catch{return!0}}function op(_){var w=jl(_,1);w!==null&&Bt(w,_,1,-1)}function ap(_){var w=Fs();return typeof _=="function"&&(_=_()),w.memoizedState=w.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ru,lastRenderedState:_},w.queue=_,_=_.dispatch=up.bind(null,fs,_),[w.memoizedState,_]}function Zh(_,w,k,B){return _={tag:_,create:w,destroy:k,deps:B,next:null},w=fs.updateQueue,w===null?(w={lastEffect:null,stores:null},fs.updateQueue=w,w.lastEffect=_.next=_):(k=w.lastEffect,k===null?w.lastEffect=_.next=_:(B=k.next,k.next=_,_.next=B,w.lastEffect=_)),_}function Jd(){return Wo().memoizedState}function iu(_,w,k,B){var Z=Fs();fs.flags|=_,Z.memoizedState=Zh(1|w,k,void 0,B===void 0?null:B)}function Ul(_,w,k,B){var Z=Wo();B=B===void 0?null:B;var se=void 0;if(js!==null){var we=js.memoizedState;if(se=we.destroy,B!==null&&pc(B,we.deps)){Z.memoizedState=Zh(w,k,se,B);return}}fs.flags|=_,Z.memoizedState=Zh(1|w,k,se,B)}function lp(_,w){return iu(8390656,8,_,w)}function $l(_,w){return Ul(2048,8,_,w)}function lo(_,w){return Ul(4,2,_,w)}function jg(_,w){return Ul(4,4,_,w)}function Xh(_,w){if(typeof w=="function")return _=_(),w(_),function(){w(null)};if(w!=null)return _=_(),w.current=_,function(){w.current=null}}function mi(_,w,k){return k=k!=null?k.concat([_]):null,Ul(4,4,Xh.bind(null,w,_),k)}function Tr(){}function cp(_,w){var k=Wo();w=w===void 0?null:w;var B=k.memoizedState;return B!==null&&w!==null&&pc(w,B[1])?B[0]:(k.memoizedState=[_,w],_)}function Hl(_,w){var k=Wo();w=w===void 0?null:w;var B=k.memoizedState;return B!==null&&w!==null&&pc(w,B[1])?B[0]:(_=_(),k.memoizedState=[_,w],_)}function Kh(_,w,k){return(ha&21)===0?(_.baseState&&(_.baseState=!1,ko=!0),_.memoizedState=k):(Ja(k,w)||(k=Wa(),fs.lanes|=k,Te|=k,_.baseState=!0),w)}function Yh(_,w){var k=pi;pi=k!==0&&4>k?k:4,_(!0);var B=Hu.transition;Hu.transition={};try{_(!1),w()}finally{pi=k,Hu.transition=B}}function mc(){return Wo().memoizedState}function km(_,w,k){var B=qt(_);if(k={lane:B,action:k,hasEagerState:!1,eagerState:null,next:null},qu(_))hp(w,k);else if(k=Am(_,w,k,B),k!==null){var Z=Vt();Bt(k,_,B,Z),gl(k,w,B)}}function up(_,w,k){var B=qt(_),Z={lane:B,action:k,hasEagerState:!1,eagerState:null,next:null};if(qu(_))hp(w,Z);else{var se=_.alternate;if(_.lanes===0&&(se===null||se.lanes===0)&&(se=w.lastRenderedReducer,se!==null))try{var we=w.lastRenderedState,He=se(we,k);if(Z.hasEagerState=!0,Z.eagerState=He,Ja(He,we)){var Qe=w.interleaved;Qe===null?(Z.next=Z,Zt(w)):(Z.next=Qe.next,Qe.next=Z),w.interleaved=Z;return}}catch{}finally{}k=Am(_,w,Z,B),k!==null&&(Z=Vt(),Bt(k,_,B,Z),gl(k,w,B))}}function qu(_){var w=_.alternate;return _===fs||w!==null&&w===fs}function hp(_,w){Vl=ip=!0;var k=_.pending;k===null?w.next=w:(w.next=k.next,k.next=w),_.pending=w}function gl(_,w,k){if((k&4194240)!==0){var B=w.lanes;B&=_.pendingLanes,k|=B,w.lanes=k,Aa(_,k)}}var yl={readContext:zs,useCallback:zt,useContext:zt,useEffect:zt,useImperativeHandle:zt,useInsertionEffect:zt,useLayoutEffect:zt,useMemo:zt,useReducer:zt,useRef:zt,useState:zt,useDebugValue:zt,useDeferredValue:zt,useTransition:zt,useMutableSource:zt,useSyncExternalStore:zt,useId:zt,unstable_isNewReconciler:!1},Qd={readContext:zs,useCallback:function(_,w){return Fs().memoizedState=[_,w===void 0?null:w],_},useContext:zs,useEffect:lp,useImperativeHandle:function(_,w,k){return k=k!=null?k.concat([_]):null,iu(4194308,4,Xh.bind(null,w,_),k)},useLayoutEffect:function(_,w){return iu(4194308,4,_,w)},useInsertionEffect:function(_,w){return iu(4,2,_,w)},useMemo:function(_,w){var k=Fs();return w=w===void 0?null:w,_=_(),k.memoizedState=[_,w],_},useReducer:function(_,w,k){var B=Fs();return w=k!==void 0?k(w):w,B.memoizedState=B.baseState=w,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:w},B.queue=_,_=_.dispatch=km.bind(null,fs,_),[B.memoizedState,_]},useRef:function(_){var w=Fs();return _={current:_},w.memoizedState=_},useState:ap,useDebugValue:Tr,useDeferredValue:function(_){return Fs().memoizedState=_},useTransition:function(){var _=ap(!1),w=_[0];return _=Yh.bind(null,_[1]),Fs().memoizedState=_,[w,_]},useMutableSource:function(){},useSyncExternalStore:function(_,w,k){var B=fs,Z=Fs();if(ls){if(k===void 0)throw Error(s(407));k=k()}else{if(k=w(),ie===null)throw Error(s(349));(ha&30)!==0||Lg(B,w,k)}Z.memoizedState=k;var se={value:k,getSnapshot:w};return Z.queue=se,lp(Mm.bind(null,B,se,_),[_]),B.flags|=2048,Zh(9,zg.bind(null,B,se,k,w),void 0,null),k},useId:function(){var _=Fs(),w=ie.identifierPrefix;if(ls){var k=Ll,B=fl;k=(B&~(1<<32-Bo(B)-1)).toString(32)+k,w=":"+w+"R"+k,k=ml++,0<k&&(w+="H"+k.toString(32)),w+=":"}else k=Tt++,w=":"+w+"r"+k.toString(32)+":";return _.memoizedState=w},unstable_isNewReconciler:!1},dp={readContext:zs,useCallback:cp,useContext:zs,useEffect:$l,useImperativeHandle:mi,useInsertionEffect:lo,useLayoutEffect:jg,useMemo:Hl,useReducer:Kd,useRef:Jd,useState:function(){return Kd(ru)},useDebugValue:Tr,useDeferredValue:function(_){var w=Wo();return Kh(w,js.memoizedState,_)},useTransition:function(){var _=Kd(ru)[0],w=Wo().memoizedState;return[_,w]},useMutableSource:Im,useSyncExternalStore:Gu,useId:mc,unstable_isNewReconciler:!1},Jh={readContext:zs,useCallback:cp,useContext:zs,useEffect:$l,useImperativeHandle:mi,useInsertionEffect:lo,useLayoutEffect:jg,useMemo:Hl,useReducer:sp,useRef:Jd,useState:function(){return sp(ru)},useDebugValue:Tr,useDeferredValue:function(_){var w=Wo();return js===null?w.memoizedState=_:Kh(w,js.memoizedState,_)},useTransition:function(){var _=sp(ru)[0],w=Wo().memoizedState;return[_,w]},useMutableSource:Im,useSyncExternalStore:Gu,useId:mc,unstable_isNewReconciler:!1};function Mo(_,w){if(_&&_.defaultProps){w=Ht({},w),_=_.defaultProps;for(var k in _)w[k]===void 0&&(w[k]=_[k]);return w}return w}function Ps(_,w,k,B){w=_.memoizedState,k=k(B,w),k=k==null?w:Ht({},w,k),_.memoizedState=k,_.lanes===0&&(_.updateQueue.baseState=k)}var gc={isMounted:function(_){return(_=_._reactInternals)?Ze(_)===_:!1},enqueueSetState:function(_,w,k){_=_._reactInternals;var B=Vt(),Z=qt(_),se=Ra(B,Z);se.payload=w,k!=null&&(se.callback=k),w=tu(_,se,Z),w!==null&&(Bt(w,_,Z,B),tp(w,_,Z))},enqueueReplaceState:function(_,w,k){_=_._reactInternals;var B=Vt(),Z=qt(_),se=Ra(B,Z);se.tag=1,se.payload=w,k!=null&&(se.callback=k),w=tu(_,se,Z),w!==null&&(Bt(w,_,Z,B),tp(w,_,Z))},enqueueForceUpdate:function(_,w){_=_._reactInternals;var k=Vt(),B=qt(_),Z=Ra(k,B);Z.tag=2,w!=null&&(Z.callback=w),w=tu(_,Z,B),w!==null&&(Bt(w,_,B,k),tp(w,_,B))}};function yc(_,w,k,B,Z,se,we){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(B,se,we):w.prototype&&w.prototype.isPureReactComponent?!ul(k,B)||!ul(Z,se):!0}function fp(_,w,k){var B=!1,Z=oa,se=w.contextType;return typeof se=="object"&&se!==null?se=zs(se):(Z=io(w)?Zs:bs.current,B=w.contextTypes,se=(B=B!=null)?uc(_,Z):oa),w=new w(k,se),_.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=gc,_.stateNode=w,w._reactInternals=_,B&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=Z,_.__reactInternalMemoizedMaskedChildContext=se),w}function ef(_,w,k,B){_=w.state,typeof w.componentWillReceiveProps=="function"&&w.componentWillReceiveProps(k,B),typeof w.UNSAFE_componentWillReceiveProps=="function"&&w.UNSAFE_componentWillReceiveProps(k,B),w.state!==_&&gc.enqueueReplaceState(w,w.state,null)}function tf(_,w,k,B){var Z=_.stateNode;Z.props=k,Z.state=_.memoizedState,Z.refs={},Fl(_);var se=w.contextType;typeof se=="object"&&se!==null?Z.context=zs(se):(se=io(w)?Zs:bs.current,Z.context=uc(_,se)),Z.state=_.memoizedState,se=w.getDerivedStateFromProps,typeof se=="function"&&(Ps(_,w,se,k),Z.state=_.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof Z.getSnapshotBeforeUpdate=="function"||typeof Z.UNSAFE_componentWillMount!="function"&&typeof Z.componentWillMount!="function"||(w=Z.state,typeof Z.componentWillMount=="function"&&Z.componentWillMount(),typeof Z.UNSAFE_componentWillMount=="function"&&Z.UNSAFE_componentWillMount(),w!==Z.state&&gc.enqueueReplaceState(Z,Z.state,null),Zd(_,k,Z,B),Z.state=_.memoizedState),typeof Z.componentDidMount=="function"&&(_.flags|=4194308)}function Gl(_,w){try{var k="",B=w;do k+=Nn(B),B=B.return;while(B);var Z=k}catch(se){Z=`
Error generating stack: `+se.message+`
`+se.stack}return{value:_,source:w,stack:Z,digest:null}}function Rs(_,w,k){return{value:_,source:null,stack:k??null,digest:w??null}}function Wu(_,w){try{console.error(w.value)}catch(k){setTimeout(function(){throw k})}}var Pm=typeof WeakMap=="function"?WeakMap:Map;function pp(_,w,k){k=Ra(-1,k),k.tag=3,k.payload={element:null};var B=w.value;return k.callback=function(){mt||(mt=!0,Ue=B),Wu(_,w)},k}function _c(_,w,k){k=Ra(-1,k),k.tag=3;var B=_.type.getDerivedStateFromError;if(typeof B=="function"){var Z=w.value;k.payload=function(){return B(Z)},k.callback=function(){Wu(_,w)}}var se=_.stateNode;return se!==null&&typeof se.componentDidCatch=="function"&&(k.callback=function(){Wu(_,w),typeof B!="function"&&(Je===null?Je=new Set([this]):Je.add(this));var we=w.stack;this.componentDidCatch(w.value,{componentStack:we!==null?we:""})}),k}function Qh(_,w,k){var B=_.pingCache;if(B===null){B=_.pingCache=new Pm;var Z=new Set;B.set(w,Z)}else Z=B.get(w),Z===void 0&&(Z=new Set,B.set(w,Z));Z.has(k)||(Z.add(k),_=Gi.bind(null,_,w,k),w.then(_,_))}function mp(_){do{var w;if((w=_.tag===13)&&(w=_.memoizedState,w=w!==null?w.dehydrated!==null:!0),w)return _;_=_.return}while(_!==null);return null}function nf(_,w,k,B,Z){return(_.mode&1)===0?(_===w?_.flags|=65536:(_.flags|=128,k.flags|=131072,k.flags&=-52805,k.tag===1&&(k.alternate===null?k.tag=17:(w=Ra(-1,1),w.tag=2,tu(k,w,1))),k.lanes|=1),_):(_.flags|=65536,_.lanes=Z,_)}var Zu=ht.ReactCurrentOwner,ko=!1;function Ys(_,w,k,B){w.child=_===null?zl(w,null,k,B):hc(w,_.child,k,B)}function Xu(_,w,k,B,Z){k=k.render;var se=w.ref;return eu(w,Z),B=Di(_,w,k,B,se,Z),k=$e(),_!==null&&!ko?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,si(_,w,Z)):(ls&&k&&Ud(w),w.flags|=1,Ys(_,w,B,Z),w.child)}function ed(_,w,k,B,Z){if(_===null){var se=k.type;return typeof se=="function"&&!da(se)&&se.defaultProps===void 0&&k.compare===null&&k.defaultProps===void 0?(w.tag=15,w.type=se,gp(_,w,se,B,Z)):(_=fa(k.type,null,B,w,w.mode,Z),_.ref=w.ref,_.return=w,w.child=_)}if(se=_.child,(_.lanes&Z)===0){var we=se.memoizedProps;if(k=k.compare,k=k!==null?k:ul,k(we,B)&&_.ref===w.ref)return si(_,w,Z)}return w.flags|=1,_=Ko(se,B),_.ref=w.ref,_.return=w,w.child=_}function gp(_,w,k,B,Z){if(_!==null){var se=_.memoizedProps;if(ul(se,B)&&_.ref===w.ref)if(ko=!1,w.pendingProps=B=se,(_.lanes&Z)!==0)(_.flags&131072)!==0&&(ko=!0);else return w.lanes=_.lanes,si(_,w,Z)}return td(_,w,k,B,Z)}function rf(_,w,k){var B=w.pendingProps,Z=B.children,se=_!==null?_.memoizedState:null;if(B.mode==="hidden")if((w.mode&1)===0)w.memoizedState={baseLanes:0,cachePool:null,transitions:null},ns(xe,ge),ge|=k;else{if((k&1073741824)===0)return _=se!==null?se.baseLanes|k:k,w.lanes=w.childLanes=1073741824,w.memoizedState={baseLanes:_,cachePool:null,transitions:null},w.updateQueue=null,ns(xe,ge),ge|=_,null;w.memoizedState={baseLanes:0,cachePool:null,transitions:null},B=se!==null?se.baseLanes:k,ns(xe,ge),ge|=B}else se!==null?(B=se.baseLanes|k,w.memoizedState=null):B=k,ns(xe,ge),ge|=B;return Ys(_,w,Z,k),w.child}function Rm(_,w){var k=w.ref;(_===null&&k!==null||_!==null&&_.ref!==k)&&(w.flags|=512,w.flags|=2097152)}function td(_,w,k,B,Z){var se=io(k)?Zs:bs.current;return se=uc(w,se),eu(w,Z),k=Di(_,w,k,B,se,Z),B=$e(),_!==null&&!ko?(w.updateQueue=_.updateQueue,w.flags&=-2053,_.lanes&=~Z,si(_,w,Z)):(ls&&B&&Ud(w),w.flags|=1,Ys(_,w,k,Z),w.child)}function Nm(_,w,k,B,Z){if(io(k)){var se=!0;ju(w)}else se=!1;if(eu(w,Z),w.stateNode===null)Ku(_,w),fp(w,k,B),tf(w,k,B,Z),B=!0;else if(_===null){var we=w.stateNode,He=w.memoizedProps;we.props=He;var Qe=we.context,Et=k.contextType;typeof Et=="object"&&Et!==null?Et=zs(Et):(Et=io(k)?Zs:bs.current,Et=uc(w,Et));var dn=k.getDerivedStateFromProps,mn=typeof dn=="function"||typeof we.getSnapshotBeforeUpdate=="function";mn||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(He!==B||Qe!==Et)&&ef(w,we,B,Et),qo=!1;var an=w.memoizedState;we.state=an,Zd(w,B,we,Z),Qe=w.memoizedState,He!==B||an!==Qe||$o.current||qo?(typeof dn=="function"&&(Ps(w,k,dn,B),Qe=w.memoizedState),(He=qo||yc(w,k,He,B,an,Qe,Et))?(mn||typeof we.UNSAFE_componentWillMount!="function"&&typeof we.componentWillMount!="function"||(typeof we.componentWillMount=="function"&&we.componentWillMount(),typeof we.UNSAFE_componentWillMount=="function"&&we.UNSAFE_componentWillMount()),typeof we.componentDidMount=="function"&&(w.flags|=4194308)):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),w.memoizedProps=B,w.memoizedState=Qe),we.props=B,we.state=Qe,we.context=Et,B=He):(typeof we.componentDidMount=="function"&&(w.flags|=4194308),B=!1)}else{we=w.stateNode,vn(_,w),He=w.memoizedProps,Et=w.type===w.elementType?He:Mo(w.type,He),we.props=Et,mn=w.pendingProps,an=we.context,Qe=k.contextType,typeof Qe=="object"&&Qe!==null?Qe=zs(Qe):(Qe=io(k)?Zs:bs.current,Qe=uc(w,Qe));var Wn=k.getDerivedStateFromProps;(dn=typeof Wn=="function"||typeof we.getSnapshotBeforeUpdate=="function")||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(He!==mn||an!==Qe)&&ef(w,we,B,Qe),qo=!1,an=w.memoizedState,we.state=an,Zd(w,B,we,Z);var tr=w.memoizedState;He!==mn||an!==tr||$o.current||qo?(typeof Wn=="function"&&(Ps(w,k,Wn,B),tr=w.memoizedState),(Et=qo||yc(w,k,Et,B,an,tr,Qe)||!1)?(dn||typeof we.UNSAFE_componentWillUpdate!="function"&&typeof we.componentWillUpdate!="function"||(typeof we.componentWillUpdate=="function"&&we.componentWillUpdate(B,tr,Qe),typeof we.UNSAFE_componentWillUpdate=="function"&&we.UNSAFE_componentWillUpdate(B,tr,Qe)),typeof we.componentDidUpdate=="function"&&(w.flags|=4),typeof we.getSnapshotBeforeUpdate=="function"&&(w.flags|=1024)):(typeof we.componentDidUpdate!="function"||He===_.memoizedProps&&an===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||He===_.memoizedProps&&an===_.memoizedState||(w.flags|=1024),w.memoizedProps=B,w.memoizedState=tr),we.props=B,we.state=tr,we.context=Qe,B=Et):(typeof we.componentDidUpdate!="function"||He===_.memoizedProps&&an===_.memoizedState||(w.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||He===_.memoizedProps&&an===_.memoizedState||(w.flags|=1024),B=!1)}return yp(_,w,k,B,se,Z)}function yp(_,w,k,B,Z,se){Rm(_,w);var we=(w.flags&128)!==0;if(!B&&!we)return Z&&Fh(w,k,!1),si(_,w,se);B=w.stateNode,Zu.current=w;var He=we&&typeof k.getDerivedStateFromError!="function"?null:B.render();return w.flags|=1,_!==null&&we?(w.child=hc(w,_.child,null,se),w.child=hc(w,null,He,se)):Ys(_,w,He,se),w.memoizedState=B.state,Z&&Fh(w,k,!0),w.child}function Dm(_){var w=_.stateNode;w.pendingContext?Xf(_,w.pendingContext,w.pendingContext!==w.context):w.context&&Xf(_,w.context,!1),ao(_,w.containerInfo)}function Om(_,w,k,B,Z){return Vu(),ca(Z),w.flags|=256,Ys(_,w,k,B),w.child}var sf={dehydrated:null,treeContext:null,retryLane:0};function _p(_){return{baseLanes:_,cachePool:null,transitions:null}}function Lm(_,w,k){var B=w.pendingProps,Z=rs.current,se=!1,we=(w.flags&128)!==0,He;if((He=we)||(He=_!==null&&_.memoizedState===null?!1:(Z&2)!==0),He?(se=!0,w.flags&=-129):(_===null||_.memoizedState!==null)&&(Z|=1),ns(rs,Z&1),_===null)return Gd(w),_=w.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((w.mode&1)===0?w.lanes=1:_.data==="$!"?w.lanes=8:w.lanes=1073741824,null):(we=B.children,_=B.fallback,se?(B=w.mode,se=w.child,we={mode:"hidden",children:we},(B&1)===0&&se!==null?(se.childLanes=0,se.pendingProps=we):se=su(we,B,0,null),_=pa(_,B,k,null),se.return=w,_.return=w,se.sibling=_,w.child=se,w.child.memoizedState=_p(k),w.memoizedState=sf,_):xp(w,we));if(Z=_.memoizedState,Z!==null&&(He=Z.dehydrated,He!==null))return Fg(_,w,we,B,He,Z,k);if(se){se=B.fallback,we=w.mode,Z=_.child,He=Z.sibling;var Qe={mode:"hidden",children:B.children};return(we&1)===0&&w.child!==Z?(B=w.child,B.childLanes=0,B.pendingProps=Qe,w.deletions=null):(B=Ko(Z,Qe),B.subtreeFlags=Z.subtreeFlags&14680064),He!==null?se=Ko(He,se):(se=pa(se,we,k,null),se.flags|=2),se.return=w,B.return=w,B.sibling=se,w.child=B,B=se,se=w.child,we=_.child.memoizedState,we=we===null?_p(k):{baseLanes:we.baseLanes|k,cachePool:null,transitions:we.transitions},se.memoizedState=we,se.childLanes=_.childLanes&~k,w.memoizedState=sf,B}return se=_.child,_=se.sibling,B=Ko(se,{mode:"visible",children:B.children}),(w.mode&1)===0&&(B.lanes=k),B.return=w,B.sibling=null,_!==null&&(k=w.deletions,k===null?(w.deletions=[_],w.flags|=16):k.push(_)),w.child=B,w.memoizedState=null,B}function xp(_,w){return w=su({mode:"visible",children:w},_.mode,0,null),w.return=_,_.child=w}function of(_,w,k,B){return B!==null&&ca(B),hc(w,_.child,null,k),_=xp(w,w.pendingProps.children),_.flags|=2,w.memoizedState=null,_}function Fg(_,w,k,B,Z,se,we){if(k)return w.flags&256?(w.flags&=-257,B=Rs(Error(s(422))),of(_,w,we,B)):w.memoizedState!==null?(w.child=_.child,w.flags|=128,null):(se=B.fallback,Z=w.mode,B=su({mode:"visible",children:B.children},Z,0,null),se=pa(se,Z,we,null),se.flags|=2,B.return=w,se.return=w,B.sibling=se,w.child=B,(w.mode&1)!==0&&hc(w,_.child,null,we),w.child.memoizedState=_p(we),w.memoizedState=sf,se);if((w.mode&1)===0)return of(_,w,we,null);if(Z.data==="$!"){if(B=Z.nextSibling&&Z.nextSibling.dataset,B)var He=B.dgst;return B=He,se=Error(s(419)),B=Rs(se,B,void 0),of(_,w,we,B)}if(He=(we&_.childLanes)!==0,ko||He){if(B=ie,B!==null){switch(we&-we){case 4:Z=2;break;case 16:Z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Z=32;break;case 536870912:Z=268435456;break;default:Z=0}Z=(Z&(B.suspendedLanes|we))!==0?0:Z,Z!==0&&Z!==se.retryLane&&(se.retryLane=Z,jl(_,Z),Bt(B,_,Z,-1))}return ai(),B=Rs(Error(s(421))),of(_,w,we,B)}return Z.data==="$?"?(w.flags|=128,w.child=_.child,w=wi.bind(null,_),Z._reactRetry=w,null):(_=se.treeContext,Xs=kl(Z.nextSibling),Ls=w,ls=!0,so=null,_!==null&&(Ho[Qa++]=fl,Ho[Qa++]=Ll,Ho[Qa++]=Ol,fl=_.id,Ll=_.overflow,Ol=w),w=xp(w,B.children),w.flags|=4096,w)}function zm(_,w,k){_.lanes|=w;var B=_.alternate;B!==null&&(B.lanes|=w),Wd(_.return,w,k)}function jm(_,w,k,B,Z){var se=_.memoizedState;se===null?_.memoizedState={isBackwards:w,rendering:null,renderingStartTime:0,last:B,tail:k,tailMode:Z}:(se.isBackwards=w,se.rendering=null,se.renderingStartTime=0,se.last=B,se.tail=k,se.tailMode=Z)}function Bg(_,w,k){var B=w.pendingProps,Z=B.revealOrder,se=B.tail;if(Ys(_,w,B.children,k),B=rs.current,(B&2)!==0)B=B&1|2,w.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=w.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&zm(_,k,w);else if(_.tag===19)zm(_,k,w);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===w)break e;for(;_.sibling===null;){if(_.return===null||_.return===w)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}B&=1}if(ns(rs,B),(w.mode&1)===0)w.memoizedState=null;else switch(Z){case"forwards":for(k=w.child,Z=null;k!==null;)_=k.alternate,_!==null&&fc(_)===null&&(Z=k),k=k.sibling;k=Z,k===null?(Z=w.child,w.child=null):(Z=k.sibling,k.sibling=null),jm(w,!1,Z,k,se);break;case"backwards":for(k=null,Z=w.child,w.child=null;Z!==null;){if(_=Z.alternate,_!==null&&fc(_)===null){w.child=Z;break}_=Z.sibling,Z.sibling=k,k=Z,Z=_}jm(w,!0,k,null,se);break;case"together":jm(w,!1,null,null,void 0);break;default:w.memoizedState=null}return w.child}function Ku(_,w){(w.mode&1)===0&&_!==null&&(_.alternate=null,w.alternate=null,w.flags|=2)}function si(_,w,k){if(_!==null&&(w.dependencies=_.dependencies),Te|=w.lanes,(k&w.childLanes)===0)return null;if(_!==null&&w.child!==_.child)throw Error(s(153));if(w.child!==null){for(_=w.child,k=Ko(_,_.pendingProps),w.child=k,k.return=w;_.sibling!==null;)_=_.sibling,k=k.sibling=Ko(_,_.pendingProps),k.return=w;k.sibling=null}return w.child}function Vg(_,w,k){switch(w.tag){case 3:Dm(w),Vu();break;case 5:nu(w);break;case 1:io(w.type)&&ju(w);break;case 4:ao(w,w.stateNode.containerInfo);break;case 10:var B=w.type._context,Z=w.memoizedProps.value;ns(Kc,B._currentValue),B._currentValue=Z;break;case 13:if(B=w.memoizedState,B!==null)return B.dehydrated!==null?(ns(rs,rs.current&1),w.flags|=128,null):(k&w.child.childLanes)!==0?Lm(_,w,k):(ns(rs,rs.current&1),_=si(_,w,k),_!==null?_.sibling:null);ns(rs,rs.current&1);break;case 19:if(B=(k&w.childLanes)!==0,(_.flags&128)!==0){if(B)return Bg(_,w,k);w.flags|=128}if(Z=w.memoizedState,Z!==null&&(Z.rendering=null,Z.tail=null,Z.lastEffect=null),ns(rs,rs.current),B)break;return null;case 22:case 23:return w.lanes=0,rf(_,w,k)}return si(_,w,k)}var af,lf,Fm,nd;af=function(_,w){for(var k=w.child;k!==null;){if(k.tag===5||k.tag===6)_.appendChild(k.stateNode);else if(k.tag!==4&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===w)break;for(;k.sibling===null;){if(k.return===null||k.return===w)return;k=k.return}k.sibling.return=k.return,k=k.sibling}},lf=function(){},Fm=function(_,w,k,B){var Z=_.memoizedProps;if(Z!==B){_=w.stateNode,dc(Bl.current);var se=null;switch(k){case"input":Z=vs(_,Z),B=vs(_,B),se=[];break;case"select":Z=Ht({},Z,{value:void 0}),B=Ht({},B,{value:void 0}),se=[];break;case"textarea":Z=Qo(_,Z),B=Qo(_,B),se=[];break;default:typeof Z.onClick!="function"&&typeof B.onClick=="function"&&(_.onclick=cc)}As(k,B);var we;k=null;for(Et in Z)if(!B.hasOwnProperty(Et)&&Z.hasOwnProperty(Et)&&Z[Et]!=null)if(Et==="style"){var He=Z[Et];for(we in He)He.hasOwnProperty(we)&&(k||(k={}),k[we]="")}else Et!=="dangerouslySetInnerHTML"&&Et!=="children"&&Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(h.hasOwnProperty(Et)?se||(se=[]):(se=se||[]).push(Et,null));for(Et in B){var Qe=B[Et];if(He=Z?.[Et],B.hasOwnProperty(Et)&&Qe!==He&&(Qe!=null||He!=null))if(Et==="style")if(He){for(we in He)!He.hasOwnProperty(we)||Qe&&Qe.hasOwnProperty(we)||(k||(k={}),k[we]="");for(we in Qe)Qe.hasOwnProperty(we)&&He[we]!==Qe[we]&&(k||(k={}),k[we]=Qe[we])}else k||(se||(se=[]),se.push(Et,k)),k=Qe;else Et==="dangerouslySetInnerHTML"?(Qe=Qe?Qe.__html:void 0,He=He?He.__html:void 0,Qe!=null&&He!==Qe&&(se=se||[]).push(Et,Qe)):Et==="children"?typeof Qe!="string"&&typeof Qe!="number"||(se=se||[]).push(Et,""+Qe):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&(h.hasOwnProperty(Et)?(Qe!=null&&Et==="onScroll"&&es("scroll",_),se||He===Qe||(se=[])):(se=se||[]).push(Et,Qe))}k&&(se=se||[]).push("style",k);var Et=se;(w.updateQueue=Et)&&(w.flags|=4)}},nd=function(_,w,k,B){k!==B&&(w.flags|=4)};function Yu(_,w){if(!ls)switch(_.tailMode){case"hidden":w=_.tail;for(var k=null;w!==null;)w.alternate!==null&&(k=w),w=w.sibling;k===null?_.tail=null:k.sibling=null;break;case"collapsed":k=_.tail;for(var B=null;k!==null;)k.alternate!==null&&(B=k),k=k.sibling;B===null?w||_.tail===null?_.tail=null:_.tail.sibling=null:B.sibling=null}}function Js(_){var w=_.alternate!==null&&_.alternate.child===_.child,k=0,B=0;if(w)for(var Z=_.child;Z!==null;)k|=Z.lanes|Z.childLanes,B|=Z.subtreeFlags&14680064,B|=Z.flags&14680064,Z.return=_,Z=Z.sibling;else for(Z=_.child;Z!==null;)k|=Z.lanes|Z.childLanes,B|=Z.subtreeFlags,B|=Z.flags,Z.return=_,Z=Z.sibling;return _.subtreeFlags|=B,_.childLanes=k,w}function cf(_,w,k){var B=w.pendingProps;switch(ep(w),w.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Js(w),null;case 1:return io(w.type)&&zu(),Js(w),null;case 3:return B=w.stateNode,ua(),ts($o),ts(bs),pl(),B.pendingContext&&(B.context=B.pendingContext,B.pendingContext=null),(_===null||_.child===null)&&(Xc(w)?w.flags|=4:_===null||_.memoizedState.isDehydrated&&(w.flags&256)===0||(w.flags|=1024,so!==null&&(Ln(so),so=null))),lf(_,w),Js(w),null;case 5:Wh(w);var Z=dc(oo.current);if(k=w.type,_!==null&&w.stateNode!=null)Fm(_,w,k,B,Z),_.ref!==w.ref&&(w.flags|=512,w.flags|=2097152);else{if(!B){if(w.stateNode===null)throw Error(s(166));return Js(w),null}if(_=dc(Bl.current),Xc(w)){B=w.stateNode,k=w.type;var se=w.memoizedProps;switch(B[dl]=w,B[zh]=se,_=(w.mode&1)!==0,k){case"dialog":es("cancel",B),es("close",B);break;case"iframe":case"object":case"embed":es("load",B);break;case"video":case"audio":for(Z=0;Z<qc.length;Z++)es(qc[Z],B);break;case"source":es("error",B);break;case"img":case"image":case"link":es("error",B),es("load",B);break;case"details":es("toggle",B);break;case"input":$s(B,se),es("invalid",B);break;case"select":B._wrapperState={wasMultiple:!!se.multiple},es("invalid",B);break;case"textarea":To(B,se),es("invalid",B)}As(k,se),Z=null;for(var we in se)if(se.hasOwnProperty(we)){var He=se[we];we==="children"?typeof He=="string"?B.textContent!==He&&(se.suppressHydrationWarning!==!0&&Ml(B.textContent,He,_),Z=["children",He]):typeof He=="number"&&B.textContent!==""+He&&(se.suppressHydrationWarning!==!0&&Ml(B.textContent,He,_),Z=["children",""+He]):h.hasOwnProperty(we)&&He!=null&&we==="onScroll"&&es("scroll",B)}switch(k){case"input":Zr(B),El(B,se,!0);break;case"textarea":Zr(B),Ua(B);break;case"select":case"option":break;default:typeof se.onClick=="function"&&(B.onclick=cc)}B=Z,w.updateQueue=B,B!==null&&(w.flags|=4)}else{we=Z.nodeType===9?Z:Z.ownerDocument,_==="http://www.w3.org/1999/xhtml"&&(_=wa(k)),_==="http://www.w3.org/1999/xhtml"?k==="script"?(_=we.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild)):typeof B.is=="string"?_=we.createElement(k,{is:B.is}):(_=we.createElement(k),k==="select"&&(we=_,B.multiple?we.multiple=!0:B.size&&(we.size=B.size))):_=we.createElementNS(_,k),_[dl]=w,_[zh]=B,af(_,w,!1,!1),w.stateNode=_;e:{switch(we=$a(k,B),k){case"dialog":es("cancel",_),es("close",_),Z=B;break;case"iframe":case"object":case"embed":es("load",_),Z=B;break;case"video":case"audio":for(Z=0;Z<qc.length;Z++)es(qc[Z],_);Z=B;break;case"source":es("error",_),Z=B;break;case"img":case"image":case"link":es("error",_),es("load",_),Z=B;break;case"details":es("toggle",_),Z=B;break;case"input":$s(_,B),Z=vs(_,B),es("invalid",_);break;case"option":Z=B;break;case"select":_._wrapperState={wasMultiple:!!B.multiple},Z=Ht({},B,{value:void 0}),es("invalid",_);break;case"textarea":To(_,B),Z=Qo(_,B),es("invalid",_);break;default:Z=B}As(k,Z),He=Z;for(se in He)if(He.hasOwnProperty(se)){var Qe=He[se];se==="style"?Ea(_,Qe):se==="dangerouslySetInnerHTML"?(Qe=Qe?Qe.__html:void 0,Qe!=null&&Hs(_,Qe)):se==="children"?typeof Qe=="string"?(k!=="textarea"||Qe!=="")&&Fo(_,Qe):typeof Qe=="number"&&Fo(_,""+Qe):se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&se!=="autoFocus"&&(h.hasOwnProperty(se)?Qe!=null&&se==="onScroll"&&es("scroll",_):Qe!=null&&Fe(_,se,Qe,we))}switch(k){case"input":Zr(_),El(_,B,!1);break;case"textarea":Zr(_),Ua(_);break;case"option":B.value!=null&&_.setAttribute("value",""+$n(B.value));break;case"select":_.multiple=!!B.multiple,se=B.value,se!=null?to(_,!!B.multiple,se,!1):B.defaultValue!=null&&to(_,!!B.multiple,B.defaultValue,!0);break;default:typeof Z.onClick=="function"&&(_.onclick=cc)}switch(k){case"button":case"input":case"select":case"textarea":B=!!B.autoFocus;break e;case"img":B=!0;break e;default:B=!1}}B&&(w.flags|=4)}w.ref!==null&&(w.flags|=512,w.flags|=2097152)}return Js(w),null;case 6:if(_&&w.stateNode!=null)nd(_,w,_.memoizedProps,B);else{if(typeof B!="string"&&w.stateNode===null)throw Error(s(166));if(k=dc(oo.current),dc(Bl.current),Xc(w)){if(B=w.stateNode,k=w.memoizedProps,B[dl]=w,(se=B.nodeValue!==k)&&(_=Ls,_!==null))switch(_.tag){case 3:Ml(B.nodeValue,k,(_.mode&1)!==0);break;case 5:_.memoizedProps.suppressHydrationWarning!==!0&&Ml(B.nodeValue,k,(_.mode&1)!==0)}se&&(w.flags|=4)}else B=(k.nodeType===9?k:k.ownerDocument).createTextNode(B),B[dl]=w,w.stateNode=B}return Js(w),null;case 13:if(ts(rs),B=w.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(ls&&Xs!==null&&(w.mode&1)!==0&&(w.flags&128)===0)Cm(),Vu(),w.flags|=98560,se=!1;else if(se=Xc(w),B!==null&&B.dehydrated!==null){if(_===null){if(!se)throw Error(s(318));if(se=w.memoizedState,se=se!==null?se.dehydrated:null,!se)throw Error(s(317));se[dl]=w}else Vu(),(w.flags&128)===0&&(w.memoizedState=null),w.flags|=4;Js(w),se=!1}else so!==null&&(Ln(so),so=null),se=!0;if(!se)return w.flags&65536?w:null}return(w.flags&128)!==0?(w.lanes=k,w):(B=B!==null,B!==(_!==null&&_.memoizedState!==null)&&B&&(w.child.flags|=8192,(w.mode&1)!==0&&(_===null||(rs.current&1)!==0?Ce===0&&(Ce=3):ai())),w.updateQueue!==null&&(w.flags|=4),Js(w),null);case 4:return ua(),lf(_,w),_===null&&jd(w.stateNode.containerInfo),Js(w),null;case 10:return Gh(w.type._context),Js(w),null;case 17:return io(w.type)&&zu(),Js(w),null;case 19:if(ts(rs),se=w.memoizedState,se===null)return Js(w),null;if(B=(w.flags&128)!==0,we=se.rendering,we===null)if(B)Yu(se,!1);else{if(Ce!==0||_!==null&&(_.flags&128)!==0)for(_=w.child;_!==null;){if(we=fc(_),we!==null){for(w.flags|=128,Yu(se,!1),B=we.updateQueue,B!==null&&(w.updateQueue=B,w.flags|=4),w.subtreeFlags=0,B=k,k=w.child;k!==null;)se=k,_=B,se.flags&=14680066,we=se.alternate,we===null?(se.childLanes=0,se.lanes=_,se.child=null,se.subtreeFlags=0,se.memoizedProps=null,se.memoizedState=null,se.updateQueue=null,se.dependencies=null,se.stateNode=null):(se.childLanes=we.childLanes,se.lanes=we.lanes,se.child=we.child,se.subtreeFlags=0,se.deletions=null,se.memoizedProps=we.memoizedProps,se.memoizedState=we.memoizedState,se.updateQueue=we.updateQueue,se.type=we.type,_=we.dependencies,se.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),k=k.sibling;return ns(rs,rs.current&1|2),w.child}_=_.sibling}se.tail!==null&&mr()>st&&(w.flags|=128,B=!0,Yu(se,!1),w.lanes=4194304)}else{if(!B)if(_=fc(we),_!==null){if(w.flags|=128,B=!0,k=_.updateQueue,k!==null&&(w.updateQueue=k,w.flags|=4),Yu(se,!0),se.tail===null&&se.tailMode==="hidden"&&!we.alternate&&!ls)return Js(w),null}else 2*mr()-se.renderingStartTime>st&&k!==1073741824&&(w.flags|=128,B=!0,Yu(se,!1),w.lanes=4194304);se.isBackwards?(we.sibling=w.child,w.child=we):(k=se.last,k!==null?k.sibling=we:w.child=we,se.last=we)}return se.tail!==null?(w=se.tail,se.rendering=w,se.tail=w.sibling,se.renderingStartTime=mr(),w.sibling=null,k=rs.current,ns(rs,B?k&1|2:k&1),w):(Js(w),null);case 22:case 23:return $i(),B=w.memoizedState!==null,_!==null&&_.memoizedState!==null!==B&&(w.flags|=8192),B&&(w.mode&1)!==0?(ge&1073741824)!==0&&(Js(w),w.subtreeFlags&6&&(w.flags|=8192)):Js(w),null;case 24:return null;case 25:return null}throw Error(s(156,w.tag))}function xc(_,w){switch(ep(w),w.tag){case 1:return io(w.type)&&zu(),_=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 3:return ua(),ts($o),ts(bs),pl(),_=w.flags,(_&65536)!==0&&(_&128)===0?(w.flags=_&-65537|128,w):null;case 5:return Wh(w),null;case 13:if(ts(rs),_=w.memoizedState,_!==null&&_.dehydrated!==null){if(w.alternate===null)throw Error(s(340));Vu()}return _=w.flags,_&65536?(w.flags=_&-65537|128,w):null;case 19:return ts(rs),null;case 4:return ua(),null;case 10:return Gh(w.type._context),null;case 22:case 23:return $i(),null;case 24:return null;default:return null}}var Ju=!1,Xr=!1,ql=typeof WeakSet=="function"?WeakSet:Set,qn=null;function vc(_,w){var k=_.ref;if(k!==null)if(typeof k=="function")try{k(null)}catch(B){Xn(_,w,B)}else k.current=null}function vp(_,w,k){try{k()}catch(B){Xn(_,w,B)}}var Ug=!1;function rd(_,w){if(Nh=Ed,_=Vf(),Dd(_)){if("selectionStart"in _)var k={start:_.selectionStart,end:_.selectionEnd};else e:{k=(k=_.ownerDocument)&&k.defaultView||window;var B=k.getSelection&&k.getSelection();if(B&&B.rangeCount!==0){k=B.anchorNode;var Z=B.anchorOffset,se=B.focusNode;B=B.focusOffset;try{k.nodeType,se.nodeType}catch{k=null;break e}var we=0,He=-1,Qe=-1,Et=0,dn=0,mn=_,an=null;t:for(;;){for(var Wn;mn!==k||Z!==0&&mn.nodeType!==3||(He=we+Z),mn!==se||B!==0&&mn.nodeType!==3||(Qe=we+B),mn.nodeType===3&&(we+=mn.nodeValue.length),(Wn=mn.firstChild)!==null;)an=mn,mn=Wn;for(;;){if(mn===_)break t;if(an===k&&++Et===Z&&(He=we),an===se&&++dn===B&&(Qe=we),(Wn=mn.nextSibling)!==null)break;mn=an,an=mn.parentNode}mn=Wn}k=He===-1||Qe===-1?null:{start:He,end:Qe}}else k=null}k=k||{start:0,end:0}}else k=null;for(Dh={focusedElem:_,selectionRange:k},Ed=!1,qn=w;qn!==null;)if(w=qn,_=w.child,(w.subtreeFlags&1028)!==0&&_!==null)_.return=w,qn=_;else for(;qn!==null;){w=qn;try{var tr=w.alternate;if((w.flags&1024)!==0)switch(w.tag){case 0:case 11:case 15:break;case 1:if(tr!==null){var or=tr.memoizedProps,Vs=tr.memoizedState,yt=w.stateNode,ut=yt.getSnapshotBeforeUpdate(w.elementType===w.type?or:Mo(w.type,or),Vs);yt.__reactInternalSnapshotBeforeUpdate=ut}break;case 3:var bt=w.stateNode.containerInfo;bt.nodeType===1?bt.textContent="":bt.nodeType===9&&bt.documentElement&&bt.removeChild(bt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Sn){Xn(w,w.return,Sn)}if(_=w.sibling,_!==null){_.return=w.return,qn=_;break}qn=w.return}return tr=Ug,Ug=!1,tr}function Qu(_,w,k){var B=w.updateQueue;if(B=B!==null?B.lastEffect:null,B!==null){var Z=B=B.next;do{if((Z.tag&_)===_){var se=Z.destroy;Z.destroy=void 0,se!==void 0&&vp(w,k,se)}Z=Z.next}while(Z!==B)}}function Na(_,w){if(w=w.updateQueue,w=w!==null?w.lastEffect:null,w!==null){var k=w=w.next;do{if((k.tag&_)===_){var B=k.create;k.destroy=B()}k=k.next}while(k!==w)}}function eh(_){var w=_.ref;if(w!==null){var k=_.stateNode;switch(_.tag){case 5:_=k;break;default:_=k}typeof w=="function"?w(_):w.current=_}}function bp(_){var w=_.alternate;w!==null&&(_.alternate=null,bp(w)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(w=_.stateNode,w!==null&&(delete w[dl],delete w[zh],delete w[Nl],delete w[Pg],delete w[Rg])),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function id(_){return _.tag===5||_.tag===3||_.tag===4}function th(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||id(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function _l(_,w,k){var B=_.tag;if(B===5||B===6)_=_.stateNode,w?k.nodeType===8?k.parentNode.insertBefore(_,w):k.insertBefore(_,w):(k.nodeType===8?(w=k.parentNode,w.insertBefore(_,k)):(w=k,w.appendChild(_)),k=k._reactRootContainer,k!=null||w.onclick!==null||(w.onclick=cc));else if(B!==4&&(_=_.child,_!==null))for(_l(_,w,k),_=_.sibling;_!==null;)_l(_,w,k),_=_.sibling}function Da(_,w,k){var B=_.tag;if(B===5||B===6)_=_.stateNode,w?k.insertBefore(_,w):k.appendChild(_);else if(B!==4&&(_=_.child,_!==null))for(Da(_,w,k),_=_.sibling;_!==null;)Da(_,w,k),_=_.sibling}var Yi=null,Po=!1;function f(_,w,k){for(k=k.child;k!==null;)r(_,w,k),k=k.sibling}function r(_,w,k){if(hs&&typeof hs.onCommitFiberUnmount=="function")try{hs.onCommitFiberUnmount(gs,k)}catch{}switch(k.tag){case 5:Xr||vc(k,w);case 6:var B=Yi,Z=Po;Yi=null,f(_,w,k),Yi=B,Po=Z,Yi!==null&&(Po?(_=Yi,k=k.stateNode,_.nodeType===8?_.parentNode.removeChild(k):_.removeChild(k)):Yi.removeChild(k.stateNode));break;case 18:Yi!==null&&(Po?(_=Yi,k=k.stateNode,_.nodeType===8?Lh(_.parentNode,k):_.nodeType===1&&Lh(_,k),wu(_)):Lh(Yi,k.stateNode));break;case 4:B=Yi,Z=Po,Yi=k.stateNode.containerInfo,Po=!0,f(_,w,k),Yi=B,Po=Z;break;case 0:case 11:case 14:case 15:if(!Xr&&(B=k.updateQueue,B!==null&&(B=B.lastEffect,B!==null))){Z=B=B.next;do{var se=Z,we=se.destroy;se=se.tag,we!==void 0&&((se&2)!==0||(se&4)!==0)&&vp(k,w,we),Z=Z.next}while(Z!==B)}f(_,w,k);break;case 1:if(!Xr&&(vc(k,w),B=k.stateNode,typeof B.componentWillUnmount=="function"))try{B.props=k.memoizedProps,B.state=k.memoizedState,B.componentWillUnmount()}catch(He){Xn(k,w,He)}f(_,w,k);break;case 21:f(_,w,k);break;case 22:k.mode&1?(Xr=(B=Xr)||k.memoizedState!==null,f(_,w,k),Xr=B):f(_,w,k);break;default:f(_,w,k)}}function c(_){var w=_.updateQueue;if(w!==null){_.updateQueue=null;var k=_.stateNode;k===null&&(k=_.stateNode=new ql),w.forEach(function(B){var Z=Dr.bind(null,_,B);k.has(B)||(k.add(B),B.then(Z,Z))})}}function p(_,w){var k=w.deletions;if(k!==null)for(var B=0;B<k.length;B++){var Z=k[B];try{var se=_,we=w,He=we;e:for(;He!==null;){switch(He.tag){case 5:Yi=He.stateNode,Po=!1;break e;case 3:Yi=He.stateNode.containerInfo,Po=!0;break e;case 4:Yi=He.stateNode.containerInfo,Po=!0;break e}He=He.return}if(Yi===null)throw Error(s(160));r(se,we,Z),Yi=null,Po=!1;var Qe=Z.alternate;Qe!==null&&(Qe.return=null),Z.return=null}catch(Et){Xn(Z,w,Et)}}if(w.subtreeFlags&12854)for(w=w.child;w!==null;)x(w,_),w=w.sibling}function x(_,w){var k=_.alternate,B=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:if(p(w,_),S(_),B&4){try{Qu(3,_,_.return),Na(3,_)}catch(or){Xn(_,_.return,or)}try{Qu(5,_,_.return)}catch(or){Xn(_,_.return,or)}}break;case 1:p(w,_),S(_),B&512&&k!==null&&vc(k,k.return);break;case 5:if(p(w,_),S(_),B&512&&k!==null&&vc(k,k.return),_.flags&32){var Z=_.stateNode;try{Fo(Z,"")}catch(or){Xn(_,_.return,or)}}if(B&4&&(Z=_.stateNode,Z!=null)){var se=_.memoizedProps,we=k!==null?k.memoizedProps:se,He=_.type,Qe=_.updateQueue;if(_.updateQueue=null,Qe!==null)try{He==="input"&&se.type==="radio"&&se.name!=null&&Hi(Z,se),$a(He,we);var Et=$a(He,se);for(we=0;we<Qe.length;we+=2){var dn=Qe[we],mn=Qe[we+1];dn==="style"?Ea(Z,mn):dn==="dangerouslySetInnerHTML"?Hs(Z,mn):dn==="children"?Fo(Z,mn):Fe(Z,dn,mn,Et)}switch(He){case"input":mo(Z,se);break;case"textarea":Cs(Z,se);break;case"select":var an=Z._wrapperState.wasMultiple;Z._wrapperState.wasMultiple=!!se.multiple;var Wn=se.value;Wn!=null?to(Z,!!se.multiple,Wn,!1):an!==!!se.multiple&&(se.defaultValue!=null?to(Z,!!se.multiple,se.defaultValue,!0):to(Z,!!se.multiple,se.multiple?[]:"",!1))}Z[zh]=se}catch(or){Xn(_,_.return,or)}}break;case 6:if(p(w,_),S(_),B&4){if(_.stateNode===null)throw Error(s(162));Z=_.stateNode,se=_.memoizedProps;try{Z.nodeValue=se}catch(or){Xn(_,_.return,or)}}break;case 3:if(p(w,_),S(_),B&4&&k!==null&&k.memoizedState.isDehydrated)try{wu(w.containerInfo)}catch(or){Xn(_,_.return,or)}break;case 4:p(w,_),S(_);break;case 13:p(w,_),S(_),Z=_.child,Z.flags&8192&&(se=Z.memoizedState!==null,Z.stateNode.isHidden=se,!se||Z.alternate!==null&&Z.alternate.memoizedState!==null||(Ge=mr())),B&4&&c(_);break;case 22:if(dn=k!==null&&k.memoizedState!==null,_.mode&1?(Xr=(Et=Xr)||dn,p(w,_),Xr=Et):p(w,_),S(_),B&8192){if(Et=_.memoizedState!==null,(_.stateNode.isHidden=Et)&&!dn&&(_.mode&1)!==0)for(qn=_,dn=_.child;dn!==null;){for(mn=qn=dn;qn!==null;){switch(an=qn,Wn=an.child,an.tag){case 0:case 11:case 14:case 15:Qu(4,an,an.return);break;case 1:vc(an,an.return);var tr=an.stateNode;if(typeof tr.componentWillUnmount=="function"){B=an,k=an.return;try{w=B,tr.props=w.memoizedProps,tr.state=w.memoizedState,tr.componentWillUnmount()}catch(or){Xn(B,k,or)}}break;case 5:vc(an,an.return);break;case 22:if(an.memoizedState!==null){z(mn);continue}}Wn!==null?(Wn.return=an,qn=Wn):z(mn)}dn=dn.sibling}e:for(dn=null,mn=_;;){if(mn.tag===5){if(dn===null){dn=mn;try{Z=mn.stateNode,Et?(se=Z.style,typeof se.setProperty=="function"?se.setProperty("display","none","important"):se.display="none"):(He=mn.stateNode,Qe=mn.memoizedProps.style,we=Qe!=null&&Qe.hasOwnProperty("display")?Qe.display:null,He.style.display=Ta("display",we))}catch(or){Xn(_,_.return,or)}}}else if(mn.tag===6){if(dn===null)try{mn.stateNode.nodeValue=Et?"":mn.memoizedProps}catch(or){Xn(_,_.return,or)}}else if((mn.tag!==22&&mn.tag!==23||mn.memoizedState===null||mn===_)&&mn.child!==null){mn.child.return=mn,mn=mn.child;continue}if(mn===_)break e;for(;mn.sibling===null;){if(mn.return===null||mn.return===_)break e;dn===mn&&(dn=null),mn=mn.return}dn===mn&&(dn=null),mn.sibling.return=mn.return,mn=mn.sibling}}break;case 19:p(w,_),S(_),B&4&&c(_);break;case 21:break;default:p(w,_),S(_)}}function S(_){var w=_.flags;if(w&2){try{e:{for(var k=_.return;k!==null;){if(id(k)){var B=k;break e}k=k.return}throw Error(s(160))}switch(B.tag){case 5:var Z=B.stateNode;B.flags&32&&(Fo(Z,""),B.flags&=-33);var se=th(_);Da(_,se,Z);break;case 3:case 4:var we=B.stateNode.containerInfo,He=th(_);_l(_,He,we);break;default:throw Error(s(161))}}catch(Qe){Xn(_,_.return,Qe)}_.flags&=-3}w&4096&&(_.flags&=-4097)}function E(_,w,k){qn=_,M(_)}function M(_,w,k){for(var B=(_.mode&1)!==0;qn!==null;){var Z=qn,se=Z.child;if(Z.tag===22&&B){var we=Z.memoizedState!==null||Ju;if(!we){var He=Z.alternate,Qe=He!==null&&He.memoizedState!==null||Xr;He=Ju;var Et=Xr;if(Ju=we,(Xr=Qe)&&!Et)for(qn=Z;qn!==null;)we=qn,Qe=we.child,we.tag===22&&we.memoizedState!==null?F(Z):Qe!==null?(Qe.return=we,qn=Qe):F(Z);for(;se!==null;)qn=se,M(se),se=se.sibling;qn=Z,Ju=He,Xr=Et}R(_)}else(Z.subtreeFlags&8772)!==0&&se!==null?(se.return=Z,qn=se):R(_)}}function R(_){for(;qn!==null;){var w=qn;if((w.flags&8772)!==0){var k=w.alternate;try{if((w.flags&8772)!==0)switch(w.tag){case 0:case 11:case 15:Xr||Na(5,w);break;case 1:var B=w.stateNode;if(w.flags&4&&!Xr)if(k===null)B.componentDidMount();else{var Z=w.elementType===w.type?k.memoizedProps:Mo(w.type,k.memoizedProps);B.componentDidUpdate(Z,k.memoizedState,B.__reactInternalSnapshotBeforeUpdate)}var se=w.updateQueue;se!==null&&Og(w,se,B);break;case 3:var we=w.updateQueue;if(we!==null){if(k=null,w.child!==null)switch(w.child.tag){case 5:k=w.child.stateNode;break;case 1:k=w.child.stateNode}Og(w,we,k)}break;case 5:var He=w.stateNode;if(k===null&&w.flags&4){k=He;var Qe=w.memoizedProps;switch(w.type){case"button":case"input":case"select":case"textarea":Qe.autoFocus&&k.focus();break;case"img":Qe.src&&(k.src=Qe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(w.memoizedState===null){var Et=w.alternate;if(Et!==null){var dn=Et.memoizedState;if(dn!==null){var mn=dn.dehydrated;mn!==null&&wu(mn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Xr||w.flags&512&&eh(w)}catch(an){Xn(w,w.return,an)}}if(w===_){qn=null;break}if(k=w.sibling,k!==null){k.return=w.return,qn=k;break}qn=w.return}}function z(_){for(;qn!==null;){var w=qn;if(w===_){qn=null;break}var k=w.sibling;if(k!==null){k.return=w.return,qn=k;break}qn=w.return}}function F(_){for(;qn!==null;){var w=qn;try{switch(w.tag){case 0:case 11:case 15:var k=w.return;try{Na(4,w)}catch(Qe){Xn(w,k,Qe)}break;case 1:var B=w.stateNode;if(typeof B.componentDidMount=="function"){var Z=w.return;try{B.componentDidMount()}catch(Qe){Xn(w,Z,Qe)}}var se=w.return;try{eh(w)}catch(Qe){Xn(w,se,Qe)}break;case 5:var we=w.return;try{eh(w)}catch(Qe){Xn(w,we,Qe)}}}catch(Qe){Xn(w,w.return,Qe)}if(w===_){qn=null;break}var He=w.sibling;if(He!==null){He.return=w.return,qn=He;break}qn=w.return}}var G=Math.ceil,$=ht.ReactCurrentDispatcher,q=ht.ReactCurrentOwner,ne=ht.ReactCurrentBatchConfig,J=0,ie=null,oe=null,ce=0,ge=0,xe=Dl(0),Ce=0,Ae=null,Te=0,be=0,Ie=0,Re=null,Be=null,Ge=0,st=1/0,it=null,mt=!1,Ue=null,Je=null,Le=!1,lt=null,Ye=0,pt=0,It=null,ct=-1,wt=0;function Vt(){return(J&6)!==0?mr():ct!==-1?ct:ct=mr()}function qt(_){return(_.mode&1)===0?1:(J&2)!==0&&ce!==0?ce&-ce:Jy.transition!==null?(wt===0&&(wt=Wa()),wt):(_=pi,_!==0||(_=window.event,_=_===void 0?16:jc(_.type)),_)}function Bt(_,w,k,B){if(50<pt)throw pt=0,It=null,Error(s(185));Eo(_,k,B),((J&2)===0||_!==ie)&&(_===ie&&((J&2)===0&&(be|=k),Ce===4&&br(_,ce)),Xt(_,B),k===1&&J===0&&(w.mode&1)===0&&(st=mr()+500,Bh&&la()))}function Xt(_,w){var k=_.callbackNode;bd(_,w);var B=yu(_,_===ie?ce:0);if(B===0)k!==null&&rr(k),_.callbackNode=null,_.callbackPriority=0;else if(w=B&-B,_.callbackPriority!==w){if(k!=null&&rr(k),w===1)_.tag===0?Ng(oi.bind(null,_)):Em(oi.bind(null,_)),Oh(function(){(J&6)===0&&la()}),k=null;else{switch(_h(B)){case 1:k=Fr;break;case 4:k=Nr;break;case 16:k=ji;break;case 536870912:k=Ri;break;default:k=ji}k=Ro(k,hn.bind(null,_))}_.callbackPriority=w,_.callbackNode=k}}function hn(_,w){if(ct=-1,wt=0,(J&6)!==0)throw Error(s(327));var k=_.callbackNode;if(Gr()&&_.callbackNode!==k)return null;var B=yu(_,_===ie?ce:0);if(B===0)return null;if((B&30)!==0||(B&_.expiredLanes)!==0||w)w=Ji(_,B);else{w=B;var Z=J;J|=2;var se=cr();(ie!==_||ce!==w)&&(it=null,st=mr()+500,Vn(_,w));do try{Lr();break}catch(He){er(_,He)}while(!0);Qc(),$.current=se,J=Z,oe!==null?w=0:(ie=null,ce=0,w=Ce)}if(w!==0){if(w===2&&(Z=yh(_),Z!==0&&(B=Z,w=yn(_,Z))),w===1)throw k=Ae,Vn(_,0),br(_,B),Xt(_,mr()),k;if(w===6)br(_,B);else{if(Z=_.current.alternate,(B&30)===0&&!Qn(Z)&&(w=Ji(_,B),w===2&&(se=yh(_),se!==0&&(B=se,w=yn(_,se))),w===1))throw k=Ae,Vn(_,0),br(_,B),Xt(_,mr()),k;switch(_.finishedWork=Z,_.finishedLanes=B,w){case 0:case 1:throw Error(s(345));case 2:Bi(_,Be,it);break;case 3:if(br(_,B),(B&130023424)===B&&(w=Ge+500-mr(),10<w)){if(yu(_,0)!==0)break;if(Z=_.suspendedLanes,(Z&B)!==B){Vt(),_.pingedLanes|=_.suspendedLanes&Z;break}_.timeoutHandle=Wf(Bi.bind(null,_,Be,it),w);break}Bi(_,Be,it);break;case 4:if(br(_,B),(B&4194240)===B)break;for(w=_.eventTimes,Z=-1;0<B;){var we=31-Bo(B);se=1<<we,we=w[we],we>Z&&(Z=we),B&=~se}if(B=Z,B=mr()-B,B=(120>B?120:480>B?480:1080>B?1080:1920>B?1920:3e3>B?3e3:4320>B?4320:1960*G(B/1960))-B,10<B){_.timeoutHandle=Wf(Bi.bind(null,_,Be,it),B);break}Bi(_,Be,it);break;case 5:Bi(_,Be,it);break;default:throw Error(s(329))}}}return Xt(_,mr()),_.callbackNode===k?hn.bind(null,_):null}function yn(_,w){var k=Re;return _.current.memoizedState.isDehydrated&&(Vn(_,w).flags|=256),_=Ji(_,w),_!==2&&(w=Be,Be=k,w!==null&&Ln(w)),_}function Ln(_){Be===null?Be=_:Be.push.apply(Be,_)}function Qn(_){for(var w=_;;){if(w.flags&16384){var k=w.updateQueue;if(k!==null&&(k=k.stores,k!==null))for(var B=0;B<k.length;B++){var Z=k[B],se=Z.getSnapshot;Z=Z.value;try{if(!Ja(se(),Z))return!1}catch{return!1}}}if(k=w.child,w.subtreeFlags&16384&&k!==null)k.return=w,w=k;else{if(w===_)break;for(;w.sibling===null;){if(w.return===null||w.return===_)return!0;w=w.return}w.sibling.return=w.return,w=w.sibling}}return!0}function br(_,w){for(w&=~Ie,w&=~be,_.suspendedLanes|=w,_.pingedLanes&=~w,_=_.expirationTimes;0<w;){var k=31-Bo(w),B=1<<k;_[k]=-1,w&=~B}}function oi(_){if((J&6)!==0)throw Error(s(327));Gr();var w=yu(_,0);if((w&1)===0)return Xt(_,mr()),null;var k=Ji(_,w);if(_.tag!==0&&k===2){var B=yh(_);B!==0&&(w=B,k=yn(_,B))}if(k===1)throw k=Ae,Vn(_,0),br(_,w),Xt(_,mr()),k;if(k===6)throw Error(s(345));return _.finishedWork=_.current.alternate,_.finishedLanes=w,Bi(_,Be,it),Xt(_,mr()),null}function Vr(_,w){var k=J;J|=1;try{return _(w)}finally{J=k,J===0&&(st=mr()+500,Bh&&la())}}function Pr(_){lt!==null&&lt.tag===0&&(J&6)===0&&Gr();var w=J;J|=1;var k=ne.transition,B=pi;try{if(ne.transition=null,pi=1,_)return _()}finally{pi=B,ne.transition=k,J=w,(J&6)===0&&la()}}function $i(){ge=xe.current,ts(xe)}function Vn(_,w){_.finishedWork=null,_.finishedLanes=0;var k=_.timeoutHandle;if(k!==-1&&(_.timeoutHandle=-1,Sm(k)),oe!==null)for(k=oe.return;k!==null;){var B=k;switch(ep(B),B.tag){case 1:B=B.type.childContextTypes,B!=null&&zu();break;case 3:ua(),ts($o),ts(bs),pl();break;case 5:Wh(B);break;case 4:ua();break;case 13:ts(rs);break;case 19:ts(rs);break;case 10:Gh(B.type._context);break;case 22:case 23:$i()}k=k.return}if(ie=_,oe=_=Ko(_.current,null),ce=ge=w,Ce=0,Ae=null,Ie=be=Te=0,Be=Re=null,Go!==null){for(w=0;w<Go.length;w++)if(k=Go[w],B=k.interleaved,B!==null){k.interleaved=null;var Z=B.next,se=k.pending;if(se!==null){var we=se.next;se.next=Z,B.next=we}k.pending=B}Go=null}return _}function er(_,w){do{var k=oe;try{if(Qc(),Hr.current=yl,ip){for(var B=fs.memoizedState;B!==null;){var Z=B.queue;Z!==null&&(Z.pending=null),B=B.next}ip=!1}if(ha=0,Ks=js=fs=null,Vl=!1,ml=0,q.current=null,k===null||k.return===null){Ce=1,Ae=w,oe=null;break}e:{var se=_,we=k.return,He=k,Qe=w;if(w=ce,He.flags|=32768,Qe!==null&&typeof Qe=="object"&&typeof Qe.then=="function"){var Et=Qe,dn=He,mn=dn.tag;if((dn.mode&1)===0&&(mn===0||mn===11||mn===15)){var an=dn.alternate;an?(dn.updateQueue=an.updateQueue,dn.memoizedState=an.memoizedState,dn.lanes=an.lanes):(dn.updateQueue=null,dn.memoizedState=null)}var Wn=mp(we);if(Wn!==null){Wn.flags&=-257,nf(Wn,we,He,se,w),Wn.mode&1&&Qh(se,Et,w),w=Wn,Qe=Et;var tr=w.updateQueue;if(tr===null){var or=new Set;or.add(Qe),w.updateQueue=or}else tr.add(Qe);break e}else{if((w&1)===0){Qh(se,Et,w),ai();break e}Qe=Error(s(426))}}else if(ls&&He.mode&1){var Vs=mp(we);if(Vs!==null){(Vs.flags&65536)===0&&(Vs.flags|=256),nf(Vs,we,He,se,w),ca(Gl(Qe,He));break e}}se=Qe=Gl(Qe,He),Ce!==4&&(Ce=2),Re===null?Re=[se]:Re.push(se),se=we;do{switch(se.tag){case 3:se.flags|=65536,w&=-w,se.lanes|=w;var yt=pp(se,Qe,w);np(se,yt);break e;case 1:He=Qe;var ut=se.type,bt=se.stateNode;if((se.flags&128)===0&&(typeof ut.getDerivedStateFromError=="function"||bt!==null&&typeof bt.componentDidCatch=="function"&&(Je===null||!Je.has(bt)))){se.flags|=65536,w&=-w,se.lanes|=w;var Sn=_c(se,He,w);np(se,Sn);break e}}se=se.return}while(se!==null)}vr(k)}catch(dr){w=dr,oe===k&&k!==null&&(oe=k=k.return);continue}break}while(!0)}function cr(){var _=$.current;return $.current=yl,_===null?yl:_}function ai(){(Ce===0||Ce===3||Ce===2)&&(Ce=4),ie===null||(Te&268435455)===0&&(be&268435455)===0||br(ie,ce)}function Ji(_,w){var k=J;J|=2;var B=cr();(ie!==_||ce!==w)&&(it=null,Vn(_,w));do try{hi();break}catch(Z){er(_,Z)}while(!0);if(Qc(),J=k,$.current=B,oe!==null)throw Error(s(261));return ie=null,ce=0,Ce}function hi(){for(;oe!==null;)Fi(oe)}function Lr(){for(;oe!==null&&!Hn();)Fi(oe)}function Fi(_){var w=Zo(_.alternate,_,ge);_.memoizedProps=_.pendingProps,w===null?vr(_):oe=w,q.current=null}function vr(_){var w=_;do{var k=w.alternate;if(_=w.return,(w.flags&32768)===0){if(k=cf(k,w,ge),k!==null){oe=k;return}}else{if(k=xc(k,w),k!==null){k.flags&=32767,oe=k;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{Ce=6,oe=null;return}}if(w=w.sibling,w!==null){oe=w;return}oe=w=_}while(w!==null);Ce===0&&(Ce=5)}function Bi(_,w,k){var B=pi,Z=ne.transition;try{ne.transition=null,pi=1,gi(_,w,k,B)}finally{ne.transition=Z,pi=B}return null}function gi(_,w,k,B){do Gr();while(lt!==null);if((J&6)!==0)throw Error(s(327));k=_.finishedWork;var Z=_.finishedLanes;if(k===null)return null;if(_.finishedWork=null,_.finishedLanes=0,k===_.current)throw Error(s(177));_.callbackNode=null,_.callbackPriority=0;var se=k.lanes|k.childLanes;if(ec(_,se),_===ie&&(oe=ie=null,ce=0),(k.subtreeFlags&2064)===0&&(k.flags&2064)===0||Le||(Le=!0,Ro(ji,function(){return Gr(),null})),se=(k.flags&15990)!==0,(k.subtreeFlags&15990)!==0||se){se=ne.transition,ne.transition=null;var we=pi;pi=1;var He=J;J|=4,q.current=null,rd(_,k),x(k,_),xo(Dh),Ed=!!Nh,Dh=Nh=null,_.current=k,E(k),ri(),J=He,pi=we,ne.transition=se}else _.current=k;if(Le&&(Le=!1,lt=_,Ye=Z),se=_.pendingLanes,se===0&&(Je=null),yo(k.stateNode),Xt(_,mr()),w!==null)for(B=_.onRecoverableError,k=0;k<w.length;k++)Z=w[k],B(Z.value,{componentStack:Z.stack,digest:Z.digest});if(mt)throw mt=!1,_=Ue,Ue=null,_;return(Ye&1)!==0&&_.tag!==0&&Gr(),se=_.pendingLanes,(se&1)!==0?_===It?pt++:(pt=0,It=_):pt=0,la(),null}function Gr(){if(lt!==null){var _=_h(Ye),w=ne.transition,k=pi;try{if(ne.transition=null,pi=16>_?16:_,lt===null)var B=!1;else{if(_=lt,lt=null,Ye=0,(J&6)!==0)throw Error(s(331));var Z=J;for(J|=4,qn=_.current;qn!==null;){var se=qn,we=se.child;if((qn.flags&16)!==0){var He=se.deletions;if(He!==null){for(var Qe=0;Qe<He.length;Qe++){var Et=He[Qe];for(qn=Et;qn!==null;){var dn=qn;switch(dn.tag){case 0:case 11:case 15:Qu(8,dn,se)}var mn=dn.child;if(mn!==null)mn.return=dn,qn=mn;else for(;qn!==null;){dn=qn;var an=dn.sibling,Wn=dn.return;if(bp(dn),dn===Et){qn=null;break}if(an!==null){an.return=Wn,qn=an;break}qn=Wn}}}var tr=se.alternate;if(tr!==null){var or=tr.child;if(or!==null){tr.child=null;do{var Vs=or.sibling;or.sibling=null,or=Vs}while(or!==null)}}qn=se}}if((se.subtreeFlags&2064)!==0&&we!==null)we.return=se,qn=we;else e:for(;qn!==null;){if(se=qn,(se.flags&2048)!==0)switch(se.tag){case 0:case 11:case 15:Qu(9,se,se.return)}var yt=se.sibling;if(yt!==null){yt.return=se.return,qn=yt;break e}qn=se.return}}var ut=_.current;for(qn=ut;qn!==null;){we=qn;var bt=we.child;if((we.subtreeFlags&2064)!==0&&bt!==null)bt.return=we,qn=bt;else e:for(we=ut;qn!==null;){if(He=qn,(He.flags&2048)!==0)try{switch(He.tag){case 0:case 11:case 15:Na(9,He)}}catch(dr){Xn(He,He.return,dr)}if(He===we){qn=null;break e}var Sn=He.sibling;if(Sn!==null){Sn.return=He.return,qn=Sn;break e}qn=He.return}}if(J=Z,la(),hs&&typeof hs.onPostCommitFiberRoot=="function")try{hs.onPostCommitFiberRoot(gs,_)}catch{}B=!0}return B}finally{pi=k,ne.transition=w}}return!1}function di(_,w,k){w=Gl(k,w),w=pp(_,w,1),_=tu(_,w,1),w=Vt(),_!==null&&(Eo(_,1,w),Xt(_,w))}function Xn(_,w,k){if(_.tag===3)di(_,_,k);else for(;w!==null;){if(w.tag===3){di(w,_,k);break}else if(w.tag===1){var B=w.stateNode;if(typeof w.type.getDerivedStateFromError=="function"||typeof B.componentDidCatch=="function"&&(Je===null||!Je.has(B))){_=Gl(k,_),_=_c(w,_,1),w=tu(w,_,1),_=Vt(),w!==null&&(Eo(w,1,_),Xt(w,_));break}}w=w.return}}function Gi(_,w,k){var B=_.pingCache;B!==null&&B.delete(w),w=Vt(),_.pingedLanes|=_.suspendedLanes&k,ie===_&&(ce&k)===k&&(Ce===4||Ce===3&&(ce&130023424)===ce&&500>mr()-Ge?Vn(_,0):Ie|=k),Xt(_,w)}function Bs(_,w){w===0&&((_.mode&1)===0?w=1:(w=Rc,Rc<<=1,(Rc&130023424)===0&&(Rc=4194304)));var k=Vt();_=jl(_,w),_!==null&&(Eo(_,w,k),Xt(_,k))}function wi(_){var w=_.memoizedState,k=0;w!==null&&(k=w.retryLane),Bs(_,k)}function Dr(_,w){var k=0;switch(_.tag){case 13:var B=_.stateNode,Z=_.memoizedState;Z!==null&&(k=Z.retryLane);break;case 19:B=_.stateNode;break;default:throw Error(s(314))}B!==null&&B.delete(w),Bs(_,k)}var Zo;Zo=function(_,w,k){if(_!==null)if(_.memoizedProps!==w.pendingProps||$o.current)ko=!0;else{if((_.lanes&k)===0&&(w.flags&128)===0)return ko=!1,Vg(_,w,k);ko=(_.flags&131072)!==0}else ko=!1,ls&&(w.flags&1048576)!==0&&Qf(w,Jf,w.index);switch(w.lanes=0,w.tag){case 2:var B=w.type;Ku(_,w),_=w.pendingProps;var Z=uc(w,bs.current);eu(w,k),Z=Di(null,w,B,_,Z,k);var se=$e();return w.flags|=1,typeof Z=="object"&&Z!==null&&typeof Z.render=="function"&&Z.$$typeof===void 0?(w.tag=1,w.memoizedState=null,w.updateQueue=null,io(B)?(se=!0,ju(w)):se=!1,w.memoizedState=Z.state!==null&&Z.state!==void 0?Z.state:null,Fl(w),Z.updater=gc,w.stateNode=Z,Z._reactInternals=w,tf(w,B,_,k),w=yp(null,w,B,!0,se,k)):(w.tag=0,ls&&se&&Ud(w),Ys(null,w,Z,k),w=w.child),w;case 16:B=w.elementType;e:{switch(Ku(_,w),_=w.pendingProps,Z=B._init,B=Z(B._payload),w.type=B,Z=w.tag=Xo(B),_=Mo(B,_),Z){case 0:w=td(null,w,B,_,k);break e;case 1:w=Nm(null,w,B,_,k);break e;case 11:w=Xu(null,w,B,_,k);break e;case 14:w=ed(null,w,B,Mo(B.type,_),k);break e}throw Error(s(306,B,""))}return w;case 0:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),td(_,w,B,Z,k);case 1:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Nm(_,w,B,Z,k);case 3:e:{if(Dm(w),_===null)throw Error(s(387));B=w.pendingProps,se=w.memoizedState,Z=se.element,vn(_,w),Zd(w,B,null,k);var we=w.memoizedState;if(B=we.element,se.isDehydrated)if(se={element:B,isDehydrated:!1,cache:we.cache,pendingSuspenseBoundaries:we.pendingSuspenseBoundaries,transitions:we.transitions},w.updateQueue.baseState=se,w.memoizedState=se,w.flags&256){Z=Gl(Error(s(423)),w),w=Om(_,w,B,k,Z);break e}else if(B!==Z){Z=Gl(Error(s(424)),w),w=Om(_,w,B,k,Z);break e}else for(Xs=kl(w.stateNode.containerInfo.firstChild),Ls=w,ls=!0,so=null,k=zl(w,null,B,k),w.child=k;k;)k.flags=k.flags&-3|4096,k=k.sibling;else{if(Vu(),B===Z){w=si(_,w,k);break e}Ys(_,w,B,k)}w=w.child}return w;case 5:return nu(w),_===null&&Gd(w),B=w.type,Z=w.pendingProps,se=_!==null?_.memoizedProps:null,we=Z.children,Wc(B,Z)?we=null:se!==null&&Wc(B,se)&&(w.flags|=32),Rm(_,w),Ys(_,w,we,k),w.child;case 6:return _===null&&Gd(w),null;case 13:return Lm(_,w,k);case 4:return ao(w,w.stateNode.containerInfo),B=w.pendingProps,_===null?w.child=hc(w,null,B,k):Ys(_,w,B,k),w.child;case 11:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Xu(_,w,B,Z,k);case 7:return Ys(_,w,w.pendingProps,k),w.child;case 8:return Ys(_,w,w.pendingProps.children,k),w.child;case 12:return Ys(_,w,w.pendingProps.children,k),w.child;case 10:e:{if(B=w.type._context,Z=w.pendingProps,se=w.memoizedProps,we=Z.value,ns(Kc,B._currentValue),B._currentValue=we,se!==null)if(Ja(se.value,we)){if(se.children===Z.children&&!$o.current){w=si(_,w,k);break e}}else for(se=w.child,se!==null&&(se.return=w);se!==null;){var He=se.dependencies;if(He!==null){we=se.child;for(var Qe=He.firstContext;Qe!==null;){if(Qe.context===B){if(se.tag===1){Qe=Ra(-1,k&-k),Qe.tag=2;var Et=se.updateQueue;if(Et!==null){Et=Et.shared;var dn=Et.pending;dn===null?Qe.next=Qe:(Qe.next=dn.next,dn.next=Qe),Et.pending=Qe}}se.lanes|=k,Qe=se.alternate,Qe!==null&&(Qe.lanes|=k),Wd(se.return,k,w),He.lanes|=k;break}Qe=Qe.next}}else if(se.tag===10)we=se.type===w.type?null:se.child;else if(se.tag===18){if(we=se.return,we===null)throw Error(s(341));we.lanes|=k,He=we.alternate,He!==null&&(He.lanes|=k),Wd(we,k,w),we=se.sibling}else we=se.child;if(we!==null)we.return=se;else for(we=se;we!==null;){if(we===w){we=null;break}if(se=we.sibling,se!==null){se.return=we.return,we=se;break}we=we.return}se=we}Ys(_,w,Z.children,k),w=w.child}return w;case 9:return Z=w.type,B=w.pendingProps.children,eu(w,k),Z=zs(Z),B=B(Z),w.flags|=1,Ys(_,w,B,k),w.child;case 14:return B=w.type,Z=Mo(B,w.pendingProps),Z=Mo(B.type,Z),ed(_,w,B,Z,k);case 15:return gp(_,w,w.type,w.pendingProps,k);case 17:return B=w.type,Z=w.pendingProps,Z=w.elementType===B?Z:Mo(B,Z),Ku(_,w),w.tag=1,io(B)?(_=!0,ju(w)):_=!1,eu(w,k),fp(w,B,Z),tf(w,B,Z,k),yp(null,w,B,!0,_,k);case 19:return Bg(_,w,k);case 22:return rf(_,w,k)}throw Error(s(156,w.tag))};function Ro(_,w){return Un(_,w)}function Oa(_,w,k,B){this.tag=_,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=w,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=B,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ws(_,w,k,B){return new Oa(_,w,k,B)}function da(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Xo(_){if(typeof _=="function")return da(_)?1:0;if(_!=null){if(_=_.$$typeof,_===Tn)return 11;if(_===wn)return 14}return 2}function Ko(_,w){var k=_.alternate;return k===null?(k=ws(_.tag,w,_.key,_.mode),k.elementType=_.elementType,k.type=_.type,k.stateNode=_.stateNode,k.alternate=_,_.alternate=k):(k.pendingProps=w,k.type=_.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=_.flags&14680064,k.childLanes=_.childLanes,k.lanes=_.lanes,k.child=_.child,k.memoizedProps=_.memoizedProps,k.memoizedState=_.memoizedState,k.updateQueue=_.updateQueue,w=_.dependencies,k.dependencies=w===null?null:{lanes:w.lanes,firstContext:w.firstContext},k.sibling=_.sibling,k.index=_.index,k.ref=_.ref,k}function fa(_,w,k,B,Z,se){var we=2;if(B=_,typeof _=="function")da(_)&&(we=1);else if(typeof _=="string")we=5;else e:switch(_){case kt:return pa(k.children,Z,se,w);case Rt:we=8,Z|=8;break;case fn:return _=ws(12,k,w,Z|2),_.elementType=fn,_.lanes=se,_;case Bn:return _=ws(13,k,w,Z),_.elementType=Bn,_.lanes=se,_;case Ft:return _=ws(19,k,w,Z),_.elementType=Ft,_.lanes=se,_;case Cn:return su(k,Z,se,w);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case En:we=10;break e;case xn:we=9;break e;case Tn:we=11;break e;case wn:we=14;break e;case Yt:we=16,B=null;break e}throw Error(s(130,_==null?_:typeof _,""))}return w=ws(we,k,w,Z),w.elementType=_,w.type=B,w.lanes=se,w}function pa(_,w,k,B){return _=ws(7,_,B,w),_.lanes=k,_}function su(_,w,k,B){return _=ws(22,_,B,w),_.elementType=Cn,_.lanes=k,_.stateNode={isHidden:!1},_}function uf(_,w,k){return _=ws(6,_,null,w),_.lanes=k,_}function ou(_,w,k){return w=ws(4,_.children!==null?_.children:[],_.key,w),w.lanes=k,w.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},w}function Bm(_,w,k,B,Z){this.tag=w,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Vo(0),this.expirationTimes=Vo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vo(0),this.identifierPrefix=B,this.onRecoverableError=Z,this.mutableSourceEagerHydrationData=null}function nh(_,w,k,B,Z,se,we,He,Qe){return _=new Bm(_,w,k,He,Qe),w===1?(w=1,se===!0&&(w|=8)):w=0,se=ws(3,null,null,w),_.current=se,se.stateNode=_,se.memoizedState={element:B,isDehydrated:k,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fl(se),_}function wp(_,w,k){var B=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Dt,key:B==null?null:""+B,children:_,containerInfo:w,implementation:k}}function hf(_){if(!_)return oa;_=_._reactInternals;e:{if(Ze(_)!==_||_.tag!==1)throw Error(s(170));var w=_;do{switch(w.tag){case 3:w=w.stateNode.context;break e;case 1:if(io(w.type)){w=w.stateNode.__reactInternalMemoizedMergedChildContext;break e}}w=w.return}while(w!==null);throw Error(s(171))}if(_.tag===1){var k=_.type;if(io(k))return Kf(_,k,w)}return w}function xl(_,w,k,B,Z,se,we,He,Qe){return _=nh(k,B,!0,_,Z,se,we,He,Qe),_.context=hf(null),k=_.current,B=Vt(),Z=qt(k),se=Ra(B,Z),se.callback=w??null,tu(k,se,Z),_.current.lanes=Z,Eo(_,Z,B),Xt(_,B),_}function bc(_,w,k,B){var Z=w.current,se=Vt(),we=qt(Z);return k=hf(k),w.context===null?w.context=k:w.pendingContext=k,w=Ra(se,we),w.payload={element:_},B=B===void 0?null:B,B!==null&&(w.callback=B),_=tu(Z,w,we),_!==null&&(Bt(_,Z,we,se),tp(_,Z,we)),we}function Wl(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return _.child.stateNode;default:return _.child.stateNode}}function wc(_,w){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var k=_.retryLane;_.retryLane=k!==0&&k<w?k:w}}function Vm(_,w){wc(_,w),(_=_.alternate)&&wc(_,w)}function Sp(){return null}var Um=typeof reportError=="function"?reportError:function(_){console.error(_)};function $g(_){this._internalRoot=_}$m.prototype.render=$g.prototype.render=function(_){var w=this._internalRoot;if(w===null)throw Error(s(409));bc(_,w,null,null)},$m.prototype.unmount=$g.prototype.unmount=function(){var _=this._internalRoot;if(_!==null){this._internalRoot=null;var w=_.containerInfo;Pr(function(){bc(null,_,null,null)}),w[Rl]=null}};function $m(_){this._internalRoot=_}$m.prototype.unstable_scheduleHydration=function(_){if(_){var w=vu();_={blockedOn:null,target:_,priority:w};for(var k=0;k<Xa.length&&w!==0&&w<Xa[k].priority;k++);Xa.splice(k,0,_),k===0&&Ig(_)}};function Hg(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)}function Hm(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11&&(_.nodeType!==8||_.nodeValue!==" react-mount-point-unstable "))}function Qy(){}function df(_,w,k,B,Z){if(Z){if(typeof B=="function"){var se=B;B=function(){var Et=Wl(we);se.call(Et)}}var we=xl(w,B,_,0,null,!1,!1,"",Qy);return _._reactRootContainer=we,_[Rl]=we.current,jd(_.nodeType===8?_.parentNode:_),Pr(),we}for(;Z=_.lastChild;)_.removeChild(Z);if(typeof B=="function"){var He=B;B=function(){var Et=Wl(Qe);He.call(Et)}}var Qe=nh(_,0,!1,null,null,!1,!1,"",Qy);return _._reactRootContainer=Qe,_[Rl]=Qe.current,jd(_.nodeType===8?_.parentNode:_),Pr(function(){bc(w,Qe,k,B)}),Qe}function Gm(_,w,k,B,Z){var se=k._reactRootContainer;if(se){var we=se;if(typeof Z=="function"){var He=Z;Z=function(){var Qe=Wl(we);He.call(Qe)}}bc(w,we,_,Z)}else we=df(k,w,_,Z,B);return Wl(we)}ll=function(_){switch(_.tag){case 3:var w=_.stateNode;if(w.current.memoizedState.isDehydrated){var k=Nc(w.pendingLanes);k!==0&&(Aa(w,k|1),Xt(w,mr()),(J&6)===0&&(st=mr()+500,la()))}break;case 13:Pr(function(){var B=jl(_,1);if(B!==null){var Z=Vt();Bt(B,_,1,Z)}}),Vm(_,1)}},xu=function(_){if(_.tag===13){var w=jl(_,134217728);if(w!==null){var k=Vt();Bt(w,_,134217728,k)}Vm(_,134217728)}},Dc=function(_){if(_.tag===13){var w=qt(_),k=jl(_,w);if(k!==null){var B=Vt();Bt(k,_,w,B)}Vm(_,w)}},vu=function(){return pi},Nf=function(_,w){var k=pi;try{return pi=_,w()}finally{pi=k}},fi=function(_,w,k){switch(w){case"input":if(mo(_,k),w=k.name,k.type==="radio"&&w!=null){for(k=_;k.parentNode;)k=k.parentNode;for(k=k.querySelectorAll("input[name="+JSON.stringify(""+w)+'][type="radio"]'),w=0;w<k.length;w++){var B=k[w];if(B!==_&&B.form===_.form){var Z=Lu(B);if(!Z)throw Error(s(90));ni(B),mo(B,Z)}}}break;case"textarea":Cs(_,k);break;case"select":w=k.value,w!=null&&to(_,!!k.multiple,w,!1)}},qa=Vr,gh=Pr;var No={usingClientEntryPoint:!1,Events:[Vd,Zc,Lu,Ga,Ot,Vr]},au={findFiberByHostInstance:Ou,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},R1={bundleType:au.bundleType,version:au.version,rendererPackageName:au.rendererPackageName,rendererConfig:au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ht.ReactCurrentDispatcher,findHostInstanceByFiber:function(_){return _=Wt(_),_===null?null:_.stateNode},findFiberByHostInstance:au.findFiberByHostInstance||Sp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gg.isDisabled&&Gg.supportsFiber)try{gs=Gg.inject(R1),hs=Gg}catch{}}return Xl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=No,Xl.createPortal=function(_,w){var k=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hg(w))throw Error(s(200));return wp(_,w,null,k)},Xl.createRoot=function(_,w){if(!Hg(_))throw Error(s(299));var k=!1,B="",Z=Um;return w!=null&&(w.unstable_strictMode===!0&&(k=!0),w.identifierPrefix!==void 0&&(B=w.identifierPrefix),w.onRecoverableError!==void 0&&(Z=w.onRecoverableError)),w=nh(_,1,!1,null,null,k,!1,B,Z),_[Rl]=w.current,jd(_.nodeType===8?_.parentNode:_),new $g(w)},Xl.findDOMNode=function(_){if(_==null)return null;if(_.nodeType===1)return _;var w=_._reactInternals;if(w===void 0)throw typeof _.render=="function"?Error(s(188)):(_=Object.keys(_).join(","),Error(s(268,_)));return _=Wt(w),_=_===null?null:_.stateNode,_},Xl.flushSync=function(_){return Pr(_)},Xl.hydrate=function(_,w,k){if(!Hm(w))throw Error(s(200));return Gm(null,_,w,!0,k)},Xl.hydrateRoot=function(_,w,k){if(!Hg(_))throw Error(s(405));var B=k!=null&&k.hydratedSources||null,Z=!1,se="",we=Um;if(k!=null&&(k.unstable_strictMode===!0&&(Z=!0),k.identifierPrefix!==void 0&&(se=k.identifierPrefix),k.onRecoverableError!==void 0&&(we=k.onRecoverableError)),w=xl(w,null,_,1,k??null,Z,!1,se,we),_[Rl]=w.current,jd(_),B)for(_=0;_<B.length;_++)k=B[_],Z=k._getVersion,Z=Z(k._source),w.mutableSourceEagerHydrationData==null?w.mutableSourceEagerHydrationData=[k,Z]:w.mutableSourceEagerHydrationData.push(k,Z);return new $m(w)},Xl.render=function(_,w,k){if(!Hm(w))throw Error(s(200));return Gm(null,_,w,!1,k)},Xl.unmountComponentAtNode=function(_){if(!Hm(_))throw Error(s(40));return _._reactRootContainer?(Pr(function(){Gm(null,null,_,!1,function(){_._reactRootContainer=null,_[Rl]=null})}),!0):!1},Xl.unstable_batchedUpdates=Vr,Xl.unstable_renderSubtreeIntoContainer=function(_,w,k,B){if(!Hm(k))throw Error(s(200));if(_==null||_._reactInternals===void 0)throw Error(s(38));return Gm(_,w,k,!1,B)},Xl.version="18.3.1-next-f1338f8080-20240426",Xl}var sI;function zk(){if(sI)return qb.exports;sI=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),qb.exports=yF(),qb.exports}var oI;function _F(){if(oI)return xv;oI=1;var n=zk();return xv.createRoot=n.createRoot,xv.hydrateRoot=n.hydrateRoot,xv}var xF=_F(),ee=yx();const kn=Y0(ee),jk=hF({__proto__:null,default:kn},[ee]),vF=1,bF=1e6;let Xb=0;function wF(){return Xb=(Xb+1)%Number.MAX_SAFE_INTEGER,Xb.toString()}const Kb=new Map,aI=n=>{if(Kb.has(n))return;const t=setTimeout(()=>{Kb.delete(n),H_({type:"REMOVE_TOAST",toastId:n})},bF);Kb.set(n,t)},SF=(n,t)=>{switch(t.type){case"ADD_TOAST":return{...n,toasts:[t.toast,...n.toasts].slice(0,vF)};case"UPDATE_TOAST":return{...n,toasts:n.toasts.map(s=>s.id===t.toast.id?{...s,...t.toast}:s)};case"DISMISS_TOAST":{const{toastId:s}=t;return s?aI(s):n.toasts.forEach(l=>{aI(l.id)}),{...n,toasts:n.toasts.map(l=>l.id===s||s===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...n,toasts:[]}:{...n,toasts:n.toasts.filter(s=>s.id!==t.toastId)}}},Vv=[];let Uv={toasts:[]};function H_(n){Uv=SF(Uv,n),Vv.forEach(t=>{t(Uv)})}function xr({...n}){const t=wF(),s=h=>H_({type:"UPDATE_TOAST",toast:{...h,id:t}}),l=()=>H_({type:"DISMISS_TOAST",toastId:t});return H_({type:"ADD_TOAST",toast:{...n,id:t,open:!0,onOpenChange:h=>{h||l()}}}),{id:t,dismiss:l,update:s}}function Dy(){const[n,t]=ee.useState(Uv);return ee.useEffect(()=>(Vv.push(t),()=>{const s=Vv.indexOf(t);s>-1&&Vv.splice(s,1)}),[n]),{...n,toast:xr,dismiss:s=>H_({type:"DISMISS_TOAST",toastId:s})}}var Oy=zk();const KS=Y0(Oy);function wr(n,t,{checkForDefaultPrevented:s=!0}={}){return function(h){if(n?.(h),s===!1||!h.defaultPrevented)return t?.(h)}}function TF(n,t){typeof n=="function"?n(t):n!=null&&(n.current=t)}function Fk(...n){return t=>n.forEach(s=>TF(s,t))}function us(...n){return ee.useCallback(Fk(...n),n)}function EF(n,t=[]){let s=[];function l(m,b){const i=ee.createContext(b),A=s.length;s=[...s,b];function P(j){const{scope:U,children:X,...Y}=j,W=U?.[n][A]||i,re=ee.useMemo(()=>Y,Object.values(Y));return v.jsx(W.Provider,{value:re,children:X})}function D(j,U){const X=U?.[n][A]||i,Y=ee.useContext(X);if(Y)return Y;if(b!==void 0)return b;throw new Error(`\`${j}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(b=>ee.createContext(b));return function(i){const A=i?.[n]||m;return ee.useMemo(()=>({[`__scope${n}`]:{...i,[n]:A}}),[i,A])}};return h.scopeName=n,[l,CF(h,...t)]}function CF(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const l=n.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const b=l.reduce((i,{useScope:A,scopeName:P})=>{const j=A(m)[`__scope${P}`];return{...i,...j}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return s.scopeName=t.scopeName,s}var Jp=ee.forwardRef((n,t)=>{const{children:s,...l}=n,h=ee.Children.toArray(s),m=h.find(AF);if(m){const b=m.props.children,i=h.map(A=>A===m?ee.Children.count(b)>1?ee.Children.only(null):ee.isValidElement(b)?b.props.children:null:A);return v.jsx(Hw,{...l,ref:t,children:ee.isValidElement(b)?ee.cloneElement(b,void 0,i):null})}return v.jsx(Hw,{...l,ref:t,children:s})});Jp.displayName="Slot";var Hw=ee.forwardRef((n,t)=>{const{children:s,...l}=n;if(ee.isValidElement(s)){const h=MF(s);return ee.cloneElement(s,{...IF(l,s.props),ref:t?Fk(t,h):h})}return ee.Children.count(s)>1?ee.Children.only(null):null});Hw.displayName="SlotClone";var Bk=({children:n})=>v.jsx(v.Fragment,{children:n});function AF(n){return ee.isValidElement(n)&&n.type===Bk}function IF(n,t){const s={...t};for(const l in t){const h=n[l],m=t[l];/^on[A-Z]/.test(l)?h&&m?s[l]=(...i)=>{m(...i),h(...i)}:h&&(s[l]=h):l==="style"?s[l]={...h,...m}:l==="className"&&(s[l]=[h,m].filter(Boolean).join(" "))}return{...n,...s}}function MF(n){let t=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?n.ref:(t=Object.getOwnPropertyDescriptor(n,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?n.props.ref:n.props.ref||n.ref)}function YS(n){const t=n+"CollectionProvider",[s,l]=EF(t),[h,m]=s(t,{collectionRef:{current:null},itemMap:new Map}),b=X=>{const{scope:Y,children:W}=X,re=kn.useRef(null),de=kn.useRef(new Map).current;return v.jsx(h,{scope:Y,itemMap:de,collectionRef:re,children:W})};b.displayName=t;const i=n+"CollectionSlot",A=kn.forwardRef((X,Y)=>{const{scope:W,children:re}=X,de=m(i,W),Me=us(Y,de.collectionRef);return v.jsx(Jp,{ref:Me,children:re})});A.displayName=i;const P=n+"CollectionItemSlot",D="data-radix-collection-item",j=kn.forwardRef((X,Y)=>{const{scope:W,children:re,...de}=X,Me=kn.useRef(null),Fe=us(Y,Me),ht=m(P,W);return kn.useEffect(()=>(ht.itemMap.set(Me,{ref:Me,...de}),()=>void ht.itemMap.delete(Me))),v.jsx(Jp,{[D]:"",ref:Fe,children:re})});j.displayName=P;function U(X){const Y=m(n+"CollectionConsumer",X);return kn.useCallback(()=>{const re=Y.collectionRef.current;if(!re)return[];const de=Array.from(re.querySelectorAll(`[${D}]`));return Array.from(Y.itemMap.values()).sort((ht,at)=>de.indexOf(ht.ref.current)-de.indexOf(at.ref.current))},[Y.collectionRef,Y.itemMap])}return[{Provider:b,Slot:A,ItemSlot:j},U,l]}function kF(n,t){const s=ee.createContext(t),l=m=>{const{children:b,...i}=m,A=ee.useMemo(()=>i,Object.values(i));return v.jsx(s.Provider,{value:A,children:b})};l.displayName=n+"Provider";function h(m){const b=ee.useContext(s);if(b)return b;if(t!==void 0)return t;throw new Error(`\`${m}\` must be used within \`${n}\``)}return[l,h]}function Eg(n,t=[]){let s=[];function l(m,b){const i=ee.createContext(b),A=s.length;s=[...s,b];const P=j=>{const{scope:U,children:X,...Y}=j,W=U?.[n]?.[A]||i,re=ee.useMemo(()=>Y,Object.values(Y));return v.jsx(W.Provider,{value:re,children:X})};P.displayName=m+"Provider";function D(j,U){const X=U?.[n]?.[A]||i,Y=ee.useContext(X);if(Y)return Y;if(b!==void 0)return b;throw new Error(`\`${j}\` must be used within \`${m}\``)}return[P,D]}const h=()=>{const m=s.map(b=>ee.createContext(b));return function(i){const A=i?.[n]||m;return ee.useMemo(()=>({[`__scope${n}`]:{...i,[n]:A}}),[i,A])}};return h.scopeName=n,[l,PF(h,...t)]}function PF(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const l=n.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const b=l.reduce((i,{useScope:A,scopeName:P})=>{const j=A(m)[`__scope${P}`];return{...i,...j}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return s.scopeName=t.scopeName,s}var RF=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ci=RF.reduce((n,t)=>{const s=ee.forwardRef((l,h)=>{const{asChild:m,...b}=l,i=m?Jp:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),v.jsx(i,{...b,ref:h})});return s.displayName=`Primitive.${t}`,{...n,[t]:s}},{});function Vk(n,t){n&&Oy.flushSync(()=>n.dispatchEvent(t))}function Jl(n){const t=ee.useRef(n);return ee.useEffect(()=>{t.current=n}),ee.useMemo(()=>(...s)=>t.current?.(...s),[])}function NF(n,t=globalThis?.document){const s=Jl(n);ee.useEffect(()=>{const l=h=>{h.key==="Escape"&&s(h)};return t.addEventListener("keydown",l,{capture:!0}),()=>t.removeEventListener("keydown",l,{capture:!0})},[s,t])}var DF="DismissableLayer",Gw="dismissableLayer.update",OF="dismissableLayer.pointerDownOutside",LF="dismissableLayer.focusOutside",lI,Uk=ee.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ly=ee.forwardRef((n,t)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:l,onPointerDownOutside:h,onFocusOutside:m,onInteractOutside:b,onDismiss:i,...A}=n,P=ee.useContext(Uk),[D,j]=ee.useState(null),U=D?.ownerDocument??globalThis?.document,[,X]=ee.useState({}),Y=us(t,kt=>j(kt)),W=Array.from(P.layers),[re]=[...P.layersWithOutsidePointerEventsDisabled].slice(-1),de=W.indexOf(re),Me=D?W.indexOf(D):-1,Fe=P.layersWithOutsidePointerEventsDisabled.size>0,ht=Me>=de,at=jF(kt=>{const Rt=kt.target,fn=[...P.branches].some(En=>En.contains(Rt));!ht||fn||(h?.(kt),b?.(kt),kt.defaultPrevented||i?.())},U),Dt=FF(kt=>{const Rt=kt.target;[...P.branches].some(En=>En.contains(Rt))||(m?.(kt),b?.(kt),kt.defaultPrevented||i?.())},U);return NF(kt=>{Me===P.layers.size-1&&(l?.(kt),!kt.defaultPrevented&&i&&(kt.preventDefault(),i()))},U),ee.useEffect(()=>{if(D)return s&&(P.layersWithOutsidePointerEventsDisabled.size===0&&(lI=U.body.style.pointerEvents,U.body.style.pointerEvents="none"),P.layersWithOutsidePointerEventsDisabled.add(D)),P.layers.add(D),cI(),()=>{s&&P.layersWithOutsidePointerEventsDisabled.size===1&&(U.body.style.pointerEvents=lI)}},[D,U,s,P]),ee.useEffect(()=>()=>{D&&(P.layers.delete(D),P.layersWithOutsidePointerEventsDisabled.delete(D),cI())},[D,P]),ee.useEffect(()=>{const kt=()=>X({});return document.addEventListener(Gw,kt),()=>document.removeEventListener(Gw,kt)},[]),v.jsx(ci.div,{...A,ref:Y,style:{pointerEvents:Fe?ht?"auto":"none":void 0,...n.style},onFocusCapture:wr(n.onFocusCapture,Dt.onFocusCapture),onBlurCapture:wr(n.onBlurCapture,Dt.onBlurCapture),onPointerDownCapture:wr(n.onPointerDownCapture,at.onPointerDownCapture)})});Ly.displayName=DF;var zF="DismissableLayerBranch",$k=ee.forwardRef((n,t)=>{const s=ee.useContext(Uk),l=ee.useRef(null),h=us(t,l);return ee.useEffect(()=>{const m=l.current;if(m)return s.branches.add(m),()=>{s.branches.delete(m)}},[s.branches]),v.jsx(ci.div,{...n,ref:h})});$k.displayName=zF;function jF(n,t=globalThis?.document){const s=Jl(n),l=ee.useRef(!1),h=ee.useRef(()=>{});return ee.useEffect(()=>{const m=i=>{if(i.target&&!l.current){let A=function(){Hk(OF,s,P,{discrete:!0})};const P={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",h.current),h.current=A,t.addEventListener("click",h.current,{once:!0})):A()}else t.removeEventListener("click",h.current);l.current=!1},b=window.setTimeout(()=>{t.addEventListener("pointerdown",m)},0);return()=>{window.clearTimeout(b),t.removeEventListener("pointerdown",m),t.removeEventListener("click",h.current)}},[t,s]),{onPointerDownCapture:()=>l.current=!0}}function FF(n,t=globalThis?.document){const s=Jl(n),l=ee.useRef(!1);return ee.useEffect(()=>{const h=m=>{m.target&&!l.current&&Hk(LF,s,{originalEvent:m},{discrete:!1})};return t.addEventListener("focusin",h),()=>t.removeEventListener("focusin",h)},[t,s]),{onFocusCapture:()=>l.current=!0,onBlurCapture:()=>l.current=!1}}function cI(){const n=new CustomEvent(Gw);document.dispatchEvent(n)}function Hk(n,t,s,{discrete:l}){const h=s.originalEvent.target,m=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:s});t&&h.addEventListener(n,t,{once:!0}),l?Vk(h,m):h.dispatchEvent(m)}var BF=Ly,VF=$k,sl=globalThis?.document?ee.useLayoutEffect:()=>{},UF="Portal",_x=ee.forwardRef((n,t)=>{const{container:s,...l}=n,[h,m]=ee.useState(!1);sl(()=>m(!0),[]);const b=s||h&&globalThis?.document?.body;return b?KS.createPortal(v.jsx(ci.div,{...l,ref:t}),b):null});_x.displayName=UF;function $F(n,t){return ee.useReducer((s,l)=>t[s][l]??s,n)}var Mf=n=>{const{present:t,children:s}=n,l=HF(t),h=typeof s=="function"?s({present:l.isPresent}):ee.Children.only(s),m=us(l.ref,GF(h));return typeof s=="function"||l.isPresent?ee.cloneElement(h,{ref:m}):null};Mf.displayName="Presence";function HF(n){const[t,s]=ee.useState(),l=ee.useRef({}),h=ee.useRef(n),m=ee.useRef("none"),b=n?"mounted":"unmounted",[i,A]=$F(b,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ee.useEffect(()=>{const P=vv(l.current);m.current=i==="mounted"?P:"none"},[i]),sl(()=>{const P=l.current,D=h.current;if(D!==n){const U=m.current,X=vv(P);n?A("MOUNT"):X==="none"||P?.display==="none"?A("UNMOUNT"):A(D&&U!==X?"ANIMATION_OUT":"UNMOUNT"),h.current=n}},[n,A]),sl(()=>{if(t){let P;const D=t.ownerDocument.defaultView??window,j=X=>{const W=vv(l.current).includes(X.animationName);if(X.target===t&&W&&(A("ANIMATION_END"),!h.current)){const re=t.style.animationFillMode;t.style.animationFillMode="forwards",P=D.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=re)})}},U=X=>{X.target===t&&(m.current=vv(l.current))};return t.addEventListener("animationstart",U),t.addEventListener("animationcancel",j),t.addEventListener("animationend",j),()=>{D.clearTimeout(P),t.removeEventListener("animationstart",U),t.removeEventListener("animationcancel",j),t.removeEventListener("animationend",j)}}else A("ANIMATION_END")},[t,A]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:ee.useCallback(P=>{P&&(l.current=getComputedStyle(P)),s(P)},[])}}function vv(n){return n?.animationName||"none"}function GF(n){let t=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning;return s?n.ref:(t=Object.getOwnPropertyDescriptor(n,"ref")?.get,s=t&&"isReactWarning"in t&&t.isReactWarning,s?n.props.ref:n.props.ref||n.ref)}function Qp({prop:n,defaultProp:t,onChange:s=()=>{}}){const[l,h]=qF({defaultProp:t,onChange:s}),m=n!==void 0,b=m?n:l,i=Jl(s),A=ee.useCallback(P=>{if(m){const j=typeof P=="function"?P(n):P;j!==n&&i(j)}else h(P)},[m,n,h,i]);return[b,A]}function qF({defaultProp:n,onChange:t}){const s=ee.useState(n),[l]=s,h=ee.useRef(l),m=Jl(t);return ee.useEffect(()=>{h.current!==l&&(m(l),h.current=l)},[l,h,m]),s}var WF="VisuallyHidden",xx=ee.forwardRef((n,t)=>v.jsx(ci.span,{...n,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));xx.displayName=WF;var ZF=xx,JS="ToastProvider",[QS,XF,KF]=YS("Toast"),[Gk,WX]=Eg("Toast",[KF]),[YF,J0]=Gk(JS),qk=n=>{const{__scopeToast:t,label:s="Notification",duration:l=5e3,swipeDirection:h="right",swipeThreshold:m=50,children:b}=n,[i,A]=ee.useState(null),[P,D]=ee.useState(0),j=ee.useRef(!1),U=ee.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${JS}\`. Expected non-empty \`string\`.`),v.jsx(QS.Provider,{scope:t,children:v.jsx(YF,{scope:t,label:s,duration:l,swipeDirection:h,swipeThreshold:m,toastCount:P,viewport:i,onViewportChange:A,onToastAdd:ee.useCallback(()=>D(X=>X+1),[]),onToastRemove:ee.useCallback(()=>D(X=>X-1),[]),isFocusedToastEscapeKeyDownRef:j,isClosePausedRef:U,children:b})})};qk.displayName=JS;var Wk="ToastViewport",JF=["F8"],qw="toast.viewportPause",Ww="toast.viewportResume",Zk=ee.forwardRef((n,t)=>{const{__scopeToast:s,hotkey:l=JF,label:h="Notifications ({hotkey})",...m}=n,b=J0(Wk,s),i=XF(s),A=ee.useRef(null),P=ee.useRef(null),D=ee.useRef(null),j=ee.useRef(null),U=us(t,j,b.onViewportChange),X=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),Y=b.toastCount>0;ee.useEffect(()=>{const re=de=>{l.length!==0&&l.every(Fe=>de[Fe]||de.code===Fe)&&j.current?.focus()};return document.addEventListener("keydown",re),()=>document.removeEventListener("keydown",re)},[l]),ee.useEffect(()=>{const re=A.current,de=j.current;if(Y&&re&&de){const Me=()=>{if(!b.isClosePausedRef.current){const Dt=new CustomEvent(qw);de.dispatchEvent(Dt),b.isClosePausedRef.current=!0}},Fe=()=>{if(b.isClosePausedRef.current){const Dt=new CustomEvent(Ww);de.dispatchEvent(Dt),b.isClosePausedRef.current=!1}},ht=Dt=>{!re.contains(Dt.relatedTarget)&&Fe()},at=()=>{re.contains(document.activeElement)||Fe()};return re.addEventListener("focusin",Me),re.addEventListener("focusout",ht),re.addEventListener("pointermove",Me),re.addEventListener("pointerleave",at),window.addEventListener("blur",Me),window.addEventListener("focus",Fe),()=>{re.removeEventListener("focusin",Me),re.removeEventListener("focusout",ht),re.removeEventListener("pointermove",Me),re.removeEventListener("pointerleave",at),window.removeEventListener("blur",Me),window.removeEventListener("focus",Fe)}}},[Y,b.isClosePausedRef]);const W=ee.useCallback(({tabbingDirection:re})=>{const Me=i().map(Fe=>{const ht=Fe.ref.current,at=[ht,...hB(ht)];return re==="forwards"?at:at.reverse()});return(re==="forwards"?Me.reverse():Me).flat()},[i]);return ee.useEffect(()=>{const re=j.current;if(re){const de=Me=>{const Fe=Me.altKey||Me.ctrlKey||Me.metaKey;if(Me.key==="Tab"&&!Fe){const at=document.activeElement,Dt=Me.shiftKey;if(Me.target===re&&Dt){P.current?.focus();return}const fn=W({tabbingDirection:Dt?"backwards":"forwards"}),En=fn.findIndex(xn=>xn===at);Yb(fn.slice(En+1))?Me.preventDefault():Dt?P.current?.focus():D.current?.focus()}};return re.addEventListener("keydown",de),()=>re.removeEventListener("keydown",de)}},[i,W]),v.jsxs(VF,{ref:A,role:"region","aria-label":h.replace("{hotkey}",X),tabIndex:-1,style:{pointerEvents:Y?void 0:"none"},children:[Y&&v.jsx(Zw,{ref:P,onFocusFromOutsideViewport:()=>{const re=W({tabbingDirection:"forwards"});Yb(re)}}),v.jsx(QS.Slot,{scope:s,children:v.jsx(ci.ol,{tabIndex:-1,...m,ref:U})}),Y&&v.jsx(Zw,{ref:D,onFocusFromOutsideViewport:()=>{const re=W({tabbingDirection:"backwards"});Yb(re)}})]})});Zk.displayName=Wk;var Xk="ToastFocusProxy",Zw=ee.forwardRef((n,t)=>{const{__scopeToast:s,onFocusFromOutsideViewport:l,...h}=n,m=J0(Xk,s);return v.jsx(xx,{"aria-hidden":!0,tabIndex:0,...h,ref:t,style:{position:"fixed"},onFocus:b=>{const i=b.relatedTarget;!m.viewport?.contains(i)&&l()}})});Zw.displayName=Xk;var Q0="Toast",QF="toast.swipeStart",eB="toast.swipeMove",tB="toast.swipeCancel",nB="toast.swipeEnd",Kk=ee.forwardRef((n,t)=>{const{forceMount:s,open:l,defaultOpen:h,onOpenChange:m,...b}=n,[i=!0,A]=Qp({prop:l,defaultProp:h,onChange:m});return v.jsx(Mf,{present:s||i,children:v.jsx(sB,{open:i,...b,ref:t,onClose:()=>A(!1),onPause:Jl(n.onPause),onResume:Jl(n.onResume),onSwipeStart:wr(n.onSwipeStart,P=>{P.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:wr(n.onSwipeMove,P=>{const{x:D,y:j}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","move"),P.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${D}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${j}px`)}),onSwipeCancel:wr(n.onSwipeCancel,P=>{P.currentTarget.setAttribute("data-swipe","cancel"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:wr(n.onSwipeEnd,P=>{const{x:D,y:j}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","end"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${D}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${j}px`),A(!1)})})})});Kk.displayName=Q0;var[rB,iB]=Gk(Q0,{onClose(){}}),sB=ee.forwardRef((n,t)=>{const{__scopeToast:s,type:l="foreground",duration:h,open:m,onClose:b,onEscapeKeyDown:i,onPause:A,onResume:P,onSwipeStart:D,onSwipeMove:j,onSwipeCancel:U,onSwipeEnd:X,...Y}=n,W=J0(Q0,s),[re,de]=ee.useState(null),Me=us(t,Ft=>de(Ft)),Fe=ee.useRef(null),ht=ee.useRef(null),at=h||W.duration,Dt=ee.useRef(0),kt=ee.useRef(at),Rt=ee.useRef(0),{onToastAdd:fn,onToastRemove:En}=W,xn=Jl(()=>{re?.contains(document.activeElement)&&W.viewport?.focus(),b()}),Tn=ee.useCallback(Ft=>{!Ft||Ft===1/0||(window.clearTimeout(Rt.current),Dt.current=new Date().getTime(),Rt.current=window.setTimeout(xn,Ft))},[xn]);ee.useEffect(()=>{const Ft=W.viewport;if(Ft){const wn=()=>{Tn(kt.current),P?.()},Yt=()=>{const Cn=new Date().getTime()-Dt.current;kt.current=kt.current-Cn,window.clearTimeout(Rt.current),A?.()};return Ft.addEventListener(qw,Yt),Ft.addEventListener(Ww,wn),()=>{Ft.removeEventListener(qw,Yt),Ft.removeEventListener(Ww,wn)}}},[W.viewport,at,A,P,Tn]),ee.useEffect(()=>{m&&!W.isClosePausedRef.current&&Tn(at)},[m,at,W.isClosePausedRef,Tn]),ee.useEffect(()=>(fn(),()=>En()),[fn,En]);const Bn=ee.useMemo(()=>re?rP(re):null,[re]);return W.viewport?v.jsxs(v.Fragment,{children:[Bn&&v.jsx(oB,{__scopeToast:s,role:"status","aria-live":l==="foreground"?"assertive":"polite","aria-atomic":!0,children:Bn}),v.jsx(rB,{scope:s,onClose:xn,children:Oy.createPortal(v.jsx(QS.ItemSlot,{scope:s,children:v.jsx(BF,{asChild:!0,onEscapeKeyDown:wr(i,()=>{W.isFocusedToastEscapeKeyDownRef.current||xn(),W.isFocusedToastEscapeKeyDownRef.current=!1}),children:v.jsx(ci.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":m?"open":"closed","data-swipe-direction":W.swipeDirection,...Y,ref:Me,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:wr(n.onKeyDown,Ft=>{Ft.key==="Escape"&&(i?.(Ft.nativeEvent),Ft.nativeEvent.defaultPrevented||(W.isFocusedToastEscapeKeyDownRef.current=!0,xn()))}),onPointerDown:wr(n.onPointerDown,Ft=>{Ft.button===0&&(Fe.current={x:Ft.clientX,y:Ft.clientY})}),onPointerMove:wr(n.onPointerMove,Ft=>{if(!Fe.current)return;const wn=Ft.clientX-Fe.current.x,Yt=Ft.clientY-Fe.current.y,Cn=!!ht.current,gt=["left","right"].includes(W.swipeDirection),Jt=["left","up"].includes(W.swipeDirection)?Math.min:Math.max,Ht=gt?Jt(0,wn):0,qe=gt?0:Jt(0,Yt),Ct=Ft.pointerType==="touch"?10:2,Pn={x:Ht,y:qe},Zn={originalEvent:Ft,delta:Pn};Cn?(ht.current=Pn,bv(eB,j,Zn,{discrete:!1})):uI(Pn,W.swipeDirection,Ct)?(ht.current=Pn,bv(QF,D,Zn,{discrete:!1}),Ft.target.setPointerCapture(Ft.pointerId)):(Math.abs(wn)>Ct||Math.abs(Yt)>Ct)&&(Fe.current=null)}),onPointerUp:wr(n.onPointerUp,Ft=>{const wn=ht.current,Yt=Ft.target;if(Yt.hasPointerCapture(Ft.pointerId)&&Yt.releasePointerCapture(Ft.pointerId),ht.current=null,Fe.current=null,wn){const Cn=Ft.currentTarget,gt={originalEvent:Ft,delta:wn};uI(wn,W.swipeDirection,W.swipeThreshold)?bv(nB,X,gt,{discrete:!0}):bv(tB,U,gt,{discrete:!0}),Cn.addEventListener("click",Jt=>Jt.preventDefault(),{once:!0})}})})})}),W.viewport)})]}):null}),oB=n=>{const{__scopeToast:t,children:s,...l}=n,h=J0(Q0,t),[m,b]=ee.useState(!1),[i,A]=ee.useState(!1);return cB(()=>b(!0)),ee.useEffect(()=>{const P=window.setTimeout(()=>A(!0),1e3);return()=>window.clearTimeout(P)},[]),i?null:v.jsx(_x,{asChild:!0,children:v.jsx(xx,{...l,children:m&&v.jsxs(v.Fragment,{children:[h.label," ",s]})})})},aB="ToastTitle",Yk=ee.forwardRef((n,t)=>{const{__scopeToast:s,...l}=n;return v.jsx(ci.div,{...l,ref:t})});Yk.displayName=aB;var lB="ToastDescription",Jk=ee.forwardRef((n,t)=>{const{__scopeToast:s,...l}=n;return v.jsx(ci.div,{...l,ref:t})});Jk.displayName=lB;var Qk="ToastAction",eP=ee.forwardRef((n,t)=>{const{altText:s,...l}=n;return s.trim()?v.jsx(nP,{altText:s,asChild:!0,children:v.jsx(eT,{...l,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${Qk}\`. Expected non-empty \`string\`.`),null)});eP.displayName=Qk;var tP="ToastClose",eT=ee.forwardRef((n,t)=>{const{__scopeToast:s,...l}=n,h=iB(tP,s);return v.jsx(nP,{asChild:!0,children:v.jsx(ci.button,{type:"button",...l,ref:t,onClick:wr(n.onClick,h.onClose)})})});eT.displayName=tP;var nP=ee.forwardRef((n,t)=>{const{__scopeToast:s,altText:l,...h}=n;return v.jsx(ci.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":l||void 0,...h,ref:t})});function rP(n){const t=[];return Array.from(n.childNodes).forEach(l=>{if(l.nodeType===l.TEXT_NODE&&l.textContent&&t.push(l.textContent),uB(l)){const h=l.ariaHidden||l.hidden||l.style.display==="none",m=l.dataset.radixToastAnnounceExclude==="";if(!h)if(m){const b=l.dataset.radixToastAnnounceAlt;b&&t.push(b)}else t.push(...rP(l))}}),t}function bv(n,t,s,{discrete:l}){const h=s.originalEvent.currentTarget,m=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:s});t&&h.addEventListener(n,t,{once:!0}),l?Vk(h,m):h.dispatchEvent(m)}var uI=(n,t,s=0)=>{const l=Math.abs(n.x),h=Math.abs(n.y),m=l>h;return t==="left"||t==="right"?m&&l>s:!m&&h>s};function cB(n=()=>{}){const t=Jl(n);sl(()=>{let s=0,l=0;return s=window.requestAnimationFrame(()=>l=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(s),window.cancelAnimationFrame(l)}},[t])}function uB(n){return n.nodeType===n.ELEMENT_NODE}function hB(n){const t=[],s=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const h=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||h?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function Yb(n){const t=document.activeElement;return n.some(s=>s===t?!0:(s.focus(),document.activeElement!==t))}var dB=qk,iP=Zk,sP=Kk,oP=Yk,aP=Jk,lP=eP,cP=eT;function uP(n){var t,s,l="";if(typeof n=="string"||typeof n=="number")l+=n;else if(typeof n=="object")if(Array.isArray(n)){var h=n.length;for(t=0;t<h;t++)n[t]&&(s=uP(n[t]))&&(l&&(l+=" "),l+=s)}else for(s in n)n[s]&&(l&&(l+=" "),l+=s);return l}function hP(){for(var n,t,s=0,l="",h=arguments.length;s<h;s++)(n=arguments[s])&&(t=uP(n))&&(l&&(l+=" "),l+=t);return l}const hI=n=>typeof n=="boolean"?`${n}`:n===0?"0":n,dI=hP,vx=(n,t)=>s=>{var l;if(t?.variants==null)return dI(n,s?.class,s?.className);const{variants:h,defaultVariants:m}=t,b=Object.keys(h).map(P=>{const D=s?.[P],j=m?.[P];if(D===null)return null;const U=hI(D)||hI(j);return h[P][U]}),i=s&&Object.entries(s).reduce((P,D)=>{let[j,U]=D;return U===void 0||(P[j]=U),P},{}),A=t==null||(l=t.compoundVariants)===null||l===void 0?void 0:l.reduce((P,D)=>{let{class:j,className:U,...X}=D;return Object.entries(X).every(Y=>{let[W,re]=Y;return Array.isArray(re)?re.includes({...m,...i}[W]):{...m,...i}[W]===re})?[...P,j,U]:P},[]);return dI(n,b,A,s?.class,s?.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),dP=(...n)=>n.filter((t,s,l)=>!!t&&t.trim()!==""&&l.indexOf(t)===s).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var pB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mB=ee.forwardRef(({color:n="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:l,className:h="",children:m,iconNode:b,...i},A)=>ee.createElement("svg",{ref:A,...pB,width:t,height:t,stroke:n,strokeWidth:l?Number(s)*24/Number(t):s,className:dP("lucide",h),...i},[...b.map(([P,D])=>ee.createElement(P,D)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=(n,t)=>{const s=ee.forwardRef(({className:l,...h},m)=>ee.createElement(mB,{ref:m,iconNode:t,className:dP(`lucide-${fB(n)}`,l),...h}));return s.displayName=`${n}`,s};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gB=jr("AlignCenter",[["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 18H5",key:"18s9l3"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yB=jr("AlignLeft",[["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 18H3",key:"1amg6g"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _B=jr("AlignRight",[["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 18H7",key:"1ygte8"}],["path",{d:"M21 6H3",key:"1jwq7v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=jr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qv=jr("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xB=jr("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=jr("BookOpen",[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vB=jr("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bB=jr("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xw=jr("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wB=jr("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=jr("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fP=jr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TB=jr("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=jr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pP=jr("Cookie",[["path",{d:"M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5",key:"laymnq"}],["path",{d:"M8.5 8.5v.01",key:"ue8clq"}],["path",{d:"M16 15.5v.01",key:"14dtrp"}],["path",{d:"M12 12v.01",key:"u5ubse"}],["path",{d:"M11 17v.01",key:"1hyl5a"}],["path",{d:"M7 14v.01",key:"uct60s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mP=jr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gP=jr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CB=jr("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=jr("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IB=jr("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lg=jr("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=jr("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kB=jr("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=jr("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fI=jr("Leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=jr("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NB=jr("ListOrdered",[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DB=jr("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=jr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=jr("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zB=jr("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jB=jr("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pf=jr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pI=jr("Presentation",[["path",{d:"M2 3h20",key:"91anmk"}],["path",{d:"M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3",key:"2k9sn8"}],["path",{d:"m7 21 5-5 5 5",key:"bip4we"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FB=jr("Recycle",[["path",{d:"M7 19H4.815a1.83 1.83 0 0 1-1.57-.881 1.785 1.785 0 0 1-.004-1.784L7.196 9.5",key:"x6z5xu"}],["path",{d:"M11 19h8.203a1.83 1.83 0 0 0 1.556-.89 1.784 1.784 0 0 0 0-1.775l-1.226-2.12",key:"1x4zh5"}],["path",{d:"m14 16-3 3 3 3",key:"f6jyew"}],["path",{d:"M8.293 13.596 7.196 9.5 3.1 10.598",key:"wf1obh"}],["path",{d:"m9.344 5.811 1.093-1.892A1.83 1.83 0 0 1 11.985 3a1.784 1.784 0 0 1 1.546.888l3.943 6.843",key:"9tzpgr"}],["path",{d:"m13.378 9.633 4.096 1.098 1.097-4.096",key:"1oe83g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yP=jr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=jr("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VB=jr("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UB=jr("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $B=jr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HB=jr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kw=jr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GB=jr("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qB=jr("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WB=jr("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZB=jr("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XB=jr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cg=jr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=jr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yw=jr("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),tT="-",KB=n=>{const t=JB(n),{conflictingClassGroups:s,conflictingClassGroupModifiers:l}=n;return{getClassGroupId:b=>{const i=b.split(tT);return i[0]===""&&i.length!==1&&i.shift(),_P(i,t)||YB(b)},getConflictingClassGroupIds:(b,i)=>{const A=s[b]||[];return i&&l[b]?[...A,...l[b]]:A}}},_P=(n,t)=>{if(n.length===0)return t.classGroupId;const s=n[0],l=t.nextPart.get(s),h=l?_P(n.slice(1),l):void 0;if(h)return h;if(t.validators.length===0)return;const m=n.join(tT);return t.validators.find(({validator:b})=>b(m))?.classGroupId},mI=/^\[(.+)\]$/,YB=n=>{if(mI.test(n)){const t=mI.exec(n)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},JB=n=>{const{theme:t,prefix:s}=n,l={nextPart:new Map,validators:[]};return e4(Object.entries(n.classGroups),s).forEach(([m,b])=>{Jw(b,l,m,t)}),l},Jw=(n,t,s,l)=>{n.forEach(h=>{if(typeof h=="string"){const m=h===""?t:gI(t,h);m.classGroupId=s;return}if(typeof h=="function"){if(QB(h)){Jw(h(l),t,s,l);return}t.validators.push({validator:h,classGroupId:s});return}Object.entries(h).forEach(([m,b])=>{Jw(b,gI(t,m),s,l)})})},gI=(n,t)=>{let s=n;return t.split(tT).forEach(l=>{s.nextPart.has(l)||s.nextPart.set(l,{nextPart:new Map,validators:[]}),s=s.nextPart.get(l)}),s},QB=n=>n.isThemeGetter,e4=(n,t)=>t?n.map(([s,l])=>{const h=l.map(m=>typeof m=="string"?t+m:typeof m=="object"?Object.fromEntries(Object.entries(m).map(([b,i])=>[t+b,i])):m);return[s,h]}):n,t4=n=>{if(n<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,l=new Map;const h=(m,b)=>{s.set(m,b),t++,t>n&&(t=0,l=s,s=new Map)};return{get(m){let b=s.get(m);if(b!==void 0)return b;if((b=l.get(m))!==void 0)return h(m,b),b},set(m,b){s.has(m)?s.set(m,b):h(m,b)}}},xP="!",n4=n=>{const{separator:t,experimentalParseClassName:s}=n,l=t.length===1,h=t[0],m=t.length,b=i=>{const A=[];let P=0,D=0,j;for(let re=0;re<i.length;re++){let de=i[re];if(P===0){if(de===h&&(l||i.slice(re,re+m)===t)){A.push(i.slice(D,re)),D=re+m;continue}if(de==="/"){j=re;continue}}de==="["?P++:de==="]"&&P--}const U=A.length===0?i:i.substring(D),X=U.startsWith(xP),Y=X?U.substring(1):U,W=j&&j>D?j-D:void 0;return{modifiers:A,hasImportantModifier:X,baseClassName:Y,maybePostfixModifierPosition:W}};return s?i=>s({className:i,parseClassName:b}):b},r4=n=>{if(n.length<=1)return n;const t=[];let s=[];return n.forEach(l=>{l[0]==="["?(t.push(...s.sort(),l),s=[]):s.push(l)}),t.push(...s.sort()),t},i4=n=>({cache:t4(n.cacheSize),parseClassName:n4(n),...KB(n)}),s4=/\s+/,o4=(n,t)=>{const{parseClassName:s,getClassGroupId:l,getConflictingClassGroupIds:h}=t,m=[],b=n.trim().split(s4);let i="";for(let A=b.length-1;A>=0;A-=1){const P=b[A],{modifiers:D,hasImportantModifier:j,baseClassName:U,maybePostfixModifierPosition:X}=s(P);let Y=!!X,W=l(Y?U.substring(0,X):U);if(!W){if(!Y){i=P+(i.length>0?" "+i:i);continue}if(W=l(U),!W){i=P+(i.length>0?" "+i:i);continue}Y=!1}const re=r4(D).join(":"),de=j?re+xP:re,Me=de+W;if(m.includes(Me))continue;m.push(Me);const Fe=h(W,Y);for(let ht=0;ht<Fe.length;++ht){const at=Fe[ht];m.push(de+at)}i=P+(i.length>0?" "+i:i)}return i};function a4(){let n=0,t,s,l="";for(;n<arguments.length;)(t=arguments[n++])&&(s=vP(t))&&(l&&(l+=" "),l+=s);return l}const vP=n=>{if(typeof n=="string")return n;let t,s="";for(let l=0;l<n.length;l++)n[l]&&(t=vP(n[l]))&&(s&&(s+=" "),s+=t);return s};function l4(n,...t){let s,l,h,m=b;function b(A){const P=t.reduce((D,j)=>j(D),n());return s=i4(P),l=s.cache.get,h=s.cache.set,m=i,i(A)}function i(A){const P=l(A);if(P)return P;const D=o4(A,s);return h(A,D),D}return function(){return m(a4.apply(null,arguments))}}const Ds=n=>{const t=s=>s[n]||[];return t.isThemeGetter=!0,t},bP=/^\[(?:([a-z-]+):)?(.+)\]$/i,c4=/^\d+\/\d+$/,u4=new Set(["px","full","screen"]),h4=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,d4=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,f4=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,p4=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,m4=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,mf=n=>yy(n)||u4.has(n)||c4.test(n),Pp=n=>zy(n,"length",S4),yy=n=>!!n&&!Number.isNaN(Number(n)),Jb=n=>zy(n,"number",yy),O_=n=>!!n&&Number.isInteger(Number(n)),g4=n=>n.endsWith("%")&&yy(n.slice(0,-1)),xi=n=>bP.test(n),Rp=n=>h4.test(n),y4=new Set(["length","size","percentage"]),_4=n=>zy(n,y4,wP),x4=n=>zy(n,"position",wP),v4=new Set(["image","url"]),b4=n=>zy(n,v4,E4),w4=n=>zy(n,"",T4),L_=()=>!0,zy=(n,t,s)=>{const l=bP.exec(n);return l?l[1]?typeof t=="string"?l[1]===t:t.has(l[1]):s(l[2]):!1},S4=n=>d4.test(n)&&!f4.test(n),wP=()=>!1,T4=n=>p4.test(n),E4=n=>m4.test(n),C4=()=>{const n=Ds("colors"),t=Ds("spacing"),s=Ds("blur"),l=Ds("brightness"),h=Ds("borderColor"),m=Ds("borderRadius"),b=Ds("borderSpacing"),i=Ds("borderWidth"),A=Ds("contrast"),P=Ds("grayscale"),D=Ds("hueRotate"),j=Ds("invert"),U=Ds("gap"),X=Ds("gradientColorStops"),Y=Ds("gradientColorStopPositions"),W=Ds("inset"),re=Ds("margin"),de=Ds("opacity"),Me=Ds("padding"),Fe=Ds("saturate"),ht=Ds("scale"),at=Ds("sepia"),Dt=Ds("skew"),kt=Ds("space"),Rt=Ds("translate"),fn=()=>["auto","contain","none"],En=()=>["auto","hidden","clip","visible","scroll"],xn=()=>["auto",xi,t],Tn=()=>[xi,t],Bn=()=>["",mf,Pp],Ft=()=>["auto",yy,xi],wn=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Yt=()=>["solid","dashed","dotted","double","none"],Cn=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],gt=()=>["start","end","center","between","around","evenly","stretch"],Jt=()=>["","0",xi],Ht=()=>["auto","avoid","all","avoid-page","page","left","right","column"],qe=()=>[yy,xi];return{cacheSize:500,separator:":",theme:{colors:[L_],spacing:[mf,Pp],blur:["none","",Rp,xi],brightness:qe(),borderColor:[n],borderRadius:["none","","full",Rp,xi],borderSpacing:Tn(),borderWidth:Bn(),contrast:qe(),grayscale:Jt(),hueRotate:qe(),invert:Jt(),gap:Tn(),gradientColorStops:[n],gradientColorStopPositions:[g4,Pp],inset:xn(),margin:xn(),opacity:qe(),padding:Tn(),saturate:qe(),scale:qe(),sepia:Jt(),skew:qe(),space:Tn(),translate:Tn()},classGroups:{aspect:[{aspect:["auto","square","video",xi]}],container:["container"],columns:[{columns:[Rp]}],"break-after":[{"break-after":Ht()}],"break-before":[{"break-before":Ht()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...wn(),xi]}],overflow:[{overflow:En()}],"overflow-x":[{"overflow-x":En()}],"overflow-y":[{"overflow-y":En()}],overscroll:[{overscroll:fn()}],"overscroll-x":[{"overscroll-x":fn()}],"overscroll-y":[{"overscroll-y":fn()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[W]}],"inset-x":[{"inset-x":[W]}],"inset-y":[{"inset-y":[W]}],start:[{start:[W]}],end:[{end:[W]}],top:[{top:[W]}],right:[{right:[W]}],bottom:[{bottom:[W]}],left:[{left:[W]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",O_,xi]}],basis:[{basis:xn()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",xi]}],grow:[{grow:Jt()}],shrink:[{shrink:Jt()}],order:[{order:["first","last","none",O_,xi]}],"grid-cols":[{"grid-cols":[L_]}],"col-start-end":[{col:["auto",{span:["full",O_,xi]},xi]}],"col-start":[{"col-start":Ft()}],"col-end":[{"col-end":Ft()}],"grid-rows":[{"grid-rows":[L_]}],"row-start-end":[{row:["auto",{span:[O_,xi]},xi]}],"row-start":[{"row-start":Ft()}],"row-end":[{"row-end":Ft()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",xi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",xi]}],gap:[{gap:[U]}],"gap-x":[{"gap-x":[U]}],"gap-y":[{"gap-y":[U]}],"justify-content":[{justify:["normal",...gt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...gt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...gt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Me]}],px:[{px:[Me]}],py:[{py:[Me]}],ps:[{ps:[Me]}],pe:[{pe:[Me]}],pt:[{pt:[Me]}],pr:[{pr:[Me]}],pb:[{pb:[Me]}],pl:[{pl:[Me]}],m:[{m:[re]}],mx:[{mx:[re]}],my:[{my:[re]}],ms:[{ms:[re]}],me:[{me:[re]}],mt:[{mt:[re]}],mr:[{mr:[re]}],mb:[{mb:[re]}],ml:[{ml:[re]}],"space-x":[{"space-x":[kt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[kt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",xi,t]}],"min-w":[{"min-w":[xi,t,"min","max","fit"]}],"max-w":[{"max-w":[xi,t,"none","full","min","max","fit","prose",{screen:[Rp]},Rp]}],h:[{h:[xi,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[xi,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[xi,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[xi,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Rp,Pp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Jb]}],"font-family":[{font:[L_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",xi]}],"line-clamp":[{"line-clamp":["none",yy,Jb]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",mf,xi]}],"list-image":[{"list-image":["none",xi]}],"list-style-type":[{list:["none","disc","decimal",xi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[n]}],"placeholder-opacity":[{"placeholder-opacity":[de]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[n]}],"text-opacity":[{"text-opacity":[de]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Yt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",mf,Pp]}],"underline-offset":[{"underline-offset":["auto",mf,xi]}],"text-decoration-color":[{decoration:[n]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Tn()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",xi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",xi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[de]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...wn(),x4]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",_4]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},b4]}],"bg-color":[{bg:[n]}],"gradient-from-pos":[{from:[Y]}],"gradient-via-pos":[{via:[Y]}],"gradient-to-pos":[{to:[Y]}],"gradient-from":[{from:[X]}],"gradient-via":[{via:[X]}],"gradient-to":[{to:[X]}],rounded:[{rounded:[m]}],"rounded-s":[{"rounded-s":[m]}],"rounded-e":[{"rounded-e":[m]}],"rounded-t":[{"rounded-t":[m]}],"rounded-r":[{"rounded-r":[m]}],"rounded-b":[{"rounded-b":[m]}],"rounded-l":[{"rounded-l":[m]}],"rounded-ss":[{"rounded-ss":[m]}],"rounded-se":[{"rounded-se":[m]}],"rounded-ee":[{"rounded-ee":[m]}],"rounded-es":[{"rounded-es":[m]}],"rounded-tl":[{"rounded-tl":[m]}],"rounded-tr":[{"rounded-tr":[m]}],"rounded-br":[{"rounded-br":[m]}],"rounded-bl":[{"rounded-bl":[m]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[de]}],"border-style":[{border:[...Yt(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[de]}],"divide-style":[{divide:Yt()}],"border-color":[{border:[h]}],"border-color-x":[{"border-x":[h]}],"border-color-y":[{"border-y":[h]}],"border-color-s":[{"border-s":[h]}],"border-color-e":[{"border-e":[h]}],"border-color-t":[{"border-t":[h]}],"border-color-r":[{"border-r":[h]}],"border-color-b":[{"border-b":[h]}],"border-color-l":[{"border-l":[h]}],"divide-color":[{divide:[h]}],"outline-style":[{outline:["",...Yt()]}],"outline-offset":[{"outline-offset":[mf,xi]}],"outline-w":[{outline:[mf,Pp]}],"outline-color":[{outline:[n]}],"ring-w":[{ring:Bn()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[n]}],"ring-opacity":[{"ring-opacity":[de]}],"ring-offset-w":[{"ring-offset":[mf,Pp]}],"ring-offset-color":[{"ring-offset":[n]}],shadow:[{shadow:["","inner","none",Rp,w4]}],"shadow-color":[{shadow:[L_]}],opacity:[{opacity:[de]}],"mix-blend":[{"mix-blend":[...Cn(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Cn()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[l]}],contrast:[{contrast:[A]}],"drop-shadow":[{"drop-shadow":["","none",Rp,xi]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[D]}],invert:[{invert:[j]}],saturate:[{saturate:[Fe]}],sepia:[{sepia:[at]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[l]}],"backdrop-contrast":[{"backdrop-contrast":[A]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[D]}],"backdrop-invert":[{"backdrop-invert":[j]}],"backdrop-opacity":[{"backdrop-opacity":[de]}],"backdrop-saturate":[{"backdrop-saturate":[Fe]}],"backdrop-sepia":[{"backdrop-sepia":[at]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[b]}],"border-spacing-x":[{"border-spacing-x":[b]}],"border-spacing-y":[{"border-spacing-y":[b]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",xi]}],duration:[{duration:qe()}],ease:[{ease:["linear","in","out","in-out",xi]}],delay:[{delay:qe()}],animate:[{animate:["none","spin","ping","pulse","bounce",xi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[ht]}],"scale-x":[{"scale-x":[ht]}],"scale-y":[{"scale-y":[ht]}],rotate:[{rotate:[O_,xi]}],"translate-x":[{"translate-x":[Rt]}],"translate-y":[{"translate-y":[Rt]}],"skew-x":[{"skew-x":[Dt]}],"skew-y":[{"skew-y":[Dt]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",xi]}],accent:[{accent:["auto",n]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",xi]}],"caret-color":[{caret:[n]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Tn()}],"scroll-mx":[{"scroll-mx":Tn()}],"scroll-my":[{"scroll-my":Tn()}],"scroll-ms":[{"scroll-ms":Tn()}],"scroll-me":[{"scroll-me":Tn()}],"scroll-mt":[{"scroll-mt":Tn()}],"scroll-mr":[{"scroll-mr":Tn()}],"scroll-mb":[{"scroll-mb":Tn()}],"scroll-ml":[{"scroll-ml":Tn()}],"scroll-p":[{"scroll-p":Tn()}],"scroll-px":[{"scroll-px":Tn()}],"scroll-py":[{"scroll-py":Tn()}],"scroll-ps":[{"scroll-ps":Tn()}],"scroll-pe":[{"scroll-pe":Tn()}],"scroll-pt":[{"scroll-pt":Tn()}],"scroll-pr":[{"scroll-pr":Tn()}],"scroll-pb":[{"scroll-pb":Tn()}],"scroll-pl":[{"scroll-pl":Tn()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",xi]}],fill:[{fill:[n,"none"]}],"stroke-w":[{stroke:[mf,Pp,Jb]}],stroke:[{stroke:[n,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},A4=l4(C4);function Ai(...n){return A4(hP(n))}const I4=dB,SP=ee.forwardRef(({className:n,...t},s)=>v.jsx(iP,{ref:s,className:Ai("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",n),...t}));SP.displayName=iP.displayName;const M4=vx("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),TP=ee.forwardRef(({className:n,variant:t,...s},l)=>v.jsx(sP,{ref:l,className:Ai(M4({variant:t}),n),...s}));TP.displayName=sP.displayName;const k4=ee.forwardRef(({className:n,...t},s)=>v.jsx(lP,{ref:s,className:Ai("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...t}));k4.displayName=lP.displayName;const EP=ee.forwardRef(({className:n,...t},s)=>v.jsx(cP,{ref:s,className:Ai("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...t,children:v.jsx(t1,{className:"h-4 w-4"})}));EP.displayName=cP.displayName;const CP=ee.forwardRef(({className:n,...t},s)=>v.jsx(oP,{ref:s,className:Ai("text-sm font-semibold",n),...t}));CP.displayName=oP.displayName;const AP=ee.forwardRef(({className:n,...t},s)=>v.jsx(aP,{ref:s,className:Ai("text-sm opacity-90",n),...t}));AP.displayName=aP.displayName;function P4(){const{toasts:n}=Dy();return v.jsxs(I4,{children:[n.map(function({id:t,title:s,description:l,action:h,...m}){return v.jsxs(TP,{...m,children:[v.jsxs("div",{className:"grid gap-1",children:[s&&v.jsx(CP,{children:s}),l&&v.jsx(AP,{children:l})]}),h,v.jsx(EP,{})]},t)}),v.jsx(SP,{})]})}var yI=["light","dark"],R4="(prefers-color-scheme: dark)",N4=ee.createContext(void 0),D4={setTheme:n=>{},themes:[]},O4=()=>{var n;return(n=ee.useContext(N4))!=null?n:D4};ee.memo(({forcedTheme:n,storageKey:t,attribute:s,enableSystem:l,enableColorScheme:h,defaultTheme:m,value:b,attrs:i,nonce:A})=>{let P=m==="system",D=s==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(Y=>`'${Y}'`).join(",")})`};`:`var d=document.documentElement,n='${s}',s='setAttribute';`,j=h?yI.includes(m)&&m?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${m}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",U=(Y,W=!1,re=!0)=>{let de=b?b[Y]:Y,Me=W?Y+"|| ''":`'${de}'`,Fe="";return h&&re&&!W&&yI.includes(Y)&&(Fe+=`d.style.colorScheme = '${Y}';`),s==="class"?W||de?Fe+=`c.add(${Me})`:Fe+="null":de&&(Fe+=`d[s](n,${Me})`),Fe},X=n?`!function(){${D}${U(n)}}()`:l?`!function(){try{${D}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${P})){var t='${R4}',m=window.matchMedia(t);if(m.media!==t||m.matches){${U("dark")}}else{${U("light")}}}else if(e){${b?`var x=${JSON.stringify(b)};`:""}${U(b?"x[e]":"e",!0)}}${P?"":"else{"+U(m,!1,!1)+"}"}${j}}catch(e){}}()`:`!function(){try{${D}var e=localStorage.getItem('${t}');if(e){${b?`var x=${JSON.stringify(b)};`:""}${U(b?"x[e]":"e",!0)}}else{${U(m,!1,!1)};}${j}}catch(t){}}();`;return ee.createElement("script",{nonce:A,dangerouslySetInnerHTML:{__html:X}})});var L4=n=>{switch(n){case"success":return F4;case"info":return V4;case"warning":return B4;case"error":return U4;default:return null}},z4=Array(12).fill(0),j4=({visible:n})=>kn.createElement("div",{className:"sonner-loading-wrapper","data-visible":n},kn.createElement("div",{className:"sonner-spinner"},z4.map((t,s)=>kn.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),F4=kn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kn.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),B4=kn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},kn.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),V4=kn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),U4=kn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),$4=()=>{let[n,t]=kn.useState(document.hidden);return kn.useEffect(()=>{let s=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",s),()=>window.removeEventListener("visibilitychange",s)},[]),n},Qw=1,H4=class{constructor(){this.subscribe=n=>(this.subscribers.push(n),()=>{let t=this.subscribers.indexOf(n);this.subscribers.splice(t,1)}),this.publish=n=>{this.subscribers.forEach(t=>t(n))},this.addToast=n=>{this.publish(n),this.toasts=[...this.toasts,n]},this.create=n=>{var t;let{message:s,...l}=n,h=typeof n?.id=="number"||((t=n.id)==null?void 0:t.length)>0?n.id:Qw++,m=this.toasts.find(i=>i.id===h),b=n.dismissible===void 0?!0:n.dismissible;return m?this.toasts=this.toasts.map(i=>i.id===h?(this.publish({...i,...n,id:h,title:s}),{...i,...n,id:h,dismissible:b,title:s}):i):this.addToast({title:s,...l,dismissible:b,id:h}),h},this.dismiss=n=>(n||this.toasts.forEach(t=>{this.subscribers.forEach(s=>s({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:n,dismiss:!0})),n),this.message=(n,t)=>this.create({...t,message:n}),this.error=(n,t)=>this.create({...t,message:n,type:"error"}),this.success=(n,t)=>this.create({...t,type:"success",message:n}),this.info=(n,t)=>this.create({...t,type:"info",message:n}),this.warning=(n,t)=>this.create({...t,type:"warning",message:n}),this.loading=(n,t)=>this.create({...t,type:"loading",message:n}),this.promise=(n,t)=>{if(!t)return;let s;t.loading!==void 0&&(s=this.create({...t,promise:n,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let l=n instanceof Promise?n:n(),h=s!==void 0;return l.then(async m=>{if(q4(m)&&!m.ok){h=!1;let b=typeof t.error=="function"?await t.error(`HTTP error! status: ${m.status}`):t.error,i=typeof t.description=="function"?await t.description(`HTTP error! status: ${m.status}`):t.description;this.create({id:s,type:"error",message:b,description:i})}else if(t.success!==void 0){h=!1;let b=typeof t.success=="function"?await t.success(m):t.success,i=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"success",message:b,description:i})}}).catch(async m=>{if(t.error!==void 0){h=!1;let b=typeof t.error=="function"?await t.error(m):t.error,i=typeof t.description=="function"?await t.description(m):t.description;this.create({id:s,type:"error",message:b,description:i})}}).finally(()=>{var m;h&&(this.dismiss(s),s=void 0),(m=t.finally)==null||m.call(t)}),s},this.custom=(n,t)=>{let s=t?.id||Qw++;return this.create({jsx:n(s),id:s,...t}),s},this.subscribers=[],this.toasts=[]}},Tc=new H4,G4=(n,t)=>{let s=t?.id||Qw++;return Tc.addToast({title:n,...t,id:s}),s},q4=n=>n&&typeof n=="object"&&"ok"in n&&typeof n.ok=="boolean"&&"status"in n&&typeof n.status=="number",W4=G4,Z4=()=>Tc.toasts;Object.assign(W4,{success:Tc.success,info:Tc.info,warning:Tc.warning,error:Tc.error,custom:Tc.custom,message:Tc.message,promise:Tc.promise,dismiss:Tc.dismiss,loading:Tc.loading},{getHistory:Z4});function X4(n,{insertAt:t}={}){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],l=document.createElement("style");l.type="text/css",t==="top"&&s.firstChild?s.insertBefore(l,s.firstChild):s.appendChild(l),l.styleSheet?l.styleSheet.cssText=n:l.appendChild(document.createTextNode(n))}X4(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function wv(n){return n.label!==void 0}var K4=3,Y4="32px",J4=4e3,Q4=356,e5=14,t5=20,n5=200;function r5(...n){return n.filter(Boolean).join(" ")}var i5=n=>{var t,s,l,h,m,b,i,A,P,D;let{invert:j,toast:U,unstyled:X,interacting:Y,setHeights:W,visibleToasts:re,heights:de,index:Me,toasts:Fe,expanded:ht,removeToast:at,defaultRichColors:Dt,closeButton:kt,style:Rt,cancelButtonStyle:fn,actionButtonStyle:En,className:xn="",descriptionClassName:Tn="",duration:Bn,position:Ft,gap:wn,loadingIcon:Yt,expandByDefault:Cn,classNames:gt,icons:Jt,closeButtonAriaLabel:Ht="Close toast",pauseWhenPageIsHidden:qe,cn:Ct}=n,[Pn,Zn]=kn.useState(!1),[Nn,cn]=kn.useState(!1),[un,$n]=kn.useState(!1),[An,Fn]=kn.useState(!1),[Zr,ni]=kn.useState(0),[Or,vs]=kn.useState(0),$s=kn.useRef(null),Hi=kn.useRef(null),mo=Me===0,El=Me+1<=re,zi=U.type,Ki=U.dismissible!==!1,to=U.className||"",Qo=U.descriptionClassName||"",To=kn.useMemo(()=>de.findIndex(On=>On.toastId===U.id)||0,[de,U.id]),Cs=kn.useMemo(()=>{var On;return(On=U.closeButton)!=null?On:kt},[U.closeButton,kt]),Ua=kn.useMemo(()=>U.duration||Bn||J4,[U.duration,Bn]),wa=kn.useRef(0),is=kn.useRef(0),Sa=kn.useRef(0),Hs=kn.useRef(null),[Fo,ss]=Ft.split("-"),go=kn.useMemo(()=>de.reduce((On,ui,fi)=>fi>=To?On:On+ui.height,0),[de,To]),Ta=$4(),Ea=U.invert||j,Ca=zi==="loading";is.current=kn.useMemo(()=>To*wn+go,[To,go]),kn.useEffect(()=>{Zn(!0)},[]),kn.useLayoutEffect(()=>{if(!Pn)return;let On=Hi.current,ui=On.style.height;On.style.height="auto";let fi=On.getBoundingClientRect().height;On.style.height=ui,vs(fi),W(Vi=>Vi.find(Is=>Is.toastId===U.id)?Vi.map(Is=>Is.toastId===U.id?{...Is,height:fi}:Is):[{toastId:U.id,height:fi,position:U.position},...Vi])},[Pn,U.title,U.description,W,U.id]);let As=kn.useCallback(()=>{cn(!0),ni(is.current),W(On=>On.filter(ui=>ui.toastId!==U.id)),setTimeout(()=>{at(U)},n5)},[U,at,W,is]);kn.useEffect(()=>{if(U.promise&&zi==="loading"||U.duration===1/0||U.type==="loading")return;let On,ui=Ua;return ht||Y||qe&&Ta?(()=>{if(Sa.current<wa.current){let fi=new Date().getTime()-wa.current;ui=ui-fi}Sa.current=new Date().getTime()})():ui!==1/0&&(wa.current=new Date().getTime(),On=setTimeout(()=>{var fi;(fi=U.onAutoClose)==null||fi.call(U,U),As()},ui)),()=>clearTimeout(On)},[ht,Y,Cn,U,Ua,As,U.promise,zi,qe,Ta]),kn.useEffect(()=>{let On=Hi.current;if(On){let ui=On.getBoundingClientRect().height;return vs(ui),W(fi=>[{toastId:U.id,height:ui,position:U.position},...fi]),()=>W(fi=>fi.filter(Vi=>Vi.toastId!==U.id))}},[W,U.id]),kn.useEffect(()=>{U.delete&&As()},[As,U.delete]);function $a(){return Jt!=null&&Jt.loading?kn.createElement("div",{className:"sonner-loader","data-visible":zi==="loading"},Jt.loading):Yt?kn.createElement("div",{className:"sonner-loader","data-visible":zi==="loading"},Yt):kn.createElement(j4,{visible:zi==="loading"})}return kn.createElement("li",{"aria-live":U.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Hi,className:Ct(xn,to,gt?.toast,(t=U?.classNames)==null?void 0:t.toast,gt?.default,gt?.[zi],(s=U?.classNames)==null?void 0:s[zi]),"data-sonner-toast":"","data-rich-colors":(l=U.richColors)!=null?l:Dt,"data-styled":!(U.jsx||U.unstyled||X),"data-mounted":Pn,"data-promise":!!U.promise,"data-removed":Nn,"data-visible":El,"data-y-position":Fo,"data-x-position":ss,"data-index":Me,"data-front":mo,"data-swiping":un,"data-dismissible":Ki,"data-type":zi,"data-invert":Ea,"data-swipe-out":An,"data-expanded":!!(ht||Cn&&Pn),style:{"--index":Me,"--toasts-before":Me,"--z-index":Fe.length-Me,"--offset":`${Nn?Zr:is.current}px`,"--initial-height":Cn?"auto":`${Or}px`,...Rt,...U.style},onPointerDown:On=>{Ca||!Ki||($s.current=new Date,ni(is.current),On.target.setPointerCapture(On.pointerId),On.target.tagName!=="BUTTON"&&($n(!0),Hs.current={x:On.clientX,y:On.clientY}))},onPointerUp:()=>{var On,ui,fi,Vi;if(An||!Ki)return;Hs.current=null;let Is=Number(((On=Hi.current)==null?void 0:On.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Ha=new Date().getTime()-((ui=$s.current)==null?void 0:ui.getTime()),Ga=Math.abs(Is)/Ha;if(Math.abs(Is)>=t5||Ga>.11){ni(is.current),(fi=U.onDismiss)==null||fi.call(U,U),As(),Fn(!0);return}(Vi=Hi.current)==null||Vi.style.setProperty("--swipe-amount","0px"),$n(!1)},onPointerMove:On=>{var ui;if(!Hs.current||!Ki)return;let fi=On.clientY-Hs.current.y,Vi=On.clientX-Hs.current.x,Is=(Fo==="top"?Math.min:Math.max)(0,fi),Ha=On.pointerType==="touch"?10:2;Math.abs(Is)>Ha?(ui=Hi.current)==null||ui.style.setProperty("--swipe-amount",`${fi}px`):Math.abs(Vi)>Ha&&(Hs.current=null)}},Cs&&!U.jsx?kn.createElement("button",{"aria-label":Ht,"data-disabled":Ca,"data-close-button":!0,onClick:Ca||!Ki?()=>{}:()=>{var On;As(),(On=U.onDismiss)==null||On.call(U,U)},className:Ct(gt?.closeButton,(h=U?.classNames)==null?void 0:h.closeButton)},kn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},kn.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),kn.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,U.jsx||kn.isValidElement(U.title)?U.jsx||U.title:kn.createElement(kn.Fragment,null,zi||U.icon||U.promise?kn.createElement("div",{"data-icon":"",className:Ct(gt?.icon,(m=U?.classNames)==null?void 0:m.icon)},U.promise||U.type==="loading"&&!U.icon?U.icon||$a():null,U.type!=="loading"?U.icon||Jt?.[zi]||L4(zi):null):null,kn.createElement("div",{"data-content":"",className:Ct(gt?.content,(b=U?.classNames)==null?void 0:b.content)},kn.createElement("div",{"data-title":"",className:Ct(gt?.title,(i=U?.classNames)==null?void 0:i.title)},U.title),U.description?kn.createElement("div",{"data-description":"",className:Ct(Tn,Qo,gt?.description,(A=U?.classNames)==null?void 0:A.description)},U.description):null),kn.isValidElement(U.cancel)?U.cancel:U.cancel&&wv(U.cancel)?kn.createElement("button",{"data-button":!0,"data-cancel":!0,style:U.cancelButtonStyle||fn,onClick:On=>{var ui,fi;wv(U.cancel)&&Ki&&((fi=(ui=U.cancel).onClick)==null||fi.call(ui,On),As())},className:Ct(gt?.cancelButton,(P=U?.classNames)==null?void 0:P.cancelButton)},U.cancel.label):null,kn.isValidElement(U.action)?U.action:U.action&&wv(U.action)?kn.createElement("button",{"data-button":!0,"data-action":!0,style:U.actionButtonStyle||En,onClick:On=>{var ui,fi;wv(U.action)&&(On.defaultPrevented||((fi=(ui=U.action).onClick)==null||fi.call(ui,On),As()))},className:Ct(gt?.actionButton,(D=U?.classNames)==null?void 0:D.actionButton)},U.action.label):null))};function _I(){if(typeof window>"u"||typeof document>"u")return"ltr";let n=document.documentElement.getAttribute("dir");return n==="auto"||!n?window.getComputedStyle(document.documentElement).direction:n}var s5=n=>{let{invert:t,position:s="bottom-right",hotkey:l=["altKey","KeyT"],expand:h,closeButton:m,className:b,offset:i,theme:A="light",richColors:P,duration:D,style:j,visibleToasts:U=K4,toastOptions:X,dir:Y=_I(),gap:W=e5,loadingIcon:re,icons:de,containerAriaLabel:Me="Notifications",pauseWhenPageIsHidden:Fe,cn:ht=r5}=n,[at,Dt]=kn.useState([]),kt=kn.useMemo(()=>Array.from(new Set([s].concat(at.filter(qe=>qe.position).map(qe=>qe.position)))),[at,s]),[Rt,fn]=kn.useState([]),[En,xn]=kn.useState(!1),[Tn,Bn]=kn.useState(!1),[Ft,wn]=kn.useState(A!=="system"?A:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Yt=kn.useRef(null),Cn=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),gt=kn.useRef(null),Jt=kn.useRef(!1),Ht=kn.useCallback(qe=>{var Ct;(Ct=at.find(Pn=>Pn.id===qe.id))!=null&&Ct.delete||Tc.dismiss(qe.id),Dt(Pn=>Pn.filter(({id:Zn})=>Zn!==qe.id))},[at]);return kn.useEffect(()=>Tc.subscribe(qe=>{if(qe.dismiss){Dt(Ct=>Ct.map(Pn=>Pn.id===qe.id?{...Pn,delete:!0}:Pn));return}setTimeout(()=>{KS.flushSync(()=>{Dt(Ct=>{let Pn=Ct.findIndex(Zn=>Zn.id===qe.id);return Pn!==-1?[...Ct.slice(0,Pn),{...Ct[Pn],...qe},...Ct.slice(Pn+1)]:[qe,...Ct]})})})}),[]),kn.useEffect(()=>{if(A!=="system"){wn(A);return}A==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?wn("dark"):wn("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:qe})=>{wn(qe?"dark":"light")})},[A]),kn.useEffect(()=>{at.length<=1&&xn(!1)},[at]),kn.useEffect(()=>{let qe=Ct=>{var Pn,Zn;l.every(Nn=>Ct[Nn]||Ct.code===Nn)&&(xn(!0),(Pn=Yt.current)==null||Pn.focus()),Ct.code==="Escape"&&(document.activeElement===Yt.current||(Zn=Yt.current)!=null&&Zn.contains(document.activeElement))&&xn(!1)};return document.addEventListener("keydown",qe),()=>document.removeEventListener("keydown",qe)},[l]),kn.useEffect(()=>{if(Yt.current)return()=>{gt.current&&(gt.current.focus({preventScroll:!0}),gt.current=null,Jt.current=!1)}},[Yt.current]),at.length?kn.createElement("section",{"aria-label":`${Me} ${Cn}`,tabIndex:-1},kt.map((qe,Ct)=>{var Pn;let[Zn,Nn]=qe.split("-");return kn.createElement("ol",{key:qe,dir:Y==="auto"?_I():Y,tabIndex:-1,ref:Yt,className:b,"data-sonner-toaster":!0,"data-theme":Ft,"data-y-position":Zn,"data-x-position":Nn,style:{"--front-toast-height":`${((Pn=Rt[0])==null?void 0:Pn.height)||0}px`,"--offset":typeof i=="number"?`${i}px`:i||Y4,"--width":`${Q4}px`,"--gap":`${W}px`,...j},onBlur:cn=>{Jt.current&&!cn.currentTarget.contains(cn.relatedTarget)&&(Jt.current=!1,gt.current&&(gt.current.focus({preventScroll:!0}),gt.current=null))},onFocus:cn=>{cn.target instanceof HTMLElement&&cn.target.dataset.dismissible==="false"||Jt.current||(Jt.current=!0,gt.current=cn.relatedTarget)},onMouseEnter:()=>xn(!0),onMouseMove:()=>xn(!0),onMouseLeave:()=>{Tn||xn(!1)},onPointerDown:cn=>{cn.target instanceof HTMLElement&&cn.target.dataset.dismissible==="false"||Bn(!0)},onPointerUp:()=>Bn(!1)},at.filter(cn=>!cn.position&&Ct===0||cn.position===qe).map((cn,un)=>{var $n,An;return kn.createElement(i5,{key:cn.id,icons:de,index:un,toast:cn,defaultRichColors:P,duration:($n=X?.duration)!=null?$n:D,className:X?.className,descriptionClassName:X?.descriptionClassName,invert:t,visibleToasts:U,closeButton:(An=X?.closeButton)!=null?An:m,interacting:Tn,position:qe,style:X?.style,unstyled:X?.unstyled,classNames:X?.classNames,cancelButtonStyle:X?.cancelButtonStyle,actionButtonStyle:X?.actionButtonStyle,removeToast:Ht,toasts:at.filter(Fn=>Fn.position==cn.position),heights:Rt.filter(Fn=>Fn.position==cn.position),setHeights:fn,expandByDefault:h,gap:W,loadingIcon:re,expanded:En,pauseWhenPageIsHidden:Fe,cn:ht})}))})):null};const o5=({...n})=>{const{theme:t="system"}=O4();return v.jsx(s5,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...n})};var a5=jk.useId||(()=>{}),l5=0;function wf(n){const[t,s]=ee.useState(a5());return sl(()=>{s(l=>l??String(l5++))},[n]),t?`radix-${t}`:""}const c5=["top","right","bottom","left"],em=Math.min,Ec=Math.max,e0=Math.round,Sv=Math.floor,tm=n=>({x:n,y:n}),u5={left:"right",right:"left",bottom:"top",top:"bottom"},h5={start:"end",end:"start"};function eS(n,t,s){return Ec(n,em(t,s))}function Ef(n,t){return typeof n=="function"?n(t):n}function Cf(n){return n.split("-")[0]}function jy(n){return n.split("-")[1]}function nT(n){return n==="x"?"y":"x"}function rT(n){return n==="y"?"height":"width"}function nm(n){return["top","bottom"].includes(Cf(n))?"y":"x"}function iT(n){return nT(nm(n))}function d5(n,t,s){s===void 0&&(s=!1);const l=jy(n),h=iT(n),m=rT(h);let b=h==="x"?l===(s?"end":"start")?"right":"left":l==="start"?"bottom":"top";return t.reference[m]>t.floating[m]&&(b=t0(b)),[b,t0(b)]}function f5(n){const t=t0(n);return[tS(n),t,tS(t)]}function tS(n){return n.replace(/start|end/g,t=>h5[t])}function p5(n,t,s){const l=["left","right"],h=["right","left"],m=["top","bottom"],b=["bottom","top"];switch(n){case"top":case"bottom":return s?t?h:l:t?l:h;case"left":case"right":return t?m:b;default:return[]}}function m5(n,t,s,l){const h=jy(n);let m=p5(Cf(n),s==="start",l);return h&&(m=m.map(b=>b+"-"+h),t&&(m=m.concat(m.map(tS)))),m}function t0(n){return n.replace(/left|right|bottom|top/g,t=>u5[t])}function g5(n){return{top:0,right:0,bottom:0,left:0,...n}}function IP(n){return typeof n!="number"?g5(n):{top:n,right:n,bottom:n,left:n}}function n0(n){const{x:t,y:s,width:l,height:h}=n;return{width:l,height:h,top:s,left:t,right:t+l,bottom:s+h,x:t,y:s}}function xI(n,t,s){let{reference:l,floating:h}=n;const m=nm(t),b=iT(t),i=rT(b),A=Cf(t),P=m==="y",D=l.x+l.width/2-h.width/2,j=l.y+l.height/2-h.height/2,U=l[i]/2-h[i]/2;let X;switch(A){case"top":X={x:D,y:l.y-h.height};break;case"bottom":X={x:D,y:l.y+l.height};break;case"right":X={x:l.x+l.width,y:j};break;case"left":X={x:l.x-h.width,y:j};break;default:X={x:l.x,y:l.y}}switch(jy(t)){case"start":X[b]-=U*(s&&P?-1:1);break;case"end":X[b]+=U*(s&&P?-1:1);break}return X}const y5=async(n,t,s)=>{const{placement:l="bottom",strategy:h="absolute",middleware:m=[],platform:b}=s,i=m.filter(Boolean),A=await(b.isRTL==null?void 0:b.isRTL(t));let P=await b.getElementRects({reference:n,floating:t,strategy:h}),{x:D,y:j}=xI(P,l,A),U=l,X={},Y=0;for(let W=0;W<i.length;W++){const{name:re,fn:de}=i[W],{x:Me,y:Fe,data:ht,reset:at}=await de({x:D,y:j,initialPlacement:l,placement:U,strategy:h,middlewareData:X,rects:P,platform:b,elements:{reference:n,floating:t}});D=Me??D,j=Fe??j,X={...X,[re]:{...X[re],...ht}},at&&Y<=50&&(Y++,typeof at=="object"&&(at.placement&&(U=at.placement),at.rects&&(P=at.rects===!0?await b.getElementRects({reference:n,floating:t,strategy:h}):at.rects),{x:D,y:j}=xI(P,U,A)),W=-1)}return{x:D,y:j,placement:U,strategy:h,middlewareData:X}};async function tx(n,t){var s;t===void 0&&(t={});const{x:l,y:h,platform:m,rects:b,elements:i,strategy:A}=n,{boundary:P="clippingAncestors",rootBoundary:D="viewport",elementContext:j="floating",altBoundary:U=!1,padding:X=0}=Ef(t,n),Y=IP(X),re=i[U?j==="floating"?"reference":"floating":j],de=n0(await m.getClippingRect({element:(s=await(m.isElement==null?void 0:m.isElement(re)))==null||s?re:re.contextElement||await(m.getDocumentElement==null?void 0:m.getDocumentElement(i.floating)),boundary:P,rootBoundary:D,strategy:A})),Me=j==="floating"?{x:l,y:h,width:b.floating.width,height:b.floating.height}:b.reference,Fe=await(m.getOffsetParent==null?void 0:m.getOffsetParent(i.floating)),ht=await(m.isElement==null?void 0:m.isElement(Fe))?await(m.getScale==null?void 0:m.getScale(Fe))||{x:1,y:1}:{x:1,y:1},at=n0(m.convertOffsetParentRelativeRectToViewportRelativeRect?await m.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:Me,offsetParent:Fe,strategy:A}):Me);return{top:(de.top-at.top+Y.top)/ht.y,bottom:(at.bottom-de.bottom+Y.bottom)/ht.y,left:(de.left-at.left+Y.left)/ht.x,right:(at.right-de.right+Y.right)/ht.x}}const _5=n=>({name:"arrow",options:n,async fn(t){const{x:s,y:l,placement:h,rects:m,platform:b,elements:i,middlewareData:A}=t,{element:P,padding:D=0}=Ef(n,t)||{};if(P==null)return{};const j=IP(D),U={x:s,y:l},X=iT(h),Y=rT(X),W=await b.getDimensions(P),re=X==="y",de=re?"top":"left",Me=re?"bottom":"right",Fe=re?"clientHeight":"clientWidth",ht=m.reference[Y]+m.reference[X]-U[X]-m.floating[Y],at=U[X]-m.reference[X],Dt=await(b.getOffsetParent==null?void 0:b.getOffsetParent(P));let kt=Dt?Dt[Fe]:0;(!kt||!await(b.isElement==null?void 0:b.isElement(Dt)))&&(kt=i.floating[Fe]||m.floating[Y]);const Rt=ht/2-at/2,fn=kt/2-W[Y]/2-1,En=em(j[de],fn),xn=em(j[Me],fn),Tn=En,Bn=kt-W[Y]-xn,Ft=kt/2-W[Y]/2+Rt,wn=eS(Tn,Ft,Bn),Yt=!A.arrow&&jy(h)!=null&&Ft!==wn&&m.reference[Y]/2-(Ft<Tn?En:xn)-W[Y]/2<0,Cn=Yt?Ft<Tn?Ft-Tn:Ft-Bn:0;return{[X]:U[X]+Cn,data:{[X]:wn,centerOffset:Ft-wn-Cn,...Yt&&{alignmentOffset:Cn}},reset:Yt}}}),x5=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(t){var s,l;const{placement:h,middlewareData:m,rects:b,initialPlacement:i,platform:A,elements:P}=t,{mainAxis:D=!0,crossAxis:j=!0,fallbackPlacements:U,fallbackStrategy:X="bestFit",fallbackAxisSideDirection:Y="none",flipAlignment:W=!0,...re}=Ef(n,t);if((s=m.arrow)!=null&&s.alignmentOffset)return{};const de=Cf(h),Me=nm(i),Fe=Cf(i)===i,ht=await(A.isRTL==null?void 0:A.isRTL(P.floating)),at=U||(Fe||!W?[t0(i)]:f5(i)),Dt=Y!=="none";!U&&Dt&&at.push(...m5(i,W,Y,ht));const kt=[i,...at],Rt=await tx(t,re),fn=[];let En=((l=m.flip)==null?void 0:l.overflows)||[];if(D&&fn.push(Rt[de]),j){const Ft=d5(h,b,ht);fn.push(Rt[Ft[0]],Rt[Ft[1]])}if(En=[...En,{placement:h,overflows:fn}],!fn.every(Ft=>Ft<=0)){var xn,Tn;const Ft=(((xn=m.flip)==null?void 0:xn.index)||0)+1,wn=kt[Ft];if(wn)return{data:{index:Ft,overflows:En},reset:{placement:wn}};let Yt=(Tn=En.filter(Cn=>Cn.overflows[0]<=0).sort((Cn,gt)=>Cn.overflows[1]-gt.overflows[1])[0])==null?void 0:Tn.placement;if(!Yt)switch(X){case"bestFit":{var Bn;const Cn=(Bn=En.filter(gt=>{if(Dt){const Jt=nm(gt.placement);return Jt===Me||Jt==="y"}return!0}).map(gt=>[gt.placement,gt.overflows.filter(Jt=>Jt>0).reduce((Jt,Ht)=>Jt+Ht,0)]).sort((gt,Jt)=>gt[1]-Jt[1])[0])==null?void 0:Bn[0];Cn&&(Yt=Cn);break}case"initialPlacement":Yt=i;break}if(h!==Yt)return{reset:{placement:Yt}}}return{}}}};function vI(n,t){return{top:n.top-t.height,right:n.right-t.width,bottom:n.bottom-t.height,left:n.left-t.width}}function bI(n){return c5.some(t=>n[t]>=0)}const v5=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(t){const{rects:s}=t,{strategy:l="referenceHidden",...h}=Ef(n,t);switch(l){case"referenceHidden":{const m=await tx(t,{...h,elementContext:"reference"}),b=vI(m,s.reference);return{data:{referenceHiddenOffsets:b,referenceHidden:bI(b)}}}case"escaped":{const m=await tx(t,{...h,altBoundary:!0}),b=vI(m,s.floating);return{data:{escapedOffsets:b,escaped:bI(b)}}}default:return{}}}}};async function b5(n,t){const{placement:s,platform:l,elements:h}=n,m=await(l.isRTL==null?void 0:l.isRTL(h.floating)),b=Cf(s),i=jy(s),A=nm(s)==="y",P=["left","top"].includes(b)?-1:1,D=m&&A?-1:1,j=Ef(t,n);let{mainAxis:U,crossAxis:X,alignmentAxis:Y}=typeof j=="number"?{mainAxis:j,crossAxis:0,alignmentAxis:null}:{mainAxis:j.mainAxis||0,crossAxis:j.crossAxis||0,alignmentAxis:j.alignmentAxis};return i&&typeof Y=="number"&&(X=i==="end"?Y*-1:Y),A?{x:X*D,y:U*P}:{x:U*P,y:X*D}}const w5=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(t){var s,l;const{x:h,y:m,placement:b,middlewareData:i}=t,A=await b5(t,n);return b===((s=i.offset)==null?void 0:s.placement)&&(l=i.arrow)!=null&&l.alignmentOffset?{}:{x:h+A.x,y:m+A.y,data:{...A,placement:b}}}}},S5=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(t){const{x:s,y:l,placement:h}=t,{mainAxis:m=!0,crossAxis:b=!1,limiter:i={fn:re=>{let{x:de,y:Me}=re;return{x:de,y:Me}}},...A}=Ef(n,t),P={x:s,y:l},D=await tx(t,A),j=nm(Cf(h)),U=nT(j);let X=P[U],Y=P[j];if(m){const re=U==="y"?"top":"left",de=U==="y"?"bottom":"right",Me=X+D[re],Fe=X-D[de];X=eS(Me,X,Fe)}if(b){const re=j==="y"?"top":"left",de=j==="y"?"bottom":"right",Me=Y+D[re],Fe=Y-D[de];Y=eS(Me,Y,Fe)}const W=i.fn({...t,[U]:X,[j]:Y});return{...W,data:{x:W.x-s,y:W.y-l,enabled:{[U]:m,[j]:b}}}}}},T5=function(n){return n===void 0&&(n={}),{options:n,fn(t){const{x:s,y:l,placement:h,rects:m,middlewareData:b}=t,{offset:i=0,mainAxis:A=!0,crossAxis:P=!0}=Ef(n,t),D={x:s,y:l},j=nm(h),U=nT(j);let X=D[U],Y=D[j];const W=Ef(i,t),re=typeof W=="number"?{mainAxis:W,crossAxis:0}:{mainAxis:0,crossAxis:0,...W};if(A){const Fe=U==="y"?"height":"width",ht=m.reference[U]-m.floating[Fe]+re.mainAxis,at=m.reference[U]+m.reference[Fe]-re.mainAxis;X<ht?X=ht:X>at&&(X=at)}if(P){var de,Me;const Fe=U==="y"?"width":"height",ht=["top","left"].includes(Cf(h)),at=m.reference[j]-m.floating[Fe]+(ht&&((de=b.offset)==null?void 0:de[j])||0)+(ht?0:re.crossAxis),Dt=m.reference[j]+m.reference[Fe]+(ht?0:((Me=b.offset)==null?void 0:Me[j])||0)-(ht?re.crossAxis:0);Y<at?Y=at:Y>Dt&&(Y=Dt)}return{[U]:X,[j]:Y}}}},E5=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(t){var s,l;const{placement:h,rects:m,platform:b,elements:i}=t,{apply:A=()=>{},...P}=Ef(n,t),D=await tx(t,P),j=Cf(h),U=jy(h),X=nm(h)==="y",{width:Y,height:W}=m.floating;let re,de;j==="top"||j==="bottom"?(re=j,de=U===(await(b.isRTL==null?void 0:b.isRTL(i.floating))?"start":"end")?"left":"right"):(de=j,re=U==="end"?"top":"bottom");const Me=W-D.top-D.bottom,Fe=Y-D.left-D.right,ht=em(W-D[re],Me),at=em(Y-D[de],Fe),Dt=!t.middlewareData.shift;let kt=ht,Rt=at;if((s=t.middlewareData.shift)!=null&&s.enabled.x&&(Rt=Fe),(l=t.middlewareData.shift)!=null&&l.enabled.y&&(kt=Me),Dt&&!U){const En=Ec(D.left,0),xn=Ec(D.right,0),Tn=Ec(D.top,0),Bn=Ec(D.bottom,0);X?Rt=Y-2*(En!==0||xn!==0?En+xn:Ec(D.left,D.right)):kt=W-2*(Tn!==0||Bn!==0?Tn+Bn:Ec(D.top,D.bottom))}await A({...t,availableWidth:Rt,availableHeight:kt});const fn=await b.getDimensions(i.floating);return Y!==fn.width||W!==fn.height?{reset:{rects:!0}}:{}}}};function n1(){return typeof window<"u"}function Fy(n){return MP(n)?(n.nodeName||"").toLowerCase():"#document"}function Ac(n){var t;return(n==null||(t=n.ownerDocument)==null?void 0:t.defaultView)||window}function vd(n){var t;return(t=(MP(n)?n.ownerDocument:n.document)||window.document)==null?void 0:t.documentElement}function MP(n){return n1()?n instanceof Node||n instanceof Ac(n).Node:!1}function dh(n){return n1()?n instanceof Element||n instanceof Ac(n).Element:!1}function md(n){return n1()?n instanceof HTMLElement||n instanceof Ac(n).HTMLElement:!1}function wI(n){return!n1()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Ac(n).ShadowRoot}function bx(n){const{overflow:t,overflowX:s,overflowY:l,display:h}=fh(n);return/auto|scroll|overlay|hidden|clip/.test(t+l+s)&&!["inline","contents"].includes(h)}function C5(n){return["table","td","th"].includes(Fy(n))}function r1(n){return[":popover-open",":modal"].some(t=>{try{return n.matches(t)}catch{return!1}})}function sT(n){const t=oT(),s=dh(n)?fh(n):n;return s.transform!=="none"||s.perspective!=="none"||(s.containerType?s.containerType!=="normal":!1)||!t&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!t&&(s.filter?s.filter!=="none":!1)||["transform","perspective","filter"].some(l=>(s.willChange||"").includes(l))||["paint","layout","strict","content"].some(l=>(s.contain||"").includes(l))}function A5(n){let t=rm(n);for(;md(t)&&!Ty(t);){if(sT(t))return t;if(r1(t))return null;t=rm(t)}return null}function oT(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Ty(n){return["html","body","#document"].includes(Fy(n))}function fh(n){return Ac(n).getComputedStyle(n)}function i1(n){return dh(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function rm(n){if(Fy(n)==="html")return n;const t=n.assignedSlot||n.parentNode||wI(n)&&n.host||vd(n);return wI(t)?t.host:t}function kP(n){const t=rm(n);return Ty(t)?n.ownerDocument?n.ownerDocument.body:n.body:md(t)&&bx(t)?t:kP(t)}function nx(n,t,s){var l;t===void 0&&(t=[]),s===void 0&&(s=!0);const h=kP(n),m=h===((l=n.ownerDocument)==null?void 0:l.body),b=Ac(h);if(m){const i=nS(b);return t.concat(b,b.visualViewport||[],bx(h)?h:[],i&&s?nx(i):[])}return t.concat(h,nx(h,[],s))}function nS(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function PP(n){const t=fh(n);let s=parseFloat(t.width)||0,l=parseFloat(t.height)||0;const h=md(n),m=h?n.offsetWidth:s,b=h?n.offsetHeight:l,i=e0(s)!==m||e0(l)!==b;return i&&(s=m,l=b),{width:s,height:l,$:i}}function aT(n){return dh(n)?n:n.contextElement}function _y(n){const t=aT(n);if(!md(t))return tm(1);const s=t.getBoundingClientRect(),{width:l,height:h,$:m}=PP(t);let b=(m?e0(s.width):s.width)/l,i=(m?e0(s.height):s.height)/h;return(!b||!Number.isFinite(b))&&(b=1),(!i||!Number.isFinite(i))&&(i=1),{x:b,y:i}}const I5=tm(0);function RP(n){const t=Ac(n);return!oT()||!t.visualViewport?I5:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function M5(n,t,s){return t===void 0&&(t=!1),!s||t&&s!==Ac(n)?!1:t}function mg(n,t,s,l){t===void 0&&(t=!1),s===void 0&&(s=!1);const h=n.getBoundingClientRect(),m=aT(n);let b=tm(1);t&&(l?dh(l)&&(b=_y(l)):b=_y(n));const i=M5(m,s,l)?RP(m):tm(0);let A=(h.left+i.x)/b.x,P=(h.top+i.y)/b.y,D=h.width/b.x,j=h.height/b.y;if(m){const U=Ac(m),X=l&&dh(l)?Ac(l):l;let Y=U,W=nS(Y);for(;W&&l&&X!==Y;){const re=_y(W),de=W.getBoundingClientRect(),Me=fh(W),Fe=de.left+(W.clientLeft+parseFloat(Me.paddingLeft))*re.x,ht=de.top+(W.clientTop+parseFloat(Me.paddingTop))*re.y;A*=re.x,P*=re.y,D*=re.x,j*=re.y,A+=Fe,P+=ht,Y=Ac(W),W=nS(Y)}}return n0({width:D,height:j,x:A,y:P})}function k5(n){let{elements:t,rect:s,offsetParent:l,strategy:h}=n;const m=h==="fixed",b=vd(l),i=t?r1(t.floating):!1;if(l===b||i&&m)return s;let A={scrollLeft:0,scrollTop:0},P=tm(1);const D=tm(0),j=md(l);if((j||!j&&!m)&&((Fy(l)!=="body"||bx(b))&&(A=i1(l)),md(l))){const U=mg(l);P=_y(l),D.x=U.x+l.clientLeft,D.y=U.y+l.clientTop}return{width:s.width*P.x,height:s.height*P.y,x:s.x*P.x-A.scrollLeft*P.x+D.x,y:s.y*P.y-A.scrollTop*P.y+D.y}}function P5(n){return Array.from(n.getClientRects())}function rS(n,t){const s=i1(n).scrollLeft;return t?t.left+s:mg(vd(n)).left+s}function R5(n){const t=vd(n),s=i1(n),l=n.ownerDocument.body,h=Ec(t.scrollWidth,t.clientWidth,l.scrollWidth,l.clientWidth),m=Ec(t.scrollHeight,t.clientHeight,l.scrollHeight,l.clientHeight);let b=-s.scrollLeft+rS(n);const i=-s.scrollTop;return fh(l).direction==="rtl"&&(b+=Ec(t.clientWidth,l.clientWidth)-h),{width:h,height:m,x:b,y:i}}function N5(n,t){const s=Ac(n),l=vd(n),h=s.visualViewport;let m=l.clientWidth,b=l.clientHeight,i=0,A=0;if(h){m=h.width,b=h.height;const P=oT();(!P||P&&t==="fixed")&&(i=h.offsetLeft,A=h.offsetTop)}return{width:m,height:b,x:i,y:A}}function D5(n,t){const s=mg(n,!0,t==="fixed"),l=s.top+n.clientTop,h=s.left+n.clientLeft,m=md(n)?_y(n):tm(1),b=n.clientWidth*m.x,i=n.clientHeight*m.y,A=h*m.x,P=l*m.y;return{width:b,height:i,x:A,y:P}}function SI(n,t,s){let l;if(t==="viewport")l=N5(n,s);else if(t==="document")l=R5(vd(n));else if(dh(t))l=D5(t,s);else{const h=RP(n);l={...t,x:t.x-h.x,y:t.y-h.y}}return n0(l)}function NP(n,t){const s=rm(n);return s===t||!dh(s)||Ty(s)?!1:fh(s).position==="fixed"||NP(s,t)}function O5(n,t){const s=t.get(n);if(s)return s;let l=nx(n,[],!1).filter(i=>dh(i)&&Fy(i)!=="body"),h=null;const m=fh(n).position==="fixed";let b=m?rm(n):n;for(;dh(b)&&!Ty(b);){const i=fh(b),A=sT(b);!A&&i.position==="fixed"&&(h=null),(m?!A&&!h:!A&&i.position==="static"&&!!h&&["absolute","fixed"].includes(h.position)||bx(b)&&!A&&NP(n,b))?l=l.filter(D=>D!==b):h=i,b=rm(b)}return t.set(n,l),l}function L5(n){let{element:t,boundary:s,rootBoundary:l,strategy:h}=n;const b=[...s==="clippingAncestors"?r1(t)?[]:O5(t,this._c):[].concat(s),l],i=b[0],A=b.reduce((P,D)=>{const j=SI(t,D,h);return P.top=Ec(j.top,P.top),P.right=em(j.right,P.right),P.bottom=em(j.bottom,P.bottom),P.left=Ec(j.left,P.left),P},SI(t,i,h));return{width:A.right-A.left,height:A.bottom-A.top,x:A.left,y:A.top}}function z5(n){const{width:t,height:s}=PP(n);return{width:t,height:s}}function j5(n,t,s){const l=md(t),h=vd(t),m=s==="fixed",b=mg(n,!0,m,t);let i={scrollLeft:0,scrollTop:0};const A=tm(0);if(l||!l&&!m)if((Fy(t)!=="body"||bx(h))&&(i=i1(t)),l){const X=mg(t,!0,m,t);A.x=X.x+t.clientLeft,A.y=X.y+t.clientTop}else h&&(A.x=rS(h));let P=0,D=0;if(h&&!l&&!m){const X=h.getBoundingClientRect();D=X.top+i.scrollTop,P=X.left+i.scrollLeft-rS(h,X)}const j=b.left+i.scrollLeft-A.x-P,U=b.top+i.scrollTop-A.y-D;return{x:j,y:U,width:b.width,height:b.height}}function Qb(n){return fh(n).position==="static"}function TI(n,t){if(!md(n)||fh(n).position==="fixed")return null;if(t)return t(n);let s=n.offsetParent;return vd(n)===s&&(s=s.ownerDocument.body),s}function DP(n,t){const s=Ac(n);if(r1(n))return s;if(!md(n)){let h=rm(n);for(;h&&!Ty(h);){if(dh(h)&&!Qb(h))return h;h=rm(h)}return s}let l=TI(n,t);for(;l&&C5(l)&&Qb(l);)l=TI(l,t);return l&&Ty(l)&&Qb(l)&&!sT(l)?s:l||A5(n)||s}const F5=async function(n){const t=this.getOffsetParent||DP,s=this.getDimensions,l=await s(n.floating);return{reference:j5(n.reference,await t(n.floating),n.strategy),floating:{x:0,y:0,width:l.width,height:l.height}}};function B5(n){return fh(n).direction==="rtl"}const V5={convertOffsetParentRelativeRectToViewportRelativeRect:k5,getDocumentElement:vd,getClippingRect:L5,getOffsetParent:DP,getElementRects:F5,getClientRects:P5,getDimensions:z5,getScale:_y,isElement:dh,isRTL:B5};function U5(n,t){let s=null,l;const h=vd(n);function m(){var i;clearTimeout(l),(i=s)==null||i.disconnect(),s=null}function b(i,A){i===void 0&&(i=!1),A===void 0&&(A=1),m();const{left:P,top:D,width:j,height:U}=n.getBoundingClientRect();if(i||t(),!j||!U)return;const X=Sv(D),Y=Sv(h.clientWidth-(P+j)),W=Sv(h.clientHeight-(D+U)),re=Sv(P),Me={rootMargin:-X+"px "+-Y+"px "+-W+"px "+-re+"px",threshold:Ec(0,em(1,A))||1};let Fe=!0;function ht(at){const Dt=at[0].intersectionRatio;if(Dt!==A){if(!Fe)return b();Dt?b(!1,Dt):l=setTimeout(()=>{b(!1,1e-7)},1e3)}Fe=!1}try{s=new IntersectionObserver(ht,{...Me,root:h.ownerDocument})}catch{s=new IntersectionObserver(ht,Me)}s.observe(n)}return b(!0),m}function $5(n,t,s,l){l===void 0&&(l={});const{ancestorScroll:h=!0,ancestorResize:m=!0,elementResize:b=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:A=!1}=l,P=aT(n),D=h||m?[...P?nx(P):[],...nx(t)]:[];D.forEach(de=>{h&&de.addEventListener("scroll",s,{passive:!0}),m&&de.addEventListener("resize",s)});const j=P&&i?U5(P,s):null;let U=-1,X=null;b&&(X=new ResizeObserver(de=>{let[Me]=de;Me&&Me.target===P&&X&&(X.unobserve(t),cancelAnimationFrame(U),U=requestAnimationFrame(()=>{var Fe;(Fe=X)==null||Fe.observe(t)})),s()}),P&&!A&&X.observe(P),X.observe(t));let Y,W=A?mg(n):null;A&&re();function re(){const de=mg(n);W&&(de.x!==W.x||de.y!==W.y||de.width!==W.width||de.height!==W.height)&&s(),W=de,Y=requestAnimationFrame(re)}return s(),()=>{var de;D.forEach(Me=>{h&&Me.removeEventListener("scroll",s),m&&Me.removeEventListener("resize",s)}),j?.(),(de=X)==null||de.disconnect(),X=null,A&&cancelAnimationFrame(Y)}}const H5=w5,G5=S5,q5=x5,W5=E5,Z5=v5,EI=_5,X5=T5,K5=(n,t,s)=>{const l=new Map,h={platform:V5,...s},m={...h.platform,_c:l};return y5(n,t,{...h,platform:m})};var $v=typeof document<"u"?ee.useLayoutEffect:ee.useEffect;function r0(n,t){if(n===t)return!0;if(typeof n!=typeof t)return!1;if(typeof n=="function"&&n.toString()===t.toString())return!0;let s,l,h;if(n&&t&&typeof n=="object"){if(Array.isArray(n)){if(s=n.length,s!==t.length)return!1;for(l=s;l--!==0;)if(!r0(n[l],t[l]))return!1;return!0}if(h=Object.keys(n),s=h.length,s!==Object.keys(t).length)return!1;for(l=s;l--!==0;)if(!{}.hasOwnProperty.call(t,h[l]))return!1;for(l=s;l--!==0;){const m=h[l];if(!(m==="_owner"&&n.$$typeof)&&!r0(n[m],t[m]))return!1}return!0}return n!==n&&t!==t}function OP(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function CI(n,t){const s=OP(n);return Math.round(t*s)/s}function ew(n){const t=ee.useRef(n);return $v(()=>{t.current=n}),t}function Y5(n){n===void 0&&(n={});const{placement:t="bottom",strategy:s="absolute",middleware:l=[],platform:h,elements:{reference:m,floating:b}={},transform:i=!0,whileElementsMounted:A,open:P}=n,[D,j]=ee.useState({x:0,y:0,strategy:s,placement:t,middlewareData:{},isPositioned:!1}),[U,X]=ee.useState(l);r0(U,l)||X(l);const[Y,W]=ee.useState(null),[re,de]=ee.useState(null),Me=ee.useCallback(gt=>{gt!==Dt.current&&(Dt.current=gt,W(gt))},[]),Fe=ee.useCallback(gt=>{gt!==kt.current&&(kt.current=gt,de(gt))},[]),ht=m||Y,at=b||re,Dt=ee.useRef(null),kt=ee.useRef(null),Rt=ee.useRef(D),fn=A!=null,En=ew(A),xn=ew(h),Tn=ew(P),Bn=ee.useCallback(()=>{if(!Dt.current||!kt.current)return;const gt={placement:t,strategy:s,middleware:U};xn.current&&(gt.platform=xn.current),K5(Dt.current,kt.current,gt).then(Jt=>{const Ht={...Jt,isPositioned:Tn.current!==!1};Ft.current&&!r0(Rt.current,Ht)&&(Rt.current=Ht,Oy.flushSync(()=>{j(Ht)}))})},[U,t,s,xn,Tn]);$v(()=>{P===!1&&Rt.current.isPositioned&&(Rt.current.isPositioned=!1,j(gt=>({...gt,isPositioned:!1})))},[P]);const Ft=ee.useRef(!1);$v(()=>(Ft.current=!0,()=>{Ft.current=!1}),[]),$v(()=>{if(ht&&(Dt.current=ht),at&&(kt.current=at),ht&&at){if(En.current)return En.current(ht,at,Bn);Bn()}},[ht,at,Bn,En,fn]);const wn=ee.useMemo(()=>({reference:Dt,floating:kt,setReference:Me,setFloating:Fe}),[Me,Fe]),Yt=ee.useMemo(()=>({reference:ht,floating:at}),[ht,at]),Cn=ee.useMemo(()=>{const gt={position:s,left:0,top:0};if(!Yt.floating)return gt;const Jt=CI(Yt.floating,D.x),Ht=CI(Yt.floating,D.y);return i?{...gt,transform:"translate("+Jt+"px, "+Ht+"px)",...OP(Yt.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:Jt,top:Ht}},[s,i,Yt.floating,D.x,D.y]);return ee.useMemo(()=>({...D,update:Bn,refs:wn,elements:Yt,floatingStyles:Cn}),[D,Bn,wn,Yt,Cn])}const J5=n=>{function t(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:n,fn(s){const{element:l,padding:h}=typeof n=="function"?n(s):n;return l&&t(l)?l.current!=null?EI({element:l.current,padding:h}).fn(s):{}:l?EI({element:l,padding:h}).fn(s):{}}}},Q5=(n,t)=>({...H5(n),options:[n,t]}),eV=(n,t)=>({...G5(n),options:[n,t]}),tV=(n,t)=>({...X5(n),options:[n,t]}),nV=(n,t)=>({...q5(n),options:[n,t]}),rV=(n,t)=>({...W5(n),options:[n,t]}),iV=(n,t)=>({...Z5(n),options:[n,t]}),sV=(n,t)=>({...J5(n),options:[n,t]});var oV="Arrow",LP=ee.forwardRef((n,t)=>{const{children:s,width:l=10,height:h=5,...m}=n;return v.jsx(ci.svg,{...m,ref:t,width:l,height:h,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?s:v.jsx("polygon",{points:"0,0 30,0 15,10"})})});LP.displayName=oV;var aV=LP;function lV(n,t=[]){let s=[];function l(m,b){const i=ee.createContext(b),A=s.length;s=[...s,b];function P(j){const{scope:U,children:X,...Y}=j,W=U?.[n][A]||i,re=ee.useMemo(()=>Y,Object.values(Y));return v.jsx(W.Provider,{value:re,children:X})}function D(j,U){const X=U?.[n][A]||i,Y=ee.useContext(X);if(Y)return Y;if(b!==void 0)return b;throw new Error(`\`${j}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(b=>ee.createContext(b));return function(i){const A=i?.[n]||m;return ee.useMemo(()=>({[`__scope${n}`]:{...i,[n]:A}}),[i,A])}};return h.scopeName=n,[l,cV(h,...t)]}function cV(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const l=n.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const b=l.reduce((i,{useScope:A,scopeName:P})=>{const j=A(m)[`__scope${P}`];return{...i,...j}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return s.scopeName=t.scopeName,s}function zP(n){const[t,s]=ee.useState(void 0);return sl(()=>{if(n){s({width:n.offsetWidth,height:n.offsetHeight});const l=new ResizeObserver(h=>{if(!Array.isArray(h)||!h.length)return;const m=h[0];let b,i;if("borderBoxSize"in m){const A=m.borderBoxSize,P=Array.isArray(A)?A[0]:A;b=P.inlineSize,i=P.blockSize}else b=n.offsetWidth,i=n.offsetHeight;s({width:b,height:i})});return l.observe(n,{box:"border-box"}),()=>l.unobserve(n)}else s(void 0)},[n]),t}var lT="Popper",[jP,By]=lV(lT),[uV,FP]=jP(lT),BP=n=>{const{__scopePopper:t,children:s}=n,[l,h]=ee.useState(null);return v.jsx(uV,{scope:t,anchor:l,onAnchorChange:h,children:s})};BP.displayName=lT;var VP="PopperAnchor",UP=ee.forwardRef((n,t)=>{const{__scopePopper:s,virtualRef:l,...h}=n,m=FP(VP,s),b=ee.useRef(null),i=us(t,b);return ee.useEffect(()=>{m.onAnchorChange(l?.current||b.current)}),l?null:v.jsx(ci.div,{...h,ref:i})});UP.displayName=VP;var cT="PopperContent",[hV,dV]=jP(cT),$P=ee.forwardRef((n,t)=>{const{__scopePopper:s,side:l="bottom",sideOffset:h=0,align:m="center",alignOffset:b=0,arrowPadding:i=0,avoidCollisions:A=!0,collisionBoundary:P=[],collisionPadding:D=0,sticky:j="partial",hideWhenDetached:U=!1,updatePositionStrategy:X="optimized",onPlaced:Y,...W}=n,re=FP(cT,s),[de,Me]=ee.useState(null),Fe=us(t,un=>Me(un)),[ht,at]=ee.useState(null),Dt=zP(ht),kt=Dt?.width??0,Rt=Dt?.height??0,fn=l+(m!=="center"?"-"+m:""),En=typeof D=="number"?D:{top:0,right:0,bottom:0,left:0,...D},xn=Array.isArray(P)?P:[P],Tn=xn.length>0,Bn={padding:En,boundary:xn.filter(pV),altBoundary:Tn},{refs:Ft,floatingStyles:wn,placement:Yt,isPositioned:Cn,middlewareData:gt}=Y5({strategy:"fixed",placement:fn,whileElementsMounted:(...un)=>$5(...un,{animationFrame:X==="always"}),elements:{reference:re.anchor},middleware:[Q5({mainAxis:h+Rt,alignmentAxis:b}),A&&eV({mainAxis:!0,crossAxis:!1,limiter:j==="partial"?tV():void 0,...Bn}),A&&nV({...Bn}),rV({...Bn,apply:({elements:un,rects:$n,availableWidth:An,availableHeight:Fn})=>{const{width:Zr,height:ni}=$n.reference,Or=un.floating.style;Or.setProperty("--radix-popper-available-width",`${An}px`),Or.setProperty("--radix-popper-available-height",`${Fn}px`),Or.setProperty("--radix-popper-anchor-width",`${Zr}px`),Or.setProperty("--radix-popper-anchor-height",`${ni}px`)}}),ht&&sV({element:ht,padding:i}),mV({arrowWidth:kt,arrowHeight:Rt}),U&&iV({strategy:"referenceHidden",...Bn})]}),[Jt,Ht]=qP(Yt),qe=Jl(Y);sl(()=>{Cn&&qe?.()},[Cn,qe]);const Ct=gt.arrow?.x,Pn=gt.arrow?.y,Zn=gt.arrow?.centerOffset!==0,[Nn,cn]=ee.useState();return sl(()=>{de&&cn(window.getComputedStyle(de).zIndex)},[de]),v.jsx("div",{ref:Ft.setFloating,"data-radix-popper-content-wrapper":"",style:{...wn,transform:Cn?wn.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Nn,"--radix-popper-transform-origin":[gt.transformOrigin?.x,gt.transformOrigin?.y].join(" "),...gt.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:v.jsx(hV,{scope:s,placedSide:Jt,onArrowChange:at,arrowX:Ct,arrowY:Pn,shouldHideArrow:Zn,children:v.jsx(ci.div,{"data-side":Jt,"data-align":Ht,...W,ref:Fe,style:{...W.style,animation:Cn?void 0:"none"}})})})});$P.displayName=cT;var HP="PopperArrow",fV={top:"bottom",right:"left",bottom:"top",left:"right"},GP=ee.forwardRef(function(t,s){const{__scopePopper:l,...h}=t,m=dV(HP,l),b=fV[m.placedSide];return v.jsx("span",{ref:m.onArrowChange,style:{position:"absolute",left:m.arrowX,top:m.arrowY,[b]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[m.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[m.placedSide],visibility:m.shouldHideArrow?"hidden":void 0},children:v.jsx(aV,{...h,ref:s,style:{...h.style,display:"block"}})})});GP.displayName=HP;function pV(n){return n!==null}var mV=n=>({name:"transformOrigin",options:n,fn(t){const{placement:s,rects:l,middlewareData:h}=t,b=h.arrow?.centerOffset!==0,i=b?0:n.arrowWidth,A=b?0:n.arrowHeight,[P,D]=qP(s),j={start:"0%",center:"50%",end:"100%"}[D],U=(h.arrow?.x??0)+i/2,X=(h.arrow?.y??0)+A/2;let Y="",W="";return P==="bottom"?(Y=b?j:`${U}px`,W=`${-A}px`):P==="top"?(Y=b?j:`${U}px`,W=`${l.floating.height+A}px`):P==="right"?(Y=`${-A}px`,W=b?j:`${X}px`):P==="left"&&(Y=`${l.floating.width+A}px`,W=b?j:`${X}px`),{data:{x:Y,y:W}}}});function qP(n){const[t,s="center"]=n.split("-");return[t,s]}var WP=BP,s1=UP,uT=$P,hT=GP,[o1,ZX]=Eg("Tooltip",[By]),dT=By(),ZP="TooltipProvider",gV=700,AI="tooltip.open",[yV,XP]=o1(ZP),KP=n=>{const{__scopeTooltip:t,delayDuration:s=gV,skipDelayDuration:l=300,disableHoverableContent:h=!1,children:m}=n,[b,i]=ee.useState(!0),A=ee.useRef(!1),P=ee.useRef(0);return ee.useEffect(()=>{const D=P.current;return()=>window.clearTimeout(D)},[]),v.jsx(yV,{scope:t,isOpenDelayed:b,delayDuration:s,onOpen:ee.useCallback(()=>{window.clearTimeout(P.current),i(!1)},[]),onClose:ee.useCallback(()=>{window.clearTimeout(P.current),P.current=window.setTimeout(()=>i(!0),l)},[l]),isPointerInTransitRef:A,onPointerInTransitChange:ee.useCallback(D=>{A.current=D},[]),disableHoverableContent:h,children:m})};KP.displayName=ZP;var YP="Tooltip",[XX,a1]=o1(YP),iS="TooltipTrigger",_V=ee.forwardRef((n,t)=>{const{__scopeTooltip:s,...l}=n,h=a1(iS,s),m=XP(iS,s),b=dT(s),i=ee.useRef(null),A=us(t,i,h.onTriggerChange),P=ee.useRef(!1),D=ee.useRef(!1),j=ee.useCallback(()=>P.current=!1,[]);return ee.useEffect(()=>()=>document.removeEventListener("pointerup",j),[j]),v.jsx(s1,{asChild:!0,...b,children:v.jsx(ci.button,{"aria-describedby":h.open?h.contentId:void 0,"data-state":h.stateAttribute,...l,ref:A,onPointerMove:wr(n.onPointerMove,U=>{U.pointerType!=="touch"&&!D.current&&!m.isPointerInTransitRef.current&&(h.onTriggerEnter(),D.current=!0)}),onPointerLeave:wr(n.onPointerLeave,()=>{h.onTriggerLeave(),D.current=!1}),onPointerDown:wr(n.onPointerDown,()=>{P.current=!0,document.addEventListener("pointerup",j,{once:!0})}),onFocus:wr(n.onFocus,()=>{P.current||h.onOpen()}),onBlur:wr(n.onBlur,h.onClose),onClick:wr(n.onClick,h.onClose)})})});_V.displayName=iS;var xV="TooltipPortal",[KX,vV]=o1(xV,{forceMount:void 0}),Ey="TooltipContent",JP=ee.forwardRef((n,t)=>{const s=vV(Ey,n.__scopeTooltip),{forceMount:l=s.forceMount,side:h="top",...m}=n,b=a1(Ey,n.__scopeTooltip);return v.jsx(Mf,{present:l||b.open,children:b.disableHoverableContent?v.jsx(QP,{side:h,...m,ref:t}):v.jsx(bV,{side:h,...m,ref:t})})}),bV=ee.forwardRef((n,t)=>{const s=a1(Ey,n.__scopeTooltip),l=XP(Ey,n.__scopeTooltip),h=ee.useRef(null),m=us(t,h),[b,i]=ee.useState(null),{trigger:A,onClose:P}=s,D=h.current,{onPointerInTransitChange:j}=l,U=ee.useCallback(()=>{i(null),j(!1)},[j]),X=ee.useCallback((Y,W)=>{const re=Y.currentTarget,de={x:Y.clientX,y:Y.clientY},Me=EV(de,re.getBoundingClientRect()),Fe=CV(de,Me),ht=AV(W.getBoundingClientRect()),at=MV([...Fe,...ht]);i(at),j(!0)},[j]);return ee.useEffect(()=>()=>U(),[U]),ee.useEffect(()=>{if(A&&D){const Y=re=>X(re,D),W=re=>X(re,A);return A.addEventListener("pointerleave",Y),D.addEventListener("pointerleave",W),()=>{A.removeEventListener("pointerleave",Y),D.removeEventListener("pointerleave",W)}}},[A,D,X,U]),ee.useEffect(()=>{if(b){const Y=W=>{const re=W.target,de={x:W.clientX,y:W.clientY},Me=A?.contains(re)||D?.contains(re),Fe=!IV(de,b);Me?U():Fe&&(U(),P())};return document.addEventListener("pointermove",Y),()=>document.removeEventListener("pointermove",Y)}},[A,D,b,P,U]),v.jsx(QP,{...n,ref:m})}),[wV,SV]=o1(YP,{isInside:!1}),QP=ee.forwardRef((n,t)=>{const{__scopeTooltip:s,children:l,"aria-label":h,onEscapeKeyDown:m,onPointerDownOutside:b,...i}=n,A=a1(Ey,s),P=dT(s),{onClose:D}=A;return ee.useEffect(()=>(document.addEventListener(AI,D),()=>document.removeEventListener(AI,D)),[D]),ee.useEffect(()=>{if(A.trigger){const j=U=>{U.target?.contains(A.trigger)&&D()};return window.addEventListener("scroll",j,{capture:!0}),()=>window.removeEventListener("scroll",j,{capture:!0})}},[A.trigger,D]),v.jsx(Ly,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:m,onPointerDownOutside:b,onFocusOutside:j=>j.preventDefault(),onDismiss:D,children:v.jsxs(uT,{"data-state":A.stateAttribute,...P,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[v.jsx(Bk,{children:l}),v.jsx(wV,{scope:s,isInside:!0,children:v.jsx(ZF,{id:A.contentId,role:"tooltip",children:h||l})})]})})});JP.displayName=Ey;var eR="TooltipArrow",TV=ee.forwardRef((n,t)=>{const{__scopeTooltip:s,...l}=n,h=dT(s);return SV(eR,s).isInside?null:v.jsx(hT,{...h,...l,ref:t})});TV.displayName=eR;function EV(n,t){const s=Math.abs(t.top-n.y),l=Math.abs(t.bottom-n.y),h=Math.abs(t.right-n.x),m=Math.abs(t.left-n.x);switch(Math.min(s,l,h,m)){case m:return"left";case h:return"right";case s:return"top";case l:return"bottom";default:throw new Error("unreachable")}}function CV(n,t,s=5){const l=[];switch(t){case"top":l.push({x:n.x-s,y:n.y+s},{x:n.x+s,y:n.y+s});break;case"bottom":l.push({x:n.x-s,y:n.y-s},{x:n.x+s,y:n.y-s});break;case"left":l.push({x:n.x+s,y:n.y-s},{x:n.x+s,y:n.y+s});break;case"right":l.push({x:n.x-s,y:n.y-s},{x:n.x-s,y:n.y+s});break}return l}function AV(n){const{top:t,right:s,bottom:l,left:h}=n;return[{x:h,y:t},{x:s,y:t},{x:s,y:l},{x:h,y:l}]}function IV(n,t){const{x:s,y:l}=n;let h=!1;for(let m=0,b=t.length-1;m<t.length;b=m++){const i=t[m].x,A=t[m].y,P=t[b].x,D=t[b].y;A>l!=D>l&&s<(P-i)*(l-A)/(D-A)+i&&(h=!h)}return h}function MV(n){const t=n.slice();return t.sort((s,l)=>s.x<l.x?-1:s.x>l.x?1:s.y<l.y?-1:s.y>l.y?1:0),kV(t)}function kV(n){if(n.length<=1)return n.slice();const t=[];for(let l=0;l<n.length;l++){const h=n[l];for(;t.length>=2;){const m=t[t.length-1],b=t[t.length-2];if((m.x-b.x)*(h.y-b.y)>=(m.y-b.y)*(h.x-b.x))t.pop();else break}t.push(h)}t.pop();const s=[];for(let l=n.length-1;l>=0;l--){const h=n[l];for(;s.length>=2;){const m=s[s.length-1],b=s[s.length-2];if((m.x-b.x)*(h.y-b.y)>=(m.y-b.y)*(h.x-b.x))s.pop();else break}s.push(h)}return s.pop(),t.length===1&&s.length===1&&t[0].x===s[0].x&&t[0].y===s[0].y?t:t.concat(s)}var PV=KP,tR=JP;const RV=PV,NV=ee.forwardRef(({className:n,sideOffset:t=4,...s},l)=>v.jsx(tR,{ref:l,sideOffset:t,className:Ai("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...s}));NV.displayName=tR.displayName;var Vy=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(n){return this.listeners.add(n),this.onSubscribe(),()=>{this.listeners.delete(n),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},gg=typeof window>"u"||"Deno"in globalThis;function fu(){}function DV(n,t){return typeof n=="function"?n(t):n}function sS(n){return typeof n=="number"&&n>=0&&n!==1/0}function nR(n,t){return Math.max(n+(t||0)-Date.now(),0)}function xy(n,t){return typeof n=="function"?n(t):n}function ch(n,t){return typeof n=="function"?n(t):n}function II(n,t){const{type:s="all",exact:l,fetchStatus:h,predicate:m,queryKey:b,stale:i}=n;if(b){if(l){if(t.queryHash!==fT(b,t.options))return!1}else if(!rx(t.queryKey,b))return!1}if(s!=="all"){const A=t.isActive();if(s==="active"&&!A||s==="inactive"&&A)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||h&&h!==t.state.fetchStatus||m&&!m(t))}function MI(n,t){const{exact:s,status:l,predicate:h,mutationKey:m}=n;if(m){if(!t.options.mutationKey)return!1;if(s){if(yg(t.options.mutationKey)!==yg(m))return!1}else if(!rx(t.options.mutationKey,m))return!1}return!(l&&t.state.status!==l||h&&!h(t))}function fT(n,t){return(t?.queryKeyHashFn||yg)(n)}function yg(n){return JSON.stringify(n,(t,s)=>oS(s)?Object.keys(s).sort().reduce((l,h)=>(l[h]=s[h],l),{}):s)}function rx(n,t){return n===t?!0:typeof n!=typeof t?!1:n&&t&&typeof n=="object"&&typeof t=="object"?!Object.keys(t).some(s=>!rx(n[s],t[s])):!1}function rR(n,t){if(n===t)return n;const s=kI(n)&&kI(t);if(s||oS(n)&&oS(t)){const l=s?n:Object.keys(n),h=l.length,m=s?t:Object.keys(t),b=m.length,i=s?[]:{};let A=0;for(let P=0;P<b;P++){const D=s?P:m[P];(!s&&l.includes(D)||s)&&n[D]===void 0&&t[D]===void 0?(i[D]=void 0,A++):(i[D]=rR(n[D],t[D]),i[D]===n[D]&&n[D]!==void 0&&A++)}return h===b&&A===h?n:i}return t}function i0(n,t){if(!t||Object.keys(n).length!==Object.keys(t).length)return!1;for(const s in n)if(n[s]!==t[s])return!1;return!0}function kI(n){return Array.isArray(n)&&n.length===Object.keys(n).length}function oS(n){if(!PI(n))return!1;const t=n.constructor;if(t===void 0)return!0;const s=t.prototype;return!(!PI(s)||!s.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(n)!==Object.prototype)}function PI(n){return Object.prototype.toString.call(n)==="[object Object]"}function OV(n){return new Promise(t=>{setTimeout(t,n)})}function aS(n,t,s){return typeof s.structuralSharing=="function"?s.structuralSharing(n,t):s.structuralSharing!==!1?rR(n,t):t}function LV(n,t,s=0){const l=[...n,t];return s&&l.length>s?l.slice(1):l}function zV(n,t,s=0){const l=[t,...n];return s&&l.length>s?l.slice(0,-1):l}var pT=Symbol();function iR(n,t){return!n.queryFn&&t?.initialPromise?()=>t.initialPromise:!n.queryFn||n.queryFn===pT?()=>Promise.reject(new Error(`Missing queryFn: '${n.queryHash}'`)):n.queryFn}var jV=class extends Vy{#e;#t;#r;constructor(){super(),this.#r=n=>{if(!gg&&window.addEventListener){const t=()=>n();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#r=n,this.#t?.(),this.#t=n(t=>{typeof t=="boolean"?this.setFocused(t):this.onFocus()})}setFocused(n){this.#e!==n&&(this.#e=n,this.onFocus())}onFocus(){const n=this.isFocused();this.listeners.forEach(t=>{t(n)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},mT=new jV,FV=class extends Vy{#e=!0;#t;#r;constructor(){super(),this.#r=n=>{if(!gg&&window.addEventListener){const t=()=>n(!0),s=()=>n(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",s,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",s)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(n){this.#r=n,this.#t?.(),this.#t=n(this.setOnline.bind(this))}setOnline(n){this.#e!==n&&(this.#e=n,this.listeners.forEach(s=>{s(n)}))}isOnline(){return this.#e}},s0=new FV;function lS(){let n,t;const s=new Promise((h,m)=>{n=h,t=m});s.status="pending",s.catch(()=>{});function l(h){Object.assign(s,h),delete s.resolve,delete s.reject}return s.resolve=h=>{l({status:"fulfilled",value:h}),n(h)},s.reject=h=>{l({status:"rejected",reason:h}),t(h)},s}function BV(n){return Math.min(1e3*2**n,3e4)}function sR(n){return(n??"online")==="online"?s0.isOnline():!0}var oR=class extends Error{constructor(n){super("CancelledError"),this.revert=n?.revert,this.silent=n?.silent}};function tw(n){return n instanceof oR}function aR(n){let t=!1,s=0,l=!1,h;const m=lS(),b=W=>{l||(U(new oR(W)),n.abort?.())},i=()=>{t=!0},A=()=>{t=!1},P=()=>mT.isFocused()&&(n.networkMode==="always"||s0.isOnline())&&n.canRun(),D=()=>sR(n.networkMode)&&n.canRun(),j=W=>{l||(l=!0,n.onSuccess?.(W),h?.(),m.resolve(W))},U=W=>{l||(l=!0,n.onError?.(W),h?.(),m.reject(W))},X=()=>new Promise(W=>{h=re=>{(l||P())&&W(re)},n.onPause?.()}).then(()=>{h=void 0,l||n.onContinue?.()}),Y=()=>{if(l)return;let W;const re=s===0?n.initialPromise:void 0;try{W=re??n.fn()}catch(de){W=Promise.reject(de)}Promise.resolve(W).then(j).catch(de=>{if(l)return;const Me=n.retry??(gg?0:3),Fe=n.retryDelay??BV,ht=typeof Fe=="function"?Fe(s,de):Fe,at=Me===!0||typeof Me=="number"&&s<Me||typeof Me=="function"&&Me(s,de);if(t||!at){U(de);return}s++,n.onFail?.(s,de),OV(ht).then(()=>P()?void 0:X()).then(()=>{t?U(de):Y()})})};return{promise:m,cancel:b,continue:()=>(h?.(),m),cancelRetry:i,continueRetry:A,canStart:D,start:()=>(D()?Y():X().then(Y),m)}}function VV(){let n=[],t=0,s=i=>{i()},l=i=>{i()},h=i=>setTimeout(i,0);const m=i=>{t?n.push(i):h(()=>{s(i)})},b=()=>{const i=n;n=[],i.length&&h(()=>{l(()=>{i.forEach(A=>{s(A)})})})};return{batch:i=>{let A;t++;try{A=i()}finally{t--,t||b()}return A},batchCalls:i=>(...A)=>{m(()=>{i(...A)})},schedule:m,setNotifyFunction:i=>{s=i},setBatchNotifyFunction:i=>{l=i},setScheduler:i=>{h=i}}}var Jo=VV(),lR=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),sS(this.gcTime)&&(this.#e=setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(n){this.gcTime=Math.max(this.gcTime||0,n??(gg?1/0:300*1e3))}clearGcTimeout(){this.#e&&(clearTimeout(this.#e),this.#e=void 0)}},UV=class extends lR{#e;#t;#r;#n;#o;#s;constructor(n){super(),this.#s=!1,this.#o=n.defaultOptions,this.setOptions(n.options),this.observers=[],this.#r=n.cache,this.queryKey=n.queryKey,this.queryHash=n.queryHash,this.#e=$V(this.options),this.state=n.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#n?.promise}setOptions(n){this.options={...this.#o,...n},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(n,t){const s=aS(this.state.data,n,this.options);return this.#i({data:s,type:"success",dataUpdatedAt:t?.updatedAt,manual:t?.manual}),s}setState(n,t){this.#i({type:"setState",state:n,setStateOptions:t})}cancel(n){const t=this.#n?.promise;return this.#n?.cancel(n),t?t.then(fu).catch(fu):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(n=>ch(n.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===pT||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(n=>n.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(n=0){return this.state.isInvalidated||this.state.data===void 0||!nR(this.state.dataUpdatedAt,n)}onFocus(){this.observers.find(t=>t.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#n?.continue()}onOnline(){this.observers.find(t=>t.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#n?.continue()}addObserver(n){this.observers.includes(n)||(this.observers.push(n),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:n}))}removeObserver(n){this.observers.includes(n)&&(this.observers=this.observers.filter(t=>t!==n),this.observers.length||(this.#n&&(this.#s?this.#n.cancel({revert:!0}):this.#n.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:n}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#i({type:"invalidate"})}fetch(n,t){if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&t?.cancelRefetch)this.cancel({silent:!0});else if(this.#n)return this.#n.continueRetry(),this.#n.promise}if(n&&this.setOptions(n),!this.options.queryFn){const i=this.observers.find(A=>A.options.queryFn);i&&this.setOptions(i.options)}const s=new AbortController,l=i=>{Object.defineProperty(i,"signal",{enumerable:!0,get:()=>(this.#s=!0,s.signal)})},h=()=>{const i=iR(this.options,t),A={queryKey:this.queryKey,meta:this.meta};return l(A),this.#s=!1,this.options.persister?this.options.persister(i,A,this):i(A)},m={fetchOptions:t,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:h};l(m),this.options.behavior?.onFetch(m,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==m.fetchOptions?.meta)&&this.#i({type:"fetch",meta:m.fetchOptions?.meta});const b=i=>{tw(i)&&i.silent||this.#i({type:"error",error:i}),tw(i)||(this.#r.config.onError?.(i,this),this.#r.config.onSettled?.(this.state.data,i,this)),this.scheduleGc()};return this.#n=aR({initialPromise:t?.initialPromise,fn:m.fetchFn,abort:s.abort.bind(s),onSuccess:i=>{if(i===void 0){b(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(i)}catch(A){b(A);return}this.#r.config.onSuccess?.(i,this),this.#r.config.onSettled?.(i,this.state.error,this),this.scheduleGc()},onError:b,onFail:(i,A)=>{this.#i({type:"failed",failureCount:i,error:A})},onPause:()=>{this.#i({type:"pause"})},onContinue:()=>{this.#i({type:"continue"})},retry:m.options.retry,retryDelay:m.options.retryDelay,networkMode:m.options.networkMode,canRun:()=>!0}),this.#n.start()}#i(n){const t=s=>{switch(n.type){case"failed":return{...s,fetchFailureCount:n.failureCount,fetchFailureReason:n.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...cR(s.data,this.options),fetchMeta:n.meta??null};case"success":return{...s,data:n.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:n.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!n.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=n.error;return tw(l)&&l.revert&&this.#t?{...this.#t,fetchStatus:"idle"}:{...s,error:l,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...n.state}}};this.state=t(this.state),Jo.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:n})})}};function cR(n,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:sR(t.networkMode)?"fetching":"paused",...n===void 0&&{error:null,status:"pending"}}}function $V(n){const t=typeof n.initialData=="function"?n.initialData():n.initialData,s=t!==void 0,l=s?typeof n.initialDataUpdatedAt=="function"?n.initialDataUpdatedAt():n.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:s?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:s?"success":"pending",fetchStatus:"idle"}}var HV=class extends Vy{constructor(n={}){super(),this.config=n,this.#e=new Map}#e;build(n,t,s){const l=t.queryKey,h=t.queryHash??fT(l,t);let m=this.get(h);return m||(m=new UV({cache:this,queryKey:l,queryHash:h,options:n.defaultQueryOptions(t),state:s,defaultOptions:n.getQueryDefaults(l)}),this.add(m)),m}add(n){this.#e.has(n.queryHash)||(this.#e.set(n.queryHash,n),this.notify({type:"added",query:n}))}remove(n){const t=this.#e.get(n.queryHash);t&&(n.destroy(),t===n&&this.#e.delete(n.queryHash),this.notify({type:"removed",query:n}))}clear(){Jo.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}get(n){return this.#e.get(n)}getAll(){return[...this.#e.values()]}find(n){const t={exact:!0,...n};return this.getAll().find(s=>II(t,s))}findAll(n={}){const t=this.getAll();return Object.keys(n).length>0?t.filter(s=>II(n,s)):t}notify(n){Jo.batch(()=>{this.listeners.forEach(t=>{t(n)})})}onFocus(){Jo.batch(()=>{this.getAll().forEach(n=>{n.onFocus()})})}onOnline(){Jo.batch(()=>{this.getAll().forEach(n=>{n.onOnline()})})}},GV=class extends lR{#e;#t;#r;constructor(n){super(),this.mutationId=n.mutationId,this.#t=n.mutationCache,this.#e=[],this.state=n.state||uR(),this.setOptions(n.options),this.scheduleGc()}setOptions(n){this.options=n,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(n){this.#e.includes(n)||(this.#e.push(n),this.clearGcTimeout(),this.#t.notify({type:"observerAdded",mutation:this,observer:n}))}removeObserver(n){this.#e=this.#e.filter(t=>t!==n),this.scheduleGc(),this.#t.notify({type:"observerRemoved",mutation:this,observer:n})}optionalRemove(){this.#e.length||(this.state.status==="pending"?this.scheduleGc():this.#t.remove(this))}continue(){return this.#r?.continue()??this.execute(this.state.variables)}async execute(n){this.#r=aR({fn:()=>this.options.mutationFn?this.options.mutationFn(n):Promise.reject(new Error("No mutationFn found")),onFail:(l,h)=>{this.#n({type:"failed",failureCount:l,error:h})},onPause:()=>{this.#n({type:"pause"})},onContinue:()=>{this.#n({type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#t.canRun(this)});const t=this.state.status==="pending",s=!this.#r.canStart();try{if(!t){this.#n({type:"pending",variables:n,isPaused:s}),await this.#t.config.onMutate?.(n,this);const h=await this.options.onMutate?.(n);h!==this.state.context&&this.#n({type:"pending",context:h,variables:n,isPaused:s})}const l=await this.#r.start();return await this.#t.config.onSuccess?.(l,n,this.state.context,this),await this.options.onSuccess?.(l,n,this.state.context),await this.#t.config.onSettled?.(l,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(l,null,n,this.state.context),this.#n({type:"success",data:l}),l}catch(l){try{throw await this.#t.config.onError?.(l,n,this.state.context,this),await this.options.onError?.(l,n,this.state.context),await this.#t.config.onSettled?.(void 0,l,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,l,n,this.state.context),l}finally{this.#n({type:"error",error:l})}}finally{this.#t.runNext(this)}}#n(n){const t=s=>{switch(n.type){case"failed":return{...s,failureCount:n.failureCount,failureReason:n.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:n.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:n.isPaused,status:"pending",variables:n.variables,submittedAt:Date.now()};case"success":return{...s,data:n.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:n.error,failureCount:s.failureCount+1,failureReason:n.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Jo.batch(()=>{this.#e.forEach(s=>{s.onMutationUpdate(n)}),this.#t.notify({mutation:this,type:"updated",action:n})})}};function uR(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var qV=class extends Vy{constructor(n={}){super(),this.config=n,this.#e=new Map,this.#t=Date.now()}#e;#t;build(n,t,s){const l=new GV({mutationCache:this,mutationId:++this.#t,options:n.defaultMutationOptions(t),state:s});return this.add(l),l}add(n){const t=Tv(n),s=this.#e.get(t)??[];s.push(n),this.#e.set(t,s),this.notify({type:"added",mutation:n})}remove(n){const t=Tv(n);if(this.#e.has(t)){const s=this.#e.get(t)?.filter(l=>l!==n);s&&(s.length===0?this.#e.delete(t):this.#e.set(t,s))}this.notify({type:"removed",mutation:n})}canRun(n){const t=this.#e.get(Tv(n))?.find(s=>s.state.status==="pending");return!t||t===n}runNext(n){return this.#e.get(Tv(n))?.find(s=>s!==n&&s.state.isPaused)?.continue()??Promise.resolve()}clear(){Jo.batch(()=>{this.getAll().forEach(n=>{this.remove(n)})})}getAll(){return[...this.#e.values()].flat()}find(n){const t={exact:!0,...n};return this.getAll().find(s=>MI(t,s))}findAll(n={}){return this.getAll().filter(t=>MI(n,t))}notify(n){Jo.batch(()=>{this.listeners.forEach(t=>{t(n)})})}resumePausedMutations(){const n=this.getAll().filter(t=>t.state.isPaused);return Jo.batch(()=>Promise.all(n.map(t=>t.continue().catch(fu))))}};function Tv(n){return n.options.scope?.id??String(n.mutationId)}function RI(n){return{onFetch:(t,s)=>{const l=t.options,h=t.fetchOptions?.meta?.fetchMore?.direction,m=t.state.data?.pages||[],b=t.state.data?.pageParams||[];let i={pages:[],pageParams:[]},A=0;const P=async()=>{let D=!1;const j=Y=>{Object.defineProperty(Y,"signal",{enumerable:!0,get:()=>(t.signal.aborted?D=!0:t.signal.addEventListener("abort",()=>{D=!0}),t.signal)})},U=iR(t.options,t.fetchOptions),X=async(Y,W,re)=>{if(D)return Promise.reject();if(W==null&&Y.pages.length)return Promise.resolve(Y);const de={queryKey:t.queryKey,pageParam:W,direction:re?"backward":"forward",meta:t.options.meta};j(de);const Me=await U(de),{maxPages:Fe}=t.options,ht=re?zV:LV;return{pages:ht(Y.pages,Me,Fe),pageParams:ht(Y.pageParams,W,Fe)}};if(h&&m.length){const Y=h==="backward",W=Y?WV:NI,re={pages:m,pageParams:b},de=W(l,re);i=await X(re,de,Y)}else{const Y=n??m.length;do{const W=A===0?b[0]??l.initialPageParam:NI(l,i);if(A>0&&W==null)break;i=await X(i,W),A++}while(A<Y)}return i};t.options.persister?t.fetchFn=()=>t.options.persister?.(P,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},s):t.fetchFn=P}}}function NI(n,{pages:t,pageParams:s}){const l=t.length-1;return t.length>0?n.getNextPageParam(t[l],t,s[l],s):void 0}function WV(n,{pages:t,pageParams:s}){return t.length>0?n.getPreviousPageParam?.(t[0],t,s[0],s):void 0}var ZV=class{#e;#t;#r;#n;#o;#s;#i;#a;constructor(n={}){this.#e=n.queryCache||new HV,this.#t=n.mutationCache||new qV,this.#r=n.defaultOptions||{},this.#n=new Map,this.#o=new Map,this.#s=0}mount(){this.#s++,this.#s===1&&(this.#i=mT.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#a=s0.subscribe(async n=>{n&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#s--,this.#s===0&&(this.#i?.(),this.#i=void 0,this.#a?.(),this.#a=void 0)}isFetching(n){return this.#e.findAll({...n,fetchStatus:"fetching"}).length}isMutating(n){return this.#t.findAll({...n,status:"pending"}).length}getQueryData(n){const t=this.defaultQueryOptions({queryKey:n});return this.#e.get(t.queryHash)?.state.data}ensureQueryData(n){const t=this.getQueryData(n.queryKey);if(t===void 0)return this.fetchQuery(n);{const s=this.defaultQueryOptions(n),l=this.#e.build(this,s);return n.revalidateIfStale&&l.isStaleByTime(xy(s.staleTime,l))&&this.prefetchQuery(s),Promise.resolve(t)}}getQueriesData(n){return this.#e.findAll(n).map(({queryKey:t,state:s})=>{const l=s.data;return[t,l]})}setQueryData(n,t,s){const l=this.defaultQueryOptions({queryKey:n}),m=this.#e.get(l.queryHash)?.state.data,b=DV(t,m);if(b!==void 0)return this.#e.build(this,l).setData(b,{...s,manual:!0})}setQueriesData(n,t,s){return Jo.batch(()=>this.#e.findAll(n).map(({queryKey:l})=>[l,this.setQueryData(l,t,s)]))}getQueryState(n){const t=this.defaultQueryOptions({queryKey:n});return this.#e.get(t.queryHash)?.state}removeQueries(n){const t=this.#e;Jo.batch(()=>{t.findAll(n).forEach(s=>{t.remove(s)})})}resetQueries(n,t){const s=this.#e,l={type:"active",...n};return Jo.batch(()=>(s.findAll(n).forEach(h=>{h.reset()}),this.refetchQueries(l,t)))}cancelQueries(n={},t={}){const s={revert:!0,...t},l=Jo.batch(()=>this.#e.findAll(n).map(h=>h.cancel(s)));return Promise.all(l).then(fu).catch(fu)}invalidateQueries(n={},t={}){return Jo.batch(()=>{if(this.#e.findAll(n).forEach(l=>{l.invalidate()}),n.refetchType==="none")return Promise.resolve();const s={...n,type:n.refetchType??n.type??"active"};return this.refetchQueries(s,t)})}refetchQueries(n={},t){const s={...t,cancelRefetch:t?.cancelRefetch??!0},l=Jo.batch(()=>this.#e.findAll(n).filter(h=>!h.isDisabled()).map(h=>{let m=h.fetch(void 0,s);return s.throwOnError||(m=m.catch(fu)),h.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(fu)}fetchQuery(n){const t=this.defaultQueryOptions(n);t.retry===void 0&&(t.retry=!1);const s=this.#e.build(this,t);return s.isStaleByTime(xy(t.staleTime,s))?s.fetch(t):Promise.resolve(s.state.data)}prefetchQuery(n){return this.fetchQuery(n).then(fu).catch(fu)}fetchInfiniteQuery(n){return n.behavior=RI(n.pages),this.fetchQuery(n)}prefetchInfiniteQuery(n){return this.fetchInfiniteQuery(n).then(fu).catch(fu)}ensureInfiniteQueryData(n){return n.behavior=RI(n.pages),this.ensureQueryData(n)}resumePausedMutations(){return s0.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(n){this.#r=n}setQueryDefaults(n,t){this.#n.set(yg(n),{queryKey:n,defaultOptions:t})}getQueryDefaults(n){const t=[...this.#n.values()];let s={};return t.forEach(l=>{rx(n,l.queryKey)&&(s={...s,...l.defaultOptions})}),s}setMutationDefaults(n,t){this.#o.set(yg(n),{mutationKey:n,defaultOptions:t})}getMutationDefaults(n){const t=[...this.#o.values()];let s={};return t.forEach(l=>{rx(n,l.mutationKey)&&(s={...s,...l.defaultOptions})}),s}defaultQueryOptions(n){if(n._defaulted)return n;const t={...this.#r.queries,...this.getQueryDefaults(n.queryKey),...n,_defaulted:!0};return t.queryHash||(t.queryHash=fT(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===pT&&(t.enabled=!1),t}defaultMutationOptions(n){return n?._defaulted?n:{...this.#r.mutations,...n?.mutationKey&&this.getMutationDefaults(n.mutationKey),...n,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},XV=class extends Vy{constructor(n,t){super(),this.options=t,this.#e=n,this.#a=null,this.#i=lS(),this.options.experimental_prefetchInRender||this.#i.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(t)}#e;#t=void 0;#r=void 0;#n=void 0;#o;#s;#i;#a;#m;#d;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),DI(this.#t,this.options)?this.#h():this.updateResult(),this.#x())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return cS(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return cS(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#b(),this.#t.removeObserver(this)}setOptions(n,t){const s=this.options,l=this.#t;if(this.options=this.#e.defaultQueryOptions(n),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ch(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),s._defaulted&&!i0(this.options,s)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const h=this.hasListeners();h&&OI(this.#t,l,this.options,s)&&this.#h(),this.updateResult(t),h&&(this.#t!==l||ch(this.options.enabled,this.#t)!==ch(s.enabled,this.#t)||xy(this.options.staleTime,this.#t)!==xy(s.staleTime,this.#t))&&this.#g();const m=this.#y();h&&(this.#t!==l||ch(this.options.enabled,this.#t)!==ch(s.enabled,this.#t)||m!==this.#l)&&this.#_(m)}getOptimisticResult(n){const t=this.#e.getQueryCache().build(this.#e,n),s=this.createResult(t,n);return YV(this,s)&&(this.#n=s,this.#s=this.options,this.#o=this.#t.state),s}getCurrentResult(){return this.#n}trackResult(n,t){const s={};return Object.keys(n).forEach(l=>{Object.defineProperty(s,l,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(l),t?.(l),n[l])})}),s}trackProp(n){this.#p.add(n)}getCurrentQuery(){return this.#t}refetch({...n}={}){return this.fetch({...n})}fetchOptimistic(n){const t=this.#e.defaultQueryOptions(n),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(n){return this.#h({...n,cancelRefetch:n.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#h(n){this.#w();let t=this.#t.fetch(this.options,n);return n?.throwOnError||(t=t.catch(fu)),t}#g(){this.#v();const n=xy(this.options.staleTime,this.#t);if(gg||this.#n.isStale||!sS(n))return;const s=nR(this.#n.dataUpdatedAt,n)+1;this.#c=setTimeout(()=>{this.#n.isStale||this.updateResult()},s)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(n){this.#b(),this.#l=n,!(gg||ch(this.options.enabled,this.#t)===!1||!sS(this.#l)||this.#l===0)&&(this.#u=setInterval(()=>{(this.options.refetchIntervalInBackground||mT.isFocused())&&this.#h()},this.#l))}#x(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(clearInterval(this.#u),this.#u=void 0)}createResult(n,t){const s=this.#t,l=this.options,h=this.#n,m=this.#o,b=this.#s,A=n!==s?n.state:this.#r,{state:P}=n;let D={...P},j=!1,U;if(t._optimisticResults){const kt=this.hasListeners(),Rt=!kt&&DI(n,t),fn=kt&&OI(n,s,t,l);(Rt||fn)&&(D={...D,...cR(P.data,n.options)}),t._optimisticResults==="isRestoring"&&(D.fetchStatus="idle")}let{error:X,errorUpdatedAt:Y,status:W}=D;if(t.select&&D.data!==void 0)if(h&&D.data===m?.data&&t.select===this.#m)U=this.#d;else try{this.#m=t.select,U=t.select(D.data),U=aS(h?.data,U,t),this.#d=U,this.#a=null}catch(kt){this.#a=kt}else U=D.data;if(t.placeholderData!==void 0&&U===void 0&&W==="pending"){let kt;if(h?.isPlaceholderData&&t.placeholderData===b?.placeholderData)kt=h.data;else if(kt=typeof t.placeholderData=="function"?t.placeholderData(this.#f?.state.data,this.#f):t.placeholderData,t.select&&kt!==void 0)try{kt=t.select(kt),this.#a=null}catch(Rt){this.#a=Rt}kt!==void 0&&(W="success",U=aS(h?.data,kt,t),j=!0)}this.#a&&(X=this.#a,U=this.#d,Y=Date.now(),W="error");const re=D.fetchStatus==="fetching",de=W==="pending",Me=W==="error",Fe=de&&re,ht=U!==void 0,Dt={status:W,fetchStatus:D.fetchStatus,isPending:de,isSuccess:W==="success",isError:Me,isInitialLoading:Fe,isLoading:Fe,data:U,dataUpdatedAt:D.dataUpdatedAt,error:X,errorUpdatedAt:Y,failureCount:D.fetchFailureCount,failureReason:D.fetchFailureReason,errorUpdateCount:D.errorUpdateCount,isFetched:D.dataUpdateCount>0||D.errorUpdateCount>0,isFetchedAfterMount:D.dataUpdateCount>A.dataUpdateCount||D.errorUpdateCount>A.errorUpdateCount,isFetching:re,isRefetching:re&&!de,isLoadingError:Me&&!ht,isPaused:D.fetchStatus==="paused",isPlaceholderData:j,isRefetchError:Me&&ht,isStale:gT(n,t),refetch:this.refetch,promise:this.#i};if(this.options.experimental_prefetchInRender){const kt=En=>{Dt.status==="error"?En.reject(Dt.error):Dt.data!==void 0&&En.resolve(Dt.data)},Rt=()=>{const En=this.#i=Dt.promise=lS();kt(En)},fn=this.#i;switch(fn.status){case"pending":n.queryHash===s.queryHash&&kt(fn);break;case"fulfilled":(Dt.status==="error"||Dt.data!==fn.value)&&Rt();break;case"rejected":(Dt.status!=="error"||Dt.error!==fn.reason)&&Rt();break}}return Dt}updateResult(n){const t=this.#n,s=this.createResult(this.#t,this.options);if(this.#o=this.#t.state,this.#s=this.options,this.#o.data!==void 0&&(this.#f=this.#t),i0(s,t))return;this.#n=s;const l={},h=()=>{if(!t)return!0;const{notifyOnChangeProps:m}=this.options,b=typeof m=="function"?m():m;if(b==="all"||!b&&!this.#p.size)return!0;const i=new Set(b??this.#p);return this.options.throwOnError&&i.add("error"),Object.keys(this.#n).some(A=>{const P=A;return this.#n[P]!==t[P]&&i.has(P)})};n?.listeners!==!1&&h()&&(l.listeners=!0),this.#S({...l,...n})}#w(){const n=this.#e.getQueryCache().build(this.#e,this.options);if(n===this.#t)return;const t=this.#t;this.#t=n,this.#r=n.state,this.hasListeners()&&(t?.removeObserver(this),n.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#x()}#S(n){Jo.batch(()=>{n.listeners&&this.listeners.forEach(t=>{t(this.#n)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function KV(n,t){return ch(t.enabled,n)!==!1&&n.state.data===void 0&&!(n.state.status==="error"&&t.retryOnMount===!1)}function DI(n,t){return KV(n,t)||n.state.data!==void 0&&cS(n,t,t.refetchOnMount)}function cS(n,t,s){if(ch(t.enabled,n)!==!1){const l=typeof s=="function"?s(n):s;return l==="always"||l!==!1&&gT(n,t)}return!1}function OI(n,t,s,l){return(n!==t||ch(l.enabled,n)===!1)&&(!s.suspense||n.state.status!=="error")&&gT(n,s)}function gT(n,t){return ch(t.enabled,n)!==!1&&n.isStaleByTime(xy(t.staleTime,n))}function YV(n,t){return!i0(n.getCurrentResult(),t)}var JV=class extends Vy{#e;#t=void 0;#r;#n;constructor(t,s){super(),this.#e=t,this.setOptions(s),this.bindMethods(),this.#o()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#e.defaultMutationOptions(t),i0(this.options,s)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),s?.mutationKey&&this.options.mutationKey&&yg(s.mutationKey)!==yg(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#o(),this.#s(t)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#o(),this.#s()}mutate(t,s){return this.#n=s,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(t)}#o(){const t=this.#r?.state??uR();this.#t={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#s(t){Jo.batch(()=>{if(this.#n&&this.hasListeners()){const s=this.#t.variables,l=this.#t.context;t?.type==="success"?(this.#n.onSuccess?.(t.data,s,l),this.#n.onSettled?.(t.data,null,s,l)):t?.type==="error"&&(this.#n.onError?.(t.error,s,l),this.#n.onSettled?.(void 0,t.error,s,l))}this.listeners.forEach(s=>{s(this.#t)})})}},hR=ee.createContext(void 0),yT=n=>{const t=ee.useContext(hR);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},QV=({client:n,children:t})=>(ee.useEffect(()=>(n.mount(),()=>{n.unmount()}),[n]),v.jsx(hR.Provider,{value:n,children:t})),dR=ee.createContext(!1),e6=()=>ee.useContext(dR);dR.Provider;function t6(){let n=!1;return{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n}}var n6=ee.createContext(t6()),r6=()=>ee.useContext(n6);function fR(n,t){return typeof n=="function"?n(...t):!!n}function pR(){}var i6=(n,t)=>{(n.suspense||n.throwOnError)&&(t.isReset()||(n.retryOnMount=!1))},s6=n=>{ee.useEffect(()=>{n.clearReset()},[n])},o6=({result:n,errorResetBoundary:t,throwOnError:s,query:l})=>n.isError&&!t.isReset()&&!n.isFetching&&l&&fR(s,[n.error,l]),a6=n=>{n.suspense&&(n.staleTime===void 0&&(n.staleTime=1e3),typeof n.gcTime=="number"&&(n.gcTime=Math.max(n.gcTime,1e3)))},l6=(n,t)=>n.isLoading&&n.isFetching&&!t,c6=(n,t)=>n?.suspense&&t.isPending,LI=(n,t,s)=>t.fetchOptimistic(n).catch(()=>{s.clearReset()});function u6(n,t,s){const l=yT(),h=e6(),m=r6(),b=l.defaultQueryOptions(n);l.getDefaultOptions().queries?._experimental_beforeQuery?.(b),b._optimisticResults=h?"isRestoring":"optimistic",a6(b),i6(b,m),s6(m);const i=!l.getQueryCache().get(b.queryHash),[A]=ee.useState(()=>new t(l,b)),P=A.getOptimisticResult(b);if(ee.useSyncExternalStore(ee.useCallback(D=>{const j=h?()=>{}:A.subscribe(Jo.batchCalls(D));return A.updateResult(),j},[A,h]),()=>A.getCurrentResult(),()=>A.getCurrentResult()),ee.useEffect(()=>{A.setOptions(b,{listeners:!1})},[b,A]),c6(b,P))throw LI(b,A,m);if(o6({result:P,errorResetBoundary:m,throwOnError:b.throwOnError,query:l.getQueryCache().get(b.queryHash)}))throw P.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(b,P),b.experimental_prefetchInRender&&!gg&&l6(P,h)&&(i?LI(b,A,m):l.getQueryCache().get(b.queryHash)?.promise)?.catch(pR).finally(()=>{A.updateResult()}),b.notifyOnChangeProps?P:A.trackResult(P)}function ah(n,t){return u6(n,XV)}function ps(n,t){const s=yT(),[l]=ee.useState(()=>new JV(s,n));ee.useEffect(()=>{l.setOptions(n)},[l,n]);const h=ee.useSyncExternalStore(ee.useCallback(b=>l.subscribe(Jo.batchCalls(b)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),m=ee.useCallback((b,i)=>{l.mutate(b,i).catch(pR)},[l]);if(h.error&&fR(l.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:m,mutateAsync:h.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ix(){return ix=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])}return n},ix.apply(this,arguments)}var Up;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Up||(Up={}));const zI="popstate";function h6(n){n===void 0&&(n={});function t(h,m){let{pathname:b="/",search:i="",hash:A=""}=Cg(h.location.hash.substr(1));return!b.startsWith("/")&&!b.startsWith(".")&&(b="/"+b),uS("",{pathname:b,search:i,hash:A},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function s(h,m){let b=h.document.querySelector("base"),i="";if(b&&b.getAttribute("href")){let A=h.location.href,P=A.indexOf("#");i=P===-1?A:A.slice(0,P)}return i+"#"+(typeof m=="string"?m:o0(m))}function l(h,m){_T(h.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(m)+")")}return f6(t,s,l,n)}function wo(n,t){if(n===!1||n===null||typeof n>"u")throw new Error(t)}function _T(n,t){if(!n){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function d6(){return Math.random().toString(36).substr(2,8)}function jI(n,t){return{usr:n.state,key:n.key,idx:t}}function uS(n,t,s,l){return s===void 0&&(s=null),ix({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof t=="string"?Cg(t):t,{state:s,key:t&&t.key||l||d6()})}function o0(n){let{pathname:t="/",search:s="",hash:l=""}=n;return s&&s!=="?"&&(t+=s.charAt(0)==="?"?s:"?"+s),l&&l!=="#"&&(t+=l.charAt(0)==="#"?l:"#"+l),t}function Cg(n){let t={};if(n){let s=n.indexOf("#");s>=0&&(t.hash=n.substr(s),n=n.substr(0,s));let l=n.indexOf("?");l>=0&&(t.search=n.substr(l),n=n.substr(0,l)),n&&(t.pathname=n)}return t}function f6(n,t,s,l){l===void 0&&(l={});let{window:h=document.defaultView,v5Compat:m=!1}=l,b=h.history,i=Up.Pop,A=null,P=D();P==null&&(P=0,b.replaceState(ix({},b.state,{idx:P}),""));function D(){return(b.state||{idx:null}).idx}function j(){i=Up.Pop;let re=D(),de=re==null?null:re-P;P=re,A&&A({action:i,location:W.location,delta:de})}function U(re,de){i=Up.Push;let Me=uS(W.location,re,de);s&&s(Me,re),P=D()+1;let Fe=jI(Me,P),ht=W.createHref(Me);try{b.pushState(Fe,"",ht)}catch(at){if(at instanceof DOMException&&at.name==="DataCloneError")throw at;h.location.assign(ht)}m&&A&&A({action:i,location:W.location,delta:1})}function X(re,de){i=Up.Replace;let Me=uS(W.location,re,de);s&&s(Me,re),P=D();let Fe=jI(Me,P),ht=W.createHref(Me);b.replaceState(Fe,"",ht),m&&A&&A({action:i,location:W.location,delta:0})}function Y(re){let de=h.location.origin!=="null"?h.location.origin:h.location.href,Me=typeof re=="string"?re:o0(re);return Me=Me.replace(/ $/,"%20"),wo(de,"No window.location.(origin|href) available to create URL for href: "+Me),new URL(Me,de)}let W={get action(){return i},get location(){return n(h,b)},listen(re){if(A)throw new Error("A history only accepts one active listener");return h.addEventListener(zI,j),A=re,()=>{h.removeEventListener(zI,j),A=null}},createHref(re){return t(h,re)},createURL:Y,encodeLocation(re){let de=Y(re);return{pathname:de.pathname,search:de.search,hash:de.hash}},push:U,replace:X,go(re){return b.go(re)}};return W}var FI;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(FI||(FI={}));function p6(n,t,s){return s===void 0&&(s="/"),m6(n,t,s)}function m6(n,t,s,l){let h=typeof t=="string"?Cg(t):t,m=xT(h.pathname||"/",s);if(m==null)return null;let b=mR(n);g6(b);let i=null;for(let A=0;i==null&&A<b.length;++A){let P=I6(m);i=E6(b[A],P)}return i}function mR(n,t,s,l){t===void 0&&(t=[]),s===void 0&&(s=[]),l===void 0&&(l="");let h=(m,b,i)=>{let A={relativePath:i===void 0?m.path||"":i,caseSensitive:m.caseSensitive===!0,childrenIndex:b,route:m};A.relativePath.startsWith("/")&&(wo(A.relativePath.startsWith(l),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(l.length));let P=qp([l,A.relativePath]),D=s.concat(A);m.children&&m.children.length>0&&(wo(m.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+P+'".')),mR(m.children,t,D,P)),!(m.path==null&&!m.index)&&t.push({path:P,score:S6(P,m.index),routesMeta:D})};return n.forEach((m,b)=>{var i;if(m.path===""||!((i=m.path)!=null&&i.includes("?")))h(m,b);else for(let A of gR(m.path))h(m,b,A)}),t}function gR(n){let t=n.split("/");if(t.length===0)return[];let[s,...l]=t,h=s.endsWith("?"),m=s.replace(/\?$/,"");if(l.length===0)return h?[m,""]:[m];let b=gR(l.join("/")),i=[];return i.push(...b.map(A=>A===""?m:[m,A].join("/"))),h&&i.push(...b),i.map(A=>n.startsWith("/")&&A===""?"/":A)}function g6(n){n.sort((t,s)=>t.score!==s.score?s.score-t.score:T6(t.routesMeta.map(l=>l.childrenIndex),s.routesMeta.map(l=>l.childrenIndex)))}const y6=/^:[\w-]+$/,_6=3,x6=2,v6=1,b6=10,w6=-2,BI=n=>n==="*";function S6(n,t){let s=n.split("/"),l=s.length;return s.some(BI)&&(l+=w6),t&&(l+=x6),s.filter(h=>!BI(h)).reduce((h,m)=>h+(y6.test(m)?_6:m===""?v6:b6),l)}function T6(n,t){return n.length===t.length&&n.slice(0,-1).every((l,h)=>l===t[h])?n[n.length-1]-t[t.length-1]:0}function E6(n,t,s){let{routesMeta:l}=n,h={},m="/",b=[];for(let i=0;i<l.length;++i){let A=l[i],P=i===l.length-1,D=m==="/"?t:t.slice(m.length)||"/",j=C6({path:A.relativePath,caseSensitive:A.caseSensitive,end:P},D),U=A.route;if(!j)return null;Object.assign(h,j.params),b.push({params:h,pathname:qp([m,j.pathname]),pathnameBase:R6(qp([m,j.pathnameBase])),route:U}),j.pathnameBase!=="/"&&(m=qp([m,j.pathnameBase]))}return b}function C6(n,t){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[s,l]=A6(n.path,n.caseSensitive,n.end),h=t.match(s);if(!h)return null;let m=h[0],b=m.replace(/(.)\/+$/,"$1"),i=h.slice(1);return{params:l.reduce((P,D,j)=>{let{paramName:U,isOptional:X}=D;if(U==="*"){let W=i[j]||"";b=m.slice(0,m.length-W.length).replace(/(.)\/+$/,"$1")}const Y=i[j];return X&&!Y?P[U]=void 0:P[U]=(Y||"").replace(/%2F/g,"/"),P},{}),pathname:m,pathnameBase:b,pattern:n}}function A6(n,t,s){t===void 0&&(t=!1),s===void 0&&(s=!0),_T(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let l=[],h="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(b,i,A)=>(l.push({paramName:i,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(l.push({paramName:"*"}),h+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?h+="\\/*$":n!==""&&n!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,t?void 0:"i"),l]}function I6(n){try{return n.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return _T(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),n}}function xT(n,t){if(t==="/")return n;if(!n.toLowerCase().startsWith(t.toLowerCase()))return null;let s=t.endsWith("/")?t.length-1:t.length,l=n.charAt(s);return l&&l!=="/"?null:n.slice(s)||"/"}function M6(n,t){t===void 0&&(t="/");let{pathname:s,search:l="",hash:h=""}=typeof n=="string"?Cg(n):n;return{pathname:s?s.startsWith("/")?s:k6(s,t):t,search:N6(l),hash:D6(h)}}function k6(n,t){let s=t.replace(/\/+$/,"").split("/");return n.split("/").forEach(h=>{h===".."?s.length>1&&s.pop():h!=="."&&s.push(h)}),s.length>1?s.join("/"):"/"}function nw(n,t,s,l){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function P6(n){return n.filter((t,s)=>s===0||t.route.path&&t.route.path.length>0)}function vT(n,t){let s=P6(n);return t?s.map((l,h)=>h===s.length-1?l.pathname:l.pathnameBase):s.map(l=>l.pathnameBase)}function bT(n,t,s,l){l===void 0&&(l=!1);let h;typeof n=="string"?h=Cg(n):(h=ix({},n),wo(!h.pathname||!h.pathname.includes("?"),nw("?","pathname","search",h)),wo(!h.pathname||!h.pathname.includes("#"),nw("#","pathname","hash",h)),wo(!h.search||!h.search.includes("#"),nw("#","search","hash",h)));let m=n===""||h.pathname==="",b=m?"/":h.pathname,i;if(b==null)i=s;else{let j=t.length-1;if(!l&&b.startsWith("..")){let U=b.split("/");for(;U[0]==="..";)U.shift(),j-=1;h.pathname=U.join("/")}i=j>=0?t[j]:"/"}let A=M6(h,i),P=b&&b!=="/"&&b.endsWith("/"),D=(m||b===".")&&s.endsWith("/");return!A.pathname.endsWith("/")&&(P||D)&&(A.pathname+="/"),A}const qp=n=>n.join("/").replace(/\/\/+/g,"/"),R6=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),N6=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,D6=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function O6(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const yR=["post","put","patch","delete"];new Set(yR);const L6=["get",...yR];new Set(L6);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function sx(){return sx=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])}return n},sx.apply(this,arguments)}const wT=ee.createContext(null),z6=ee.createContext(null),om=ee.createContext(null),l1=ee.createContext(null),kf=ee.createContext({outlet:null,matches:[],isDataRoute:!1}),_R=ee.createContext(null);function j6(n,t){let{relative:s}=t===void 0?{}:t;Uy()||wo(!1);let{basename:l,navigator:h}=ee.useContext(om),{hash:m,pathname:b,search:i}=vR(n,{relative:s}),A=b;return l!=="/"&&(A=b==="/"?l:qp([l,b])),h.createHref({pathname:A,search:i,hash:m})}function Uy(){return ee.useContext(l1)!=null}function am(){return Uy()||wo(!1),ee.useContext(l1).location}function xR(n){ee.useContext(om).static||ee.useLayoutEffect(n)}function c1(){let{isDataRoute:n}=ee.useContext(kf);return n?J6():F6()}function F6(){Uy()||wo(!1);let n=ee.useContext(wT),{basename:t,future:s,navigator:l}=ee.useContext(om),{matches:h}=ee.useContext(kf),{pathname:m}=am(),b=JSON.stringify(vT(h,s.v7_relativeSplatPath)),i=ee.useRef(!1);return xR(()=>{i.current=!0}),ee.useCallback(function(P,D){if(D===void 0&&(D={}),!i.current)return;if(typeof P=="number"){l.go(P);return}let j=bT(P,JSON.parse(b),m,D.relative==="path");n==null&&t!=="/"&&(j.pathname=j.pathname==="/"?t:qp([t,j.pathname])),(D.replace?l.replace:l.push)(j,D.state,D)},[t,l,b,m,n])}function B6(){let{matches:n}=ee.useContext(kf),t=n[n.length-1];return t?t.params:{}}function vR(n,t){let{relative:s}=t===void 0?{}:t,{future:l}=ee.useContext(om),{matches:h}=ee.useContext(kf),{pathname:m}=am(),b=JSON.stringify(vT(h,l.v7_relativeSplatPath));return ee.useMemo(()=>bT(n,JSON.parse(b),m,s==="path"),[n,b,m,s])}function V6(n,t){return U6(n,t)}function U6(n,t,s,l){Uy()||wo(!1);let{navigator:h}=ee.useContext(om),{matches:m}=ee.useContext(kf),b=m[m.length-1],i=b?b.params:{};b&&b.pathname;let A=b?b.pathnameBase:"/";b&&b.route;let P=am(),D;if(t){var j;let re=typeof t=="string"?Cg(t):t;A==="/"||(j=re.pathname)!=null&&j.startsWith(A)||wo(!1),D=re}else D=P;let U=D.pathname||"/",X=U;if(A!=="/"){let re=A.replace(/^\//,"").split("/");X="/"+U.replace(/^\//,"").split("/").slice(re.length).join("/")}let Y=p6(n,{pathname:X}),W=W6(Y&&Y.map(re=>Object.assign({},re,{params:Object.assign({},i,re.params),pathname:qp([A,h.encodeLocation?h.encodeLocation(re.pathname).pathname:re.pathname]),pathnameBase:re.pathnameBase==="/"?A:qp([A,h.encodeLocation?h.encodeLocation(re.pathnameBase).pathname:re.pathnameBase])})),m,s,l);return t&&W?ee.createElement(l1.Provider,{value:{location:sx({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:Up.Pop}},W):W}function $6(){let n=Y6(),t=O6(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),s=n instanceof Error?n.stack:null,h={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ee.createElement(ee.Fragment,null,ee.createElement("h2",null,"Unexpected Application Error!"),ee.createElement("h3",{style:{fontStyle:"italic"}},t),s?ee.createElement("pre",{style:h},s):null,null)}const H6=ee.createElement($6,null);class G6 extends ee.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,s){return s.location!==t.location||s.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:s.error,location:s.location,revalidation:t.revalidation||s.revalidation}}componentDidCatch(t,s){console.error("React Router caught the following error during render",t,s)}render(){return this.state.error!==void 0?ee.createElement(kf.Provider,{value:this.props.routeContext},ee.createElement(_R.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function q6(n){let{routeContext:t,match:s,children:l}=n,h=ee.useContext(wT);return h&&h.static&&h.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=s.route.id),ee.createElement(kf.Provider,{value:t},l)}function W6(n,t,s,l){var h;if(t===void 0&&(t=[]),s===void 0&&(s=null),l===void 0&&(l=null),n==null){var m;if(!s)return null;if(s.errors)n=s.matches;else if((m=l)!=null&&m.v7_partialHydration&&t.length===0&&!s.initialized&&s.matches.length>0)n=s.matches;else return null}let b=n,i=(h=s)==null?void 0:h.errors;if(i!=null){let D=b.findIndex(j=>j.route.id&&i?.[j.route.id]!==void 0);D>=0||wo(!1),b=b.slice(0,Math.min(b.length,D+1))}let A=!1,P=-1;if(s&&l&&l.v7_partialHydration)for(let D=0;D<b.length;D++){let j=b[D];if((j.route.HydrateFallback||j.route.hydrateFallbackElement)&&(P=D),j.route.id){let{loaderData:U,errors:X}=s,Y=j.route.loader&&U[j.route.id]===void 0&&(!X||X[j.route.id]===void 0);if(j.route.lazy||Y){A=!0,P>=0?b=b.slice(0,P+1):b=[b[0]];break}}}return b.reduceRight((D,j,U)=>{let X,Y=!1,W=null,re=null;s&&(X=i&&j.route.id?i[j.route.id]:void 0,W=j.route.errorElement||H6,A&&(P<0&&U===0?(Q6("route-fallback"),Y=!0,re=null):P===U&&(Y=!0,re=j.route.hydrateFallbackElement||null)));let de=t.concat(b.slice(0,U+1)),Me=()=>{let Fe;return X?Fe=W:Y?Fe=re:j.route.Component?Fe=ee.createElement(j.route.Component,null):j.route.element?Fe=j.route.element:Fe=D,ee.createElement(q6,{match:j,routeContext:{outlet:D,matches:de,isDataRoute:s!=null},children:Fe})};return s&&(j.route.ErrorBoundary||j.route.errorElement||U===0)?ee.createElement(G6,{location:s.location,revalidation:s.revalidation,component:W,error:X,children:Me(),routeContext:{outlet:null,matches:de,isDataRoute:!0}}):Me()},null)}var bR=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(bR||{}),wR=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(wR||{});function Z6(n){let t=ee.useContext(wT);return t||wo(!1),t}function X6(n){let t=ee.useContext(z6);return t||wo(!1),t}function K6(n){let t=ee.useContext(kf);return t||wo(!1),t}function SR(n){let t=K6(),s=t.matches[t.matches.length-1];return s.route.id||wo(!1),s.route.id}function Y6(){var n;let t=ee.useContext(_R),s=X6(),l=SR();return t!==void 0?t:(n=s.errors)==null?void 0:n[l]}function J6(){let{router:n}=Z6(bR.UseNavigateStable),t=SR(wR.UseNavigateStable),s=ee.useRef(!1);return xR(()=>{s.current=!0}),ee.useCallback(function(h,m){m===void 0&&(m={}),s.current&&(typeof h=="number"?n.navigate(h):n.navigate(h,sx({fromRouteId:t},m)))},[n,t])}const VI={};function Q6(n,t,s){VI[n]||(VI[n]=!0)}function eU(n,t){n?.v7_startTransition,n?.v7_relativeSplatPath}function tU(n){let{to:t,replace:s,state:l,relative:h}=n;Uy()||wo(!1);let{future:m,static:b}=ee.useContext(om),{matches:i}=ee.useContext(kf),{pathname:A}=am(),P=c1(),D=bT(t,vT(i,m.v7_relativeSplatPath),A,h==="path"),j=JSON.stringify(D);return ee.useEffect(()=>P(JSON.parse(j),{replace:s,state:l,relative:h}),[P,j,h,s,l]),null}function ga(n){wo(!1)}function nU(n){let{basename:t="/",children:s=null,location:l,navigationType:h=Up.Pop,navigator:m,static:b=!1,future:i}=n;Uy()&&wo(!1);let A=t.replace(/^\/*/,"/"),P=ee.useMemo(()=>({basename:A,navigator:m,static:b,future:sx({v7_relativeSplatPath:!1},i)}),[A,i,m,b]);typeof l=="string"&&(l=Cg(l));let{pathname:D="/",search:j="",hash:U="",state:X=null,key:Y="default"}=l,W=ee.useMemo(()=>{let re=xT(D,A);return re==null?null:{location:{pathname:re,search:j,hash:U,state:X,key:Y},navigationType:h}},[A,D,j,U,X,Y,h]);return W==null?null:ee.createElement(om.Provider,{value:P},ee.createElement(l1.Provider,{children:s,value:W}))}function rU(n){let{children:t,location:s}=n;return V6(hS(t),s)}new Promise(()=>{});function hS(n,t){t===void 0&&(t=[]);let s=[];return ee.Children.forEach(n,(l,h)=>{if(!ee.isValidElement(l))return;let m=[...t,h];if(l.type===ee.Fragment){s.push.apply(s,hS(l.props.children,m));return}l.type!==ga&&wo(!1),!l.props.index||!l.props.children||wo(!1);let b={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(b.children=hS(l.props.children,m)),s.push(b)}),s}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function dS(){return dS=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&(n[l]=s[l])}return n},dS.apply(this,arguments)}function iU(n,t){if(n==null)return{};var s={},l=Object.keys(n),h,m;for(m=0;m<l.length;m++)h=l[m],!(t.indexOf(h)>=0)&&(s[h]=n[h]);return s}function sU(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function oU(n,t){return n.button===0&&(!t||t==="_self")&&!sU(n)}const aU=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],lU="6";try{window.__reactRouterVersion=lU}catch{}const cU="startTransition",UI=jk[cU];function uU(n){let{basename:t,children:s,future:l,window:h}=n,m=ee.useRef();m.current==null&&(m.current=h6({window:h,v5Compat:!0}));let b=m.current,[i,A]=ee.useState({action:b.action,location:b.location}),{v7_startTransition:P}=l||{},D=ee.useCallback(j=>{P&&UI?UI(()=>A(j)):A(j)},[A,P]);return ee.useLayoutEffect(()=>b.listen(D),[b,D]),ee.useEffect(()=>eU(l),[l]),ee.createElement(nU,{basename:t,children:s,location:i.location,navigationType:i.action,navigator:b,future:l})}const hU=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",dU=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Pi=ee.forwardRef(function(t,s){let{onClick:l,relative:h,reloadDocument:m,replace:b,state:i,target:A,to:P,preventScrollReset:D,viewTransition:j}=t,U=iU(t,aU),{basename:X}=ee.useContext(om),Y,W=!1;if(typeof P=="string"&&dU.test(P)&&(Y=P,hU))try{let Fe=new URL(window.location.href),ht=P.startsWith("//")?new URL(Fe.protocol+P):new URL(P),at=xT(ht.pathname,X);ht.origin===Fe.origin&&at!=null?P=at+ht.search+ht.hash:W=!0}catch{}let re=j6(P,{relative:h}),de=fU(P,{replace:b,state:i,target:A,preventScrollReset:D,relative:h,viewTransition:j});function Me(Fe){l&&l(Fe),Fe.defaultPrevented||de(Fe)}return ee.createElement("a",dS({},U,{href:Y||re,onClick:W||m?l:Me,ref:s,target:A}))});var $I;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})($I||($I={}));var HI;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(HI||(HI={}));function fU(n,t){let{target:s,replace:l,state:h,preventScrollReset:m,relative:b,viewTransition:i}=t===void 0?{}:t,A=c1(),P=am(),D=vR(n,{relative:b});return ee.useCallback(j=>{if(oU(j,s)){j.preventDefault();let U=l!==void 0?l:o0(P)===o0(D);A(n,{replace:U,state:h,preventScrollReset:m,relative:b,viewTransition:i})}},[P,A,D,l,h,s,n,m,b,i])}const TR=ee.createContext(void 0),pU=({children:n})=>{const[t,s]=ee.useState(!1),[l,h]=ee.useState(null),[m,b]=ee.useState([]),[i,A]=ee.useState(!0);ee.useEffect(()=>{const Y=localStorage.getItem("admin_session"),W=localStorage.getItem("admin_info");Y==="logged_in"&&W&&(s(!0),h(JSON.parse(W))),P(),A(!1)},[]);const P=async()=>{try{const W=await(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins")).json();b(W)}catch(Y){console.error("Error fetching admins:",Y)}},D=async(Y,W)=>{try{const re=await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:Y,password:W})});if(!re.ok)return!1;const de=await re.json();return localStorage.setItem("admin_session","logged_in"),localStorage.setItem("admin_info",JSON.stringify(de.admin)),s(!0),h(de.admin),!0}catch{return!1}},j=()=>{s(!1),h(null),localStorage.removeItem("admin_session"),localStorage.removeItem("admin_info")},U=async(Y,W,re)=>{try{return(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/admins",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:Y,email:W,password:re})})).ok?(await P(),!0):!1}catch{return!1}},X=async Y=>{if(Y===l?.id)return!1;try{return(await fetch(`https://betawaves-back.4bzwio.easypanel.host/api/admins/${Y}`,{method:"DELETE"})).ok?(await P(),!0):!1}catch{return!1}};return v.jsx(TR.Provider,{value:{isAdminLoggedIn:t,currentAdmin:l,admins:m,login:D,logout:j,loading:i,createAdmin:U,deleteAdmin:X},children:n})},wx=()=>{const n=ee.useContext(TR);if(!n)throw new Error("useAdmin must be used within AdminProvider");return n},mU=vx("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),on=ee.forwardRef(({className:n,variant:t,size:s,asChild:l=!1,...h},m)=>{const b=l?Jp:"button";return v.jsx(b,{className:Ai(mU({variant:t,size:s,className:n})),ref:m,...h})});on.displayName="Button";const gU=()=>{const[n,t]=ee.useState(!1),s=am(),{isAdminLoggedIn:l}=wx(),h=[{name:"Home",path:"/"},{name:"Consulting",path:"/consultings"},{name:"Products",path:"/products"},{name:"Resources",path:"/resources"},{name:"Investment",path:"/fund"},{name:"Portfolio",path:"/case-studies"},{name:"Blog",path:"/blog"}],m=b=>s.pathname===b||b!=="/"&&s.pathname.startsWith(b);return v.jsx("nav",{className:"bg-white shadow-sm sticky top-0 z-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"flex justify-between items-center h-16",children:[v.jsx(Pi,{to:"/",className:"flex items-center space-x-2",children:v.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-Black.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),v.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[h.map(b=>v.jsx(Pi,{to:b.path,className:`text-sm font-medium transition-colors duration-200 ${m(b.path)?"text-primary border-b-2 border-primary pb-1":"text-gray-600 hover:text-primary"}`,children:b.name},b.name)),v.jsx(on,{asChild:!0,className:"ml-2",children:v.jsx(Pi,{to:"/contact",children:"Contact"})})]}),v.jsx("button",{className:"md:hidden flex items-center justify-center w-8 h-8",onClick:()=>t(!n),"aria-label":"Toggle menu",children:v.jsxs("div",{className:"space-y-1",children:[v.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${n?"rotate-45 translate-y-1.5":""}`}),v.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-opacity ${n?"opacity-0":""}`}),v.jsx("div",{className:`w-5 h-0.5 bg-gray-600 transition-transform ${n?"-rotate-45 -translate-y-1.5":""}`})]})})]}),n&&v.jsx("div",{className:"md:hidden border-t border-gray-200 py-4",children:v.jsxs("div",{className:"flex flex-col space-y-4",children:[h.map(b=>v.jsx(Pi,{to:b.path,className:`text-sm font-medium px-2 py-1 rounded transition-colors ${m(b.path)?"text-primary bg-primary/10":"text-gray-600 hover:text-primary hover:bg-gray-50"}`,onClick:()=>t(!1),children:b.name},b.name)),v.jsx(on,{asChild:!0,className:"mt-4 w-fit",children:v.jsx(Pi,{to:"/contact",onClick:()=>t(!1),children:"Contact"})})]})})]})})},yU=()=>{const[n,t]=ee.useState(""),[s,l]=ee.useState(!1),[h,m]=ee.useState(!1),b=async i=>{if(i.preventDefault(),!!n){l(!0);try{(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:n,subject:"Newsletter",message:"",status:"unread"})})).ok&&(m(!0),t(""),setTimeout(()=>m(!1),3e3))}catch(A){console.error("Newsletter subscription error:",A)}finally{l(!1)}}};return v.jsx("footer",{className:"bg-gray-900 text-white",children:v.jsxs("div",{className:"container-width section-padding py-12",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[v.jsxs("div",{className:"col-span-1 md:col-span-2",children:[v.jsx(Pi,{to:"/",className:"flex items-center space-x-2",children:v.jsx("img",{src:"/lovable-uploads/H-Betawaves-Logo-White.png",alt:"Betawaves Logo",className:"w-30 h-10 object-contain"})}),v.jsx("br",{}),v.jsx("p",{className:"text-gray-400 mb-4 max-w-md",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and marketsconnect."}),v.jsx("div",{className:"flex space-x-4",children:v.jsx("a",{href:"https://www.linkedin.com/company/betawavesstudio/",className:"text-gray-400 hover:text-white transition-colors",children:"LinkedIn"})})]}),v.jsxs("div",{children:[v.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),v.jsxs("ul",{className:"space-y-2 text-gray-400",children:[v.jsx("li",{children:v.jsx(Pi,{to:"/consultings",className:"hover:text-white transition-colors",children:"Innovation Consultings"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/case-studies",className:"hover:text-white transition-colors",children:"Portfolio"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/blog",className:"hover:text-white transition-colors",children:"Blog"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/fund",className:"hover:text-white transition-colors",children:"Investment"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/contact",className:"hover:text-white transition-colors",children:"Contact"})})]})]}),v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-2xl font-semibold mb-4",children:"Stay Updated"}),v.jsx("p",{className:"text-1xl mb-8 opacity-50 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),v.jsxs("form",{onSubmit:b,className:"flex flex-col gap-4 max-w-md mx-auto",children:[v.jsx("input",{type:"email",placeholder:"Enter your email",className:"px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:n,onChange:i=>t(i.target.value),required:!0}),v.jsx("button",{type:"submit",disabled:s,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:s?"Subscribing...":"Subscribe"})]}),h&&v.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]}),v.jsxs("div",{className:"border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center",children:[v.jsx("p",{className:"text-gray-400 text-sm",children:" 2025 Betawaves. All rights reserved."}),v.jsxs("div",{className:"flex space-x-6 mt-4 md:mt-0",children:[v.jsx("li",{children:v.jsx(Pi,{to:"/privacy-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Privacy Policy"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/terms-of-service",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Terms of Service"})}),v.jsx("li",{children:v.jsx(Pi,{to:"/cookie-policy",className:"text-gray-400 hover:text-white text-sm transition-colors",children:"Cookie Policy"})})]})]})]})})},Rr=ee.forwardRef(({className:n,...t},s)=>v.jsx("div",{ref:s,className:Ai("rounded-lg border bg-card text-card-foreground shadow-sm",n),...t}));Rr.displayName="Card";const Yr=ee.forwardRef(({className:n,...t},s)=>v.jsx("div",{ref:s,className:Ai("flex flex-col space-y-1.5 p-6",n),...t}));Yr.displayName="CardHeader";const Jr=ee.forwardRef(({className:n,...t},s)=>v.jsx("h3",{ref:s,className:Ai("text-2xl font-semibold leading-none tracking-tight",n),...t}));Jr.displayName="CardTitle";const _s=ee.forwardRef(({className:n,...t},s)=>v.jsx("p",{ref:s,className:Ai("text-sm text-muted-foreground",n),...t}));_s.displayName="CardDescription";const Qr=ee.forwardRef(({className:n,...t},s)=>v.jsx("div",{ref:s,className:Ai("p-6 pt-0",n),...t}));Qr.displayName="CardContent";const _U=ee.forwardRef(({className:n,...t},s)=>v.jsx("div",{ref:s,className:Ai("flex items-center p-6 pt-0",n),...t}));_U.displayName="CardFooter";const xU=[{id:"1",title:"Startup Incubation",description:"Transform your innovative idea into a viable business with our comprehensive incubation program.",features:["Mentorship from industry experts","Access to funding networks","Product development support","Business model validation","Legal and compliance guidance"],icon:"home",duration:"6-12 months",eligibility:"Early-stage startups with innovative ideas"},{id:"2",title:"Acceleration Program",description:"Scale your startup rapidly with our intensive acceleration program designed for growth-ready companies.",features:["Growth strategy development","Market expansion support","Investor connections","Partnership facilitation","Performance tracking"],icon:"arrow-up",duration:"3-6 months",eligibility:"Startups with proven traction and revenue"},{id:"3",title:"Bootcamp Programs",description:"Intensive skill-building bootcamps covering essential startup competencies and technologies.",features:["Technical skill development","Business fundamentals","Pitch training","Team building workshops","Industry-specific training"],icon:"book",duration:"2-8 weeks",eligibility:"Entrepreneurs and startup team members"},{id:"4",title:"CXO Academy",description:"Executive leadership development program for startup founders and C-level executives.",features:["Leadership coaching","Strategic planning","Board management","Investor relations","Crisis management"],icon:"users",duration:"3-4 months",eligibility:"Startup founders and senior executives"}],vU=[{id:"1",companyName:"TechFlow AI",industry:"Artificial Intelligence",description:"An AI-powered workflow automation platform for small businesses.",challenge:"TechFlow AI needed to validate their product-market fit and secure Series A funding.",solution:"Through our acceleration program, we helped them refine their go-to-market strategy and connect with key investors.",results:["Secured $2.5M Series A funding","Grew from 50 to 500+ enterprise customers","Expanded to 3 new markets","Built strategic partnerships with major tech companies"],image:"https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=600&h=400&fit=crop",testimonial:{quote:"Betawaves didn't just provide funding - they gave us the strategic guidance and network access that transformed our startup into a market leader.",author:"Sarah Chen",position:"CEO & Founder"},tags:["AI","B2B","Series A","Acceleration"]},{id:"2",companyName:"GreenEnergy Solutions",industry:"Clean Technology",description:"Sustainable energy solutions for residential and commercial properties.",challenge:"Needed technical expertise and regulatory guidance to bring their solar technology to market.",solution:"Our incubation program provided technical mentorship and helped navigate complex energy regulations.",results:["Successfully launched in 5 states","Achieved 40% cost reduction in manufacturing","Installed 1000+ solar systems","Won 3 industry innovation awards"],image:"https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=600&h=400&fit=crop",testimonial:{quote:"The technical mentorship and industry connections from Betawaves were crucial in helping us overcome regulatory hurdles and scale our operations.",author:"Michael Rodriguez",position:"CTO & Co-founder"},tags:["CleanTech","B2C","Incubation","Sustainability"]},{id:"3",companyName:"HealthTrack Pro",industry:"Healthcare Technology",description:"Digital health platform connecting patients with healthcare providers.",challenge:"Required HIPAA compliance expertise and healthcare industry partnerships.",solution:"Our CXO Academy helped the founders develop healthcare industry expertise and regulatory compliance.",results:["Achieved HIPAA compliance certification","Partnered with 50+ healthcare providers","Served 10,000+ patients","Reduced patient wait times by 60%"],image:"https://images.unsplash.com/photo-1649972904349-6e44c42644a7?w=600&h=400&fit=crop",testimonial:{quote:"The CXO Academy gave us the leadership skills and industry knowledge needed to navigate the complex healthcare landscape successfully.",author:"Dr. Emily Watson",position:"CEO & Founder"},tags:["HealthTech","B2B2C","CXO Academy","Compliance"]}],Np=[{id:"1",title:"The Future of Startup Funding: Trends to Watch in 2024",excerpt:"Explore the emerging trends in startup funding, from AI-driven due diligence to sustainable investing.",content:"The startup funding landscape is evolving rapidly...",author:"Alex Johnson",publishDate:"2024-01-15",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",category:"Funding",tags:["Funding","Trends","Investment","Startups"]},{id:"2",title:"Building a Winning Pitch Deck: A Comprehensive Guide",excerpt:"Learn how to create compelling pitch decks that capture investor attention and secure funding.",content:"A great pitch deck tells a story...",author:"Maria Santos",publishDate:"2024-01-10",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",category:"Resources",tags:["Pitch Deck","Investment","Presentation","Fundraising"]},{id:"3",title:"The Rise of AI in Startup Operations",excerpt:"How artificial intelligence is transforming startup operations and creating new opportunities.",content:"Artificial intelligence is no longer just a buzzword...",author:"David Kim",publishDate:"2024-01-05",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",category:"Technology",tags:["AI","Operations","Automation","Innovation"]}],bU=[{id:"1",title:"Startup Pitch Night",description:"Join us for an evening of innovative pitches from emerging startups seeking funding and partnerships.",date:"2024-02-15",time:"18:00",location:"Betawaves Innovation Hub, San Francisco",type:"pitch",image:"https://images.unsplash.com/photo-1605810230434-7631ac76ec81?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"2",title:"AI for Startups Workshop",description:"Learn how to integrate AI technologies into your startup to drive growth and efficiency.",date:"2024-02-20",time:"14:00",location:"Virtual Event",type:"workshop",image:"https://images.unsplash.com/photo-1488590528505-98d2b5aba04b?w=600&h=400&fit=crop",registrationUrl:"#"},{id:"3",title:"Founder Networking Mixer",description:"Connect with fellow entrepreneurs, investors, and industry experts in a relaxed networking environment.",date:"2024-02-25",time:"17:30",location:"TechHub Downtown, Austin",type:"networking",image:"https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=600&h=400&fit=crop",registrationUrl:"#"}],wU=[{id:"1",name:"Sarah Johnson",email:"sarah.johnson@techstartup.com",subject:"Inquiry about Incubation Program",message:"Hi, I'm interested in learning more about your incubation program. My startup is in the fintech space and we're looking for mentorship and funding opportunities.",timestamp:"2024-01-15T10:30:00Z",status:"unread"},{id:"2",name:"Michael Chen",email:"mike@innovativeai.com",subject:"Partnership Opportunity",message:"Hello, I represent an AI startup that has developed a revolutionary machine learning platform. We'd like to explore potential partnership opportunities with Betawaves.",timestamp:"2024-01-14T14:20:00Z",status:"read"},{id:"3",name:"Emily Rodriguez",email:"emily.r@greentech.io",subject:"Application Status Follow-up",message:"I submitted an application for the Acceleration Program last week and wanted to follow up on the status. Could you please provide an update?",timestamp:"2024-01-13T09:15:00Z",status:"replied"},{id:"4",name:"David Park",email:"david@healthinnovate.com",subject:"Speaking Opportunity",message:"I'd like to propose speaking at one of your upcoming events. I'm the founder of a successful healthtech startup and would love to share our journey.",timestamp:"2024-01-12T16:45:00Z",status:"unread"}],rl={async getServices(){return await new Promise(n=>setTimeout(n,100)),xU},async getCaseStudies(){return await new Promise(n=>setTimeout(n,100)),vU},async getBlogPosts(){return await new Promise(n=>setTimeout(n,100)),Np},async getEvents(){return await new Promise(n=>setTimeout(n,100)),bU},async getContactMessages(){return await new Promise(n=>setTimeout(n,500)),wU},async addBlogPost(n){await new Promise(s=>setTimeout(s,100));const t={...n,id:Date.now().toString()};return Np.unshift(t),t},async updateBlogPost(n,t){await new Promise(l=>setTimeout(l,100));const s=Np.findIndex(l=>l.id===n);return s===-1?null:(Np[s]={...Np[s],...t},Np[s])},async deleteBlogPost(n){await new Promise(s=>setTimeout(s,100));const t=Np.findIndex(s=>s.id===n);return t===-1?!1:(Np.splice(t,1),!0)}},SU=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState(!1),h=ee.useRef(null);ee.useEffect(()=>{(async()=>{try{const A=(await rl.getTeamMembers()).map(P=>({...P,linkedIn:P.linkedin_url}));t(A)}catch(i){console.error("Error fetching team members:",i)}})()},[]),ee.useEffect(()=>{const b=setInterval(()=>{if(h.current){const i=h.current,A=i.scrollWidth-i.clientWidth;i.scrollLeft>=A?i.scrollTo({left:0,behavior:"smooth"}):i.scrollBy({left:300,behavior:"smooth"})}},5e3);return()=>clearInterval(b)},[]);const m=s?n:n.slice(0,4);return v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsxs("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:["Meet Our ",v.jsx("span",{className:"gradient-text",children:"Team"})]}),v.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our experienced team of entrepreneurs, investors, and industry experts are dedicated to your startup's success"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:m.map(b=>v.jsx(Rr,{className:"text-center flex flex-col justify-between hover:shadow-lg transition-shadow group",children:v.jsxs(Qr,{className:"p-6 flex flex-col flex-grow justify-between",children:[v.jsx("div",{className:"relative mb-6",children:v.jsx("img",{src:b.image,alt:b.name,className:"w-24 h-24 rounded-full mx-auto object-cover group-hover:scale-105 transition-transform"})}),v.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:b.name}),v.jsx("p",{className:"text-primary font-medium mb-3",children:b.position}),v.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:b.bio}),b.linkedin_url&&v.jsx("div",{className:"mt-4",children:v.jsx("a",{href:b.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Connect on LinkedIn "})})]})},b.id))}),n.length>4&&v.jsx("div",{className:"text-center mt-8",children:v.jsx("button",{onClick:()=>l(b=>!b),className:"text-primary hover:text-primary/80 font-medium text-sm",children:s?"See Less ":"See More "})})]})})},TU=({companies:n})=>v.jsxs("div",{className:"bg-[#1872f2] py-4 overflow-hidden",children:[v.jsx("div",{className:"relative w-full",children:v.jsx("div",{className:"marquee-content flex animate-marquee",children:[...n,...n].map((t,s)=>v.jsx("span",{className:"text-lg font-medium text-white mx-8 whitespace-nowrap",children:t},`${t}-${s}`))})}),v.jsx("style",{children:`
          @keyframes marquee {
            0% {
              transform: translateX(0%);
            }
            100% {
              transform: translateX(-50%);
            }
          }

          .marquee-content {
            width: max-content;
          }

          .animate-marquee {
            animation: marquee 15s linear infinite;
            display: flex;
          }
        `})]}),EU=({collaborators:n})=>v.jsx("div",{className:"bg-gray-50 py-6",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-6",children:"Our Partners"}),v.jsx("div",{className:"flex flex-wrap justify-center items-center gap-4",children:n.map(t=>v.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"w-32",children:v.jsx("div",{className:"bg-white rounded-lg shadow p-3 h-24 flex items-center justify-center hover:shadow-md transition-shadow",children:v.jsx("img",{src:t.logo,alt:t.name,className:"max-h-full max-w-full object-contain"})})},t.id))})]})})});var rw="focusScope.autoFocusOnMount",iw="focusScope.autoFocusOnUnmount",GI={bubbles:!1,cancelable:!0},CU="FocusScope",u1=ee.forwardRef((n,t)=>{const{loop:s=!1,trapped:l=!1,onMountAutoFocus:h,onUnmountAutoFocus:m,...b}=n,[i,A]=ee.useState(null),P=Jl(h),D=Jl(m),j=ee.useRef(null),U=us(t,W=>A(W)),X=ee.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;ee.useEffect(()=>{if(l){let W=function(Fe){if(X.paused||!i)return;const ht=Fe.target;i.contains(ht)?j.current=ht:Op(j.current,{select:!0})},re=function(Fe){if(X.paused||!i)return;const ht=Fe.relatedTarget;ht!==null&&(i.contains(ht)||Op(j.current,{select:!0}))},de=function(Fe){if(document.activeElement===document.body)for(const at of Fe)at.removedNodes.length>0&&Op(i)};document.addEventListener("focusin",W),document.addEventListener("focusout",re);const Me=new MutationObserver(de);return i&&Me.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",W),document.removeEventListener("focusout",re),Me.disconnect()}}},[l,i,X.paused]),ee.useEffect(()=>{if(i){WI.add(X);const W=document.activeElement;if(!i.contains(W)){const de=new CustomEvent(rw,GI);i.addEventListener(rw,P),i.dispatchEvent(de),de.defaultPrevented||(AU(RU(ER(i)),{select:!0}),document.activeElement===W&&Op(i))}return()=>{i.removeEventListener(rw,P),setTimeout(()=>{const de=new CustomEvent(iw,GI);i.addEventListener(iw,D),i.dispatchEvent(de),de.defaultPrevented||Op(W??document.body,{select:!0}),i.removeEventListener(iw,D),WI.remove(X)},0)}}},[i,P,D,X]);const Y=ee.useCallback(W=>{if(!s&&!l||X.paused)return;const re=W.key==="Tab"&&!W.altKey&&!W.ctrlKey&&!W.metaKey,de=document.activeElement;if(re&&de){const Me=W.currentTarget,[Fe,ht]=IU(Me);Fe&&ht?!W.shiftKey&&de===ht?(W.preventDefault(),s&&Op(Fe,{select:!0})):W.shiftKey&&de===Fe&&(W.preventDefault(),s&&Op(ht,{select:!0})):de===Me&&W.preventDefault()}},[s,l,X.paused]);return v.jsx(ci.div,{tabIndex:-1,...b,ref:U,onKeyDown:Y})});u1.displayName=CU;function AU(n,{select:t=!1}={}){const s=document.activeElement;for(const l of n)if(Op(l,{select:t}),document.activeElement!==s)return}function IU(n){const t=ER(n),s=qI(t,n),l=qI(t.reverse(),n);return[s,l]}function ER(n){const t=[],s=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>{const h=l.tagName==="INPUT"&&l.type==="hidden";return l.disabled||l.hidden||h?NodeFilter.FILTER_SKIP:l.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t}function qI(n,t){for(const s of n)if(!MU(s,{upTo:t}))return s}function MU(n,{upTo:t}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(t!==void 0&&n===t)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function kU(n){return n instanceof HTMLInputElement&&"select"in n}function Op(n,{select:t=!1}={}){if(n&&n.focus){const s=document.activeElement;n.focus({preventScroll:!0}),n!==s&&kU(n)&&t&&n.select()}}var WI=PU();function PU(){let n=[];return{add(t){const s=n[0];t!==s&&s?.pause(),n=ZI(n,t),n.unshift(t)},remove(t){n=ZI(n,t),n[0]?.resume()}}}function ZI(n,t){const s=[...n],l=s.indexOf(t);return l!==-1&&s.splice(l,1),s}function RU(n){return n.filter(t=>t.tagName!=="A")}var sw=0;function ST(){ee.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??XI()),document.body.insertAdjacentElement("beforeend",n[1]??XI()),sw++,()=>{sw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),sw--}},[])}function XI(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var fd=function(){return fd=Object.assign||function(t){for(var s,l=1,h=arguments.length;l<h;l++){s=arguments[l];for(var m in s)Object.prototype.hasOwnProperty.call(s,m)&&(t[m]=s[m])}return t},fd.apply(this,arguments)};function CR(n,t){var s={};for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&t.indexOf(l)<0&&(s[l]=n[l]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,l=Object.getOwnPropertySymbols(n);h<l.length;h++)t.indexOf(l[h])<0&&Object.prototype.propertyIsEnumerable.call(n,l[h])&&(s[l[h]]=n[l[h]]);return s}function NU(n,t,s){if(s||arguments.length===2)for(var l=0,h=t.length,m;l<h;l++)(m||!(l in t))&&(m||(m=Array.prototype.slice.call(t,0,l)),m[l]=t[l]);return n.concat(m||Array.prototype.slice.call(t))}var Hv="right-scroll-bar-position",Gv="width-before-scroll-bar",DU="with-scroll-bars-hidden",OU="--removed-body-scroll-bar-size";function ow(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function LU(n,t){var s=ee.useState(function(){return{value:n,callback:t,facade:{get current(){return s.value},set current(l){var h=s.value;h!==l&&(s.value=l,s.callback(l,h))}}}})[0];return s.callback=t,s.facade}var zU=typeof window<"u"?ee.useLayoutEffect:ee.useEffect,KI=new WeakMap;function jU(n,t){var s=LU(null,function(l){return n.forEach(function(h){return ow(h,l)})});return zU(function(){var l=KI.get(s);if(l){var h=new Set(l),m=new Set(n),b=s.current;h.forEach(function(i){m.has(i)||ow(i,null)}),m.forEach(function(i){h.has(i)||ow(i,b)})}KI.set(s,n)},[n]),s}function FU(n){return n}function BU(n,t){t===void 0&&(t=FU);var s=[],l=!1,h={read:function(){if(l)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:n},useMedium:function(m){var b=t(m,l);return s.push(b),function(){s=s.filter(function(i){return i!==b})}},assignSyncMedium:function(m){for(l=!0;s.length;){var b=s;s=[],b.forEach(m)}s={push:function(i){return m(i)},filter:function(){return s}}},assignMedium:function(m){l=!0;var b=[];if(s.length){var i=s;s=[],i.forEach(m),b=s}var A=function(){var D=b;b=[],D.forEach(m)},P=function(){return Promise.resolve().then(A)};P(),s={push:function(D){b.push(D),P()},filter:function(D){return b=b.filter(D),s}}}};return h}function VU(n){n===void 0&&(n={});var t=BU(null);return t.options=fd({async:!0,ssr:!1},n),t}var AR=function(n){var t=n.sideCar,s=CR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var l=t.read();if(!l)throw new Error("Sidecar medium not found");return ee.createElement(l,fd({},s))};AR.isSideCarExport=!0;function UU(n,t){return n.useMedium(t),AR}var IR=VU(),aw=function(){},h1=ee.forwardRef(function(n,t){var s=ee.useRef(null),l=ee.useState({onScrollCapture:aw,onWheelCapture:aw,onTouchMoveCapture:aw}),h=l[0],m=l[1],b=n.forwardProps,i=n.children,A=n.className,P=n.removeScrollBar,D=n.enabled,j=n.shards,U=n.sideCar,X=n.noIsolation,Y=n.inert,W=n.allowPinchZoom,re=n.as,de=re===void 0?"div":re,Me=n.gapMode,Fe=CR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ht=U,at=jU([s,t]),Dt=fd(fd({},Fe),h);return ee.createElement(ee.Fragment,null,D&&ee.createElement(ht,{sideCar:IR,removeScrollBar:P,shards:j,noIsolation:X,inert:Y,setCallbacks:m,allowPinchZoom:!!W,lockRef:s,gapMode:Me}),b?ee.cloneElement(ee.Children.only(i),fd(fd({},Dt),{ref:at})):ee.createElement(de,fd({},Dt,{className:A,ref:at}),i))});h1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};h1.classNames={fullWidth:Gv,zeroRight:Hv};var $U=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function HU(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=$U();return t&&n.setAttribute("nonce",t),n}function GU(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function qU(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var WU=function(){var n=0,t=null;return{add:function(s){n==0&&(t=HU())&&(GU(t,s),qU(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},ZU=function(){var n=WU();return function(t,s){ee.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&s])}},MR=function(){var n=ZU(),t=function(s){var l=s.styles,h=s.dynamic;return n(l,h),null};return t},XU={left:0,top:0,right:0,gap:0},lw=function(n){return parseInt(n||"",10)||0},KU=function(n){var t=window.getComputedStyle(document.body),s=t[n==="padding"?"paddingLeft":"marginLeft"],l=t[n==="padding"?"paddingTop":"marginTop"],h=t[n==="padding"?"paddingRight":"marginRight"];return[lw(s),lw(l),lw(h)]},YU=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return XU;var t=KU(n),s=document.documentElement.clientWidth,l=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,l-s+t[2]-t[0])}},JU=MR(),vy="data-scroll-locked",QU=function(n,t,s,l){var h=n.left,m=n.top,b=n.right,i=n.gap;return s===void 0&&(s="margin"),`
  .`.concat(DU,` {
   overflow: hidden `).concat(l,`;
   padding-right: `).concat(i,"px ").concat(l,`;
  }
  body[`).concat(vy,`] {
    overflow: hidden `).concat(l,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(l,";"),s==="margin"&&`
    padding-left: `.concat(h,`px;
    padding-top: `).concat(m,`px;
    padding-right: `).concat(b,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(l,`;
    `),s==="padding"&&"padding-right: ".concat(i,"px ").concat(l,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Hv,` {
    right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(Gv,` {
    margin-right: `).concat(i,"px ").concat(l,`;
  }
  
  .`).concat(Hv," .").concat(Hv,` {
    right: 0 `).concat(l,`;
  }
  
  .`).concat(Gv," .").concat(Gv,` {
    margin-right: 0 `).concat(l,`;
  }
  
  body[`).concat(vy,`] {
    `).concat(OU,": ").concat(i,`px;
  }
`)},YI=function(){var n=parseInt(document.body.getAttribute(vy)||"0",10);return isFinite(n)?n:0},e8=function(){ee.useEffect(function(){return document.body.setAttribute(vy,(YI()+1).toString()),function(){var n=YI()-1;n<=0?document.body.removeAttribute(vy):document.body.setAttribute(vy,n.toString())}},[])},t8=function(n){var t=n.noRelative,s=n.noImportant,l=n.gapMode,h=l===void 0?"margin":l;e8();var m=ee.useMemo(function(){return YU(h)},[h]);return ee.createElement(JU,{styles:QU(m,!t,h,s?"":"!important")})},fS=!1;if(typeof window<"u")try{var Ev=Object.defineProperty({},"passive",{get:function(){return fS=!0,!0}});window.addEventListener("test",Ev,Ev),window.removeEventListener("test",Ev,Ev)}catch{fS=!1}var ay=fS?{passive:!1}:!1,n8=function(n){return n.tagName==="TEXTAREA"},kR=function(n,t){if(!(n instanceof Element))return!1;var s=window.getComputedStyle(n);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!n8(n)&&s[t]==="visible")},r8=function(n){return kR(n,"overflowY")},i8=function(n){return kR(n,"overflowX")},JI=function(n,t){var s=t.ownerDocument,l=t;do{typeof ShadowRoot<"u"&&l instanceof ShadowRoot&&(l=l.host);var h=PR(n,l);if(h){var m=RR(n,l),b=m[1],i=m[2];if(b>i)return!0}l=l.parentNode}while(l&&l!==s.body);return!1},s8=function(n){var t=n.scrollTop,s=n.scrollHeight,l=n.clientHeight;return[t,s,l]},o8=function(n){var t=n.scrollLeft,s=n.scrollWidth,l=n.clientWidth;return[t,s,l]},PR=function(n,t){return n==="v"?r8(t):i8(t)},RR=function(n,t){return n==="v"?s8(t):o8(t)},a8=function(n,t){return n==="h"&&t==="rtl"?-1:1},l8=function(n,t,s,l,h){var m=a8(n,window.getComputedStyle(t).direction),b=m*l,i=s.target,A=t.contains(i),P=!1,D=b>0,j=0,U=0;do{var X=RR(n,i),Y=X[0],W=X[1],re=X[2],de=W-re-m*Y;(Y||de)&&PR(n,i)&&(j+=de,U+=Y),i instanceof ShadowRoot?i=i.host:i=i.parentNode}while(!A&&i!==document.body||A&&(t.contains(i)||t===i));return(D&&Math.abs(j)<1||!D&&Math.abs(U)<1)&&(P=!0),P},Cv=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},QI=function(n){return[n.deltaX,n.deltaY]},eM=function(n){return n&&"current"in n?n.current:n},c8=function(n,t){return n[0]===t[0]&&n[1]===t[1]},u8=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},h8=0,ly=[];function d8(n){var t=ee.useRef([]),s=ee.useRef([0,0]),l=ee.useRef(),h=ee.useState(h8++)[0],m=ee.useState(MR)[0],b=ee.useRef(n);ee.useEffect(function(){b.current=n},[n]),ee.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(h));var W=NU([n.lockRef.current],(n.shards||[]).map(eM),!0).filter(Boolean);return W.forEach(function(re){return re.classList.add("allow-interactivity-".concat(h))}),function(){document.body.classList.remove("block-interactivity-".concat(h)),W.forEach(function(re){return re.classList.remove("allow-interactivity-".concat(h))})}}},[n.inert,n.lockRef.current,n.shards]);var i=ee.useCallback(function(W,re){if("touches"in W&&W.touches.length===2||W.type==="wheel"&&W.ctrlKey)return!b.current.allowPinchZoom;var de=Cv(W),Me=s.current,Fe="deltaX"in W?W.deltaX:Me[0]-de[0],ht="deltaY"in W?W.deltaY:Me[1]-de[1],at,Dt=W.target,kt=Math.abs(Fe)>Math.abs(ht)?"h":"v";if("touches"in W&&kt==="h"&&Dt.type==="range")return!1;var Rt=JI(kt,Dt);if(!Rt)return!0;if(Rt?at=kt:(at=kt==="v"?"h":"v",Rt=JI(kt,Dt)),!Rt)return!1;if(!l.current&&"changedTouches"in W&&(Fe||ht)&&(l.current=at),!at)return!0;var fn=l.current||at;return l8(fn,re,W,fn==="h"?Fe:ht)},[]),A=ee.useCallback(function(W){var re=W;if(!(!ly.length||ly[ly.length-1]!==m)){var de="deltaY"in re?QI(re):Cv(re),Me=t.current.filter(function(at){return at.name===re.type&&(at.target===re.target||re.target===at.shadowParent)&&c8(at.delta,de)})[0];if(Me&&Me.should){re.cancelable&&re.preventDefault();return}if(!Me){var Fe=(b.current.shards||[]).map(eM).filter(Boolean).filter(function(at){return at.contains(re.target)}),ht=Fe.length>0?i(re,Fe[0]):!b.current.noIsolation;ht&&re.cancelable&&re.preventDefault()}}},[]),P=ee.useCallback(function(W,re,de,Me){var Fe={name:W,delta:re,target:de,should:Me,shadowParent:f8(de)};t.current.push(Fe),setTimeout(function(){t.current=t.current.filter(function(ht){return ht!==Fe})},1)},[]),D=ee.useCallback(function(W){s.current=Cv(W),l.current=void 0},[]),j=ee.useCallback(function(W){P(W.type,QI(W),W.target,i(W,n.lockRef.current))},[]),U=ee.useCallback(function(W){P(W.type,Cv(W),W.target,i(W,n.lockRef.current))},[]);ee.useEffect(function(){return ly.push(m),n.setCallbacks({onScrollCapture:j,onWheelCapture:j,onTouchMoveCapture:U}),document.addEventListener("wheel",A,ay),document.addEventListener("touchmove",A,ay),document.addEventListener("touchstart",D,ay),function(){ly=ly.filter(function(W){return W!==m}),document.removeEventListener("wheel",A,ay),document.removeEventListener("touchmove",A,ay),document.removeEventListener("touchstart",D,ay)}},[]);var X=n.removeScrollBar,Y=n.inert;return ee.createElement(ee.Fragment,null,Y?ee.createElement(m,{styles:u8(h)}):null,X?ee.createElement(t8,{gapMode:n.gapMode}):null)}function f8(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const p8=UU(IR,d8);var d1=ee.forwardRef(function(n,t){return ee.createElement(h1,fd({},n,{ref:t,sideCar:p8}))});d1.classNames=h1.classNames;var m8=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},cy=new WeakMap,Av=new WeakMap,Iv={},cw=0,NR=function(n){return n&&(n.host||NR(n.parentNode))},g8=function(n,t){return t.map(function(s){if(n.contains(s))return s;var l=NR(s);return l&&n.contains(l)?l:(console.error("aria-hidden",s,"in not contained inside",n,". Doing nothing"),null)}).filter(function(s){return!!s})},y8=function(n,t,s,l){var h=g8(t,Array.isArray(n)?n:[n]);Iv[s]||(Iv[s]=new WeakMap);var m=Iv[s],b=[],i=new Set,A=new Set(h),P=function(j){!j||i.has(j)||(i.add(j),P(j.parentNode))};h.forEach(P);var D=function(j){!j||A.has(j)||Array.prototype.forEach.call(j.children,function(U){if(i.has(U))D(U);else try{var X=U.getAttribute(l),Y=X!==null&&X!=="false",W=(cy.get(U)||0)+1,re=(m.get(U)||0)+1;cy.set(U,W),m.set(U,re),b.push(U),W===1&&Y&&Av.set(U,!0),re===1&&U.setAttribute(s,"true"),Y||U.setAttribute(l,"true")}catch(de){console.error("aria-hidden: cannot operate on ",U,de)}})};return D(t),i.clear(),cw++,function(){b.forEach(function(j){var U=cy.get(j)-1,X=m.get(j)-1;cy.set(j,U),m.set(j,X),U||(Av.has(j)||j.removeAttribute(l),Av.delete(j)),X||j.removeAttribute(s)}),cw--,cw||(cy=new WeakMap,cy=new WeakMap,Av=new WeakMap,Iv={})}},TT=function(n,t,s){s===void 0&&(s="data-aria-hidden");var l=Array.from(Array.isArray(n)?n:[n]),h=m8(n);return h?(l.push.apply(l,Array.from(h.querySelectorAll("[aria-live]"))),y8(l,h,s,"aria-hidden")):function(){return null}},ET="Dialog",[DR,JX]=Eg(ET),[_8,mh]=DR(ET),OR=n=>{const{__scopeDialog:t,children:s,open:l,defaultOpen:h,onOpenChange:m,modal:b=!0}=n,i=ee.useRef(null),A=ee.useRef(null),[P=!1,D]=Qp({prop:l,defaultProp:h,onChange:m});return v.jsx(_8,{scope:t,triggerRef:i,contentRef:A,contentId:wf(),titleId:wf(),descriptionId:wf(),open:P,onOpenChange:D,onOpenToggle:ee.useCallback(()=>D(j=>!j),[D]),modal:b,children:s})};OR.displayName=ET;var LR="DialogTrigger",zR=ee.forwardRef((n,t)=>{const{__scopeDialog:s,...l}=n,h=mh(LR,s),m=us(t,h.triggerRef);return v.jsx(ci.button,{type:"button","aria-haspopup":"dialog","aria-expanded":h.open,"aria-controls":h.contentId,"data-state":IT(h.open),...l,ref:m,onClick:wr(n.onClick,h.onOpenToggle)})});zR.displayName=LR;var CT="DialogPortal",[x8,jR]=DR(CT,{forceMount:void 0}),FR=n=>{const{__scopeDialog:t,forceMount:s,children:l,container:h}=n,m=mh(CT,t);return v.jsx(x8,{scope:t,forceMount:s,children:ee.Children.map(l,b=>v.jsx(Mf,{present:s||m.open,children:v.jsx(_x,{asChild:!0,container:h,children:b})}))})};FR.displayName=CT;var a0="DialogOverlay",BR=ee.forwardRef((n,t)=>{const s=jR(a0,n.__scopeDialog),{forceMount:l=s.forceMount,...h}=n,m=mh(a0,n.__scopeDialog);return m.modal?v.jsx(Mf,{present:l||m.open,children:v.jsx(v8,{...h,ref:t})}):null});BR.displayName=a0;var v8=ee.forwardRef((n,t)=>{const{__scopeDialog:s,...l}=n,h=mh(a0,s);return v.jsx(d1,{as:Jp,allowPinchZoom:!0,shards:[h.contentRef],children:v.jsx(ci.div,{"data-state":IT(h.open),...l,ref:t,style:{pointerEvents:"auto",...l.style}})})}),_g="DialogContent",VR=ee.forwardRef((n,t)=>{const s=jR(_g,n.__scopeDialog),{forceMount:l=s.forceMount,...h}=n,m=mh(_g,n.__scopeDialog);return v.jsx(Mf,{present:l||m.open,children:m.modal?v.jsx(b8,{...h,ref:t}):v.jsx(w8,{...h,ref:t})})});VR.displayName=_g;var b8=ee.forwardRef((n,t)=>{const s=mh(_g,n.__scopeDialog),l=ee.useRef(null),h=us(t,s.contentRef,l);return ee.useEffect(()=>{const m=l.current;if(m)return TT(m)},[]),v.jsx(UR,{...n,ref:h,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:wr(n.onCloseAutoFocus,m=>{m.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:wr(n.onPointerDownOutside,m=>{const b=m.detail.originalEvent,i=b.button===0&&b.ctrlKey===!0;(b.button===2||i)&&m.preventDefault()}),onFocusOutside:wr(n.onFocusOutside,m=>m.preventDefault())})}),w8=ee.forwardRef((n,t)=>{const s=mh(_g,n.__scopeDialog),l=ee.useRef(!1),h=ee.useRef(!1);return v.jsx(UR,{...n,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{n.onCloseAutoFocus?.(m),m.defaultPrevented||(l.current||s.triggerRef.current?.focus(),m.preventDefault()),l.current=!1,h.current=!1},onInteractOutside:m=>{n.onInteractOutside?.(m),m.defaultPrevented||(l.current=!0,m.detail.originalEvent.type==="pointerdown"&&(h.current=!0));const b=m.target;s.triggerRef.current?.contains(b)&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&h.current&&m.preventDefault()}})}),UR=ee.forwardRef((n,t)=>{const{__scopeDialog:s,trapFocus:l,onOpenAutoFocus:h,onCloseAutoFocus:m,...b}=n,i=mh(_g,s),A=ee.useRef(null),P=us(t,A);return ST(),v.jsxs(v.Fragment,{children:[v.jsx(u1,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:h,onUnmountAutoFocus:m,children:v.jsx(Ly,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":IT(i.open),...b,ref:P,onDismiss:()=>i.onOpenChange(!1)})}),v.jsxs(v.Fragment,{children:[v.jsx(S8,{titleId:i.titleId}),v.jsx(E8,{contentRef:A,descriptionId:i.descriptionId})]})]})}),AT="DialogTitle",$R=ee.forwardRef((n,t)=>{const{__scopeDialog:s,...l}=n,h=mh(AT,s);return v.jsx(ci.h2,{id:h.titleId,...l,ref:t})});$R.displayName=AT;var HR="DialogDescription",GR=ee.forwardRef((n,t)=>{const{__scopeDialog:s,...l}=n,h=mh(HR,s);return v.jsx(ci.p,{id:h.descriptionId,...l,ref:t})});GR.displayName=HR;var qR="DialogClose",WR=ee.forwardRef((n,t)=>{const{__scopeDialog:s,...l}=n,h=mh(qR,s);return v.jsx(ci.button,{type:"button",...l,ref:t,onClick:wr(n.onClick,()=>h.onOpenChange(!1))})});WR.displayName=qR;function IT(n){return n?"open":"closed"}var ZR="DialogTitleWarning",[QX,XR]=kF(ZR,{contentName:_g,titleName:AT,docsSlug:"dialog"}),S8=({titleId:n})=>{const t=XR(ZR),s=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return ee.useEffect(()=>{n&&(document.getElementById(n)||console.error(s))},[s,n]),null},T8="DialogDescriptionWarning",E8=({contentRef:n,descriptionId:t})=>{const l=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${XR(T8).contentName}}.`;return ee.useEffect(()=>{const h=n.current?.getAttribute("aria-describedby");t&&h&&(document.getElementById(t)||console.warn(l))},[l,n,t]),null},C8=OR,A8=zR,I8=FR,KR=BR,YR=VR,JR=$R,QR=GR,M8=WR;const ol=C8,MT=A8,k8=I8,eN=ee.forwardRef(({className:n,...t},s)=>v.jsx(KR,{ref:s,className:Ai("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...t}));eN.displayName=KR.displayName;const Fa=ee.forwardRef(({className:n,children:t,...s},l)=>v.jsxs(k8,{children:[v.jsx(eN,{}),v.jsxs(YR,{ref:l,className:Ai("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...s,children:[t,v.jsxs(M8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[v.jsx(t1,{className:"h-4 w-4"}),v.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Fa.displayName=YR.displayName;const Ba=({className:n,...t})=>v.jsx("div",{className:Ai("flex flex-col space-y-1.5 text-center sm:text-left",n),...t});Ba.displayName="DialogHeader";const Va=ee.forwardRef(({className:n,...t},s)=>v.jsx(JR,{ref:s,className:Ai("text-lg font-semibold leading-none tracking-tight",n),...t}));Va.displayName=JR.displayName;const kT=ee.forwardRef(({className:n,...t},s)=>v.jsx(QR,{ref:s,className:Ai("text-sm text-muted-foreground",n),...t}));kT.displayName=QR.displayName;const P8=()=>{const[n,t]=ee.useState(null),[s,l]=ee.useState(!1),[h,m]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const P=await rl.getPopup();if(P&&P.isActive){t(P);const D=localStorage.getItem("welcomePopupLastShown"),j=new Date().toDateString();D!==j&&l(!0)}}catch(P){console.error("Error fetching popup:",P)}finally{m(!1)}})()},[]);const b=()=>{l(!1),localStorage.setItem("welcomePopupLastShown",new Date().toDateString())},i=()=>{n?.link&&window.open(n.link,"_blank"),b()};return h||!n?null:v.jsx(ol,{open:s,onOpenChange:b,children:v.jsx(Fa,{className:"max-w-md p-0 overflow-hidden ",children:v.jsxs("div",{className:"relative",children:[v.jsx(on,{variant:"ghost",size:"icon",className:"absolute right-4 top-4 z-10 bg-white/80 hover:bg-white/90",onClick:b,children:v.jsx(t1,{className:"h-4 w-4"})}),v.jsx("div",{className:"aspect-video w-full overflow-hidden",children:v.jsx("img",{src:n.image,alt:n.title,className:"w-full h-full object-cover"})}),v.jsxs("div",{className:"p-8",children:[v.jsxs(Ba,{className:"space-y-4 text-center",children:[v.jsx(Va,{className:"text-3xl font-bold text-gray-900",children:n.title}),v.jsx(kT,{className:"text-xl font-semibold text-primary",children:n.subject}),v.jsx("p",{className:"text-gray-600 text-lg leading-relaxed max-w-xl mx-auto",children:n.description})]}),v.jsx("div",{className:"flex justify-center mt-8",children:v.jsx(on,{onClick:i,size:"lg",children:"Get Started"})})]})]})})})},R8=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState([]),[b,i]=ee.useState([]),[A,P]=ee.useState(!0),[D,j]=ee.useState(!1),[U,X]=ee.useState({heroType:"video",heroImage:"",heroVideoUrl:"https://www.youtube.com/embed/UtmSyNOdUYQ?si=EB0xgcBK1vQWyBi2",runningTextCompanies:["Sustainable-Investment","Startup-Support","Innovation-Consulting","Emerging-Tech","Ventuer-Studio","Ecosystem-Building","Worldwide-Connections","Emerging-Markets"],collaborators:[{id:"1",name:"Tunisian Startups",logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbWdZXtT-buPHs52zpna3LpGtG4VSj1gmRzQ&s",website:"https://startup.gov.tn/fr/home"},{id:"2",name:"InvestForJobs",logo:"https://eina4jobs.org/sites/default/files/styles/large/public/2022-04/313d09e5-6952-4a8a-9e8f-a289e2851be1_1.png?itok=KYfs2tOF",website:"https://invest-for-jobs.com/en/"},{id:"3",name:"GIZ",logo:"https://www.cocoainitiative.org/sites/default/files/logos/gizlogo-unternehmen-de-rgb-300-min.jpg",website:"https://www.giz.de/en/worldwide/22600.html"},{id:"4",name:"INNOVI",logo:"https://innovi.tn/wp-content/uploads/2019/11/Logo300x150-300x150.png",website:"https://innovi.tn/"},{id:"5",name:"USAID",logo:"https://tn.usembassy.gov/wp-content/uploads/sites/59/2017/05/USAID-Logo-1.jpg",website:"https://tn.usembassy.gov/fr/embassy-fr/ambassade-des-etats-unis-tunis/usaid-en-tunisie/"},{id:"6",name:"TBS",logo:"https://tunis-business-school.tn/media/logo_hu3d8e5f27ad81de36e24c8e7a513aea7c_89571_300x300_fit_lanczos_3.png",website:"https://tunis-business-school.tn/"},{id:"7",name:"Beta-i",logo:"https://beta-i.com/wp-content/uploads/2024/10/Logo-Positivo-Color_1-8.png",website:"https://beta-i.com/"},{id:"8",name:"TNW",logo:"https://images.app.goo.gl/q4wLsZC6j2R1ZDbE7",website:"https://thenextwomentunisie.com/"},{id:"9",name:"Finastra",logo:"https://upload.wikimedia.org/wikipedia/fr/2/2f/Finastra.png",website:"https://www.finastra.com/"},{id:"10",name:"216Capital",logo:"https://216capital.vc/assets/images/logo-216Capital-black.png",website:"https://216capital.vc/"},{id:"11",name:"GPP",logo:"https://www.global-project-partners.de/media/site/88b0f29413-1612944747/gpp-logo-1200x630-crop-1.png",website:"https://www.global-project-partners.de/"},{id:"12",name:"Gnt",logo:"https://landportal.org/sites/default/files/2023-05/lrQMWH3.png",website:"https://www.government.nl/"},{id:"13",name:"ExpertiseFrance",logo:"https://www.cdc.tn/sites/default/files/2024-07/ef-logo22%20%281%29.png",website:"https://www.expertisefrance.fr/fr/accueil"},{id:"14",name:"StartupAct",logo:"https://www.expert-comptable-tunisie.net/wp-content/uploads/2020/03/startup-act-Tunisie.png",website:"https://startup.gov.tn/fr/home"},{id:"15",name:"UNECA",logo:"https://msme-resurgence.unctad.org/sites/smesurge/files/2021-07/uneca%20main%20logo.png",website:"https://www.uneca.org/fr"},{id:"16",name:"STB",logo:"https://upload.wikimedia.org/wikipedia/commons/0/06/Logo_STB.png",website:"https://www.stb.com.tn/fr/"},{id:"17",name:"BH",logo:"https://upload.wikimedia.org/wikipedia/fr/4/44/BH-Bank.png",website:"https://www.bhbank.tn/"},{id:"18",name:"Attijari",logo:"https://www.attijaribank.com.tn/sites/default/files/inline-images/logoAttijari.png",website:"https://www.attijaribank.com.tn/fr"},{id:"19",name:"Segal",logo:"https://www.segalfamilyfoundation.org/wp-content/uploads/SFF-Mobile-Logo.svg",website:"https://www.segalfamilyfoundation.org/"},{id:"20",name:"Beta",logo:"https://aspban.eu/portnetworks/wp-content/uploads/2021/11/Beta-i.png",website:"https://beta-i.com/"},{id:"21",name:"Gitex",logo:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRH5MTbHcGnfFOqRrlHTA0e7fktBnhboTBroA&s",website:"https://www.gitexnigeria.ng/"}]});ee.useEffect(()=>{const W=localStorage.getItem("styleSettings");W&&X(JSON.parse(W)),(async()=>{try{const[de,Me,Fe,ht,at]=await Promise.all([rl.getServices(),rl.getCaseStudies(),rl.getProducts(),rl.getPopup(),rl.getConsulting()]);t(de.slice(0,3)),l(at.slice(0,3)),m(Me.slice(0,2)),i(Fe.slice(0,3)),ht?.isActive&&j(!0)}catch(de){console.error("Error fetching data:",de)}finally{P(!1)}})()},[]);const Y=W=>({home:lg,"arrow-up":Qv,book:e1,users:cg})[W]||lg;return A?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx(P8,{}),v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[v.jsxs("div",{children:[v.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-6 md:text-4xl",children:["Driving Innovation, Investment, and Ecosystem Growth",v.jsx("span",{className:"gradient-text block",children:"In Emerging Markets"})]}),v.jsx("p",{className:"text-xl  text-gray-600 mb-8 leading-relaxed",children:"We provide innovation services, early-stage investment, and ecosystem support across the region. From building startup programs and advising corporates and governments to co-creating ventures, we help ideas grow and marketsconnect."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[v.jsx(on,{size:"lg",asChild:!0,children:v.jsx(Pi,{to:"/contact",children:"Start Your Journey"})}),v.jsx(on,{variant:"outline",size:"lg",asChild:!0,children:v.jsx("a",{href:"https://www.hubspot.fr/",target:"_blank",rel:"noopener noreferrer",children:"Download Our Brochure"})})]}),v.jsxs("div",{className:"grid grid-cols-3 gap-6 mt-12 pt-8 border-t border-gray-200",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-3xl font-bold text-primary",children:"250+"}),v.jsx("div",{className:"text-sm text-gray-600",children:"Startups Supported"})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-3xl font-bold text-primary",children:"10+"}),v.jsx("div",{className:"text-sm text-gray-600",children:"Innovation Programs"})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-3xl font-bold text-primary",children:"12"}),v.jsx("div",{className:"text-sm text-gray-600",children:"Startups Built"})]})]})]}),v.jsxs("div",{className:"rounded-md shadow-xl overflow-hidden transform transition-all duration-500 group-hover:scale-[1.02] group-hover:shadow-2xl",children:[U.heroType==="video"?v.jsx("div",{className:"aspect-video w-full",children:v.jsx("iframe",{src:U.heroVideoUrl.replace("watch?v=","embed/"),title:"Hero Video",className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})}):v.jsx("img",{src:U.heroImage,alt:"Hero",className:"w-full h-72 object-cover"}),v.jsxs("div",{className:"p-6 bg-white",children:[v.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:"Innovation in Action"}),v.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Where ideas meet execution"})]})]})]})})}),v.jsx(TU,{companies:U.runningTextCompanies}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Mission"}),v.jsx("p",{className:"text-xl text-gray-600 max-w-4xl mx-auto",children:"At Betawaves, we empower nations and industries to thrive by activating three core forces:"})]}),v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:v.jsx(cg,{className:"h-8 w-8 text-primary"})}),v.jsx("h3",{className:"text-xl font-semibold mb-4",children:"People"}),v.jsx("p",{className:"text-gray-600",children:"We cultivate talent and strengthen human capital through tailored training, mentorship, and workforce developmentbuilding the next generation of tech leaders, innovators, and change-makers."})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:v.jsx(Qv,{className:"h-8 w-8 text-primary"})}),v.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Technology"}),v.jsx("p",{className:"text-gray-600",children:"We harness the power of emerging technologies to help startups and enterprises build scalable, efficient, and future-proof solutions across key sectors."})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6",children:v.jsx(lg,{className:"h-8 w-8 text-primary"})}),v.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Innovation"}),v.jsx("p",{className:"text-gray-600",children:"We design and drive innovation ecosystems, launch ventures, and enable strategic transformationworking with governments, corporates, and startups to turn bold ideas intorealimpact."})]})]})]})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Innovation Consulting"}),v.jsx("p",{className:"text-xl text-gray-600",children:"Comprehensive Consultings designed to address every aspect of startup development"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:s.map(W=>{const re=Y(W.icon);return v.jsxs(Rr,{className:"h-full hover:shadow-lg transition-shadow",children:[v.jsxs(Yr,{children:[v.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center mb-4",children:v.jsx(re,{className:"h-6 w-6 text-primary"})}),v.jsx(Jr,{className:"text-xl",children:W.title}),v.jsx(_s,{className:"text-base",children:W.description})]}),v.jsx(Qr,{children:v.jsx("ul",{className:"space-y-2 mb-6",children:W.features.slice(0,3).map((de,Me)=>v.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[v.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),de]},Me))})})]},W.id)})}),v.jsx("div",{className:"text-center mt-12",children:v.jsx(on,{asChild:!0,children:v.jsx(Pi,{to:"/consultings",children:"View All Consultings"})})})]})}),v.jsx("section",{className:"py-20 bg-gray-900 text-white",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Products"}),v.jsx("p",{className:"text-xl text-gray-300",children:"Innovative tools and platforms designed to empower your startup journey"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:b.map(W=>v.jsxs(Rr,{className:"h-full hover:shadow-lg transition-shadow bg-gray-800 border-gray-700 text-white",children:[v.jsxs(Yr,{children:[v.jsxs("div",{className:"w-12 h-12 bg-primary/20 rounded-lg flex items-center justify-center mb-4",children:[v.jsx(vB,{className:"h-6 w-6 text-primary"})," "]}),v.jsx(Jr,{className:"text-xl text-white",children:W.name}),v.jsx(_s,{className:"text-base text-gray-300",children:W.description})]}),v.jsx(Qr,{children:v.jsx("ul",{className:"space-y-2 text-sm text-gray-300",children:W.features.slice(0,3).map((re,de)=>v.jsxs("li",{className:"flex items-center",children:[v.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),re]},de))})})]},W.id))}),v.jsx("div",{className:"text-center mt-12",children:v.jsx(on,{asChild:!0,variant:"secondary",children:v.jsx(Pi,{to:"/products",children:"View All Products"})})})]})}),v.jsxs("section",{className:"py-20 bg-gradient-to-br from-blue-600 via-primary to-cyan-500 text-white relative overflow-hidden",children:[v.jsxs("div",{className:"absolute inset-0 opacity-20",children:[v.jsx("div",{className:"absolute top-0 left-0 w-96 h-96 bg-white/10 rounded-full -translate-x-48 -translate-y-48"}),v.jsx("div",{className:"absolute bottom-0 right-0 w-80 h-80 bg-white/5 rounded-full translate-x-40 translate-y-40"}),v.jsxs("svg",{className:"w-full h-full absolute inset-0",viewBox:"0 0 1200 600",preserveAspectRatio:"none",children:[v.jsx("defs",{children:v.jsx("pattern",{id:"wave-pattern",x:"0",y:"0",width:"100",height:"20",patternUnits:"userSpaceOnUse",children:v.jsx("path",{d:"M0,10 Q25,0 50,10 T100,10",stroke:"currentColor",strokeWidth:"0.5",fill:"none",opacity:"0.3"})})}),v.jsx("rect",{width:"100%",height:"100%",fill:"url(#wave-pattern)"})]})]}),v.jsx("div",{className:"container-width section-padding relative z-10",children:v.jsxs("div",{className:"max-w-5xl mx-auto",children:[v.jsxs(Rr,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-500 hover:scale-[1.02] hover:shadow-2xl",children:[v.jsxs(Yr,{className:"text-center pb-8",children:[v.jsx("div",{className:"mb-6",children:v.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-white/20 rounded-full text-sm font-medium mb-4",children:[v.jsx(Yw,{className:"h-4 w-4 mr-2"}),"Impact Investment Fund"]})}),v.jsxs(Jr,{className:"text-3xl md:text-4xl font-bold text-white mb-6 leading-tight",children:["Powering the Future of Sustainability and Climate Tech",v.jsx("span",{className:"block bg-gradient-to-r from-cyan-200 to-white bg-clip-text text-transparent",children:"Across MENA+"})]}),v.jsx(_s,{className:"text-2xl text-white/95 mb-6 font-medium"}),v.jsx("p",{className:"text-lg text-white/85 max-w-4xl mx-auto leading-relaxed",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges. We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]}),v.jsxs(Qr,{children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-10",children:[v.jsxs("div",{className:"text-center group",children:[v.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:v.jsx(mP,{className:"h-5 w-5 text-white"})}),v.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"$40M Fund Size"}),v.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Targeting sustainability and climate tech startups from ideation to series A"})]}),v.jsxs("div",{className:"text-center group",children:[v.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:v.jsx(IB,{className:"h-5 w-5 text-white"})}),v.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Regional Focus"}),v.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan"})]}),v.jsxs("div",{className:"text-center group",children:[v.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300",children:v.jsx(Yw,{className:"h-5 w-5 text-white"})}),v.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Beyond Capital"}),v.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:"Venture building, expert guidance, and globalnetworkaccess"})]})]}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[v.jsxs("div",{className:"text-center",children:[v.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Startups"}),v.jsx(on,{size:"lg",variant:"secondary",className:"bg-white text-primary hover:bg-white/90 font-semibold px-8 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all",asChild:!0,children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})]}),v.jsxs("div",{className:"text-center",children:[v.jsx("p",{className:"text-white/90 text-sm mb-3 font-medium",children:"For Investors"}),v.jsx(on,{size:"lg",variant:"outline",className:"border-2 border-white text-primary hover:bg-white hover:text-primary font-semibold px-8 py-3 rounded-xl transition-all",asChild:!0,children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})]})]})]})]}),v.jsx("div",{className:"text-center mt-12",children:v.jsx(on,{asChild:!0,variant:"secondary",size:"lg",className:"bg-white/20 backdrop-blur border-white/30 text-white hover:bg-white hover:text-primary font-semibold rounded-xl",children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/",target:"_blank",rel:"noopener noreferrer",children:"Learn More About Betaventures"})})})]})})]}),v.jsx("section",{className:"py-20 ",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Portfolio"}),v.jsx("p",{className:"text-xl text-gray-600",children:"See how we've helped startups achieve remarkable growth and success"})]}),v.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:h.map(W=>v.jsxs(Rr,{className:"overflow-hidden",children:[v.jsx("div",{className:"aspect-video",children:v.jsx("img",{src:W.image,alt:W.companyName,className:"w-full h-full object-cover"})}),v.jsxs(Yr,{children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsx(Jr,{className:"text-xl",children:W.companyName}),v.jsx("span",{className:"text-sm text-gray-500",children:W.industry})]}),v.jsx(_s,{children:W.description})]}),v.jsx(Qr,{children:W.testimonial?.quote?.trim()&&v.jsxs(v.Fragment,{children:[v.jsxs("blockquote",{className:"border-l-4 border-primary pl-4 italic text-gray-600 mb-4",children:['"',W.testimonial.quote,'"']}),v.jsxs("div",{className:"text-sm",children:[v.jsx("strong",{children:W.testimonial.author}),v.jsx("div",{className:"text-gray-500",children:W.testimonial.position})]})]})})]},W.id))}),v.jsx("div",{className:"text-center mt-12",children:v.jsx(on,{asChild:!0,children:v.jsx(Pi,{to:"/case-studies",children:"View All Portfolio"})})})]})}),v.jsx(SU,{}),v.jsx(EU,{collaborators:U.collaborators}),v.jsx("section",{className:"py-20 bg-primary text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Transform Your Startup?"}),v.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Join hundreds of successful startups who have accelerated their growth with Betawaves. Your journey to success starts here."}),v.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:v.jsx(on,{size:"lg",variant:"secondary",asChild:!0,children:v.jsx(Pi,{to:"/contact",children:"Download Brochure"})})})]})})]})},N8=vx("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function _a({className:n,variant:t,...s}){return v.jsx("div",{className:Ai(N8({variant:t}),n),...s})}const Jn=ee.forwardRef(({className:n,type:t,...s},l)=>v.jsx("input",{type:t,className:Ai("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:l,...s}));Jn.displayName="Input";var D8="Label",tN=ee.forwardRef((n,t)=>v.jsx(ci.label,{...n,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(n.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));tN.displayName=D8;var nN=tN;const O8=vx("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),rn=ee.forwardRef(({className:n,...t},s)=>v.jsx(nN,{ref:s,className:Ai(O8(),n),...t}));rn.displayName=nN.displayName;const fo=ee.forwardRef(({className:n,...t},s)=>v.jsx("textarea",{className:Ai("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:s,...t}));fo.displayName="Textarea";function tM(n,[t,s]){return Math.min(s,Math.max(t,n))}var L8=ee.createContext(void 0);function PT(n){const t=ee.useContext(L8);return n||t||"ltr"}function rN(n){const t=ee.useRef({value:n,previous:n});return ee.useMemo(()=>(t.current.value!==n&&(t.current.previous=t.current.value,t.current.value=n),t.current.previous),[n])}var z8=[" ","Enter","ArrowUp","ArrowDown"],j8=[" ","Enter"],Sx="Select",[f1,p1,F8]=YS(Sx),[$y,eK]=Eg(Sx,[F8,By]),m1=By(),[B8,lm]=$y(Sx),[V8,U8]=$y(Sx),iN=n=>{const{__scopeSelect:t,children:s,open:l,defaultOpen:h,onOpenChange:m,value:b,defaultValue:i,onValueChange:A,dir:P,name:D,autoComplete:j,disabled:U,required:X,form:Y}=n,W=m1(t),[re,de]=ee.useState(null),[Me,Fe]=ee.useState(null),[ht,at]=ee.useState(!1),Dt=PT(P),[kt=!1,Rt]=Qp({prop:l,defaultProp:h,onChange:m}),[fn,En]=Qp({prop:b,defaultProp:i,onChange:A}),xn=ee.useRef(null),Tn=re?Y||!!re.closest("form"):!0,[Bn,Ft]=ee.useState(new Set),wn=Array.from(Bn).map(Yt=>Yt.props.value).join(";");return v.jsx(WP,{...W,children:v.jsxs(B8,{required:X,scope:t,trigger:re,onTriggerChange:de,valueNode:Me,onValueNodeChange:Fe,valueNodeHasChildren:ht,onValueNodeHasChildrenChange:at,contentId:wf(),value:fn,onValueChange:En,open:kt,onOpenChange:Rt,dir:Dt,triggerPointerDownPosRef:xn,disabled:U,children:[v.jsx(f1.Provider,{scope:t,children:v.jsx(V8,{scope:n.__scopeSelect,onNativeOptionAdd:ee.useCallback(Yt=>{Ft(Cn=>new Set(Cn).add(Yt))},[]),onNativeOptionRemove:ee.useCallback(Yt=>{Ft(Cn=>{const gt=new Set(Cn);return gt.delete(Yt),gt})},[]),children:s})}),Tn?v.jsxs(MN,{"aria-hidden":!0,required:X,tabIndex:-1,name:D,autoComplete:j,value:fn,onChange:Yt=>En(Yt.target.value),disabled:U,form:Y,children:[fn===void 0?v.jsx("option",{value:""}):null,Array.from(Bn)]},wn):null]})})};iN.displayName=Sx;var sN="SelectTrigger",oN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,disabled:l=!1,...h}=n,m=m1(s),b=lm(sN,s),i=b.disabled||l,A=us(t,b.onTriggerChange),P=p1(s),D=ee.useRef("touch"),[j,U,X]=kN(W=>{const re=P().filter(Fe=>!Fe.disabled),de=re.find(Fe=>Fe.value===b.value),Me=PN(re,W,de);Me!==void 0&&b.onValueChange(Me.value)}),Y=W=>{i||(b.onOpenChange(!0),X()),W&&(b.triggerPointerDownPosRef.current={x:Math.round(W.pageX),y:Math.round(W.pageY)})};return v.jsx(s1,{asChild:!0,...m,children:v.jsx(ci.button,{type:"button",role:"combobox","aria-controls":b.contentId,"aria-expanded":b.open,"aria-required":b.required,"aria-autocomplete":"none",dir:b.dir,"data-state":b.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":IN(b.value)?"":void 0,...h,ref:A,onClick:wr(h.onClick,W=>{W.currentTarget.focus(),D.current!=="mouse"&&Y(W)}),onPointerDown:wr(h.onPointerDown,W=>{D.current=W.pointerType;const re=W.target;re.hasPointerCapture(W.pointerId)&&re.releasePointerCapture(W.pointerId),W.button===0&&W.ctrlKey===!1&&W.pointerType==="mouse"&&(Y(W),W.preventDefault())}),onKeyDown:wr(h.onKeyDown,W=>{const re=j.current!=="";!(W.ctrlKey||W.altKey||W.metaKey)&&W.key.length===1&&U(W.key),!(re&&W.key===" ")&&z8.includes(W.key)&&(Y(),W.preventDefault())})})})});oN.displayName=sN;var aN="SelectValue",lN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,className:l,style:h,children:m,placeholder:b="",...i}=n,A=lm(aN,s),{onValueNodeHasChildrenChange:P}=A,D=m!==void 0,j=us(t,A.onValueNodeChange);return sl(()=>{P(D)},[P,D]),v.jsx(ci.span,{...i,ref:j,style:{pointerEvents:"none"},children:IN(A.value)?v.jsx(v.Fragment,{children:b}):m})});lN.displayName=aN;var $8="SelectIcon",cN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,children:l,...h}=n;return v.jsx(ci.span,{"aria-hidden":!0,...h,ref:t,children:l||""})});cN.displayName=$8;var H8="SelectPortal",uN=n=>v.jsx(_x,{asChild:!0,...n});uN.displayName=H8;var xg="SelectContent",hN=ee.forwardRef((n,t)=>{const s=lm(xg,n.__scopeSelect),[l,h]=ee.useState();if(sl(()=>{h(new DocumentFragment)},[]),!s.open){const m=l;return m?Oy.createPortal(v.jsx(dN,{scope:n.__scopeSelect,children:v.jsx(f1.Slot,{scope:n.__scopeSelect,children:v.jsx("div",{children:n.children})})}),m):null}return v.jsx(fN,{...n,ref:t})});hN.displayName=xg;var lh=10,[dN,cm]=$y(xg),G8="SelectContentImpl",fN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,position:l="item-aligned",onCloseAutoFocus:h,onEscapeKeyDown:m,onPointerDownOutside:b,side:i,sideOffset:A,align:P,alignOffset:D,arrowPadding:j,collisionBoundary:U,collisionPadding:X,sticky:Y,hideWhenDetached:W,avoidCollisions:re,...de}=n,Me=lm(xg,s),[Fe,ht]=ee.useState(null),[at,Dt]=ee.useState(null),kt=us(t,un=>ht(un)),[Rt,fn]=ee.useState(null),[En,xn]=ee.useState(null),Tn=p1(s),[Bn,Ft]=ee.useState(!1),wn=ee.useRef(!1);ee.useEffect(()=>{if(Fe)return TT(Fe)},[Fe]),ST();const Yt=ee.useCallback(un=>{const[$n,...An]=Tn().map(ni=>ni.ref.current),[Fn]=An.slice(-1),Zr=document.activeElement;for(const ni of un)if(ni===Zr||(ni?.scrollIntoView({block:"nearest"}),ni===$n&&at&&(at.scrollTop=0),ni===Fn&&at&&(at.scrollTop=at.scrollHeight),ni?.focus(),document.activeElement!==Zr))return},[Tn,at]),Cn=ee.useCallback(()=>Yt([Rt,Fe]),[Yt,Rt,Fe]);ee.useEffect(()=>{Bn&&Cn()},[Bn,Cn]);const{onOpenChange:gt,triggerPointerDownPosRef:Jt}=Me;ee.useEffect(()=>{if(Fe){let un={x:0,y:0};const $n=Fn=>{un={x:Math.abs(Math.round(Fn.pageX)-(Jt.current?.x??0)),y:Math.abs(Math.round(Fn.pageY)-(Jt.current?.y??0))}},An=Fn=>{un.x<=10&&un.y<=10?Fn.preventDefault():Fe.contains(Fn.target)||gt(!1),document.removeEventListener("pointermove",$n),Jt.current=null};return Jt.current!==null&&(document.addEventListener("pointermove",$n),document.addEventListener("pointerup",An,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",$n),document.removeEventListener("pointerup",An,{capture:!0})}}},[Fe,gt,Jt]),ee.useEffect(()=>{const un=()=>gt(!1);return window.addEventListener("blur",un),window.addEventListener("resize",un),()=>{window.removeEventListener("blur",un),window.removeEventListener("resize",un)}},[gt]);const[Ht,qe]=kN(un=>{const $n=Tn().filter(Zr=>!Zr.disabled),An=$n.find(Zr=>Zr.ref.current===document.activeElement),Fn=PN($n,un,An);Fn&&setTimeout(()=>Fn.ref.current.focus())}),Ct=ee.useCallback((un,$n,An)=>{const Fn=!wn.current&&!An;(Me.value!==void 0&&Me.value===$n||Fn)&&(fn(un),Fn&&(wn.current=!0))},[Me.value]),Pn=ee.useCallback(()=>Fe?.focus(),[Fe]),Zn=ee.useCallback((un,$n,An)=>{const Fn=!wn.current&&!An;(Me.value!==void 0&&Me.value===$n||Fn)&&xn(un)},[Me.value]),Nn=l==="popper"?pS:pN,cn=Nn===pS?{side:i,sideOffset:A,align:P,alignOffset:D,arrowPadding:j,collisionBoundary:U,collisionPadding:X,sticky:Y,hideWhenDetached:W,avoidCollisions:re}:{};return v.jsx(dN,{scope:s,content:Fe,viewport:at,onViewportChange:Dt,itemRefCallback:Ct,selectedItem:Rt,onItemLeave:Pn,itemTextRefCallback:Zn,focusSelectedItem:Cn,selectedItemText:En,position:l,isPositioned:Bn,searchRef:Ht,children:v.jsx(d1,{as:Jp,allowPinchZoom:!0,children:v.jsx(u1,{asChild:!0,trapped:Me.open,onMountAutoFocus:un=>{un.preventDefault()},onUnmountAutoFocus:wr(h,un=>{Me.trigger?.focus({preventScroll:!0}),un.preventDefault()}),children:v.jsx(Ly,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:m,onPointerDownOutside:b,onFocusOutside:un=>un.preventDefault(),onDismiss:()=>Me.onOpenChange(!1),children:v.jsx(Nn,{role:"listbox",id:Me.contentId,"data-state":Me.open?"open":"closed",dir:Me.dir,onContextMenu:un=>un.preventDefault(),...de,...cn,onPlaced:()=>Ft(!0),ref:kt,style:{display:"flex",flexDirection:"column",outline:"none",...de.style},onKeyDown:wr(de.onKeyDown,un=>{const $n=un.ctrlKey||un.altKey||un.metaKey;if(un.key==="Tab"&&un.preventDefault(),!$n&&un.key.length===1&&qe(un.key),["ArrowUp","ArrowDown","Home","End"].includes(un.key)){let Fn=Tn().filter(Zr=>!Zr.disabled).map(Zr=>Zr.ref.current);if(["ArrowUp","End"].includes(un.key)&&(Fn=Fn.slice().reverse()),["ArrowUp","ArrowDown"].includes(un.key)){const Zr=un.target,ni=Fn.indexOf(Zr);Fn=Fn.slice(ni+1)}setTimeout(()=>Yt(Fn)),un.preventDefault()}})})})})})})});fN.displayName=G8;var q8="SelectItemAlignedPosition",pN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,onPlaced:l,...h}=n,m=lm(xg,s),b=cm(xg,s),[i,A]=ee.useState(null),[P,D]=ee.useState(null),j=us(t,kt=>D(kt)),U=p1(s),X=ee.useRef(!1),Y=ee.useRef(!0),{viewport:W,selectedItem:re,selectedItemText:de,focusSelectedItem:Me}=b,Fe=ee.useCallback(()=>{if(m.trigger&&m.valueNode&&i&&P&&W&&re&&de){const kt=m.trigger.getBoundingClientRect(),Rt=P.getBoundingClientRect(),fn=m.valueNode.getBoundingClientRect(),En=de.getBoundingClientRect();if(m.dir!=="rtl"){const Zr=En.left-Rt.left,ni=fn.left-Zr,Or=kt.left-ni,vs=kt.width+Or,$s=Math.max(vs,Rt.width),Hi=window.innerWidth-lh,mo=tM(ni,[lh,Math.max(lh,Hi-$s)]);i.style.minWidth=vs+"px",i.style.left=mo+"px"}else{const Zr=Rt.right-En.right,ni=window.innerWidth-fn.right-Zr,Or=window.innerWidth-kt.right-ni,vs=kt.width+Or,$s=Math.max(vs,Rt.width),Hi=window.innerWidth-lh,mo=tM(ni,[lh,Math.max(lh,Hi-$s)]);i.style.minWidth=vs+"px",i.style.right=mo+"px"}const xn=U(),Tn=window.innerHeight-lh*2,Bn=W.scrollHeight,Ft=window.getComputedStyle(P),wn=parseInt(Ft.borderTopWidth,10),Yt=parseInt(Ft.paddingTop,10),Cn=parseInt(Ft.borderBottomWidth,10),gt=parseInt(Ft.paddingBottom,10),Jt=wn+Yt+Bn+gt+Cn,Ht=Math.min(re.offsetHeight*5,Jt),qe=window.getComputedStyle(W),Ct=parseInt(qe.paddingTop,10),Pn=parseInt(qe.paddingBottom,10),Zn=kt.top+kt.height/2-lh,Nn=Tn-Zn,cn=re.offsetHeight/2,un=re.offsetTop+cn,$n=wn+Yt+un,An=Jt-$n;if($n<=Zn){const Zr=xn.length>0&&re===xn[xn.length-1].ref.current;i.style.bottom="0px";const ni=P.clientHeight-W.offsetTop-W.offsetHeight,Or=Math.max(Nn,cn+(Zr?Pn:0)+ni+Cn),vs=$n+Or;i.style.height=vs+"px"}else{const Zr=xn.length>0&&re===xn[0].ref.current;i.style.top="0px";const Or=Math.max(Zn,wn+W.offsetTop+(Zr?Ct:0)+cn)+An;i.style.height=Or+"px",W.scrollTop=$n-Zn+W.offsetTop}i.style.margin=`${lh}px 0`,i.style.minHeight=Ht+"px",i.style.maxHeight=Tn+"px",l?.(),requestAnimationFrame(()=>X.current=!0)}},[U,m.trigger,m.valueNode,i,P,W,re,de,m.dir,l]);sl(()=>Fe(),[Fe]);const[ht,at]=ee.useState();sl(()=>{P&&at(window.getComputedStyle(P).zIndex)},[P]);const Dt=ee.useCallback(kt=>{kt&&Y.current===!0&&(Fe(),Me?.(),Y.current=!1)},[Fe,Me]);return v.jsx(Z8,{scope:s,contentWrapper:i,shouldExpandOnScrollRef:X,onScrollButtonChange:Dt,children:v.jsx("div",{ref:A,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:ht},children:v.jsx(ci.div,{...h,ref:j,style:{boxSizing:"border-box",maxHeight:"100%",...h.style}})})})});pN.displayName=q8;var W8="SelectPopperPosition",pS=ee.forwardRef((n,t)=>{const{__scopeSelect:s,align:l="start",collisionPadding:h=lh,...m}=n,b=m1(s);return v.jsx(uT,{...b,...m,ref:t,align:l,collisionPadding:h,style:{boxSizing:"border-box",...m.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});pS.displayName=W8;var[Z8,RT]=$y(xg,{}),mS="SelectViewport",mN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,nonce:l,...h}=n,m=cm(mS,s),b=RT(mS,s),i=us(t,m.onViewportChange),A=ee.useRef(0);return v.jsxs(v.Fragment,{children:[v.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),v.jsx(f1.Slot,{scope:s,children:v.jsx(ci.div,{"data-radix-select-viewport":"",role:"presentation",...h,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...h.style},onScroll:wr(h.onScroll,P=>{const D=P.currentTarget,{contentWrapper:j,shouldExpandOnScrollRef:U}=b;if(U?.current&&j){const X=Math.abs(A.current-D.scrollTop);if(X>0){const Y=window.innerHeight-lh*2,W=parseFloat(j.style.minHeight),re=parseFloat(j.style.height),de=Math.max(W,re);if(de<Y){const Me=de+X,Fe=Math.min(Y,Me),ht=Me-Fe;j.style.height=Fe+"px",j.style.bottom==="0px"&&(D.scrollTop=ht>0?ht:0,j.style.justifyContent="flex-end")}}}A.current=D.scrollTop})})})]})});mN.displayName=mS;var gN="SelectGroup",[X8,K8]=$y(gN),Y8=ee.forwardRef((n,t)=>{const{__scopeSelect:s,...l}=n,h=wf();return v.jsx(X8,{scope:s,id:h,children:v.jsx(ci.div,{role:"group","aria-labelledby":h,...l,ref:t})})});Y8.displayName=gN;var yN="SelectLabel",_N=ee.forwardRef((n,t)=>{const{__scopeSelect:s,...l}=n,h=K8(yN,s);return v.jsx(ci.div,{id:h.id,...l,ref:t})});_N.displayName=yN;var l0="SelectItem",[J8,xN]=$y(l0),vN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,value:l,disabled:h=!1,textValue:m,...b}=n,i=lm(l0,s),A=cm(l0,s),P=i.value===l,[D,j]=ee.useState(m??""),[U,X]=ee.useState(!1),Y=us(t,Me=>A.itemRefCallback?.(Me,l,h)),W=wf(),re=ee.useRef("touch"),de=()=>{h||(i.onValueChange(l),i.onOpenChange(!1))};if(l==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return v.jsx(J8,{scope:s,value:l,disabled:h,textId:W,isSelected:P,onItemTextChange:ee.useCallback(Me=>{j(Fe=>Fe||(Me?.textContent??"").trim())},[]),children:v.jsx(f1.ItemSlot,{scope:s,value:l,disabled:h,textValue:D,children:v.jsx(ci.div,{role:"option","aria-labelledby":W,"data-highlighted":U?"":void 0,"aria-selected":P&&U,"data-state":P?"checked":"unchecked","aria-disabled":h||void 0,"data-disabled":h?"":void 0,tabIndex:h?void 0:-1,...b,ref:Y,onFocus:wr(b.onFocus,()=>X(!0)),onBlur:wr(b.onBlur,()=>X(!1)),onClick:wr(b.onClick,()=>{re.current!=="mouse"&&de()}),onPointerUp:wr(b.onPointerUp,()=>{re.current==="mouse"&&de()}),onPointerDown:wr(b.onPointerDown,Me=>{re.current=Me.pointerType}),onPointerMove:wr(b.onPointerMove,Me=>{re.current=Me.pointerType,h?A.onItemLeave?.():re.current==="mouse"&&Me.currentTarget.focus({preventScroll:!0})}),onPointerLeave:wr(b.onPointerLeave,Me=>{Me.currentTarget===document.activeElement&&A.onItemLeave?.()}),onKeyDown:wr(b.onKeyDown,Me=>{A.searchRef?.current!==""&&Me.key===" "||(j8.includes(Me.key)&&de(),Me.key===" "&&Me.preventDefault())})})})})});vN.displayName=l0;var F_="SelectItemText",bN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,className:l,style:h,...m}=n,b=lm(F_,s),i=cm(F_,s),A=xN(F_,s),P=U8(F_,s),[D,j]=ee.useState(null),U=us(t,de=>j(de),A.onItemTextChange,de=>i.itemTextRefCallback?.(de,A.value,A.disabled)),X=D?.textContent,Y=ee.useMemo(()=>v.jsx("option",{value:A.value,disabled:A.disabled,children:X},A.value),[A.disabled,A.value,X]),{onNativeOptionAdd:W,onNativeOptionRemove:re}=P;return sl(()=>(W(Y),()=>re(Y)),[W,re,Y]),v.jsxs(v.Fragment,{children:[v.jsx(ci.span,{id:A.textId,...m,ref:U}),A.isSelected&&b.valueNode&&!b.valueNodeHasChildren?Oy.createPortal(m.children,b.valueNode):null]})});bN.displayName=F_;var wN="SelectItemIndicator",SN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,...l}=n;return xN(wN,s).isSelected?v.jsx(ci.span,{"aria-hidden":!0,...l,ref:t}):null});SN.displayName=wN;var gS="SelectScrollUpButton",TN=ee.forwardRef((n,t)=>{const s=cm(gS,n.__scopeSelect),l=RT(gS,n.__scopeSelect),[h,m]=ee.useState(!1),b=us(t,l.onScrollButtonChange);return sl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const P=A.scrollTop>0;m(P)};const A=s.viewport;return i(),A.addEventListener("scroll",i),()=>A.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),h?v.jsx(CN,{...n,ref:b,onAutoScroll:()=>{const{viewport:i,selectedItem:A}=s;i&&A&&(i.scrollTop=i.scrollTop-A.offsetHeight)}}):null});TN.displayName=gS;var yS="SelectScrollDownButton",EN=ee.forwardRef((n,t)=>{const s=cm(yS,n.__scopeSelect),l=RT(yS,n.__scopeSelect),[h,m]=ee.useState(!1),b=us(t,l.onScrollButtonChange);return sl(()=>{if(s.viewport&&s.isPositioned){let i=function(){const P=A.scrollHeight-A.clientHeight,D=Math.ceil(A.scrollTop)<P;m(D)};const A=s.viewport;return i(),A.addEventListener("scroll",i),()=>A.removeEventListener("scroll",i)}},[s.viewport,s.isPositioned]),h?v.jsx(CN,{...n,ref:b,onAutoScroll:()=>{const{viewport:i,selectedItem:A}=s;i&&A&&(i.scrollTop=i.scrollTop+A.offsetHeight)}}):null});EN.displayName=yS;var CN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,onAutoScroll:l,...h}=n,m=cm("SelectScrollButton",s),b=ee.useRef(null),i=p1(s),A=ee.useCallback(()=>{b.current!==null&&(window.clearInterval(b.current),b.current=null)},[]);return ee.useEffect(()=>()=>A(),[A]),sl(()=>{i().find(D=>D.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[i]),v.jsx(ci.div,{"aria-hidden":!0,...h,ref:t,style:{flexShrink:0,...h.style},onPointerDown:wr(h.onPointerDown,()=>{b.current===null&&(b.current=window.setInterval(l,50))}),onPointerMove:wr(h.onPointerMove,()=>{m.onItemLeave?.(),b.current===null&&(b.current=window.setInterval(l,50))}),onPointerLeave:wr(h.onPointerLeave,()=>{A()})})}),Q8="SelectSeparator",AN=ee.forwardRef((n,t)=>{const{__scopeSelect:s,...l}=n;return v.jsx(ci.div,{"aria-hidden":!0,...l,ref:t})});AN.displayName=Q8;var _S="SelectArrow",e$=ee.forwardRef((n,t)=>{const{__scopeSelect:s,...l}=n,h=m1(s),m=lm(_S,s),b=cm(_S,s);return m.open&&b.position==="popper"?v.jsx(hT,{...h,...l,ref:t}):null});e$.displayName=_S;function IN(n){return n===""||n===void 0}var MN=ee.forwardRef((n,t)=>{const{value:s,...l}=n,h=ee.useRef(null),m=us(t,h),b=rN(s);return ee.useEffect(()=>{const i=h.current,A=window.HTMLSelectElement.prototype,D=Object.getOwnPropertyDescriptor(A,"value").set;if(b!==s&&D){const j=new Event("change",{bubbles:!0});D.call(i,s),i.dispatchEvent(j)}},[b,s]),v.jsx(xx,{asChild:!0,children:v.jsx("select",{...l,ref:m,defaultValue:s})})});MN.displayName="BubbleSelect";function kN(n){const t=Jl(n),s=ee.useRef(""),l=ee.useRef(0),h=ee.useCallback(b=>{const i=s.current+b;t(i),function A(P){s.current=P,window.clearTimeout(l.current),P!==""&&(l.current=window.setTimeout(()=>A(""),1e3))}(i)},[t]),m=ee.useCallback(()=>{s.current="",window.clearTimeout(l.current)},[]);return ee.useEffect(()=>()=>window.clearTimeout(l.current),[]),[s,h,m]}function PN(n,t,s){const h=t.length>1&&Array.from(t).every(P=>P===t[0])?t[0]:t,m=s?n.indexOf(s):-1;let b=t$(n,Math.max(m,0));h.length===1&&(b=b.filter(P=>P!==s));const A=b.find(P=>P.textValue.toLowerCase().startsWith(h.toLowerCase()));return A!==s?A:void 0}function t$(n,t){return n.map((s,l)=>n[(t+l)%n.length])}var n$=iN,RN=oN,r$=lN,i$=cN,s$=uN,NN=hN,o$=mN,DN=_N,ON=vN,a$=bN,l$=SN,LN=TN,zN=EN,jN=AN;const Af=n$,If=r$,gd=ee.forwardRef(({className:n,children:t,...s},l)=>v.jsxs(RN,{ref:l,className:Ai("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",n),...s,children:[t,v.jsx(i$,{asChild:!0,children:v.jsx(fP,{className:"h-4 w-4 opacity-50"})})]}));gd.displayName=RN.displayName;const FN=ee.forwardRef(({className:n,...t},s)=>v.jsx(LN,{ref:s,className:Ai("flex cursor-default items-center justify-center py-1",n),...t,children:v.jsx(TB,{className:"h-4 w-4"})}));FN.displayName=LN.displayName;const BN=ee.forwardRef(({className:n,...t},s)=>v.jsx(zN,{ref:s,className:Ai("flex cursor-default items-center justify-center py-1",n),...t,children:v.jsx(fP,{className:"h-4 w-4"})}));BN.displayName=zN.displayName;const yd=ee.forwardRef(({className:n,children:t,position:s="popper",...l},h)=>v.jsx(s$,{children:v.jsxs(NN,{ref:h,className:Ai("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:s,...l,children:[v.jsx(FN,{}),v.jsx(o$,{className:Ai("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),v.jsx(BN,{})]})}));yd.displayName=NN.displayName;const c$=ee.forwardRef(({className:n,...t},s)=>v.jsx(DN,{ref:s,className:Ai("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...t}));c$.displayName=DN.displayName;const ms=ee.forwardRef(({className:n,children:t,...s},l)=>v.jsxs(ON,{ref:l,className:Ai("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...s,children:[v.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:v.jsx(l$,{children:v.jsx(SB,{className:"h-4 w-4"})})}),v.jsx(a$,{children:t})]}));ms.displayName=ON.displayName;const u$=ee.forwardRef(({className:n,...t},s)=>v.jsx(jN,{ref:s,className:Ai("-mx-1 my-1 h-px bg-muted",n),...t}));u$.displayName=jN.displayName;const h$=({serviceName:n})=>{const[t,s]=ee.useState(!1),[l,h]=ee.useState({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""}),{toast:m}=Dy(),b=A=>{A.preventDefault(),console.log("Service application submitted:",{serviceName:n,...l}),m({title:"Application Submitted",description:`Your application for ${n} has been submitted successfully. We'll contact you soon.`}),s(!1),h({email:"",fullName:"",company:"",position:"",phoneNumber:"",experience:"",motivation:""})},i=(A,P)=>{h(D=>({...D,[A]:P}))};return v.jsxs(ol,{open:t,onOpenChange:s,children:[v.jsx(MT,{asChild:!0,children:v.jsxs(on,{className:"w-full",children:["Apply for ",n]})}),v.jsxs(Fa,{className:"max-w-md max-h-[80vh] overflow-y-auto",children:[v.jsxs(Ba,{children:[v.jsxs(Va,{children:["Apply for ",n]}),v.jsxs(kT,{children:["Fill out this form to apply for our ",n," program. We'll review your application and get back to you within 48 hours."]})]}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"email",children:"Professional Email *"}),v.jsx(Jn,{id:"email",type:"email",value:l.email,onChange:A=>i("email",A.target.value),placeholder:"your@company.com",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"fullName",children:"Full Name *"}),v.jsx(Jn,{id:"fullName",value:l.fullName,onChange:A=>i("fullName",A.target.value),placeholder:"John Doe",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"company",children:"Company/Startup Name"}),v.jsx(Jn,{id:"company",value:l.company,onChange:A=>i("company",A.target.value),placeholder:"Your Company Name"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"position",children:"Position/Role *"}),v.jsxs(Af,{onValueChange:A=>i("position",A),required:!0,children:[v.jsx(gd,{children:v.jsx(If,{placeholder:"Select your role"})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"founder",children:"Founder/Co-founder"}),v.jsx(ms,{value:"ceo",children:"CEO"}),v.jsx(ms,{value:"cto",children:"CTO"}),v.jsx(ms,{value:"entrepreneur",children:"Entrepreneur"}),v.jsx(ms,{value:"business-owner",children:"Business Owner"}),v.jsx(ms,{value:"other",children:"Other"})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"phoneNumber",children:"Phone Number"}),v.jsx(Jn,{id:"phoneNumber",type:"tel",value:l.phoneNumber,onChange:A=>i("phoneNumber",A.target.value),placeholder:"+1 (555) 123-4567"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"experience",children:"Years of Experience *"}),v.jsxs(Af,{onValueChange:A=>i("experience",A),required:!0,children:[v.jsx(gd,{children:v.jsx(If,{placeholder:"Select experience level"})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"0-1",children:"0-1 years"}),v.jsx(ms,{value:"2-5",children:"2-5 years"}),v.jsx(ms,{value:"6-10",children:"6-10 years"}),v.jsx(ms,{value:"10+",children:"10+ years"})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"motivation",children:"Why are you interested in this program? *"}),v.jsx(fo,{id:"motivation",value:l.motivation,onChange:A=>i("motivation",A.target.value),placeholder:"Tell us about your goals and how this program fits into your plans...",className:"min-h-[80px]",required:!0})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"button",variant:"outline",onClick:()=>s(!1),className:"flex-1",children:"Cancel"}),v.jsx(on,{type:"submit",className:"flex-1",children:"Submit Application"})]})]})]})]})},d$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const b=await rl.getServices();t(b)}catch(b){console.error("Error fetching services:",b)}finally{l(!1)}})()},[]);const h=m=>({home:lg,"arrow-up":Qv,book:e1,users:cg})[m]||lg;return s?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",v.jsx("span",{className:"gradient-text",children:"Programs"})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Comprehensive support programs designed to accelerate your startup's growth at every stage. From ideation to scaling, we provide the resources, mentorship, and networks you need to succeed."})]})})}),v.jsx("section",{className:"py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"grid grid-cols-1 gap-12",children:n.map((m,b)=>{const i=h(m.icon);return v.jsx(Rr,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 ${b%2===1?"lg:flex-row-reverse":""}`,children:v.jsxs("div",{className:"lg:flex",children:[v.jsx("div",{className:"lg:w-1/3 bg-primary/5 flex items-center justify-center p-12",children:v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"w-24 h-24 bg-primary/10 rounded-2xl flex items-center justify-center mx-auto mb-6",children:v.jsx(i,{className:"h-12 w-12 text-primary"})}),v.jsx(_a,{variant:"secondary",className:"text-sm",children:m.duration})]})}),v.jsxs("div",{className:"lg:w-2/3 p-8",children:[v.jsxs(Yr,{className:"p-0 mb-6",children:[v.jsx(Jr,{className:"text-2xl mb-2",children:m.title}),v.jsx(_s,{className:"text-base text-gray-600",children:m.description})]}),v.jsxs(Qr,{className:"p-0 space-y-6",children:[v.jsxs("div",{children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"What You'll Get:"}),v.jsx("ul",{className:"space-y-2",children:m.features.map((A,P)=>v.jsxs("li",{className:"flex items-start text-gray-600",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{className:"text-sm",children:A})]},P))})]}),v.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Ideal For:"}),v.jsx("p",{className:"text-sm text-gray-600",children:m.eligibility})]}),v.jsx("div",{className:"pt-4 border-t border-gray-100",children:v.jsx(h$,{serviceName:m.title})})]})]})]})},m.id)})})})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Process"}),v.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"A proven methodology that takes your startup from concept to success"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[{step:"01",title:"Application",description:"Submit your application with your startup idea and current stage"},{step:"02",title:"Assessment",description:"Our experts evaluate your potential and fit for our programs"},{step:"03",title:"Matching",description:"We connect you with the right program, mentors, and resources"},{step:"04",title:"Growth",description:"Execute your growth plan with continuous support and guidance"}].map((m,b)=>v.jsxs("div",{className:"text-center relative",children:[v.jsx("div",{className:"w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold",children:m.step}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:m.title}),v.jsx("p",{className:"text-gray-600 text-sm",children:m.description}),b<3&&v.jsx("div",{className:"hidden md:block absolute top-8 left-full w-full h-0.5 bg-gray-300 transform -translate-x-1/2"})]},b))})]})}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsx("div",{className:"text-center mb-16",children:v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Frequently Asked Questions"})}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[{question:"What stage startups do you work with?",answer:"We support startups at all stages, from pre-seed ideas to Series A companies looking to scale."},{question:"Do you take equity in startups?",answer:"Our equity requirements vary by program. Some programs are equity-free, while others involve small equity stakes in exchange for funding."},{question:"How long are the programs?",answer:"Program duration varies from 2 weeks for intensive bootcamps to 12 months for comprehensive incubation programs."},{question:"What kind of support do you provide?",answer:"We provide mentorship, funding connections, technical resources, legal guidance, and access to our extensive network of partners and investors."}].map((m,b)=>v.jsxs(Rr,{className:"p-6",children:[v.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:m.question}),v.jsx("p",{className:"text-gray-600 text-sm",children:m.answer})]},b))})]})}),v.jsx("section",{className:"py-20 bg-primary text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Ready to Get Started?"}),v.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Take the first step towards transforming your startup. Apply to our programs today."}),v.jsx(on,{size:"lg",variant:"secondary",children:"Apply Now"})]})})]})},f$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[b,i]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const j=await rl.getConsulting();t(j),l(j)}catch(j){console.error("Error fetching consultings:",j)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?n:n.filter(D=>D.category===h))},[h,n]);const A=D=>({home:lg,"arrow-up":Qv,book:e1,users:cg})[D]||lg,P=[{value:"all",label:"All Categories"},{value:"strategy",label:"Strategy"},{value:"product",label:"Product"},{value:"marketing",label:"Marketing"},{value:"funding",label:"Funding"}];return b?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen bg-gray-50",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",v.jsx("span",{className:"gradient-text",children:"Consulting Services"})]}),v.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto mb-8",children:"Tailored innovation consulting designed to help your startup tackle strategic, product, marketing, or funding challenges."})]})}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"flex justify-between items-center mb-8",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Consultings"}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),v.jsxs(Af,{value:h,onValueChange:m,children:[v.jsx(gd,{className:"w-48",children:v.jsx(If,{placeholder:"Select category"})}),v.jsx(yd,{children:P.map(D=>v.jsx(ms,{value:D.value,children:D.label},D.value))})]})]})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map(D=>{const j=A(D.icon);return v.jsxs(Rr,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[v.jsxs(Yr,{children:[v.jsxs("div",{className:"flex items-start justify-between mb-4",children:[v.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:v.jsx(j,{className:"h-6 w-6 text-primary"})}),v.jsx(_a,{variant:"secondary",className:"capitalize",children:D.category})]}),v.jsx(Jr,{className:"text-xl",children:D.title}),v.jsx(_s,{className:"text-base",children:D.description})]}),v.jsxs(Qr,{className:"flex flex-col flex-grow justify-between",children:[v.jsxs("div",{children:[v.jsx("ul",{className:"space-y-2 mb-6",children:D.features.map((U,X)=>v.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[v.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),U]},X))}),v.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:[v.jsx("strong",{children:"Eligibility:"})," ",D.eligibility]})]}),v.jsx(Pi,{to:"/contact",className:"w-full mt-auto",children:v.jsx(on,{className:"w-full",children:"Contact Us"})})]})]},D.id)})}),s.length===0&&v.jsx("div",{className:"text-center py-12",children:v.jsx("p",{className:"text-gray-500",children:"No consulting services found for the selected category."})})]})}),v.jsx("section",{className:"py-20 bg-primary text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Need Strategic Support?"}),v.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Book a consulting session with our experts and take the next step in your startup's innovation journey."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[v.jsx(on,{size:"lg",variant:"secondary",children:v.jsx(Pi,{to:"/contact",children:"Book a session"})}),v.jsx(on,{size:"lg",variant:"secondary",children:v.jsx(Pi,{to:"/case-studies",children:"Download our brochure"})})]})]})})]})},p$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[b,i]=ee.useState(!0);ee.useEffect(()=>{(async()=>{try{const j=await rl.getProducts();t(j),l(j)}catch(j){console.error("Error fetching products:",j)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?n:n.filter(D=>D.category===h))},[h,n]);const A=[{value:"all",label:"All Categories"},{value:"Software",label:"Software"},{value:"Service",label:"Service"},{value:"Analytics",label:"Analytics"}],P=D=>{switch(D){case"active":return v.jsx(_a,{className:"bg-green-100 text-green-800",children:"Available"});case"coming-soon":return v.jsx(_a,{className:"bg-blue-100 text-blue-800",children:"Coming Soon"});case"inactive":return v.jsx(_a,{className:"bg-gray-100 text-gray-800",children:"Inactive"});default:return null}};return b?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Our ",v.jsx("span",{className:"gradient-text",children:"Products"})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Innovative tools and platforms designed to empower startups, investors, and organizations with data-driven insights and comprehensive evaluation frameworks."})]})})}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"flex justify-between items-center mb-8",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Products"}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx("span",{className:"text-sm text-gray-600",children:"Filter by category:"}),v.jsxs(Af,{value:h,onValueChange:m,children:[v.jsx(gd,{className:"w-48",children:v.jsx(If,{placeholder:"Select category"})}),v.jsx(yd,{children:A.map(D=>v.jsx(ms,{value:D.value,children:D.label},D.value))})]})]})]}),v.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:s.map(D=>v.jsxs(Rr,{className:"h-full flex flex-col justify-between hover:shadow-lg transition-shadow",children:[v.jsxs(Yr,{children:[v.jsxs("div",{className:"flex justify-between items-start mb-4",children:[v.jsx(_a,{variant:"outline",children:D.category}),P(D.status)]}),v.jsx(Jr,{className:"text-2xl",children:D.name}),v.jsx(_s,{className:"text-base leading-relaxed",children:D.description}),v.jsx("div",{className:"text-xl font-bold text-primary mt-2",children:D.price})]}),v.jsxs(Qr,{className:"flex flex-col flex-grow justify-between",children:[v.jsxs("div",{className:"mb-6",children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Features:"}),v.jsx("ul",{className:"space-y-2",children:D.features.map((j,U)=>v.jsxs("li",{className:"flex items-center text-sm text-gray-600",children:[v.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full mr-3"}),j]},U))})]}),v.jsx(on,{className:"w-full mt-auto",disabled:D.status!=="active",onClick:()=>{D.status==="active"&&D.image&&window.open(D.image,"_blank")},children:D.status==="coming-soon"?"Coming Soon":"Get Started"})]})]},D.id))}),s.length===0&&v.jsx("div",{className:"text-center py-12",children:v.jsx("p",{className:"text-gray-500",children:"No products found for the selected category."})})]})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Ready to Explore Our Products?"}),v.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Get in touch with our team to learn more about how our products can support your startup journey or investment decisions."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[v.jsx(on,{size:"lg",asChild:!0,children:v.jsx(Pi,{to:"/contact",children:"Contact Us"})}),v.jsx(on,{size:"lg",variant:"outline",asChild:!0,children:v.jsx(Pi,{to:"/resources",children:"View Resources"})})]})]})})]})},m$=({isOpen:n,onClose:t,resource:s})=>{const{toast:l}=Dy(),[h,m]=ee.useState({name:"",email:"",company:"",phone:"",message:""}),[b,i]=ee.useState(!1),A=j=>{j.preventDefault(),console.log("Download request submitted:",{...h,resourceId:s?.id}),i(!0),l({title:"Information submitted",description:"Thank you for your information! You can now download the resource."})},P=()=>{const j=document.createElement("a");j.href=s?.downloadUrl||"#",j.download=`${s?.title}.pdf`,j.click(),l({title:"Download started",description:"The resource is being downloaded."})},D=()=>{m({name:"",email:"",company:"",phone:"",message:""}),i(!1),t()};return s?v.jsx(ol,{open:n,onOpenChange:D,children:v.jsxs(Fa,{className:"max-w-md",children:[v.jsx(Ba,{children:v.jsx(Va,{children:b?"Download Ready!":`Download ${s.title}`})}),b?v.jsxs("div",{className:"space-y-4 text-center",children:[v.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[v.jsx("p",{className:"text-green-800 mb-4",children:"Thank you for providing your information! Your download is ready."}),v.jsxs("p",{className:"text-sm text-green-600 mb-4",children:["Click the button below to download ",s.title,"."]})]}),v.jsxs(on,{onClick:P,className:"w-full flex items-center gap-2",children:[v.jsx(gP,{size:16}),"Download ",s.title]}),v.jsx(on,{variant:"outline",onClick:D,className:"w-full",children:"Close"})]}):v.jsxs("form",{onSubmit:A,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"name",children:"Full Name *"}),v.jsx(Jn,{id:"name",value:h.name,onChange:j=>m(U=>({...U,name:j.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"email",children:"Email Address *"}),v.jsx(Jn,{id:"email",type:"email",value:h.email,onChange:j=>m(U=>({...U,email:j.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"company",children:"Company/Organization *"}),v.jsx(Jn,{id:"company",value:h.company,onChange:j=>m(U=>({...U,company:j.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"phone",children:"Phone Number"}),v.jsx(Jn,{id:"phone",type:"tel",value:h.phone,onChange:j=>m(U=>({...U,phone:j.target.value}))})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"message",children:"How will you use this resource? *"}),v.jsx(fo,{id:"message",value:h.message,onChange:j=>m(U=>({...U,message:j.target.value})),placeholder:"Brief description of your intended use...",rows:3,required:!0})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:"Submit & Download"}),v.jsx(on,{type:"button",variant:"outline",onClick:D,children:"Cancel"})]})]})]})}):null},g$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState([]),[h,m]=ee.useState("all"),[b,i]=ee.useState(!0),[A,P]=ee.useState(null),[D,j]=ee.useState(!1);ee.useEffect(()=>{(async()=>{try{const re=await rl.getResources();t(re),l(re)}catch(re){console.error("Error fetching resources:",re)}finally{i(!1)}})()},[]),ee.useEffect(()=>{l(h==="all"?n:n.filter(W=>W.type===h))},[h,n]);const U=W=>{W.downloadUrl?window.open(W.downloadUrl,"_blank"):console.warn("No download URL for this resource.")},X=W=>({"pitch-deck":pI,"financial-model":bB,presentation:pI,guide:e1})[W]||AB,Y=[{value:"all",label:"All Types"},{value:"pitch-deck",label:"Pitch Decks"},{value:"financial-model",label:"Financial Models"},{value:"presentation",label:"Presentations"},{value:"guide",label:"Guides"}];return b?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",v.jsx("span",{className:"gradient-text",children:"Resources"})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Access essential templates, guides, and tools to accelerate your startup journey. From pitch decks to financial models, everything you need to succeed."})]})})}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"flex justify-between items-center mb-8",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"All Resources"}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsx("span",{className:"text-sm text-gray-600",children:"Filter by type:"}),v.jsxs(Af,{value:h,onValueChange:m,children:[v.jsx(gd,{className:"w-48",children:v.jsx(If,{placeholder:"Select type"})}),v.jsx(yd,{children:Y.map(W=>v.jsx(ms,{value:W.value,children:W.label},W.value))})]})]})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map(W=>{const re=X(W.type);return v.jsxs(Rr,{className:"h-full hover:shadow-lg transition-shadow",children:[v.jsxs(Yr,{children:[v.jsxs("div",{className:"flex items-start justify-between mb-4",children:[v.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:v.jsx(re,{className:"h-6 w-6 text-primary"})}),v.jsx(_a,{variant:"secondary",className:"capitalize",children:W.category})]}),v.jsx(Jr,{className:"text-xl",children:W.title}),v.jsx(_s,{className:"text-base",children:W.description})]}),v.jsxs(Qr,{children:[v.jsx("div",{className:"flex flex-wrap gap-1 mb-6",children:W.tags.map((de,Me)=>v.jsx(_a,{variant:"outline",className:"text-xs",children:de},Me))}),v.jsxs(on,{className:"w-full",onClick:()=>U(W),children:[v.jsx(gP,{size:16,className:"mr-2"}),"Get Resource"]})]})]},W.id)})}),s.length===0&&v.jsx("div",{className:"text-center py-12",children:v.jsx("p",{className:"text-gray-500",children:"No resources found for the selected type."})})]})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Need More Support?"}),v.jsx("p",{className:"text-xl text-gray-600 mb-8 max-w-2xl mx-auto",children:"Our resources are just the beginning. Join our programs for personalized guidance and expert mentorship to take your startup to the next level."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[v.jsx(on,{size:"lg",asChild:!0,children:v.jsx(Pi,{to:"/fund",children:"View Investment"})}),v.jsx(on,{size:"lg",variant:"outline",asChild:!0,children:v.jsx(Pi,{to:"/contact",children:"Contact Us"})})]})]})}),v.jsx(m$,{isOpen:D,onClose:()=>j(!1),resource:A})]})};var qv={exports:{}},y$=qv.exports,nM;function _$(){return nM||(nM=1,function(n,t){(function(s,l){n.exports=l()})(y$,function(){var s,l,h;function m(i,A){if(!s)s=A;else if(!l)l=A;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",D={};s(D),h=A(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}m(["exports"],function(i){var A=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function D(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o*g-d*u;return y?(a[0]=g*(y=1/y),a[1]=-u*y,a[2]=-d*y,a[3]=o*y,a):null}function j(){var a=new P(9);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function U(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8];return a[0]=y*N-T*I,a[1]=d*I-u*N,a[2]=u*T-d*y,a[3]=T*C-g*N,a[4]=o*N-d*C,a[5]=d*g-o*T,a[6]=g*I-y*C,a[7]=u*C-o*I,a[8]=o*y-u*g,a}function X(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=o[0],V=o[1],H=o[2],K=o[3],te=o[4],ae=o[5],fe=o[6],pe=o[7],Q=o[8];return a[0]=L*u+V*y+H*I,a[1]=L*d+V*T+H*N,a[2]=L*g+V*C+H*O,a[3]=K*u+te*y+ae*I,a[4]=K*d+te*T+ae*N,a[5]=K*g+te*C+ae*O,a[6]=fe*u+pe*y+Q*I,a[7]=fe*d+pe*T+Q*N,a[8]=fe*g+pe*C+Q*O,a}function Y(){var a=new P(16);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function W(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function re(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8],O=e[9],L=e[10],V=e[11],H=e[12],K=e[13],te=e[14],ae=e[15],fe=o*T-u*y,pe=o*C-d*y,Q=o*I-g*y,he=u*C-d*T,me=u*I-g*T,_e=d*I-g*C,De=N*K-O*H,Pe=N*te-L*H,Oe=N*ae-V*H,Ve=O*te-L*K,tt=O*ae-V*K,vt=L*ae-V*te,ft=fe*vt-pe*tt+Q*Ve+he*Oe-me*Pe+_e*De;return ft?(a[0]=(T*vt-C*tt+I*Ve)*(ft=1/ft),a[1]=(d*tt-u*vt-g*Ve)*ft,a[2]=(K*_e-te*me+ae*he)*ft,a[3]=(L*me-O*_e-V*he)*ft,a[4]=(C*Oe-y*vt-I*Pe)*ft,a[5]=(o*vt-d*Oe+g*Pe)*ft,a[6]=(te*Q-H*_e-ae*pe)*ft,a[7]=(N*_e-L*Q+V*pe)*ft,a[8]=(y*tt-T*Oe+I*De)*ft,a[9]=(u*Oe-o*tt-g*De)*ft,a[10]=(H*me-K*Q+ae*fe)*ft,a[11]=(O*Q-N*me-V*fe)*ft,a[12]=(T*Pe-y*Ve-C*De)*ft,a[13]=(o*Ve-u*Pe+d*De)*ft,a[14]=(K*pe-H*he-te*fe)*ft,a[15]=(N*he-O*pe+L*fe)*ft,a):null}function de(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=e[9],V=e[10],H=e[11],K=e[12],te=e[13],ae=e[14],fe=e[15],pe=o[0],Q=o[1],he=o[2],me=o[3];return a[0]=pe*u+Q*T+he*O+me*K,a[1]=pe*d+Q*C+he*L+me*te,a[2]=pe*g+Q*I+he*V+me*ae,a[3]=pe*y+Q*N+he*H+me*fe,a[4]=(pe=o[4])*u+(Q=o[5])*T+(he=o[6])*O+(me=o[7])*K,a[5]=pe*d+Q*C+he*L+me*te,a[6]=pe*g+Q*I+he*V+me*ae,a[7]=pe*y+Q*N+he*H+me*fe,a[8]=(pe=o[8])*u+(Q=o[9])*T+(he=o[10])*O+(me=o[11])*K,a[9]=pe*d+Q*C+he*L+me*te,a[10]=pe*g+Q*I+he*V+me*ae,a[11]=pe*y+Q*N+he*H+me*fe,a[12]=(pe=o[12])*u+(Q=o[13])*T+(he=o[14])*O+(me=o[15])*K,a[13]=pe*d+Q*C+he*L+me*te,a[14]=pe*g+Q*I+he*V+me*ae,a[15]=pe*y+Q*N+he*H+me*fe,a}function Me(a,e,o){var u,d,g,y,T,C,I,N,O,L,V,H,K=o[0],te=o[1],ae=o[2];return e===a?(a[12]=e[0]*K+e[4]*te+e[8]*ae+e[12],a[13]=e[1]*K+e[5]*te+e[9]*ae+e[13],a[14]=e[2]*K+e[6]*te+e[10]*ae+e[14],a[15]=e[3]*K+e[7]*te+e[11]*ae+e[15]):(d=e[1],g=e[2],y=e[3],T=e[4],C=e[5],I=e[6],N=e[7],O=e[8],L=e[9],V=e[10],H=e[11],a[0]=u=e[0],a[1]=d,a[2]=g,a[3]=y,a[4]=T,a[5]=C,a[6]=I,a[7]=N,a[8]=O,a[9]=L,a[10]=V,a[11]=H,a[12]=u*K+T*te+O*ae+e[12],a[13]=d*K+C*te+L*ae+e[13],a[14]=g*K+I*te+V*ae+e[14],a[15]=y*K+N*te+H*ae+e[15]),a}function Fe(a,e,o){var u=o[0],d=o[1],g=o[2];return a[0]=e[0]*u,a[1]=e[1]*u,a[2]=e[2]*u,a[3]=e[3]*u,a[4]=e[4]*d,a[5]=e[5]*d,a[6]=e[6]*d,a[7]=e[7]*d,a[8]=e[8]*g,a[9]=e[9]*g,a[10]=e[10]*g,a[11]=e[11]*g,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function ht(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[4],y=e[5],T=e[6],C=e[7],I=e[8],N=e[9],O=e[10],L=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=g*d+I*u,a[5]=y*d+N*u,a[6]=T*d+O*u,a[7]=C*d+L*u,a[8]=I*d-g*u,a[9]=N*d-y*u,a[10]=O*d-T*u,a[11]=L*d-C*u,a}function at(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[0],y=e[1],T=e[2],C=e[3],I=e[8],N=e[9],O=e[10],L=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*d-I*u,a[1]=y*d-N*u,a[2]=T*d-O*u,a[3]=C*d-L*u,a[8]=g*u+I*d,a[9]=y*u+N*d,a[10]=T*u+O*d,a[11]=C*u+L*d,a}function Dt(a,e,o){var u=Math.sin(o),d=Math.cos(o),g=e[0],y=e[1],T=e[2],C=e[3],I=e[4],N=e[5],O=e[6],L=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=g*d+I*u,a[1]=y*d+N*u,a[2]=T*d+O*u,a[3]=C*d+L*u,a[4]=I*d-g*u,a[5]=N*d-y*u,a[6]=O*d-T*u,a[7]=L*d-C*u,a}function kt(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Rt(a,e,o){var u,d,g,y=o[0],T=o[1],C=o[2],I=Math.hypot(y,T,C);return I<A?null:(y*=I=1/I,T*=I,C*=I,u=Math.sin(e),d=Math.cos(e),a[0]=y*y*(g=1-d)+d,a[1]=T*y*g+C*u,a[2]=C*y*g-T*u,a[3]=0,a[4]=y*T*g-C*u,a[5]=T*T*g+d,a[6]=C*T*g+y*u,a[7]=0,a[8]=y*C*g+T*u,a[9]=T*C*g-y*u,a[10]=C*C*g+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function fn(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o+o,T=u+u,C=d+d,I=o*y,N=u*y,O=u*T,L=d*y,V=d*T,H=d*C,K=g*y,te=g*T,ae=g*C;return a[0]=1-O-H,a[1]=N+ae,a[2]=L-te,a[3]=0,a[4]=N-ae,a[5]=1-I-H,a[6]=V+K,a[7]=0,a[8]=L+te,a[9]=V-K,a[10]=1-I-O,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)});var En=de;function xn(){var a=new P(3);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Tn(a){var e=new P(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function Bn(a){return Math.hypot(a[0],a[1],a[2])}function Ft(a,e,o){var u=new P(3);return u[0]=a,u[1]=e,u[2]=o,u}function wn(a,e,o){return a[0]=e[0]+o[0],a[1]=e[1]+o[1],a[2]=e[2]+o[2],a}function Yt(a,e,o){return a[0]=e[0]-o[0],a[1]=e[1]-o[1],a[2]=e[2]-o[2],a}function Cn(a,e,o){return a[0]=e[0]*o[0],a[1]=e[1]*o[1],a[2]=e[2]*o[2],a}function gt(a,e,o){return a[0]=Math.min(e[0],o[0]),a[1]=Math.min(e[1],o[1]),a[2]=Math.min(e[2],o[2]),a}function Jt(a,e,o){return a[0]=Math.max(e[0],o[0]),a[1]=Math.max(e[1],o[1]),a[2]=Math.max(e[2],o[2]),a}function Ht(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a[2]=e[2]*o,a}function qe(a,e,o,u){return a[0]=e[0]+o[0]*u,a[1]=e[1]+o[1]*u,a[2]=e[2]+o[2]*u,a}function Ct(a,e){var o=e[0]-a[0],u=e[1]-a[1],d=e[2]-a[2];return o*o+u*u+d*d}function Pn(a){var e=a[0],o=a[1],u=a[2];return e*e+o*o+u*u}function Zn(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function Nn(a,e){var o=e[0],u=e[1],d=e[2],g=o*o+u*u+d*d;return g>0&&(g=1/Math.sqrt(g)),a[0]=e[0]*g,a[1]=e[1]*g,a[2]=e[2]*g,a}function cn(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function un(a,e,o){var u=e[0],d=e[1],g=e[2],y=o[0],T=o[1],C=o[2];return a[0]=d*C-g*T,a[1]=g*y-u*C,a[2]=u*T-d*y,a}function $n(a,e,o,u){var d=e[0],g=e[1],y=e[2];return a[0]=d+u*(o[0]-d),a[1]=g+u*(o[1]-g),a[2]=y+u*(o[2]-y),a}function An(a,e,o){var u=e[0],d=e[1],g=e[2],y=o[3]*u+o[7]*d+o[11]*g+o[15];return a[0]=(o[0]*u+o[4]*d+o[8]*g+o[12])/(y=y||1),a[1]=(o[1]*u+o[5]*d+o[9]*g+o[13])/y,a[2]=(o[2]*u+o[6]*d+o[10]*g+o[14])/y,a}function Fn(a,e,o){var u=e[0],d=e[1],g=e[2];return a[0]=u*o[0]+d*o[3]+g*o[6],a[1]=u*o[1]+d*o[4]+g*o[7],a[2]=u*o[2]+d*o[5]+g*o[8],a}function Zr(a,e,o){var u=o[0],d=o[1],g=o[2],y=e[0],T=e[1],C=e[2],I=d*C-g*T,N=g*y-u*C,O=u*T-d*y,L=d*O-g*N,V=g*I-u*O,H=u*N-d*I,K=2*o[3];return N*=K,O*=K,V*=2,H*=2,a[0]=y+(I*=K)+(L*=2),a[1]=T+N+V,a[2]=C+O+H,a}function ni(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var Or=Yt,vs=Cn,$s=Bn;function Hi(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function mo(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a[2]=e[2]*o,a[3]=e[3]*o,a}function El(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=o*o+u*u+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=o*y,a[1]=u*y,a[2]=d*y,a[3]=g*y,a}function zi(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3];return a[0]=o[0]*u+o[4]*d+o[8]*g+o[12]*y,a[1]=o[1]*u+o[5]*d+o[9]*g+o[13]*y,a[2]=o[2]*u+o[6]*d+o[10]*g+o[14]*y,a[3]=o[3]*u+o[7]*d+o[11]*g+o[15]*y,a}function Ki(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function to(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Qo(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+y*T,a[1]=d*C+g*T,a[2]=g*C-d*T,a[3]=y*C-u*T,a}function To(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C-g*T,a[1]=d*C+y*T,a[2]=g*C+u*T,a[3]=y*C-d*T,a}xn(),Hi();var Cs,Ua,wa,is,Sa,Hs=El,Fo=(Cs=xn(),Ua=Ft(1,0,0),wa=Ft(0,1,0),function(a,e,o){var u=cn(e,o);return u<-.999999?(un(Cs,Ua,e),$s(Cs)<1e-6&&un(Cs,wa,e),Nn(Cs,Cs),function(d,g,y){y*=.5;var T=Math.sin(y);d[0]=T*g[0],d[1]=T*g[1],d[2]=T*g[2],d[3]=Math.cos(y)}(a,Cs,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(un(Cs,e,o),a[0]=Cs[0],a[1]=Cs[1],a[2]=Cs[2],a[3]=1+u,Hs(a,a))});function ss(){var a=new P(2);return P!=Float32Array&&(a[0]=0,a[1]=0),a}function go(a,e){var o=new P(2);return o[0]=a,o[1]=e,o}function Ta(a,e,o){return a[0]=e[0]+o[0],a[1]=e[1]+o[1],a}function Ea(a,e,o){return a[0]=e[0]-o[0],a[1]=e[1]-o[1],a}function Ca(a,e,o){return a[0]=e[0]*o,a[1]=e[1]*o,a}function As(a){return Math.hypot(a[0],a[1])}function $a(a,e){var o=e[0],u=e[1],d=o*o+u*u;return d>0&&(d=1/Math.sqrt(d)),a[0]=e[0]*d,a[1]=e[1]*d,a}function On(a,e){return a[0]*e[0]+a[1]*e[1]}function ui(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Ki(),Ki(),j(),ss();var fi,Vi,Is=function(){if(Sa)return is;function a(e,o,u,d){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(d-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=o,this.p2x=u,this.p2y=d}return Sa=1,is=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,o){if(o===void 0&&(o=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,d=0;d<8;d++){var g=this.sampleCurveX(u)-e;if(Math.abs(g)<o)return u;var y=this.sampleCurveDerivativeX(u);if(Math.abs(y)<1e-6)break;u-=g/y}var T=0,C=1;for(u=e,d=0;d<20&&(g=this.sampleCurveX(u),!(Math.abs(g-e)<o));d++)e>g?T=u:C=u,u=.5*(C-T)+T;return u},solve:function(e,o){return this.sampleCurveY(this.solveCurveX(e,o))}},is}(),Ha=ui(Is);function Ga(){if(Vi)return fi;function a(e,o){this.x=e,this.y=o}return Vi=1,fi=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,o){return this.clone()._rotateAround(e,o)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var o=e.x-this.x,u=e.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,o){return Math.atan2(this.x*o-this.y*e,this.x*e+this.y*o)},_matMult:function(e){var o=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=o,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var o=Math.cos(e),u=Math.sin(e),d=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=d,this},_rotateAround:function(e,o){var u=Math.cos(e),d=Math.sin(e),g=o.y+d*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-d*(this.y-o.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(e){return e instanceof a?e:Array.isArray(e)?new a(e[0],e[1]):e},fi}var Ot=ui(Ga());function qa(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let o=0;o<a.length;o++)if(!qa(a[o],e[o]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const o in a)if(!qa(a[o],e[o]))return!1;return!0}return a===e}const gh=Math.PI/180,Ql=180/Math.PI;function Sr(a){return a*gh}function Ke(a){return a*Ql}const le=[[0,0],[1,0],[1,1],[0,1]];function ue(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,o=e*a;return 4*(a<.5?o:3*(a-e)+o-.75)}function ve(a,e,o,u){const d=new Ha(a,e,o,u);return function(g){return d.solve(g)}}const Ne=ve(.25,.1,.25,1);function Ee(a,e,o){return Math.min(o,Math.max(e,a))}function ze(a,e,o){return(o=Ee((o-a)/(e-a),0,1))*o*(3-2*o)}function We(a,e,o){const u=o-e,d=((a-e)%u+u)%u+e;return d===e?o:d}function je(a,e,o){if(!a.length)return o(null,[]);let u=a.length;const d=new Array(a.length);let g=null;a.forEach((y,T)=>{e(y,(C,I)=>{C&&(g=C),d[T]=I,--u==0&&o(g,d)})})}function Xe(a,...e){for(const o of e)for(const u in o)a[u]=o[u];return a}let dt=1;function Ze(){return dt++}function Nt(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Qt(a,e){a.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function ke(a,e,o){const u={};for(const d in a)u[d]=e.call(this,a[d],d,a);return u}function Wt(a,e,o){const u={};for(const d in a)e.call(this,a[d],d,a)&&(u[d]=a[d]);return u}function gn(a){return Array.isArray(a)?a.map(gn):typeof a=="object"&&a?ke(a,gn):a}function Un(a,e){for(let o=0;o<a.length;o++)if(e.indexOf(a[o])>=0)return!0;return!1}const rr={};function Hn(a){rr[a]||(typeof console<"u"&&console.warn(a),rr[a]=!0)}function ri(a,e,o){return(o.y-a.y)*(e.x-a.x)>(e.y-a.y)*(o.x-a.x)}function mr(a){let e=0;for(let o,u,d=0,g=a.length,y=g-1;d<g;y=d++)o=a[d],u=a[y],e+=(u.x-o.x)*(o.y+u.y);return e}function bi([a,e,o]){const u=Sr(e+90),d=Sr(o);return{x:a*Math.cos(u)*Math.sin(d),y:a*Math.sin(u)*Math.sin(d),z:a*Math.cos(d),azimuthal:e,polar:o}}function Fr(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Nr(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,d,g)=>{const y=d||g;return e[u]=!y||y.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let ji=null;function Ui(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function Ri(a,e,o,u){for(;e<o;){const d=e+o>>1;a[d]<u?e=d+1:o=d}return e}function gs(a,e,o,u){for(;e<o;){const d=e+o>>1;a[d]<=u?e=d+1:o=d}return e}function hs(a){return a>0?1/(1.001-a):1+a}function yo(a){return a>0?1-1/(1.001-a):-a}function Bo(a,e,o){return(a-e.min)*(o.max-o.min)/(e.max-e.min)+o.min}const Gs={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gs.API_URL)return null;try{const a=new URL(Gs.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function kc(a){return Gs.API_URL_REGEX.test(a)}function Rf(a){return Gs.API_SPRITE_REGEX.test(a)}let Pc,Rc,Nc,yu,_u,bd;function yh(){return Pc==null&&(Pc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Pc}const Wa={now:()=>yu!==void 0?yu:performance.now(),setNow(a){yu=a},restoreNow(){yu=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:o,height:u}=a;_u||(_u=document.createElement("canvas"));const d=_u.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(o>_u.width||u>_u.height)&&(_u.width=o,_u.height=u),d.clearRect(-e,-e,o+2*e,u+2*e),d.drawImage(a,0,0,o,u),d.getImageData(-e,-e,o+2*e,u+2*e)},resolveURL:a=>(Rc||(Rc=document.createElement("a")),Rc.href=a,Rc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Nc==null&&(Nc=window.matchMedia("(prefers-reduced-motion: reduce)")),Nc.matches)},hasCanvasFingerprintNoise(){if(bd!==void 0)return bd;if(!yh())return bd=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let o=0;for(let d=0;d<a.width;++d)e.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,e.fillRect(d,0,1,1);const u=e.getImageData(0,0,a.width,a.height);o=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&o++!==u.data[d])return bd=!0,!0;return bd=!1,!1}};function Vo(a,e){const o=a.indexOf("?");if(o<0)return`${a}?${new URLSearchParams(e).toString()}`;const u=new URLSearchParams(a.slice(o));for(const d in e)u.set(d,e[d]);return`${a.slice(0,o)}?${u.toString()}`}function Eo(a,e={persistentParams:[]}){const o=a.indexOf("?");if(o<0)return a;const u=new URLSearchParams,d=new URLSearchParams(a.slice(o));for(const y of e.persistentParams){const T=d.get(y);T&&u.set(y,T)}const g=u.toString();return`${a.slice(0,o)}${g.length>0?`?${g}`:""}`}const ec="mapbox-tiles";let Aa=500,pi=50;const _h=["language","worldview","jobid"];let ll,xu;function Dc(){try{return caches}catch{}}function vu(){const a=Dc();a&&ll==null&&(ll=a.open(ec))}let Nf=1/0;const wd={supported:!1,testSupport:function(a){!Za&&ea&&(Ia?vh(a):no=a)}};let no,ea,Za=!1,Ia=!1;const xh=typeof self<"u"?self:{};function vh(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ea),a.isContextLost())return;wd.supported=!0}catch{}a.deleteTexture(e),Za=!0}xh.document&&(ea=xh.document.createElement("img"),ea.onload=function(){no&&vh(no),no=null,Ia=!0},ea.onerror=function(){Za=!0,no=null},ea.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Xa);class Ar extends Error{constructor(e,o,u){o===401&&kc(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sd=Fr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Cl=function(a,e){if(!(/^file:/.test(o=a.url)||/^file:/.test(Sd())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,d){const g=new AbortController,y=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Sd(),referrerPolicy:u.referrerPolicy,signal:g.signal});let T=!1,C=!1;const I=(N=y.url).indexOf("sku=")>0&&kc(N);var N;u.type==="json"&&y.headers.set("Accept","application/json");const O=(V,H,K)=>{if(C)return;if(V&&V.message!=="SecurityError"&&Hn(V.toString()),H&&K)return L(H);const te=Date.now();fetch(y).then(ae=>{if(ae.ok){const fe=I?ae.clone():null;return L(ae,fe,te)}return d(new Ar(ae.statusText,ae.status,u.url))}).catch(ae=>{ae.name!=="AbortError"&&d(new Error(`${ae.message} ${u.url}`))})},L=(V,H,K)=>{(u.type==="arrayBuffer"?V.arrayBuffer():u.type==="json"?V.json():V.text()).then(te=>{C||(H&&K&&function(ae,fe,pe){if(vu(),ll==null)return;const Q=Nr(fe.headers.get("Cache-Control")||"");if(Q["no-store"])return;const he={status:fe.status,statusText:fe.statusText,headers:new Headers};fe.headers.forEach((De,Pe)=>he.headers.set(Pe,De)),Q["max-age"]&&he.headers.set("Expires",new Date(pe+1e3*Q["max-age"]).toUTCString());const me=he.headers.get("Expires");if(!me||new Date(me).getTime()-pe<42e4)return;let _e=Eo(ae.url,{persistentParams:_h});if(fe.status===206){const De=ae.headers.get("Range");if(!De)return;he.status=200,_e=Vo(_e,{range:De})}(function(De,Pe){if(xu===void 0)try{new Response(new ReadableStream),xu=!0}catch{xu=!1}xu?Pe(De.body):De.blob().then(Pe).catch(Oe=>Hn(Oe.message))})(fe,De=>{const Pe=new Response((Oe=fe.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:De,he);var Oe;vu(),ll?.then(Ve=>Ve.put(_e,Pe)).catch(Ve=>Hn(Ve.message))})}(y,H,K),T=!0,d(null,te,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(te=>{C||d(new Error(te.message))})};return I?function(V,H){if(vu(),ll==null)return H(null);ll.then(K=>{let te=Eo(V.url,{persistentParams:_h});const ae=V.headers.get("Range");ae&&(te=Vo(te,{range:ae})),K.match(te).then(fe=>{const pe=function(Q){if(!Q)return!1;const he=new Date(Q.headers.get("Expires")||0),me=Nr(Q.headers.get("Cache-Control")||"");return Number(he)>Date.now()&&!me["no-cache"]}(fe);K.delete(te).catch(H),pe&&K.put(te,fe.clone()).catch(H),H(null,fe,pe)}).catch(H)}).catch(H)}(y,O):O(null,null),{cancel:()=>{C=!0,T||g.abort()}}}(a,e);if(Fr(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var o;return function(u,d){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const y in u.headers)g.setRequestHeader(y,u.headers[y]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{d(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let y=g.response;if(u.type==="json")try{y=JSON.parse(g.response)}catch(T){return d(T)}d(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else d(new Ar(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,e)},Td=function(a,e){return Cl(Xe(a,{type:"arrayBuffer"}),e)};function Ig(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const Oc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Lc,zc;Lc=[],zc=0;const bu=function(a,e){if(wd.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),zc>=Gs.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Lc.push(g),g}zc++;let o=!1;const u=()=>{if(!o)for(o=!0,zc--;Lc.length&&zc<Gs.MAX_PARALLEL_IMAGE_REQUESTS;){const g=Lc.shift(),{requestParameters:y,callback:T,cancelled:C}=g;C||(g.cancel=bu(y,T).cancel)}},d=Td(a,(g,y,T,C)=>{u(),g?e(g):y&&(self.createImageBitmap?function(I,N){const O=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap(O).then(L=>{N(null,L)}).catch(L=>{N(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(I,N)=>e(I,N,T,C)):function(I,N){const O=new Image;O.onload=()=>{N(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame(()=>{O.src=Oc})},O.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(I)],{type:"image/png"});O.src=I.byteLength?URL.createObjectURL(L):Oc}(y,(I,N)=>e(I,N,T,C)))});return{cancel:()=>{d.cancel(),u()}}};var wu,Ka,Ed,tc={exports:{}},Df={exports:{}},bh={exports:{}},ta=function(){if(Ed)return tc.exports;Ed=1;var a=(wu||(wu=1,Df.exports=function(o,u){var d,g,y,T,C,I,N,O;for(g=o.length-(d=3&o.length),y=u,C=3432918353,I=461845907,O=0;O<g;)N=255&o.charCodeAt(O)|(255&o.charCodeAt(++O))<<8|(255&o.charCodeAt(++O))<<16|(255&o.charCodeAt(++O))<<24,++O,y=27492+(65535&(T=5*(65535&(y=(y^=N=(65535&(N=(N=(65535&N)*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*I+(((N>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(N=0,d){case 3:N^=(255&o.charCodeAt(O+2))<<16;case 2:N^=(255&o.charCodeAt(O+1))<<8;case 1:y^=N=(65535&(N=(N=(65535&(N^=255&o.charCodeAt(O)))*C+(((N>>>16)*C&65535)<<16)&4294967295)<<15|N>>>17))*I+(((N>>>16)*I&65535)<<16)&4294967295}return y^=o.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Df.exports),e=(Ka||(Ka=1,bh.exports=function(o,u){for(var d,g=o.length,y=u^g,T=0;g>=4;)d=1540483477*(65535&(d=255&o.charCodeAt(T)|(255&o.charCodeAt(++T))<<8|(255&o.charCodeAt(++T))<<16|(255&o.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++T;switch(g){case 3:y^=(255&o.charCodeAt(T+2))<<16;case 2:y^=(255&o.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&o.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),bh.exports);return tc.exports=a,tc.exports.murmur3=a,tc.exports.murmur2=e,tc.exports}(),Su=ui(ta);class jc{constructor(e,...o){Xe(this,o[0]||{}),this.type=e}}class cl extends jc{constructor(e,o={}){super("error",Xe({error:e},o))}}function Cd(a,e,o){o[a]&&o[a].indexOf(e)!==-1||(o[a]=o[a]||[],o[a].push(e))}function Tu(a,e,o){if(o&&o[a]){const u=o[a].indexOf(e);u!==-1&&o[a].splice(u,1)}}class Fc{on(e,o){return this._listeners=this._listeners||{},Cd(e,o,this._listeners),this}off(e,o){return Tu(e,o,this._listeners),Tu(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Cd(e,o,this._oneTimeListeners),this):new Promise(u=>{this.once(e,u)})}fire(e,o){const u=typeof e=="string"?new jc(e,o):e,d=u.type;if(this.listens(d)){u.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const C of g)C.call(this,u);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const C of y)Tu(d,C,this._oneTimeListeners),C.call(this,u);const T=this._eventedParent;T&&(Xe(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(u))}else u instanceof cl&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}class _o{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new _o(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[o,u]=e.split("");return new _o({name:o,iconsetId:u})}static isEqual(e,o){return e.name===o.name&&e.iconsetId===o.iconsetId}toString(){return _o.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var wh,Eu={},qs=function(){if(wh)return Eu;wh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(g){return(g=Math.round(g))<0?0:g>255?255:g}function o(g){return e(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function d(g,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?g+(y-g)*T*6:2*T<1?y:3*T<2?g+(y-g)*(2/3-T)*6:g}try{Eu.parseCSSColor=function(g){var y,T=g.replace(/ /g,"").toLowerCase();if(T in a)return a[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var C=T.indexOf("("),I=T.indexOf(")");if(C!==-1&&I+1===T.length){var N=T.substr(0,C),O=T.substr(C+1,I-(C+1)).split(","),L=1;switch(N){case"rgba":if(O.length!==4)return null;L=u(O.pop());case"rgb":return O.length!==3?null:[o(O[0]),o(O[1]),o(O[2]),L];case"hsla":if(O.length!==4)return null;L=u(O.pop());case"hsl":if(O.length!==3)return null;var V=(parseFloat(O[0])%360+360)%360/360,H=u(O[1]),K=u(O[2]),te=K<=.5?K*(H+1):K+H-K*H,ae=2*K-te;return[e(255*d(ae,te,V+1/3)),e(255*d(ae,te,V)),e(255*d(ae,te,V-1/3)),L];default:return null}}return null}}catch{}return Eu}();class Ir{constructor(e,o,u,d=1){this.r=e,this.g=o,this.b=u,this.a=d}static parse(e){if(!e)return;if(e instanceof Ir)return e;if(typeof e!="string")return;const o=qs.parseCSSColor(e);return o?new Ir(o[0]/255,o[1]/255,o[2]/255,o[3]):void 0}toString(){const[e,o,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*o)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(e){const{r:o,g:u,b:d,a:g}=this;return new Ad(e,o,u,d,g)}toPremultipliedRenderColor(e){const{r:o,g:u,b:d,a:g}=this;return new pm(e,o*g,u*g,d*g,g)}clone(){return new Ir(this.r,this.g,this.b,this.a)}}class Ma{constructor(e,o,u,d,g,y=!1){if(this.premultiplied=!1,this.premultiplied=y,e){const T=e.image.height,C=T*T;this.premultiplied?(o=g===0?0:o/g*(T-1),u=g===0?0:u/g*(T-1),d=g===0?0:d/g*(T-1)):(o*=T-1,u*=T-1,d*=T-1);const I=Math.floor(o),N=Math.floor(u),O=Math.floor(d),L=Math.ceil(o),V=Math.ceil(u),H=Math.ceil(d),K=o-I,te=u-N,ae=d-O,fe=e.image.data,pe=4*(I+N*C+O*T),Q=4*(I+N*C+H*T),he=4*(I+V*C+O*T),me=4*(I+V*C+H*T),_e=4*(L+N*C+O*T),De=4*(L+N*C+H*T),Pe=4*(L+V*C+O*T),Oe=4*(L+V*C+H*T);if(pe<0||Oe>=fe.length)throw new Error("out of range");this.r=Mn(Mn(Mn(fe[pe],fe[Q],ae),Mn(fe[he],fe[me],ae),te),Mn(Mn(fe[_e],fe[De],ae),Mn(fe[Pe],fe[Oe],ae),te),K)/255*(this.premultiplied?g:1),this.g=Mn(Mn(Mn(fe[pe+1],fe[Q+1],ae),Mn(fe[he+1],fe[me+1],ae),te),Mn(Mn(fe[_e+1],fe[De+1],ae),Mn(fe[Pe+1],fe[Oe+1],ae),te),K)/255*(this.premultiplied?g:1),this.b=Mn(Mn(Mn(fe[pe+2],fe[Q+2],ae),Mn(fe[he+2],fe[me+2],ae),te),Mn(Mn(fe[_e+2],fe[De+2],ae),Mn(fe[Pe+2],fe[Oe+2],ae),te),K)/255*(this.premultiplied?g:1),this.a=g}else this.r=o,this.g=u,this.b=d,this.a=g}toArray(){const{r:e,g:o,b:u,a:d}=this;return[255*e,255*o,255*u,d]}toHslaArray(){let{r:e,g:o,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];e/=d,o/=d,u/=d}const g=Math.min(Math.max(e,0),1),y=Math.min(Math.max(o,0),1),T=Math.min(Math.max(u,0),1),C=Math.min(g,y,T),I=Math.max(g,y,T),N=(C+I)/2;if(C===I)return[0,0,100*N,d];const O=I-C,L=N>.5?O/(2-I-C):O/(I+C);let V=0;return I===g?V=(y-T)/O+(y<T?6:0):I===y?V=(T-g)/O+2:I===T&&(V=(g-y)/O+4),V*=60,[Math.min(Math.max(V,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*N,0),100),d]}toArray01(){const{r:e,g:o,b:u,a:d}=this;return[e,o,u,d]}toArray01Scaled(e){const{r:o,g:u,b:d}=this;return[o*e,u*e,d*e]}toArray01Linear(){const{r:e,g:o,b:u,a:d}=this;return[Math.pow(e,2.2),Math.pow(o,2.2),Math.pow(u,2.2),d]}}class Ad extends Ma{constructor(e,o,u,d,g){super(e,o,u,d,g,!1)}}class pm extends Ma{constructor(e,o,u,d,g){super(e,o,u,d,g,!0)}}function Mn(a,e,o){return a*(1-o)+e*o}function Sh(a,e,o){return a.map((u,d)=>Mn(u,e[d],o))}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var nc=Object.freeze({__proto__:null,array:Sh,color:function(a,e,o){return new Ir(Mn(a.r,e.r,o),Mn(a.g,e.g,o),Mn(a.b,e.b,o),Mn(a.a,e.a,o))},number:Mn});function Al(a,...e){for(const o of e)for(const u in o)a[u]=o[u];return a}class na extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class mm{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[u,d]of o)this.bindings[u]=d}concat(e){return new mm(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Th={kind:"null"},ln={kind:"number"},Ur={kind:"string"},Br={kind:"boolean"},ra={kind:"color"},rc={kind:"object"},$r={kind:"value"},Of={kind:"collator"},Eh={kind:"formatted"},Id={kind:"resolvedImage"};function Co(a,e){return{kind:"array",itemType:a,N:e}}function ds(a){if(a.kind==="array"){const e=ds(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const Gy=[Th,ln,Ur,Br,ra,Eh,rc,Co($r),Id];function Bc(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bc(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const o of Gy)if(!Bc(o,e))return null}}return`Expected ${ds(a)} but found ${ds(e)} instead.`}function Vc(a,e){return e.some(o=>o.kind===a.kind)}function Md(a,e){return e.some(o=>o==="null"?a===null:o==="array"?Array.isArray(a):o==="object"?a&&!Array.isArray(a)&&typeof a=="object":o===typeof a)}function Lf(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&Lf(a.itemType,e.itemType):a.kind===e.kind}class Ch{constructor(e,o,u){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class zf{constructor(e,o,u,d,g){this.text=e.normalize?e.normalize():e,this.image=o,this.scale=u,this.fontStack=d,this.textColor=g}}class Ao{constructor(e){this.sections=e}static fromString(e){return new Ao([new zf(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ao?e:Ao.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){const d=o.image.getPrimary().id.toString();e.push(["image",d]);continue}e.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class ic{constructor(e,o={}){if(this.id=_o.from(e),this.options=Object.assign({},o),o.transform){const{a:u,b:d,c:g,d:y,e:T,f:C}=o.transform;this.options.transform=new DOMMatrix([u,d,g,y,T,C])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:o,c:u,d,e:g,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:o,c:u,d,e:g,f:y}})}static parse(e){let o,u,d,g;try{({name:o,iconsetId:u,params:d,transform:g}=JSON.parse(e)||{})}catch{return null}if(!o)return null;const{a:y,b:T,c:C,d:I,e:N,f:O}=g||{};return new ic({name:o,iconsetId:u},{params:d,transform:new DOMMatrix([y,T,C,I,N,O])})}scaleSelf(e,o){return this.options.transform.scaleSelf(e,o),this}}class Uo{constructor(e,o,u,d,g=!1){this.primaryId=_o.from(e),this.primaryOptions=o,u&&(this.secondaryId=_o.from(u)),this.secondaryOptions=d,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ic(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ic(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Uo.build({name:e}):e}static build(e,o,u,d){return!e||typeof e=="object"&&!("name"in e)?null:new Uo(e,u,o,d)}}function Cu(a,e,o,u){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,e,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,e,o,u]:[a,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ar(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ir||a instanceof Ch||a instanceof Ao||a instanceof Uo)return!0;if(Array.isArray(a)){for(const e of a)if(!ar(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!ar(a[e]))return!1;return!0}return!1}function Kt(a){if(a===null)return Th;if(typeof a=="string")return Ur;if(typeof a=="boolean")return Br;if(typeof a=="number")return ln;if(a instanceof Ir)return ra;if(a instanceof Ch)return Of;if(a instanceof Ao)return Eh;if(a instanceof Uo)return Id;if(Array.isArray(a)){const e=a.length;let o;for(const u of a){const d=Kt(u);if(o){if(o===d)continue;o=$r;break}o=d}return Co(o||$r,e)}return rc}function ia(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof Ao||a instanceof Uo||a instanceof Ir?a.toString():JSON.stringify(a)}class Dn{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(e.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ar(e[1]))return o.error("invalid value");const u=e[1];let d=Kt(u);const g=o.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new Dn(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ir?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ao?this.value.serialize():this.value}}class as{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ah={string:Ur,number:ln,boolean:Br,object:rc};class In{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let u,d=1;const g=e[0];if(g==="array"){let T,C;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in Ah)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);T=Ah[I],d++}else T=$r;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=e[2],d++}u=Co(T,C)}else u=Ah[g];const y=[];for(;d<e.length;d++){const T=o.parse(e[d],d,$r);if(!T)return null;y.push(T)}return new In(u,y)}evaluate(e){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(e);if(!Bc(this.type,Kt(u)))return u;if(o===this.args.length-1)throw new as(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ds(Kt(u))} but was expected to be of type ${ds(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if(e.kind==="array"){const u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const d=e.N;(typeof d=="number"||this.args.length>1)&&o.push(d)}}return o.concat(this.args.map(u=>u.serialize()))}}class Au{constructor(e){this.type=Eh,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const d=[];let g=!1;for(let y=1;y<=e.length-1;++y){const T=e[y];if(g&&typeof T=="object"&&!Array.isArray(T)){g=!1;let C=null;if(T["font-scale"]&&(C=o.parseObjectValue(T["font-scale"],y,"font-scale",ln),!C))return null;let I=null;if(T["text-font"]&&(I=o.parseObjectValue(T["text-font"],y,"text-font",Co(Ur)),!I))return null;let N=null;if(T["text-color"]&&(N=o.parseObjectValue(T["text-color"],y,"text-color",ra),!N))return null;const O=d[d.length-1];O.scale=C,O.font=I,O.textColor=N}else{const C=o.parse(e[y],y,$r);if(!C)return null;const I=C.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:C,scale:null,font:null,textColor:null})}}return new Au(d)}evaluate(e){return new Ao(this.sections.map(o=>{const u=o.content.evaluate(e);return Lf(Kt(u),Id)?new zf("",u,null,null,null):new zf(ia(u),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),e.push(u)}return e}}class Iu{constructor(e,o,u,d){this._imageWarnHistory={},this.type=Id,this.namePrimary=e,this.nameSecondary=o,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(e,o){if(e.length<2)return o.error("Expected two or more arguments.");let u=1;const d=[];function g(){if(u<e.length){const T=o.parse(e[u],u++,Ur);return T?(d.push({image:T,options:{}}),!0):(o.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(u<e.length){const C=e[u];if((T=C)===null||typeof T!="object"||Array.isArray(T))return!0;const I=C.params,N=C.iconset,O=o.concat(u);if(!I&&!N)return u++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const L={},V=O.concat(void 0,"params");for(const H in I){if(!H)return V.error("Image parameter name should be non-empty"),!1;const K=V.concat(void 0,H).parse(I[H],void 0,ra,void 0,{typeAnnotation:"coerce"});if(!K)return!1;L[H]=K}d[d.length-1].options.params=L}if(N){if(typeof N!="object"||N.constructor!==Object)return O.error('Image options "iconset" should be an object'),!1;if(!N.id)return O.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=N}return u++,!0}var T;return!0}for(let T=0;T<2;T++)if(!g()||!y())return;return new Iu(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(e,o){const u={};if(o){for(const d in o)if(o[d])try{u[d]=o[d].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){const o={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,d=Uo.build(o,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(d&&e.availableImages){const g=d.getPrimary().id;if(d.available=e.availableImages.some(y=>_o.isEqual(y,g)),d.available){const y=d.getSecondary()?d.getSecondary().id:null;y&&(d.available=e.availableImages.some(T=>_o.isEqual(T,y)))}}return d}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const o in this.paramsPrimary)this.paramsPrimary[o]&&e(this.paramsPrimary[o]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const o in this.paramsSecondary)this.paramsSecondary[o]&&e(this.paramsSecondary[o])}outputDefined(){return!1}serializeOptions(e,o){const u={};if(o&&(u.iconset={id:o}),e){u.params={};for(const d in e)e[d]&&(u.params[d]=e[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const o=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);o&&e.push(o)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const o=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);o&&e.push(o)}return e}}function sc(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const Mu={"to-boolean":Br,"to-color":ra,"to-number":ln,"to-string":Ur};class Ya{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const u=e[0],d=[];let g=Th;if(u==="to-array"){if(!Array.isArray(e[1]))return null;const y=e[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);g=Co(o.expectedType.itemType,y)}else{if(!(y>0&&ar(e[1][0])))return null;g=Co(Kt(e[1][0]),y)}for(let T=0;T<y;T++){const C=e[1][T];let I;if(sc(C)==="array")I=o.parse(C,void 0,g.itemType);else{const N=sc(C);if(N!==g.itemType.kind)return o.error(`Expected ${g.itemType.kind} but found ${N}.`);I=o.registry.literal.parse(["literal",C===void 0?null:C],o)}if(!I)return null;d.push(I)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return o.error("Expected one argument.");g=Mu[u];for(let y=1;y<e.length;y++){const T=o.parse(e[y],y,$r);if(!T)return null;d.push(T)}}return new Ya(g,d)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let o,u;for(const d of this.args){if(o=d.evaluate(e),u=null,o instanceof Ir)return o;if(typeof o=="string"){const g=e.parseColor(o);if(g)return g}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Cu(o[0],o[1],o[2],o[3]),!u))return new Ir(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new as(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(e),o===null)return 0;const d=Number(o);if(!isNaN(d))return d}throw new as(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?Ao.fromString(ia(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Uo.build(ia(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(o=>o.evaluate(e)):ia(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Au([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Iu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}const Io=["Unknown","Point","LineString","Polygon"];class kd{constructor(e,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-e[0])+this.featureDistanceData.bearing[1]*(d*o-e[1])}return 0}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=Ir.parse(e)),o}getConfig(e){return this.options?this.options.get(e):null}}class Ms{constructor(e,o,u,d,g){this.name=e,this.type=o,this._evaluate=u,this.args=d,this._overloadIndex=g}evaluate(e){if(!this._evaluate){const o=Ms.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const u=e[0],d=Ms.definitions[u];if(!d)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,T=[];let C=null,I=-1;for(const[N,O]of y){if(Array.isArray(N)&&N.length!==e.length-1)continue;T.push(N),I++,C=new Lh(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const L=[];let V=!1;for(let H=1;H<e.length;H++){const K=e[H],te=Array.isArray(N)?N[H-1]:N.type,ae=C.parse(K,1+L.length,te);if(!ae){V=!0;break}L.push(ae)}if(!V)if(Array.isArray(N)&&N.length!==L.length)C.error(`Expected ${N.length} arguments, but found ${L.length} instead.`);else{for(let H=0;H<L.length;H++){const K=Array.isArray(N)?N[H]:N.type,te=L[H];C.concat(H+1).checkSubtype(K,te.type)}if(C.errors.length===0)return new Ms(u,g,O,L,I)}}if(T.length===1)o.errors.push(...C.errors);else{const N=(T.length?T:y.map(([L])=>L)).map(jf).join(" | "),O=[];for(let L=1;L<e.length;L++){const V=o.parse(e[L],1+O.length);if(!V)return null;O.push(ds(V.type))}o.error(`Expected arguments of type ${N}, but found (${O.join(", ")}) instead.`)}return null}static register(e,o){Ms.definitions=o;for(const u in o)e[u]=Ms}}function jf(a){return Array.isArray(a)?`(${a.map(ds).join(", ")})`:`(${ds(a.type)}...)`}class sa{constructor(e,o,u){this.type=Of,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(e.length!==2)return o.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?o.parse(!1,1,Br):o.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Br);if(!d)return null;const g=u["diacritic-sensitive"]===void 0?o.parse(!1,1,Br):o.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Br);if(!g)return null;let y=null;return u.locale&&(y=o.parseObjectValue(u.locale,1,"locale",Ur),!y)?null:new sa(d,g,y)}evaluate(e){return new Ch(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ks(a,e,o=0,u=a.length-1,d=Ff){for(;u>o;){if(u-o>600){const C=u-o+1,I=e-o+1,N=Math.log(C),O=.5*Math.exp(2*N/3),L=.5*Math.sqrt(N*O*(C-O)/C)*(I-C/2<0?-1:1);ks(a,e,Math.max(o,Math.floor(e-I*O/C+L)),Math.min(u,Math.floor(e+(C-I)*O/C+L)),d)}const g=a[e];let y=o,T=u;for(Pd(a,o,e),d(a[u],g)>0&&Pd(a,o,u);y<T;){for(Pd(a,y,T),y++,T--;d(a[y],g)<0;)y++;for(;d(a[T],g)>0;)T--}d(a[o],g)===0?Pd(a,o,T):(T++,Pd(a,T,u)),T<=e&&(o=T+1),e<=T&&(u=T-1)}}function Pd(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}function Ff(a,e){return a<e?-1:a>e?1:0}function qy(a){let e=0;for(let o,u,d=0,g=a.length,y=g-1;d<g;y=d++)o=a[d],u=a[y],e+=(u.x-o.x)*(o.y+u.y);return e}function oc(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function Uc(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function ac(a,e,o){const u=a[0]-e[0],d=a[1]-e[1],g=a[0]-o[0],y=a[1]-o[1];return u*y-g*d==0&&u*g<=0&&d*y<=0}function ku(a,e,o=!1){let u=!1;for(let T=0,C=e.length;T<C;T++){const I=e[T];for(let N=0,O=I.length,L=O-1;N<O;L=N++){const V=I[L],H=I[N];if(ac(a,V,H))return o;(g=V)[1]>(d=a)[1]!=(y=H)[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(u=!u)}}var d,g,y;return u}function gm(a,e,o,u){const d=u[0]-o[0],g=u[1]-o[1],y=(a[0]-o[0])*g-d*(a[1]-o[1]),T=(e[0]-o[0])*g-d*(e[1]-o[1]);return y>0&&T<0||y<0&&T>0}function Rd(a,e,o,u){return(d=[u[0]-o[0],u[1]-o[1]])[0]*(g=[e[0]-a[0],e[1]-a[1]])[1]-d[1]*g[0]!=0&&!(!gm(a,e,o,u)||!gm(o,u,a,e));var d,g}function ym(a){const e=new Ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=new Ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),o.x<u.x&&(o.x=u.x),o.y<u.y&&(o.y=u.y);return{min:e,max:o}}const lc=8192;function Wy(a,e){const o=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(o*d*lc),Math.round(u*d*lc)]}function Zy(a,e){for(let o=0;o<e.length;o++)if(ku(a,e[o]))return!0;return!1}function Mg(a,e,o){for(const u of o)for(let d=0,g=u.length,y=g-1;d<g;y=d++)if(Rd(a,e,u[y],u[d]))return!0;return!1}function Ja(a,e){for(let o=0;o<a.length;++o)if(!ku(a[o],e))return!1;for(let o=0;o<a.length-1;++o)if(Mg(a[o],a[o+1],e))return!1;return!0}function ul(a,e){for(let o=0;o<e.length;o++)if(Ja(a,e[o]))return!0;return!1}function Bf(a,e,o){const u=[];for(let d=0;d<a.length;d++){const g=[];for(let y=0;y<a[d].length;y++){const T=Wy(a[d][y],o);oc(e,T),g.push(T)}u.push(g)}return u}function _m(a,e,o){const u=[];for(let d=0;d<a.length;d++){const g=Bf(a[d],e,o);u.push(g)}return u}function Nd(a,e,o,u){if(a[0]<o[0]||a[0]>o[2]){const d=.5*u;let g=a[0]-o[0]>d?-u:o[0]-a[0]>d?u:0;g===0&&(g=a[0]-o[2]>d?-u:o[2]-a[0]>d?u:0),a[0]+=g}oc(e,a)}function Vf(a,e,o,u){const d=Math.pow(2,u.z)*lc,g=[u.x*lc,u.y*lc],y=[];if(!a)return y;for(const T of a)for(const C of T){const I=[C.x+g[0],C.y+g[1]];Nd(I,e,o,d),y.push(I)}return y}function Dd(a,e,o,u){const d=Math.pow(2,u.z)*lc,g=[u.x*lc,u.y*lc],y=[];if(!a)return y;for(const C of a){const I=[];for(const N of C){const O=[N.x+g[0],N.y+g[1]];oc(e,O),I.push(O)}y.push(I)}if(e[2]-e[0]<=d/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of y)for(const I of C)Nd(I,e,o,d)}var T;return y}class xo{constructor(e,o){this.type=Br,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ar(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const g=u.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new xo(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new xo(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xo(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(o,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const T=Bf(u.coordinates,g,y),C=Vf(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!ku(I,T))return!1}if(u.type==="MultiPolygon"){const T=_m(u.coordinates,g,y),C=Vf(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!Zy(I,T))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(o,u){const d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=o.canonicalID();if(!y)return!1;if(u.type==="Polygon"){const T=Bf(u.coordinates,g,y),C=Dd(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!Ja(I,T))return!1}if(u.type==="MultiPolygon"){const T=_m(u.coordinates,g,y),C=Dd(o.geometry(),d,g,y);if(!Uc(d,g))return!1;for(const I of C)if(!ul(I,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Od={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$c=1/298.257223563,Ld=$c*(2-$c),Il=Math.PI/180;class Hc{static fromTile(e,o,u){const d=Math.PI*(1-2*(e+.5)/Math.pow(2,o)),g=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/Il;return new Hc(g,u)}static get units(){return Od}constructor(e,o){if(e===void 0)throw new Error("No latitude given.");if(o&&!Od[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Od).join(", ")}`);const u=6378.137*Il*(o?Od[o]:1),d=Math.cos(e*Il),g=1/(1-Ld*(1-d*d)),y=Math.sqrt(g);this.kx=u*y*d,this.ky=u*y*g*(1-Ld)}distance(e,o){const u=ro(e[0]-o[0])*this.kx,d=(e[1]-o[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(e,o){const u=ro(o[0]-e[0])*this.kx;return Math.atan2(u,(o[1]-e[1])*this.ky)/Il}destination(e,o,u){const d=u*Il;return this.offset(e,Math.sin(d)*o,Math.cos(d)*o)}offset(e,o,u){return[e[0]+o/this.kx,e[1]+u/this.ky]}lineDistance(e){let o=0;for(let u=0;u<e.length-1;u++)o+=this.distance(e[u],e[u+1]);return o}area(e){let o=0;for(let u=0;u<e.length;u++){const d=e[u];for(let g=0,y=d.length,T=y-1;g<y;T=g++)o+=ro(d[g][0]-d[T][0])*(d[g][1]+d[T][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(e,o){let u=0;if(o<=0)return e[0];for(let d=0;d<e.length-1;d++){const g=e[d],y=e[d+1],T=this.distance(g,y);if(u+=T,u>o)return Pu(g,y,(o-(u-T))/T)}return e[e.length-1]}pointToSegmentDistance(e,o,u){let[d,g]=o,y=ro(u[0]-d)*this.kx,T=(u[1]-g)*this.ky;if(y!==0||T!==0){const C=(ro(e[0]-d)*this.kx*y+(e[1]-g)*this.ky*T)/(y*y+T*T);C>1?(d=u[0],g=u[1]):C>0&&(d+=y/this.kx*C,g+=T/this.ky*C)}return y=ro(e[0]-d)*this.kx,T=(e[1]-g)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(e,o){let u=1/0,d=e[0][0],g=e[0][1],y=0,T=0;for(let C=0;C<e.length-1;C++){let I=e[C][0],N=e[C][1],O=ro(e[C+1][0]-I)*this.kx,L=(e[C+1][1]-N)*this.ky,V=0;O===0&&L===0||(V=(ro(o[0]-I)*this.kx*O+(o[1]-N)*this.ky*L)/(O*O+L*L),V>1?(I=e[C+1][0],N=e[C+1][1]):V>0&&(I+=O/this.kx*V,N+=L/this.ky*V)),O=ro(o[0]-I)*this.kx,L=(o[1]-N)*this.ky;const H=O*O+L*L;H<u&&(u=H,d=I,g=N,y=C,T=V)}return{point:[d,g],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(e,o,u){let d=this.pointOnLine(u,e),g=this.pointOnLine(u,o);if(d.index>g.index||d.index===g.index&&d.t>g.t){const I=d;d=g,g=I}const y=[d.point],T=d.index+1,C=g.index;!Uf(u[T],y[0])&&T<=C&&y.push(u[T]);for(let I=T+1;I<=C;I++)y.push(u[I]);return Uf(u[C],g.point)||y.push(g.point),y}lineSliceAlong(e,o,u){let d=0;const g=[];for(let y=0;y<u.length-1;y++){const T=u[y],C=u[y+1],I=this.distance(T,C);if(d+=I,d>e&&g.length===0&&g.push(Pu(T,C,(e-(d-I))/I)),d>=o)return g.push(Pu(T,C,(o-(d-I))/I)),g;d>e&&g.push(C)}return g}bufferPoint(e,o){const u=o/this.ky,d=o/this.kx;return[e[0]-d,e[1]-u,e[0]+d,e[1]+u]}bufferBBox(e,o){const u=o/this.ky,d=o/this.kx;return[e[0]-d,e[1]-u,e[2]+d,e[3]+u]}insideBBox(e,o){return ro(e[0]-o[0])>=0&&ro(e[0]-o[2])<=0&&e[1]>=o[1]&&e[1]<=o[3]}}function Uf(a,e){return a[0]===e[0]&&a[1]===e[1]}function Pu(a,e,o){const u=ro(e[0]-a[0]);return[a[0]+u*o,a[1]+(e[1]-a[1])*o]}function ro(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Ih{constructor(e=[],o=(u,d)=>u<d?-1:u>d?1:0){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:u}=this,d=o[e];for(;e>0;){const g=e-1>>1,y=o[g];if(u(d,y)>=0)break;o[e]=y,e=g}o[e]=d}_down(e){const{data:o,compare:u}=this,d=this.length>>1,g=o[e];for(;e<d;){let y=1+(e<<1);const T=y+1;if(T<this.length&&u(o[T],o[y])<0&&(y=T),u(o[y],g)>=0)break;o[e]=o[y],e=y}o[e]=g}}var jt=8192;function Mh(a,e){return e.dist-a.dist}const Ru=100,Nu=50;function kh(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let o=0;o<e.length;o++)if(e[o]!==a[o])return!1;return!0}function Ph(a){return a[1]-a[0]+1}function hl(a,e){const o=a[1]>=a[0]&&a[1]<e;return o||console.warn("Distance Expression: Index is out of range"),o}function zd(a,e){if(a[0]>a[1])return[null,null];const o=Ph(a);if(e){if(o===2)return[a,null];const u=Math.floor(o/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(o===1)return[a,null];const u=Math.floor(o/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function Ws(a,e){const o=[1/0,1/0,-1/0,-1/0];if(!hl(e,a.length))return o;for(let u=e[0];u<=e[1];++u)oc(o,a[u]);return o}function fr(a){const e=[1/0,1/0,-1/0,-1/0];for(let o=0;o<a.length;++o)for(let u=0;u<a[o].length;++u)oc(e,a[o][u]);return e}function Gc(a,e,o){if(kh(a)||kh(e))return NaN;let u=0,d=0;return a[2]<e[0]&&(u=e[0]-a[2]),a[0]>e[2]&&(u=a[0]-e[2]),a[1]>e[3]&&(d=a[1]-e[3]),a[3]<e[1]&&(d=e[1]-a[3]),o.distance([0,0],[u,d])}function Xy(a){return 360*a-180}function Ky(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function qc(a,e){const o=Math.pow(2,e.z),u=(a.y/jt+e.y)/o;return[Xy((a.x/jt+e.x)/o),Ky(u)]}function Yy(a,e){const o=[];for(let u=0;u<a.length;++u)o.push(qc(a[u],e));return o}function Ni(a,e,o){const u=o.pointOnLine(e,a).point;return o.distance(a,u)}function xm(a,e,o,u,d){const g=o.slice(u[0],u[1]+1);let y=1/0;for(let T=e[0];T<=e[1];++T)if((y=Math.min(y,Ni(a[T],g,d)))===0)return 0;return y}function es(a,e,o,u,d){const g=Math.min(d.pointToSegmentDistance(a,o,u),d.pointToSegmentDistance(e,o,u)),y=Math.min(d.pointToSegmentDistance(o,a,e),d.pointToSegmentDistance(u,a,e));return Math.min(g,y)}function vm(a,e,o,u,d){if(!hl(e,a.length)||!hl(u,o.length))return NaN;let g=1/0;for(let y=e[0];y<e[1];++y)for(let T=u[0];T<u[1];++T){if(Rd(a[y],a[y+1],o[T],o[T+1]))return 0;g=Math.min(g,es(a[y],a[y+1],o[T],o[T+1],d))}return g}function $f(a,e,o,u,d){if(!hl(e,a.length)||!hl(u,o.length))return NaN;let g=1/0;for(let y=e[0];y<=e[1];++y)for(let T=u[0];T<=u[1];++T)if((g=Math.min(g,d.distance(a[y],o[T])))===0)return g;return g}function jd(a,e,o){if(ku(a,e,!0))return 0;let u=1/0;for(const d of e){const g=d.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[g-1]&&(u=Math.min(u,o.pointToSegmentDistance(a,d[g-1],d[0])))===0||(u=Math.min(u,Ni(a,d,o)))===0)return u}return u}function kg(a,e,o,u){if(!hl(e,a.length))return NaN;for(let g=e[0];g<=e[1];++g)if(ku(a[g],o,!0))return 0;let d=1/0;for(let g=e[0];g<e[1];++g)for(const y of o)for(let T=0,C=y.length,I=C-1;T<C;I=T++){if(Rd(a[g],a[g+1],y[I],y[T]))return 0;d=Math.min(d,es(a[g],a[g+1],y[I],y[T],u))}return d}function Hf(a,e){for(const o of a)for(let u=0;u<=o.length-1;++u)if(ku(o[u],e,!0))return!0;return!1}function Fd(a,e,o,u=1/0){const d=fr(a),g=fr(e);if(u!==1/0&&Gc(d,g,o)>=u)return u;if(Uc(d,g)){if(Hf(a,e))return 0}else if(Hf(e,a))return 0;let y=u;for(const T of a)for(let C=0,I=T.length,N=I-1;C<I;N=C++)for(const O of e)for(let L=0,V=O.length,H=V-1;L<V;H=L++){if(Rd(T[N],T[C],O[H],O[L]))return 0;y=Math.min(y,es(T[N],T[C],O[H],O[L],o))}return y}function Du(a,e,o,u,d,g,y){if(g===null||y===null)return;const T=Gc(Ws(u,g),Ws(d,y),o);T<e&&a.push({dist:T,range1:g,range2:y})}function Rh(a,e,o,u,d=1/0){let g=Math.min(u.distance(a[0],o[0][0]),d);if(g===0)return g;const y=new Ih([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Mh),T=e?Nu:Ru,C=fr(o);for(;y.length;){const I=y.pop();if(I.dist>=g)continue;const N=I.range1;if(Ph(N)<=T){if(!hl(N,a.length))return NaN;if(e){const O=kg(a,N,o,u);if((g=Math.min(g,O))===0)return g}else for(let O=N[0];O<=N[1];++O){const L=jd(a[O],o,u);if((g=Math.min(g,L))===0)return g}}else{const O=zd(N,e);if(O[0]!==null){const L=Gc(Ws(a,O[0]),C,u);L<g&&y.push({dist:L,range1:O[0],range2:[0,0]})}if(O[1]!==null){const L=Gc(Ws(a,O[1]),C,u);L<g&&y.push({dist:L,range1:O[1],range2:[0,0]})}}}return g}function bm(a,e,o,u,d,g=1/0){let y=Math.min(g,d.distance(a[0],o[0]));if(y===0)return y;const T=new Ih([{dist:0,range1:[0,a.length-1],range2:[0,o.length-1]}],Mh),C=e?Nu:Ru,I=u?Nu:Ru;for(;T.length;){const N=T.pop();if(N.dist>=y)continue;const O=N.range1,L=N.range2;if(Ph(O)<=C&&Ph(L)<=I){if(!hl(O,a.length)||!hl(L,o.length))return NaN;if(e&&u?y=Math.min(y,vm(a,O,o,L,d)):e||u?e&&!u?y=Math.min(y,xm(o,L,a,O,d)):!e&&u&&(y=Math.min(y,xm(a,O,o,L,d))):y=Math.min(y,$f(a,O,o,L,d)),y===0)return y}else{const V=zd(O,e),H=zd(L,u);Du(T,y,d,a,o,V[0],H[0]),Du(T,y,d,a,o,V[0],H[1]),Du(T,y,d,a,o,V[1],H[0]),Du(T,y,d,a,o,V[1],H[1])}}return y}function wm(a,e,o,u,d=1/0){let g=d;const y=Ws(a,[0,a.length-1]);for(const T of o)if(!(g!==1/0&&Gc(y,Ws(T,[0,T.length-1]),u)>=g)&&(g=Math.min(g,bm(a,e,T,!0,u,g)),g===0))return g;return g}function Gf(a,e,o,u,d=1/0){let g=d;const y=Ws(a,[0,a.length-1]);for(const T of o){if(g!==1/0&&Gc(y,fr(T),u)>=g)continue;const C=Rh(a,e,T,u,g);if(isNaN(C))return C;if((g=Math.min(g,C))===0)return g}return g}function qf(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class Ml{constructor(e,o){this.type=ln,this.geojson=e,this.geometries=o}static parse(e,o){if(e.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ar(e[1])){const u=e[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(qf(u.features[d].geometry.type))return new Ml(u,u.features[d].geometry)}else if(u.type==="Feature"){if(qf(u.geometry.type))return new Ml(u,u.geometry)}else if(qf(u.type))return new Ml(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const o=e.geometry(),u=e.canonicalID();if(o!=null&&u!=null){if(e.geometryType()==="Point")return function(d,g,y){const T=[];for(const I of d)for(const N of I)T.push(qc(N,g));const C=new Hc(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?bm(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",C):y.type==="MultiLineString"?wm(T,!1,y.coordinates,C):y.type==="Polygon"||y.type==="MultiPolygon"?Gf(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,C):null}(o,u,this.geometries);if(e.geometryType()==="LineString")return function(d,g,y){const T=[];for(const I of d){const N=[];for(const O of I)N.push(qc(O,g));T.push(N)}const C=new Hc(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return wm(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let I=1/0;for(let N=0;N<y.coordinates.length;N++){const O=wm(y.coordinates[N],!0,T,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}if(y.type==="Polygon"||y.type==="MultiPolygon"){let I=1/0;for(let N=0;N<T.length;N++){const O=Gf(T[N],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}return null}(o,u,this.geometries);if(e.geometryType()==="Polygon")return function(d,g,y){const T=[];for(const I of function(N,O){const L=N.length;if(L<=1)return[N];const V=[];let H,K;for(let te=0;te<L;te++){const ae=qy(N[te]);ae!==0&&(N[te].area=Math.abs(ae),K===void 0&&(K=ae<0),K===ae<0?(H&&V.push(H),H=[N[te]]):H.push(N[te]))}return H&&V.push(H),V}(d)){const N=[];for(let O=0;O<I.length;++O)N.push(Yy(I[O],g));T.push(N)}const C=new Hc(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Gf(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let I=1/0;for(let N=0;N<y.coordinates.length;N++){const O=Gf(y.coordinates[N],!0,T,C,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}return y.type==="Polygon"||y.type==="MultiPolygon"?function(I,N,O){let L=1/0;for(const V of I)for(const H of N){const K=Fd(V,H,O,L);if(isNaN(K))return K;if((L=Math.min(L,K))===0)return L}return L}(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,C):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function cc(a){if(a instanceof Ms&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof xo||a instanceof Ml)return!1;if(a instanceof Oh)return a.featureConstant;let e=!0;return a.eachChild(o=>{e&&!cc(o)&&(e=!1)}),e}function Nh(a){if(a instanceof Ms&&a.name==="feature-state")return!1;let e=!0;return a.eachChild(o=>{e&&!Nh(o)&&(e=!1)}),e}function Dh(a){if(a instanceof Oh)return new Set([a.key]);let e=new Set;return a.eachChild(o=>{e=new Set([...e,...Dh(o)])}),e}function Wc(a,e){if(a instanceof Ms&&e.indexOf(a.name)>=0)return!1;let o=!0;return a.eachChild(u=>{o&&!Wc(u,e)&&(o=!1)}),o}function Wf(a,e,o){return[a,e,o].filter(Boolean).join("")}function Sm(a,e){switch(a){case"string":return ia(e);case"number":return+e;case"boolean":return!!e;case"color":return Ir.parse(e);case"formatted":return Ao.fromString(ia(e));case"resolvedImage":return Uo.build(ia(e))}return e}function Tm(a,e,o,u){return u!==void 0&&(a=u*Math.round(a/u)),e!==void 0&&a<e&&(a=e),o!==void 0&&a>o&&(a=o),a}class Oh{constructor(e,o,u,d=!1){this.type=e,this.key=o,this.scope=u,this.featureConstant=d}static parse(e,o){let u=o.expectedType;if(u==null&&(u=$r),e.length<2||e.length>3)return o.error("Invalid number of arguments for 'config' expression.");const d=o.parse(e[1],1);if(!(d instanceof Dn))return o.error("Key name of 'config' expression must be a string literal.");let g,y=!0;const T=ia(d.value);if(e.length>=3){const C=o.parse(e[2],2);if(!(C instanceof Dn))return o.error("Scope of 'config' expression must be a string literal.");g=ia(C.value)}if(o.options){const C=Wf(T,g,o._scope),I=o.options.get(C);I&&(y=cc(I.value||I.default))}return new Oh(u,T,g,y)}evaluate(e){const o=Wf(this.key,this.scope,e.scope),u=e.getConfig(o);if(!u)return null;const{type:d,value:g,values:y,minValue:T,maxValue:C,stepValue:I}=u,N=u.default.evaluate(e);let O=N;if(g){const L=e.scope;e.scope=(L||"").split("").slice(1).join(""),O=g.evaluate(e),e.scope=L}return d&&(O=Sm(d,O)),O===void 0||T===void 0&&C===void 0&&I===void 0||(typeof O=="number"?O=Tm(O,T,C,I):Array.isArray(O)&&(O=O.map(L=>typeof L=="number"?Tm(L,T,C,I):L))),g!==void 0&&O!==void 0&&y&&!y.includes(O)&&(O=N,d&&(O=Sm(d,O))),(d&&d!==this.type||O!==void 0&&!Lf(Kt(O),this.type))&&(O=Sm(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Zf{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(e.length!==2||typeof e[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=e[1];return o.scope.has(u)?new Zf(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lh{constructor(e,o=[],u,d=new mm,g=[],y,T){this.registry=e,this.path=o,this.key=o.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=d,this.errors=g,this.expectedType=u,this._scope=y,this.options=T}parse(e,o,u,d,g={}){return o||u?this.concat(o,null,u,d)._parse(e,g):this._parse(e,g)}parseObjectValue(e,o,u,d,g,y={}){return this.concat(o,u,d,g)._parse(e,y)}_parse(e,o){function u(d,g,y){return y==="assert"?new In(g,[d]):y==="coerce"?new Ya(g,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(d){let g=d.parse(e,this);if(!g)return null;if(this.expectedType){const y=this.expectedType,T=g.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else g=u(g,y,o.typeAnnotation||"coerce");else g=u(g,y,o.typeAnnotation||"assert")}if(!(g instanceof Dn)&&g.type.kind!=="resolvedImage"&&kl(g)){const y=new kd(this._scope,this.options);try{g=new Dn(g.type,g.evaluate(y))}catch(T){return this.error(T.message),null}}return g}return Ya.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,u,d){let g=typeof e=="number"?this.path.concat(e):this.path;g=typeof o=="string"?g.concat(o):g;const y=d?this.scope.concat(d):this.scope;return new Lh(this.registry,g,u||null,y,this.errors,this._scope,this.options)}error(e,...o){const u=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new na(u,e))}checkSubtype(e,o){const u=Bc(e,o);return u&&this.error(u),u}}function kl(a){if(a instanceof Zf)return kl(a.boundExpression);if(a instanceof Ms&&a.name==="error"||a instanceof sa||a instanceof xo||a instanceof Ml||a instanceof Oh)return!1;const e=a instanceof Ya||a instanceof In;let o=!0;return a.eachChild(u=>{o=e?o&&kl(u):o&&u instanceof Dn}),!!o&&cc(a)&&Wc(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Bd(a,e){const o=a.length-1;let u,d,g=0,y=o,T=0;for(;g<=y;)if(T=Math.floor((g+y)/2),u=a[T],d=a[T+1],u<=e){if(T===o||e<d)return T;g=T+1}else{if(!(u>e))throw new as("Input is not a number.");y=T-1}return 0}class Pl{constructor(e,o,u){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[d,g]of u)this.labels.push(d),this.outputs.push(g)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(e[1],1,ln);if(!u)return null;const d=[];let g=null;o.expectedType&&o.expectedType.kind!=="value"&&(g=o.expectedType);for(let y=1;y<e.length;y+=2){const T=y===1?-1/0:e[y],C=e[y+1],I=y,N=y+1;if(typeof T!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(d.length&&d[d.length-1][0]>=T)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=o.parse(C,N,g);if(!O)return null;g=g||O.type,d.push([T,O])}return new Pl(g,u,d)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return u[0].evaluate(e);const g=o.length;return d>=o[g-1]?u[g-1].evaluate(e):u[Bd(o,d)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}const dl=.95047,zh=1.08883,Rl=4/29,Nl=6/29,Pg=3*Nl*Nl,Rg=Nl*Nl*Nl,Ou=Math.PI/180,Vd=180/Math.PI;function Zc(a){return a>Rg?Math.pow(a,1/3):a/Pg+Rl}function Lu(a){return a>Nl?a*a*a:Pg*(a-Rl)}function jh(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ka(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Dl(a){const e=ka(a.r),o=ka(a.g),u=ka(a.b),d=Zc((.4124564*e+.3575761*o+.1804375*u)/dl),g=Zc((.2126729*e+.7151522*o+.072175*u)/1);return{l:116*g-16,a:500*(d-g),b:200*(g-Zc((.0193339*e+.119192*o+.9503041*u)/zh)),alpha:a.a}}function ts(a){let e=(a.l+16)/116,o=isNaN(a.a)?e:e+a.a/500,u=isNaN(a.b)?e:e-a.b/200;return e=1*Lu(e),o=dl*Lu(o),u=zh*Lu(u),new Ir(jh(3.2404542*o-1.5371385*e-.4985314*u),jh(-.969266*o+1.8760108*e+.041556*u),jh(.0556434*o-.2040259*e+1.0572252*u),a.alpha)}function ns(a,e,o){const u=e-a;return a+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const oa={forward:Dl,reverse:ts,interpolate:function(a,e,o){return{l:Mn(a.l,e.l,o),a:Mn(a.a,e.a,o),b:Mn(a.b,e.b,o),alpha:Mn(a.alpha,e.alpha,o)}}},bs={forward:function(a){const{l:e,a:o,b:u}=Dl(a),d=Math.atan2(u,o)*Vd;return{h:d<0?d+360:d,c:Math.sqrt(o*o+u*u),l:e,alpha:a.a}},reverse:function(a){const e=a.h*Ou,o=a.c;return ts({l:a.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:a.alpha})},interpolate:function(a,e,o){return{h:ns(a.h,e.h,o),c:Mn(a.c,e.c,o),l:Mn(a.l,e.l,o),alpha:Mn(a.alpha,e.alpha,o)}}};var $o=Object.freeze({__proto__:null,hcl:bs,lab:oa});class Zs{constructor(e,o,u,d,g){this.type=e,this.operator=o,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[y,T]of g)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(e,o,u,d){let g=0;if(e.name==="exponential")g=uc(o,e.base,u,d);else if(e.name==="linear")g=uc(o,1,u,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;g=new Ha(y[0],y[1],y[2],y[3]).solve(uc(o,1,u,d))}return g}static parse(e,o){let[u,d,g,...y]=e;if(!Array.isArray(d)||d.length===0)return o.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const I=d[1];if(typeof I!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:I}}else{if(d[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const I=d.slice(1);if(I.length!==4||I.some(N=>typeof N!="number"||N<0||N>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(g=o.parse(g,2,ln),!g)return null;const T=[];let C=null;u==="interpolate-hcl"||u==="interpolate-lab"?C=ra:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let I=0;I<y.length;I+=2){const N=y[I],O=y[I+1],L=I+3,V=I+4;if(typeof N!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(T.length&&T[T.length-1][0]>=N)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const H=o.parse(O,V,C);if(!H)return null;C=C||H.type,T.push([N,H])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Zs(C,u,d,g,T):o.error(`Type ${ds(C)} is not interpolatable.`)}evaluate(e){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return u[0].evaluate(e);const g=o.length;if(d>=o[g-1])return u[g-1].evaluate(e);const y=Bd(o,d),T=Zs.interpolationFactor(this.interpolation,d,o[y],o[y+1]),C=u[y].evaluate(e),I=u[y+1].evaluate(e);return this.operator==="interpolate"?nc[this.type.kind.toLowerCase()](C,I,T):this.operator==="interpolate-hcl"?bs.reverse(bs.interpolate(bs.forward(C),bs.forward(I),T)):oa.reverse(oa.interpolate(oa.forward(C),oa.forward(I),T))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const o=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function uc(a,e,o,u){const d=u-o,g=a-o;return d===0?0:e===1?g/d:(Math.pow(e,g)-1)/(Math.pow(e,d)-1)}class io{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let u=null;const d=o.expectedType;d&&d.kind!=="value"&&(u=d);const g=[];for(const T of e.slice(1)){const C=o.parse(T,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!C)return null;u=u||C.type,g.push(C)}const y=d&&g.some(T=>Bc(d,T.type));return new io(y?$r:u,g)}evaluate(e){let o,u=null,d=0;for(const g of this.args){if(d++,u=g.evaluate(e),u&&u instanceof Uo&&!u.available&&(o||(o=u),u=null,d===this.args.length))return o;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class zu{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if(typeof y!="string")return o.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",g);const T=o.parse(e[g+1],g+1);if(!T)return null;u.push([y,T])}const d=o.parse(e[e.length-1],e.length-1,o.expectedType,u);return d?new zu(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,u]of this.bindings)e.push(o,u.serialize());return e.push(this.result.serialize()),e}}class Xf{constructor(e,o,u){this.type=e,this.index=o,this.input=u}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,ln),d=o.parse(e[2],2,Co(o.expectedType||$r));return u&&d?new Xf(d.type.itemType,u,d):null}evaluate(e){const o=this.index.evaluate(e),u=this.input.evaluate(e);if(o<0)throw new as(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new as(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new as(`Array index must be an integer, but found ${o} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kf{constructor(e,o,u){this.type=e,this.index=o,this.input=u}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,ln),d=o.parse(e[2],2,Co(o.expectedType||$r));return u&&d?new Kf(d.type.itemType,u,d):null}evaluate(e){const o=this.index.evaluate(e),u=this.input.evaluate(e);if(o<0)throw new as(`Array index out of bounds: ${o} < 0.`);if(o>u.length-1)throw new as(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o===Math.floor(o))return u[o];const d=Math.floor(o),g=Math.ceil(o),y=u[d],T=u[g];if(typeof y!="number"||typeof T!="number")throw new as(`Cannot interpolate between non-number values at index ${o}.`);const C=o-d;return y*(1-C)+T*C}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ju{constructor(e,o){this.type=Br,this.needle=e,this.haystack=o}static parse(e,o){if(e.length!==3)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$r),d=o.parse(e[2],2,$r);return u&&d?Vc(u.type,[Br,Ur,ln,Th,$r])?new ju(u,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ds(u.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!Md(o,["boolean","string","number","null"]))throw new as(`Expected first argument to be of type boolean, string, number or null, but found ${ds(Kt(o))} instead.`);if(!Md(u,["string","array"]))throw new as(`Expected second argument to be of type array or string, but found ${ds(Kt(u))} instead.`);return u.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Fh{constructor(e,o,u){this.type=ln,this.needle=e,this.haystack=o,this.fromIndex=u}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$r),d=o.parse(e[2],2,$r);if(!u||!d)return null;if(!Vc(u.type,[Br,Ur,ln,Th,$r]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ds(u.type)} instead`);if(e.length===4){const g=o.parse(e[3],3,ln);return g?new Fh(u,d,g):null}return new Fh(u,d)}evaluate(e){const o=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Md(o,["boolean","string","number","null"]))throw new as(`Expected first argument to be of type boolean, string, number or null, but found ${ds(Kt(o))} instead.`);if(!Md(u,["string","array"]))throw new as(`Expected second argument to be of type array or string, but found ${ds(Kt(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return u.indexOf(o,d)}return u.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class aa{constructor(e,o,u,d,g,y){this.inputType=e,this.type=o,this.input=u,this.cases=d,this.outputs=g,this.otherwise=y}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let u,d;o.expectedType&&o.expectedType.kind!=="value"&&(d=o.expectedType);const g={},y=[];for(let I=2;I<e.length-1;I+=2){let N=e[I];const O=e[I+1];Array.isArray(N)||(N=[N]);const L=o.concat(I);if(N.length===0)return L.error("Expected at least one branch label.");for(const H of N){if(typeof H!="number"&&typeof H!="string")return L.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,Kt(H)))return null}else u=Kt(H);if(g[String(H)]!==void 0)return L.error("Branch labels must be unique.");g[String(H)]=y.length}const V=o.parse(O,I,d);if(!V)return null;d=d||V.type,y.push(V)}const T=o.parse(e[1],1,$r);if(!T)return null;const C=o.parse(e[e.length-1],e.length-1,d);return C?T.type.kind!=="value"&&o.concat(1).checkSubtype(u,T.type)?null:new aa(u,d,T,g,y,C):null}evaluate(e){const o=this.input.evaluate(e);return(Lf(Kt(o),this.inputType)&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],d={};for(const y of o){const T=d[this.cases[y]];T===void 0?(d[this.cases[y]]=u.length,u.push([this.cases[y],[y]])):u[T][1].push(y)}const g=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of u)e.push(T.length===1?g(T[0]):T.map(g)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}class Bh{constructor(e,o,u){this.type=e,this.branches=o,this.otherwise=u}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const T=o.parse(e[y],y,Br);if(!T)return null;const C=o.parse(e[y+1],y+1,u);if(!C)return null;d.push([T,C]),u=u||C.type}const g=o.parse(e[e.length-1],e.length-1,u);return g?new Bh(u,d,g):null}evaluate(e){for(const[o,u]of this.branches)if(o.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,u]of this.branches)e(o),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class Fu{constructor(e,o,u,d){this.type=e,this.input=o,this.beginIndex=u,this.endIndex=d}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=o.parse(e[1],1,$r),d=o.parse(e[2],2,ln);if(!u||!d)return null;if(!Vc(u.type,[Co($r),Ur,$r]))return o.error(`Expected first argument to be of type array or string, but found ${ds(u.type)} instead`);if(e.length===4){const g=o.parse(e[3],3,ln);return g?new Fu(u.type,u,d,g):null}return new Fu(u.type,u,d)}evaluate(e){const o=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Md(o,["string","array"]))throw new as(`Expected first argument to be of type array or string, but found ${ds(Kt(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return o.slice(u,d)}return o.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Em(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ng(a,e,o,u){return u.compare(e,o)===0}function la(a,e,o){const u=a!=="=="&&a!=="!=";return class VN{constructor(g,y,T){this.type=Br,this.lhs=g,this.rhs=y,this.collator=T,this.hasUntypedArgument=g.type.kind==="value"||y.type.kind==="value"}static parse(g,y){if(g.length!==3&&g.length!==4)return y.error("Expected two or three arguments.");const T=g[0];let C=y.parse(g[1],1,$r);if(!C)return null;if(!Em(T,C.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${ds(C.type)}'.`);let I=y.parse(g[2],2,$r);if(!I)return null;if(!Em(T,I.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${ds(I.type)}'.`);if(C.type.kind!==I.type.kind&&C.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${ds(C.type)}' and '${ds(I.type)}'.`);u&&(C.type.kind==="value"&&I.type.kind!=="value"?C=new In(I.type,[C]):C.type.kind!=="value"&&I.type.kind==="value"&&(I=new In(C.type,[I])));let N=null;if(g.length===4){if(C.type.kind!=="string"&&I.type.kind!=="string"&&C.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(N=y.parse(g[3],3,Of),!N)return null}return new VN(C,I,N)}evaluate(g){const y=this.lhs.evaluate(g),T=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const C=Kt(y),I=Kt(T);if(C.kind!==I.kind||C.kind!=="string"&&C.kind!=="number")throw new as(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${I.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const C=Kt(y),I=Kt(T);if(C.kind!=="string"||I.kind!=="string")return e(g,y,T)}return this.collator?o(g,y,T,this.collator.evaluate(g)):e(g,y,T)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const Bu=la("==",function(a,e,o){return e===o},Ng),Vh=la("!=",function(a,e,o){return e!==o},function(a,e,o,u){return!Ng(0,e,o,u)}),Yf=la("<",function(a,e,o){return e<o},function(a,e,o,u){return u.compare(e,o)<0}),Jf=la(">",function(a,e,o){return e>o},function(a,e,o,u){return u.compare(e,o)>0}),Ho=la("<=",function(a,e,o){return e<=o},function(a,e,o,u){return u.compare(e,o)<=0}),Qa=la(">=",function(a,e,o){return e>=o},function(a,e,o,u){return u.compare(e,o)>=0});class Ol{constructor(e,o,u,d,g,y){this.type=Ur,this.number=e,this.locale=o,this.currency=u,this.unit=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(e,o){if(e.length!==3)return o.error("Expected two arguments.");const u=o.parse(e[1],1,ln);if(!u)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let g=null;if(d.locale&&(g=o.parseObjectValue(d.locale,2,"locale",Ur),!g))return null;let y=null;if(d.currency&&(y=o.parseObjectValue(d.currency,2,"currency",Ur),!y))return null;let T=null;if(d.unit&&(T=o.parseObjectValue(d.unit,2,"unit",Ur),!T))return null;let C=null;if(d["min-fraction-digits"]&&(C=o.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",ln),!C))return null;let I=null;return d["max-fraction-digits"]&&(I=o.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",ln),!I)?null:new Ol(u,g,y,T,C,I)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fl{constructor(e){this.type=ln,this.input=e}static parse(e,o){if(e.length!==2)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=o.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ds(u.type)} instead.`):new fl(u):null}evaluate(e){const o=this.input.evaluate(e);if(typeof o=="string"||Array.isArray(o))return o.length;throw new as(`Expected value to be of type string or array, but found ${ds(Kt(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}function Ll(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Pa={"==":Bu,"!=":Vh,">":Jf,"<":Yf,">=":Qa,"<=":Ho,array:In,at:Xf,"at-interpolated":Kf,boolean:In,case:Bh,coalesce:io,collator:sa,format:Au,image:Iu,in:ju,"index-of":Fh,interpolate:Zs,"interpolate-hcl":Zs,"interpolate-lab":Zs,length:fl,let:zu,literal:Dn,match:aa,number:In,"number-format":Ol,object:In,slice:Fu,step:Pl,string:In,"to-boolean":Ya,"to-color":Ya,"to-number":Ya,"to-string":Ya,var:Zf,within:xo,distance:Ml,config:Oh};function Qf(a,[e,o,u,d]){e=e.evaluate(a),o=o.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=Cu(e,o,u,g);if(y)throw new as(y);return new Ir(e/255,o/255,u/255,g)}function Ud(a,[e,o,u,d]){e=e.evaluate(a),o=o.evaluate(a),u=u.evaluate(a);const g=d?d.evaluate(a):1,y=function(I,N,O,L){return typeof I=="number"&&I>=0&&I<=360?typeof N=="number"&&N>=0&&N<=100&&typeof O=="number"&&O>=0&&O<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[I,N,O,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[I,N,O,L]:[I,N,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[I,N,O,L]:[I,N,O]).join(", ")}]: 'h' must be between 0 and 360.`}(e,o,u,g);if(y)throw new as(y);const T=`hsla(${e}, ${o}%, ${u}%, ${g})`,C=Ir.parse(T);if(!C)throw new as(`Failed to parse HSLA color: ${T}`);return C}function ep(a,e){return a in e}function Ls(a,e){const o=e[a];return o===void 0?null:o}function Xs(a){return{type:a}}function ls(a){return{result:"success",value:a}}function so(a){return{result:"error",value:a}}function $d(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Uh(a){return a["property-type"]==="data-driven"}function Hd(a){return $d(a.expression,"measure-light")}function Gd(a){return $d(a.expression,"zoom")}function $h(a){return!!a.expression&&a.expression.interpolated}function Xc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Cm(a){return a}function Vu(a,e){const o=e.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",d=u||!(u||a.property!==void 0),g=a.type||($h(e)?"exponential":"interval");if(o&&((a=Al({},a)).stops&&(a.stops=a.stops.map(I=>[I[0],Ir.parse(I[1])])),a.default=Ir.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!$o[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let y,T,C;if(g==="exponential")y=Hh;else if(g==="interval")y=qd;else if(g==="categorical"){y=Jy,T=Object.create(null);for(const I of a.stops)T[I[0]]=I[1];C=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);y=Dg}if(u){const I={},N=[];for(let V=0;V<a.stops.length;V++){const H=a.stops[V],K=H[0].zoom;I[K]===void 0&&(I[K]={zoom:K,type:a.type,property:a.property,default:a.default,stops:[]},N.push(K)),I[K].stops.push([H[0].value,H[1]])}const O=[];for(const V of N)O.push([I[V].zoom,Vu(I[V],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Zs.interpolationFactor.bind(void 0,L),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},H)=>Hh({stops:O,base:a.base},e,V).evaluate(V,H)}}if(d){const I=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Zs.interpolationFactor.bind(void 0,I),zoomStops:a.stops.map(N=>N[0]),evaluate:({zoom:N})=>y(a,e,N,T,C)}}return{kind:"source",evaluate(I,N){const O=N&&N.properties?N.properties[a.property]:void 0;return O===void 0?ca(a.default,e.default):y(a,e,O,T,C)}}}function ca(a,e,o){return a!==void 0?a:e!==void 0?e:o!==void 0?o:void 0}function Jy(a,e,o,u,d){return ca(typeof o===d?u[o]:void 0,a.default,e.default)}function qd(a,e,o){if(sc(o)!=="number")return ca(a.default,e.default);const u=a.stops.length;if(u===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[u-1][0])return a.stops[u-1][1];const d=Bd(a.stops.map(g=>g[0]),o);return a.stops[d][1]}function Hh(a,e,o){const u=a.base!==void 0?a.base:1;if(sc(o)!=="number")return ca(a.default,e.default);const d=a.stops.length;if(d===1||o<=a.stops[0][0])return a.stops[0][1];if(o>=a.stops[d-1][0])return a.stops[d-1][1];const g=Bd(a.stops.map(N=>N[0]),o),y=function(N,O,L,V){const H=V-L,K=N-L;return H===0?0:O===1?K/H:(Math.pow(O,K)-1)/(Math.pow(O,H)-1)}(o,u,a.stops[g][0],a.stops[g+1][0]),T=a.stops[g][1],C=a.stops[g+1][1];let I=nc[e.type]||Cm;if(a.colorSpace&&a.colorSpace!=="rgb"){const N=$o[a.colorSpace];I=(O,L)=>N.reverse(N.interpolate(N.forward(O),N.forward(L),y))}return typeof T.evaluate=="function"?{evaluate(...N){const O=T.evaluate.apply(void 0,N),L=C.evaluate.apply(void 0,N);if(O!==void 0&&L!==void 0)return I(O,L,y)}}:I(T,C,y)}function Dg(a,e,o){return e.type==="color"?o=Ir.parse(o):e.type==="formatted"?o=Ao.fromString(o.toString()):e.type==="resolvedImage"?o=Uo.build(o.toString()):sc(o)===e.type||e.type==="enum"&&e.values[o]||(o=void 0),ca(o,a.default,e.default)}Ms.register(Pa,{error:[{kind:"error"},[Ur],(a,[e])=>{throw new as(e.evaluate(a))}],typeof:[Ur,[$r],(a,[e])=>ds(Kt(e.evaluate(a)))],"to-rgba":[Co(ln,4),[ra],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Co(ln,4),[ra],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ra,[ln,ln,ln],Qf],rgba:[ra,[ln,ln,ln,ln],Qf],hsl:[ra,[ln,ln,ln],Ud],hsla:[ra,[ln,ln,ln,ln],Ud],has:{type:Br,overloads:[[[Ur],(a,[e])=>ep(e.evaluate(a),a.properties())],[[Ur,rc],(a,[e,o])=>ep(e.evaluate(a),o.evaluate(a))]]},get:{type:$r,overloads:[[[Ur],(a,[e])=>Ls(e.evaluate(a),a.properties())],[[Ur,rc],(a,[e,o])=>Ls(e.evaluate(a),o.evaluate(a))]]},"feature-state":[$r,[Ur],(a,[e])=>Ls(e.evaluate(a),a.featureState||{})],properties:[rc,[],a=>a.properties()],"geometry-type":[Ur,[],a=>a.geometryType()],worldview:[Ur,[],a=>a.globals.worldview||""],id:[$r,[],a=>a.id()],zoom:[ln,[],a=>a.globals.zoom],pitch:[ln,[],a=>a.globals.pitch||0],"distance-from-center":[ln,[],a=>a.distanceFromCenter()],"measure-light":[ln,[Ur],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[ln,[],a=>a.globals.heatmapDensity||0],"line-progress":[ln,[],a=>a.globals.lineProgress||0],"raster-value":[ln,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[ln,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[ln,[],a=>a.globals.skyRadialProgress||0],accumulated:[$r,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[ln,Xs(ln),(a,e)=>{let o=0;for(const u of e)o+=u.evaluate(a);return o}],"*":[ln,Xs(ln),(a,e)=>{let o=1;for(const u of e)o*=u.evaluate(a);return o}],"-":{type:ln,overloads:[[[ln,ln],(a,[e,o])=>e.evaluate(a)-o.evaluate(a)],[[ln],(a,[e])=>-e.evaluate(a)]]},"/":[ln,[ln,ln],(a,[e,o])=>e.evaluate(a)/o.evaluate(a)],"%":[ln,[ln,ln],(a,[e,o])=>e.evaluate(a)%o.evaluate(a)],ln2:[ln,[],()=>Math.LN2],pi:[ln,[],()=>Math.PI],e:[ln,[],()=>Math.E],"^":[ln,[ln,ln],(a,[e,o])=>Math.pow(e.evaluate(a),o.evaluate(a))],sqrt:[ln,[ln],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[ln,[ln],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[ln,[ln],(a,[e])=>Math.log(e.evaluate(a))],log2:[ln,[ln],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[ln,[ln],(a,[e])=>Math.sin(e.evaluate(a))],cos:[ln,[ln],(a,[e])=>Math.cos(e.evaluate(a))],tan:[ln,[ln],(a,[e])=>Math.tan(e.evaluate(a))],asin:[ln,[ln],(a,[e])=>Math.asin(e.evaluate(a))],acos:[ln,[ln],(a,[e])=>Math.acos(e.evaluate(a))],atan:[ln,[ln],(a,[e])=>Math.atan(e.evaluate(a))],min:[ln,Xs(ln),(a,e)=>Math.min(...e.map(o=>o.evaluate(a)))],max:[ln,Xs(ln),(a,e)=>Math.max(...e.map(o=>o.evaluate(a)))],abs:[ln,[ln],(a,[e])=>Math.abs(e.evaluate(a))],round:[ln,[ln],(a,[e])=>{const o=e.evaluate(a);return o<0?-Math.round(-o):Math.round(o)}],floor:[ln,[ln],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[ln,[ln],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[Br,[Ur,$r],(a,[e,o])=>a.properties()[e.value]===o.value],"filter-id-==":[Br,[$r],(a,[e])=>a.id()===e.value],"filter-type-==":[Br,[Ur],(a,[e])=>a.geometryType()===e.value],"filter-<":[Br,[Ur,$r],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Br,[$r],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o<u}],"filter->":[Br,[Ur,$r],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u>d}],"filter-id->":[Br,[$r],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o>u}],"filter-<=":[Br,[Ur,$r],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Br,[$r],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o<=u}],"filter->=":[Br,[Ur,$r],(a,[e,o])=>{const u=a.properties()[e.value],d=o.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Br,[$r],(a,[e])=>{const o=a.id(),u=e.value;return typeof o==typeof u&&o>=u}],"filter-has":[Br,[$r],(a,[e])=>e.value in a.properties()],"filter-has-id":[Br,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Br,[Co(Ur)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[Br,[Co($r)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[Br,[Ur,Co($r)],(a,[e,o])=>o.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[Br,[Ur,Co($r)],(a,[e,o])=>function(u,d,g,y){for(;g<=y;){const T=g+y>>1;if(d[T]===u)return!0;d[T]>u?y=T-1:g=T+1}return!1}(a.properties()[e.value],o.value,0,o.value.length-1)],all:{type:Br,overloads:[[[Br,Br],(a,[e,o])=>e.evaluate(a)&&o.evaluate(a)],[Xs(Br),(a,e)=>{for(const o of e)if(!o.evaluate(a))return!1;return!0}]]},any:{type:Br,overloads:[[[Br,Br],(a,[e,o])=>e.evaluate(a)||o.evaluate(a)],[Xs(Br),(a,e)=>{for(const o of e)if(o.evaluate(a))return!0;return!1}]]},"!":[Br,[Br],(a,[e])=>!e.evaluate(a)],"is-supported-script":[Br,[Ur],(a,[e])=>{const o=a.globals&&a.globals.isSupportedScript;return!o||o(e.evaluate(a))}],upcase:[Ur,[Ur],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[Ur,[Ur],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[Ur,Xs($r),(a,e)=>e.map(o=>ia(o.evaluate(a))).join("")],"resolved-locale":[Ur,[Of],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[ln,[ln,ln,$r],(a,e)=>{const[o,u,d]=e.map(y=>y.evaluate(a));if(o>u||o===u)return o;let g;if(typeof d=="string")g=function(y){let T=0;if(y.length===0)return T;for(let C=0;C<y.length;C++)T=(T<<5)-T+y.charCodeAt(C),T|=0;return T}(d);else{if(typeof d!="number")throw new as(`Invalid seed input: ${d}`);g=d}return o+Ll(g)()*(u-o)}]});class Uu{constructor(e,o,u,d){this.expression=e,this._warningHistory={},this._evaluator=new kd(u,d),this._defaultValue=o?function(g){return g.type==="color"&&(Xc(g.default)||Array.isArray(g.default))?new Ir(0,0,0,0):g.type==="color"?Ir.parse(g.default)||null:g.default===void 0?null:g.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null,this.configDependencies=Dh(e)}evaluateWithoutErrorHandling(e,o,u,d,g,y,T,C){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(e,o,u,d,g,y,T,C){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new as(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function hc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Pa}function zl(a,e,o,u){const d=new Lh(Pa,[],e?function(y){const T={color:ra,string:Ur,number:ln,enum:Ur,boolean:Br,formatted:Eh,resolvedImage:Id};return y.type==="array"?Co(T[y.value]||$r,y.length):T[y.type]}(e):void 0,void 0,void 0,o,u),g=d.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?ls(new Uu(g,e,o,u)):so(d.errors)}class Kc{constructor(e,o,u,d){this.kind=e,this._styleExpression=o,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=e!=="constant"&&!Nh(o.expression),this.configDependencies=Dh(o.expression)}evaluateWithoutErrorHandling(e,o,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,d,g,y)}evaluate(e,o,u,d,g,y){return this._styleExpression.evaluate(e,o,u,d,g,y)}}class Yc{constructor(e,o,u,d,g,y){this.kind=e,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=e!=="camera"&&!Nh(o.expression),this.isLightConstant=g,this.isLineProgressConstant=y,this.configDependencies=Dh(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,o,u,d,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,o,u,d,g,y)}evaluate(e,o,u,d,g,y){return this._styleExpression.evaluate(e,o,u,d,g,y)}interpolationFactor(e,o,u){return this.interpolationType?Zs.interpolationFactor(this.interpolationType,e,o,u):0}}function $u(a,e,o,u){if((a=zl(a,e,o,u)).result==="error")return a;const d=a.value.expression,g=cc(d);if(!g&&!Uh(e))return so([new na("","data expressions not supported")]);const y=Wc(d,["zoom","pitch","distance-from-center"]);if(!y&&!Gd(e))return so([new na("","zoom expressions not supported")]);const T=Wc(d,["measure-light"]);if(!T&&!Hd(e))return so([new na("","measure-light expression not supported")]);const C=Wc(d,["line-progress"]);if(!C&&!function(O){return $d(O.expression,"line-progress")}(e))return so([new na("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,N=Qc(d);return N||y||I?N instanceof na?so([N]):N instanceof Zs&&!$h(e)?so([new na("",'"interpolate" expressions cannot be used with this property')]):ls(N?new Yc(g&&C?"camera":"composite",a.value,N.labels,N instanceof Zs?N.interpolation:void 0,T,C):new Kc(g&&C?"constant":"source",a.value,T,C)):so([new na("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Jc{constructor(e,o){this._parameters=e,this._specification=o,Al(this,Vu(this._parameters,this._specification))}static deserialize(e){return new Jc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Qc(a){let e=null;if(a instanceof zu)e=Qc(a.result);else if(a instanceof io){for(const o of a.args)if(e=Qc(o),e)break}else(a instanceof Pl||a instanceof Zs)&&a.input instanceof Ms&&a.input.name==="zoom"&&(e=a);return e instanceof na||a.eachChild(o=>{const u=Qc(o);u instanceof na?e=u:e&&u&&e!==u&&(e=new na("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Gh,Wd,eu=function(){if(Wd)return Gh;Wd=1,Gh=e;var a=3;function e(o,u,d){var g=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var y=new Int32Array(this.arrayBuffer);o=y[0],this.d=(u=y[1])+2*(d=y[2]);for(var T=0;T<this.d*this.d;T++){var C=y[a+T],I=y[a+T+1];g.push(C===I?null:y.subarray(C,I))}var N=y[a+g.length+1];this.keys=y.subarray(y[a+g.length],N),this.bboxes=y.subarray(N),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var O=0;O<this.d*this.d;O++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=d,this.scale=u/o,this.uid=0;var L=d/u*o;this.min=-L,this.max=o+L}return e.prototype.insert=function(o,u,d,g,y){this._forEachCell(u,d,g,y,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(o,u,d,g,y,T){this.cells[y].push(T)},e.prototype.query=function(o,u,d,g,y){var T=this.min,C=this.max;if(o<=T&&u<=T&&C<=d&&C<=g&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(o,u,d,g,this._queryCell,I,{},y),I},e.prototype._queryCell=function(o,u,d,g,y,T,C,I){var N=this.cells[y];if(N!==null)for(var O=this.keys,L=this.bboxes,V=0;V<N.length;V++){var H=N[V];if(C[H]===void 0){var K=4*H;(I?I(L[K+0],L[K+1],L[K+2],L[K+3]):o<=L[K+2]&&u<=L[K+3]&&d>=L[K+0]&&g>=L[K+1])?(C[H]=!0,T.push(O[H])):C[H]=!1}}},e.prototype._forEachCell=function(o,u,d,g,y,T,C,I){for(var N=this._convertToCellCoord(o),O=this._convertToCellCoord(u),L=this._convertToCellCoord(d),V=this._convertToCellCoord(g),H=N;H<=L;H++)for(var K=O;K<=V;K++){var te=this.d*K+H;if((!I||I(this._convertFromCellCoord(H),this._convertFromCellCoord(K),this._convertFromCellCoord(H+1),this._convertFromCellCoord(K+1)))&&y.call(this,o,u,d,g,te,T,C,I))return}},e.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},e.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=a+this.cells.length+1+1,d=0,g=0;g<this.cells.length;g++)d+=this.cells[g].length;var y=new Int32Array(u+d+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=u,C=0;C<o.length;C++){var I=o[C];y[a+C]=T,y.set(I,T),T+=I.length}return y[a+o.length]=T,y.set(this.keys,T),y[a+o.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Gh}(),zs=ui(eu);const Go={};function Zt(a,e,o={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Go[e]={klass:a,omit:o.omit||[]}}Zt(Object,"Object"),zs.serialize=function(a,e){const o=a.toArrayBuffer();return e&&e.add(o),{buffer:o}},zs.deserialize=function(a){return new zs(a.buffer)},Object.defineProperty(zs,"name",{value:"Grid"}),Zt(zs,"Grid"),typeof DOMMatrix<"u"&&Zt(DOMMatrix,"DOMMatrix"),Zt(Ir,"Color"),Zt(Error,"Error"),Zt(Ao,"Formatted"),Zt(zf,"FormattedSection"),Zt(Ar,"AJAXError"),Zt(Uo,"ResolvedImage"),Zt(Jc,"StylePropertyFunction"),Zt(Uu,"StyleExpression",{omit:["_evaluator"]}),Zt(_o,"ImageId"),Zt(ic,"ImageVariant"),Zt(Yc,"ZoomDependentExpression"),Zt(Kc,"ZoomConstantExpression"),Zt(Ms,"CompoundExpression",{omit:["_evaluate"]});for(const a in Pa)Go[Pa[a]._classRegistryKey]||Zt(Pa[a],`Expression${a}`);function Am(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function jl(a){return self.ImageBitmap&&a instanceof ImageBitmap}function qo(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Am(a)||jl(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const o=[];for(const u of a)o.push(qo(u,e));return o}if(a instanceof Map){const o={$name:"Map",entries:[]};for(const[u,d]of a.entries())o.entries.push(qo(u),qo(d,e));return o}if(a instanceof Set){const o={$name:"Set"};let u=0;for(const d of a.values())o[++u]=qo(d);return o}if(a instanceof DOMMatrix){const o={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of u)o[d]=a[d];return o}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const o=a.constructor,u=o._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${o.name}".`);const d=o.serialize?o.serialize(a,e):{};if(!o.serialize){for(const g in a)a.hasOwnProperty(g)&&(Go[u].omit.indexOf(g)>=0||(d[g]=qo(a[g],e)));a instanceof Error&&(d.message=a.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof a)}function Fl(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Am(a)||jl(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Fl);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const d=a.entries||[],g=new Map;for(let y=0;y<d.length;y+=2)g.set(Fl(d[y]),Fl(d[y+1]));return g}if(e==="Set"){const d=new Set;for(const g of Object.keys(a))g!=="$name"&&d.add(Fl(a[g]));return d}if(e==="DOMMatrix"){let d;return d=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(d)}if(e==="BigInt")return BigInt(a.value);const{klass:o}=Go[e];if(!o)throw new Error(`Can't deserialize unregistered class "${e}".`);if(o.deserialize)return o.deserialize(a);const u=Object.create(o.prototype);for(const d of Object.keys(a))d!=="$name"&&(u[d]=Fl(a[d]));return u}throw new Error("can't deserialize object of type "+typeof a)}const vn={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function Ra(a){for(const e of a)if(np(e.charCodeAt(0)))return!0;return!1}function tu(a){for(const e of a)if(!tp(e.charCodeAt(0)))return!1;return!0}function tp(a){return!(vn.Arabic(a)||vn["Arabic Supplement"](a)||vn["Arabic Extended-A"](a)||vn["Arabic Presentation Forms-A"](a)||vn["Arabic Presentation Forms-B"](a))}function np(a){return!(a!==746&&a!==747&&(a<4352||!(vn["Bopomofo Extended"](a)||vn.Bopomofo(a)||vn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||vn["CJK Compatibility Ideographs"](a)||vn["CJK Compatibility"](a)||vn["CJK Radicals Supplement"](a)||vn["CJK Strokes"](a)||!(!vn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||vn["CJK Unified Ideographs Extension A"](a)||vn["CJK Unified Ideographs"](a)||vn["Enclosed CJK Letters and Months"](a)||vn["Hangul Compatibility Jamo"](a)||vn["Hangul Jamo Extended-A"](a)||vn["Hangul Jamo Extended-B"](a)||vn["Hangul Jamo"](a)||vn["Hangul Syllables"](a)||vn.Hiragana(a)||vn["Ideographic Description Characters"](a)||vn.Kanbun(a)||vn["Kangxi Radicals"](a)||vn["Katakana Phonetic Extensions"](a)||vn.Katakana(a)&&a!==12540||!(!vn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!vn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||vn["Unified Canadian Aboriginal Syllabics"](a)||vn["Unified Canadian Aboriginal Syllabics Extended"](a)||vn["Vertical Forms"](a)||vn["Yijing Hexagram Symbols"](a)||vn["Yi Syllables"](a)||vn["Yi Radicals"](a))))}function Zd(a){return!(np(a)||function(e){return!!(vn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||vn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||vn["Letterlike Symbols"](e)||vn["Number Forms"](e)||vn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||vn["Control Pictures"](e)&&e!==9251||vn["Optical Character Recognition"](e)||vn["Enclosed Alphanumerics"](e)||vn["Geometric Shapes"](e)||vn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vn["CJK Symbols and Punctuation"](e)||vn.Katakana(e)||vn["Private Use Area"](e)||vn["CJK Compatibility Forms"](e)||vn["Small Form Variants"](e)||vn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(a))}function Og(a){return vn.Arabic(a)||vn["Arabic Supplement"](a)||vn["Arabic Extended-A"](a)||vn["Arabic Presentation Forms-A"](a)||vn["Arabic Presentation Forms-B"](a)}function qh(a){return a>=1424&&a<=2303||vn["Arabic Presentation Forms-A"](a)||vn["Arabic Presentation Forms-B"](a)}function Bl(a,e){return!(!e&&qh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||vn.Khmer(a))}function Xd(a){for(const e of a)if(qh(e.charCodeAt(0)))return!0;return!1}const oo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let dc=null,ao=oo.unavailable,ua=null;const nu=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(ao=oo.error),dc&&dc(a)};function Wh(){rs.fire(new jc("pluginStateChange",{pluginStatus:ao,pluginURL:ua}))}const rs=new Fc,fc=function(){return ao},rp=function(){if(ao!==oo.deferred||!ua)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ao=oo.loading,Wh(),ua&&Td({url:ua},a=>{a?nu(a):(ao=oo.loaded,Wh())})},pl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ao===oo.loaded||pl.applyArabicShaping!=null,isLoading:()=>ao===oo.loading,setState(a){ao=a.pluginStatus,ua=a.pluginURL},isParsing:()=>ao===oo.parsing,isParsed:()=>ao===oo.parsed,getPluginURL:()=>ua};class Hr{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness,this.worldview=o.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(o,u){for(const d of o)if(!Bl(d.charCodeAt(0),u))return!1;return!0}(e,pl.isLoaded())}}class Hu{constructor(e,o,u,d){this.property=e,this.value=o,this.expression=function(g,y,T,C){if(Xc(g))return new Jc(g,y);if(hc(g)||Array.isArray(g)&&g.length>0){const I=$u(g,y,T,C);if(I.result==="error")throw new Error(I.value.map(N=>`${N.key}: ${N.message}`).join(", "));return I.value}{let I=g;return typeof g=="string"&&y.type==="color"&&(I=Ir.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>I}}}(o===void 0?e.specification.default:o,e.specification,u,d)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,o,u){return this.property.possiblyEvaluate(this,e,o,u)}}class ha{constructor(e,o,u){this.property=e,this.value=new Hu(e,void 0,o,u)}transitioned(e,o){return new js(this.property,this.value,o,Xe({},e.transition,this.transition),e.now)}untransitioned(){return new js(this.property,this.value,null,{},0)}}class fs{constructor(e,o,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(e){return gn(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property,this._scope,this._options)),this._values[e].value=new Hu(this._values[e].property,o===null?void 0:gn(o),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,o){o&&(this._options=o);const u=this._properties.properties;if(e)for(const d in e){const g=e[d];if(d.endsWith("-transition")){const y=d.slice(0,-11);u[y]&&this.setTransition(y,g)}else u.hasOwnProperty(d)&&this.setValue(d,g)}}getTransition(e){return gn(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new ha(this._values[e].property)),this._values[e].transition=gn(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u);const d=this.getTransition(o);d!==void 0&&(e[`${o}-transition`]=d)}return e}transitioned(e,o){const u=new Ks(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(e,o._values[d]);return u}untransitioned(){const e=new Ks(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class js{constructor(e,o,u,d,g){const y=d.delay||0,T=d.duration||0;g=g||0,this.property=e,this.value=o,this.begin=g+y,this.end=this.begin+T,e.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(e,o,u){const d=e.now||0,g=this.value.possiblyEvaluate(e,o,u),y=this.prior;if(y){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return y.possiblyEvaluate(e,o,u);{const T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,o,u),g,ue(T))}}return g}}class Ks{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,u){const d=new ml(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,o,u);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ip{constructor(e,o,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(e){return gn(this._values[e].value)}setValue(e,o){this._values[e]=new Hu(this._values[e].property,o===null?void 0:gn(o),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(e[o]=u)}return e}possiblyEvaluate(e,o,u){const d=new ml(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].possiblyEvaluate(e,o,u);return d}}class Vl{constructor(e,o,u){this.property=e,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,o,u,d){return this.property.evaluate(this.value,this.parameters,e,o,u,d)}}class ml{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,u){const d=nc[this.specification.type];return d?d(e,o,u):e}}class zt{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,u,d){return new Vl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(o,null,{},u,d)}:e.expression,o)}interpolate(e,o,u){if(e.value.kind!=="constant"||o.value.kind!=="constant")return e;if(e.value.value===void 0||o.value.value===void 0)return new Vl(this,{kind:"constant",value:void 0},e.parameters);const d=nc[this.specification.type];return d?new Vl(this,{kind:"constant",value:d(e.value.value,o.value.value,u)},e.parameters):e}evaluate(e,o,u,d,g,y){return e.kind==="constant"?e.value:e.evaluate(o,u,d,g,y)}}class pc{constructor(e){this.specification=e}possiblyEvaluate(e,o,u,d){return!!e.expression.evaluate(o,null,{},u,d)}interpolate(){return!1}}class Di{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Hr(0,{});for(const u in e){const d=e[u];d.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new Hu(d,void 0),y=this.defaultTransitionablePropertyValues[u]=new ha(d);this.defaultTransitioningPropertyValues[u]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(o)}}}Zt(zt,"DataDrivenProperty"),Zt(Tt,"DataConstantProperty"),Zt(pc,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Fs(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Wo(a){if(Array.isArray(a))return a.map(Wo);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const o in a)e[o]=Wo(a[o]);return e}return Fs(a)}function ru(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!ru(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Kd(a,e="",o=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ru(a)||(a=Yd(a));const d=a;let g=!0;try{g=function(N){if(!Gu(N))return N;let O=Wo(N);return Im(O),O=sp(O),O}(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let y=null,T=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){T=$e[`filter_${u}`];const N=zl(g,T,e,o);if(N.result==="error")throw new Error(N.value.map(O=>`${O.key}: ${O.message}`).join(", "));y=(O,L,V)=>N.value.evaluate(O,L,{},V)}let C=null,I=null;if(g!==d){const N=zl(d,T,e,o);if(N.result==="error")throw new Error(N.value.map(O=>`${O.key}: ${O.message}`).join(", "));C=(O,L,V,H,K)=>N.value.evaluate(O,L,{},V,void 0,void 0,H,K),I=!cc(N.value.expression)}return{filter:y,dynamicFilter:C||void 0,needGeometry:Mm(g),needFeature:!!I}}function sp(a){if(!Array.isArray(a))return a;const e=function(o){if(Lg.has(o[0])){for(let u=1;u<o.length;u++)if(Gu(o[u]))return!0}return o}(a);return e===!0?e:e.map(o=>sp(o))}function Im(a){let e=!1;const o=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)e=e||Gu(a[u]),o.push(a[u+1]);o.push(a[a.length-1])}else if(a[0]==="match"){e=e||Gu(a[1]);for(let u=2;u<a.length-1;u+=2)o.push(a[u+1]);o.push(a[a.length-1])}else if(a[0]==="step"){e=e||Gu(a[1]);for(let u=1;u<a.length-1;u+=2)o.push(a[u+1])}e&&(a.length=0,a.push("any",...o));for(let u=1;u<a.length;u++)Im(a[u])}function Gu(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let o=1;o<a.length;o++)if(Gu(a[o]))return!0;return!1}const Lg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zg(a,e){return a<e?-1:a>e?1:0}function Mm(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(Mm(a[e]))return!0;return!1}function Yd(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?op(a[1],a[2],"=="):e==="!="?Jd(op(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?op(a[1],a[2],e):e==="any"?(o=a.slice(1),["any"].concat(o.map(Yd))):e==="all"?["all"].concat(a.slice(1).map(Yd)):e==="none"?["all"].concat(a.slice(1).map(Yd).map(Jd)):e==="in"?ap(a[1],a.slice(2)):e==="!in"?Jd(ap(a[1],a.slice(2))):e==="has"?Zh(a[1]):e!=="!has"||Jd(Zh(a[1]));var o}function op(a,e,o){switch(a){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,a,e]}}function ap(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",a,["literal",e.sort(zg)]]:["filter-in-small",a,["literal",e]]}}function Zh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Jd(a){return["!",a]}const iu="";function Ul(a,e){return e?`${a}${iu}${e}`:a}const lp="-transition",$l=new Set(["fill","line","background","hillshade","raster"]);class lo extends Fc{constructor(e,o,u,d,g){if(super(),this.id=e.id,this.fqid=Ul(this.id,u),this.type=e.type,this.scope=u,this.lut=d,this.options=g,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const y=zl(this.filter,$e[`filter_${e.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),o.layout&&(this._unevaluatedLayout=new ip(o.layout,this.scope,g),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint){this._transitionablePaint=new fs(o.paint,this.scope,g);for(const y in e.paint)this.setPaintProperty(y,e.paint[y]);for(const y in e.layout)this.setLayoutProperty(y,e.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ml(o.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&$l.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o){if(this.type==="custom"&&e==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(lp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o){const u=this._transitionablePaint,d=u._properties.properties;if(e.endsWith(lp)){const O=e.slice(0,-11);return d[O]&&u.setTransition(O,o||void 0),!1}if(!d[e])return!1;const g=u._values[e],y=g.value.isDataDriven(),T=g.value;u.setValue(e,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const C=u._values[e].value,I=C.isDataDriven(),N=e.endsWith("pattern")||e==="line-dasharray";return I||y||N||this._handleOverridablePaintPropertyUpdate(e,T,C)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,o,u){return null}_handleOverridablePaintPropertyUpdate(e,o,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){return Wt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,o)=>!(e===void 0||o==="layout"&&!Object.keys(e).length||o==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof Vl&&Uh(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Kd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,o,u,d,g,y,T,C,I){}}const jg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Xh{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&o.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Tr(a,e=1){let o=0,u=0;return{members:a.map(d=>{const g=jg[d.type].BYTES_PER_ELEMENT,y=o=cp(o,Math.max(e,g)),T=d.components||1;return u=Math.max(u,g),o+=g*T,{name:d.name,type:d.type,components:T,offset:y}}),size:cp(o,Math.max(u,e)),alignment:e}}function cp(a,e){return Math.ceil(a/e)*e}class Hl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.int16[d+0]=o,this.int16[d+1]=u,e}}Hl.prototype.bytesPerElement=4,Zt(Hl,"StructArrayLayout2i4");class Kh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=d,e}}Kh.prototype.bytesPerElement=6,Zt(Kh,"StructArrayLayout3i6");class Yh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.int16[y+0]=o,this.int16[y+1]=u,this.int16[y+2]=d,this.int16[y+3]=g,e}}Yh.prototype.bytesPerElement=8,Zt(Yh,"StructArrayLayout4i8");class mc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}mc.prototype.bytesPerElement=4,Zt(mc,"StructArrayLayout1f4");class km extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=4*e,y=2*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.float32[y+1]=d,e}}km.prototype.bytesPerElement=8,Zt(km,"StructArrayLayout2i1f8");class up extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=4*e;return this.int16[g+0]=o,this.int16[g+1]=u,this.int16[g+2]=d,e}}up.prototype.bytesPerElement=8,Zt(up,"StructArrayLayout3i8");class qu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=5*e;return this.int16[T+0]=o,this.int16[T+1]=u,this.int16[T+2]=d,this.int16[T+3]=g,this.int16[T+4]=y,e}}qu.prototype.bytesPerElement=10,Zt(qu,"StructArrayLayout5i10");class hp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=6*e,N=12*e,O=3*e;return this.int16[I+0]=o,this.int16[I+1]=u,this.uint8[N+4]=d,this.uint8[N+5]=g,this.uint8[N+6]=y,this.uint8[N+7]=T,this.float32[O+2]=C,e}}hp.prototype.bytesPerElement=12,Zt(hp,"StructArrayLayout2i4ub1f12");class gl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.float32[g+0]=o,this.float32[g+1]=u,this.float32[g+2]=d,e}}gl.prototype.bytesPerElement=12,Zt(gl,"StructArrayLayout3f12");class yl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=6*e,C=3*e;return this.uint16[T+0]=o,this.uint16[T+1]=u,this.uint16[T+2]=d,this.uint16[T+3]=g,this.float32[C+2]=y,e}}yl.prototype.bytesPerElement=12,Zt(yl,"StructArrayLayout4ui1f12");class Qd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.uint16[y+0]=o,this.uint16[y+1]=u,this.uint16[y+2]=d,this.uint16[y+3]=g,e}}Qd.prototype.bytesPerElement=8,Zt(Qd,"StructArrayLayout4ui8");class dp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=6*e;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=d,this.int16[C+3]=g,this.int16[C+4]=y,this.int16[C+5]=T,e}}dp.prototype.bytesPerElement=12,Zt(dp,"StructArrayLayout6i12");class Jh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L){const V=this.length;return this.resize(V+1),this.emplace(V,e,o,u,d,g,y,T,C,I,N,O,L)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V){const H=12*e;return this.int16[H+0]=o,this.int16[H+1]=u,this.int16[H+2]=d,this.int16[H+3]=g,this.uint16[H+4]=y,this.uint16[H+5]=T,this.uint16[H+6]=C,this.uint16[H+7]=I,this.int16[H+8]=N,this.int16[H+9]=O,this.int16[H+10]=L,this.int16[H+11]=V,e}}Jh.prototype.bytesPerElement=24,Zt(Jh,"StructArrayLayout4i4ui4i24");class Mo extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=10*e,I=5*e;return this.int16[C+0]=o,this.int16[C+1]=u,this.int16[C+2]=d,this.float32[I+2]=g,this.float32[I+3]=y,this.float32[I+4]=T,e}}Mo.prototype.bytesPerElement=20,Zt(Mo,"StructArrayLayout3i3f20");class Ps extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=4*e;return this.float32[y+0]=o,this.float32[y+1]=u,this.float32[y+2]=d,this.float32[y+3]=g,e}}Ps.prototype.bytesPerElement=16,Zt(Ps,"StructArrayLayout4f16");class gc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}gc.prototype.bytesPerElement=4,Zt(gc,"StructArrayLayout1ul4");class yc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.uint16[d+0]=o,this.uint16[d+1]=u,e}}yc.prototype.bytesPerElement=4,Zt(yc,"StructArrayLayout2ui4");class fp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V){const H=this.length;return this.resize(H+1),this.emplace(H,e,o,u,d,g,y,T,C,I,N,O,L,V)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H){const K=20*e,te=10*e;return this.int16[K+0]=o,this.int16[K+1]=u,this.int16[K+2]=d,this.int16[K+3]=g,this.int16[K+4]=y,this.float32[te+3]=T,this.float32[te+4]=C,this.float32[te+5]=I,this.float32[te+6]=N,this.int16[K+14]=O,this.uint32[te+8]=L,this.uint16[K+18]=V,this.uint16[K+19]=H,e}}fp.prototype.bytesPerElement=40,Zt(fp,"StructArrayLayout5i4f1i1ul2ui40");class ef extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=8*e;return this.int16[I+0]=o,this.int16[I+1]=u,this.int16[I+2]=d,this.int16[I+4]=g,this.int16[I+5]=y,this.int16[I+6]=T,this.int16[I+7]=C,e}}ef.prototype.bytesPerElement=16,Zt(ef,"StructArrayLayout3i2i2i16");class tf extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=4*e,C=8*e;return this.float32[T+0]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.int16[C+6]=g,this.int16[C+7]=y,e}}tf.prototype.bytesPerElement=16,Zt(tf,"StructArrayLayout2f1f2i16");class Gl extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=20*e,I=5*e;return this.uint8[C+0]=o,this.uint8[C+1]=u,this.float32[I+1]=d,this.float32[I+2]=g,this.float32[I+3]=y,this.float32[I+4]=T,e}}Gl.prototype.bytesPerElement=20,Zt(Gl,"StructArrayLayout2ub4f20");class Rs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,u)}emplace(e,o,u,d){const g=3*e;return this.uint16[g+0]=o,this.uint16[g+1]=u,this.uint16[g+2]=d,e}}Rs.prototype.bytesPerElement=6,Zt(Rs,"StructArrayLayout3ui6");class Wu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he){const me=this.length;return this.resize(me+1),this.emplace(me,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he,me){const _e=30*e,De=15*e,Pe=60*e;return this.int16[_e+0]=o,this.int16[_e+1]=u,this.int16[_e+2]=d,this.float32[De+2]=g,this.float32[De+3]=y,this.uint16[_e+8]=T,this.uint16[_e+9]=C,this.uint32[De+5]=I,this.uint32[De+6]=N,this.uint32[De+7]=O,this.uint16[_e+16]=L,this.uint16[_e+17]=V,this.uint16[_e+18]=H,this.float32[De+10]=K,this.float32[De+11]=te,this.uint8[Pe+48]=ae,this.uint8[Pe+49]=fe,this.uint8[Pe+50]=pe,this.uint32[De+13]=Q,this.int16[_e+28]=he,this.uint8[Pe+58]=me,e}}Wu.prototype.bytesPerElement=60,Zt(Wu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Pm extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he,me,_e,De,Pe,Oe,Ve,tt,vt,ft,xt,St,rt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he,me,_e,De,Pe,Oe,Ve,tt,vt,ft,xt,St,rt)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe,Q,he,me,_e,De,Pe,Oe,Ve,tt,vt,ft,xt,St,rt,_t){const et=20*e,nt=40*e,Mt=80*e;return this.float32[et+0]=o,this.float32[et+1]=u,this.int16[nt+4]=d,this.int16[nt+5]=g,this.int16[nt+6]=y,this.int16[nt+7]=T,this.int16[nt+8]=C,this.int16[nt+9]=I,this.int16[nt+10]=N,this.int16[nt+11]=O,this.int16[nt+12]=L,this.uint16[nt+13]=V,this.uint16[nt+14]=H,this.uint16[nt+15]=K,this.uint16[nt+16]=te,this.uint16[nt+17]=ae,this.uint16[nt+18]=fe,this.uint16[nt+19]=pe,this.uint16[nt+20]=Q,this.uint16[nt+21]=he,this.uint16[nt+22]=me,this.uint16[nt+23]=_e,this.uint16[nt+24]=De,this.uint16[nt+25]=Pe,this.uint16[nt+26]=Oe,this.uint16[nt+27]=Ve,this.uint32[et+14]=tt,this.float32[et+15]=vt,this.float32[et+16]=ft,this.float32[et+17]=xt,this.float32[et+18]=St,this.uint8[Mt+76]=rt,this.uint16[nt+39]=_t,e}}Pm.prototype.bytesPerElement=80,Zt(Pm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class pp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,u,d,g,y)}emplace(e,o,u,d,g,y,T){const C=6*e;return this.float32[C+0]=o,this.float32[C+1]=u,this.float32[C+2]=d,this.float32[C+3]=g,this.float32[C+4]=y,this.float32[C+5]=T,e}}pp.prototype.bytesPerElement=24,Zt(pp,"StructArrayLayout6f24");class _c extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,o,u,d,g)}emplace(e,o,u,d,g,y){const T=5*e;return this.float32[T+0]=o,this.float32[T+1]=u,this.float32[T+2]=d,this.float32[T+3]=g,this.float32[T+4]=y,e}}_c.prototype.bytesPerElement=20,Zt(_c,"StructArrayLayout5f20");class Qh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=7*e;return this.float32[I+0]=o,this.float32[I+1]=u,this.float32[I+2]=d,this.float32[I+3]=g,this.float32[I+4]=y,this.float32[I+5]=T,this.float32[I+6]=C,e}}Qh.prototype.bytesPerElement=28,Zt(Qh,"StructArrayLayout7f28");class mp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O){const L=this.length;return this.resize(L+1),this.emplace(L,e,o,u,d,g,y,T,C,I,N,O)}emplace(e,o,u,d,g,y,T,C,I,N,O,L){const V=11*e;return this.float32[V+0]=o,this.float32[V+1]=u,this.float32[V+2]=d,this.float32[V+3]=g,this.float32[V+4]=y,this.float32[V+5]=T,this.float32[V+6]=C,this.float32[V+7]=I,this.float32[V+8]=N,this.float32[V+9]=O,this.float32[V+10]=L,e}}mp.prototype.bytesPerElement=44,Zt(mp,"StructArrayLayout11f44");class nf extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I){const N=this.length;return this.resize(N+1),this.emplace(N,e,o,u,d,g,y,T,C,I)}emplace(e,o,u,d,g,y,T,C,I,N){const O=9*e;return this.float32[O+0]=o,this.float32[O+1]=u,this.float32[O+2]=d,this.float32[O+3]=g,this.float32[O+4]=y,this.float32[O+5]=T,this.float32[O+6]=C,this.float32[O+7]=I,this.float32[O+8]=N,e}}nf.prototype.bytesPerElement=36,Zt(nf,"StructArrayLayout9f36");class Zu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,o)}emplace(e,o,u){const d=2*e;return this.float32[d+0]=o,this.float32[d+1]=u,e}}Zu.prototype.bytesPerElement=8,Zt(Zu,"StructArrayLayout2f8");class ko extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,u,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,o,u,d)}emplace(e,o,u,d,g){const y=6*e;return this.uint32[3*e+0]=o,this.uint16[y+2]=u,this.uint16[y+3]=d,this.uint16[y+4]=g,e}}ko.prototype.bytesPerElement=12,Zt(ko,"StructArrayLayout1ul3ui12");class Ys extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}Ys.prototype.bytesPerElement=2,Zt(Ys,"StructArrayLayout1ui2");class Xu extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te)}emplace(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae){const fe=16*e;return this.float32[fe+0]=o,this.float32[fe+1]=u,this.float32[fe+2]=d,this.float32[fe+3]=g,this.float32[fe+4]=y,this.float32[fe+5]=T,this.float32[fe+6]=C,this.float32[fe+7]=I,this.float32[fe+8]=N,this.float32[fe+9]=O,this.float32[fe+10]=L,this.float32[fe+11]=V,this.float32[fe+12]=H,this.float32[fe+13]=K,this.float32[fe+14]=te,this.float32[fe+15]=ae,e}}Xu.prototype.bytesPerElement=64,Zt(Xu,"StructArrayLayout16f64");class ed extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,u,d,g,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,e,o,u,d,g,y,T)}emplace(e,o,u,d,g,y,T,C){const I=10*e,N=5*e;return this.uint16[I+0]=o,this.uint16[I+1]=u,this.uint16[I+2]=d,this.uint16[I+3]=g,this.float32[N+2]=y,this.float32[N+3]=T,this.float32[N+4]=C,e}}ed.prototype.bytesPerElement=20,Zt(ed,"StructArrayLayout4ui3f20");class gp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.int16[1*e+0]=o,e}}gp.prototype.bytesPerElement=2,Zt(gp,"StructArrayLayout1i2");class rf extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint8[1*e+0]=o,e}}rf.prototype.bytesPerElement=1,Zt(rf,"StructArrayLayout1ub1");class Rm extends Xh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Rm.prototype.size=40;class td extends fp{get(e){return new Rm(this,e)}}Zt(td,"CollisionBoxArray");class Nm extends Xh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Nm.prototype.size=60;class yp extends Wu{get(e){return new Nm(this,e)}}Zt(yp,"PlacedSymbolArray");class Dm extends Xh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Dm.prototype.size=80;class Om extends Pm{get(e){return new Dm(this,e)}}Zt(Om,"SymbolInstanceArray");class sf extends mc{getoffsetX(e){return this.float32[1*e+0]}}Zt(sf,"GlyphOffsetArray");class _p extends Hl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(_p,"SymbolLineVertexArray");class Lm extends Xh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lm.prototype.size=12;class xp extends ko{get(e){return new Lm(this,e)}}Zt(xp,"FeatureIndexArray");class of extends yc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(of,"FillExtrusionCentroidArray");class Fg extends Xh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Fg.prototype.size=6;class zm extends Kh{get(e){return new Fg(this,e)}}Zt(zm,"FillExtrusionWallArray");const jm=Tr([{name:"a_pos",components:2,type:"Int16"}],4),Bg=Tr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ku=Tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class si{constructor(e=[]){this.segments=e}_prepareSegment(e,o,u,d){let g=this.segments[this.segments.length-1];return e>si.MAX_VERTEX_ARRAY_LENGTH&&Hn(`Max vertices per segment is ${si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>si.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g}prepareSegment(e,o,u,d){return this._prepareSegment(e,o.length,u.length,d)}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,u,d){return new si([{vertexOffset:e,primitiveOffset:o,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function Vg(a,e){return 256*(a=Ee(Math.floor(a),0,255))+Ee(Math.floor(e),0,255)}si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(si,"SegmentVector");const af=Tr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lf=Tr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Fm=Tr([{name:"a_dash",components:4,type:"Uint16"}]);class nd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,o,u,d){this.ids.push(Yu(e)),this.positions.push(o,u,d)}eachPosition(e,o){const u=Yu(e);let d=0,g=this.ids.length-1;for(;d<g;){const y=d+g>>1;this.ids[y]>=u?g=y:d=y+1}for(;this.ids[d]===u;)o(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(e,o){const u=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Js(u,d,0,u.length-1),o&&(o.add(u.buffer),o.add(d.buffer)),{ids:u,positions:d}}static deserialize(e){const o=new nd;let u;o.ids=e.ids,o.positions=e.positions;for(const d of o.ids)d!==u&&o.uniqueIds.push(d),u=d;return o.indexed=!0,o}}function Yu(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Su(String(a))}function Js(a,e,o,u){for(;o<u;){const d=a[o+u>>1];let g=o-1,y=u+1;for(;;){do g++;while(a[g]<d);do y--;while(a[y]>d);if(g>=y)break;cf(a,g,y),cf(e,3*g,3*y),cf(e,3*g+1,3*y+1),cf(e,3*g+2,3*y+2)}y-o<u-y?(Js(a,e,o,y),o=y+1):(Js(a,e,y+1,u),u=y)}}function cf(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}Zt(nd,"FeaturePositionMap");class xc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,o),this.initialized=!0),!!this.location}set(e,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ju extends xc{constructor(e){super(e),this.current=0}set(e,o,u){this.fetchUniformLocation(e,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Xr extends xc{constructor(e){super(e),this.current=0}set(e,o,u){this.fetchUniformLocation(e,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class ql extends xc{constructor(e){super(e),this.current=[0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class qn extends xc{constructor(e){super(e),this.current=[0,0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class vc extends xc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,o,u){this.fetchUniformLocation(e,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class vp extends xc{constructor(e){super(e),this.current=Ir.transparent.toPremultipliedRenderColor(null)}set(e,o,u){this.fetchUniformLocation(e,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const Ug=new Float32Array(16);class rd extends xc{constructor(e){super(e),this.current=Ug}set(e,o,u){if(this.fetchUniformLocation(e,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Qu=new Float32Array(9),Na=new Float32Array(4);class eh extends xc{constructor(e){super(e),this.current=Na}set(e,o,u){if(this.fetchUniformLocation(e,o)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function bp(a){return[Vg(255*a.r,255*a.g),Vg(255*a.b,255*a.a)]}class id{constructor(e,o,u,d){this.value=e,this.uniformNames=o.map(g=>`u_${g}`),this.type=u,this.context=d}setUniform(e,o,u,d,g){const y=d.constantOr(this.value);o.set(e,g,y instanceof Ir?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(e,o){return this.type==="color"?new vp(e):new Xr(e)}}class th{constructor(e,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,o){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=o?o.tl.concat(o.br):this.pattern}setUniform(e,o,u,d,g){let y=null;g!=="u_pattern"&&g!=="u_dash"||(y=this.pattern),g==="u_pattern_b"&&(y=this.patternTransition),g==="u_pixel_ratio"&&(y=this.pixelRatio),y&&o.set(e,g,y)}getBinding(e,o){return o==="u_pattern"||o==="u_pattern_b"||o==="u_dash"?new vc(e):new Xr(e)}}class _l{constructor(e,o,u,d){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,o,u,d,g,y,T,C){const I=this.paintVertexArray.length,N=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Hr(0,{brightness:y,worldview:C}),o,{},g,d,T):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:y,worldview:C}),o,{},g,d,T):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(I,e,N,O?null:this.context.lut)}updatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T,worldview:C},u,d,void 0,g):this.expression.kind==="constant"&&this.expression.value,N=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:T,worldview:C}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,o,I,N?null:this.context.lut)}_setPaintValue(e,o,u,d){if(this.type==="color"){const g=bp(u.toPremultipliedRenderColor(d));for(let y=e;y<o;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=e;g<o;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Da{constructor(e,o,u,d,g,y){this.expression=e,this.uniformNames=o.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=d,this.context=g,this.maxValue=0,this.paintVertexAttributes=o.map(T=>({name:`a_${T}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.evaluate(new Hr(this.context.zoom,{brightness:y,worldview:C}),o,{},g,d,T),N=this.expression.evaluate(new Hr(this.context.zoom+1,{brightness:y,worldview:C}),o,{},g,d,T),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:y,worldview:C}),o,{},g,d,T):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,I,N,O?null:this.context.lut)}updatePaintArray(e,o,u,d,g,y,T,C){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:T,worldview:C},u,d,void 0,g),N=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T,worldview:C},u,d,void 0,g),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hr(0,{brightness:T,worldview:C}),u,d,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(e,o,I,N,O?null:this.context.lut)}_setPaintValue(e,o,u,d,g){if(this.type==="color"){const y=bp(u.toPremultipliedRenderColor(g)),T=bp(u.toPremultipliedRenderColor(g));for(let C=e;C<o;C++)this.paintVertexArray.emplace(C,y[0],y[1],T[0],T[1])}else{for(let y=e;y<o;y++)this.paintVertexArray.emplace(y,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o,u,d,g){const y=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,T=Ee(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);o.set(e,g,T)}getBinding(e,o){return new Xr(e)}}class Yi{constructor(e,o,u,d,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=(u==="array"?Fm:af).members;for(let y=0;y<o.length;++y);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Qd}populatePaintArray(e,o,u,d){const g=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(g,e,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(e,o,u,d,g,y,T){this._setPaintValues(e,o,u.patterns&&u.patterns[this.layerId],y)}_setPaintValues(e,o,u,d){if(!d||!u)return;const g=d[u[0]],y=d[u[1]];if(g){if(g){const{tl:T,br:C,pixelRatio:I}=g;for(let N=e;N<o;N++)this.paintVertexArray.emplace(N,T[0],T[1],C[0],C[1],I)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:C}=y;for(let I=e;I<o;I++)this.paintTransitionVertexArray.emplace(I,T[0],T[1],C[0],C[1])}}}upload(e){const o=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,o)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,lf.members,o))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Po{constructor(e,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const d=[];for(const g in e.paint._values){const y=e.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(y instanceof Vl&&Uh(y.property.specification)))continue;const T=c(g,e.type),C=y.value,I=y.property.specification.type,N=!!y.property.useIntegerZoom,O=g==="line-dasharray"||g.endsWith("pattern"),L=e.paint.get(`${g}-use-theme`),V=g==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(C.kind!=="constant"||V)if(C.kind==="source"||V||O){const H=S(g,I,"source");this.binders[g]=O?new Yi(C,T,I,H,e.id):new _l(C,T,I,H),d.push(`/a_${g}`)}else{const H=S(g,I,"composite");this.binders[g]=new Da(C,T,I,N,o,H),d.push(`/z_${g}`)}else this.binders[g]=O?new th(C.value,T):new id(C.value,T,I,o),d.push(`/u_${g}`);L&&(this.binders[g].lutExpression=L.value)}this.cacheKey=d.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof _l||o instanceof Da?o.maxValue:0}populatePaintArrays(e,o,u,d,g,y,T,C){for(const I in this.binders){const N=this.binders[I];N.context=this.context,(N instanceof _l||N instanceof Da||N instanceof Yi)&&N.populatePaintArray(e,o,u,d,g,y,T,C)}}setConstantPatternPositions(e,o){for(const u in this.binders){const d=this.binders[u];d instanceof th&&d.setConstantPatternPositions(e,o)}}getPatternTransitionVertexBuffer(e){const o=this.binders[e];return o instanceof Yi?o.paintTransitionVertexBuffer:null}updatePaintArrays(e,o,u,d,g,y,T,C,I,N){let O=!1;const L=Object.keys(e),V=L.length!==0&&!C,H=V?L:o.uniqueIds;this.context.lut=g.lut;for(const K in this.binders){const te=this.binders[K];if(te.context=this.context,(te instanceof _l||te instanceof Da||te instanceof Yi)&&te.expression&&te.expression.kind&&te.expression.kind!=="constant"&&(te.expression.isStateDependent===!0||te.expression.isLightConstant===!1)){const ae=g.paint.get(K);te.expression=ae.value;for(const fe of H){const pe=e[fe.toString()];o.eachPosition(fe,(Q,he,me)=>{const _e=d.feature(Q);te.updatePaintArray(he,me,_e,pe,y,T,I,N)})}if(!V)for(const fe of u.uniqueIds){const pe=e[fe.toString()];u.eachPosition(fe,(Q,he,me)=>{const _e=d.feature(Q);te.updatePaintArray(he,me,_e,pe,y,T,I,N)})}O=!0}}return O}defines(){const e=[];for(const o in this.binders){const u=this.binders[o];(u instanceof id||u instanceof th)&&e.push(...u.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof _l||u instanceof Da||u instanceof Yi)for(let d=0;d<u.paintVertexAttributes.length;d++)e.push(u.paintVertexAttributes[d].name);if(u instanceof Yi)for(let d=0;d<lf.members.length;d++)e.push(lf.members[d].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof id||u instanceof th||u instanceof Da)for(const d of u.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const o=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof id||d instanceof th||d instanceof Da)for(const g of d.uniformNames)o.push({name:g,property:u,binding:d.getBinding(e,g)})}return o}setUniforms(e,o,u,d,g){for(const{name:y,property:T,binding:C}of u)this.binders[T].setUniform(e,C,g,d.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const o=this.binders[e];(o instanceof _l||o instanceof Da||o instanceof Yi)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer),o instanceof Yi&&o.paintTransitionVertexBuffer&&this._buffers.push(o.paintTransitionVertexBuffer)}}upload(e){for(const o in this.binders){const u=this.binders[o];(u instanceof _l||u instanceof Da||u instanceof Yi)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof _l||o instanceof Da||o instanceof Yi)&&o.destroy()}}}class f{constructor(e,o,u=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new Po(d,o,u);this.needsUpload=!1,this._featureMap=new nd,this._featureMapWithoutIds=new nd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,o,u,d,g,y,T,C,I){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(e,o,d,g,y,T,C,I);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,u,d,g,y,T,C){for(const I of u)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,o,I,d,g,y,T||0,C)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const r={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function c(a,e){return r[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const p={"line-pattern":{source:yl,composite:yl},"fill-pattern":{source:yl,composite:yl},"fill-extrusion-pattern":{source:yl,composite:yl},"line-dasharray":{source:Qd,composite:Qd}},x={color:{source:Zu,composite:Ps},number:{source:mc,composite:Zu}};function S(a,e,o){const u=p[a];return u&&u[o]||x[e][o]}Zt(id,"ConstantBinder"),Zt(th,"PatternConstantBinder"),Zt(_l,"SourceExpressionBinder"),Zt(Yi,"PatternCompositeBinder"),Zt(Da,"CompositeExpressionBinder"),Zt(Po,"ProgramConfiguration",{omit:["_buffers"]}),Zt(f,"ProgramConfigurationSet");const E=jt/Math.PI/2,M=5,R=6,z=16383,F=64,G=[F,32,16],$=-E,q=E;function ne(a,e,o,u=E){return o=Sr(o),[a*Math.sin(o)*u,-e*u,a*Math.cos(o)*u]}function J(a,e,o){return ne(Math.cos(Sr(a)),Math.sin(Sr(a)),e,o)}const ie=63710088e-1,oe=2*Math.PI*ie;class ce{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ce(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,u=this.lat*o,d=e.lat*o,g=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((e.lng-this.lng)*o);return ie*Math.acos(Math.min(g,1))}toBounds(e=0){const o=360*e/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new ge({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(e){return J(this.lat,this.lng,E+e*E/ie)}static convert(e){if(e instanceof ce)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ce(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ce(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ge{constructor(e,o){if(e)if(o)this.setSouthWest(e).setNorthEast(o);else if(e.length===4){const u=e;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=e;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(e){return this._ne=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}setSouthWest(e){return this._sw=e instanceof ce?new ce(e.lng,e.lat):ce.convert(e),this}extend(e){const o=this._sw,u=this._ne;let d,g;if(e instanceof ce)d=e,g=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(ce.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ce.convert(e)):this;if(d=e._sw,g=e._ne,!d||!g)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new ce(d.lng,d.lat),this._ne=new ce(g.lng,g.lat)),this}getCenter(){return new ce((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ce(this.getWest(),this.getNorth())}getSouthEast(){return new ce(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=ce.convert(e);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){if(e)return e instanceof ge?e:new ge(e)}}const xe=0,Ce=25.5;function Ae(a){return oe*Math.cos(a*Math.PI/180)}function Te(a){return(180+a)/360}function be(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Ie(a,e){return a/Ae(e)}function Re(a){return 360*a-180}function Be(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Ge(a,e){return a*Ae(Be(e))}const st=85.051129;function it(a){return Math.cos(Sr(Ee(a,-85.051129,st)))}function mt(a,e){const o=Ee(e,xe,Ce),u=Math.pow(2,o);return it(a)*oe/(512*u)}function Ue(a){return 1/Math.cos(a*Math.PI/180)}function Je(a,e=0){const o=Math.exp(Math.PI*(1-(a.y+e/jt)/(1<<a.z)*2));return 80150034*o/(o*o+1)/jt/(1<<a.z)}class Le{constructor(e,o,u=0){this.x=+e,this.y=+o,this.z=+u}static fromLngLat(e,o=0){const u=ce.convert(e);return new Le(Te(u.lng),be(u.lat),Ie(o,u.lat))}toLngLat(){return new ce(Re(this.x),Be(this.y))}toAltitude(){return Ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/oe*Ue(Be(this.y))}}function lt(a,e,o,u,d,g,y,T,C){const I=(e+u)/2,N=(o+d)/2,O=new Ot(I,N);T(O),function(L,V,H,K,te,ae){const fe=H-te,pe=K-ae;return Math.abs((K-V)*fe-(H-L)*pe)/Math.hypot(fe,pe)}(O.x,O.y,g.x,g.y,y.x,y.y)>=C?(lt(a,e,o,I,N,g,O,T,C),lt(a,I,N,u,d,O,y,T,C)):a.push(y)}function Ye(a,e,o){let u=a[0],d=u.x,g=u.y;e(u);const y=[u];for(let T=1;T<a.length;T++){const C=a[T],{x:I,y:N}=C;e(C),lt(y,d,g,I,N,u,C,e,o),d=I,g=N,u=C}return y}function pt(a,e,o,u){if(u(e,o)){const d=e.add(o)._mult(.5);pt(a,e,d,u),pt(a,d,o,u)}else a.push(o)}function It(a,e){let o=a[0];const u=[o];for(let d=1;d<a.length;d++){const g=a[d];pt(u,o,g,e),o=g}return u}const ct=Math.pow(2,14)-1,wt=-ct-1;function Vt(a,e){const o=Math.round(a.x*e),u=Math.round(a.y*e);return a.x=Ee(o,wt,ct),a.y=Ee(u,wt,ct),(o<a.x||o>a.x+1||u<a.y||u>a.y+1)&&Hn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function qt(a,e,o){const u=a.loadGeometry(),d=a.extent,g=jt/d;if(e&&o&&o.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:T,x:C,y:I,projection:N}=o,O=L=>{const V=Re((e.x+L.x/d)/y),H=Be((e.y+L.y/d)/y),K=N.project(V,H);L.x=(K.x*T-C)*d,L.y=(K.y*T-I)*d};for(let L=0;L<u.length;L++)if(a.type!==1)u[L]=Ye(u[L],O,1);else{const V=[];for(const H of u[L])H.x<0||H.x>=d||H.y<0||H.y>=d||(O(H),V.push(H));u[L]=V}}for(const y of u)for(const T of y)Vt(T,g);return u}function Bt(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?qt(a):[]}}var Xt,hn,yn,Ln,Qn,br,oi,Vr={};function Pr(){if(hn)return Xt;hn=1;var a=Ga();function e(d,g,y,T,C){this.properties={},this.extent=y,this.type=0,this._pbf=d,this._geometry=-1,this._keys=T,this._values=C,d.readFields(o,this,g)}function o(d,g,y){d==1?g.id=y.readVarint():d==2?function(T,C){for(var I=T.readVarint()+T.pos;T.pos<I;){var N=C._keys[T.readVarint()],O=C._values[T.readVarint()];C.properties[N]=O}}(y,g):d==3?g.type=y.readVarint():d==4&&(g._geometry=y.pos)}function u(d){for(var g,y,T=0,C=0,I=d.length,N=I-1;C<I;N=C++)T+=((y=d[N]).x-(g=d[C]).x)*(g.y+y.y);return T}return Xt=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var g,y=d.readVarint()+d.pos,T=1,C=0,I=0,N=0,O=[];d.pos<y;){if(C<=0){var L=d.readVarint();T=7&L,C=L>>3}if(C--,T===1||T===2)I+=d.readSVarint(),N+=d.readSVarint(),T===1&&(g&&O.push(g),g=[]),g.push(new a(I,N));else{if(T!==7)throw new Error("unknown command "+T);g&&g.push(g[0].clone())}}return g&&O.push(g),O},e.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var g=d.readVarint()+d.pos,y=1,T=0,C=0,I=0,N=1/0,O=-1/0,L=1/0,V=-1/0;d.pos<g;){if(T<=0){var H=d.readVarint();y=7&H,T=H>>3}if(T--,y===1||y===2)(C+=d.readSVarint())<N&&(N=C),C>O&&(O=C),(I+=d.readSVarint())<L&&(L=I),I>V&&(V=I);else if(y!==7)throw new Error("unknown command "+y)}return[N,L,O,V]},e.prototype.toGeoJSON=function(d,g,y){var T,C,I=this.extent*Math.pow(2,y),N=this.extent*d,O=this.extent*g,L=this.loadGeometry(),V=e.types[this.type];function H(ae){for(var fe=0;fe<ae.length;fe++){var pe=ae[fe];ae[fe]=[360*(pe.x+N)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+O)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(T=0;T<L.length;T++)K[T]=L[T][0];H(L=K);break;case 2:for(T=0;T<L.length;T++)H(L[T]);break;case 3:for(L=function(ae){var fe=ae.length;if(fe<=1)return[ae];for(var pe,Q,he=[],me=0;me<fe;me++){var _e=u(ae[me]);_e!==0&&(Q===void 0&&(Q=_e<0),Q===_e<0?(pe&&he.push(pe),pe=[ae[me]]):pe.push(ae[me]))}return pe&&he.push(pe),he}(L),T=0;T<L.length;T++)for(C=0;C<L[T].length;C++)H(L[T][C])}L.length===1?L=L[0]:V="Multi"+V;var te={type:"Feature",geometry:{type:V,coordinates:L},properties:this.properties};return"id"in this&&(te.id=this.id),te},Xt}function $i(){if(Ln)return yn;Ln=1;var a=Pr();function e(u,d){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(o,this,d),this.length=this._features.length}function o(u,d,g){u===15?d.version=g.readVarint():u===1?d.name=g.readString():u===5?d.extent=g.readVarint():u===2?d._features.push(g.pos):u===3?d._keys.push(g.readString()):u===4&&d._values.push(function(y){for(var T=null,C=y.readVarint()+y.pos;y.pos<C;){var I=y.readVarint()>>3;T=I===1?y.readString():I===2?y.readFloat():I===3?y.readDouble():I===4?y.readVarint64():I===5?y.readVarint():I===6?y.readSVarint():I===7?y.readBoolean():null}return T}(g))}return yn=e,e.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var d=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,d,this.extent,this._keys,this._values)},yn}function Vn(){return oi||(oi=1,Vr.VectorTile=function(){if(br)return Qn;br=1;var a=$i();function e(o,u,d){if(o===3){var g=new a(d,d.readVarint()+d.pos);g.length&&(u[g.name]=g)}}return Qn=function(o,u){this.layers=o.readFields(e,{},u)},Qn}(),Vr.VectorTileFeature=Pr(),Vr.VectorTileLayer=$i()),Vr}var er=Vn();const cr="3d_elevation_id",ai="level";class Ji{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,o){return this._valid&&e(o(this._geometry)),this}require(e,o,u){return this.get(e,!0,o,u)}optional(e,o,u){return this.get(e,!1,o,u)}success(){return this._valid}get(e,o,u,d){const g=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(d?d(g):g):o&&(this._valid=!1),this}}class hi{constructor(e,o){this.featureFunc=e,this.vertexFunc=o}parseFeature(e,o,u){return this.featureFunc(e,o,u)}parseVertex(e,o,u){return this.vertexFunc(e,o,u)}}const Lr=new hi((a,e,o)=>a.reset(e).require(cr,u=>{o.id=u}).optional("fixed_height_relative",u=>{o.constantHeight=u},vr.decodeRelativeHeight).geometry(u=>{o.bounds=u},ym).success(),(a,e,o)=>a.reset(e).require(cr,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height_relative",u=>{o.height=u},vr.decodeRelativeHeight).geometry(u=>{o.position=u},vr.getPoint).success()),Fi=new hi((a,e,o)=>a.reset(e).require(cr,u=>{o.id=u}).optional("fixed_height",u=>{o.constantHeight=u},vr.decodeMetricHeight).geometry(u=>{o.bounds=u},ym).success(),(a,e,o)=>a.reset(e).require(cr,u=>{o.id=u}).require("elevation_idx",u=>{o.idx=u}).require("extent",u=>{o.extent=u}).require("height",u=>{o.height=u},vr.decodeMetricHeight).geometry(u=>{o.position=u},vr.getPoint).success());class vr{static getPoint(e){return go(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const o=[],u=[],d=e.length,g=new Ji;for(let T=0;T<d;T++){const C=e.feature(T),I=C.properties.hasOwnProperty("version")?String(C.properties.version):void 0,N=(y=I)?y==="1.0.1"?Fi:void 0:Lr;if(N===void 0){Hn(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const O=C.properties.hasOwnProperty("type")?C.properties.type:void 0;if(O){if(er.VectorTileFeature.types[C.type]==="Point"&&O==="curve_point"){const L={};N.parseVertex(g,C,L)&&o.push(L)}else if(er.VectorTileFeature.types[C.type]==="Polygon"&&O==="curve_meta"){const L={};N.parseFeature(g,C,L)&&u.push(L)}}}var y;return{vertices:o,features:u}}}class Bi{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,u){const d=On(o,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class gi{constructor(e,o){this.pos=e,this.dir=o}intersectsPlane(e,o,u){const d=cn(o,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((e[0]-this.pos[0])*o[0]+(e[1]-this.pos[1])*o[1]+(e[2]-this.pos[2])*o[2])/d;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,o,u){if(function(V,H){var K=V[0],te=V[1],ae=V[2],fe=H[0],pe=H[1],Q=H[2];return Math.abs(K-fe)<=A*Math.max(1,Math.abs(K),Math.abs(fe))&&Math.abs(te-pe)<=A*Math.max(1,Math.abs(te),Math.abs(pe))&&Math.abs(ae-Q)<=A*Math.max(1,Math.abs(ae),Math.abs(Q))}(this.pos,e)||o===0)return u[0]=u[1]=u[2]=0,!1;const[d,g,y]=this.dir,T=this.pos[0]-e[0],C=this.pos[1]-e[1],I=this.pos[2]-e[2],N=d*d+g*g+y*y,O=2*(T*d+C*g+I*y),L=O*O-4*N*(T*T+C*C+I*I-o*o);if(L<0){const V=Math.max(-O/2,0),H=T+d*V,K=C+g*V,te=I+y*V,ae=Math.hypot(H,K,te);return u[0]=H*o/ae,u[1]=K*o/ae,u[2]=te*o/ae,!1}{const V=(-O-Math.sqrt(L))/(2*N);if(V<0){const H=Math.hypot(T,C,I);return u[0]=T*o/H,u[1]=C*o/H,u[2]=I*o/H,!1}return u[0]=T+d*V,u[1]=C+g*V,u[2]=I+y*V,!0}}}class Gr{constructor(e,o,u,d,g){this.TL=e,this.TR=o,this.BR=u,this.BL=d,this.horizon=g}static fromInvProjectionMatrix(e,o,u){const d=[-1,1,1],g=[1,1,1],y=[1,-1,1],T=[-1,-1,1],C=An(d,d,e),I=An(g,g,e),N=An(y,y,e),O=An(T,T,e);return new Gr(C,I,N,O,o/u)}}function di(a,e,o){let u=1/0,d=-1/0;const g=[];for(const y of a){Or(g,y,e);const T=cn(g,o);u=Math.min(u,T),d=Math.max(d,T)}return[u,d]}function Xn(a,e){let o=!0;for(let u=0;u<a.planes.length;u++){const d=a.planes[u];let g=0;for(let y=0;y<e.length;y++)g+=cn(d,e[y])+d[3]>=0;if(g===0)return 0;g!==e.length&&(o=!1)}return o?2:1}function Gi(a,e){for(const o of a.projections){const u=di(e,a.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function Bs(a,e){let o=0;const u=[0,0,0,0];for(let y=0;y<a.length;y++)u[0]=a[y][0],u[1]=a[y][1],u[2]=a[y][2],u[3]=1,(d=u)[0]*(g=e)[0]+d[1]*g[1]+d[2]*g[2]+d[3]*g[3]>=0&&o++;var d,g;return o}class wi{constructor(e,o){this.points=e||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=Dr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Or([],this.points[2],this.points[3]),Or([],this.points[0],this.points[3]),Or([],this.points[4],this.points[0]),Or([],this.points[5],this.points[1]),Or([],this.points[6],this.points[2]),Or([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:d,projection:di(this.points,this.points[0],d)}),this.projections.push({axis:g,projection:di(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(e,o,u,d){const g=Math.pow(2,u),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const N=zi([],I,e),O=1/N[3]/o*g;return(L=N)[0]=(V=N)[0]*(H=[O,O,d?1/N[3]:O,O])[0],L[1]=V[1]*H[1],L[2]=V[2]*H[2],L[3]=V[3]*H[3],L;var L,V,H}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const N=Nn([],un([],Or([],y[I[0]],y[I[1]]),Or([],y[I[2]],y[I[1]]))),O=-cn(N,y[I[1]]);return N.concat(O)}),C=[];for(let I=0;I<y.length;I++)C.push([y[I][0],y[I][1],y[I][2]]);return new wi(C,T)}intersectsPrecise(e,o,u){for(let d=0;d<o.length;d++)if(!Bs(e,o[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Bs(e,this.planes[d]))return 0;for(const d of u)for(const g of this.frustumEdges){const y=un([],d,g),T=Bn(y);if(T===0)continue;Ht(y,y,1/T);const C=di(this.points,this.points[0],y),I=di(e,this.points[0],y);if(C[0]>I[1]||I[0]>C[1])return 0}return 1}containsPoint(e){for(const o of this.planes){const u=o[3];if(cn([o[0],o[1],o[2]],e)+u<0)return!1}return!0}}class Dr{static fromPoints(e){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of e)gt(o,o,d),Jt(u,u,d);return new Dr(o,u)}static fromTileIdAndHeight(e,o,u){const d=1<<e.canonical.z,g=e.canonical.x,y=e.canonical.y;return new Dr([g/d,y/d,o],[(g+1)/d,(y+1)/d,u])}static applyTransform(e,o){const u=e.getCorners();for(let d=0;d<u.length;++d)An(u[d],u[d],o);return Dr.fromPoints(u)}static applyTransformFast(e,o){const u=[o[12],o[13],o[14]],d=[...u];for(let g=0;g<3;g++)for(let y=0;y<3;y++){const T=o[4*y+g],C=T*e.min[y],I=T*e.max[y];u[g]+=Math.min(C,I),d[g]+=Math.max(C,I)}return new Dr(u,d)}static projectAabbCorners(e,o){const u=e.getCorners();for(let d=0;d<u.length;++d)An(u[d],u[d],o);return u}constructor(e,o){this.min=e,this.max=o,this.center=Ht([],wn([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],u=Tn(this.min),d=Tn(this.max);for(let g=0;g<o.length;g++)u[g]=o[g]?this.min[g]:this.center[g],d[g]=o[g]?this.center[g]:this.max[g];return d[2]=this.max[2],new Dr(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,o=this.max;return[[e[0],e[1],e[2]],[o[0],e[1],e[2]],[o[0],o[1],e[2]],[e[0],o[1],e[2]],[e[0],e[1],o[2]],[o[0],e[1],o[2]],[o[0],o[1],o[2]],[e[0],o[1],o[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Xn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Xn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,o){return o||this.intersects(e)?Gi(e,this.getCorners()):0}intersectsPreciseFlat(e,o){return o||this.intersectsFlat(e)?Gi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let o=0;o<3;++o)if(this.min[o]>e.max[o]||e.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e.min[o]),this.max[o]=Math.max(this.max[o],e.max[o])}encapsulatePoint(e){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],e[o]),this.max[o]=Math.max(this.max[o],e[o])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Zt(Dr,"Aabb");class Zo{constructor(e,o){this.feature=e,this.metersToTile=o,this.index=0}get(){const e=this.feature.vertices[this.index],o=this.feature.vertexProps[this.index].dir,u=o[1],d=-o[0],g=(e.extent+1)*this.metersToTile;return[new Ot(Math.trunc(e.position[0]+u*g),Math.trunc(e.position[1]+d*g)),new Ot(Math.trunc(e.position[0]-u*g),Math.trunc(e.position[1]-d*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Ro{constructor(e,o,u,d,g,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:u,max:u},this.safeArea=o,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=g,this.edges=this.edges.filter(T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((C=this.vertices[T.a].position)[0]===(I=this.vertices[T.b].position)[0]&&C[1]===I[1]);var C,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:go(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const C=this.vertices[T.a].position,I=this.vertices[T.b].position,N=Ea(ss(),I,C),O=As(N),L=Ca(ss(),N,1/O);this.edgeProps.push({vec:N,dir:L,len:O});const V=this.vertexProps[T.a].dir,H=this.vertexProps[T.b].dir;Ta(V,V,L),Ta(H,H,L)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||$a(T.dir,T.dir);this.tessellate(y)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const o=this.getClosestEdge(e);if(o==null)return 0;const[u,d]=o;return Mn(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(e,o){const u=this.getClosestEdge(e);if(!u)return Ft(0,0,1);const d=u[0],g=this.edges[d],y=this.edgeProps[d].vec,T=Ft(y[0],y[1],(this.vertices[g.b].height-this.vertices[g.a].height)*o),C=Ft(T[1],-T[0],0);un(C,C,T);const I=Bn(C);return I>0?Ht(C,C,1/I):Ft(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let o=0,u=Number.POSITIVE_INFINITY,d=0;const g=go(e.x,e.y);for(let y=0;y<this.edges.length;y++){const T=this.edges[y],C=this.edgeProps[y].dir,I=new Bi(g,this.edgeProps[y].dir),N=this.vertices[T.a].position,O=this.vertices[T.b].position,L=ss(),V=ss(),H=I.intersectsPlane(N,this.vertexProps[T.a].dir,L),K=I.intersectsPlane(O,this.vertexProps[T.b].dir,V);if(!H||!K)continue;const te=Ea(ss(),V,L),ae=Ea(ss(),g,L),fe=On(te,te),pe=fe>0?On(ae,te)/fe:0,Q=Ee(pe,0,1),he=Math.abs((pe-Q)*this.edgeProps[y].len),me=Ea(ss(),g,N),_e=he+Math.abs(On(me,go(C[1],-C[0])));_e<u&&(o=y,u=_e,d=Q)}return[o,d]}tessellate(e){for(let o=this.edges.length-1;o>=0;--o){const u=this.edges[o].a,d=this.edges[o].b,{position:g,height:y,extent:T}=this.vertices[u],{position:C,height:I,extent:N}=this.vertices[d],O=this.vertexProps[u].dir,L=this.vertexProps[d].dir,V=Ft(g[0]/e,g[1]/e,y),H=Ft(C[0]/e,C[1]/e,I),K=Ft(O[1],-O[0],0);Ht(K,K,T);const te=Ft(L[1],-L[0],0);if(Ht(te,te,N),this.distSqLines(Ft(V[0]+.5*K[0],V[1]+.5*K[1],V[2]+.5*K[2]),Ft(H[0]-.5*te[0],H[1]-.5*te[1],H[2]-.5*te[2]),Ft(V[0]-.5*K[0],V[1]-.5*K[1],V[2]-.5*K[2]),Ft(H[0]+.5*te[0],H[1]+.5*te[1],H[2]+.5*te[2]))<=.0025000000000000005)continue;const ae=this.vertices.length,fe=Ta(ss(),g,C);this.vertices.push({position:Ca(fe,fe,.5),height:.5*(y+I),extent:.5*(T+N)});const pe=Ta(ss(),O,L);this.vertexProps.push({dir:$a(pe,pe)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:u,b:ae}),this.edges.push({a:ae,b:d});const Q=Ea(ss(),this.vertices[ae].position,g),he=As(Q),me={vec:Q,dir:Ca(ss(),Q,1/he),len:he};this.edgeProps.push(me),this.edgeProps.push(me)}}distSqLines(e,o,u,d){const g=Yt(xn(),o,e),y=Yt(xn(),d,u),T=Yt(xn(),e,u),C=cn(g,g),I=cn(g,y),N=cn(g,T),O=cn(y,y),L=cn(y,T),V=C*O-I*I;if(V===0){const te=cn(T,y)/cn(y,y);return Ct($n(xn(),u,d,te),e)}const H=(I*L-N*O)/V,K=(C*L-I*N)/V;return Ct($n(xn(),e,o,H),$n(xn(),u,d,K))}}class Oa{static parseFrom(e,o){const u=vr.parse(e);if(!u)return[];let{vertices:d,features:g}=u;const y=1/Je(o);g.sort((N,O)=>N.id-O.id),d.sort((N,O)=>N.id-O.id||N.idx-O.idx),d=d.filter((N,O,L)=>O===L.findIndex(V=>V.id===N.id&&V.idx===N.idx));const T=new Array;let C=0;const I=d.length;for(const N of g){if(N.constantHeight){T.push(new Ro(N.id,N.bounds,N.constantHeight));continue}for(;C!==I&&d[C].id<N.id;)C++;if(C===I||d[C].id!==N.id)continue;const O=new Array,L=new Array,V=C;for(;C!==I&&d[C].id===N.id;){const H=d[C];if(O.push({position:H.position,height:H.height,extent:H.extent}),C!==V&&d[C-1].idx===H.idx-1){const K=C-V;L.push({a:K-1,b:K})}C++}T.push(new Ro(N.id,N.bounds,void 0,O,L,y))}return T}static getElevationFeature(e,o){if(!o)return;const u=+e.properties[cr];return Number.isNaN(u)?void 0:o.find(d=>d.id===u)}}class ws{constructor(e,o){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(o)||(this.zScale=Math.pow(2,o.z-e.z),this.xOffset=(e.x*this.zScale-o.x)*jt,this.yOffset=(e.y*this.zScale-o.y)*jt)}constantElevation(e,o){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,o)}pointElevation(e,o,u){const d=this.constantElevation(o,u);return d??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(o.pointElevation(e),u))}computeBiasedHeight(e,o){return o<=0?e:e+o*ze(0,o,e>=0?e:Math.abs(.5*e))}}Zt(Ro,"ElevationFeature");class da{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Hl,this.indexArray=new Rs,this.segments=new si,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new mc),this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){const g=this.layers[0],y=[];let T=null;g.type==="circle"&&(T=g.layout.get("circle-sort-key"));for(const{feature:I,id:N,index:O,sourceLayerIndex:L}of e){const V=this.layers[0]._featureFilter.needGeometry,H=Bt(I,V);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),H,u))continue;const K=T?T.evaluate(H,{},u):void 0,te={id:N,properties:I.properties,type:I.type,sourceLayerIndex:L,index:O,geometry:V?H.geometry:qt(I,u,d),patterns:{},sortKey:K};y.push(te)}T&&y.sort((I,N)=>I.sortKey-N.sortKey);let C=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new dp,C=d.projection);for(const I of y){const{geometry:N,index:O,sourceLayerIndex:L}=I,V=e[O].feature;this.addFeature(I,N,O,o.availableImages,u,C,o.brightness,o.elevationFeatures),o.featureIndex.insert(V,N,O,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,o,u,d,g,y,T){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ku.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Bg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,o,u,d,g,y,T,C){let I;this.elevationMode!=="none"&&(I=Oa.getElevationFeature(e,C));for(const N of o)for(const O of N){const L=O.x,V=O.y;if(L<0||L>=jt||V<0||V>=jt)continue;if(y){const te=y.projectTilePoint(L,V,g),ae=y.upVector(g,L,V);this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae),this.addGlobeExtVertex(te,ae)}const H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),K=H.vertexLength;if(this.addCircleVertex(L,V,-1,-1),this.addCircleVertex(L,V,1,-1),this.addCircleVertex(L,V,1,1),this.addCircleVertex(L,V,-1,1),this.elevationMode!=="none"){const te=I?I.pointElevation(new Ot(L,V)):0;this.hasElevation=this.hasElevation||te!==0;for(let ae=0;ae<4;ae++)this.elevatedLayoutVertexArray.emplaceBack(te)}this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),H.vertexLength+=4,H.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},d,g,T,void 0,this.worldview)}addCircleVertex(e,o,u,d){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*o+(d+1)/2)}addGlobeExtVertex(e,o){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}}function Xo(a,e){for(let o=0;o<a.length;o++)if(xl(e,a[o]))return!0;for(let o=0;o<e.length;o++)if(xl(a,e[o]))return!0;return!!su(a,e)}function Ko(a,e,o){return!!xl(a,e)||!!nh(e,a,o)}function fa(a,e){if(a.length===1)return hf(e,a[0]);for(let o=0;o<e.length;o++){const u=e[o];for(let d=0;d<u.length;d++)if(xl(a,u[d]))return!0}for(let o=0;o<a.length;o++)if(hf(e,a[o]))return!0;for(let o=0;o<e.length;o++)if(su(a,e[o]))return!0;return!1}function pa(a,e,o){if(a.length>1){if(su(a,e))return!0;for(let u=0;u<e.length;u++)if(nh(e[u],a,o))return!0}for(let u=0;u<a.length;u++)if(nh(a[u],e,o))return!0;return!1}function su(a,e){if(a.length===0||e.length===0)return!1;for(let o=0;o<a.length-1;o++){const u=a[o],d=a[o+1];for(let g=0;g<e.length-1;g++)if(uf(u,d,e[g],e[g+1]))return!0}return!1}function uf(a,e,o,u){return ri(a,o,u)!==ri(e,o,u)&&ri(a,e,o)!==ri(a,e,u)}function ou(a,e,o){return(a.x-o.x)*(e.y-o.y)-(a.y-o.y)*(e.x-o.x)}function Bm(a,e,o,u){const d=ou(a,e,u),g=ou(a,e,o);if(Math.sign(d)===Math.sign(g))return;const y=ou(o,u,a),T=y+g-d;return Math.sign(y)!==Math.sign(T)?[y/(y-T),g/(g-d)]:void 0}function nh(a,e,o){const u=o*o;if(e.length===1)return a.distSqr(e[0])<u;for(let d=1;d<e.length;d++)if(wp(a,e[d-1],e[d])<u)return!0;return!1}function wp(a,e,o){const u=e.distSqr(o);if(u===0)return a.distSqr(e);const d=((a.x-e.x)*(o.x-e.x)+(a.y-e.y)*(o.y-e.y))/u;return a.distSqr(d<0?e:d>1?o:o.sub(e)._mult(d)._add(e))}function hf(a,e){let o,u,d,g=!1;for(let y=0;y<a.length;y++){o=a[y];for(let T=0,C=o.length-1;T<o.length;C=T++)u=o[T],d=o[C],u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(g=!g)}return g}function xl(a,e){let o=!1;for(let u=0,d=a.length-1;u<a.length;d=u++){const g=a[u],y=a[d];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(o=!o)}return o}function bc(a,e,o,u,d){for(const y of a)if(e<=y.x&&o<=y.y&&u>=y.x&&d>=y.y)return!0;const g=[new Ot(e,o),new Ot(e,d),new Ot(u,d),new Ot(u,o)];if(a.length>2){for(const y of g)if(xl(a,y))return!0}for(let y=0;y<a.length-1;y++)if(Wl(a[y],a[y+1],g))return!0;return!1}function Wl(a,e,o){const u=o[0],d=o[2];if(a.x<u.x&&e.x<u.x||a.x>d.x&&e.x>d.x||a.y<u.y&&e.y<u.y||a.y>d.y&&e.y>d.y)return!1;const g=ri(a,e,o[0]);return g!==ri(a,e,o[1])||g!==ri(a,e,o[2])||g!==ri(a,e,o[3])}function wc(a,e,o,u,d,g){let y=e.y-a.y,T=a.x-e.x;if(g=g||0){const C=y*y+T*T;if(C===0)return!0;const I=Math.sqrt(C);y/=I,T/=I}return!((o.x-a.x)*y+(o.y-a.y)*T-g<0||(u.x-a.x)*y+(u.y-a.y)*T-g<0||(d.x-a.x)*y+(d.y-a.y)*T-g<0)}function Vm(a,e,o,u,d,g,y){return!(wc(a,e,u,d,g,y)||wc(e,o,u,d,g,y)||wc(o,a,u,d,g,y)||wc(u,d,a,e,o,y)||wc(d,g,a,e,o,y)||wc(g,u,a,e,o,y))}function Sp(a,e,o){const u=e.paint.get(a).value;return u.kind==="constant"?u.value:o.programConfigurations.get(e.id).getMaxValue(a)}function Um(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function $g(a,e,o,u,d){if(!e[0]&&!e[1])return a;const g=Ot.convert(e)._mult(d);o==="viewport"&&g._rotate(-u);const y=[];for(let T=0;T<a.length;T++)y.push(a[T].sub(g));return y}function $m(a,e,o,u){const d=Ot.convert(a)._mult(u);return e==="viewport"&&d._rotate(-o),d}let Hg,Hm;function Qy(a,e,o){var u=2*Math.PI*6378137/256/Math.pow(2,o);return[a*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}Zt(da,"CircleBucket",{omit:["layers"]});class df{constructor(e,o,u){this.z=e,this.x=o,this.y=u,this.key=au(0,e,e,o,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const u=function(g,y,T){var C=Qy(256*g,256*(y=Math.pow(2,T)-y-1),T),I=Qy(256*(g+1),256*(y+1),T);return C[0]+","+C[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),d=function(g,y,T){let C,I="";for(let N=g;N>0;N--)C=1<<N-1,I+=(y&C?1:0)+(T&C?2:0);return I}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Gm{constructor(e,o){this.wrap=e,this.canonical=o,this.key=au(e,o.z,o.z,o.x,o.y)}}class No{constructor(e,o,u,d,g){this.overscaledZ=e,this.wrap=o,this.canonical=new df(u,+d,+g),this.key=o===0&&e===u?this.canonical.key:au(o,e,u,d,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new No(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new No(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return au(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return au(this.wrap*+o,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new No(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new No(o,this.wrap,o,u,d),new No(o,this.wrap,o,u+1,d),new No(o,this.wrap,o,u,d+1),new No(o,this.wrap,o,u+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new No(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new No(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Gm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function au(a,e,o,u,d){const g=1<<Math.min(o,22);let y=g*(d%g)+u%g;return a&&o<22&&(y+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-o)))),16*(32*y+o)+(e-o)}const R1=[a=>{let e=a.canonical.x-1,o=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,o--),new No(a.overscaledZ,o,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,o=a.wrap;return e===1<<a.canonical.z&&(e=0,o++),new No(a.overscaledZ,o,a.canonical.z,e,a.canonical.y)},a=>new No(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new No(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Zt(df,"CanonicalTileID"),Zt(No,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Gg=Tr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_}=Gg,w=Tr([{name:"a_pos_3",components:3,type:"Int16"}]);var k=Tr([{name:"a_pos",type:"Int16",components:2}]);function B(a){return a*E/ie}const Z=[new Dr([$,$,$],[q,q,q]),new Dr([$,$,$],[0,0,q]),new Dr([0,$,$],[q,0,q]),new Dr([$,0,$],[0,q,q]),new Dr([0,0,$],[q,q,q])];function se(a,e,o,u=!0){const d=Ht([],a._camera.position,a.worldSize),g=[e,o,1,1];zi(g,g,a.pixelMatrixInverse),mo(g,g,1/g[3]);const y=Nn([],Or([],g,d)),T=a.globeMatrix,C=[T[12],T[13],T[14]],I=Or([],C,d),N=Bn(I),O=Nn([],I),L=a.worldSize/(2*Math.PI),V=cn(O,y),H=Math.asin(L/N);if(H<Math.acos(V)){if(!u)return null;const Oe=[],Ve=[];Ht(Oe,y,N/V),Nn(Ve,Or(Ve,Oe,I)),Nn(y,wn(y,I,Ht(y,Ve,Math.tan(H)*N)))}const K=[];new gi(d,y).closestPointOnSphere(C,L,K);const te=Nn([],Ui(T,0)),ae=Nn([],Ui(T,1)),fe=Nn([],Ui(T,2)),pe=cn(te,K),Q=cn(ae,K),he=cn(fe,K),me=Ke(Math.asin(-Q/L));let _e=Ke(Math.atan2(pe,he));_e=a.center.lng+function(Oe,Ve){const tt=(Ve-Oe+180)%360-180;return tt<-180?tt+360:tt}(a.center.lng,_e);const De=Te(_e),Pe=Ee(be(me),0,1);return new Le(De,Pe)}class we{constructor(e,o,u){this.a=Or([],e,u),this.b=Or([],o,u),this.center=u;const d=Nn([],this.a),g=Nn([],this.b);this.angle=Math.acos(cn(d,g))}}function He(a,e){if(a.angle===0)return null;let o;return o=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),o<0||o>1?null:function(u,d,g,y){const T=Math.sin(g);return u*(Math.sin((1-y)*g)/T)+d*(Math.sin(y*g)/T)}(a.a[e],a.b[e],a.angle,Ee(o,0,1))+a.center[e]}function Qe(a){if(a.z<=1)return Z[a.z+2*a.y+a.x];const e=Wn(an(a));return Dr.fromPoints(e)}function Et(a,e,o){return Ht(a,a,1-o),qe(a,a,e,o)}function dn(a,e,o){for(const u of a)An(u,u,e),Ht(u,u,o)}function mn(a,e,o,u){const d=e/a.worldSize,g=a.globeMatrix;if(o.z<=1){const Pe=Qe(o).getCorners();return dn(Pe,g,d),Dr.fromPoints(Pe)}const y=an(o,u),T=Wn(y,E+B(a._tileCoverLift));dn(T,g,d);const C=Number.MAX_VALUE,I=[-C,-C,-C],N=[C,C,C];if(y.contains(a.center)){for(const Ve of T)gt(N,N,Ve),Jt(I,I,Ve);I[2]=0;const Pe=a.point,Oe=[Pe.x*d,Pe.y*d,0];return gt(N,N,Oe),Jt(I,I,Oe),new Dr(N,I)}if(a._tileCoverLift>0){for(const Pe of T)gt(N,N,Pe),Jt(I,I,Pe);return new Dr(N,I)}const O=[g[12]*d,g[13]*d,g[14]*d],L=y.getCenter(),V=Ee(a.center.lat,-85.051129,st),H=Ee(L.lat,-85.051129,st),K=Te(a.center.lng),te=be(V);let ae=K-Te(L.lng);const fe=te-be(H);ae>.5?ae-=1:ae<-.5&&(ae+=1);let pe=0;Math.abs(ae)>Math.abs(fe)?pe=ae>=0?1:3:(pe=fe>=0?0:2,qe(O,O,[g[4]*d,g[5]*d,g[6]*d],-Math.sin(Sr(fe>=0?y.getSouth():y.getNorth()))*E));const Q=T[pe],he=T[(pe+1)%4],me=new we(Q,he,O),_e=[He(me,0)||Q[0],He(me,1)||Q[1],He(me,2)||Q[2]],De=pr(a.zoom);if(De>0){const Pe=function({x:Ve,y:tt,z:vt},ft,xt,St,rt){const _t=1/(1<<vt);let et=Ve*_t,nt=et+_t,Mt=tt*_t,Pt=Mt+_t,_n=0;const nn=(et+nt)/2-St;return nn>.5?_n=-1:nn<-.5&&(_n=1),et=((et+_n)*ft-(St*=ft))*xt+St,nt=((nt+_n)*ft-St)*xt+St,Mt=(Mt*ft-(rt*=ft))*xt+rt,Pt=(Pt*ft-rt)*xt+rt,[[et,Pt,0],[nt,Pt,0],[nt,Mt,0],[et,Mt,0]]}(o,e,a._pixelsPerMercatorPixel,K,te);for(let Ve=0;Ve<T.length;Ve++)Et(T[Ve],Pe[Ve],De);const Oe=wn([],Pe[pe],Pe[(pe+1)%4]);Ht(Oe,Oe,.5),Et(_e,Oe,De)}for(const Pe of T)gt(N,N,Pe),Jt(I,I,Pe);return N[2]=Math.min(Q[2],he[2]),gt(N,N,_e),Jt(I,I,_e),new Dr(N,I)}function an({x:a,y:e,z:o},u=!1){const d=1/(1<<o),g=new ce(Re(a*d),e===(1<<o)-1&&u?-90:Be((e+1)*d)),y=new ce(Re((a+1)*d),e===0&&u?90:Be(e*d));return new ge(g,y)}function Wn(a,e=E){const o=Sr(a.getNorth()),u=Sr(a.getSouth()),d=Math.cos(o),g=Math.cos(u),y=Math.sin(o),T=Math.sin(u),C=a.getWest(),I=a.getEast();return[ne(g,T,C,e),ne(g,T,I,e),ne(d,y,I,e),ne(d,y,C,e)]}function tr(a,e,o,u){const d=1<<o.z,g=(a/jt+o.x)/d;return J(Be((e/jt+o.y)/d),Re(g),u)}function or({min:a,max:e}){return z/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const Vs=new Float64Array(16);function yt(a){const e=or(a),o=kt(Vs,[e,e,e]);return Me(o,o,Zn([],a.min))}function ut(a){const e=(u=a.min,(o=Vs)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=u[0],o[13]=u[1],o[14]=u[2],o[15]=1,o);var o,u;const d=1/or(a);return Fe(e,e,[d,d,d])}function bt(a){const e=jt/(2*Math.PI);return a/(2*Math.PI)/e}function Sn(a,e){return jt/(512*Math.pow(2,a))*or(Qe(e))}function dr(a,e,o,u,d){const g=bt(o),y=[a,e,-o/(2*Math.PI)],T=W(new Float64Array(16));return Me(T,T,y),Fe(T,T,[g,g,g]),ht(T,T,Sr(-d)),at(T,T,Sr(-u)),T}function pr(a){return ze(M,R,a)}function Er(a,e){const o=J(e.lat,e.lng),u=function(H){const K=J(H._center.lat,H._center.lng);let te=un([],Ft(0,1,0),K);const ae=Rt([],-H.angle,K);te=An(te,te,ae),Rt(ae,-H._pitch,te);const fe=Nn([],K);return Ht(fe,fe,B(H.cameraToCenterDistance/H.pixelsPerMeter)),An(fe,fe,ae),wn([],K,fe)}(a);return y=(d=Yt([],u,o))[0],T=d[1],C=d[2],I=(g=o)[0],N=g[1],O=g[2],V=(L=Math.sqrt(y*y+T*T+C*C)*Math.sqrt(I*I+N*N+O*O))&&cn(d,g)/L,Math.acos(Math.min(Math.max(V,-1),1));var d,g,y,T,C,I,N,O,L,V}function zr(a,e){return Er(a,e)>Math.PI/2*1.01}const vo=Sr(85),Zi=Math.cos(vo),sd=Math.sin(vo),N1=Y(),b2=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function w2(a,e,o,u,d,g,y,T,C){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(C*=a.pixelToTileUnitsFactor);const I=a.tileID.canonical,N=o.projection.upVectorScale(I,o.center.lat,o.worldSize).metersToTile;for(const O of e)for(const L of O){const V=L.add(T),H=d&&o.elevation?o.elevation.exaggeration()*d.getElevationAt(V.x,V.y,!0):0,K=o.projection.projectTilePoint(V.x,V.y,I);if(H>0){const pe=o.projection.upVector(I,V.x,V.y);K.x+=pe[0]*N*H,K.y+=pe[1]*N*H,K.z+=pe[2]*N*H}const te=g?V:rz(K.x,K.y,K.z,u),ae=g?a.tilespaceRays.map(pe=>sz(pe,H)):a.queryGeometry.screenGeometry,fe=zi([],[K.x,K.y,K.z,1],u);if(!y&&g?C*=fe[3]/o.cameraToCenterDistance:y&&!g&&(C*=o.cameraToCenterDistance/fe[3]),g){const pe=Be((L.y/jt+I.y)/(1<<I.z));C/=o.projection.pixelsPerMeter(pe,1)/Ie(1,pe)}if(Ko(ae,te,C))return!0}return!1}function rz(a,e,o,u){const d=zi([],[a,e,o,1],u);return new Ot(d[0]/d[3],d[1]/d[3])}const S2=Ft(0,0,0),iz=Ft(0,0,1);function sz(a,e){const o=xn();return S2[2]=e,a.intersectsPlane(S2,iz,o),new Ot(o[0],o[1])}class T2 extends da{}let E2,C2,A2,I2;function M2(a,{width:e,height:o},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*o*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*o*u);return a.width=e,a.height=o,a.data=d,a}function k2(a,e,o){const{width:u,height:d}=e;u===a.width&&d===a.height||(D1(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,d)},o,null),a.width=u,a.height=d,a.data=e.data)}function D1(a,e,o,u,d,g,y,T){if(d.width===0||d.height===0)return e;if(d.width>a.width||d.height>a.height||o.x>a.width-d.width||o.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||u.x>e.width-d.width||u.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const C=a.data,I=e.data,N=g===4&&T;for(let O=0;O<d.height;O++){const L=((o.y+O)*a.width+o.x)*g,V=((u.y+O)*e.width+u.x)*g;if(N)for(let H=0;H<d.width;H++){const K=L+H*g+3,te=V+H*g;I[te+0]=255,I[te+1]=255,I[te+2]=255,I[te+3]=C[K]}else if(y)for(let H=0;H<d.width;H++){const K=L+H*g,te=V+H*g,ae=new Ir(C[K+0]/255,C[K+1]/255,C[K+2]/255,C[K+3]).toNonPremultipliedRenderColor(y).toArray();I[te+0]=ae[0],I[te+1]=ae[1],I[te+2]=ae[2],I[te+3]=ae[3]}else for(let H=0;H<d.width*g;H++)I[V+H]=C[L+H]}return e}Zt(T2,"HeatmapBucket",{omit:["layers"]});class Tp{constructor(e,o){M2(this,e,1,o)}resize(e){k2(this,new Tp(e),1)}clone(){return new Tp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,d,g){D1(e,o,u,d,g,1,null)}}class Do{constructor(e,o){M2(this,e,4,o)}resize(e){k2(this,new Do(e),4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,u,d,g,y,T){D1(e,o,u,d,g,4,y,T)}}class P2{constructor(e,o){this.width=e.width,this.height=e.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}function e_(a){const e={},o=a.resolution||256,u=a.clips?a.clips.length:1,d=a.image||new Do({width:o,height:u}),g=(y,T,C)=>{e[a.evaluationKey]=C;const I=a.expression.evaluate(e),N=I?I.toNonPremultipliedRenderColor(null):null;N&&(d.data[y+T+0]=Math.floor(255*N.r),d.data[y+T+1]=Math.floor(255*N.g),d.data[y+T+2]=Math.floor(255*N.b),d.data[y+T+3]=Math.floor(255*N.a))};if(a.clips)for(let y=0,T=0;y<u;++y,T+=4*o)for(let C=0,I=0;C<o;C++,I+=4){const N=C/(o-1),{start:O,end:L}=a.clips[y];g(T,I,O*(1-N)+L*N)}else for(let y=0,T=0;y<o;y++,T+=4)g(0,T,y/(o-1));return d}Zt(Tp,"AlphaImage"),Zt(Do,"RGBAImage");const oz=Tr([{name:"a_pos",components:2,type:"Int16"}],4),az=Tr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),lz=Tr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),cz=Tr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function t_(a,e,o=2){const u=e&&e.length,d=u?e[0]*o:a.length;let g=R2(a,0,d,o,!0);const y=[];if(!g||g.next===g.prev)return y;let T,C,I;if(u&&(g=function(N,O,L,V){const H=[];for(let K=0,te=O.length;K<te;K++){const ae=R2(N,O[K]*V,K<te-1?O[K+1]*V:N.length,V,!1);ae===ae.next&&(ae.steiner=!0),H.push(yz(ae))}H.sort(pz);for(let K=0;K<H.length;K++)L=mz(H[K],L);return L}(a,e,g,o)),a.length>80*o){T=1/0,C=1/0;let N=-1/0,O=-1/0;for(let L=o;L<d;L+=o){const V=a[L],H=a[L+1];V<T&&(T=V),H<C&&(C=H),V>N&&(N=V),H>O&&(O=H)}I=Math.max(N-T,O-C),I=I!==0?32767/I:0}return n_(g,y,o,T,C,I,0),y}function R2(a,e,o,u,d){let g;if(d===function(y,T,C,I){let N=0;for(let O=T,L=C-I;O<C;O+=I)N+=(y[L]-y[O])*(y[O+1]+y[L+1]),L=O;return N}(a,e,o,u)>0)for(let y=e;y<o;y+=u)g=L2(y/u|0,a[y],a[y+1],g);else for(let y=o-u;y>=e;y-=u)g=L2(y/u|0,a[y],a[y+1],g);return g&&qg(g,g.next)&&(s_(g),g=g.next),g}function qm(a,e){if(!a)return a;e||(e=a);let o,u=a;do if(o=!1,u.steiner||!qg(u,u.next)&&Qs(u.prev,u,u.next)!==0)u=u.next;else{if(s_(u),u=e=u.prev,u===u.next)break;o=!0}while(o||u!==e);return e}function n_(a,e,o,u,d,g,y){if(!a)return;!y&&g&&function(C,I,N,O){let L=C;do L.z===0&&(L.z=O1(L.x,L.y,I,N,O)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==C);L.prevZ.nextZ=null,L.prevZ=null,function(V){let H,K=1;do{let te,ae=V;V=null;let fe=null;for(H=0;ae;){H++;let pe=ae,Q=0;for(let me=0;me<K&&(Q++,pe=pe.nextZ,pe);me++);let he=K;for(;Q>0||he>0&&pe;)Q!==0&&(he===0||!pe||ae.z<=pe.z)?(te=ae,ae=ae.nextZ,Q--):(te=pe,pe=pe.nextZ,he--),fe?fe.nextZ=te:V=te,te.prevZ=fe,fe=te;ae=pe}fe.nextZ=null,K*=2}while(H>1)}(L)}(a,u,d,g);let T=a;for(;a.prev!==a.next;){const C=a.prev,I=a.next;if(g?hz(a,u,d,g):uz(a))e.push(C.i,a.i,I.i),s_(a),a=I.next,T=I.next;else if((a=I)===T){y?y===1?n_(a=dz(qm(a),e),e,o,u,d,g,2):y===2&&fz(a,e,o,u,d,g):n_(qm(a),e,o,u,d,g,1);break}}}function uz(a){const e=a.prev,o=a,u=a.next;if(Qs(e,o,u)>=0)return!1;const d=e.x,g=o.x,y=u.x,T=e.y,C=o.y,I=u.y,N=Math.min(d,g,y),O=Math.min(T,C,I),L=Math.max(d,g,y),V=Math.max(T,C,I);let H=u.next;for(;H!==e;){if(H.x>=N&&H.x<=L&&H.y>=O&&H.y<=V&&r_(d,T,g,C,y,I,H.x,H.y)&&Qs(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function hz(a,e,o,u){const d=a.prev,g=a,y=a.next;if(Qs(d,g,y)>=0)return!1;const T=d.x,C=g.x,I=y.x,N=d.y,O=g.y,L=y.y,V=Math.min(T,C,I),H=Math.min(N,O,L),K=Math.max(T,C,I),te=Math.max(N,O,L),ae=O1(V,H,e,o,u),fe=O1(K,te,e,o,u);let pe=a.prevZ,Q=a.nextZ;for(;pe&&pe.z>=ae&&Q&&Q.z<=fe;){if(pe.x>=V&&pe.x<=K&&pe.y>=H&&pe.y<=te&&pe!==d&&pe!==y&&r_(T,N,C,O,I,L,pe.x,pe.y)&&Qs(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,Q.x>=V&&Q.x<=K&&Q.y>=H&&Q.y<=te&&Q!==d&&Q!==y&&r_(T,N,C,O,I,L,Q.x,Q.y)&&Qs(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;pe&&pe.z>=ae;){if(pe.x>=V&&pe.x<=K&&pe.y>=H&&pe.y<=te&&pe!==d&&pe!==y&&r_(T,N,C,O,I,L,pe.x,pe.y)&&Qs(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;Q&&Q.z<=fe;){if(Q.x>=V&&Q.x<=K&&Q.y>=H&&Q.y<=te&&Q!==d&&Q!==y&&r_(T,N,C,O,I,L,Q.x,Q.y)&&Qs(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function dz(a,e){let o=a;do{const u=o.prev,d=o.next.next;!qg(u,d)&&D2(u,o,o.next,d)&&i_(u,d)&&i_(d,u)&&(e.push(u.i,o.i,d.i),s_(o),s_(o.next),o=a=d),o=o.next}while(o!==a);return qm(o)}function fz(a,e,o,u,d,g){let y=a;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&_z(y,T)){let C=O2(y,T);return y=qm(y,y.next),C=qm(C,C.next),n_(y,e,o,u,d,g,0),void n_(C,e,o,u,d,g,0)}T=T.next}y=y.next}while(y!==a)}function pz(a,e){let o=a.x-e.x;return o===0&&(o=a.y-e.y,o===0)&&(o=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),o}function mz(a,e){const o=function(d,g){let y=g;const T=d.x,C=d.y;let I,N=-1/0;if(qg(d,y))return y;do{if(qg(d,y.next))return y.next;if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){const K=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(K<=T&&K>N&&(N=K,I=y.x<y.next.x?y:y.next,K===T))return I}y=y.next}while(y!==g);if(!I)return null;const O=I,L=I.x,V=I.y;let H=1/0;y=I;do{if(T>=y.x&&y.x>=L&&T!==y.x&&N2(C<V?T:N,C,L,V,C<V?N:T,C,y.x,y.y)){const K=Math.abs(C-y.y)/(T-y.x);i_(y,d)&&(K<H||K===H&&(y.x>I.x||y.x===I.x&&gz(I,y)))&&(I=y,H=K)}y=y.next}while(y!==O);return I}(a,e);if(!o)return e;const u=O2(o,a);return qm(u,u.next),qm(o,o.next)}function gz(a,e){return Qs(a.prev,a,e.prev)<0&&Qs(e.next,a,a.next)<0}function O1(a,e,o,u,d){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-o)*d|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function yz(a){let e=a,o=a;do(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next;while(e!==a);return o}function N2(a,e,o,u,d,g,y,T){return(d-y)*(e-T)>=(a-y)*(g-T)&&(a-y)*(u-T)>=(o-y)*(e-T)&&(o-y)*(g-T)>=(d-y)*(u-T)}function r_(a,e,o,u,d,g,y,T){return!(a===y&&e===T)&&N2(a,e,o,u,d,g,y,T)}function _z(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(o,u){let d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==u.i&&d.next.i!==u.i&&D2(d,d.next,o,u))return!0;d=d.next}while(d!==o);return!1}(a,e)&&(i_(a,e)&&i_(e,a)&&function(o,u){let d=o,g=!1;const y=(o.x+u.x)/2,T=(o.y+u.y)/2;do d.y>T!=d.next.y>T&&d.next.y!==d.y&&y<(d.next.x-d.x)*(T-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==o);return g}(a,e)&&(Qs(a.prev,a,e.prev)||Qs(a,e.prev,e))||qg(a,e)&&Qs(a.prev,a,a.next)>0&&Qs(e.prev,e,e.next)>0)}function Qs(a,e,o){return(e.y-a.y)*(o.x-e.x)-(e.x-a.x)*(o.y-e.y)}function qg(a,e){return a.x===e.x&&a.y===e.y}function D2(a,e,o,u){const d=kx(Qs(a,e,o)),g=kx(Qs(a,e,u)),y=kx(Qs(o,u,a)),T=kx(Qs(o,u,e));return d!==g&&y!==T||!(d!==0||!Mx(a,o,e))||!(g!==0||!Mx(a,u,e))||!(y!==0||!Mx(o,a,u))||!(T!==0||!Mx(o,e,u))}function Mx(a,e,o){return e.x<=Math.max(a.x,o.x)&&e.x>=Math.min(a.x,o.x)&&e.y<=Math.max(a.y,o.y)&&e.y>=Math.min(a.y,o.y)}function kx(a){return a>0?1:a<0?-1:0}function i_(a,e){return Qs(a.prev,a,a.next)<0?Qs(a,e,a.next)>=0&&Qs(a,a.prev,e)>=0:Qs(a,e,a.prev)<0||Qs(a,a.next,e)<0}function O2(a,e){const o=L1(a.i,a.x,a.y),u=L1(e.i,e.x,e.y),d=a.next,g=e.prev;return a.next=e,e.prev=a,o.next=d,d.prev=o,u.next=o,o.prev=u,g.next=u,u.prev=g,u}function L2(a,e,o,u){const d=L1(a,e,o);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function s_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function L1(a,e,o){return{i:a,x:e,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Px(a,e){const o=a.length;if(o<=1)return[a];const u=[];let d,g;for(let y=0;y<o;y++){const T=mr(a[y]);T!==0&&(a[y].area=Math.abs(T),g===void 0&&(g=T<0),g===T<0?(d&&u.push(d),d=[a[y]]):d.push(a[y]))}if(d&&u.push(d),e>1)for(let y=0;y<u.length;y++)u[y].length<=e||(ks(u[y],e,1,u[y].length-1,xz),u[y]=u[y].slice(0,e));return u}function xz(a,e){return e.area-a.area}function z2(a,e,o=1){if(!a)return null;const u=typeof a=="string"?Uo.from(a).getPrimary():a.getPrimary(),d=typeof a=="string"?null:a.getSecondary();for(const g of[u,d]){if(!g)continue;const y=g.id.toString();e.has(y)||e.set(y,[]),g.scaleSelf(o),e.get(y).push(g)}return{primary:u.toString(),secondary:d?d.toString():null}}function z1(a,e,o,u){const d=u.patternDependencies;let g=!1;for(const y of e){const T=y.paint.get(`${a}-pattern`);T.isConstant()||(g=!0),z2(T.constantOr(null),d,o)&&(g=!0)}return g}function j1(a,e,o,u,d,g){const y=g.patternDependencies;for(const T of e){const C=T.paint.get(`${a}-pattern`).value;if(C.kind!=="constant"){let I=C.evaluate({zoom:u},o,{},g.availableImages);I=I&&I.name?I.name:I;const N=z2(I,y,d);if(!N)continue;const{primary:O,secondary:L}=N;O&&(o.patterns[T.id]=[O,L].filter(Boolean))}}return o}class j2{constructor(){this.polygons=new Map}add(e,...o){this.polygons.has(e)?this.polygons.get(e).push(...o):this.polygons.set(e,o)}merge(e){for(const[o,u]of e.polygons)this.add(o,...u)}}class Wm{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Wm;let o=[];for(const I of e)o.push(...I.portals);if(o.length===0)return new Wm;const u=(I,N)=>I<=0&&N<=0||I>=jt&&N>=jt;for(const I of o){const N=I.va,O=I.vb;(u(N.x,O.x)||u(N.y,O.y))&&(I.type="border")}const d=o.filter(I=>I.type!=="unevaluated"),g=o.filter(I=>I.type==="unevaluated");if(g.length===0)return new Wm;g.sort((I,N)=>I.hash===N.hash?I.isTunnel===N.isTunnel?0:I.isTunnel?-1:1:I.hash<N.hash?1:-1),o=d.concat(g);let y=d.length,T=y,C=y;do if(T++,T===o.length||o[y].hash!==o[T].hash){if(T-y==2){C<y&&(o[C]=o[y],o[y]=null);const I=o[C],N=o[T-1];I.type=I.isTunnel!==N.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:N.connection.a},C++}y=T}while(y!==o.length);return o.splice(C),o.sort((I,N)=>I.hash<N.hash?1:-1),{portals:o}}}Zt(Wm,"ElevationPortalGraph"),Zt(j2,"ElevationPolygons");class vz{constructor(e,o,u){this.outPositions=e,this.outNormals=o,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,o,u){let d=e[2];u!=null&&(d*=u);const g=this.getVec3Bits(e)<<96n|this.getVec3Bits(o),y=this.vertexLookup.get(g);if(y!=null)return y;const T=this.outPositions.length;this.vertexLookup.set(g,T);const C=Math.trunc(16384*o[0]),I=Math.trunc(16384*o[1]),N=Math.trunc(16384*o[2]);return this.outPositions.emplaceBack(e[0],e[1],d),this.outNormals.emplaceBack(C,I,N),T}addVertices(e,o,...u){const d=[];for(const g of u){const y=this.addVertex(g,e,o);d.push(y)}return d}addTriangles(e,o,u){if(o&&u){const d=u.length===1,g=Ft(0,0,0);for(let y=0;y<e.length;y+=3){const T=o[e[y+0]],C=o[e[y+1]],I=o[e[y+2]],N=d?u[0]:u[e[y+1]],O=d?u[0]:u[e[y+2]],L=this.addVertex(Ft(T.x,T.y,d?u[0]:u[e[y+0]]),g),V=this.addVertex(Ft(C.x,C.y,N),g),H=this.addVertex(Ft(I.x,I.y,O),g);this.outIndices.emplaceBack(L,V,H)}}else for(let d=0;d<e.length;d+=3)this.outIndices.emplaceBack(e[d+0],e[d+1],e[d+2])}addQuad(e,o){const u=this.addVertices(o,void 0,...e.map(C=>Ft(C.coord.x,C.coord.y,C.height))),[d,g,y,T]=u;this.addTriangles([d,g,y,y,T,d])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Zl{constructor(e,o,u,d){this.unevaluatedPortals=new Wm,this.portalPolygons=new j2,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new km,this.vertexNormals=new up,this.indexArray=new Rs,this.tileToMeters=Je(e),this.bridgeProgramConfigurations=new f(o,{zoom:u,lut:d},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new f(o,{zoom:u,lut:d},g=>g!=="fill-bridge-guard-rail-color")}addVertices(e,o){const u=this.unevalVertices.length;for(let d=0;d<e.length;d++)this.unevalVertices.push(e[d]),this.unevalHeights.push(o[d]);return u}addTriangles(e,o,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of e)d.push(g+o)}addRenderableRing(e,o,u,d,g,y){const T=[new Ot(g.min.x,g.min.y),new Ot(g.max.x,g.min.y),new Ot(g.max.x,g.max.y),new Ot(g.min.x,g.max.y)];for(let C=0;C<u-1;C++){const I=o+C,N=I+1,O=this.unevalVertices[I],L=this.unevalVertices[N];if(!(O.x>=g.min.x&&O.x<=g.max.x&&O.y>=g.min.y&&O.y<=g.max.y||L.x>=g.min.x&&L.x<=g.max.x&&L.y>=g.min.y&&L.y<=g.max.y||Wl(O,L,T))||this.isOnBorder(O.x,L.x)||this.isOnBorder(O.y,L.y))continue;const V=Zl.computeEdgeHash(this.unevalVertices[I],this.unevalVertices[N]);let H,K=this.vertexHashLookup.get(Zl.computePosHash(O));K!=null?H=K.next:(K=this.vertexHashLookup.get(Zl.computePosHash(L)),H=K!=null?K.prev:V),this.unevalEdges.push({polygonIdx:e,a:I,b:N,hash:V,portalHash:H,isTunnel:d,type:"unevaluated",featureInfo:y})}}addPortalCandidates(e,o,u,d,g){if(o.length===0)return;this.portalPolygons.add(e,{geometry:o,zLevel:g});const y=o[0];this.vertexHashLookup.clear();let T=Zl.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let C=0;C<y.length-1;C++){const I=y[C+0],N=y[C+1],O=go(N.x-I.x,N.y-I.y),L=As(O);if(L===0)continue;let V="unevaluated";const H=d.pointElevation(I),K=d.pointElevation(N);Math.abs(H)<.01&&Math.abs(K)<.01?V="entrance":(this.isOnBorder(I.x,N.x)||this.isOnBorder(I.y,N.y))&&(V="border");const te=Zl.computeEdgeHash(I,N);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:I,vb:N,vab:O,length:L,hash:te,isTunnel:u,type:V});const ae=Zl.computePosHash(I);this.vertexHashLookup.set(ae,{prev:T,next:te}),T=te}}construct(e){if(this.unevalVertices.length===0)return;const o=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},d=new vz(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const g=o(),y=o(),T=o(),C=(L,V)=>{L.sort((K,te)=>K.type===V&&te.type!==V?-1:K.type!==V&&te.type===V?1:0);const H=L.findIndex(K=>K.type!==V);return H>=0?H:L.length};let I=0;this.unevalEdges.length>0&&(I=C(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters)),u(T);const N=o(),O=o();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(I),V=C(L,"tunnel")+I;this.unevalEdges.push(...L),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:V})}u(N),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(O),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(y),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=si.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.depthSegments=si.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=si.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableTunnelSegments=si.simpleSegment(0,N.primitiveOffset,0,N.primitiveLength),this.shadowCasterSegments=si.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(e,o,u,d,g,y,T,C){this.bridgeProgramConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C),this.tunnelProgramConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,lz.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,cz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,o,u,d,g){const y=(T,C)=>{for(let I=0;I<C.length-1;I++){const N=C[I].featureIndex,O=C[I+1].vertexStart,L=e.feature(N);T.populatePaintArrays(O,L,N,{},u,o,d,void 0,g)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,o,u,d,g){const y=new Map;for(let T=d;T<g;T++){const C=u[T],I=C.a,N=C.b,O=Zl.computePosHash(e[I]),L=Zl.computePosHash(e[N]);y.has(O)||y.set(O,{}),y.has(L)||y.set(L,{});const V=y.get(O),H=y.get(L);o[I]<=0&&o[N]<=0||(V.to=N,H.from=I)}return y}constructBridgeStructures(e,o,u,d,g,y){e.clearVertexLookup();const T=this.computeVertexConnections(o,u,d,g.min,g.max),C=1/y,I=.5*C,N=V=>Ft(o[V].x,o[V].y,u[V]*C),O=V=>{const H=T.get(Zl.computePosHash(o[V])),K=H.from,te=H.to;if(!K||!te)return;const ae=N(K),fe=N(V),pe=N(te),Q=Ft(0,0,0);if(!ni(ae,fe)){const me=Or(xn(),fe,ae);wn(Q,Q,Nn(me,me))}if(!ni(pe,fe)){const me=Or(xn(),pe,fe);wn(Q,Q,Nn(me,me))}const he=$s(Q);return he>0?Ht(Q,Q,1/he):void 0};let L=Number.POSITIVE_INFINITY;this.sortSubarray(d,g.min,g.max,(V,H)=>V.featureInfo.featureIndex-H.featureInfo.featureIndex);for(let V=g.min;V<g.max;V++){const H=d[V];if(!H.featureInfo.guardRailEnabled)continue;const K=this.prepareEdgePoints(o,u,H,(Gn,tn)=>Gn>tn);if(K==null)continue;const te=K[0],ae=K[1],fe=Ft(te.coord.x,te.coord.y,C*te.height),pe=Ft(ae.coord.x,ae.coord.y,C*ae.height);if(ni(fe,pe))continue;const Q=Or(xn(),pe,fe);Nn(Q,Q);const he=Gn=>Nn(Gn,Gn),me=O(H.a)||Q,_e=O(H.b)||Q,De=he(Ft(me[1],-me[0],0)),Pe=he(Ft(_e[1],-_e[0],0)),Oe=he(un(xn(),De,me)),Ve=he(un(xn(),Pe,_e)),tt=xn(),vt=[wn(xn(),fe,Ht(tt,Or(tt,De,Oe),I)),wn(xn(),fe,Ht(tt,wn(tt,De,Oe),I)),wn(xn(),fe,Ht(tt,Oe,I)),fe],ft=[wn(xn(),pe,Ht(tt,Or(tt,Pe,Ve),I)),wn(xn(),pe,Ht(tt,wn(tt,Pe,Ve),I)),wn(xn(),pe,Ht(tt,Ve,I)),pe];L=this.addFeatureSection(H.featureInfo.featureIndex,L,this.bridgeFeatureSections,e);const[xt,St]=e.addVertices(De,y,vt[0],vt[1]),[rt,_t]=e.addVertices(Pe,y,ft[0],ft[1]);e.addTriangles([xt,St,rt,St,_t,rt]);const[et,nt]=e.addVertices(Oe,y,vt[1],vt[2]),[Mt,Pt]=e.addVertices(Ve,y,ft[1],ft[2]);e.addTriangles([et,nt,Mt,nt,Pt,Mt]);const[_n,nn]=e.addVertices(Zn(De,De),y,vt[2],vt[3]),[$t,At]=e.addVertices(Zn(Pe,Pe),y,ft[2],ft[3]);e.addTriangles([_n,nn,$t,nn,At,$t])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,o,u,d,g,y){e.clearVertexLookup();let T=Number.POSITIVE_INFINITY;const C=(N,O)=>N.featureInfo.featureIndex-O.featureInfo.featureIndex;this.sortSubarray(d,g.min,g.max,C),this.sortSubarray(d,y.min,y.max,C);const I=N=>Nn(N,N);for(let N=g.min;N<g.max;N++){const O=this.prepareEdgePoints(o,u,d[N],(K,te)=>K<te);if(O==null)continue;const[L,V]=O,H=I(Ft(-(V.coord.y-L.coord.y),V.coord.x-L.coord.x,0));T=this.addFeatureSection(d[N].featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad([L,V,{coord:V.coord,height:d[N].isTunnel?-.1:0},{coord:L.coord,height:d[N].isTunnel?-.1:0}],H)}for(let N=y.min;N<y.max;N++){const O=d[N];O.isTunnel&&([O.a,O.b]=[O.b,O.a]);const L=o[O.a],V=o[O.b],H=I(Ft(-(V.y-L.y),V.x-L.x,0));T=this.addFeatureSection(O.featureInfo.featureIndex,T,this.tunnelFeatureSections,e),e.addQuad([{coord:V,height:0},{coord:L,height:0},{coord:L,height:u[O.a]+4},{coord:V,height:u[O.b]+4}],H),e.addQuad([{coord:L,height:0},{coord:V,height:0},{coord:V,height:u[O.b]+4},{coord:L,height:u[O.a]+4}],H)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,o,u,d){let g=o[u.a],y=o[u.b];const T=d(g,0),C=d(y,0);if(T&&C)return[{coord:e[u.a],height:g},{coord:e[u.b],height:y}];if(!T&&!C)return;const I=e[u.a].clone(),N=e[u.b].clone();if(T){if(!C){const O=y/(y-g);N.x=Mn(N.x,I.x,O),N.y=Mn(N.y,I.y,O),y=Mn(y,g,O)}}else{const O=g/(g-y);I.x=Mn(I.x,N.x,O),I.y=Mn(I.y,N.y,O),g=Mn(g,y,O)}return[{coord:I,height:g},{coord:N,height:y}]}prepareEdges(e,o){if(o.length===0)return;o.sort((T,C)=>T.hash===C.hash?C.polygonIdx-T.polygonIdx:C.hash>T.hash?1:-1);let u=0,d=0,g=0,y=o[u].polygonIdx;do d++,(d===o.length||o[u].hash!==o[d].hash)&&((d-u==1||o[d-1].polygonIdx!==y)&&(g<u&&(o[g]=o[u],o[u]=null),o[g].type="none",g++),u=d,u!==o.length&&(y=o[u].polygonIdx));while(u!==o.length);if(o.splice(g),o.length!==0&&e.length!==0){o.sort((I,N)=>I.portalHash<N.portalHash?1:-1);let T=0,C=0;for(;T!==o.length&&C!==e.length;){const I=o[T],N=e[C];I.portalHash>N.hash?T++:N.hash>I.portalHash?C++:(I.type=N.type,T++)}}}isOnBorder(e,o){return e<=0&&o<=0||e>=jt&&o>=jt}addFeatureSection(e,o,u,d){return e!==o&&(o=e,u.push({featureIndex:e,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),o}sortSubarray(e,o,u,d){const g=e.slice(o,u);g.sort(d),e.splice(o,g.length,...g)}static computeEdgeHash(e,o){return(e.y===o.y&&e.x>o.x||e.y>o.y)&&([e,o]=[o,e]),BigInt(Zl.computePosHash(e))<<32n|BigInt(Zl.computePosHash(o))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var F2,B2={exports:{}},V2=(F2||(F2=1,function(a,e){(function(o){function u(ye,Se){return ye>Se?1:ye<Se?-1:0}var d=function(ye,Se){ye===void 0&&(ye=u),Se===void 0&&(Se=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!Se},g={size:{configurable:!0}};function y(ye,Se,ot,Lt,Gt){var Ut=Gt-Lt;if(Ut>0){var en=Lt+Math.floor(Ut/2),zn={key:Se[en],data:ot[en],parent:ye};return zn.left=y(zn,Se,ot,Lt,en),zn.right=y(zn,Se,ot,en+1,Gt),zn}return null}function T(ye,Se,ot,Lt,Gt){if(!(ot>=Lt)){for(var Ut=ye[ot+Lt>>1],en=ot-1,zn=Lt+1;;){do en++;while(Gt(ye[en],Ut)<0);do zn--;while(Gt(ye[zn],Ut)>0);if(en>=zn)break;var gr=ye[en];ye[en]=ye[zn],ye[zn]=gr,gr=Se[en],Se[en]=Se[zn],Se[zn]=gr}T(ye,Se,ot,zn,Gt),T(ye,Se,zn+1,Lt,Gt)}}d.prototype.rotateLeft=function(ye){var Se=ye.right;Se&&(ye.right=Se.left,Se.left&&(Se.left.parent=ye),Se.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.left=ye),ye.parent=Se},d.prototype.rotateRight=function(ye){var Se=ye.left;Se&&(ye.left=Se.right,Se.right&&(Se.right.parent=ye),Se.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.right=ye),ye.parent=Se},d.prototype._splay=function(ye){for(;ye.parent;){var Se=ye.parent;Se.parent?Se.left===ye&&Se.parent.left===Se?(this.rotateRight(Se.parent),this.rotateRight(Se)):Se.right===ye&&Se.parent.right===Se?(this.rotateLeft(Se.parent),this.rotateLeft(Se)):Se.left===ye&&Se.parent.right===Se?(this.rotateRight(Se),this.rotateLeft(Se)):(this.rotateLeft(Se),this.rotateRight(Se)):Se.left===ye?this.rotateRight(Se):this.rotateLeft(Se)}},d.prototype.splay=function(ye){for(var Se,ot,Lt,Gt,Ut;ye.parent;)(ot=(Se=ye.parent).parent)&&ot.parent?((Lt=ot.parent).left===ot?Lt.left=ye:Lt.right=ye,ye.parent=Lt):(ye.parent=null,this._root=ye),Gt=ye.left,Ut=ye.right,ye===Se.left?(ot&&(ot.left===Se?(Se.right?(ot.left=Se.right,ot.left.parent=ot):ot.left=null,Se.right=ot,ot.parent=Se):(Gt?(ot.right=Gt,Gt.parent=ot):ot.right=null,ye.left=ot,ot.parent=ye)),Ut?(Se.left=Ut,Ut.parent=Se):Se.left=null,ye.right=Se,Se.parent=ye):(ot&&(ot.right===Se?(Se.left?(ot.right=Se.left,ot.right.parent=ot):ot.right=null,Se.left=ot,ot.parent=Se):(Ut?(ot.left=Ut,Ut.parent=ot):ot.left=null,ye.right=ot,ot.parent=ye)),Gt?(Se.right=Gt,Gt.parent=Se):Se.right=null,ye.left=Se,Se.parent=ye)},d.prototype.replace=function(ye,Se){ye.parent?ye===ye.parent.left?ye.parent.left=Se:ye.parent.right=Se:this._root=Se,Se&&(Se.parent=ye.parent)},d.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},d.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},d.prototype.insert=function(ye,Se){var ot=this._root,Lt=null,Gt=this._compare;if(this._noDuplicates)for(;ot;){if(Lt=ot,Gt(ot.key,ye)===0)return;ot=Gt(ot.key,ye)<0?ot.right:ot.left}else for(;ot;)Lt=ot,ot=Gt(ot.key,ye)<0?ot.right:ot.left;return ot={key:ye,data:Se,left:null,right:null,parent:Lt},Lt?Gt(Lt.key,ot.key)<0?Lt.right=ot:Lt.left=ot:this._root=ot,this.splay(ot),this._size++,ot},d.prototype.find=function(ye){for(var Se=this._root,ot=this._compare;Se;){var Lt=ot(Se.key,ye);if(Lt<0)Se=Se.right;else{if(!(Lt>0))return Se;Se=Se.left}}return null},d.prototype.contains=function(ye){for(var Se=this._root,ot=this._compare;Se;){var Lt=ot(ye,Se.key);if(Lt===0)return!0;Se=Lt<0?Se.left:Se.right}return!1},d.prototype.remove=function(ye){var Se=this.find(ye);if(!Se)return!1;if(this.splay(Se),Se.left)if(Se.right){var ot=this.minNode(Se.right);ot.parent!==Se&&(this.replace(ot,ot.right),ot.right=Se.right,ot.right.parent=ot),this.replace(Se,ot),ot.left=Se.left,ot.left.parent=ot}else this.replace(Se,Se.left);else this.replace(Se,Se.right);return this._size--,!0},d.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var Se=this.minNode(ye.right);Se.parent!==ye&&(this.replace(Se,Se.right),Se.right=ye.right,Se.right.parent=Se),this.replace(ye,Se),Se.left=ye.left,Se.left.parent=Se}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},d.prototype.erase=function(ye){var Se=this.find(ye);if(Se){this.splay(Se);var ot=Se.left,Lt=Se.right,Gt=null;ot&&(ot.parent=null,Gt=this.maxNode(ot),this.splay(Gt),this._root=Gt),Lt&&(ot?Gt.right=Lt:this._root=Lt,Lt.parent=Gt),this._size--}},d.prototype.pop=function(){var ye=this._root,Se=null;if(ye){for(;ye.left;)ye=ye.left;Se={key:ye.key,data:ye.data},this.remove(ye.key)}return Se},d.prototype.next=function(ye){var Se=ye;if(Se)if(Se.right)for(Se=Se.right;Se&&Se.left;)Se=Se.left;else for(Se=ye.parent;Se&&Se.right===ye;)ye=Se,Se=Se.parent;return Se},d.prototype.prev=function(ye){var Se=ye;if(Se)if(Se.left)for(Se=Se.left;Se&&Se.right;)Se=Se.right;else for(Se=ye.parent;Se&&Se.left===ye;)ye=Se,Se=Se.parent;return Se},d.prototype.forEach=function(ye){for(var Se=this._root,ot=[],Lt=!1,Gt=0;!Lt;)Se?(ot.push(Se),Se=Se.left):ot.length>0?(ye(Se=ot.pop(),Gt++),Se=Se.right):Lt=!0;return this},d.prototype.range=function(ye,Se,ot,Lt){for(var Gt=[],Ut=this._compare,en=this._root;Gt.length!==0||en;)if(en)Gt.push(en),en=en.left;else{if(Ut((en=Gt.pop()).key,Se)>0)break;if(Ut(en.key,ye)>=0&&ot.call(Lt,en))return this;en=en.right}return this},d.prototype.keys=function(){for(var ye=this._root,Se=[],ot=[],Lt=!1;!Lt;)ye?(Se.push(ye),ye=ye.left):Se.length>0?(ye=Se.pop(),ot.push(ye.key),ye=ye.right):Lt=!0;return ot},d.prototype.values=function(){for(var ye=this._root,Se=[],ot=[],Lt=!1;!Lt;)ye?(Se.push(ye),ye=ye.left):Se.length>0?(ye=Se.pop(),ot.push(ye.data),ye=ye.right):Lt=!0;return ot},d.prototype.at=function(ye){for(var Se=this._root,ot=[],Lt=!1,Gt=0;!Lt;)if(Se)ot.push(Se),Se=Se.left;else if(ot.length>0){if(Se=ot.pop(),Gt===ye)return Se;Gt++,Se=Se.right}else Lt=!0;return null},d.prototype.load=function(ye,Se,ot){if(ye===void 0&&(ye=[]),Se===void 0&&(Se=[]),ot===void 0&&(ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Lt=ye.length;return ot&&T(ye,Se,0,Lt-1,this._compare),this._root=y(null,ye,Se,0,Lt),this._size=Lt,this},d.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},d.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},d.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},d.createTree=function(ye,Se,ot,Lt,Gt){return new d(ot,Gt).load(ye,Se,Lt)},Object.defineProperties(d.prototype,g);var C=0,I=1,N=2,O=3,L=0,V=1,H=2,K=3;function te(ye,Se,ot){Se===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===Se.isSubject?(ye.inOut=!Se.inOut,ye.otherInOut=Se.otherInOut):(ye.inOut=!Se.otherInOut,ye.otherInOut=Se.isVertical()?!Se.inOut:Se.inOut),Se&&(ye.prevInResult=!ae(Se,ot)||Se.isVertical()?Se.prevInResult:Se));var Lt=ae(ye,ot);ye.resultTransition=Lt?function(Gt,Ut){var en,zn=!Gt.inOut,gr=!Gt.otherInOut;switch(Ut){case L:en=zn&&gr;break;case V:en=zn||gr;break;case K:en=zn^gr;break;case H:en=Gt.isSubject?zn&&!gr:gr&&!zn}return en?1:-1}(ye,ot):0}function ae(ye,Se){switch(ye.type){case C:switch(Se){case L:return!ye.otherInOut;case V:return ye.otherInOut;case H:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case K:return!0}break;case N:return Se===L||Se===V;case O:return Se===H;case I:return!1}return!1}var fe=function(ye,Se,ot,Lt,Gt){this.left=Se,this.point=ye,this.otherEvent=ot,this.isSubject=Lt,this.type=Gt||C,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},pe={inResult:{configurable:!0}};function Q(ye,Se){return ye[0]===Se[0]&&ye[1]===Se[1]}fe.prototype.isBelow=function(ye){var Se=this.point,ot=this.otherEvent.point;return this.left?(Se[0]-ye[0])*(ot[1]-ye[1])-(ot[0]-ye[0])*(Se[1]-ye[1])>0:(ot[0]-ye[0])*(Se[1]-ye[1])-(Se[0]-ye[0])*(ot[1]-ye[1])>0},fe.prototype.isAbove=function(ye){return!this.isBelow(ye)},fe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},pe.inResult.get=function(){return this.resultTransition!==0},fe.prototype.clone=function(){var ye=new fe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(fe.prototype,pe);var he=11102230246251565e-32,me=134217729,_e=(3+8*he)*he;function De(ye,Se,ot,Lt,Gt){var Ut,en,zn,gr,yr=Se[0],sr=Lt[0],Kr=0,yi=0;sr>yr==sr>-yr?(Ut=yr,yr=Se[++Kr]):(Ut=sr,sr=Lt[++yi]);var _r=0;if(Kr<ye&&yi<ot)for(sr>yr==sr>-yr?(zn=Ut-((en=yr+Ut)-yr),yr=Se[++Kr]):(zn=Ut-((en=sr+Ut)-sr),sr=Lt[++yi]),Ut=en,zn!==0&&(Gt[_r++]=zn);Kr<ye&&yi<ot;)sr>yr==sr>-yr?(zn=Ut-((en=Ut+yr)-(gr=en-Ut))+(yr-gr),yr=Se[++Kr]):(zn=Ut-((en=Ut+sr)-(gr=en-Ut))+(sr-gr),sr=Lt[++yi]),Ut=en,zn!==0&&(Gt[_r++]=zn);for(;Kr<ye;)zn=Ut-((en=Ut+yr)-(gr=en-Ut))+(yr-gr),yr=Se[++Kr],Ut=en,zn!==0&&(Gt[_r++]=zn);for(;yi<ot;)zn=Ut-((en=Ut+sr)-(gr=en-Ut))+(sr-gr),sr=Lt[++yi],Ut=en,zn!==0&&(Gt[_r++]=zn);return Ut===0&&_r!==0||(Gt[_r++]=Ut),_r}function Pe(ye){return new Float64Array(ye)}var Oe=33306690738754716e-32,Ve=22204460492503146e-32,tt=11093356479670487e-47,vt=Pe(4),ft=Pe(8),xt=Pe(12),St=Pe(16),rt=Pe(4);function _t(ye,Se,ot){var Lt=function(Gt,Ut,en,zn,gr,yr){var sr=(Ut-yr)*(en-gr),Kr=(Gt-gr)*(zn-yr),yi=sr-Kr;if(sr===0||Kr===0||sr>0!=Kr>0)return yi;var _r=Math.abs(sr+Kr);return Math.abs(yi)>=Oe*_r?yi:-function(qi,Ti,Wr,Qi,Ii,_i,Ei){var ei,lr,ii,Wi,Rn,Mr,Mi,Xi,Oi,Ss,li,ys,el,Oo,bo,tl,ld,Ts,Us=qi-Ii,Lo=Wr-Ii,ma=Ti-_i,Yo=Qi-_i;vt[0]=(bo=(Xi=Us-(Mi=(Mr=me*Us)-(Mr-Us)))*(Ss=Yo-(Oi=(Mr=me*Yo)-(Mr-Yo)))-((Oo=Us*Yo)-Mi*Oi-Xi*Oi-Mi*Ss))-((li=bo-(ld=(Xi=ma-(Mi=(Mr=me*ma)-(Mr-ma)))*(Ss=Lo-(Oi=(Mr=me*Lo)-(Mr-Lo)))-((tl=ma*Lo)-Mi*Oi-Xi*Oi-Mi*Ss)))+(Rn=bo-li))+(Rn-ld),vt[1]=(el=Oo-((ys=Oo+li)-(Rn=ys-Oo))+(li-Rn))-((li=el-tl)+(Rn=el-li))+(Rn-tl),vt[2]=ys-((Ts=ys+li)-(Rn=Ts-ys))+(li-Rn),vt[3]=Ts;var kp=function(qX,KA){for(var YA=KA[0],$b=1;$b<4;$b++)YA+=KA[$b];return YA}(0,vt),N_=Ve*Ei;if(kp>=N_||-kp>=N_||(ei=qi-(Us+(Rn=qi-Us))+(Rn-Ii),ii=Wr-(Lo+(Rn=Wr-Lo))+(Rn-Ii),lr=Ti-(ma+(Rn=Ti-ma))+(Rn-_i),Wi=Qi-(Yo+(Rn=Qi-Yo))+(Rn-_i),ei===0&&lr===0&&ii===0&&Wi===0)||(N_=tt*Ei+_e*Math.abs(kp),(kp+=Us*Wi+Yo*ei-(ma*ii+Lo*lr))>=N_||-kp>=N_))return kp;rt[0]=(bo=(Xi=ei-(Mi=(Mr=me*ei)-(Mr-ei)))*(Ss=Yo-(Oi=(Mr=me*Yo)-(Mr-Yo)))-((Oo=ei*Yo)-Mi*Oi-Xi*Oi-Mi*Ss))-((li=bo-(ld=(Xi=lr-(Mi=(Mr=me*lr)-(Mr-lr)))*(Ss=Lo-(Oi=(Mr=me*Lo)-(Mr-Lo)))-((tl=lr*Lo)-Mi*Oi-Xi*Oi-Mi*Ss)))+(Rn=bo-li))+(Rn-ld),rt[1]=(el=Oo-((ys=Oo+li)-(Rn=ys-Oo))+(li-Rn))-((li=el-tl)+(Rn=el-li))+(Rn-tl),rt[2]=ys-((Ts=ys+li)-(Rn=Ts-ys))+(li-Rn),rt[3]=Ts;var lF=De(4,vt,4,rt,ft);rt[0]=(bo=(Xi=Us-(Mi=(Mr=me*Us)-(Mr-Us)))*(Ss=Wi-(Oi=(Mr=me*Wi)-(Mr-Wi)))-((Oo=Us*Wi)-Mi*Oi-Xi*Oi-Mi*Ss))-((li=bo-(ld=(Xi=ma-(Mi=(Mr=me*ma)-(Mr-ma)))*(Ss=ii-(Oi=(Mr=me*ii)-(Mr-ii)))-((tl=ma*ii)-Mi*Oi-Xi*Oi-Mi*Ss)))+(Rn=bo-li))+(Rn-ld),rt[1]=(el=Oo-((ys=Oo+li)-(Rn=ys-Oo))+(li-Rn))-((li=el-tl)+(Rn=el-li))+(Rn-tl),rt[2]=ys-((Ts=ys+li)-(Rn=Ts-ys))+(li-Rn),rt[3]=Ts;var cF=De(lF,ft,4,rt,xt);rt[0]=(bo=(Xi=ei-(Mi=(Mr=me*ei)-(Mr-ei)))*(Ss=Wi-(Oi=(Mr=me*Wi)-(Mr-Wi)))-((Oo=ei*Wi)-Mi*Oi-Xi*Oi-Mi*Ss))-((li=bo-(ld=(Xi=lr-(Mi=(Mr=me*lr)-(Mr-lr)))*(Ss=ii-(Oi=(Mr=me*ii)-(Mr-ii)))-((tl=lr*ii)-Mi*Oi-Xi*Oi-Mi*Ss)))+(Rn=bo-li))+(Rn-ld),rt[1]=(el=Oo-((ys=Oo+li)-(Rn=ys-Oo))+(li-Rn))-((li=el-tl)+(Rn=el-li))+(Rn-tl),rt[2]=ys-((Ts=ys+li)-(Rn=Ts-ys))+(li-Rn),rt[3]=Ts;var uF=De(cF,xt,4,rt,St);return St[uF-1]}(Gt,Ut,en,zn,gr,yr,_r)}(ye[0],ye[1],Se[0],Se[1],ot[0],ot[1]);return Lt>0?-1:Lt<0?1:0}function et(ye,Se){var ot=ye.point,Lt=Se.point;return ot[0]>Lt[0]?1:ot[0]<Lt[0]?-1:ot[1]!==Lt[1]?ot[1]>Lt[1]?1:-1:function(Gt,Ut,en,zn){return Gt.left!==Ut.left?Gt.left?1:-1:_t(en,Gt.otherEvent.point,Ut.otherEvent.point)!==0?Gt.isBelow(Ut.otherEvent.point)?-1:1:!Gt.isSubject&&Ut.isSubject?1:-1}(ye,Se,ot)}function nt(ye,Se,ot){var Lt=new fe(Se,!1,ye,ye.isSubject),Gt=new fe(Se,!0,ye.otherEvent,ye.isSubject);return Q(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),Lt.contourId=Gt.contourId=ye.contourId,et(Gt,ye.otherEvent)>0&&(ye.otherEvent.left=!0,Gt.left=!1),ye.otherEvent.otherEvent=Gt,ye.otherEvent=Lt,ot.push(Gt),ot.push(Lt),ot}function Mt(ye,Se){return ye[0]*Se[1]-ye[1]*Se[0]}function Pt(ye,Se){return ye[0]*Se[0]+ye[1]*Se[1]}function _n(ye,Se,ot){var Lt=function(gr,yr,sr,Kr,yi){var _r=[yr[0]-gr[0],yr[1]-gr[1]],qi=[Kr[0]-sr[0],Kr[1]-sr[1]];function Ti(Mr,Mi,Xi){return[Mr[0]+Mi*Xi[0],Mr[1]+Mi*Xi[1]]}var Wr=[sr[0]-gr[0],sr[1]-gr[1]],Qi=Mt(_r,qi),Ii=Qi*Qi,_i=Pt(_r,_r);if(Ii>0){var Ei=Mt(Wr,qi)/Qi;if(Ei<0||Ei>1)return null;var ei=Mt(Wr,_r)/Qi;return ei<0||ei>1?null:Ei===0||Ei===1?[Ti(gr,Ei,_r)]:ei===0||ei===1?[Ti(sr,ei,qi)]:[Ti(gr,Ei,_r)]}if((Ii=(Qi=Mt(Wr,_r))*Qi)>0)return null;var lr=Pt(_r,Wr)/_i,ii=lr+Pt(_r,qi)/_i,Wi=Math.min(lr,ii),Rn=Math.max(lr,ii);return Wi<=1&&Rn>=0?Wi===1?[Ti(gr,Wi>0?Wi:0,_r)]:Rn===0?[Ti(gr,Rn<1?Rn:1,_r)]:[Ti(gr,Wi>0?Wi:0,_r),Ti(gr,Rn<1?Rn:1,_r)]:null}(ye.point,ye.otherEvent.point,Se.point,Se.otherEvent.point),Gt=Lt?Lt.length:0;if(Gt===0||Gt===1&&(Q(ye.point,Se.point)||Q(ye.otherEvent.point,Se.otherEvent.point))||Gt===2&&ye.isSubject===Se.isSubject)return 0;if(Gt===1)return Q(ye.point,Lt[0])||Q(ye.otherEvent.point,Lt[0])||nt(ye,Lt[0],ot),Q(Se.point,Lt[0])||Q(Se.otherEvent.point,Lt[0])||nt(Se,Lt[0],ot),1;var Ut=[],en=!1,zn=!1;return Q(ye.point,Se.point)?en=!0:et(ye,Se)===1?Ut.push(Se,ye):Ut.push(ye,Se),Q(ye.otherEvent.point,Se.otherEvent.point)?zn=!0:et(ye.otherEvent,Se.otherEvent)===1?Ut.push(Se.otherEvent,ye.otherEvent):Ut.push(ye.otherEvent,Se.otherEvent),en&&zn||en?(Se.type=I,ye.type=Se.inOut===ye.inOut?N:O,en&&!zn&&nt(Ut[1].otherEvent,Ut[0].point,ot),2):zn?(nt(Ut[0],Ut[1].point,ot),3):Ut[0]!==Ut[3].otherEvent?(nt(Ut[0],Ut[1].point,ot),nt(Ut[1],Ut[2].point,ot),3):(nt(Ut[0],Ut[1].point,ot),nt(Ut[3].otherEvent,Ut[2].point,ot),3)}function nn(ye,Se){if(ye===Se)return 0;if(_t(ye.point,ye.otherEvent.point,Se.point)!==0||_t(ye.point,ye.otherEvent.point,Se.otherEvent.point)!==0)return Q(ye.point,Se.point)?ye.isBelow(Se.otherEvent.point)?-1:1:ye.point[0]===Se.point[0]?ye.point[1]<Se.point[1]?-1:1:et(ye,Se)===1?Se.isAbove(ye.point)?-1:1:ye.isBelow(Se.point)?-1:1;if(ye.isSubject!==Se.isSubject)return ye.isSubject?-1:1;var ot=ye.point,Lt=Se.point;return ot[0]===Lt[0]&&ot[1]===Lt[1]?(ot=ye.otherEvent.point)[0]===(Lt=Se.otherEvent.point)[0]&&ot[1]===Lt[1]?0:ye.contourId>Se.contourId?1:-1:et(ye,Se)===1?1:-1}var $t=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function At(ye,Se,ot,Lt){var Gt,Ut=ye+1,en=Se[ye].point,zn=Se.length;for(Ut<zn&&(Gt=Se[Ut].point);Ut<zn&&Gt[0]===en[0]&&Gt[1]===en[1];){if(!ot[Ut])return Ut;++Ut<zn&&(Gt=Se[Ut].point)}for(Ut=ye-1;ot[Ut]&&Ut>Lt;)Ut--;return Ut}$t.prototype.isExterior=function(){return this.holeOf==null};var Gn=sn,tn=sn;function sn(ye,Se){if(!(this instanceof sn))return new sn(ye,Se);if(this.data=ye||[],this.length=this.data.length,this.compare=Se||jn,this.length>0)for(var ot=(this.length>>1)-1;ot>=0;ot--)this._down(ot)}function jn(ye,Se){return ye<Se?-1:ye>Se?1:0}sn.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var Se=this.data,ot=this.compare,Lt=Se[ye];ye>0;){var Gt=ye-1>>1,Ut=Se[Gt];if(ot(Lt,Ut)>=0)break;Se[ye]=Ut,ye=Gt}Se[ye]=Lt},_down:function(ye){for(var Se=this.data,ot=this.compare,Lt=this.length>>1,Gt=Se[ye];ye<Lt;){var Ut=1+(ye<<1),en=Ut+1,zn=Se[Ut];if(en<this.length&&ot(Se[en],zn)<0&&(Ut=en,zn=Se[en]),ot(zn,Gt)>=0)break;Se[ye]=zn,ye=Ut}Se[ye]=Gt}},Gn.default=tn;var nr=Math.max,Kn=Math.min,ur=0;function ir(ye,Se,ot,Lt,Gt,Ut){var en,zn,gr,yr,sr,Kr;for(en=0,zn=ye.length-1;en<zn;en++)if(yr=ye[en+1],sr=new fe(gr=ye[en],!1,void 0,Se),Kr=new fe(yr,!1,sr,Se),sr.otherEvent=Kr,gr[0]!==yr[0]||gr[1]!==yr[1]){sr.contourId=Kr.contourId=ot,Ut||(sr.isExteriorRing=!1,Kr.isExteriorRing=!1),et(sr,Kr)>0?Kr.left=!0:sr.left=!0;var yi=gr[0],_r=gr[1];Gt[0]=Kn(Gt[0],yi),Gt[1]=Kn(Gt[1],_r),Gt[2]=nr(Gt[2],yi),Gt[3]=nr(Gt[3],_r),Lt.push(sr),Lt.push(Kr)}}var hr=[];function qr(ye,Se,ot){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof Se[0][0][0]=="number"&&(Se=[Se]);var Lt=function(_r,qi,Ti){var Wr=null;return _r.length*qi.length==0&&(Ti===L?Wr=hr:Ti===H?Wr=_r:Ti!==V&&Ti!==K||(Wr=_r.length===0?qi:_r)),Wr}(ye,Se,ot);if(Lt)return Lt===hr?null:Lt;var Gt=[1/0,1/0,-1/0,-1/0],Ut=[1/0,1/0,-1/0,-1/0],en=function(_r,qi,Ti,Wr,Qi){var Ii,_i,Ei,ei,lr,ii,Wi=new Gn(null,et);for(Ei=0,ei=_r.length;Ei<ei;Ei++)for(lr=0,ii=(Ii=_r[Ei]).length;lr<ii;lr++)(_i=lr===0)&&ur++,ir(Ii[lr],!0,ur,Wi,Ti,_i);for(Ei=0,ei=qi.length;Ei<ei;Ei++)for(lr=0,ii=(Ii=qi[Ei]).length;lr<ii;lr++)_i=lr===0,Qi===H&&(_i=!1),_i&&ur++,ir(Ii[lr],!1,ur,Wi,Wr,_i);return Wi}(ye,Se,Gt,Ut,ot);if(Lt=function(_r,qi,Ti,Wr,Qi){var Ii=null;return(Ti[0]>Wr[2]||Wr[0]>Ti[2]||Ti[1]>Wr[3]||Wr[1]>Ti[3])&&(Qi===L?Ii=hr:Qi===H?Ii=_r:Qi!==V&&Qi!==K||(Ii=_r.concat(qi))),Ii}(ye,Se,Gt,Ut,ot))return Lt===hr?null:Lt;for(var zn=function(_r){var qi,Ti,Wr=function(Ei){var ei,lr,ii,Wi,Rn=[];for(lr=0,ii=Ei.length;lr<ii;lr++)((ei=Ei[lr]).left&&ei.inResult||!ei.left&&ei.otherEvent.inResult)&&Rn.push(ei);for(var Mr=!1;!Mr;)for(Mr=!0,lr=0,ii=Rn.length;lr<ii;lr++)lr+1<ii&&et(Rn[lr],Rn[lr+1])===1&&(Wi=Rn[lr],Rn[lr]=Rn[lr+1],Rn[lr+1]=Wi,Mr=!1);for(lr=0,ii=Rn.length;lr<ii;lr++)(ei=Rn[lr]).otherPos=lr;for(lr=0,ii=Rn.length;lr<ii;lr++)(ei=Rn[lr]).left||(Wi=ei.otherPos,ei.otherPos=ei.otherEvent.otherPos,ei.otherEvent.otherPos=Wi);return Rn}(_r),Qi={},Ii=[],_i=function(){if(!Qi[qi]){var Ei=Ii.length,ei=function(Rn,Mr,Mi){var Xi=new $t;if(Rn.prevInResult!=null){var Oi=Rn.prevInResult,Ss=Oi.outputContourId;if(Oi.resultTransition>0){var li=Mr[Ss];if(li.holeOf!=null){var ys=li.holeOf;Mr[ys].holeIds.push(Mi),Xi.holeOf=ys,Xi.depth=Mr[Ss].depth}else Mr[Ss].holeIds.push(Mi),Xi.holeOf=Ss,Xi.depth=Mr[Ss].depth+1}else Xi.holeOf=null,Xi.depth=Mr[Ss].depth}else Xi.holeOf=null,Xi.depth=0;return Xi}(Wr[qi],Ii,Ei),lr=function(Rn){Qi[Rn]=!0,Rn<Wr.length&&Wr[Rn]&&(Wr[Rn].outputContourId=Ei)},ii=qi,Wi=qi;for(ei.points.push(Wr[qi].point);lr(ii),lr(ii=Wr[ii].otherPos),ei.points.push(Wr[ii].point),!((ii=At(ii,Wr,Qi,Wi))==Wi||ii>=Wr.length)&&Wr[ii];);Ii.push(ei)}};for(qi=0,Ti=Wr.length;qi<Ti;qi++)_i();return Ii}(function(_r,qi,Ti,Wr,Qi,Ii){for(var _i,Ei,ei,lr=new d(nn),ii=[],Wi=Math.min(Wr[2],Qi[2]);_r.length!==0;){var Rn=_r.pop();if(ii.push(Rn),Ii===L&&Rn.point[0]>Wi||Ii===H&&Rn.point[0]>Wr[2])break;if(Rn.left){Ei=_i=lr.insert(Rn),_i=_i!==(ei=lr.minNode())?lr.prev(_i):null,Ei=lr.next(Ei);var Mr=_i?_i.key:null;if(te(Rn,Mr,Ii),Ei&&_n(Rn,Ei.key,_r)===2&&(te(Rn,Mr,Ii),te(Ei.key,Rn,Ii)),_i&&_n(_i.key,Rn,_r)===2){var Mi=_i;te(Mr,(Mi=Mi!==ei?lr.prev(Mi):null)?Mi.key:null,Ii),te(Rn,Mr,Ii)}}else Ei=_i=lr.find(Rn=Rn.otherEvent),_i&&Ei&&(_i=_i!==ei?lr.prev(_i):null,Ei=lr.next(Ei),lr.remove(Rn),Ei&&_i&&_n(_i.key,Ei.key,_r))}return ii}(en,0,0,Gt,Ut,ot)),gr=[],yr=0;yr<zn.length;yr++){var sr=zn[yr];if(sr.isExterior()){for(var Kr=[sr.points],yi=0;yi<sr.holeIds.length;yi++)Kr.push(zn[sr.holeIds[yi]].points);gr.push(Kr)}}return gr}var Si={UNION:V,DIFFERENCE:H,INTERSECTION:L,XOR:K};o.diff=function(ye,Se){return qr(ye,Se,H)},o.intersection=function(ye,Se){return qr(ye,Se,L)},o.operations=Si,o.union=function(ye,Se){return qr(ye,Se,V)},o.xor=function(ye,Se){return qr(ye,Se,K)},Object.defineProperty(o,"__esModule",{value:!0})})(e)}(0,B2.exports)),B2.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Rx(a,e,o,u){const d=[],g=u===0?(y,T,C,I,N,O)=>{y.push(new Ot(O,C+(O-T)/(I-T)*(N-C)))}:(y,T,C,I,N,O)=>{y.push(new Ot(T+(O-C)/(N-C)*(I-T),O))};for(const y of a){const T=[];for(const C of y){if(C.length<=2)continue;const I=[];for(let L=0;L<C.length-1;L++){const V=C[L].x,H=C[L].y,K=C[L+1].x,te=C[L+1].y,ae=u===0?V:H,fe=u===0?K:te;ae<e?fe>e&&g(I,V,H,K,te,e):ae>o?fe<o&&g(I,V,H,K,te,o):I.push(C[L]),fe<e&&ae>=e&&g(I,V,H,K,te,e),fe>o&&ae<=o&&g(I,V,H,K,te,o)}let N=C[C.length-1];const O=u===0?N.x:N.y;O>=e&&O<=o&&I.push(N),I.length&&(N=I[I.length-1],I[0].x===N.x&&I[0].y===N.y||I.push(I[0]),T.push(I))}T.length&&d.push(T)}return d}function bz(a,e){const o=F1(a),u=F1([e]),d=V2.intersection(o,u);return d==null?[]:U2(d)}function wz(a,e){let u=F1(a,65536);for(;e.valid();e.next()){const[d,g]=e.get(),y=d.x*65536,T=d.y*65536,C=g.x*65536,I=g.y*65536,N=C-y,O=I-T,L=Math.hypot(N,O),V=Math.trunc(O/L*3),H=-Math.trunc(N/L*3);u=V2.diff(u,[[[y,T],[C,I],[C+V,I+H],[y+V,T+H],[y,T]]])}return U2(u,1/65536)}function F1(a,e=1){return[a.map(o=>o.map(u=>[u.x*e,u.y*e]))]}function U2(a,e=1){return a.map(o=>o.map((u,d)=>{const g=u.map(y=>new Ot(y[0]*e,y[1]*e).round());return d>0&&g.reverse(),g}))}class B1{constructor(e,o){this.layoutVertexArray=new Hl,this.indexArray=new Rs,this.lineIndexArray=new yc,this.triangleSegments=new si,this.lineSegments=new si,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,o&&(this.elevatedLayoutVertexArray=new mc)}update(e,o,u,d,g,y,T,C){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,az.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,o,u,d,g,y,T){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,u,d,g,y,void 0,T)}}class V1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new B1(e,!1),this.elevationBufferData=new B1(e,!0),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.hasPattern=z1("fill",this.layers,this.pixelRatio,o);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:C,index:I,sourceLayerIndex:N}of e){const O=this.layers[0]._featureFilter.needGeometry,L=Bt(T,O);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),L,u))continue;const V=g?g.evaluate(L,{},u,o.availableImages):void 0,H={id:C,properties:T.properties,type:T.type,sourceLayerIndex:N,index:I,geometry:O?L.geometry:qt(T,u,d),patterns:{},sortKey:V};y.push(H)}g&&y.sort((T,C)=>T.sortKey-C.sortKey);for(const T of y){const{geometry:C,index:I,sourceLayerIndex:N}=T;if(this.hasPattern){const O=j1("fill",this.layers,T,this.zoom,this.pixelRatio,o);this.patternFeatures.push(O)}else this.addFeature(T,C,I,u,{},o.availableImages,o.brightness,o.elevationFeatures);o.featureIndex.insert(e[I].feature,C,I,N,this.index)}}update(e,o,u,d,g,y,T){this.bufferData.update(e,o,u,d,g,y,T,this.worldview),this.elevationBufferData.update(e,o,u,d,g,y,T,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,o,u,d,g,y,T,this.worldview)}addFeatures(e,o,u,d,g,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,o,u,d,y,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,o,u,d,g,y=[],T,C){const I=Px(o,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,I,d,u,C):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(e,u,g,y,d,T,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,g,y,d,T,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,o,u,d,g){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(o,u,d,g,this.worldview))}addElevatedRoadFeature(e,o,u,d,g){const y=new Array,T=Oa.getElevationFeature(e,g);if(!T)return void this.addGeometry(o,this.bufferData);{const I=this.clipPolygonsToTile(o,1);I.length>0&&y.push({polygons:I,elevationFeature:T,elevationTileID:u})}const C={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:d};for(const I of y)if(I.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Zl(I.elevationTileID,this.layers,this.zoom,this.lut));const O=I.elevationFeature.isTunnel();let L=0;e.properties.hasOwnProperty(ai)&&(L=+e.properties[ai]);for(const V of I.polygons)this.elevatedStructures.addPortalCandidates(I.elevationFeature.id,V,O,I.elevationFeature,L)}I.elevationFeature.constantHeight==null&&(I.polygons=this.prepareElevatedPolygons(I.polygons,I.elevationFeature,I.elevationTileID));const N=new ws(u,I.elevationTileID);this.addElevatedGeometry(I.polygons,N,I.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,C)}}addElevatedGeometry(e,o,u,d,g,y){const T={elevation:u,elevationSampler:o,bias:d,index:g,featureInfo:y},[C,I]=this.addGeometry(e,this.elevationBufferData,T);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:C,max:I}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,C),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,I))}addGeometry(e,o,u){let d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,y=null;u&&(y=u.elevationSampler.constantElevation(u.elevation,u.bias),y!=null&&(d=y,g=y));const T=(C,I,N)=>{if(u!=null)if(I.push(C),y!=null)o.elevatedLayoutVertexArray.emplaceBack(y),N.push(y);else{const O=u.elevationSampler.pointElevation(C,u.elevation,u.bias);o.elevatedLayoutVertexArray.emplaceBack(O),N.push(O),d=Math.min(d,O),g=Math.max(g,O)}};for(const C of e){let I=0;for(const pe of C)I+=pe.length;const N=o.triangleSegments.prepareSegment(I,o.layoutVertexArray,o.indexArray),O=N.vertexLength,L=[],V=[],H=[],K=[],te=[],ae=o.layoutVertexArray.length;for(const pe of C){if(pe.length===0)continue;pe!==C[0]&&V.push(L.length/2);const Q=o.lineSegments.prepareSegment(pe.length,o.layoutVertexArray,o.lineIndexArray),he=Q.vertexLength;u&&te.push(o.layoutVertexArray.length-ae),T(pe[0],H,K),o.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),o.lineIndexArray.emplaceBack(he+pe.length-1,he),L.push(pe[0].x),L.push(pe[0].y);for(let me=1;me<pe.length;me++)T(pe[me],H,K),o.layoutVertexArray.emplaceBack(pe[me].x,pe[me].y),o.lineIndexArray.emplaceBack(he+me-1,he+me),L.push(pe[me].x),L.push(pe[me].y);Q.vertexLength+=pe.length,Q.primitiveLength+=pe.length}const fe=t_(L,V);for(let pe=0;pe<fe.length;pe+=3)o.indexArray.emplaceBack(O+fe[pe],O+fe[pe+1],O+fe[pe+2]);if(fe.length>0&&u&&this.elevationMode==="hd-road-base"){const pe=u.elevation.isTunnel(),Q=u.elevation.safeArea,he=this.elevatedStructures.addVertices(H,K);this.elevatedStructures.addTriangles(fe,he,pe);const me=te.length;if(me>0){for(let _e=0;_e<me-1;_e++)this.elevatedStructures.addRenderableRing(u.index,te[_e]+he,te[_e+1]-te[_e],pe,Q,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,te[me-1]+he,H.length-te[me-1],pe,Q,u.featureInfo)}}N.vertexLength+=I,N.primitiveLength+=fe.length/3}return[d,g]}prepareElevatedPolygons(e,o,u){const d=1/Je(u),g=[];for(const y of e){const T=wz(y,new Zo(o,d));g.push(...T)}return g}clipPolygonsToTile(e,o){const u=-o,d=-o,g=jt+o,y=jt+o;let T=0;const C=[],I=[];for(;T<e.length;T++){const L=e[T],V=ym(L);(V.min.x>=u&&V.max.x<=g&&V.min.y>=d&&V.max.y<=y?C:I).push(L)}if(C.length===e.length)return e;const N=[new Ot(u,d),new Ot(g,d),new Ot(g,y),new Ot(u,y),new Ot(u,d)],O=C;for(const L of I)O.push(...bz(L,N));return O}}let $2,H2,G2,q2;Zt(V1,"FillBucket",{omit:["layers","patternFeatures"]}),Zt(B1,"FillBufferData"),Zt(Zl,"ElevatedStructures");class U1{constructor(e,o,u,d){if(this.triangleCount=o.length/3,this.min=new Ot(0,0),this.max=new Ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[g,y]=[e[0].clone(),e[0].clone()];for(let O=1;O<e.length;++O){const L=e[O];g.x=Math.min(g.x,L.x),g.y=Math.min(g.y,L.y),y.x=Math.max(y.x,L.x),y.y=Math.max(y.y,L.y)}if(d){const O=Math.ceil(Math.max(y.x-g.x,y.y-g.y)/d);u=Math.max(u,O)}if(u===0)return;this.min=g,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const C=Math.max(T.x,T.y)/u;this.cellsX=Math.max(1,Math.ceil(T.x/C)),this.cellsY=Math.max(1,Math.ceil(T.y/C)),this.xScale=1/C,this.yScale=1/C;const I=[];for(let O=0;O<this.triangleCount;O++){const L=e[o[3*O+0]].sub(this.min),V=e[o[3*O+1]].sub(this.min),H=e[o[3*O+2]].sub(this.min),K=od(Math.floor(Math.min(L.x,V.x,H.x)),this.xScale,this.cellsX),te=od(Math.floor(Math.max(L.x,V.x,H.x)),this.xScale,this.cellsX),ae=od(Math.floor(Math.min(L.y,V.y,H.y)),this.yScale,this.cellsY),fe=od(Math.floor(Math.max(L.y,V.y,H.y)),this.yScale,this.cellsY),pe=new Ot(0,0),Q=new Ot(0,0),he=new Ot(0,0),me=new Ot(0,0);for(let _e=ae;_e<=fe;++_e){pe.y=Q.y=_e*C,he.y=me.y=(_e+1)*C;for(let De=K;De<=te;++De)pe.x=he.x=De*C,Q.x=me.x=(De+1)*C,(Vm(L,V,H,pe,Q,me)||Vm(L,V,H,pe,me,he))&&I.push({cellIdx:_e*this.cellsX+De,triIdx:O})}}if(I.length===0)return;I.sort((O,L)=>O.cellIdx-L.cellIdx||O.triIdx-L.triIdx);let N=0;for(;N<I.length;){const O=I[N].cellIdx,L={start:this.payload.length,len:0};for(;N<I.length&&I[N].cellIdx===O;)++L.len,this.payload.push(I[N++].triIdx);this.cells[O]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const u=od(e.x-this.min.x,this.xScale,this.cellsX),d=od(e.y-this.min.y,this.yScale,this.cellsY),g=this.cells[d*this.cellsX+u];if(g){this._lazyInitLookup();for(let y=0;y<g.len;y++){const T=this.payload[g.start+y],C=Math.floor(T/8),I=1<<T%8;if(!(this.lookup[C]&I)&&(this.lookup[C]|=I,o.push(T),o.length===this.triangleCount))return}}}query(e,o,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>o.x||e.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const d=od(e.x-this.min.x,this.xScale,this.cellsX),g=od(o.x-this.min.x,this.xScale,this.cellsX),y=od(e.y-this.min.y,this.yScale,this.cellsY),T=od(o.y-this.min.y,this.yScale,this.cellsY);for(let C=y;C<=T;C++)for(let I=d;I<=g;I++){const N=this.cells[C*this.cellsX+I];if(N)for(let O=0;O<N.len;O++){const L=this.payload[N.start+O],V=Math.floor(L/8),H=1<<L%8;if(!(this.lookup[V]&H)&&(this.lookup[V]|=H,u.push(L),u.length===this.triangleCount))return}}}}function od(a,e,o){return Math.max(0,Math.min(o-1,Math.floor(a*e)))}Zt(U1,"TriangleGridIndex");class W2{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,o){for(const u of this.footprints)o.push({footprint:u,id:e})}populate(e,o,u,d){const g=[];for(const{feature:y,id:T,index:C,sourceLayerIndex:I}of e){const N=this.layers[0]._featureFilter.needGeometry,O=Bt(y,N);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),O,u))continue;const L={id:T,properties:y.properties,type:y.type,sourceLayerIndex:I,index:C,geometry:N?O.geometry:qt(y,u,d),patterns:{}};g.push(L)}for(const y of g){const{geometry:T,index:C,sourceLayerIndex:I}=y;this.addFeature(y,T,C,u,{},o.availableImages,o.brightness),o.featureIndex.insert(e[C].feature,T,C,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,o,u,d,g,y,T){}destroy(){}addFeature(e,o,u,d,g,y=[],T){for(const C of Px(o,2)){const I=[],N=[],O=[],L=new Ot(1/0,1/0),V=new Ot(-1/0,-1/0);for(const te of C)if(te.length!==0){te!==C[0]&&O.push(N.length/2);for(let ae=0;ae<te.length;ae++)N.push(te[ae].x),N.push(te[ae].y),I.push(te[ae]),L.x=Math.min(L.x,te[ae].x),L.y=Math.min(L.y,te[ae].y),V.x=Math.max(V.x,te[ae].x),V.y=Math.max(V.y,te[ae].y)}const H=t_(N,O),K=new U1(I,H,8,256);this.footprints.push({vertices:I,indices:H,grid:K,min:L,max:V})}}}Zt(W2,"ClipBucket",{omit:["layers"]});const Sz=Tr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Tz=Tr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ez=Tr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Cz=Tr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Az=Tr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Iz=Tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Mz}=Sz,Nx=Number.MAX_SAFE_INTEGER;function Z2(a,e,o,u){return a.order<e||a.order===Nx||!(a.clipMask&o)||function(d,g){return g.length!==0&&g.find(y=>y===d)===void 0}(u,a.clipScope)}function Dx(a,e){return a.x-e.x||a.y-e.y}function X2(a,e){return Dx(a.min,e.min)===0&&Dx(a.max,e.max)===0}function $1(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function H1(a,e){if(a.length!==e.length)return!1;for(let o=0;o<a.length;o++)if(a[o].sourceId!==e[o].sourceId||!X2(a[o],e[o])||a[o].order!==e[o].order||a[o].clipMask!==e[o].clipMask||!qa(a[o].clipScope,e[o].clipScope))return!1;return!0}function K2(a,e,o){const u=1/jt,d=1/(1<<o.canonical.z),g=(e.x*u+o.canonical.x)*d+o.wrap,y=(e.y*u+o.canonical.y)*d;return{min:new Ot((a.x*u+o.canonical.x)*d+o.wrap,(a.y*u+o.canonical.y)*d),max:new Ot(g,y)}}function kz(a,e,o){const u=1<<o.canonical.z,d=((e.x-o.wrap)*u-o.canonical.x)*jt,g=(e.y*u-o.canonical.y)*jt;return{min:new Ot(((a.x-o.wrap)*u-o.canonical.x)*jt,(a.y*u-o.canonical.y)*jt),max:new Ot(d,g)}}function Y2(a,e,o,u,d,g,y){const T=a.indices,C=a.vertices,I=[];for(let N=u;N<u+d;N+=3){const O=e[o[N+0]+g],L=e[o[N+1]+g],V=e[o[N+2]+g],H=Math.min(O.x,L.x,V.x),K=Math.max(O.x,L.x,V.x),te=Math.min(O.y,L.y,V.y),ae=Math.max(O.y,L.y,V.y);I.length=0,a.grid.query(new Ot(H,te),new Ot(K,ae),I);for(let fe=0;fe<I.length;fe++){const pe=I[fe];if(Vm(C[T[3*pe+0]],C[T[3*pe+1]],C[T[3*pe+2]],O,L,V,y))return!0}}return!1}function J2(a,e,o,u){if(!a||!o)return!1;let d=a.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(o.vertices.length<a.vertices.length)return J2(o,u,a,e);const g=e.canonical,y=u.canonical,T=Math.pow(2,y.z-g.z);d=a.vertices.map(C=>new Ot((C.x+g.x*jt)*T-y.x*jt,(C.y+g.y*jt)*T-y.y*jt))}return Y2(o,d,a.indices,0,a.indices.length,0,0)}function Q2(a,e,o,u){const d=Math.pow(2,u.z-o.z);return new Ot((a+o.x*jt)*d-u.x*jt,(e+o.y*jt)*d-u.y*jt)}function eE(a,e){const o=[];e.grid.queryPoint(a,o);const u=e.indices,d=e.vertices;for(let g=0;g<o.length;g++){const y=o[g];if(xl([d[u[3*y+0]],d[u[3*y+1]],d[u[3*y+2]]],a))return!0}return!1}const G1=[new Ot(0,0),new Ot(jt,0),new Ot(jt,jt),new Ot(0,jt)];function tE(a,e){const o=[];let u=[];if(!e||a.length<2)return[a];if(a.length===2)return Wl(a[0],a[1],G1)?[a]:[];for(let d=0;d<a.length+2;d++){const g=a[d%a.length],y=a[(d+1)%a.length],T=Wl(d===0?a[a.length-1]:a[(d-1)%a.length],g,G1),C=Wl(g,y,G1),I=T||C;I&&u.push(g),I&&C||u.length>0&&(u.length>1&&o.push(u),u=[])}return u.length>1&&o.push(u),o}const q1=er.VectorTileFeature.types,Pz=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Rz=["fill-extrusion-flood-light-ground-radius"],Nz=Math.pow(2,13),Dz=Math.pow(2,15)-1,nE=new Ot(0,1),Ep=2147483648;function o_(a,e,o,u,d,g,y,T){a.emplaceBack((e<<1)+y,(o<<1)+g,(Math.floor(u*Nz)<<1)+d,Math.round(T))}function a_(a,e,o){a.emplaceBack(e.x*jt,e.y*jt,o?1:0)}function Ox(a,e,o,u,d,g){a.emplaceBack(e.x,e.y,(o.x<<1)+u,(o.y<<1)+d,g)}function l_(a,e,o){a.emplaceBack(e.x,e.y,e.z,o[0]*16384,o[1]*16384,o[2]*16384)}class rE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class iE{constructor(){this.centroidXY=new Ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class sE{constructor(){this.acc=new Ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,o){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=o.x,e.min.y=e.max.y=o.y)}appendEdge(e,o,u){this.accCount++,this.acc._add(o);let d=!!this.borders;o.x<e.min.x?(e.min.x=o.x,d=!0):o.x>e.max.x&&(e.max.x=o.x,d=!0),o.y<e.min.y?(e.min.y=o.y,d=!0):o.y>e.max.y&&(e.max.y=o.y,d=!0),((o.x===0||o.x===jt)&&o.x===u.x)!=((o.y===0||o.y===jt)&&o.y===u.y)&&this.processBorderOverlap(o,u),d&&this.checkBorderIntersection(o,u)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,Mn(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>jt!=e.x>jt&&this.addBorderIntersection(1,Mn(o.y,e.y,(jt-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,Mn(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>jt!=e.y>jt&&this.addBorderIntersection(3,Mn(o.x,e.x,(jt-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const u=e.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,e.y)}else{const u=e.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new Ot(0,0):new Ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0):0}}function oE(a,e){const o=a.add(e)._unit(),u=Ee(a.x*o.x+a.y*o.y,-1,1);var d,g,y;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*Dz*((g=a).x*(y=e).y-g.y*y.x<0?-1:1)}const Oz=[a=>a.x<0,a=>a.x>jt,a=>a.y<0,a=>a.y>jt];function Lz(a,e,o,u){const d=[4];if(u===0)return d;o._mult(u);const g=a.sub(o),y=e.sub(o),T=[a,e,g,y];for(let C=0;C<4;C++)for(const I of T)if(Oz[C](I)){d.push(C);break}return d}class aE{constructor(e){this.vertexArray=new qu,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut},o=>Rz.includes(o)),this._segments=new si,this.hiddenByLandmarkVertexArray=new rf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new si}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,o,u,d=!1){const g=e.length;if(g>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let C;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const I=e[0],N=e[1];C=oE(I.sub(e[g-1])._perp()._unit(),N.sub(I)._perp()._unit())}for(let I=0;I<g;I++){const N=I===g-1?0:I+1,O=e[I],L=e[N],V=e[N===g-1?0:N+1],H=L.sub(O)._perp()._unit(),K=oE(H,V.sub(L)._perp()._unit()),te=C,ae=K;if(W1(O,L,o)||d&&uE(O,o)&&uE(L,o)){C=K;continue}const fe=T.vertexLength;Ox(this.vertexArray,O,L,1,1,te),Ox(this.vertexArray,O,L,1,0,te),Ox(this.vertexArray,O,L,0,1,ae),Ox(this.vertexArray,O,L,0,0,ae),T.vertexLength+=4;const pe=Lz(O,L,H,u);for(const Q of pe)this._segmentToGroundQuads[y].push({id:fe,region:Q}),this._segmentToRegionTriCounts[y][Q]+=2,T.primitiveLength+=2;C=K}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),o=e.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((d,g)=>d.region-g.region);for(let u=0;u<o;u++){const d=this._segmentToGroundQuads[u],g=e[u],y=this._segmentToRegionTriCounts[u];y.reduce((C,I)=>C+I,0);let T=0;for(let C=0;C<=4;C++){const I=y[C];if(I!==0){let N=this.regionSegments[C];N||(N=this.regionSegments[C]=new si);const O={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+T,vertexLength:g.vertexLength,primitiveLength:I};N.get().push(O)}T+=I}for(let C=0;C<d.length;C++){const I=d[C].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,o,u,d,g,y,T){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,o,u,d,g,y,void 0,T)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Tz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,o,u,d,g,y,T,C){this.hasData()&&this.programConfigurations.updatePaintArrays(e,o,u,d,g,y,T,C)}updateHiddenByLandmark(e){if(!this.hasData())return;const o=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const u=e.flags&Ep?1:0;for(let d=e.groundVertexArrayOffset;d<o;++d)this.hiddenByLandmarkVertexArray.emplace(d,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Az.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const o=this.regionSegments[e];o&&o.destroy()}}}}class Lx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Rs,this.footprintVertices=new Hl,this.footprintSegments=[],this.layoutVertexArray=new Yh,this.centroidVertexArray=new of,this.wallVertexArray=new zm,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut},o=>Pz.includes(o)),this.segments=new si,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new aE(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.features=[],this.hasPattern=z1("fill-extrusion",this.layers,this.pixelRatio,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Je(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:y,index:T,sourceLayerIndex:C}of e){const I=this.layers[0]._featureFilter.needGeometry,N=Bt(g,I);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),N,u))continue;const O={id:y,sourceLayerIndex:C,index:T,geometry:I?N.geometry:qt(g,u,d),properties:g.properties,type:g.type,patterns:{}},L=this.layoutVertexArray.length,V=q1[O.type]==="Polygon";if(this.hasPattern)this.features.push(j1("fill-extrusion",this.layers,O,this.zoom,this.pixelRatio,o));else if(this.wallMode)for(const H of O.geometry)for(const K of tE(H,V))this.addFeature(O,[K],T,u,{},o.availableImages,d,o.brightness);else this.addFeature(O,O.geometry,T,u,{},o.availableImages,d,o.brightness);o.featureIndex.insert(g,O.geometry,T,C,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,o,u,d,g,y){for(const T of this.features){const C=q1[T.type]==="Polygon",{geometry:I}=T;if(this.wallMode)for(const N of I)for(const O of tE(N,C))this.addFeature(T,[O],T.index,o,u,d,g,y);else this.addFeature(T,I,T.index,o,u,d,g,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,o,u,d,g,y,T){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview),this.groundEffect.update(e,o,g,u,d,y,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mz),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Cz.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Iz.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ez.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,u,d,g,y,T,C){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,N=[new Ot(0,0),new Ot(jt,jt)],O=T.projection,L=O.name==="globe",V=this.wallMode||q1[e.type]==="Polygon",H=new sE;H.centroidDataIndex=this.centroidData.length;const K=new iE,te=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},d)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},d);let fe;if(K.height=ae,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new dp),this.wallMode){if(L)return void Hn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;fe=function(Oe){const Ve=Oe[0].x===Oe[Oe.length-1].x&&Oe[0].y===Oe[Oe.length-1].y;(function($t){let At=0;const Gn=$t.length;for(let tn=0;tn<Gn;tn++)At+=($t[(tn+1)%Gn].x-$t[tn].x)*($t[(tn+1)%Gn].y+$t[tn].y);return At>=0})(Oe)||(Oe=Oe.reverse());const vt={geometry:[],joinNormals:[],indices:[]},ft=[],xt=[],St=[];let rt=Oe.length;for(;rt>=2&&Oe[rt-1].equals(Oe[rt-2]);)rt--;if(rt<(Ve?3:2))return vt;let _t,et,nt,Mt,Pt,_n=0;for(;_n<rt-1&&Oe[_n].equals(Oe[_n+1]);)_n++;Ve&&(_t=Oe[rt-2],Pt=Oe[_n].sub(_t)._unit()._perp());for(let $t=_n;$t<rt;$t++){if(nt=$t===rt-1?Ve?Oe[_n+1]:void 0:Oe[$t+1],nt&&Oe[$t].equals(nt))continue;Pt&&(Mt=Pt),_t&&(et=_t),_t=Oe[$t],Pt=nt?nt.sub(_t)._unit()._perp():Mt,Mt=Mt||Pt;let At=Mt.add(Pt);At.x===0&&At.y===0||At._unit();const Gn=At.x*Pt.x+At.y*Pt.y,tn=Gn!==0?1/Gn:1/0,sn=Mt.x*Pt.y-Mt.y*Pt.x>0;let jn="miter";const nr=2;jn==="miter"&&tn>nr&&(jn="bevel"),jn==="bevel"&&(tn>100&&(jn="flipbevel"),tn<nr&&(jn="miter"));const Kn=(ur,ir,hr,qr)=>{const Si=new Ot(ur.x,ur.y),ye=new Ot(ur.x,ur.y);Si.x+=ir.x*qr,Si.y+=ir.y*qr,ye.x-=ir.x*Math.max(hr,1),ye.y-=ir.y*Math.max(hr,1),St.push(ir),ft.push(Si),xt.push(ye)};if(jn==="miter")At._mult(tn),Kn(_t,At,0,0);else if(jn==="flipbevel")At=Pt.mult(-1),Kn(_t,At,0,0),Kn(_t,At.mult(-1),0,0);else{const ur=-Math.sqrt(tn*tn-1),ir=sn?ur:0,hr=sn?0:ur;et&&Kn(_t,Mt,ir,hr),nt&&Kn(_t,Pt,ir,hr)}}vt.geometry=[...ft,...xt.reverse(),ft[0]],vt.joinNormals=[...St,...St.reverse(),St[St.length-1]];const nn=vt.geometry.length-1;for(let $t=0;$t<nn/2;$t++)if($t+1<nn/2){let At=$t,Gn=$t+1,tn=nn-1-$t,sn=nn-2-$t;At=At===0?nn-1:At-1,Gn=Gn===0?nn-1:Gn-1,tn=tn===0?nn-1:tn-1,sn=sn===0?nn-1:sn-1,vt.indices.push(tn),vt.indices.push(Gn),vt.indices.push(At),vt.indices.push(tn),vt.indices.push(sn),vt.indices.push(Gn)}return vt}(o[0]),o=[fe.geometry]}const pe=(Oe,Ve)=>Oe<(Ve.length-1)/2||Oe===Ve.length-1,Q=this.wallMode?[o]:Px(o,500);for(let Oe=Q.length-1;Oe>=0;Oe--){const Ve=Q[Oe];(Ve.length===0||(he=Ve[0]).every(tt=>tt.x<=0)||he.every(tt=>tt.x>=jt)||he.every(tt=>tt.y<=0)||he.every(tt=>tt.y>=jt))&&Q.splice(Oe,1)}var he;let me;if(L)me=pE(Q,N,d);else{me=[];for(const Oe of Q)me.push({polygon:Oe,bounds:N})}const _e=V?this.edgeRadius:0,De=_e>0&&this.zoom<17,Pe=(Oe,Ve)=>{if(Oe.length===0)return!1;const tt=Oe[Oe.length-1];return Ve.x===tt.x&&Ve.y===tt.y};for(const{polygon:Oe,bounds:Ve}of me){let tt=0,vt=0;for(const rt of Oe)V&&!rt[0].equals(rt[rt.length-1])&&rt.push(rt[0]),vt+=V?rt.length-1:rt.length;const ft=this.segments.prepareSegment((V?5:4)*vt,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const xt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},St=new rE;if(St.vertexOffset=this.footprintVertices.length,St.indexOffset=3*this.footprintIndices.length,St.ringIndices=[],V){const rt=[],_t=[];tt=ft.vertexLength;for(let nt=0;nt<Oe.length;nt++){const Mt=Oe[nt];Mt.length&&nt!==0&&_t.push(rt.length/2);const Pt=[];let _n,nn;_n=Mt[1].sub(Mt[0])._perp()._unit(),St.ringIndices.push(Mt.length-1);for(let $t=1;$t<Mt.length;$t++){const At=Mt[$t],Gn=Mt[$t===Mt.length-1?1:$t+1],tn=At.clone();if(_e){nn=Gn.sub(At)._perp()._unit();const sn=_n.add(nn)._unit(),jn=_e*Math.min(4,1/(_n.x*sn.x+_n.y*sn.y));tn.x+=jn*sn.x,tn.y+=jn*sn.y,tn.x=Math.round(tn.x),tn.y=Math.round(tn.y),_n=nn}if(!te||_e!==0&&!De||Pe(Pt,tn)||Pt.push(tn),o_(this.layoutVertexArray,tn.x,tn.y,0,0,1,1,0),this.wallMode){const sn=pe($t,Mt);a_(this.wallVertexArray,fe.joinNormals[$t],!sn)}ft.vertexLength++,this.footprintVertices.emplaceBack(At.x,At.y),rt.push(At.x,At.y),L&&l_(this.layoutVertexExtArray,O.projectTilePoint(tn.x,tn.y,d),O.upVector(d,tn.x,tn.y))}te&&(_e===0||De)&&(Pt.length!==0&&Pe(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,Ve,I))}const et=this.wallMode?fe.indices:t_(rt,_t);for(let nt=0;nt<et.length;nt+=3)this.footprintIndices.emplaceBack(St.vertexOffset+et[nt+0],St.vertexOffset+et[nt+1],St.vertexOffset+et[nt+2]),this.indexArray.emplaceBack(tt+et[nt],tt+et[nt+2],tt+et[nt+1]),ft.primitiveLength++;St.indexCount+=et.length,St.vertexCount+=this.footprintVertices.length-St.vertexOffset}for(let rt=0;rt<Oe.length;rt++){const _t=Oe[rt];H.startRing(K,_t[0]);let et=_t.length>4&&hE(_t[_t.length-2],_t[0],_t[1]),nt=_e?zz(_t[_t.length-2],_t[0],_t[1],_e):0;const Mt=[];let Pt,_n,nn;_n=_t[1].sub(_t[0])._perp()._unit();let $t=!0;for(let At=1,Gn=0;At<_t.length;At++){let tn=_t[At-1],sn=_t[At];const jn=_t[At===_t.length-1?1:At+1];if(H.appendEdge(K,sn,tn),W1(sn,tn,Ve)){_e&&(_n=jn.sub(sn)._perp()._unit(),$t=!$t);continue}const nr=sn.sub(tn)._perp(),Kn=nr.x/(Math.abs(nr.x)+Math.abs(nr.y)),ur=nr.y>0?1:0,ir=tn.dist(sn);if(Gn+ir>32768&&(Gn=0),_e){nn=jn.sub(sn)._perp()._unit();let ye=cE(tn,sn,jn,lE(_n,nn),_e);isNaN(ye)&&(ye=0);const Se=sn.sub(tn)._unit();tn=tn.add(Se.mult(nt))._round(),sn=sn.add(Se.mult(-ye))._round(),nt=ye,_n=nn,te&&this.zoom>=17&&(Pe(Mt,tn)||Mt.push(tn),Pe(Mt,sn)||Mt.push(sn))}const hr=ft.vertexLength,qr=_t.length>4&&hE(tn,sn,jn);let Si=dE(Gn,et,$t);if(o_(this.layoutVertexArray,tn.x,tn.y,Kn,ur,0,0,Si),o_(this.layoutVertexArray,tn.x,tn.y,Kn,ur,0,1,Si),this.wallMode){const ye=pe(At-1,_t),Se=fe.joinNormals[At-1];a_(this.wallVertexArray,Se,ye),a_(this.wallVertexArray,Se,ye)}if(Gn+=ir,Si=dE(Gn,qr,!$t),et=qr,o_(this.layoutVertexArray,sn.x,sn.y,Kn,ur,0,0,Si),o_(this.layoutVertexArray,sn.x,sn.y,Kn,ur,0,1,Si),this.wallMode){const ye=pe(At,_t),Se=fe.joinNormals[At];a_(this.wallVertexArray,Se,ye),a_(this.wallVertexArray,Se,ye)}if(ft.vertexLength+=4,this.indexArray.emplaceBack(hr+0,hr+1,hr+2),this.indexArray.emplaceBack(hr+1,hr+3,hr+2),ft.primitiveLength+=2,_e){const ye=tt+(At===1?_t.length-2:At-2),Se=At===1?tt:ye+1;if(this.indexArray.emplaceBack(hr+1,ye,hr+3),this.indexArray.emplaceBack(ye,Se,hr+3),ft.primitiveLength+=2,Pt===void 0&&(Pt=hr),!W1(jn,_t[At],Ve)){const ot=At===_t.length-1?Pt:ft.vertexLength;this.indexArray.emplaceBack(hr+2,hr+3,ot),this.indexArray.emplaceBack(hr+3,ot+1,ot),this.indexArray.emplaceBack(hr+3,Se,ot+1),ft.primitiveLength+=3}$t=!$t}if(L){const ye=this.layoutVertexExtArray,Se=O.projectTilePoint(tn.x,tn.y,d),ot=O.projectTilePoint(sn.x,sn.y,d),Lt=O.upVector(d,tn.x,tn.y),Gt=O.upVector(d,sn.x,sn.y);l_(ye,Se,Lt),l_(ye,Se,Lt),l_(ye,ot,Gt),l_(ye,ot,Gt)}}V&&(tt+=_t.length-1),te&&_e&&this.zoom>=17&&(Mt.length!==0&&Pe(Mt,Mt[0])&&Mt.pop(),this.groundEffect.addData(Mt,Ve,I,_e>0))}this.footprintSegments.push(St),xt.triangleCount=this.indexArray.length-xt.triangleArrayOffset,this.polygonSegments.push(xt),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=H.borders?nE:this.encodeCentroid(H,K),this.centroidData.push(K),H.borders){this.featuresOnBorder.push(H);const Oe=this.featuresOnBorder.length-1;for(let Ve=0;Ve<H.borders.length;Ve++)H.borders[Ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ve].push(Oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,g,y,d,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,u,g,y,d,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((o,u)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}splitToSubtiles(){const e=[];for(let T=0;T<this.centroidData.length;T++){const C=this.centroidData[T],I=+(C.min.y+C.max.y>jt),N=2*I+(+(C.min.x+C.max.x>jt)^I);for(let O=0;O<C.polygonSegLen;O++){const L=C.polygonSegIdx+O;e.push({centroidIdx:T,subtile:N,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const o=new Rs;e.sort((T,C)=>T.triangleSegmentIdx===C.triangleSegmentIdx?T.subtile-C.subtile:T.triangleSegmentIdx-C.triangleSegmentIdx);let u=0,d=0,g=0;for(const T of e){if(T.triangleSegmentIdx!==u)break;g++}const y=e.length;for(;d!==e.length;){u=e[d].triangleSegmentIdx;let T=0,C=d,I=d;for(let N=C;N<g&&e[N].subtile===T;N++)I++;for(;C!==g;){const N=e[C];T=N.subtile;const O=this.centroidData[N.centroidIdx].min.clone(),L=this.centroidData[N.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let H=C;H<I;H++){const K=e[H],te=this.polygonSegments[K.polygonSegmentIdx],ae=this.centroidData[K.centroidIdx].min,fe=this.centroidData[K.centroidIdx].max,pe=this.indexArray.uint16;for(let Q=te.triangleArrayOffset;Q<te.triangleArrayOffset+te.triangleCount;Q++)o.emplaceBack(pe[3*Q],pe[3*Q+1],pe[3*Q+2]);V.primitiveLength+=te.triangleCount,O.x=Math.min(O.x,ae.x),O.y=Math.min(O.y,ae.y),L.x=Math.max(L.x,fe.x),L.y=Math.max(L.y,fe.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:O,max:L}),C=I;for(let H=C;H<g&&e[H].subtile===e[C].subtile;H++)I++}d=g;for(let N=d;N<y&&e[N].triangleSegmentIdx===e[d].triangleSegmentIdx;N++)g++}o._trim(),this.indexArray=o}getVisibleSegments(e,o,u){const d=new si;if(this.wallMode){for(const K of this.triangleSubSegments)d.segments.push(K.segment);return d}let g=0,y=0;const T=1<<e.canonical.z;if(o){const K=o.getMinMaxForTile(e);K&&(g=K.min,y=K.max)}y+=this.maxHeight;const C=e.toUnwrapped();let I;const N=[C.canonical.x/T+C.wrap,C.canonical.y/T],O=[(C.canonical.x+1)/T+C.wrap,(C.canonical.y+1)/T],L=(K,te,ae)=>[K[0]*(1-ae[0])+te[0]*ae[0],K[1]*(1-ae[1])+te[1]*ae[1]],V=[],H=[];for(const K of this.triangleSubSegments){V[0]=K.min.x/jt,V[1]=K.min.y/jt,H[0]=K.max.x/jt,H[1]=K.max.y/jt;const te=L(N,O,V),ae=L(N,O,H);if(new Dr([te[0],te[1],g],[ae[0],ae[1],y]).intersectsPrecise(u)===0){I&&(d.segments.push(I),I=void 0);continue}const fe=K.segment;I&&I.vertexOffset!==fe.vertexOffset&&(d.segments.push(I),I=void 0),I?(I.vertexLength+=fe.vertexLength,I.primitiveLength+=fe.primitiveLength):I={vertexOffset:fe.vertexOffset,primitiveLength:fe.primitiveLength,vertexLength:fe.vertexLength,primitiveOffset:fe.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&d.segments.push(I),d}encodeCentroid(e,o){const u=e.centroid(),d=o.span(),g=Math.min(7,Math.round(d.x*this.tileToMeter/10)),y=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Ot(Ee(u.x,1,jt-1)<<3|g,Ee(u.y,1,jt-1)<<3|y)}encodeBorderCentroid(e){if(!e.borders)return new Ot(0,0);const o=e.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const d=o[0][0]!==u?0:1;return new Ot(6|(o[0][0]!==u?0:65528),(o[d][0]+o[d][1])/2<<3|6)}{const d=o[2][0]!==u?2:3;return new Ot((o[d][0]+o[d][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(e){const o=this.centroidData[e.centroidDataIndex];o.flags&=Ep,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const o=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,d=e.flags&Ep?nE:e.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==d.y||g!==d.x){for(let y=o;y<u;++y)this.centroidVertexArray.emplace(y,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const d=o.getReplacementRegionsForTile(e.toUnwrapped());if(H1(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const g=[];for(const y of this.activeReplacements){if(y.order<u)continue;const T=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-e.canonical.z));for(const C of this.centroidData)if(!(C.flags&Ep||y.min.x>C.max.x||C.min.x>y.max.x||y.min.y>C.max.y||C.min.y>y.max.y))for(let I=0;I<C.footprintSegLen;I++){const N=this.footprintSegments[C.footprintSegIdx+I];if(g.length=0,jz(this.footprintVertices,N.vertexOffset,N.vertexCount,y.footprintTileId.canonical,e.canonical,g),Y2(y.footprint,g,this.footprintIndices.uint16,N.indexOffset,N.indexCount,-N.vertexOffset,-T)){C.flags|=Ep;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,o,u){let d=!1;for(let g=0;g<u.footprintSegLen;g++){const y=this.footprintSegments[u.footprintSegIdx+g];let T=0;for(const C of y.ringIndices){for(let I=T,N=C+T-1;I<C+T;N=I++){const O=this.footprintVertices.int16[2*(I+y.vertexOffset)+0],L=this.footprintVertices.int16[2*(I+y.vertexOffset)+1],V=this.footprintVertices.int16[2*(N+y.vertexOffset)+1];L>o!=V>o&&e<(this.footprintVertices.int16[2*(N+y.vertexOffset)+0]-O)*(o-L)/(V-L)+O&&(d=!d)}T=C}}return d}getHeightAtTileCoord(e,o){let u=Number.NEGATIVE_INFINITY,d=!0;const g=4*(e+jt)*jt+(o+jt);if(this.partLookup.hasOwnProperty(g)){const y=this.partLookup[g];return y?{height:y.height,hidden:!!(y.flags&Ep)}:void 0}for(const y of this.centroidData)e>y.max.x||y.min.x>e||o>y.max.y||y.min.y>o||this.footprintContainsPoint(e,o,y)&&y&&y.height>u&&(u=y.height,this.partLookup[g]=y,d=!!(y.flags&Ep));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[g]=void 0}}function lE(a,e){const o=a.add(e)._unit();return a.x*o.x+a.y*o.y}function zz(a,e,o,u){const d=e.sub(a)._perp()._unit(),g=o.sub(e)._perp()._unit();return cE(a,e,o,lE(d,g),u)}function cE(a,e,o,u,d){const g=Math.sqrt(1-u*u);return Math.min(a.dist(e)/3,e.dist(o)/3,d*g/u)}function W1(a,e,o){return a.x<o[0].x&&e.x<o[0].x||a.x>o[1].x&&e.x>o[1].x||a.y<o[0].y&&e.y<o[0].y||a.y>o[1].y&&e.y>o[1].y}function uE(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function hE(a,e,o){if(a.x<0||a.x>=jt||e.x<0||e.x>=jt||o.x<0||o.x>=jt)return!1;const u=o.sub(e),d=u.perp(),g=a.sub(e);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&d.x*g.x+d.y*g.y<0}function dE(a,e,o){const u=e?2|a:-3&a;return o?1|u:-2&u}function fE(){const a=Math.PI/32,e=Math.tan(a),o=ie;return o*Math.sqrt(1+2*e*e)-o}function pE(a,e,o){const u=1<<o.z,d=Re(o.x/u),g=Re((o.x+1)/u),y=Be(o.y/u),T=Be((o.y+1)/u);return function(C,I,N,O,L=0,V){const H=[];if(!C.length||!N||!O)return H;const K=(me,_e)=>{for(const De of me)H.push({polygon:De,bounds:_e})},te=Math.ceil(Math.log2(N)),ae=Math.ceil(Math.log2(O)),fe=te-ae,pe=[];for(let me=0;me<Math.abs(fe);me++)pe.push(fe>0?0:1);for(let me=0;me<Math.min(te,ae);me++)pe.push(0),pe.push(1);let Q=C;if(Q=Rx(Q,I[0].y-L,I[1].y+L,1),Q=Rx(Q,I[0].x-L,I[1].x+L,0),!Q.length)return H;const he=[];for(pe.length?he.push({polygons:Q,bounds:I,depth:0}):K(Q,I);he.length;){const me=he.pop(),_e=me.depth,De=pe[_e],Pe=me.bounds[0],Oe=me.bounds[1],Ve=De===0?Pe.x:Pe.y,tt=De===0?Oe.x:Oe.y,vt=V?V(De,Ve,tt):.5*(Ve+tt),ft=Rx(me.polygons,Ve-L,vt+L,De),xt=Rx(me.polygons,vt-L,tt+L,De);if(ft.length){const St=[Pe,new Ot(De===0?vt:Oe.x,De===1?vt:Oe.y)];pe.length>_e+1?he.push({polygons:ft,bounds:St,depth:_e+1}):K(ft,St)}if(xt.length){const St=[new Ot(De===0?vt:Pe.x,De===1?vt:Pe.y),Oe];pe.length>_e+1?he.push({polygons:xt,bounds:St,depth:_e+1}):K(xt,St)}}return H}(a,e,Math.ceil((g-d)/11.25),Math.ceil((y-T)/11.25),1,(C,I,N)=>{if(C===0)return .5*(I+N);{const O=Be((o.y+I/jt)/u);return(be(.5*(Be((o.y+N/jt)/u)+O))*u-o.y)*jt}})}function jz(a,e,o,u,d,g){const y=Math.pow(2,u.z-d.z);for(let T=0;T<o;T++){let C=a.int16[2*(T+e)+0],I=a.int16[2*(T+e)+1];C=(C+d.x*jt)*y-u.x*jt,I=(I+d.y*jt)*y-u.y*jt,g.push(new Ot(C,I))}}let mE,gE;Zt(Lx,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(iE,"PartData"),Zt(rE,"FootprintSegment"),Zt(sE,"BorderCentroidData"),Zt(aE,"GroundEffect");class Zm extends Ot{constructor(e,o,u){super(e,o),this.z=u}}class yE extends Zm{constructor(e,o,u,d){super(e,o,u),this.w=d}}function _E(a,e,o,u){const d=o==="x"?"y":"x",g=(u-a[o])/(e[o]-a[o]);a[d]=Math.round(a[d]+(e[d]-a[d])*g),a[o]=u,a.hasOwnProperty("z")&&(a.z=Mn(a.z,e.z,g)),a.hasOwnProperty("w")&&(a.w=Mn(a.w,e.w,g))}function xE(a,e,o,u){const d=o,g=u;for(const y of["x","y"]){let T=a,C=e;T[y]>=C[y]&&(T=e,C=a),T[y]<d&&C[y]>d&&_E(T,C,y,d),T[y]<g&&C[y]>g&&_E(C,T,y,g)}}function zx(a,e,o,u,d,g){const y=[];for(let T=0;T<a.length;T++){const C=a[T];let I;const N=y.length;let O=0;for(let L=0;L<C.length-1;L++){let V=C[L],H=C[L+1],K=0;const te=O;let ae,fe;g&&(K=Math.hypot(H.x-V.x,H.y-V.y),O+=K,ae=V,fe=H),V.x<e&&H.x<e||(V.x<e?V=new Ot(e,V.y+(e-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x<e&&(H=new Ot(e,V.y+(e-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y<o&&H.y<o||(V.y<o?V=new Ot(V.x+(o-V.y)/(H.y-V.y)*(H.x-V.x),o)._round():H.y<o&&(H=new Ot(V.x+(o-V.y)/(H.y-V.y)*(H.x-V.x),o)._round()),V.x>=u&&H.x>=u||(V.x>=u?V=new Ot(u,V.y+(u-V.x)/(H.x-V.x)*(H.y-V.y))._round():H.x>=u&&(H=new Ot(u,V.y+(u-V.x)/(H.x-V.x)*(H.y-V.y))._round()),V.y>=d&&H.y>=d||(V.y>=d?V=new Ot(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round():H.y>=d&&(H=new Ot(V.x+(d-V.y)/(H.y-V.y)*(H.x-V.x),d)._round()),I&&V.equals(I[I.length-1])||(I=[V],y.push(I),g&&g.push({progress:{min:te+vE(ae,fe,V)*K,max:1},parentIndex:T,prevPoint:ae,nextPoint:fe})),I.push(H),g&&(g[g.length-1].progress.max=te+vE(ae,fe,H)*K,g[g.length-1].nextPoint=fe)))))}if(g&&O>0)for(let L=N;L<y.length;L++)g[L].progress.min/=O,g[L].progress.max/=O}return y}function Fz(a,e,o,u,d){if(a.length<2)return void u.push(a);const g=[];for(;e.valid();){const[I,N]=e.get();for(let O=0;O<a.length-1;O++){const L=a[O],V=a[O+1],H=Bm(L,V,I,N);if(H){const[K]=H,te=new Ot(Mn(L.x,V.x,K),Mn(L.y,V.y,K));g.push({t:O+K,distance:0,point:te})}}e.next()}if(g.length===0)return void u.push(a);g.sort((I,N)=>I.t-N.t);let y=0,T=0,C=[];for(u.push(C);y!==a.length;){if(T===g.length){for(;y!==a.length;)C.length!==0&&C[C.length-1].equals(a[y])||C.push(a[y]),y++;break}g[T].t<=y?(C.length!==0&&C[C.length-1].equals(g[T].point)||C.push(g[T].point),Math.trunc(g[T].t),T++):(C.length!==0&&C[C.length-1].equals(a[y])||C.push(a[y]),y++)}}function vE(a,e,o){return a.x!==e.x?(o.x-a.x)/(e.x-a.x):a.y!==e.y?(o.y-a.y)/(e.y-a.y):0}function c_(a,e){return a.x*e.x+a.y*e.y}function bE(a,e){if(a.length===1){let o=0;const u=e[o++];let d;for(;!d||u.equals(d);)if(d=e[o++],!d)return 1/0;for(;o<e.length;o++){const g=e[o],y=a[0],T=d.sub(u),C=g.sub(u),I=y.sub(u),N=c_(T,T),O=c_(T,C),L=c_(C,C),V=c_(I,T),H=c_(I,C),K=N*L-O*O,te=(L*V-O*H)/K,ae=(N*H-O*V)/K,fe=u.z*(1-te-ae)+d.z*te+g.z*ae;if(isFinite(fe))return fe}return 1/0}{let o=1/0;for(const u of e)o=Math.min(o,u.z);return o}}function wE(a,e,o,u,d,g,y,T){const C=y*d.getElevationAt(a,e,!0,!0),I=g[0]!==0,N=I?g[1]===0?y*(g[0]/7-450):y*function(O,L,V){const H=Math.floor(L[0]/8),K=Math.floor(L[1]/8),te=10*(L[0]-8*H),ae=10*(L[1]-8*K),fe=O.getElevationAt(H,K,!0,!0),pe=O.getMeterToDEM(V),Q=Math.floor(.5*(te*pe-1)),he=Math.floor(.5*(ae*pe-1)),me=O.tileCoordToPixel(H,K),_e=2*Q+1,De=2*he+1,Pe=function(xt,St,rt,_t,et){return[xt.getElevationAtPixel(St,rt,!0),xt.getElevationAtPixel(St+et,rt,!0),xt.getElevationAtPixel(St,rt+et,!0),xt.getElevationAtPixel(St+_t,rt+et,!0)]}(O,me.x-Q,me.y-he,_e,De),Oe=Math.abs(Pe[0]-Pe[1]),Ve=Math.abs(Pe[2]-Pe[3]),tt=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),vt=Math.min(.25,.5*pe*(Oe+Ve)/_e),ft=Math.min(.25,.5*pe*tt/De);return fe+Math.max(vt*te,ft*ae)}(d,g,T):C;return{base:C+(o===0?-1:o),top:I?Math.max(N+u,C+o+2):C+u}}class Bz{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Vz{constructor(){this.tasks={},this.taskQueue=[],Qt(["process"],this),this.invoker=new Bz(this.process),this.nextId=0}add(e,o){const u=this.nextId++,d=function({type:g,isSymbolTile:y,zoom:T}){return T=T||0,g==="message"?0:g!=="maybePrepare"||y?g!=="parseTile"||y?g==="parseTile"&&y?300-T:g==="maybePrepare"&&y?400-T:500:200-T:100-T}(o);if(d===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:o,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let d=0;d<this.taskQueue.length;d++){const g=this.tasks[this.taskQueue[d]];g.priority<o&&(o=g.priority,e=d)}if(e===null)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class SE{constructor(e,o,u){this.target=e,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Vz}send(e,o,u,d,g=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=y,this.callbacks[T]=u);const C=new Set;return this.target.postMessage({id:T,type:e,hasCallback:!!u,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:qo(o,C)},C),{cancel:()=>{u&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(e){const o=e.data;if(!o)return;const u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(o.mustQueue||Fr(self)){const d=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,o),d&&d.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,o)}processTask(e,o){if(delete this.cancelCallbacks[e],o.type==="<response>"){const u=this.callbacks[e];delete this.callbacks[e],u&&(o.error?u(Fl(o.error)):u(null,Fl(o.data)))}else{const u=new Set,d=o.hasCallback?(y,T)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:y?qo(y):null,data:qo(T,u)},u)}:()=>{},g=Fl(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,g,d);else if(this.parent.getWorkerSource){const y=o.type.split("."),{source:T,scope:C}=g;this.parent.getWorkerSource(o.sourceMapId,y[0],T,C)[y[1]](g,d)}else d(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var u_={workerUrl:"",workerClass:null,workerParams:void 0};const Z1="mapboxgl_preloaded_worker_pool";class Xm{constructor(){this.active={}}acquire(e,o=Xm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<o;)this.workers.push(u_.workerClass!=null?new u_.workerClass:new self.Worker(u_.workerUrl,u_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Z1]}numActive(){return Object.keys(this.active).length}}Xm.workerCount=2;class Wg{constructor(e,o,u="Worker",d=Xm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ze();const g=this.workerPool.acquire(this.id,d);for(let y=0;y<g.length;y++){const T=new Wg.Actor(g[y],o,this.id);T.name=`${u} ${y}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,o,u){je(this.actors,(d,g)=>{d.send(e,o,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let h_,X1;function jx(){return h_||(h_=new Xm),h_}Wg.Actor=SE;class Uz{constructor(e){this.module=e}createIntArray(e){const o=new Int32Array(e),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heap32.set(o,u/o.BYTES_PER_ELEMENT),u}createFloatArray(e){const o=new Float32Array(e),u=this.module.malloc(o.length*o.BYTES_PER_ELEMENT);return this.module.heapF32.set(o,u/o.BYTES_PER_ELEMENT),u}createStringBuffer(e){const o=this.module.malloc(e.length+1);for(let u=0;u<e.length;++u)this.module.heapU8[o+u]=e.charCodeAt(u);return this.module.heapU8[o+e.length]=0,o}readStringBuffer(e){let o="";for(;this.module.heapU8[e]!==0;)o+=String.fromCharCode(this.module.heapU8[e]),++e;return o}setStyle(e){const o=e.entranceColorRgb,u=e.facadeGlazingColorRgb,d=e.roofColorRgb,g=e.wallColorRgb,y=e.normalScale;this.module.setStyle(o[0],o[1],o[2],u[0],u[1],u[2],d[0],d[1],d[2],g[0],g[1],g[2],y[0],y[1],y[2],e.tileToMeters)}setAOOptions(e,o){this.module.setAOOptions(e?1:0,o)}setMetricOptions(e,o){this.module.setMetricOptions(e?1:0,o)}setFacadeOptions(e,o,u){this.module.setFacadeOptions(e,o,u)}generateMesh(e,o){for(const T of e){const C=this.createStringBuffer(T.roofType),I=[0],N=[];for(const V of T.coordinates)if(Array.isArray(V)){for(const H of V)N.push(H.x),N.push(H.y);I.push(N.length)}const O=this.createIntArray(I),L=this.createFloatArray(N);this.module.addFeature(T.id,T.sourceId,T.minHeight,T.height,C,T.roofType.length,L,O,I.length-1),this.module.free(C),this.module.free(O),this.module.free(L)}for(const T of o){let C;C=T.entrances?JSON.parse(T.entrances):[];const I=this.createFloatArray(C),N=[];for(const L of T.coordinates)N.push(L.x),N.push(L.y);const O=this.createFloatArray(N);this.module.addFacade(T.sourceId,T.crossPerc,T.distanceToRoad,I,C.length,O,N.length),this.module.free(I),this.module.free(O)}if(!this.module.generateMesh()){const T=this.module.getLastError();return this.readStringBuffer(T)}const u=this.module.getMeshCount(),d=new Array(u);for(let T=0;T<u;T++){const C=this.module.getPositionsPtr(T),I=this.module.getPositionsLength(T),N=new Float32Array(this.module.heapF32.buffer,C,I),O=this.module.getNormalsPtr(T),L=this.module.getNormalsLength(T),V=new Float32Array(this.module.heapF32.buffer,O,L),H=this.module.getColorsPtr(T),K=this.module.getColorsLength(T),te=new Uint8Array(this.module.heapU8.buffer,H,K),ae=this.module.getAOPtr(T),fe=this.module.getAOLength(T),pe=new Float32Array(this.module.heapF32.buffer,ae,fe),Q=this.module.getIndicesPtr(T),he=this.module.getIndicesLength(T),me=new Int32Array(this.module.heap32.buffer,Q,he),_e=this.module.getBuildingPart(T),De=this.readStringBuffer(_e);d[T]={positions:N,normals:V,colors:te,ao:pe,indices:me,buildingPart:De}}const g=this.module.getRingCount(),y=[];for(let T=0;T<g;T++){const C=this.module.getRingPtr(T),I=this.module.getRingLength(T),N=new Float32Array(this.module.heapF32.buffer,C,I);y.push(N)}return{meshes:d,modifiedPolygonRings:y}}}let d_,K1,rh,Zg,Y1,Xg=null,Kg=null,TE=null,J1=null;function EE(){return Fr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:K1||Gs.DRACO_URL}function CE(){if(Fr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Zg)return Zg;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Zg=WebAssembly.validate(a)?Gs.MESHOPT_SIMD_URL:Gs.MESHOPT_URL,Zg}const Fx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$z={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},f_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function AE(a,e,o){const u=o.json.bufferViews.length,d=o.buffers.length;e.bufferView=u,o.json.bufferViews[u]={buffer:d,byteLength:a.byteLength},o.buffers[d]=a}const Q1="KHR_draco_mesh_compression";function Hz(a,e){const o=a.extensions&&a.extensions[Q1];if(!o)return;const u=new rh.Decoder,d=PE(e,o.bufferView),g=new rh.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,g))throw new Error("Failed to decode Draco mesh");const y=e.json.accessors[a.indices],T=Fx[y.componentType],C=y.count*T.BYTES_PER_ELEMENT,I=rh._malloc(C);T===Uint16Array?u.GetTrianglesUInt16Array(g,C,I):u.GetTrianglesUInt32Array(g,C,I),AE(rh.memory.buffer.slice(I,I+C),y,e),rh._free(I);for(const N of Object.keys(o.attributes)){const O=u.GetAttributeByUniqueId(g,o.attributes[N]),L=e.json.accessors[a.attributes[N]],V=$z[L.componentType],H=L.count*f_[L.type]*Fx[L.componentType].BYTES_PER_ELEMENT,K=rh._malloc(H);u.GetAttributeDataArrayForAllPoints(g,O,rh[V],H,K),AE(rh.memory.buffer.slice(K,K+H),L,e),rh._free(K)}u.destroy(),g.destroy(),delete a.extensions[Q1]}const Bx="EXT_meshopt_compression";function Gz(a,e){if(!a.extensions||!a.extensions[Bx])return;const o=a.extensions[Bx],u=new Uint8Array(e.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),d=new Uint8Array(o.count*o.byteStride);Y1.decodeGltfBuffer(d,o.count,o.byteStride,u,o.mode,o.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=d.buffer,delete a.extensions[Bx]}const IE=1179937895,ME=new TextDecoder("utf8");function kE(a,e){return new URL(a,e).href}function qz(a,e,o,u){return fetch(kE(a.uri,u)).then(d=>d.arrayBuffer()).then(d=>{e.buffers[o]=d})}function PE(a,e){const o=a.json.bufferViews[e];return new Uint8Array(a.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function Wz(a,e,o,u){if(a.uri){const d=kE(a.uri,u);return fetch(d).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{e.images[o]=g})}if(a.bufferView!==void 0){const d=PE(e,a.bufferView),g=new Blob([d],{type:a.mimeType});return createImageBitmap(g).then(y=>{e.images[o]=y})}}function RE(a,e=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===IE){const N=new Uint32Array(a,e);let O=2;const L=(N[O++]>>2)-3,V=N[O++]>>2;if(O++,u.json=JSON.parse(ME.decode(N.subarray(O,O+V))),O+=V,O<L){const H=N[O++];O++;const K=e+(O<<2);u.buffers[0]=a.slice(K,K+H)}}else u.json=JSON.parse(ME.decode(new Uint8Array(a,e)));const{buffers:d,images:g,meshes:y,extensionsUsed:T,bufferViews:C}=u.json;let I=Promise.resolve();if(d){const N=[];for(let O=0;O<d.length;O++){const L=d[O];L.uri?N.push(qz(L,u,O,o)):u.buffers[O]||(u.buffers[O]=null)}I=Promise.all(N)}return I.then(()=>{const N=[],O=T&&T.includes(Q1),L=T&&T.includes(Bx);if(O&&N.push(function(){if(!rh)return d_??(d_=function(V){let H,K=null;function te(){H=new Uint8Array(K.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const fe={a:{a:ae,d:function(pe,Q,he){return H.copyWithin(pe,Q,Q+he)},c:function(pe){const Q=H.length,he=Math.max(pe>>>0,Math.ceil(1.2*Q)),me=Math.ceil((he-Q)/65536);try{return K.grow(me),te(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,fe):V.then(pe=>pe.arrayBuffer()).then(pe=>WebAssembly.instantiate(pe,fe))).then(pe=>{const{Rb:Q,Qb:he,P:me,T:_e,X:De,Ja:Pe,La:Oe,Qa:Ve,Va:tt,Wa:vt,eb:ft,jb:xt,f:St,e:rt,yb:_t,zb:et,Ab:nt,Bb:Mt,Db:Pt,Gb:_n}=pe.instance.exports;K=rt;const nn=(()=>{let $t=0,At=0,Gn=0,tn=0;return sn=>{Gn&&(Q(tn),Q($t),At+=Gn,Gn=$t=0),$t||(At+=128,$t=he(At));const jn=sn.length+7&-8;let nr=$t;jn>=At&&(Gn=jn,nr=tn=he(jn));for(let Kn=0;Kn<sn.length;Kn++)H[nr+Kn]=sn[Kn];return nr}})();return te(),St(),{memory:rt,_free:Q,_malloc:he,Mesh:class{constructor(){this.ptr=me()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){xt(this.ptr)}DecodeArrayToMesh($t,At,Gn){const tn=nn($t),sn=Oe(this.ptr,tn,At,Gn.ptr);return!!De(sn)}GetAttributeByUniqueId($t,At){return{ptr:Ve(this.ptr,$t.ptr,At)}}GetTrianglesUInt16Array($t,At,Gn){tt(this.ptr,$t.ptr,At,Gn)}GetTrianglesUInt32Array($t,At,Gn){vt(this.ptr,$t.ptr,At,Gn)}GetAttributeDataArrayForAllPoints($t,At,Gn,tn,sn){ft(this.ptr,$t.ptr,At.ptr,Gn,tn,sn)}},DT_INT8:_t(),DT_UINT8:et(),DT_INT16:nt(),DT_UINT16:Mt(),DT_UINT32:Pt(),DT_FLOAT32:_n()}})}(fetch(EE())),d_.then(V=>{rh=V,d_=void 0}))}()),L&&N.push(function(){if(Y1)return;const V=function(H){let K;const te=WebAssembly.instantiateStreaming(H,{}).then(pe=>{K=pe.instance,K.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},fe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:te,supported:!0,decodeGltfBuffer(pe,Q,he,me,_e,De){(function(Pe,Oe,Ve,tt,vt,ft,xt){const St=Pe.exports.sbrk,rt=tt+3&-4,_t=St(rt*vt),et=St(ft.length),nt=new Uint8Array(Pe.exports.memory.buffer);nt.set(ft,et);const Mt=Oe(_t,tt,vt,et,ft.length);if(Mt===0&&xt&&xt(_t,rt,vt),Ve.set(nt.subarray(_t,_t+tt*vt)),St(_t-St(0)),Mt!==0)throw new Error(`Malformed buffer data: ${Mt}`)})(K,K.exports[fe[_e]],pe,Q,he,me,K.exports[ae[De]])}}}(fetch(CE()));return V.ready.then(()=>{Y1=V})}()),g)for(let V=0;V<g.length;V++)N.push(Wz(g[V],u,V,o));return(N.length?Promise.all(N):Promise.resolve()).then(()=>{if(O&&y)for(const{primitives:V}of y)for(const H of V)Hz(H,u);if(L&&y&&C)for(const V of C)Gz(V,u);return u})})}class NE{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,o){}prepare(){return function(){if(J1!=null||TE!=null)return null;if(Kg!=null)return Kg;const e=fetch(Gs.BUILDING_GEN_URL);return Kg=function(o){let u,d,g,y;function T(){u=new Uint8Array(y.buffer),d=new Int32Array(y.buffer),g=new Float32Array(y.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const I=()=>{},N={a:{a:C,f:function(O){const L=u.length,V=Math.max(O>>>0,Math.ceil(1.2*L)),H=Math.ceil((V-L)/65536);try{return y.grow(H),T(),!0}catch{return!1}},g:C,b:I,c:I,d:I,e:I}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(o,N):o.then(O=>O.arrayBuffer()).then(O=>WebAssembly.instantiate(O,N))).then(O=>{const L=O.instance.exports;return(0,L.g)(),y=L.f,T(),new Uz({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setFacadeOptions:L.k,addFeature:L.l,addFacade:L.m,generateMesh:L.n,getLastError:L.o,getMeshCount:L.p,getPositionsPtr:L.q,getPositionsLength:L.r,getNormalsPtr:L.s,getNormalsLength:L.t,getColorsPtr:L.u,getColorsLength:L.v,getAOPtr:L.w,getAOLength:L.x,getIndicesPtr:L.y,getIndicesLength:L.z,getBuildingPart:L.A,getRingCount:L.B,getRingPtr:L.C,getRingLength:L.D,free:L.E,malloc:L.F,heapU8:u,heap32:d,heapF32:g})})}(e).then(o=>(Kg=null,J1=o,J1)).catch(o=>{Hn("Could not load building-gen"),Kg=null,TE=o}),Kg}()}populate(e,o,u,d){}update(e,o,u,d,g,y,T){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,o){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let DE,OE;Zt(NE,"BuildingBucket",{omit:["layers"]});const Zz=Tr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Xz=Tr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Kz}=Zz,Yz=Tr([{name:"a_packed",components:3,type:"Float32"}]),{members:Jz}=Yz,Qz=Tr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ej}=Qz;class LE{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new Tp({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const u=this.getKey(e,o);return this.positions[u]}trim(){const e=this.width,o=this.height=Nt(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,u){const d=[];let g=e.length%2==1?-e[e.length-1]*u:0,y=e[0]*u,T=!0;d.push({left:g,right:y,isDash:T,zeroLength:e[0]===0});let C=e[0];for(let I=1;I<e.length;I++){T=!T;const N=e[I];g=C*u,C+=N,y=C*u,d.push({left:g,right:y,isDash:T,zeroLength:N===0})}return d}addRoundDash(e,o,u){const d=o/2;for(let g=-u;g<=u;g++){const y=this.width*(this.nextRow+u+g);let T=0,C=e[T];for(let I=0;I<this.width;I++){I/C.right>1&&(C=e[++T]);const N=Math.abs(I-C.left),O=Math.abs(I-C.right),L=Math.min(N,O);let V;const H=g/u*(d+1);if(C.isDash){const K=d-Math.abs(H);V=Math.sqrt(L*L+K*K)}else V=d-Math.sqrt(L*L+H*H);this.image.data[y+I]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,o){for(let C=e.length-1;C>=0;--C){const I=e[C],N=e[C+1];I.zeroLength?e.splice(C,1):N&&N.isDash===I.isDash&&(N.left=I.left,e.splice(C,1))}const u=e[0],d=e[e.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const g=this.width*this.nextRow;let y=0,T=e[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=e[++y]);const I=Math.abs(C-T.left),N=Math.abs(C-T.right),O=Math.min(I,N);this.image.data[g+C]=Math.max(0,Math.min(255,(T.isDash?O:-O)+o+128))}}addDash(e,o){const u=this.getKey(e,o);if(this.positions[u])return this.positions[u];const d=o==="round",g=d?7:0,y=2*g+1;if(this.nextRow+y>this.height)return Hn("LineAtlas out of space"),null;e.length===0&&e.push(1);let T=0;for(let N=0;N<e.length;N++)e[N]<0&&(Hn("Negative value is found in line dasharray, replacing values with 0"),e[N]=0),T+=e[N];if(T!==0){const N=this.width/T,O=this.getDashRanges(e,this.width,N);d?this.addRoundDash(O,N,g):this.addRegularDash(O,o==="square"?.5*N:0)}const C=this.nextRow+g;this.nextRow+=y;const I={tl:[C,g],br:[T,0]};return this.positions[u]=I,I}}Zt(LE,"LineAtlas");const tj=er.VectorTileFeature.types,nj=Math.cos(Math.PI/180*37.5),rj=Math.cos(Math.PI/180*5);class eb{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new hp,this.layoutVertexArray2=new gl,this.patternVertexArray=new gl,this.indexArray=new Rs,this.programConfigurations=new f(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new si,this.maxLineLength=0,this.zOffsetVertexArray=new gl,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:jt/64,this.worldview=e.worldview}updateFootprints(e,o){}populate(e,o,u,d){this.hasPattern=z1("line",this.layers,this.pixelRatio,o);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Je(u);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),V=L.isConstant()&&!L.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&y==="none"&&Hn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const C=[];for(const{feature:L,id:V,index:H,sourceLayerIndex:K}of e){const te=this.layers[0]._featureFilter.needGeometry,ae=Bt(L,te);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),ae,u))continue;const fe=g?g.evaluate(ae,{},u):void 0,pe={id:V,properties:L.properties,type:L.type,sourceLayerIndex:K,index:H,geometry:te?ae.geometry:qt(L,u,d),patterns:{},sortKey:fe};C.push(pe)}g&&C.sort((L,V)=>L.sortKey-V.sortKey);const{lineAtlas:I,featureIndex:N}=o,O=this.addConstantDashes(I);for(const L of C){const{geometry:V,index:H,sourceLayerIndex:K}=L;if(O&&this.addFeatureDashes(L,I),this.hasPattern){const te=j1("line",this.layers,L,this.zoom,this.pixelRatio,o);this.patternFeatures.push(te)}else this.addFeature(L,V,H,u,I.positions,o.availableImages,o.brightness,o.elevationFeatures);N.insert(e[H].feature,V,H,K,this.index)}}addConstantDashes(e){let o=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(d.kind!=="constant"||g.kind!=="constant")o=!0;else{const y=g.value,T=d.value;if(!T)continue;e.addDash(T,y)}}return o}addFeatureDashes(e,o){const u=this.zoom;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(g.kind==="constant"&&y.kind==="constant")continue;let T,C;if(g.kind==="constant"){if(T=g.value,!T)continue}else T=g.evaluate({zoom:u},e);C=y.kind==="constant"?y.value:y.evaluate({zoom:u},e),o.addDash(T,C),e.patterns[d.id]=[o.getKey(T,C)]}}update(e,o,u,d,g,y,T,C){this.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,C)}addFeatures(e,o,u,d,g,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,o,u,d,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Jz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,ej)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Xz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,u,d,g,y,T,C){const I=this.layers[0].layout,N=I.get("line-join").evaluate(e,{}),O=I.get("line-cap").evaluate(e,{}),L=I.get("line-miter-limit"),V=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=I.get("line-z-offset").value;const H=this.layers[0].paint.get("line-width").value;if(H.kind!=="constant"&&H.isLineProgressConstant===!1&&(this.variableWidthValue=H),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,o,d,C,N,O,L,V)){const[te,ae]=this.clipRuntimeLinesToTile(o,1);for(let fe=0;fe<te.length;fe++){const pe=te[fe],Q=ae[fe],he={progress:{min:Q.progress.min,max:Q.progress.max},nextDir:this.computeSegNextDir(Q,pe),prevDir:this.computeSegPrevDir(Q,pe)};this.addLine(pe,e,d,N,O,L,V,he)}this.fillNonElevatedRoadSegment(K)}}else for(const K of o)this.addLine(K,e,d,N,O,L,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,g,y,d,T,void 0,this.worldview)}computeSegNextDir(e,o){return e.nextPoint.sub(o.at(-2)).unit()}computeSegPrevDir(e,o){return o[1].sub(e.prevPoint).unit()}clipLinesToTile(e,o){return zx(e,-o,-o,jt+o,jt+o)}clipRuntimeLinesToTile(e,o){const u=[];return[zx(e,-o,-o,jt+o,jt+o,u),u]}addElevatedRoadFeature(e,o,u,d,g,y,T,C){const I=[],N=Oa.getElevationFeature(e,d);if(N){const O=this.clipLinesToTile(o,1),L=this.prepareElevatedLines(O,N,u);for(const V of L)I.push({geometry:V,elevation:N,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const O of I){const L=this.layoutVertexArray.length;this.addLine(O.geometry,e,u,g,y,T,C);const V=new ws(u,O.elevationTileID);if(O.elevation)for(let H=L;H<this.layoutVertexArray.length;H++){const K=new Ot(this.layoutVertexArray.int16[6*H]>>1,this.layoutVertexArray.int16[6*H+1]>>1),te=V.pointElevation(K,O.elevation,.05);this.updateHeightRange(te),this.zOffsetVertexArray.emplaceBack(te,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(e,o,u){if(o.constantHeight!=null)return e;const d=[],g=1/Je(u);for(const y of e)Fz(y,new Zo(o,g),0,d);return d}fillNonElevatedRoadSegment(e){for(let o=e;o<this.layoutVertexArray.length;o++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,o,u,d,g,y,T,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const I=d==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const N=C&&C.progress.min>0,O=C&&C.progress.max<1;if(this.lineClips){let De={min:this.lineClips.start,max:this.lineClips.end},Pe=1;if(C){const tt=this.lineClips.end-this.lineClips.start;De=function(vt,ft,xt){return{min:Bo(vt.min,ft,xt),max:Bo(vt.max,ft,xt)}}(C.progress,{min:0,max:1},De),tt>0&&(Pe=(De.max-De.min)/tt)}const Oe=+o.properties.mapbox_clip_feature_len,Ve=+o.properties.mapbox_clip_seg_len;if(Number.isNaN(Oe)||Number.isNaN(Ve)){for(let vt=0;vt<e.length-1;vt++)this.totalDistance+=e[vt].dist(e[vt+1]);const tt=this.totalDistance/(De.max-De.min);this.totalFeatureLength=Number.isFinite(tt)?tt:0,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Oe,this.distance=Ve*Pe,this.lineClips.start=De.min,this.lineClips.end=De.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=tj[o.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let H=0;for(;H<V-1&&e[H].equals(e[H+1]);)H++;if(V<(L?3:2))return;d==="bevel"&&(y=1.05);const K=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let te,ae,fe,pe,Q,he,me,_e;C&&C.prevDir&&(he=C.prevDir.perp()),C&&C.nextDir&&(me=C.nextDir.perp()),this.e1=this.e2=-1,L&&(te=e[V-2],Q=e[H].sub(te)._unit()._perp());for(let De=H;De<V;De++){if(fe=De===V-1?L?e[H+1]:void 0:e[De+1],fe&&e[De].equals(fe))continue;Q&&(pe=Q),te&&(ae=te),te=e[De],_e=this.evaluateLineProgressFeatures(ae?ae.dist(te):0),Q=fe?fe.sub(te)._unit()._perp():pe,pe=pe||Q;const Pe=ae&&fe;let Oe=Pe?d:L||I?"butt":g;const Ve=pe.x*Q.x+pe.y*Q.y;if(I){const et=function(nt){if(nt.patternJoinNone){const Mt=nt.segmentPoints.length/2,Pt=nt.lineSoFar-nt.segmentStart;for(let _n=0;_n<Mt;++_n){const nn=nt.segmentPoints[2*_n+1],$t=Math.round(nt.segmentPoints[2*_n])+.5+.25*nn;nt.patternVertexArray.emplaceBack($t,Pt,nt.segmentStart),nt.patternVertexArray.emplaceBack($t,Pt,nt.segmentStart)}nt.segmentPoints.length=0}nt.e1=nt.e2=-1};if(Pe&&Ve<rj){this.updateDistance(ae,te),this.addCurrentVertex(te,pe,1,1,K,_e),et(this),this.addCurrentVertex(te,Q,-1,-1,K,_e);continue}if(ae){if(!fe){this.updateDistance(ae,te),this.addCurrentVertex(te,pe,1,1,K,_e),et(this);continue}Oe="miter"}}let tt=pe.add(Q);tt.x===0&&tt.y===0||tt._unit();const vt=tt.x*Q.x+tt.y*Q.y,ft=vt!==0?1/vt:1/0,xt=2*Math.sqrt(2-2*vt),St=vt<nj&&ae&&fe,rt=pe.x*Q.y-pe.y*Q.x>0,_t=this.overscaling<=16?15*jt/(512*this.overscaling):0;if(Pe&&Oe==="round"){if(ft<T)Oe="miter";else if(ft<=2){const et=tb(te,-10,jt+10);Oe=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(Oe==="miter"&&ft>y&&(Oe="bevel"),Oe==="bevel"&&(ft>2&&(Oe="flipbevel"),ft<y&&(Oe="miter")),ae&&!(Oe==="miter"&&St)&&this.updateDistance(ae,te),Oe==="miter")if(St){const et=te.dist(ae);if(et>2*_t){const Mt=te.sub(te.sub(ae)._mult(_t/et)._round());this.updateDistance(ae,Mt),this.addCurrentVertex(Mt,pe,0,0,K,_e),ae=Mt}this.updateDistance(ae,te),tt._mult(ft),this.addCurrentVertex(te,tt,0,0,K,_e);const nt=te.dist(fe);if(nt>2*_t){const Mt=te.add(fe.sub(te)._mult(_t/nt)._round());this.updateDistance(te,Mt),this.addCurrentVertex(Mt,Q,0,0,K,_e),te=Mt}}else tt._mult(ft),this.addCurrentVertex(te,tt,0,0,K,_e);else if(Oe==="flipbevel"){if(ft>100)tt=Q.mult(-1);else{const et=ft*pe.add(Q).mag()/pe.sub(Q).mag();tt._perp()._mult(et*(rt?-1:1))}this.addCurrentVertex(te,tt,0,0,K,_e),this.addCurrentVertex(te,tt.mult(-1),0,0,K,_e)}else if(Oe==="bevel"||Oe==="fakeround"){_e!=null&&ae&&this.addCurrentVertex(te,me||pe,-1,-1,K,_e);const et=te.dist(ae)<=2*_t&&Oe!=="bevel",nt=tt.mult(rt?1:-1);nt._mult(ft);const Mt=Q.mult(rt?-1:1),Pt=pe.mult(rt?-1:1),_n=this.evaluateLineProgressFeatures(this.distance);if(_e==null&&(this.addHalfVertex(te,nt.x,nt.y,!1,!rt,0,K,_n),et||this.addHalfVertex(te,nt.x+2*Pt.x,nt.y+2*Pt.y,!1,rt,0,K,_n)),Oe==="fakeround"){const nn=Math.round(180*xt/Math.PI/20);this.addHalfVertex(te,Pt.x,Pt.y,!1,rt,0,K,_n);for(let $t=0;$t<nn;$t++){let At=$t/nn;if(At!==.5){const tn=At-.5;At+=At*tn*(At-1)*((1.0904+Ve*(Ve*(3.55645-1.43519*Ve)-3.2452))*tn*tn+(.848013+Ve*(.215638*Ve-1.06021)))}const Gn=Mt.sub(Pt)._mult(At)._add(Pt)._unit();this.addHalfVertex(te,Gn.x,Gn.y,!1,rt,0,K,_n)}this.addHalfVertex(te,Mt.x,Mt.y,!1,rt,0,K,_n)}et||_e!=null||this.addHalfVertex(te,nt.x+2*Mt.x,nt.y+2*Mt.y,!1,rt,0,K,_n),_e!=null&&fe&&this.addCurrentVertex(te,he||Q,1,1,K,_e)}else if(Oe==="butt")this.addCurrentVertex(te,tt,0,0,K,_e);else if(Oe==="square"){if(!ae){const et=N?0:-1;this.addCurrentVertex(te,tt,et,et,K,_e)}if(this.addCurrentVertex(te,tt,0,0,K,_e),ae){const et=O?0:1;this.addCurrentVertex(te,tt,et,et,K,_e)}}else if(Oe==="round"){if(ae){const et=!Pe&&me?me:pe;this.addCurrentVertex(te,et,0,0,K,_e),!Pe&&O||this.addCurrentVertex(te,et,1,1,K,_e,!0)}if(fe){const et=!Pe&&he?he:Q;!Pe&&N||this.addCurrentVertex(te,et,-1,-1,K,_e,!0),this.addCurrentVertex(te,et,0,0,K,_e)}}}}addVerticesTo(e,o,u,d,g,y,T,C,I,N){const O=(o.w-e.w)/this.tessellationStep|0;let L=0;const V=this.scaledDistance;if(O>1){this.lineSoFar=e.w;const K=(o.x-e.x)/O,te=(o.y-e.y)/O,ae=(o.z-e.z)/O,fe=(o.w-e.w)/O;for(let pe=1;pe<O;++pe){e.x+=K,e.y+=te,e.z+=ae,this.lineSoFar+=fe,L+=fe;const Q=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(e,u,d,N,!1,T,I,Q),this.addHalfVertex(e,g,y,N,!0,-C,I,Q)}}this.lineSoFar=o.w,this.scaledDistance=V;const H=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(o,u,d,N,!1,T,I,H),this.addHalfVertex(o,g,y,N,!0,-C,I,H)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Hn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let o=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(o=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:o}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:o}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:o}}addCurrentVertex(e,o,u,d,g,y,T=!1){const C=o.x+o.y*u,I=o.y-o.x*u,N=o.y*d-o.x,O=-o.y-o.x*d;if(y!=null){const L=this.elevationType==="offset",V=-10,H=jt+10,K=y.zOffset,te=new yE(e.x,e.y,K,this.lineSoFar),ae=!!L&&tb(e,V,H),fe=this.lineSoFar,pe=this.distance;if(this.currentVertex)if(ae){const Q=this.currentVertexIsOutside,he=this.currentVertex,me=new yE(e.x,e.y,K,this.lineSoFar);if(xE(he,me,V,H),!tb(me,V,H)){if(Q){this.e1=this.e2=-1,this.distance-=he.dist(te),this.lineSoFar=he.w;const _e=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,C,I,T,!1,u,g,_e),this.addHalfVertex(he,N,O,T,!0,-d,g,_e),this.prevDistance=this.distance}this.distance=this.prevDistance+he.dist(me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(he,me,C,I,N,O,u,d,g,T),this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}}else{const Q=this.currentVertex;if(this.currentVertexIsOutside){xE(Q,te,V,H),this.e1=this.e2=-1,this.distance-=Q.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Q.w;const he=this.evaluateLineProgressFeatures(Q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Q,C,I,T,!1,u,g,he),this.addHalfVertex(Q,N,O,T,!0,-d,g,he),this.prevDistance=this.distance,this.distance=pe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Q,te,C,I,N,O,u,d,g,T)}else ae||(this.addHalfVertex(e,C,I,T,!1,u,g,y),this.addHalfVertex(e,N,O,T,!0,-d,g,y));this.currentVertex=te,this.currentVertexIsOutside=ae,this.lineSoFar=fe}else this.addHalfVertex(e,C,I,T,!1,u,g,y),this.addHalfVertex(e,N,O,T,!0,-d,g,y)}addHalfVertex({x:e,y:o},u,d,g,y,T,C,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(o<<1)+(y?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const O=Mn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,O)}const N=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),C.primitiveLength++),y?this.e2=N:this.e1=N,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,o){this.prevDistance=this.distance,this.distance+=e.dist(o),this.updateScaledDistance()}}function tb(a,e,o){return a.x<e||a.x>o||a.y<e||a.y>o}let zE,jE;function FE(a,e,o){return e*(jt/(a.tileSize*Math.pow(2,o-a.tileID.overscaledZ)))}Zt(eb,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const BE=(a,e,o)=>(1-o)*a+o*e;function VE(a,e){return 1/FE(a,1,e.tileZoom)}function UE(a,e,o,u){return a.translatePosMatrix(u||e.tileID.projMatrix,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const $E=a=>{const e=[];HE(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const o=a.paint.get("line-trim-offset");o[0]===0&&o[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",d=!!a.paint.get("line-pattern").constantOr(1);return u&&d&&e.push("LINE_JOIN_NONE"),e};function HE(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let nb;const GE=()=>nb||(nb={layout:zE||(zE=new Di({"line-cap":new zt($e.layout_line["line-cap"]),"line-join":new zt($e.layout_line["line-join"]),"line-miter-limit":new Tt($e.layout_line["line-miter-limit"]),"line-round-limit":new Tt($e.layout_line["line-round-limit"]),"line-sort-key":new zt($e.layout_line["line-sort-key"]),"line-z-offset":new zt($e.layout_line["line-z-offset"]),"line-elevation-reference":new Tt($e.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt($e.layout_line["line-cross-slope"]),visibility:new Tt($e.layout_line.visibility),"line-width-unit":new Tt($e.layout_line["line-width-unit"])})),paint:jE||(jE=new Di({"line-opacity":new zt($e.paint_line["line-opacity"]),"line-color":new zt($e.paint_line["line-color"]),"line-translate":new Tt($e.paint_line["line-translate"]),"line-translate-anchor":new Tt($e.paint_line["line-translate-anchor"]),"line-width":new zt($e.paint_line["line-width"]),"line-gap-width":new zt($e.paint_line["line-gap-width"]),"line-offset":new zt($e.paint_line["line-offset"]),"line-blur":new zt($e.paint_line["line-blur"]),"line-dasharray":new zt($e.paint_line["line-dasharray"]),"line-pattern":new zt($e.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt($e.paint_line["line-pattern-cross-fade"]),"line-gradient":new pc($e.paint_line["line-gradient"]),"line-trim-offset":new Tt($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt($e.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt($e.paint_line["line-trim-color"]),"line-emissive-strength":new Tt($e.paint_line["line-emissive-strength"]),"line-border-width":new zt($e.paint_line["line-border-width"]),"line-border-color":new zt($e.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt($e.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},nb);class ij extends zt{possiblyEvaluate(e,o){return o=new Hr(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition,worldview:o.worldview}),super.possiblyEvaluate(e,o)}evaluate(e,o,u,d){return o=Xe({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(e,o,u,d)}}let p_;function qE(a,e){return e>0?e+2*a:a}const sj=Tr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),oj=Tr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),aj=Tr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Tr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const lj=Tr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),cj=Tr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),uj=Tr([{name:"a_texb",components:2,type:"Uint16"}]),hj=Tr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),dj=Tr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const WE=Tr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fj=Tr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Tr([{name:"triangle",components:3,type:"Uint16"}]),Tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Tr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Tr([{type:"Float32",name:"offsetX"}]),Tr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var co=24;function pj(a,e,o){return a.sections.forEach(u=>{u.text=function(d,g,y){const T=g.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?d=d.toLocaleUpperCase():T==="lowercase"&&(d=d.toLocaleLowerCase()),pl.applyArabicShaping&&(d=pl.applyArabicShaping(d)),d}(u.text,e,o)}),a}const m_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function mj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function gj(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}var ZE,rb,XE,ib={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function yj(){return ZE||(ZE=1,ib.read=function(a,e,o,u,d){var g,y,T=8*d-u-1,C=(1<<T)-1,I=C>>1,N=-7,O=o?d-1:0,L=o?-1:1,V=a[e+O];for(O+=L,g=V&(1<<-N)-1,V>>=-N,N+=T;N>0;g=256*g+a[e+O],O+=L,N-=8);for(y=g&(1<<-N)-1,g>>=-N,N+=u;N>0;y=256*y+a[e+O],O+=L,N-=8);if(g===0)g=1-I;else{if(g===C)return y?NaN:1/0*(V?-1:1);y+=Math.pow(2,u),g-=I}return(V?-1:1)*y*Math.pow(2,g-u)},ib.write=function(a,e,o,u,d,g){var y,T,C,I=8*g-d-1,N=(1<<I)-1,O=N>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=u?0:g-1,H=u?1:-1,K=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,y=N):(y=Math.floor(Math.log(e)/Math.LN2),e*(C=Math.pow(2,-y))<1&&(y--,C*=2),(e+=y+O>=1?L/C:L*Math.pow(2,1-O))*C>=2&&(y++,C/=2),y+O>=N?(T=0,y=N):y+O>=1?(T=(e*C-1)*Math.pow(2,d),y+=O):(T=e*Math.pow(2,O-1)*Math.pow(2,d),y=0));d>=8;a[o+V]=255&T,V+=H,T/=256,d-=8);for(y=y<<d|T,I+=d;I>0;a[o+V]=255&y,V+=H,y/=256,I-=8);a[o+V-H]|=128*K}),ib}function KE(){if(XE)return rb;XE=1,rb=e;var a=yj();function e(Q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Q)?Q:new Uint8Array(Q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var o=4294967296,u=1/o,d=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function g(Q){return Q.type===e.Bytes?Q.readVarint()+Q.pos:Q.pos+1}function y(Q,he,me){return me?4294967296*he+(Q>>>0):4294967296*(he>>>0)+(Q>>>0)}function T(Q,he,me){var _e=he<=16383?1:he<=2097151?2:he<=268435455?3:Math.floor(Math.log(he)/(7*Math.LN2));me.realloc(_e);for(var De=me.pos-1;De>=Q;De--)me.buf[De+_e]=me.buf[De]}function C(Q,he){for(var me=0;me<Q.length;me++)he.writeVarint(Q[me])}function I(Q,he){for(var me=0;me<Q.length;me++)he.writeSVarint(Q[me])}function N(Q,he){for(var me=0;me<Q.length;me++)he.writeFloat(Q[me])}function O(Q,he){for(var me=0;me<Q.length;me++)he.writeDouble(Q[me])}function L(Q,he){for(var me=0;me<Q.length;me++)he.writeBoolean(Q[me])}function V(Q,he){for(var me=0;me<Q.length;me++)he.writeFixed32(Q[me])}function H(Q,he){for(var me=0;me<Q.length;me++)he.writeSFixed32(Q[me])}function K(Q,he){for(var me=0;me<Q.length;me++)he.writeFixed64(Q[me])}function te(Q,he){for(var me=0;me<Q.length;me++)he.writeSFixed64(Q[me])}function ae(Q,he){return(Q[he]|Q[he+1]<<8|Q[he+2]<<16)+16777216*Q[he+3]}function fe(Q,he,me){Q[me]=he,Q[me+1]=he>>>8,Q[me+2]=he>>>16,Q[me+3]=he>>>24}function pe(Q,he){return(Q[he]|Q[he+1]<<8|Q[he+2]<<16)+(Q[he+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(Q,he,me){for(me=me||this.length;this.pos<me;){var _e=this.readVarint(),De=_e>>3,Pe=this.pos;this.type=7&_e,Q(De,he,this),this.pos===Pe&&this.skip(_e)}return he},readMessage:function(Q,he){return this.readFields(Q,he,this.readVarint()+this.pos)},readFixed32:function(){var Q=ae(this.buf,this.pos);return this.pos+=4,Q},readSFixed32:function(){var Q=pe(this.buf,this.pos);return this.pos+=4,Q},readFixed64:function(){var Q=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*o;return this.pos+=8,Q},readSFixed64:function(){var Q=ae(this.buf,this.pos)+pe(this.buf,this.pos+4)*o;return this.pos+=8,Q},readFloat:function(){var Q=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Q},readDouble:function(){var Q=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Q},readVarint:function(Q){var he,me,_e=this.buf;return he=127&(me=_e[this.pos++]),me<128?he:(he|=(127&(me=_e[this.pos++]))<<7,me<128?he:(he|=(127&(me=_e[this.pos++]))<<14,me<128?he:(he|=(127&(me=_e[this.pos++]))<<21,me<128?he:function(De,Pe,Oe){var Ve,tt,vt=Oe.buf;if(Ve=(112&(tt=vt[Oe.pos++]))>>4,tt<128||(Ve|=(127&(tt=vt[Oe.pos++]))<<3,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<10,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<17,tt<128)||(Ve|=(127&(tt=vt[Oe.pos++]))<<24,tt<128)||(Ve|=(1&(tt=vt[Oe.pos++]))<<31,tt<128))return y(De,Ve,Pe);throw new Error("Expected varint not more than 10 bytes")}(he|=(15&(me=_e[this.pos]))<<28,Q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Q=this.readVarint();return Q%2==1?(Q+1)/-2:Q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Q=this.readVarint()+this.pos,he=this.pos;return this.pos=Q,Q-he>=12&&d?function(me,_e,De){return d.decode(me.subarray(_e,De))}(this.buf,he,Q):function(me,_e,De){for(var Pe="",Oe=_e;Oe<De;){var Ve,tt,vt,ft=me[Oe],xt=null,St=ft>239?4:ft>223?3:ft>191?2:1;if(Oe+St>De)break;St===1?ft<128&&(xt=ft):St===2?(192&(Ve=me[Oe+1]))==128&&(xt=(31&ft)<<6|63&Ve)<=127&&(xt=null):St===3?(tt=me[Oe+2],(192&(Ve=me[Oe+1]))==128&&(192&tt)==128&&((xt=(15&ft)<<12|(63&Ve)<<6|63&tt)<=2047||xt>=55296&&xt<=57343)&&(xt=null)):St===4&&(tt=me[Oe+2],vt=me[Oe+3],(192&(Ve=me[Oe+1]))==128&&(192&tt)==128&&(192&vt)==128&&((xt=(15&ft)<<18|(63&Ve)<<12|(63&tt)<<6|63&vt)<=65535||xt>=1114112)&&(xt=null)),xt===null?(xt=65533,St=1):xt>65535&&(xt-=65536,Pe+=String.fromCharCode(xt>>>10&1023|55296),xt=56320|1023&xt),Pe+=String.fromCharCode(xt),Oe+=St}return Pe}(this.buf,he,Q)},readBytes:function(){var Q=this.readVarint()+this.pos,he=this.buf.subarray(this.pos,Q);return this.pos=Q,he},readPackedVarint:function(Q,he){if(this.type!==e.Bytes)return Q.push(this.readVarint(he));var me=g(this);for(Q=Q||[];this.pos<me;)Q.push(this.readVarint(he));return Q},readPackedSVarint:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSVarint());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSVarint());return Q},readPackedBoolean:function(Q){if(this.type!==e.Bytes)return Q.push(this.readBoolean());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readBoolean());return Q},readPackedFloat:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFloat());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFloat());return Q},readPackedDouble:function(Q){if(this.type!==e.Bytes)return Q.push(this.readDouble());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readDouble());return Q},readPackedFixed32:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFixed32());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFixed32());return Q},readPackedSFixed32:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSFixed32());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSFixed32());return Q},readPackedFixed64:function(Q){if(this.type!==e.Bytes)return Q.push(this.readFixed64());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readFixed64());return Q},readPackedSFixed64:function(Q){if(this.type!==e.Bytes)return Q.push(this.readSFixed64());var he=g(this);for(Q=Q||[];this.pos<he;)Q.push(this.readSFixed64());return Q},skip:function(Q){var he=7&Q;if(he===e.Varint)for(;this.buf[this.pos++]>127;);else if(he===e.Bytes)this.pos=this.readVarint()+this.pos;else if(he===e.Fixed32)this.pos+=4;else{if(he!==e.Fixed64)throw new Error("Unimplemented type: "+he);this.pos+=8}},writeTag:function(Q,he){this.writeVarint(Q<<3|he)},realloc:function(Q){for(var he=this.length||16;he<this.pos+Q;)he*=2;if(he!==this.length){var me=new Uint8Array(he);me.set(this.buf),this.buf=me,this.length=he}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Q){this.realloc(4),fe(this.buf,Q,this.pos),this.pos+=4},writeSFixed32:function(Q){this.realloc(4),fe(this.buf,Q,this.pos),this.pos+=4},writeFixed64:function(Q){this.realloc(8),fe(this.buf,-1&Q,this.pos),fe(this.buf,Math.floor(Q*u),this.pos+4),this.pos+=8},writeSFixed64:function(Q){this.realloc(8),fe(this.buf,-1&Q,this.pos),fe(this.buf,Math.floor(Q*u),this.pos+4),this.pos+=8},writeVarint:function(Q){(Q=+Q||0)>268435455||Q<0?function(he,me){var _e,De;if(he>=0?(_e=he%4294967296|0,De=he/4294967296|0):(De=~(-he/4294967296),4294967295^(_e=~(-he%4294967296))?_e=_e+1|0:(_e=0,De=De+1|0)),he>=18446744073709552e3||he<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),function(Pe,Oe,Ve){Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Ve.buf[Ve.pos]=127&(Pe>>>=7)}(_e,0,me),function(Pe,Oe){var Ve=(7&Pe)<<4;Oe.buf[Oe.pos++]|=Ve|((Pe>>>=3)?128:0),Pe&&(Oe.buf[Oe.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Oe.buf[Oe.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Oe.buf[Oe.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Oe.buf[Oe.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Oe.buf[Oe.pos++]=127&Pe)))))}(De,me)}(Q,this):(this.realloc(4),this.buf[this.pos++]=127&Q|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=127&(Q>>>=7)|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=127&(Q>>>=7)|(Q>127?128:0),Q<=127||(this.buf[this.pos++]=Q>>>7&127))))},writeSVarint:function(Q){this.writeVarint(Q<0?2*-Q-1:2*Q)},writeBoolean:function(Q){this.writeVarint(!!Q)},writeString:function(Q){Q=String(Q),this.realloc(4*Q.length),this.pos++;var he=this.pos;this.pos=function(_e,De,Pe){for(var Oe,Ve,tt=0;tt<De.length;tt++){if((Oe=De.charCodeAt(tt))>55295&&Oe<57344){if(!Ve){Oe>56319||tt+1===De.length?(_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189):Ve=Oe;continue}if(Oe<56320){_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189,Ve=Oe;continue}Oe=Ve-55296<<10|Oe-56320|65536,Ve=null}else Ve&&(_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189,Ve=null);Oe<128?_e[Pe++]=Oe:(Oe<2048?_e[Pe++]=Oe>>6|192:(Oe<65536?_e[Pe++]=Oe>>12|224:(_e[Pe++]=Oe>>18|240,_e[Pe++]=Oe>>12&63|128),_e[Pe++]=Oe>>6&63|128),_e[Pe++]=63&Oe|128)}return Pe}(this.buf,Q,this.pos);var me=this.pos-he;me>=128&&T(he,me,this),this.pos=he-1,this.writeVarint(me),this.pos+=me},writeFloat:function(Q){this.realloc(4),a.write(this.buf,Q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Q){this.realloc(8),a.write(this.buf,Q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Q){var he=Q.length;this.writeVarint(he),this.realloc(he);for(var me=0;me<he;me++)this.buf[this.pos++]=Q[me]},writeRawMessage:function(Q,he){this.pos++;var me=this.pos;Q(he,this);var _e=this.pos-me;_e>=128&&T(me,_e,this),this.pos=me-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(Q,he,me){this.writeTag(Q,e.Bytes),this.writeRawMessage(he,me)},writePackedVarint:function(Q,he){he.length&&this.writeMessage(Q,C,he)},writePackedSVarint:function(Q,he){he.length&&this.writeMessage(Q,I,he)},writePackedBoolean:function(Q,he){he.length&&this.writeMessage(Q,L,he)},writePackedFloat:function(Q,he){he.length&&this.writeMessage(Q,N,he)},writePackedDouble:function(Q,he){he.length&&this.writeMessage(Q,O,he)},writePackedFixed32:function(Q,he){he.length&&this.writeMessage(Q,V,he)},writePackedSFixed32:function(Q,he){he.length&&this.writeMessage(Q,H,he)},writePackedFixed64:function(Q,he){he.length&&this.writeMessage(Q,K,he)},writePackedSFixed64:function(Q,he){he.length&&this.writeMessage(Q,te,he)},writeBytesField:function(Q,he){this.writeTag(Q,e.Bytes),this.writeBytes(he)},writeFixed32Field:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeFixed32(he)},writeSFixed32Field:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeSFixed32(he)},writeFixed64Field:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeFixed64(he)},writeSFixed64Field:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeSFixed64(he)},writeVarintField:function(Q,he){this.writeTag(Q,e.Varint),this.writeVarint(he)},writeSVarintField:function(Q,he){this.writeTag(Q,e.Varint),this.writeSVarint(he)},writeStringField:function(Q,he){this.writeTag(Q,e.Bytes),this.writeString(he)},writeFloatField:function(Q,he){this.writeTag(Q,e.Fixed32),this.writeFloat(he)},writeDoubleField:function(Q,he){this.writeTag(Q,e.Fixed64),this.writeDouble(he)},writeBooleanField:function(Q,he){this.writeVarintField(Q,!!he)}},rb}var Vx=ui(KE());const sb=3;function _j(a,e,o){e.glyphs=[],a===1&&o.readMessage(xj,e)}function xj(a,e,o){if(a===3){const{id:u,bitmap:d,width:g,height:y,left:T,top:C,advance:I}=o.readMessage(vj,{});e.glyphs.push({id:u,bitmap:new Tp({width:g+2*sb,height:y+2*sb},d),metrics:{width:g,height:y,left:T,top:C,advance:I}})}else a===4?e.ascender=o.readSVarint():a===5&&(e.descender=o.readSVarint())}function vj(a,e,o){a===1?e.id=o.readVarint():a===2?e.bitmap=o.readBytes():a===3?e.width=o.readVarint():a===4?e.height=o.readVarint():a===5?e.left=o.readSVarint():a===6?e.top=o.readSVarint():a===7&&(e.advance=o.readVarint())}const bj=sb,vl={horizontal:1,vertical:2,horizontalOnly:3};class g_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,o){const u=new g_;return u.scale=e||1,u.fontStack=o,u}static forImage(e){const o=new g_;return o.image=e,o}}class Yg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o,u){const d=new Yg;for(let g=0;g<e.sections.length;g++){const y=e.sections[g];y.image?d.addImageSection(y,u):d.addTextSection(y,o)}return d}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(o,u){let d="";for(let g=0;g<o.length;g++){const y=o.charCodeAt(g+1)||null,T=o.charCodeAt(g-1)||null;d+=!u&&(y&&Zd(y)&&!m_[o[g+1]]||T&&Zd(T)&&!m_[o[g-1]])||!m_[o[g]]?o[g]:m_[o[g]]}return d}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&Ux[this.text.charCodeAt(u)];u++)e++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&Ux[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const u=new Yg;return u.text=this.text.substring(e,o),u.sectionIndex=this.sectionIndex.slice(e,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(g_.forText(e.scale,e.fontStack||o));const u=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(u)}addImageSection(e,o){const u=e.image?e.image.getPrimary():null;if(!u)return void Hn("Can't add FormattedSection with an empty image.");u.scaleSelf(o);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(g_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Hn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ob(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K=1){const te=Yg.fromFeature(a,d,K);O===vl.vertical&&te.verticalizePunctuation(L);let ae=[];const fe=function(_e,De,Pe,Oe,Ve,tt){if(!_e)return[];const vt=[],ft=function(_t,et,nt,Mt,Pt,_n){let nn=0;for(let $t=0;$t<_t.length();$t++){const At=_t.getSection($t);nn+=YE(_t.getCodePoint($t),At,Mt,Pt,et,_n)}return nn/Math.max(1,Math.ceil(nn/nt))}(_e,De,Pe,Oe,Ve,tt),xt=_e.text.indexOf("")>=0;let St=0;for(let _t=0;_t<_e.length();_t++){const et=_e.getSection(_t),nt=_e.getCodePoint(_t);if(Ux[nt]||(St+=YE(nt,et,Oe,Ve,De,tt)),_t<_e.length()-1){const Mt=!((rt=nt)<11904||!(vn["Bopomofo Extended"](rt)||vn.Bopomofo(rt)||vn["CJK Compatibility Forms"](rt)||vn["CJK Compatibility Ideographs"](rt)||vn["CJK Compatibility"](rt)||vn["CJK Radicals Supplement"](rt)||vn["CJK Strokes"](rt)||vn["CJK Symbols and Punctuation"](rt)||vn["CJK Unified Ideographs Extension A"](rt)||vn["CJK Unified Ideographs"](rt)||vn["Enclosed CJK Letters and Months"](rt)||vn["Halfwidth and Fullwidth Forms"](rt)||vn.Hiragana(rt)||vn["Ideographic Description Characters"](rt)||vn["Kangxi Radicals"](rt)||vn["Katakana Phonetic Extensions"](rt)||vn.Katakana(rt)||vn["Vertical Forms"](rt)||vn["Yi Radicals"](rt)||vn["Yi Syllables"](rt)));(wj[nt]||Mt||et.image)&&vt.push(QE(_t+1,St,ft,vt,Sj(nt,_e.getCodePoint(_t+1),Mt&&xt),!1))}}var rt;return eC(QE(_e.length(),St,ft,vt,0,!0))}(te,I,g,e,u,V),{processBidirectionalText:pe,processStyledBidirectionalText:Q}=pl;if(pe&&te.sections.length===1){const _e=pe(te.toString(),fe);for(const De of _e){const Pe=new Yg;Pe.text=De,Pe.sections=te.sections;for(let Oe=0;Oe<De.length;Oe++)Pe.sectionIndex.push(0);ae.push(Pe)}}else if(Q){const _e=Q(te.text,te.sectionIndex,fe);for(const De of _e){const Pe=new Yg;Pe.text=De[0],Pe.sectionIndex=De[1],Pe.sections=te.sections,ae.push(Pe)}}else ae=function(_e,De){const Pe=[],Oe=_e.text;let Ve=0;for(const tt of De)Pe.push(_e.substring(Ve,tt)),Ve=tt;return Ve<Oe.length&&Pe.push(_e.substring(Ve,Oe.length)),Pe}(te,fe);const he=[],me={positionedLines:he,text:te.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(_e,De,Pe,Oe,Ve,tt,vt,ft,xt,St,rt,_t){let et=0,nt=0,Mt=0;const Pt=ft==="right"?1:ft==="left"?0:.5;let _n=!1;for(const sn of Ve){const jn=sn.getSections();for(const nr of jn){if(nr.image)continue;const Kn=De[nr.fontStack];if(Kn&&(_n=Kn.ascender!==void 0&&Kn.descender!==void 0,!_n))break}if(!_n)break}let nn=0;for(const sn of Ve){sn.trim();const jn=sn.getMaxScale(),nr=(jn-1)*co,Kn={positionedGlyphs:[],lineOffset:0};_e.positionedLines[nn]=Kn;const ur=Kn.positionedGlyphs;let ir=0;if(!sn.length()){nt+=tt,++nn;continue}let hr=0,qr=0;for(let ye=0;ye<sn.length();ye++){const Se=sn.getSection(ye),ot=sn.getSectionIndex(ye),Lt=sn.getCodePoint(ye);let Gt=Se.scale,Ut=null,en=null,zn=null,gr=co,yr=0;xt===vl.vertical&&(($t=Lt)===12312||$t===12313||$t===12316||$t===12540||$t===12448)&&(xt=vl.horizontal);const sr=!(xt===vl.horizontal||!rt&&!np(Lt)||rt&&(Ux[Lt]||Og(Lt)));if(Se.image){const Kr=Oe.get(Se.image.toString());if(!Kr)continue;zn=Se.image,_e.iconsInText=_e.iconsInText||!0,en=Kr.paddedRect;const yi=Kr.displaySize;Gt=Gt*co/_t,Ut={width:yi[0],height:yi[1],left:0,top:-3,advance:sr?yi[1]:yi[0],localGlyph:!1},yr=_n?-Ut.height*Gt:jn*co-17-yi[1]*Gt,gr=Ut.advance;const _r=(sr?yi[0]:yi[1])*Gt-co*jn;_r>0&&_r>ir&&(ir=_r)}else{const Kr=Pe[Se.fontStack];if(!Kr)continue;Kr[Lt]&&(en=Kr[Lt]);const yi=De[Se.fontStack];if(!yi)continue;const _r=yi.glyphs[Lt];if(!_r)continue;if(Ut=_r.metrics,gr=Lt!==8203?co:0,_n){const qi=yi.ascender!==void 0?Math.abs(yi.ascender):0,Ti=yi.descender!==void 0?Math.abs(yi.descender):0,Wr=(qi+Ti)*Gt;hr<Wr&&(hr=Wr,qr=(qi-Ti)/2*Gt),yr=-qi*Gt}else yr=(jn-Gt)*co-17}sr?(_e.verticalizable=!0,ur.push({glyph:Lt,image:zn,x:et,y:nt+yr,vertical:sr,scale:Gt,localGlyph:Ut.localGlyph,fontStack:Se.fontStack,sectionIndex:ot,metrics:Ut,rect:en}),et+=gr*Gt+St):(ur.push({glyph:Lt,image:zn,x:et,y:nt+yr,vertical:sr,scale:Gt,localGlyph:Ut.localGlyph,fontStack:Se.fontStack,sectionIndex:ot,metrics:Ut,rect:en}),et+=Ut.advance*Gt+St)}ur.length!==0&&(Mt=Math.max(et-St,Mt),_n?tC(ur,Pt,ir,qr,tt*jn/2):tC(ur,Pt,ir,0,tt/2)),et=0;const Si=tt*jn+ir;Kn.lineOffset=Math.max(ir,nr),nt+=Si,++nn}var $t;const At=nt,{horizontalAlign:Gn,verticalAlign:tn}=ab(vt);(function(sn,jn,nr,Kn,ur,ir){const hr=(jn-nr)*ur,qr=-ir*Kn;for(const Si of sn)for(const ye of Si.positionedGlyphs)ye.x+=hr,ye.y+=qr})(_e.positionedLines,Pt,Gn,tn,Mt,At),_e.top+=-tn*At,_e.bottom=_e.top+At,_e.left+=-Gn*Mt,_e.right=_e.left+Mt,_e.hasBaseline=_n}(me,e,o,u,ae,y,T,C,O,I,L,H),!function(_e){for(const De of _e)if(De.positionedGlyphs.length!==0)return!1;return!0}(he))return me}const Ux={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wj={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function YE(a,e,o,u,d,g){if(e.image){const y=u.get(e.image.toString());return y?y.displaySize[0]*e.scale*co/g+d:0}{const y=o[e.fontStack],T=y&&y.glyphs[a];return T?T.metrics.advance*e.scale+d:0}}function JE(a,e,o,u){const d=Math.pow(a-e,2);return u?a<e?d/2:2*d:d+Math.abs(o)*o}function Sj(a,e,o){let u=0;return a===10&&(u-=1e4),o&&(u+=150),a!==40&&a!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function QE(a,e,o,u,d,g){let y=null,T=JE(e,o,d,g);for(const C of u){const I=JE(e-C.x,o,d,g)+C.badness;I<=T&&(y=C,T=I)}return{index:a,x:e,priorBreak:y,badness:T}}function eC(a){return a?eC(a.priorBreak).concat(a.index):[]}function ab(a){let e=.5,o=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function tC(a,e,o,u,d){if(!(e||o||u||d))return;const g=a.length-1,y=a[g],T=(y.x+y.metrics.advance*y.scale)*e;for(let C=0;C<=g;C++)a[C].x-=T,a[C].y+=o+u+d}function nC(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Tj(a,e,o,u){const{horizontalAlign:d,verticalAlign:g}=ab(u),y=o[0]-a.displaySize[0]*d,T=o[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:e,top:T,bottom:T+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function rC(a,e,o,u,d,g){const y=a.imagePrimary;let T;if(y.content){const te=y.content,ae=y.pixelRatio||1;T=[te[0]/ae,te[1]/ae,y.displaySize[0]-te[2]/ae,y.displaySize[1]-te[3]/ae]}const C=e.left*g,I=e.right*g;let N,O,L,V;o==="width"||o==="both"?(V=d[0]+C-u[3],O=d[0]+I+u[1]):(V=d[0]+(C+I-y.displaySize[0])/2,O=V+y.displaySize[0]);const H=e.top*g,K=e.bottom*g;return o==="height"||o==="both"?(N=d[1]+H-u[0],L=d[1]+K+u[2]):(N=d[1]+(H+K-y.displaySize[1])/2,L=N+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:N,right:O,bottom:L,left:V,collisionPadding:T}}function iC(a){return!a.imagePrimary.stretchX}function sC(a){return!a.imagePrimary.stretchY}function oC(a){return{width:a.right-a.left,height:a.bottom-a.top}}const ad=128;function aC(a,e,o){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Hr(a+1,{worldview:o}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=u;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let T=y;for(;T<d.length&&d[T]<a+1;)T++;T=Math.min(d.length-1,T);const C=d[y],I=d[T];return u.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:C,maxZoom:I,minSize:u.evaluate(new Hr(C,{worldview:o})),maxSize:u.evaluate(new Hr(I,{worldview:o})),interpolationType:g}}}function lb(a,{uSize:e,uSizeT:o},{lowerSize:u,upperSize:d}){return a.kind==="source"?u/ad:a.kind==="composite"?Mn(u/ad,d/ad,o):e}function y_(a,e,o=1){let u=0,d=0;if(a.kind==="constant")d=a.layoutSize*o;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:T}=a,C=g?Ee(Zs.interpolationFactor(g,e,y,T),0,1):0;a.kind==="camera"?d=Mn(a.minSize,a.maxSize,C)*o:u=C*o}return{uSizeT:u,uSize:d}}class ff extends Ot{constructor(e,o,u,d,g){super(e,o),this.angle=d,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new ff(this.x,this.y,this.z,this.angle,this.segment)}}function lC(a,e,o,u,d){if(e.segment===void 0)return!0;let g=e,y=e.segment+1,T=0;for(;T>-o/2;){if(y--,y<0)return!1;T-=a[y].dist(g),g=a[y]}T+=a[y].dist(a[y+1]),y++;const C=[];let I=0;for(;T<o/2;){const N=a[y],O=a[y+1];if(!O)return!1;let L=a[y-1].angleTo(N)-N.angleTo(O);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:L}),I+=L;T-C[0].distance>u;)I-=C.shift().angleDelta;if(I>d)return!1;y++,T+=N.dist(O)}return!0}function cC(a){let e=0;for(let o=0;o<a.length-1;o++)e+=a[o].dist(a[o+1]);return e}function uC(a,e,o){return a?.6*e*o:0}function hC(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function Ej(a,e,o,u,d,g){const y=uC(o,d,g),T=hC(o,u)*g;let C=0;const I=cC(a)/2;for(let N=0;N<a.length-1;N++){const O=a[N],L=a[N+1],V=O.dist(L);if(C+V>I){const H=(I-C)/V,K=Mn(O.x,L.x,H),te=Mn(O.y,L.y,H),ae=new ff(K,te,0,L.angleTo(O),N);return!y||lC(a,ae,T,y,e)?ae:void 0}C+=V}}function Cj(a,e,o,u,d,g,y,T,C){const I=uC(u,g,y),N=hC(u,d),O=N*y,L=a[0].x===0||a[0].x===C||a[0].y===0||a[0].y===C;return e-O<e/4&&(e=O+e/4),dC(a,L?e/2*T%e:(N/2+2*g)*y*T%e,e,I,o,O,L,!1,C)}function dC(a,e,o,u,d,g,y,T,C){const I=g/2,N=cC(a);let O=0,L=e-o,V=[];for(let H=0;H<a.length-1;H++){const K=a[H],te=a[H+1],ae=K.dist(te),fe=te.angleTo(K);for(;L+o<O+ae;){L+=o;const pe=(L-O)/ae,Q=Mn(K.x,te.x,pe),he=Mn(K.y,te.y,pe);if(Q>=0&&Q<C&&he>=0&&he<C&&L-I>=0&&L+I<=N){const me=new ff(Q,he,0,fe,H);u&&!lC(a,me,g,u,d)||V.push(me)}}O+=ae}return T||V.length||y||(V=dC(a,O/2,o,u,d,g,y,!0,C)),V}function fC(a){let e=0,o=0;for(const y of a)e+=y.w*y.h,o=Math.max(o,y.w);a.sort((y,T)=>T.h-y.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let d=0,g=0;for(const y of a)for(let T=u.length-1;T>=0;T--){const C=u[T];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,g=Math.max(g,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===C.w&&y.h===C.h){const I=u.pop();T<u.length&&(u[T]=I)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(u.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:d,h:g,fill:e/(d*g)||0}}Zt(ff,"Anchor");const Km=1;class __{static getImagePositionScale(e,o,u){if(o&&e&&e.options&&e.options.transform){const d=e.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(e,o,u,d){this.paddedRect=e;const{pixelRatio:g,version:y,stretchX:T,stretchY:C,content:I,sdf:N,usvg:O}=o;this.pixelRatio=g,this.stretchX=T,this.stretchY=C,this.content=I,this.version=y,this.padding=u,this.sdf=N,this.usvg=O,this.scale=__.getImagePositionScale(d,O,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function cb(a,e,o){const u=ic.parse(a),d=function(g,y,T=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*T[0])+2*y,h:(g.data?g.data.height:g.height*T[1])+2*y}}(e,o,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new __(d,e,o,u),imageVariant:u}}class pC{constructor(e,o,u){const d=new Map,g=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(e,d,Km,y),this.addImages(o,g,2,y);const{w:T,h:C}=fC(y),I=new Do({width:T||1,height:C||1});for(const[N,O]of e.entries()){const L=d.get(N).paddedRect;Do.copy(O.data,I,{x:0,y:0},{x:L.x+Km,y:L.y+Km},O.data,u,O.sdf)}for(const[N,O]of o.entries()){const L=g.get(N),V=L.paddedRect;let H=L.padding;const K=V.x+H,te=V.y+H,ae=O.data.width,fe=O.data.height;H=H>1?H-1:H,Do.copy(O.data,I,{x:0,y:0},{x:K,y:te},O.data,u),Do.copy(O.data,I,{x:0,y:fe-H},{x:K,y:te-H},{width:ae,height:H},u),Do.copy(O.data,I,{x:0,y:0},{x:K,y:te+fe},{width:ae,height:H},u),Do.copy(O.data,I,{x:ae-H,y:0},{x:K-H,y:te},{width:H,height:fe},u),Do.copy(O.data,I,{x:0,y:0},{x:K+ae,y:te},{width:H,height:fe},u),Do.copy(O.data,I,{x:ae-H,y:fe-H},{x:K-H,y:te-H},{width:H,height:H},u),Do.copy(O.data,I,{x:0,y:fe-H},{x:K+ae,y:te-H},{width:H,height:H},u),Do.copy(O.data,I,{x:0,y:0},{x:K+ae,y:te+fe},{width:H,height:H},u),Do.copy(O.data,I,{x:ae-H,y:0},{x:K-H,y:te+fe},{width:H,height:H},u)}this.lut=u,this.image=I,this.iconPositions=d,this.patternPositions=g}addImages(e,o,u,d){for(const[g,y]of e.entries()){const{bin:T,imagePosition:C,imageVariant:I}=cb(g,y,u);o.set(g,C),d.push(T),y.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(e,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>e.hasImage(d,u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of e.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const y=ic.parse(g);if(_o.isEqual(y.id,d)){const T=e.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(g),T,o)}}for(const g of this.patternPositions.keys()){const y=ic.parse(g);if(_o.isEqual(y.id,d)){const T=e.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(g),T,o)}}}}patchUpdatedImage(e,o,u){if(!e||!o||e.version===o.version)return;e.version=o.version;const[d,g]=e.tl,y=e.sdf;if(this.lut||y){const T={width:o.data.width,height:o.data.height},C=new Do(T);Do.copy(o.data,C,{x:0,y:0},{x:0,y:0},T,this.lut,y),u.update(C,{position:{x:d,y:g}})}else u.update(o.data,{position:{x:d,y:g}})}}Zt(__,"ImagePosition"),Zt(pC,"ImageAtlas");const $x=1e20;function mC(a,e,o,u,d,g,y,T,C){for(let I=e;I<e+u;I++)gC(a,o*g+I,g,d,y,T,C);for(let I=o;I<o+d;I++)gC(a,I*g+e,1,u,y,T,C)}function gC(a,e,o,u,d,g,y){g[0]=0,y[0]=-1e20,y[1]=$x,d[0]=a[e];for(let T=1,C=0,I=0;T<u;T++){d[T]=a[e+T*o];const N=T*T;do{const O=g[C];I=(d[T]-d[O]+N-O*O)/(T-O)/2}while(I<=y[C]&&--C>-1);C++,g[C]=T,y[C]=I,y[C+1]=$x}for(let T=0,C=0;T<u;T++){for(;y[C+1]<T;)C++;const I=g[C],N=T-I;a[e+T*o]=d[I]+N*N}}const ih=2,ub={none:0,ideographs:1,all:2};class Jg{constructor(e,o,u){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,o){this.urls[o]=e}getGlyphs(e,o,u){const d=[],g=this.urls[o]||Gs.GLYPHS_URL;for(const y in e)for(const T of e[y])d.push({stack:y,id:T});je(d,({stack:y,id:T},C)=>{let I=this.entries[y];I||(I=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let N=I.glyphs[T];if(N!==void 0)return void C(null,{stack:y,id:T,glyph:N});if(N=this._tinySDF(I,y,T),N)return I.glyphs[T]=N,void C(null,{stack:y,id:T,glyph:N});const O=Math.floor(T/256);if(256*O>65535)return Hn("glyphs > 65535 not supported"),void C(null,{stack:y,id:T,glyph:N});if(I.ranges[O])return void C(null,{stack:y,id:T,glyph:N});let L=I.requests[O];L||(L=I.requests[O]=[],Jg.loadGlyphRange(y,O,g,this.requestManager,(V,H)=>{if(H){I.ascender=H.ascender,I.descender=H.descender;for(const K in H.glyphs)this._doesCharSupportLocalGlyph(+K)||(I.glyphs[+K]=H.glyphs[+K]);I.ranges[O]=!0}for(const K of L)K(V,H);delete I.requests[O]})),L.push((V,H)=>{V?C(V):H&&C(null,{stack:y,id:T,glyph:H.glyphs[T]||null})})},(y,T)=>{if(y)u(y);else if(T){const C={};for(const{stack:I,id:N,glyph:O}of T)C[I]===void 0&&(C[I]={}),C[I].glyphs===void 0&&(C[I].glyphs={}),C[I].glyphs[N]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},C[I].ascender=this.entries[I].ascender,C[I].descender=this.entries[I].descender;u(null,C)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ub.none&&(this.localGlyphMode===ub.all?!!this.localFontFamily:!!this.localFontFamily&&(vn["CJK Unified Ideographs"](e)||vn["Hangul Syllables"](e)||vn.Hiragana(e)||vn.Katakana(e)||vn["CJK Symbols and Punctuation"](e)||vn["CJK Unified Ideographs Extension A"](e)||vn["CJK Unified Ideographs Extension B"](e)||vn.Osage(e)))}_tinySDF(e,o,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let g=e.tinySDF;if(!g){let K="400";/bold/i.test(o)?K="900":/medium/i.test(o)?K="500":/light/i.test(o)&&(K="200"),g=e.tinySDF=new Jg.TinySDF({fontFamily:d,fontWeight:K,fontSize:24*ih,buffer:3*ih,radius:8*ih}),g.fontWeight=K}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const y=String.fromCodePoint(u),{data:T,width:C,height:I,glyphWidth:N,glyphHeight:O,glyphLeft:L,glyphTop:V,glyphAdvance:H}=g.draw(y);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Tp({width:C,height:I},T),metrics:{width:N/ih,height:O/ih,left:L/ih,top:V/ih-27,advance:H/ih,localGlyph:!0}}}}Jg.loadGlyphRange=function(a,e,o,u,d){const g=256*e,y=g+255,T=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",a).replace("{range}",`${g}-${y}`),Xa.Glyphs);Td(T,(C,I)=>{if(C)d(C);else if(I){const N={},O=function(L){return new Vx(L).readFields(_j,{})}(I);for(const L of O.glyphs)N[L.id]=L;d(null,{glyphs:N,ascender:O.ascender,descender:O.descender})}})},Jg.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=o;const T=this.size=a+4*e,C=this._createCanvas(T),I=this.ctx=C.getContext("2d",{willReadFrequently:!0});I.font=`${y} ${g} ${a}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:g}=this.ctx.measureText(a),y=Math.ceil(o),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-d))),C=Math.min(this.size-this.buffer,y+Math.ceil(u)),I=T+2*this.buffer,N=C+2*this.buffer,O=Math.max(I*N,0),L=new Uint8ClampedArray(O),V={data:L,width:I,height:N,glyphWidth:T,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(T===0||C===0)return V;const{ctx:H,buffer:K,gridInner:te,gridOuter:ae}=this;H.clearRect(K,K,T,C),H.fillText(a,K,K+y);const fe=H.getImageData(K,K,T,C);ae.fill($x,0,O),te.fill(0,0,O);for(let pe=0;pe<C;pe++)for(let Q=0;Q<T;Q++){const he=fe.data[4*(pe*T+Q)+3]/255;if(he===0)continue;const me=(pe+K)*I+Q+K;if(he===1)ae[me]=0,te[me]=$x;else{const _e=.5-he;ae[me]=_e>0?_e*_e:0,te[me]=_e<0?_e*_e:0}}mC(ae,0,0,I,N,I,this.f,this.v,this.z),mC(te,K,K,T,C,I,this.f,this.v,this.z);for(let pe=0;pe<O;pe++){const Q=Math.sqrt(ae[pe])-Math.sqrt(te[pe]);L[pe]=Math.round(255-255*(Q/this.radius+this.cutoff))}return V}};const Ym=Km;function yC(a,e){return a+e[1]-e[0]}function _C(a,e,o,u,d=1){const g=[],y=a.imagePrimary,T=y.pixelRatio,C=y.paddedRect.w-2*Ym,I=y.paddedRect.h-2*Ym,N=(a.right-a.left)*d,O=(a.bottom-a.top)*d,L=y.stretchX||[[0,C]],V=y.stretchY||[[0,I]],H=L.reduce(yC,0),K=V.reduce(yC,0),te=C-H,ae=I-K;let fe=0,pe=H,Q=0,he=K,me=0,_e=te,De=0,Pe=ae;if(y.content&&u){const Ve=y.content;fe=Hx(L,0,Ve[0]),Q=Hx(V,0,Ve[1]),pe=Hx(L,Ve[0],Ve[2]),he=Hx(V,Ve[1],Ve[3]),me=Ve[0]-fe,De=Ve[1]-Q,_e=Ve[2]-Ve[0]-pe,Pe=Ve[3]-Ve[1]-he}const Oe=(Ve,tt,vt,ft)=>{const xt=Gx(Ve.stretch-fe,pe,N,a.left*d),St=qx(Ve.fixed-me,_e,Ve.stretch,H),rt=Gx(tt.stretch-Q,he,O,a.top*d),_t=qx(tt.fixed-De,Pe,tt.stretch,K),et=Gx(vt.stretch-fe,pe,N,a.left*d),nt=qx(vt.fixed-me,_e,vt.stretch,H),Mt=Gx(ft.stretch-Q,he,O,a.top*d),Pt=qx(ft.fixed-De,Pe,ft.stretch,K),_n=new Ot(xt,rt),nn=new Ot(et,rt),$t=new Ot(et,Mt),At=new Ot(xt,Mt),Gn=new Ot(St/T,_t/T),tn=new Ot(nt/T,Pt/T),sn=e*Math.PI/180;if(sn){const hr=Math.sin(sn),qr=Math.cos(sn),Si=[qr,-hr,hr,qr];_n._matMult(Si),nn._matMult(Si),At._matMult(Si),$t._matMult(Si)}const jn=Ve.stretch+Ve.fixed,nr=vt.stretch+vt.fixed,Kn=tt.stretch+tt.fixed,ur=ft.stretch+ft.fixed,ir=a.imageSecondary;return{tl:_n,tr:nn,bl:At,br:$t,texPrimary:{x:y.paddedRect.x+Ym+jn,y:y.paddedRect.y+Ym+Kn,w:nr-jn,h:ur-Kn},texSecondary:ir?{x:ir.paddedRect.x+Ym+jn,y:ir.paddedRect.y+Ym+Kn,w:nr-jn,h:ur-Kn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gn,pixelOffsetBR:tn,minFontScaleX:_e/T/N,minFontScaleY:Pe/T/O,isSDF:o}};if(u&&(y.stretchX||y.stretchY)){const Ve=xC(L,te,H),tt=xC(V,ae,K);for(let vt=0;vt<Ve.length-1;vt++){const ft=Ve[vt],xt=Ve[vt+1];for(let St=0;St<tt.length-1;St++)g.push(Oe(ft,tt[St],xt,tt[St+1]))}}else g.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return g}function Hx(a,e,o){let u=0;for(const d of a)u+=Math.max(e,Math.min(o,d[1]))-Math.max(e,Math.min(o,d[0]));return u}function xC(a,e,o){const u=[{fixed:-1,stretch:0}];for(const[d,g]of a){const y=u[u.length-1];u.push({fixed:d-y.stretch,stretch:y.stretch}),u.push({fixed:d-y.stretch,stretch:y.stretch+(g-d)})}return u.push({fixed:e+Ym,stretch:o}),u}function Gx(a,e,o,u){return a/e*o+u}function qx(a,e,o,u){return a-e*o/u}function Aj(a,e,o,u){const d=e+a.positionedLines[u].lineOffset;return u===0?o+d/2:o+(d+(e+a.positionedLines[u-1].lineOffset))/2}function Ij(a,e=1,o=!1){let u=1/0,d=1/0,g=-1/0,y=-1/0;const T=a[0];for(let V=0;V<T.length;V++){const H=T[V];(!V||H.x<u)&&(u=H.x),(!V||H.y<d)&&(d=H.y),(!V||H.x>g)&&(g=H.x),(!V||H.y>y)&&(y=H.y)}const C=Math.min(g-u,y-d);let I=C/2;const N=new Ih([],Mj);if(C===0)return new Ot(u,d);for(let V=u;V<g;V+=C)for(let H=d;H<y;H+=C)N.push(new Qg(V+I,H+I,I,a));let O=function(V){let H=0,K=0,te=0;const ae=V[0];for(let fe=0,pe=ae.length,Q=pe-1;fe<pe;Q=fe++){const he=ae[fe],me=ae[Q],_e=he.x*me.y-me.x*he.y;K+=(he.x+me.x)*_e,te+=(he.y+me.y)*_e,H+=3*_e}return new Qg(K/H,te/H,0,V)}(a),L=N.length;for(;N.length;){const V=N.pop();(V.d>O.d||!O.d)&&(O=V,o&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,L)),V.max-O.d<=e||(I=V.h/2,N.push(new Qg(V.p.x-I,V.p.y-I,I,a)),N.push(new Qg(V.p.x+I,V.p.y-I,I,a)),N.push(new Qg(V.p.x-I,V.p.y+I,I,a)),N.push(new Qg(V.p.x+I,V.p.y+I,I,a)),L+=4)}return o&&(console.log(`num probes: ${L}`),console.log(`best distance: ${O.d}`)),O.p}function Mj(a,e){return e.max-a.max}class Qg{constructor(e,o,u,d){this.p=new Ot(e,o),this.h=u,this.d=function(g,y){let T=!1,C=1/0;for(let I=0;I<y.length;I++){const N=y[I];for(let O=0,L=N.length,V=L-1;O<L;V=O++){const H=N[O],K=N[V];H.y>g.y!=K.y>g.y&&g.x<(K.x-H.x)*(g.y-H.y)/(K.y-H.y)+H.x&&(T=!T),C=Math.min(C,wp(g,H,K))}}return(T?1:-1)*Math.sqrt(C)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const kj=Object.keys,hb=Number.POSITIVE_INFINITY,Pj=Math.sqrt(2);function vC(a,[e,o]){let u=0,d=0;if(o===hb){e<0&&(e=0);const g=e/Pj;switch(a){case"top-right":case"top-left":d=g-7;break;case"bottom-right":case"bottom-left":d=7-g;break;case"bottom":d=7-e;break;case"top":d=e-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),o=Math.abs(o),a){case"top-right":case"top-left":case"top":d=o-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-o}switch(a){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,d]}function Wx(a,e,o,u,d,g,y,T,C){if(!e||!e.usvg)return;const I=oC(u),N=oC(d),O=g!=="both"&&g!=="width"||!iC(u)?1:N.width/I.width,L=g!=="both"&&g!=="height"||!sC(u)?1:N.height/I.height;o.scaleSelf(O,L);const V=o.toString();y.set(V,o),T.set(V,e);const{imagePosition:H}=cb(V,e,Km);C.set(V,H)}function bC(a,e,o,u,d,g,y,T,C){if(!a)return;const I=function(N,O,L,V,H,K){if(N.kind==="camera")return N.maxSize;if(N.kind==="composite"){const te=O.possiblyEvaluate(new Hr(N.maxZoom,{worldview:K}),L).evaluate(H,{},L),ae=O.possiblyEvaluate(new Hr(N.minZoom,{worldview:K}),L).evaluate(H,{},L);return Math.max(te,ae)}return O.possiblyEvaluate(new Hr(V,{worldview:K})).evaluate(H,{},L)}(e,o,u,d,g,C);return a.scaleSelf(I*T*y)}function wC(a,e,o,u,d,g,y,T,C){return{iconPrimary:bC(a.getPrimary(),e,o,u,d,g,y,T,C),iconSecondary:bC(a.getSecondary(),e,o,u,d,g,y,T,C)}}function Rj(a,e,o){if(!e)return;const u=o.get(a.toString()),d=o.get(e.toString());d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||Hn(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),u.usvg!==d.usvg&&Hn(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function SC(a,e,o,u){if(!a)return;const d=e.get(o.toString());if(a.imagePrimary=d,u){const g=e.get(u.toString());a.imageSecondary=g}}function Nj(a,e){for(const o in a.horizontal)TC(a.horizontal[o],e);TC(a.vertical,e)}function TC(a,e){if(a){for(const o of a.positionedLines)for(const u of o.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=e.get(d).paddedRect}}}function db(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Dj(a,e,o,u,d,g,y,T,C){const I=fb(g.horizontal)||g.vertical,N=o.get("icon-text-fit-padding").evaluate(u,{},d);let O,L=e;return e&&C!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(O=rC(e,g.vertical,C,N,T,y)),I&&(L=rC(e,I,C,N,T,y))),{defaultShapedIcon:L,verticallyShapedIcon:O}}function Oj(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae,fe,pe){let Q=y.textMaxSize.evaluate(e,{},L);Q===void 0?Q=T*y.textScaleFactor:Q*=y.textScaleFactor;const he=a.layers[0].layout,me=fb(o.horizontal)||o.vertical,_e=V.name==="globe",De=co,Pe=a.tilePixelRatio*Q/De,Oe=(St=a.overscaling,a.zoom>18&&St>2&&(St>>=1),Math.max(jt/(512*St),1)*he.get("symbol-spacing")),Ve=he.get("text-padding")*a.tilePixelRatio,tt=he.get("icon-padding")*a.tilePixelRatio,vt=Sr(he.get("text-max-angle")),ft=he.get("icon-rotation-alignment")==="map"&&pe!=="point",xt=Oe/2;var St;a.hasAnyIconTextFit===!1&&te!=="none"&&(a.hasAnyIconTextFit=!0);const rt=e.properties?+e.properties[cr]:null,_t=rt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(rt):65535,et=(nt,Mt,Pt)=>{if(Mt.x<0||Mt.x>=jt||Mt.y<0||Mt.y>=jt)return;let _n=null;if(_e){const{x:nn,y:$t,z:At}=V.projectTilePoint(Mt.x,Mt.y,Pt);_n={anchor:new ff(nn,$t,At,0,void 0),up:V.upVector(Pt,Mt.x,Mt.y)}}(function(nn,$t,At,Gn,tn,sn,jn,nr,Kn,ur,ir,hr,qr,Si,ye,Se,ot,Lt,Gt,Ut,en,zn,gr,yr,sr,Kr,yi,_r,qi){const Ti=nn.addToLineVertexArray($t,Gn);let Wr,Qi,Ii,_i,Ei,ei,lr,ii=0,Wi=0,Rn=0,Mr=0,Mi=-1,Xi=-1;const Oi={};let Ss=Su("");const li=At?At.anchor:$t,ys=_r!=="none";let el=0,Oo=0;if(Kn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ts=Kn.layout.get("text-offset").evaluate(en,{},sr);el=Ts[0]*co,Oo=Ts[1]*co}else el=Kn.layout.get("text-radial-offset").evaluate(en,{},sr)*co,Oo=hb;if(nn.allowVerticalPlacement&&tn.vertical){const Ts=tn.vertical;if(ye)ei=pb(Ts),nr&&(lr=pb(nr));else{const Us=Kn.layout.get("text-rotate").evaluate(en,{},sr)+90;Ii=Zx(ur,li,$t,ir,hr,qr,Ts,Si,Us,Se),nr&&(_i=Zx(ur,li,$t,ir,hr,qr,nr,Lt,Us))}}if(sn){const Ts=nn.iconSizeData,Us=Kn.layout.get("icon-rotate").evaluate(en,{},sr),Lo=_C(sn,Us,gr,ys,zn.iconScaleFactor),ma=nr?_C(nr,Us,gr,ys,zn.iconScaleFactor):void 0;Qi=Zx(ur,li,$t,ir,hr,qr,sn,Lt,Us,null),ii=4*Lo.length;let Yo=null;Ts.kind==="source"?(Yo=[ad*Kn.layout.get("icon-size").evaluate(en,{},sr)*zn.iconScaleFactor],Yo[0]>Cp&&Hn(`${nn.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)):Ts.kind==="composite"&&(Yo=[ad*zn.compositeIconSizes[0].evaluate(en,{},sr)*zn.iconScaleFactor,ad*zn.compositeIconSizes[1].evaluate(en,{},sr)*zn.iconScaleFactor],(Yo[0]>Cp||Yo[1]>Cp)&&Hn(`${nn.layerIds[0]}: Value for "icon-size" is >= ${x_}. Reduce your "icon-size".`)),nn.addSymbols(nn.icon,Lo,Yo,Ut,Gt,en,void 0,At,$t,Ti.lineStartIndex,Ti.lineLength,-1,yr,sr,Kr,yi),Mi=nn.icon.placedSymbolArray.length-1,ma&&(Wi=4*ma.length,nn.addSymbols(nn.icon,ma,Yo,Ut,Gt,en,vl.vertical,At,$t,Ti.lineStartIndex,Ti.lineLength,-1,yr,sr,Kr,yi),Xi=nn.icon.placedSymbolArray.length-1)}for(const Ts in tn.horizontal){const Us=Ts,Lo=tn.horizontal[Us];Wr||(Ss=Su(Lo.text),ye?Ei=pb(Lo):Wr=Zx(ur,li,$t,ir,hr,qr,Lo,Si,Kn.layout.get("text-rotate").evaluate(en,{},sr),Se));const ma=Lo.positionedLines.length===1;if(Rn+=EC(nn,At,$t,Lo,jn,Kn,ye,en,Se,Ti,tn.vertical?vl.horizontal:vl.horizontalOnly,ma?kj(tn.horizontal):[Us],Oi,Mi,zn,yr,sr,Kr),ma)break}tn.vertical&&(Mr+=EC(nn,At,$t,tn.vertical,jn,Kn,ye,en,Se,Ti,vl.vertical,["vertical"],Oi,Xi,zn,yr,sr,Kr));let bo=-1;const tl=(Ts,Us)=>Ts?Math.max(Ts,Us):Us;bo=tl(Ei,bo),bo=tl(ei,bo),bo=tl(lr,bo);const ld=bo>-1?1:0;nn.glyphOffsetArray.length>=65535&&Hn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),en.sortKey!==void 0&&nn.addToSortKeyRanges(nn.symbolInstances.length,en.sortKey),nn.symbolInstances.emplaceBack($t.x,$t.y,li.x,li.y,li.z,Oi.right>=0?Oi.right:-1,Oi.center>=0?Oi.center:-1,Oi.left>=0?Oi.left:-1,Oi.vertical>=0?Oi.vertical:-1,Mi,Xi,Ss,Wr!==void 0?Wr:nn.collisionBoxArray.length,Wr!==void 0?Wr+1:nn.collisionBoxArray.length,Ii!==void 0?Ii:nn.collisionBoxArray.length,Ii!==void 0?Ii+1:nn.collisionBoxArray.length,Qi!==void 0?Qi:nn.collisionBoxArray.length,Qi!==void 0?Qi+1:nn.collisionBoxArray.length,_i||nn.collisionBoxArray.length,_i?_i+1:nn.collisionBoxArray.length,ir,Rn,Mr,ii,Wi,ld,0,el,Oo,bo,0,ys?1:0,qi)})(a,Mt,_n,nt,o,u,g,d,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,Ve,fe,I,0,tt,ft,ae,e,y,N,O,L,H,K,te,_t)};if(pe==="line")for(const nt of zx(e.geometry,0,0,jt,jt)){const Mt=Cj(nt,Oe,vt,o.vertical||me,u,De,Pe,a.overscaling,jt);for(const Pt of Mt)me&&Lj(a,me.text,xt,Pt)||et(nt,Pt,L)}else if(pe==="line-center"){for(const nt of e.geometry)if(nt.length>1){const Mt=Ej(nt,vt,o.vertical||me,u,De,Pe);Mt&&et(nt,Mt,L)}}else if(e.type==="Polygon")for(const nt of Px(e.geometry,0)){const Mt=Ij(nt,16);et(nt[0],new ff(Mt.x,Mt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const nt of e.geometry)et(nt,new ff(nt[0].x,nt[0].y,0,0,void 0),L);else if(e.type==="Point")for(const nt of e.geometry)for(const Mt of nt)et([Mt],new ff(Mt.x,Mt.y,0,0,void 0),L)}const x_=255,Cp=x_*ad;function EC(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te,ae){const fe=function(he,me,_e,De,Pe,Oe,Ve,tt){const vt=[];if(me.positionedLines.length===0)return vt;const ft=De.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,xt=function(nt){const Mt=nt[0],Pt=nt[1],_n=Mt*Pt;return _n>0?[Mt,-Pt]:_n<0?[-Mt,Pt]:Mt===0?[Pt,Mt]:[Pt,-Mt]}(_e);let St=Math.abs(me.top-me.bottom);for(const nt of me.positionedLines)St-=nt.lineOffset;const rt=me.positionedLines.length,_t=St/rt;let et=me.top-_e[1];for(let nt=0;nt<rt;++nt){const Mt=me.positionedLines[nt];et=Aj(me,_t,et,nt);for(const Pt of Mt.positionedGlyphs){if(!Pt.rect)continue;const _n=Pt.rect||{};let nn=bj+1,$t=!0,At=1,Gn=0;if(Pt.image){const en=Ve.get(Pt.image.toString());if(!en)continue;if(en.sdf){Hn("SDF images are not supported in formatted text and will be ignored.");continue}$t=!1,At=en.pixelRatio,nn=Km/At}const tn=(Pe||tt)&&Pt.vertical,sn=Pt.metrics.advance*Pt.scale/2,jn=Pt.metrics,nr=Pt.rect;if(nr===null)continue;tt&&me.verticalizable&&(Gn=Pt.image?sn-Pt.metrics.width*Pt.scale/2:0);const Kn=Pe?[Pt.x+sn,Pt.y]:[0,0];let ur=[0,0],ir=[0,0],hr=!1;Pe||(tn?(ir=[Pt.x+sn+xt[0],Pt.y+xt[1]-Gn],hr=!0):ur=[Pt.x+sn+_e[0],Pt.y+_e[1]-Gn]);const qr=nr.w*Pt.scale/(At*(Pt.localGlyph?ih:1)),Si=nr.h*Pt.scale/(At*(Pt.localGlyph?ih:1));let ye,Se,ot,Lt;if(tn){const en=Pt.y-et,zn=new Ot(-sn,sn-en),gr=-Math.PI/2,yr=new Ot(...ir);ye=new Ot(-sn+ur[0],ur[1]),ye._rotateAround(gr,zn)._add(yr),ye.x+=-en+sn,ye.y-=(jn.left-nn)*Pt.scale;const sr=Pt.image?jn.advance*Pt.scale:co*Pt.scale,Kr=String.fromCodePoint(Pt.glyph);mj(Kr)?ye.x+=(1-nn)*Pt.scale:gj(Kr)?ye.x+=sr-jn.height*Pt.scale+(-nn-1)*Pt.scale:ye.x+=Pt.image||jn.width+2*nn===nr.w&&jn.height+2*nn===nr.h?(sr-Si)/2:(sr-(jn.height+2*nn)*Pt.scale)/2,Se=new Ot(ye.x,ye.y-qr),ot=new Ot(ye.x+Si,ye.y),Lt=new Ot(ye.x+Si,ye.y-qr)}else{const en=(jn.left-nn)*Pt.scale-sn+ur[0],zn=(-jn.top-nn)*Pt.scale+ur[1],gr=en+qr,yr=zn+Si;ye=new Ot(en,zn),Se=new Ot(gr,zn),ot=new Ot(en,yr),Lt=new Ot(gr,yr)}if(ft){let en;en=Pe?new Ot(0,0):hr?new Ot(xt[0],xt[1]):new Ot(_e[0],_e[1]),ye._rotateAround(ft,en),Se._rotateAround(ft,en),ot._rotateAround(ft,en),Lt._rotateAround(ft,en)}const Gt=new Ot(0,0),Ut=new Ot(0,0);vt.push({tl:ye,tr:Se,bl:ot,br:Lt,texPrimary:_n,texSecondary:void 0,writingMode:me.writingMode,glyphOffset:Kn,sectionIndex:Pt.sectionIndex,isSDF:$t,pixelOffsetTL:Gt,pixelOffsetBR:Ut,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,u,C,g,y,T,d,a.allowVerticalPlacement),pe=a.textSizeData;let Q=null;pe.kind==="source"?(Q=[ad*g.layout.get("text-size").evaluate(T,{},te)*H.textScaleFactor],Q[0]>Cp&&Hn(`${a.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)):pe.kind==="composite"&&(Q=[ad*H.compositeTextSizes[0].evaluate(T,{},te)*H.textScaleFactor,ad*H.compositeTextSizes[1].evaluate(T,{},te)*H.textScaleFactor],(Q[0]>Cp||Q[1]>Cp)&&Hn(`${a.layerIds[0]}: Value for "text-size" is >= ${x_}. Reduce your "text-size".`)),a.addSymbols(a.text,fe,Q,C,y,T,N,e,o,I.lineStartIndex,I.lineLength,V,K,te,ae,!1);for(const he of O)L[he]=a.text.placedSymbolArray.length-1;return 4*fe.length}function fb(a){for(const e in a)return a[e];return null}function Zx(a,e,o,u,d,g,y,T,C,I){let N=y.top,O=y.bottom,L=y.left,V=y.right;if(nC(y)&&y.collisionPadding){const H=y.collisionPadding;L-=H[0],N-=H[1],V+=H[2],O+=H[3]}if(C){const H=new Ot(L,N),K=new Ot(V,N),te=new Ot(L,O),ae=new Ot(V,O),fe=Sr(C);let pe=new Ot(0,0);I&&(pe=new Ot(I[0],I[1])),H._rotateAround(fe,pe),K._rotateAround(fe,pe),te._rotateAround(fe,pe),ae._rotateAround(fe,pe),L=Math.min(H.x,K.x,te.x,ae.x),V=Math.max(H.x,K.x,te.x,ae.x),N=Math.min(H.y,K.y,te.y,ae.y),O=Math.max(H.y,K.y,te.y,ae.y)}return a.emplaceBack(e.x,e.y,e.z,o.x,o.y,L,N,V,O,T,u,d,g),a.length-1}function pb(a){nC(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function Lj(a,e,o,u){const d=a.compareText;if(e in d){const g=d[e];for(let y=g.length-1;y>=0;y--)if(u.dist(g[y])<o)return!0}else d[e]=[];return d[e].push(u),!1}function CC(a,e){const o=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,d=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(o)*d/Math.sin(Math.max(Math.PI/2-a._pitch-o,.01));let y=Math.sin(a._pitch)*g+d;const T=d*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let C=Math.max(a.zoom-17,0);a.isOrthographic&&(C/=10),y*=1+C}return Math.min(1.01*y,T)}function v_(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const o=Math.pow(2,-a.z),u=a.x*o,d=(a.x+1)*o,g=a.y*o,y=(a.y+1)*o,T=Re(u),C=Re(d),I=Be(g),N=Be(y),O=e.project(T,I),L=e.project(C,I),V=e.project(C,N),H=e.project(T,N);let K=Math.min(O.x,L.x,V.x,H.x),te=Math.min(O.y,L.y,V.y,H.y),ae=Math.max(O.x,L.x,V.x,H.x),fe=Math.max(O.y,L.y,V.y,H.y);const pe=o/16;function Q(me,_e,De,Pe,Oe,Ve){const tt=(De+Oe)/2,vt=(Pe+Ve)/2,ft=e.project(Re(tt),Be(vt)),xt=Math.max(0,K-ft.x,te-ft.y,ft.x-ae,ft.y-fe);K=Math.min(K,ft.x),ae=Math.max(ae,ft.x),te=Math.min(te,ft.y),fe=Math.max(fe,ft.y),xt>pe&&(Q(me,ft,De,Pe,tt,vt),Q(ft,_e,tt,vt,Oe,Ve))}Q(O,L,u,g,d,g),Q(L,V,d,g,d,y),Q(V,H,d,y,u,y),Q(H,O,u,y,u,g),K-=pe,te-=pe,ae+=pe,fe+=pe;const he=1/Math.max(ae-K,fe-te);return{scale:he,x:K*he,y:te*he,x2:ae*he,y2:fe*he,projection:e}}function AC(a,{x:e,y:o},u=0){return new Ot(((e-u)*a.scale-a.x)*jt,(o*a.scale-a.y)*jt)}const zj=W(new Float32Array(16));class Ap{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,o){return{x:0,y:0,z:0}}unproject(e,o){return new ce(0,0)}projectTilePoint(e,o,u){return{x:e,y:o,z:0}}locationPoint(e,o,u,d=!0){return e._coordinatePoint(e.locationCoordinate(o,u),d)}pixelsPerMeter(e,o){return Ie(1,e)*o}pixelSpaceConversion(e,o,u){return 1}farthestPixelDistance(e){return CC(e,e.pixelsPerMeter)}pointCoordinate(e,o,u,d){const g=e.horizonLineFromTop(!1),y=new Ot(o,Math.max(g,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,d))}pointCoordinate3D(e,o,u){const d=new Ot(o,u);if(e.elevation)return e.elevation.pointCoordinate(d);{const g=this.pointCoordinate(e,d.x,d.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,o){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,o.x,o.y);const u=e.horizonLineFromTop();return o.y<u}createInversionMatrix(e,o){return zj}createTileMatrix(e,o,u){let d,g,y;const T=u.canonical,C=W(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=v_(T,this);d=1,g=I.x+u.wrap*I.scale,y=I.y,Fe(C,C,[d/I.scale,d/I.scale,e.pixelsPerMeter/o])}else d=o/e.zoomScale(T.z),g=(T.x+Math.pow(2,T.z)*u.wrap)*d,y=T.y*d;return Me(C,C,[g,y,0]),Fe(C,C,[d/jt,d/jt,1]),C}upVector(e,o,u){return[0,0,1]}upVectorScale(e,o,u){return{metersToTile:1}}}class jj extends Ap{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[o,u]=this.parallels=e.parallels||[29.5,45.5],d=Math.sin(Sr(o));this.n=(d+Math.sin(Sr(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(e,o){const{n:u,c:d,r0:g}=this,y=Sr(e-this.center[0]),T=Sr(o),C=Math.sqrt(d-2*u*Math.sin(T))/u;return{x:C*Math.sin(y*u),y:C*Math.cos(y*u)-g,z:0}}unproject(e,o){const{n:u,c:d,r0:g}=this,y=g+o;let T=Math.atan2(e,Math.abs(y))*Math.sign(y);y*u<0&&(T-=Math.PI*Math.sign(e)*Math.sign(y));const C=Sr(this.center[0])*u;T=We(T,-Math.PI-C,Math.PI-C);const I=Ee(Ke(T/u)+this.center[0],-180,180),N=Math.asin(Ee((d-(e*e+y*y)*u*u)/(2*u),-1,1)),O=Ee(Ke(N),-85.051129,st);return new ce(I,O)}}const b_=1.340264,w_=-.081106,S_=893e-6,T_=.003796,Xx=Math.sqrt(3)/2;class Fj extends Ap{project(e,o){o=o/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(Xx*Math.sin(o)),d=u*u,g=d*d*d;return{x:.5*(e*Math.cos(u)/(Xx*(b_+3*w_*d+g*(7*S_+9*T_*d)))/Math.PI+.5),y:1-.5*(u*(b_+w_*d+g*(S_+T_*d))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,d=u*u,g=d*d*d;for(let N,O,L,V=0;V<12&&(O=u*(b_+w_*d+g*(S_+T_*d))-o,L=b_+3*w_*d+g*(7*S_+9*T_*d),N=O/L,u=Ee(u-N,-Math.PI/3,Math.PI/3),d=u*u,g=d*d*d,!(Math.abs(N)<1e-12));++V);const y=Xx*e*(b_+3*w_*d+g*(7*S_+9*T_*d))/Math.cos(u),T=Math.asin(Math.sin(u)/Xx),C=Ee(180*y/Math.PI,-180,180),I=Ee(180*T/Math.PI,-85.051129,st);return new ce(C,I)}}class Bj extends Ap{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){return{x:.5+e/360,y:.5-o/360,z:0}}unproject(e,o){const u=360*(e-.5),d=Ee(360*(.5-o),-85.051129,st);return new ce(u,d)}}const ey=Math.PI/2;function Kx(a){return Math.tan((ey+a)/2)}class Vj extends Ap{constructor(e){super(e),this.center=e.center||[0,30];const[o,u]=this.parallels=e.parallels||[30,30];let d=Sr(o),g=Sr(u);this.southernCenter=d+g<0,this.southernCenter&&(d=-d,g=-g);const y=Math.cos(d),T=Kx(d);this.n=d===g?Math.sin(d):Math.log(y/Math.cos(g))/Math.log(Kx(g)/T),this.f=y*Math.pow(Kx(d),this.n)/this.n}project(e,o){o=Sr(o),this.southernCenter&&(o=-o),e=Sr(e-this.center[0]);const u=1e-6,{n:d,f:g}=this;g>0?o<-ey+u&&(o=-ey+u):o>ey-u&&(o=ey-u);const y=g/Math.pow(Kx(o),d);let T=y*Math.sin(d*e),C=g-y*Math.cos(d*e);return T=.5*(T/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:T,y:this.southernCenter?C:1-C,z:0}}unproject(e,o){e=(2*e-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:d}=this,g=d-o,y=Math.sign(g),T=Math.sign(u)*Math.sqrt(e*e+g*g);let C=Math.atan2(e,Math.abs(g))*y;g*u<0&&(C-=Math.PI*Math.sign(e)*y);const I=Ee(Ke(C/u)+this.center[0],-180,180),N=Ee(Ke(2*Math.atan(Math.pow(d/T,1/u))-ey),-85.051129,st);return new ce(I,this.southernCenter?-N:N)}}class IC extends Ap{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,o){return{x:Te(e),y:be(o),z:0}}unproject(e,o){const u=Re(e),d=Be(o);return new ce(u,d)}}const MC=Sr(st);class Uj extends Ap{project(e,o){const u=(o=Sr(o))*o,d=u*u;return{x:.5*((e=Sr(e))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(e,o){e=(2*e-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,d=25,g=0,y=u*u;do{y=u*u;const I=y*y;g=(u*(1.007226+y*(.015085+I*(.028874*y-.044475-.005916*I)))-o)/(1.007226+y*(.045255+I*(.259866*y-.311325-.005916*11*I))),u=Ee(u-g,-MC,MC)}while(Math.abs(g)>1e-6&&--d>0);y=u*u;const T=Ee(Ke(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),C=Ke(u);return new ce(T,C)}}const kC=Sr(st);class $j extends Ap{project(e,o){o=Sr(o),e=Sr(e);const u=Math.cos(o),d=2/Math.PI,g=Math.acos(u*Math.cos(e/2)),y=Math.sin(g)/g,T=.5*(e*d+2*u*Math.sin(e/2)/y)||0,C=.5*(o+Math.sin(o)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(e,o){let u=e=(2*e-.5)*Math.PI,d=o=(2*(1-o)-1)*Math.PI,g=25;const y=1e-6;let T=0,C=0;do{const I=Math.cos(d),N=Math.sin(d),O=2*N*I,L=N*N,V=I*I,H=Math.cos(u/2),K=Math.sin(u/2),te=2*H*K,ae=K*K,fe=1-V*H*H,pe=fe?1/fe:0,Q=fe?Math.acos(I*H)*Math.sqrt(1/fe):0,he=.5*(2*Q*I*K+2*u/Math.PI)-e,me=.5*(Q*N+d)-o,_e=.5*pe*(V*ae+Q*I*H*L)+1/Math.PI,De=pe*(te*O/4-Q*N*K),Pe=.125*pe*(O*K-Q*N*V*te),Oe=.5*pe*(L*H+Q*ae*I)+.5,Ve=De*Pe-Oe*_e;T=(me*De-he*Oe)/Ve,C=(he*Pe-me*_e)/Ve,u=Ee(u-T,-Math.PI,Math.PI),d=Ee(d-C,-kC,kC)}while((Math.abs(T)>y||Math.abs(C)>y)&&--g>0);return new ce(Ke(u),Ke(d))}}class PC extends Ap{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,o){const{scale:u,cosPhi:d}=this;return{x:Sr(e)*d*u+.5,y:-Math.sin(Sr(o))/d*u+.5,z:0}}unproject(e,o){const{scale:u,cosPhi:d}=this,g=-(o-.5)/u,y=Ee(Ke((e-.5)/u)/d,-180,180),T=Math.asin(Ee(g*d,-1,1)),C=Ee(Ke(T),-85.051129,st);return new ce(y,C)}}class Hj extends IC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,o,u){const d=tr(e,o,u);return An(d,d,yt(Qe(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,o,u){const d=J(o.lat,o.lng),g=Nn([],d),y=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(o),e._centerAltitude):e._centerAltitude;qe(d,d,g,Ie(1,0)*jt*y);const T=W(new Float64Array(16));return de(T,e.pixelMatrix,e.globeMatrix),An(d,d,T),new Ot(d[0],d[1])}pixelsPerMeter(e,o){return Ie(1,0)*o}pixelSpaceConversion(e,o,u){const d=Ie(1,e)*o,g=Mn(Ie(1,45)*o,d,u);return this.pixelsPerMeter(e,o)/g}createTileMatrix(e,o,u){const d=ut(Qe(u.canonical));return de(new Float64Array(16),e.globeMatrix,d)}createInversionMatrix(e,o){const{center:u}=e,d=yt(Qe(o));return at(d,d,Sr(u.lng)),ht(d,d,Sr(u.lat)),Fe(d,d,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(e,o,u,d){return se(e,o,u,!0)||new Le(0,0)}pointCoordinate3D(e,o,u){const d=this.pointCoordinate(e,o,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(e,o){return!se(e,o.x,o.y,!1)}farthestPixelDistance(e){const o=function(d,g){const y=d.cameraToCenterDistance,T=d._centerAltitude*g,C=d._camera,I=d._camera.forward(),N=wn([],Ht([],I,-y),[0,0,T]),O=d.worldSize/(2*Math.PI),L=[0,0,-O],V=d.width/d.height,H=Math.tan(d.fovAboveCenter),K=Ht([],C.up(),H),te=Ht([],C.right(),H*V),ae=Nn([],wn([],wn([],I,K),te)),fe=[];let pe;if(new gi(N,ae).closestPointOnSphere(L,O,fe)){const Q=wn([],fe,L),he=Or([],Q,N);pe=Math.cos(d.fovAboveCenter)*Bn(he)}else{const Q=Or([],N,L),he=Or([],L,N);Nn(he,he);const me=Bn(Q)-O;pe=Math.sqrt(me*(me+2*O));const _e=Math.acos(pe/(O+me))-Math.acos(cn(I,he));pe*=Math.cos(_e)}return 1.01*pe}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=pr(e.zoom);if(u>0){const d=CC(e,Ie(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mn(o,d+g*(1-Math.cos(y)),Math.pow(u,10))}return o}upVector(e,o,u){return tr(o,u,e,1)}upVectorScale(e){return{metersToTile:B(or(Qe(e)))}}}function RC(a){const e=a.parallels,o=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new IC(a);case"equirectangular":return new Bj(a);case"naturalEarth":return new Uj(a);case"equalEarth":return new Fj(a);case"winkelTripel":return new $j(a);case"albers":return o?new PC(a):new jj(a);case"lambertConformalConic":return o?new PC(a):new Vj(a);case"globe":return new Hj(a)}throw new Error(`Invalid projection name: ${a.name}`)}const Gj=er.VectorTileFeature.types,qj=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yx(a,e,o,u,d,g,y,T,C,I,N,O,L){const V=T?Math.min(Cp,Math.round(T[0])):0,H=T?Math.min(Cp,Math.round(T[1])):0;a.emplaceBack(e,o,Math.round(32*u),Math.round(32*d),g,y,(V<<1)+(C?1:0),H,16*I,16*N,256*O,256*L)}function Jx(a,e,o){a.emplaceBack(e,o)}function Qx(a,e,o,u,d,g,y){a.emplaceBack(e,o,u,d,g,y)}const ev=(a,e,o,u)=>{for(let d=0;d<e;d++)a.emplaceBack(o[0],o[1],o[2],u[0],u[1],u[2])};function tv(a,e,o,u,d){a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d),a.emplaceBack(e,o,u,d)}function Wj(a){for(const e of a.sections)if(Xd(e.text))return!0;return!1}class mb{constructor(e){this.layoutVertexArray=new Jh,this.indexArray=new Rs,this.programConfigurations=e,this.segments=new si,this.dynamicLayoutVertexArray=new Ps,this.opacityVertexArray=new gc,this.placedSymbolArray=new yp,this.iconTransitioningVertexArray=new yc,this.globeExtVertexArray=new Mo,this.zOffsetVertexArray=new mc,this.orientationVertexArray=new pp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,o,u,d,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,aj.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,qj,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,uj.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,oj.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,lj.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,cj.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Zt(mb,"SymbolBuffers");class gb{constructor(e,o,u){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new u,this.segments=new si,this.collisionVertexArray=new Gl,this.collisionVertexArrayExt=new Ps}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,hj.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,dj.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(gb,"CollisionBuffers");class nv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=W([]),this.placementViewportMatrix=W([]);const o=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=aC(this.zoom,o["text-size"],this.worldview),this.iconSizeData=aC(this.zoom,o["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(y=>vl[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new mb(new f(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new mb(new f(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new sf,this.lineVertexArray=new _p,this.symbolInstances=new Om}calculateGlyphDependencies(e,o,u,d,g){for(const y of e){const T=y.codePointAt(0);if(T===void 0)break;if(o[T]=!0,d&&g&&T<=65535){const C=m_[y];C&&(o[C.charCodeAt(0)]=!0)}}}updateFootprints(e,o){}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!H1(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(e,o,u,d){const g=this.layers[0],y=g.layout,T=this.projection.name==="globe",C=y.get("text-font"),I=y.get("text-field"),N=y.get("icon-image"),[O,L]=y.get("icon-size-scale-range"),V=Ee(o.scaleFactor||1,O,L),H=(I.value.kind!=="constant"||I.value.value instanceof Ao&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),K=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,te=y.get("symbol-sort-key");if(this.features=[],!H&&!K)return;const ae=o.iconDependencies,fe=o.glyphDependencies,pe=o.availableImages,Q=new Hr(this.zoom,{worldview:this.worldview});for(const{feature:he,id:me,index:_e,sourceLayerIndex:De}of e){const Pe=g._featureFilter.needGeometry,Oe=Bt(he,Pe);if(!g._featureFilter.filter(Q,Oe,u))continue;if(Pe||(Oe.geometry=qt(he,u,d)),T&&he.type!==1&&u.z<=5){const xt=Oe.geometry,St=.98078528056,rt=(_t,et)=>cn(tr(_t.x,_t.y,u,1),tr(et.x,et.y,u,1))<St;for(let _t=0;_t<xt.length;_t++)xt[_t]=It(xt[_t],rt)}let Ve,tt;if(H){const xt=g.getValueAndResolveTokens("text-field",Oe,u,pe),St=Ao.factory(xt);Wj(St)&&(this.hasRTLText=!0),(!this.hasRTLText||fc()==="unavailable"||this.hasRTLText&&pl.isParsed())&&(Ve=pj(St,g,Oe))}if(K){const xt=g.getValueAndResolveTokens("icon-image",Oe,u,pe);tt=typeof xt=="string"?Uo.build(xt):xt}if(!Ve&&!tt)continue;const vt=this.sortFeaturesByKey?te.evaluate(Oe,{},u):void 0,ft={id:me,text:Ve,icon:tt,index:_e,sourceLayerIndex:De,geometry:Oe.geometry,properties:he.properties,type:Gj[he.type],sortKey:vt};if(this.features.push(ft),tt){const xt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:St,iconSecondary:rt}=wC(tt,this.iconSizeData,xt["icon-size"],u,this.zoom,ft,this.pixelRatio,V,this.worldview),_t=St.id.toString();if(ae.has(_t)?ae.get(_t).push(St):ae.set(_t,[St]),rt){const et=rt.id.toString();ae.has(et)?ae.get(et).push(rt):ae.set(et,[rt])}}if(Ve){const xt=C.evaluate(Oe,{},u).join(","),St=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(vl.vertical)>=0;for(const rt of Ve.sections)if(rt.image){const _t=rt.image.getPrimary().scaleSelf(this.pixelRatio),et=_t.id.toString(),nt=ae.get(et)||[];nt.push(_t),ae.set(et,nt)}else{const _t=Ra(Ve.toString()),et=rt.fontStack||xt,nt=fe[et]=fe[et]||{};this.calculateGlyphDependencies(rt.text,nt,St,this.allowVerticalPlacement,_t)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(he){const me={},_e={},De=[];let Pe=0;function Oe(ft){De.push(he[ft]),Pe++}function Ve(ft,xt,St){const rt=_e[ft];return delete _e[ft],_e[xt]=rt,De[rt].geometry[0].pop(),De[rt].geometry[0]=De[rt].geometry[0].concat(St[0]),rt}function tt(ft,xt,St){const rt=me[xt];return delete me[xt],me[ft]=rt,De[rt].geometry[0].shift(),De[rt].geometry[0]=St[0].concat(De[rt].geometry[0]),rt}function vt(ft,xt,St){const rt=St?xt[0][xt[0].length-1]:xt[0][0];return`${ft}:${rt.x}:${rt.y}`}for(let ft=0;ft<he.length;ft++){const xt=he[ft],St=xt.geometry,rt=xt.text?xt.text.toString():null;if(!rt){Oe(ft);continue}const _t=vt(rt,St),et=vt(rt,St,!0);if(_t in _e&&et in me&&_e[_t]!==me[et]){const nt=tt(_t,et,St),Mt=Ve(_t,et,De[nt].geometry);delete me[_t],delete _e[et],_e[vt(rt,De[Mt].geometry,!0)]=Mt,De[nt].geometry=null}else _t in _e?Ve(_t,et,St):et in me?tt(_t,et,St):(Oe(ft),me[_t]=Pe-1,_e[et]=Pe-1)}return De.filter(ft=>ft.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",o.elevationFeatures){!this.elevationFeatures&&o.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const he of o.elevationFeatures)this.elevationFeatureIdToIndex.set(he.id,this.elevationFeatures.length),this.elevationFeatures.push(he)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((he,me)=>he.sortKey-me.sortKey)}update(e,o,u,d,g,y,T){this.text.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,o,g,u,d,y,T,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let o=!1;const u=Je(e),d=1/u;let g=!1,y=!1;for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T),I=Ft(1,0,0),N=Ft(0,1,0),{numHorizontalGlyphVertices:O,numVerticalGlyphVertices:L,numIconVertices:V,numVerticalIconVertices:H}=C,K=O>0||L>0,te=V>0,ae=this.elevationFeatures[C.elevationFeatureIndex];if(ae){const fe=new Ot(C.tileAnchorX,C.tileAnchorY),pe=.075+ae.pointElevation(fe);C.zOffset!==pe&&(o=!0,C.zOffset=pe);const Q=ae.computeSlopeNormal(fe,d),he=Fo(Ki(),Ft(0,0,1),Q);Zr(I,I,he),Zr(N,N,he),I[2]*=u,N[2]*=u,I[0]===1&&I[1]===0&&I[2]===0&&N[0]===0&&N[1]===1&&N[2]===0||(g=g||K,y=y||te)}if(K&&(ev(this.text.orientationVertexArray,O,I,N),ev(this.text.orientationVertexArray,L,I,N)),te){const{placedIconSymbolIndex:fe,verticalPlacedIconSymbolIndex:pe}=C;fe>=0&&ev(this.icon.orientationVertexArray,V,I,N),pe>=0&&ev(this.icon.orientationVertexArray,H,I,N)}}g||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),o&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(g,y,T)=>{u+=y,u>g.length&&g.resize(u);for(let C=-y;C<0;C++)g.emplace(C+u,T)},o=(g,y,T)=>{d+=y,d>g.length&&g.resize(d);for(let C=-y;C<0;C++)g.emplace(C+d,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:C,numIconVertices:I}=y,N=y.zOffset,O=I>0;if((T>0||C>0)&&(e(this.text.zOffsetVertexArray,T,N),e(this.text.zOffsetVertexArray,C,N)),O){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:V}=y;L>=0&&o(this.icon.zOffsetVertexArray,I,N),V>=0&&o(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,N)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=RC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const u=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:d,y:g}of o)this.lineVertexArray.emplaceBack(d,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,o,u,d,g,y,T,C,I,N,O,L,V,H,K,te){const ae=e.indexArray,fe=e.layoutVertexArray,pe=e.globeExtVertexArray,Q=e.segments.prepareSegment(4*o.length,fe,ae,this.canOverlap?y.sortKey:void 0),he=this.glyphOffsetArray.length,me=Q.vertexLength,_e=this.allowVerticalPlacement&&T===vl.vertical?Math.PI/2:0,De=y.text&&y.text.sections;for(let Oe=0;Oe<o.length;Oe++){const{tl:Ve,tr:tt,bl:vt,br:ft,texPrimary:xt,texSecondary:St,pixelOffsetTL:rt,pixelOffsetBR:_t,minFontScaleX:et,minFontScaleY:nt,glyphOffset:Mt,isSDF:Pt,sectionIndex:_n}=o[Oe],nn=Q.vertexLength,$t=Mt[1];if(Yx(fe,I.x,I.y,Ve.x,$t+Ve.y,xt.x,xt.y,u,Pt,rt.x,rt.y,et,nt),Yx(fe,I.x,I.y,tt.x,$t+tt.y,xt.x+xt.w,xt.y,u,Pt,_t.x,rt.y,et,nt),Yx(fe,I.x,I.y,vt.x,$t+vt.y,xt.x,xt.y+xt.h,u,Pt,rt.x,_t.y,et,nt),Yx(fe,I.x,I.y,ft.x,$t+ft.y,xt.x+xt.w,xt.y+xt.h,u,Pt,_t.x,_t.y,et,nt),C){const{x:At,y:Gn,z:tn}=C.anchor,[sn,jn,nr]=C.up;Qx(pe,At,Gn,tn,sn,jn,nr),Qx(pe,At,Gn,tn,sn,jn,nr),Qx(pe,At,Gn,tn,sn,jn,nr),Qx(pe,At,Gn,tn,sn,jn,nr),tv(e.dynamicLayoutVertexArray,At,Gn,tn,_e)}else tv(e.dynamicLayoutVertexArray,I.x,I.y,I.z,_e);if(te){const At=St||xt;Jx(e.iconTransitioningVertexArray,At.x,At.y),Jx(e.iconTransitioningVertexArray,At.x+At.w,At.y),Jx(e.iconTransitioningVertexArray,At.x,At.y+At.h),Jx(e.iconTransitioningVertexArray,At.x+At.w,At.y+At.h)}ae.emplaceBack(nn,nn+1,nn+2),ae.emplaceBack(nn+1,nn+2,nn+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mt[0]),Oe!==o.length-1&&_n===o[Oe+1].sectionIndex||e.programConfigurations.populatePaintArrays(fe.length,y,y.index,{},V,H,K,De&&De[_n],this.worldview)}const Pe=C?C.anchor:I;e.placedSymbolArray.emplaceBack(Pe.x,Pe.y,Pe.z,I.x,I.y,he,this.glyphOffsetArray.length-he,me,N,O,I.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],T,0,0,0,L,0)}_commitLayoutVertex(e,o,u,d,g,y,T){e.emplaceBack(o,u,d,g,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,o,u,d,g,y,T){const C=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),I=C.vertexLength,N=T.tileAnchorX,O=T.tileAnchorY;for(let V=0;V<4;V++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,e.padding,T.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,g,y,N,O,new Ot(e.x1,e.y2)),C.vertexLength+=4;const L=u.indexArray;L.emplaceBack(I,I+1),L.emplaceBack(I+1,I+2),L.emplaceBack(I+2,I+3),L.emplaceBack(I+3,I),C.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,u,d,g,y){for(let T=d;T<g;T++){const C=u.get(T),I=this.getSymbolInstanceTextSize(e,y,o,T);this._addCollisionDebugVertices(C,I,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,o,u,d,g,y){for(let T=d;T<g;T++){const C=u.get(T),I=this.getSymbolInstanceIconSize(e,o,y.placedIconSymbolIndex);this._addCollisionDebugVertices(C,I,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,o,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gb(ef,WE.members,yc),this.iconCollisionBox=new gb(ef,WE.members,yc);const d=y_(this.iconSizeData,e),g=y_(this.textSizeData,e,u);for(let y=0;y<this.symbolInstances.length;y++){const T=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(g,e,o,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(g,e,o,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(d,e,o,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(d,e,o,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(e,o,u,d){const g=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:d),y=lb(this.textSizeData,e,g)/co;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,o,u){const d=this.icon.placedSymbolArray.get(u),g=lb(this.iconSizeData,e,d);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,o,u,d){e.emplaceBack(o,-u,-u,d),e.emplaceBack(o,u,-u,d),e.emplaceBack(o,u,u,d),e.emplaceBack(o,-u,u,d)}_updateTextDebugCollisionBoxes(e,o,u,d,g,y,T){for(let C=d;C<g;C++){const I=u.get(C),N=this.getSymbolInstanceTextSize(e,y,o,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,N,I.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(e,o,u,d,g,y,T){for(let C=d;C<g;C++){const I=u.get(C),N=this.getSymbolInstanceIconSize(e,o,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,N,I.padding,y.zOffset)}}updateCollisionDebugBuffers(e,o,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=y_(this.iconSizeData,e,d),y=y_(this.textSizeData,e,u);for(let T=0;T<this.symbolInstances.length;T++){const C=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(y,e,o,C.textBoxStartIndex,C.textBoxEndIndex,C,u),this._updateTextDebugCollisionBoxes(y,e,o,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C,u),this._updateIconDebugCollisionBoxes(g,e,o,C.iconBoxStartIndex,C.iconBoxEndIndex,C,d),this._updateIconDebugCollisionBoxes(g,e,o,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex,C,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,u,d,g,y,T,C,I){const N={};if(o<u){const{x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(o);N.textBox={x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q},N.textFeatureIndex=he}if(d<g){const{x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(d);N.verticalTextBox={x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q},N.verticalTextFeatureIndex=he}if(y<T){const{x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(y);N.iconBox={x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q},N.iconFeatureIndex=he}if(C<I){const{x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q,featureIndex:he}=e.get(C);N.verticalIconBox={x1:O,y1:L,x2:V,y2:H,padding:K,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:fe,tileAnchorX:pe,tileAnchorY:Q},N.verticalIconFeatureIndex=he}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,o){const u=e.placedSymbolArray.get(o),d=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<d;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(e),u=Math.cos(e),d=[],g=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const C=this.symbolInstances.get(T);d.push(0|Math.round(o*C.tileAnchorX+u*C.tileAnchorY)),g.push(C.featureIndex)}return y.sort((T,C)=>d[T]-d[C]||g[C]-g[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:I}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let NC,DC,yb;Zt(nv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nv.addDynamicAttributes=tv;class OC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Th,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(OC,"FormatSectionOverride",{omit:["defaultValue"]});const _b=()=>yb||(yb={layout:NC||(NC=new Di({"symbol-placement":new Tt($e.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt($e.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt($e.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt($e.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt($e.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new zt($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt($e.layout_symbol["icon-image"]),"icon-rotate":new zt($e.layout_symbol["icon-rotate"]),"icon-padding":new Tt($e.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt($e.layout_symbol["icon-keep-upright"]),"icon-offset":new zt($e.layout_symbol["icon-offset"]),"icon-anchor":new zt($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt($e.layout_symbol["text-rotation-alignment"]),"text-field":new zt($e.layout_symbol["text-field"]),"text-font":new zt($e.layout_symbol["text-font"]),"text-size":new zt($e.layout_symbol["text-size"]),"text-size-scale-range":new Tt($e.layout_symbol["text-size-scale-range"]),"text-max-width":new zt($e.layout_symbol["text-max-width"]),"text-line-height":new zt($e.layout_symbol["text-line-height"]),"text-letter-spacing":new zt($e.layout_symbol["text-letter-spacing"]),"text-justify":new zt($e.layout_symbol["text-justify"]),"text-radial-offset":new zt($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt($e.layout_symbol["text-variable-anchor"]),"text-anchor":new zt($e.layout_symbol["text-anchor"]),"text-max-angle":new Tt($e.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt($e.layout_symbol["text-writing-mode"]),"text-rotate":new zt($e.layout_symbol["text-rotate"]),"text-padding":new Tt($e.layout_symbol["text-padding"]),"text-keep-upright":new Tt($e.layout_symbol["text-keep-upright"]),"text-transform":new zt($e.layout_symbol["text-transform"]),"text-offset":new zt($e.layout_symbol["text-offset"]),"text-allow-overlap":new Tt($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt($e.layout_symbol["text-ignore-placement"]),"text-optional":new Tt($e.layout_symbol["text-optional"]),visibility:new Tt($e.layout_symbol.visibility)})),paint:DC||(DC=new Di({"icon-opacity":new zt($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new zt($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new zt($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zt($e.paint_symbol["text-emissive-strength"]),"icon-color":new zt($e.paint_symbol["icon-color"]),"icon-halo-color":new zt($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt($e.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zt($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new zt($e.paint_symbol["text-occlusion-opacity"]),"text-color":new zt($e.paint_symbol["text-color"],{runtimeType:ra,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new zt($e.paint_symbol["text-halo-color"]),"text-halo-width":new zt($e.paint_symbol["text-halo-width"]),"text-halo-blur":new zt($e.paint_symbol["text-halo-blur"]),"text-translate":new Tt($e.paint_symbol["text-translate"]),"text-translate-anchor":new Tt($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt($e.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new zt($e.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},yb);class rv extends lo{constructor(e,o,u,d){super(e,_b(),o,u,d),this._colorAdjustmentMatrix=W([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,o){super.recalculate(e,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const g of u)d.indexOf(g)<0&&d.push(g);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,o,u,d){return this._saturation===e&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=function(g,y,T,C){g=yo(g),y=hs(y);const I=Y(),N=g/3,O=1-2*N,L=[O,N,N,0,N,O,N,0,N,N,O,0,0,0,0,1],V=.5-.5*y,H=C-T;return de(I,[H,0,0,0,0,H,0,0,0,0,H,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,V,V,V,1]),de(I,I,L),I}(e,o,u,d),this._saturation=e,this._contrast=o,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,o,u,d){const g=this.layout.get(e).evaluate(o,{},u,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||hc(y.value)||!g?g:function(T,C){return C.replace(/{([^{}]+)}/g,(I,N)=>N in T?String(T[N]):"")}(o.properties,g)}createBucket(e){return new nv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of _b().paint.overridableProperties){if(!rv.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),u=new OC(o),d=new Uu(u,o.property.specification,this.scope,this.options);let g=null;g=o.value.kind==="constant"||o.value.kind==="source"?new Kc("source",d):new Yc("composite",d,o.value.zoomStops,o.value.interpolationType),this.paint._values[e]=new Vl(o.property,g,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&rv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const u=e.get("text-field"),d=_b().paint.properties[o];let g=!1;const y=T=>{for(const C of T)if(d.overrides&&d.overrides.hasOverride(C))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Ao)y(u.value.value.sections);else if(u.value.kind==="source"){const T=I=>{g||(I instanceof Dn&&Kt(I.value)===Eh?y(I.value.sections):I instanceof Au?y(I.sections):I.eachChild(T))},C=u.value;C._styleExpression&&T(C._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,o,u){return{config:new Po(this,{zoom:o,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let LC,zC,jC,FC;var xb=Tr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function bb(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class wb{constructor(e,o,u,d){this.context=e,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=e.gl.createTexture(),this.update(o,{premultiply:d&&d.premultiply})}update(e,o){const u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,d=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:g}=this,{gl:y}=g,{x:T,y:C}=o&&o.position?o.position:{x:0,y:0},I=T+u,N=C+d;!this.size||this.size[0]===I&&this.size[1]===N||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!o||o.premultiply!==!1));const O=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&I>0&&N>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(I,N)))+1:1;y.texStorage2D(y.TEXTURE_2D,L,this.format,I,N),this.size=[I,N]}if(this.size)if(O)y.texSubImage2D(y.TEXTURE_2D,0,T,C,vb(this.format),bb(this.format),e);else{const L=e.data;L&&y.texSubImage2D(y.TEXTURE_2D,0,T,C,u,d,vb(this.format),bb(this.format),L)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,o,u=!1){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(e,o,u,d,g){const{context:y}=this,{gl:T}=y;T.bindTexture(T.TEXTURE_2D,this.texture),o!==this.magFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,o),this.magFilter=o),e!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?e===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,d),this.wrapT=d),g!==this.compareMode&&(g?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_FUNC,g)):T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.NONE),this.compareMode=g)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class iv{constructor(e,o){this.context=e,this.texture=o}bind(e,o){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,o),this.wrapS=o)}}function sv(a,e,o,u,d,g,y,T){const C=[a,e,1,o,u,1,d,g,1],I=[y,T,1],N=U([],C),[O,L,V]=Fn(I,I,N);return X(C,C,[O,0,0,0,L,0,0,0,V])}function BC(a,e,o,u,d,g,y,T){const C=function(I,N,O,L,V,H,K,te){const ae=sv(0,0,1,0,1,1,0,1),fe=sv(I,N,O,L,V,H,K,te);return X(fe,fe,U([],ae))}(a,e,o,u,d,g,y,T);return[C[2]/C[8]/jt,C[5]/C[8]/jt]}function ov(a){return[a[0],Math.min(Math.max(a[1],-85.051129),st)]}class VC extends Fc{constructor(e,o,u,d){super(),this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=o,this._dirty=!1}load(e,o){if(this._loaded=o||!1,this.fire(new jc("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=bu(this.map._requestManager.transformRequest(this.url,Xa.Image),(u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new cl(u)):d&&(this.image=d instanceof HTMLImageElement?Wa.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new iv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new jc("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof iv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=e[0][1],u=e[0][1];for(const g of e)g[1]>u&&(u=g[1]),g[1]<o&&(o=g[1]);const d=(u+o)/2;if(d>st?this.onNorthPole=!0:d<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=e.map(Le.fromLngLat);this.tileID=function(y){let T=1/0,C=1/0,I=-1/0,N=-1/0;for(const K of y)T=Math.min(T,K.x),C=Math.min(C,K.y),I=Math.max(I,K.x),N=Math.max(N,K.y);const O=Math.max(I-T,N-C),L=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),V=Math.pow(2,L);let H=Math.floor((T+I)/2*V);return H>1&&(H-=1),new df(L,H,Math.floor((C+N)/2*V))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new jc("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ae in this.tiles){const fe=this.tiles[ae];fe.state!=="loaded"&&(fe.state="loaded",fe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=v_(new df(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const fe=ae[1].x-ae[0].x,pe=ae[1].y-ae[0].y,Q=ae[2].x-ae[1].x,he=ae[2].y-ae[1].y,me=ae[3].x-ae[2].x,_e=ae[3].y-ae[2].y,De=ae[0].x-ae[3].x,Pe=ae[0].y-ae[3].y,Oe=fe*he-Q*pe,Ve=Q*_e-me*he,tt=me*Pe-De*_e,vt=De*pe-fe*Pe;return Oe>0&&Ve>0&&tt>0&&vt>0||Oe<0&&Ve<0&&tt<0&&vt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=v_(this.tileID,this.map.transform.projection),[g,y,T,C]=this.coordinates.map(ae=>{const fe=d.projection.project(ae[0],ae[1]);return AC(d,fe)._round()});this.perspectiveTransform=BC(g.x,g.y,y.x,y.y,T.x,T.y,C.x,C.y);const I=this._boundsArray=new Yh;I.emplaceBack(g.x,g.y,0,0),I.emplaceBack(y.x,y.y,jt,0),I.emplaceBack(C.x,C.y,0,jt),I.emplaceBack(T.x,T.y,jt,jt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(I,xb.members),this.boundsSegments=si.simpleSegment(0,0,4,2);const N=[],O=[ov((L=this.coordinates)[0]),ov(L[1]),ov(L[2]),ov(L[3])];var L;const[V,H,K,te]=function(ae){let fe=ae[0][0],pe=fe,Q=ae[0][1],he=Q;for(let me=1;me<ae.length;me++)ae[me][0]<fe?fe=ae[me][0]:ae[me][0]>pe&&(pe=ae[me][0]),ae[me][1]<Q?Q=ae[me][1]:ae[me][1]>he&&(he=ae[me][1]);return[fe,Q,pe-fe,he-Q]}(O);{const ae=new Yh,[fe,pe,Q,he]=function(rt){let _t=rt[0].x,et=_t,nt=rt[0].y,Mt=nt;for(let Pt=1;Pt<rt.length;Pt++)rt[Pt].x<_t?_t=rt[Pt].x:rt[Pt].x>et&&(et=rt[Pt].x),rt[Pt].y<nt?nt=rt[Pt].y:rt[Pt].y>Mt&&(Mt=rt[Pt].y);return[_t,nt,et-_t,Mt-nt]}(u),me=rt=>[(rt.x-fe)/Q,(rt.y-pe)/he],[_e,De,Pe,Oe]=u.map(me),Ve=function(rt,_t,et,nt,Mt,Pt,_n,nn){const $t=sv(0,0,1,0,1,1,0,1);return X($t,$t,U([],sv(rt,_t,et,nt,Mt,Pt,_n,nn)))}(_e[0],_e[1],De[0],De[1],Pe[0],Pe[1],Oe[0],Oe[1]);this.elevatedGlobePerspectiveTransform=BC(_e[0],_e[1],De[0],De[1],Pe[0],Pe[1],Oe[0],Oe[1]);const tt=(rt,_t)=>{N.push(rt.lng);const et=Math.round((rt.lng-V)/K*jt),nt=Math.round((rt.lat-H)/te*jt),Mt=me(_t),Pt=Fn([],[Mt[0],Mt[1],1],Ve),_n=Math.round(Pt[0]/Pt[2]*jt),nn=Math.round(Pt[1]/Pt[2]*jt);ae.emplaceBack(et,nt,_n,nn)},vt=u[3].x-u[0].x,ft=u[3].y-u[0].y,xt=u[2].x-u[1].x,St=u[2].y-u[1].y;for(let rt=0;rt<65;rt++){const _t=rt/64,et=[u[0].x+_t*vt,u[0].y+_t*ft],nt=[u[1].x+_t*xt,u[1].y+_t*St],Mt=nt[0]-et[0],Pt=nt[1]-et[1];for(let _n=0;_n<65;_n++){const nn=_n/64,$t={x:et[0]+Mt*nn,y:et[1]+Pt*nn};tt(o.projection.unproject($t.x,$t.y),$t)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ae,xb.members)}{this.maxLongitudeTriangleSize=0;let ae=[],fe=new Rs;const pe=(Q,he,me)=>{fe.emplaceBack(Q,he,me);const _e=N[Q],De=N[he],Pe=N[me],Oe=Math.min(Math.min(_e,De),Pe),Ve=Math.max(Math.max(_e,De),Pe)-Oe;Ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ve),ae.push(Oe+Ve/2)};for(let Q=0;Q<64;Q++)for(let he=0;he<64;he++){const me=65*Q+he,_e=me+1,De=me+65,Pe=De+1;pe(me,De,_e),pe(_e,De,Pe)}[ae,fe]=function(Q,he){const me=Array.from({length:Q.length},(Pe,Oe)=>Oe);me.sort((Pe,Oe)=>Q[Pe]-Q[Oe]);const _e=[],De=new Rs;for(let Pe=0;Pe<me.length;Pe++){const Oe=me[Pe];_e.push(Q[Oe]);const Ve=3*Oe,tt=Ve+1;De.emplaceBack(he.uint16[Ve],he.uint16[tt],he.uint16[tt+1])}return[_e,De]}(ae,fe),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(fe)}this.elevatedGlobeSegments=si.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,K/jt,0,te/jt,0,0,H,V,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof iv||(this.texture?this.texture.update(this.image):(this.texture=new wb(o,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(o)}loadTile(e,o){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},o(null)):(e.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(g=e+180)+360*Math.round((u[0]-g)/360);var g;const y=new si,T=(O,L)=>{y.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:o.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=C){const O=gs(u,0,u.length,d+C);return O===u.length||T(O,Ri(u,O+1,u.length,d+360-C)-O),y}d<u[0]&&(d+=360);const I=Ri(u,0,u.length,d-C);if(I===u.length)return T(0,u.length),y;T(0,I-0);const N=gs(u,I+1,u.length,d+C);return N!==u.length&&T(N,u.length-N),y}}const Zj=(Math.pow(256,2)-1)/16907520;class UC extends lo{constructor(e,o,u,d){super(e,{layout:jC||(jC=new Di({visibility:new Tt($e.layout_raster.visibility)})),paint:FC||(FC=new Di({"raster-opacity":new Tt($e.paint_raster["raster-opacity"]),"raster-color":new pc($e.paint_raster["raster-color"]),"raster-color-mix":new Tt($e.paint_raster["raster-color-mix"]),"raster-color-range":new Tt($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt($e.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt($e.paint_raster["raster-saturation"]),"raster-contrast":new Tt($e.paint_raster["raster-contrast"]),"raster-resampling":new Tt($e.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt($e.paint_raster["raster-array-band"]),"raster-elevation":new Tt($e.paint_raster["raster-elevation"]),"raster-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof VC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=e_({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let $C,HC,GC,qC,WC;class ZC extends lo{constructor(e,o,u,d){super(e,{layout:$C||($C=new Di({visibility:new Tt($e["layout_raster-particle"].visibility)})),paint:HC||(HC=new Di({"raster-particle-array-band":new Tt($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pc($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt($e["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt($e["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},o,u,d),this._updateColorRamp(),this.lastInvalidatedAt=Wa.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=e_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Wa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class Xj extends lo{constructor(e,o){super(e,{},o,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Sb(a,e,o){const u=[0,0,1],d=to([]);return To(d,d,o?-Sr(a)+Math.PI:Sr(a)),Qo(d,d,-Sr(e)),Zr(u,u,d),Nn(u,u)}function XC(a,e){const o=av(a.projection,a.zoom,a.width,a.height),u=function(g,y,T,C,I){const N=new ce(T.lng-180*Ip,T.lat),O=new ce(T.lng+180*Ip,T.lat),L=g.project(N.lng,N.lat),V=g.project(O.lng,O.lat),H=-Math.atan2(V.y-L.y,V.x-L.x),K=Le.fromLngLat(T);K.y=Ee(K.y,-1+Ip,1-Ip);const te=K.toLngLat(),ae=g.project(te.lng,te.lat),fe=Le.fromLngLat(te);fe.x+=Ip;const pe=fe.toLngLat(),Q=g.project(pe.lng,pe.lat),he=YC(Q.x-ae.x,Q.y-ae.y,H),me=Le.fromLngLat(te);me.y+=Ip;const _e=me.toLngLat(),De=g.project(_e.lng,_e.lat),Pe=YC(De.x-ae.x,De.y-ae.y,H),Oe=Math.abs(he.x)/Math.abs(Pe.y),Ve=W([]);Dt(Ve,Ve,-H*(1-(I?0:C)));const tt=W([]);return Fe(tt,tt,[1,1-(1-Oe)*C,1]),tt[4]=-Pe.x/Pe.y*C,Dt(tt,tt,H),de(tt,Ve,tt),tt}(a.projection,0,a.center,o,e),d=KC(a);return Fe(u,u,[d,d,1]),u}function KC(a){const e=a.projection,o=av(a.projection,a.zoom,a.width,a.height),u=Tb(e,a.center),d=Tb(e,ce.convert(e.center));return Math.pow(2,u*o+(1-o)*d)}function av(a,e,o,u,d=1/0){const g=a.range;if(!g)return 0;const y=Math.min(d,Math.max(o,u)),T=Math.log(y/1024)/Math.LN2;return ze(g[0]+T,g[1]+T,e)}const Ip=1/4e4;function Tb(a,e){const o=Ee(e.lat,-85.051129,st),u=new ce(e.lng-180*Ip,o),d=new ce(e.lng+180*Ip,o),g=a.project(u.lng,o),y=a.project(d.lng,o),T=Le.fromLngLat(u),C=Le.fromLngLat(d),I=y.x-g.x,N=y.y-g.y,O=C.x-T.x,L=C.y-T.y,V=Math.sqrt((O*O+L*L)/(I*I+N*N));return Math.log(V)/Math.LN2}function YC(a,e,o){const u=Math.cos(o),d=Math.sin(o);return{x:a*u-e*d,y:a*d+e*u}}function JC(a,e,o){W(a),Dt(a,a,Sr(e[2])),ht(a,a,Sr(e[0])),at(a,a,Sr(e[1])),Fe(a,a,o),de(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function lv(a,e,o,u,d,g,y,T){const C=[o[0]-e[0],o[1]-e[1],0],I=[u[0]-e[0],u[1]-e[1],0];if(Bn(C)<1e-12||Bn(I)<1e-12)return to(a);const N=un([],C,I);Nn(N,N),Yt(I,u,e),C[2]=(g-d)*T,I[2]=(y-d)*T;const O=C;return un(O,C,I),Nn(O,O),Fo(a,N,O)}function Eb(a,e,o=!1){const u=pr(e.zoom),d=function(g,y,T){const C=y.worldSize,I=[g[12],g[13],g[14]],N=Be(I[1]/C),O=Re(I[0]/C),L=W([]),V=Ie(1,N)*C,H=Ie(1,0)*C*mt(N,y.zoom),K=1/bt(C);let te=H*K;if(T){const Q=av(y.projection,y.zoom,y.width,y.height,1024);te=K*y.projection.pixelSpaceConversion(y.center.lat,C,Q)}const ae=J(N,O);wn(ae,ae,Ht([],Nn([],ae),V*te*I[2]));const fe=function(Q){const he=[Q[0],Q[1],Q[2]];let me=[0,1,0];const _e=un([],me,he);return un(me,he,_e),Pn(me)===0&&(me=[0,1,0],un(_e,he,me)),Nn(_e,_e),Nn(me,me),Nn(he,he),[_e[0],_e[1],_e[2],0,me[0],me[1],me[2],0,he[0],he[1],he[2],0,Q[0],Q[1],Q[2],1]}(ae);Fe(L,L,[te,te,te*V]),Me(L,L,[-I[0],-I[1],-I[2]]);const pe=de([],y.globeMatrix,fe);return de(pe,pe,L),de(pe,pe,g),pe}(a,e,o);if(u>0){const g=function(y,T){const C=T.worldSize,I=Ie(1,0)*C*mt(T.center.lat,T.zoom)/bt(C),N=Ie(1,T.center.lat)*C,O=W([]);return at(O,O,Sr(T.center.lng)),ht(O,O,Sr(T.center.lat)),Me(O,O,[0,0,E]),Fe(O,O,[I,I,I*N]),Me(O,O,[T.point.x-.5*C,T.point.y-.5*C,0]),de(O,O,y),de(O,T.globeMatrix,O)}(a,e);return function(y,T,C){const I=(H,K,te)=>{const ae=Bn(H),fe=Bn(K),pe=Et(H,K,te);return Ht(pe,pe,1/Bn(pe)*Mn(ae,fe,te))},N=I([y[0],y[1],y[2]],[T[0],T[1],T[2]],C),O=I([y[4],y[5],y[6]],[T[4],T[5],T[6]],C),L=I([y[8],y[9],y[10]],[T[8],T[9],T[10]],C),V=Et([y[12],y[13],y[14]],[T[12],T[13],T[14]],C);return[N[0],N[1],N[2],0,O[0],O[1],O[2],0,L[0],L[1],L[2],0,V[0],V[1],V[2],1]}(d,g,u)}return d}function QC(a,e,o,u){const d=Dr.projectAabbCorners(u,o);let g=Number.MAX_VALUE,y=-1;for(let I=0;I<d.length;++I){const N=d[I];N[0]=(.5*N[0]+.5)*e.width,N[1]=(.5-.5*N[1])*e.height,N[2]<g&&(y=I,g=N[2])}const T=I=>new Ot(d[I][0],d[I][1]);let C;switch(y){case 0:case 6:C=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:C=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:C=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:C=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(Xo(a,C))return g}const Kj=Tr([{name:"a_pos_3f",components:3,type:"Float32"}]),Yj=Tr([{name:"a_color_3f",components:3,type:"Float32"}]),Jj=Tr([{name:"a_color_4f",components:4,type:"Float32"}]),Qj=Tr([{name:"a_uv_2f",components:2,type:"Float32"}]),e3=Tr([{name:"a_normal_3f",components:3,type:"Float32"}]),t3=Tr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),n3=Tr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),eA={None:0,Model:1,Symbol:2,FillExtrusion:4};class cv{constructor(e,o,u,d){this.message=(e?`${e}: `:"")+u,d&&(this.identifier=d),o!=null&&o.__line__&&(this.line=o.__line__)}}function Cb(a,e){const o=a.indexOf("://")===-1;try{return new URL(a,o&&e?"http://example.com":void 0),!0}catch{return!1}}class tA{constructor(e,o){this.feature=e,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class nA{constructor(){this.instancedDataArray=new Xu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Ab{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,o){}populate(e,o,u,d){this.tileToMeter=Je(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:C,sourceLayerIndex:I}of e){const N=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),O=Bt(y,g);if(!this.layers[0]._featureFilter.filter(new Hr(this.zoom,{worldview:this.worldview}),O,u))continue;const L={id:N,sourceLayerIndex:I,index:C,geometry:g?O.geometry:qt(y,u,d),properties:y.properties,type:y.type,patterns:{}},V=this.addFeature(L,L.geometry,O);V&&o.featureIndex.insert(y,L.geometry,C,I,this.index,this.instancesPerModel[V].instancedDataArray.length,jt/32)}this.lookup=null}update(e,o,u,d){for(const g in this.instancesPerModel){const y=this.instancesPerModel[g];for(const T in e)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],e[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const d of u.features){const g=this.layers[0],y=d.feature,T=this.canonical,C=g.paint.get("model-rotation").evaluate(y,{},T),I=g.paint.get("model-scale").evaluate(y,{},T),N=g.paint.get("model-translation").evaluate(y,{},T);ni(d.rotation,C)&&ni(d.scale,I)&&ni(d.translation,N)||(this.evaluate(d,d.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,o,u,d){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const g=o.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(H1(this.activeReplacements,g))return!1;this.activeReplacements=g;let y=!1;for(const T in this.instancesPerModel){const C=this.instancesPerModel[T],I=C.instancedDataArray;for(const N of C.features){const O=N.instancedDataOffset,L=N.instancedDataCount;for(let V=0;V<L;V++){const H=16*(V+O);let K=I.float32[H+0];const te=K>jt;K=te?K-jt:K;const ae=Math.floor(K),fe=I.float32[H+1];let pe=!1;for(const Q of this.activeReplacements)if(!Z2(Q,u,eA.Model,d)&&!(Q.min.x>ae||ae>Q.max.x||Q.min.y>fe||fe>Q.max.y)&&(pe=eE(Q2(ae,fe,e.canonical,Q.footprintTileId.canonical),Q.footprint),pe))break;I.float32[H]=pe?K+jt:K,y=y||pe!==te}}}return y}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,t3.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const o of this.modelUris)e.removeModel(o,"",!0)}addFeature(e,o,u){const d=this.layers[0],g=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return Hn(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),g;(Cb(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new nA);const y=this.instancesPerModel[g],T=y.instancedDataArray,C=new tA(u,T.length);for(const I of o)for(const N of I){if(N.x<0||N.x>=jt||N.y<0||N.y>=jt)continue;const O=(this.lookupDim-1)/jt,L=this.lookupDim*(N.y*O|0)+N.x*O|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const V=T.length;T.resize(V+1),y.instancesEvaluatedElevation.push(0),T.float32[16*V]=N.x,T.float32[16*V+1]=N.y}return C.instancedDataCount=y.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(e.id&&(y.idToFeaturesIndex[e.id]=y.features.length),y.features.push(C),this.evaluate(C,{},y,!1)),g}getModelUris(){return this.modelUris}evaluate(e,o,u,d){const g=this.layers[0],y=e.feature,T=this.canonical,C=e.rotation=g.paint.get("model-rotation").evaluate(y,o,T),I=e.scale=g.paint.get("model-scale").evaluate(y,o,T),N=e.translation=g.paint.get("model-translation").evaluate(y,o,T),O=g.paint.get("model-color").evaluate(y,o,T);O.a=g.paint.get("model-color-mix-intensity").evaluate(y,o,T);const L=[];this.maxVerticalOffset<N[2]&&(this.maxVerticalOffset=N[2]),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),JC(L,C,I);const V=Math.round(100*O.a)+O.b/1.05;for(let H=0;H<e.instancedDataCount;++H){const K=e.instancedDataOffset+H,te=16*K,ae=u.instancedDataArray.float32;let fe=0;d&&(fe=ae[te+6]-u.instancesEvaluatedElevation[K]);const pe=0|ae[te+1];ae[te]=(0|ae[te])+O.r/1.05,ae[te+1]=pe+O.g/1.05,ae[te+2]=V,ae[te+3]=1/(T.z>10?this.tileToMeter:Je(T,pe)),ae[te+4]=N[0],ae[te+5]=N[1],ae[te+6]=N[2]+fe,ae[te+7]=L[0],ae[te+8]=L[1],ae[te+9]=L[2],ae[te+10]=L[4],ae[te+11]=L[5],ae[te+12]=L[6],ae[te+13]=L[8],ae[te+14]=L[9],ae[te+15]=L[10],u.instancesEvaluatedElevation[K]=N[2]}}}let rA,iA;Zt(Ab,"ModelBucket",{omit:["layers"]}),Zt(nA,"PerModelAttributes"),Zt(tA,"ModelFeature");const Jm=64,ty={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function sA(a,e,o,u,d,g,y,T,C,I=!1){const N=o.zoom,O=o.project(u),L=mt(u.lat,N),V=1/L;W(a),Me(a,a,[O.x+y[0]*V,O.y+y[1]*V,y[2]]);let H=1,K=1;const te=o.worldSize;if(I){if(o.projection.name==="mercator"){let Q=0;o.elevation&&(Q=o.elevation.getAtPointOrZero(new Le(O.x/te,O.y/te),0));const he=zi([],[O.x,O.y,Q,1],o.projMatrix)[3]/o.cameraToCenterDistance;H=he,K=he*mt(o.center.lat,N)}else if(o.projection.name==="globe"){const Q=Eb(a,o),he=[0,0,0,1];zi(he,he,de([],o.projMatrix,Q));const me=he[3]/o.cameraToCenterDistance,_e=pr(N),De=o.projection.pixelsPerMeter(u.lat,te)*mt(u.lat,N),Pe=o.projection.pixelsPerMeter(o.center.lat,te)*mt(o.center.lat,N);H=me/Mn(De,it(o.center.lat),_e),K=me*L/De,H*=Pe,K*=Pe}}else H=V;Fe(a,a,[H,H,K]);const ae=[...a],fe=e.orientation,pe=[];if(JC(pe,[fe[0]+d[0],fe[1]+d[1],fe[2]+d[2]],g),de(a,ae,pe),T&&o.elevation){let Q=0;const he=[];if(C&&o.elevation){Q=function(_e,De,Pe,Oe,Ve){const tt=De.elevation;if(!tt)return 0;const vt=Dr.projectAabbCorners(Pe,Oe),ft=Ie(1,Ve.lat)*De.worldSize,xt=function(At,Gn){const tn=[0,0,1],sn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const jn of sn){const nr=At[jn.corners[0]],Kn=At[jn.corners[1]],ur=At[jn.corners[2]],ir=[Kn[0]-nr[0],Kn[1]-nr[1],Gn*(Kn[2]-nr[2])],hr=un(ir,ir,[ur[0]-nr[0],ur[1]-nr[1],Gn*(ur[2]-nr[2])]);Nn(hr,hr),jn.dotProductWithUp=cn(hr,tn)}return sn.sort((jn,nr)=>jn.dotProductWithUp-nr.dotProductWithUp),sn[0].corners}(vt,ft),St=vt[xt[0]],rt=vt[xt[1]],_t=vt[xt[2]],et=vt[xt[3]],nt=tt.getAtPointOrZero(new Le(St[0]/De.worldSize,St[1]/De.worldSize),0),Mt=tt.getAtPointOrZero(new Le(rt[0]/De.worldSize,rt[1]/De.worldSize),0),Pt=tt.getAtPointOrZero(new Le(_t[0]/De.worldSize,_t[1]/De.worldSize),0),_n=tt.getAtPointOrZero(new Le(et[0]/De.worldSize,et[1]/De.worldSize),0),nn=(nt+_n)/2,$t=(Mt+Pt)/2;return nn>$t?Mt<Pt?lv(_e,rt,et,St,Mt,_n,nt,ft):lv(_e,_t,St,et,Pt,nt,_n,ft):nt<_n?lv(_e,St,rt,_t,nt,Mt,Pt,ft):lv(_e,et,_t,rt,_n,Pt,Mt,ft),Math.max(nn,$t)}(he,o,e.aabb,a,u);const me=de([],fn([],he),pe);de(a,ae,me)}else Q=o.elevation.getAtPointOrZero(new Le(O.x/te,O.y/te),0);Q!==0&&(a[14]+=Q)}}function E_(a,e,o=!1){a.uploaded||(a.gfxTexture=new wb(e,a.image,o?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function r3(a,e,o){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,Kj.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,e3.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,Qj.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?Yj:Jj).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,n3.members,!0)),a.segments=si.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&E_(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&E_(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&E_(u.normalTexture,e),u.occlusionTexture&&E_(u.occlusionTexture,e,o),u.emissionTexture&&E_(u.emissionTexture,e)}function Ib(a,e,o){if(a.meshes)for(const u of a.meshes)r3(u,e,o);if(a.children)for(const u of a.children)Ib(u,e,o)}function uv(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)uv(e)}function Mb(a){if(a.meshes)for(const o of a.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((e=o.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const o of a.children)Mb(o)}class ny{constructor(e,o,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(e,o,u){const d=u||e.findDEMTileFor(o);if(!d||!d.dem)return;const g=d.dem,y=d.tileID,T=1<<o.canonical.z-y.canonical.z;return new ny(d,g.dim/jt/T,[(o.canonical.x/T-y.canonical.x)*g.dim,(o.canonical.y/T-y.canonical.y)*g.dim])}tileCoordToPixel(e,o){const u=o*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(u);return new Ot(d,g)}getElevationAt(e,o,u,d){const g=e*this._scale+this._offset[0],y=o*this._scale+this._offset[1],T=Math.floor(g),C=Math.floor(y),I=this._dem;return d=!!d,u?Mn(Mn(I.get(T,C,d),I.get(T,C+1,d),y-C),Mn(I.get(T+1,C,d),I.get(T+1,C+1,d),y-C),g-T):I.get(T,C,d)}getElevationAtPixel(e,o,u){return this._dem.get(e,o,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ie(1,e)*this._dem.stride}}const kb=new Float32Array(262144),Qm=new Uint8Array(262144);function oA(a){let e=0;if(a.meshes)for(const o of a.meshes)e=Math.max(e,o.aabb.max[2]);if(a.children)for(const o of a.children)e=Math.max(e,oA(o));return e}function aA(a,e,o){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const d=Dr.applyTransform(u.aabb,a.matrix);o.insert(e,d.min[0],d.min[1],d.max[0],d.max[1])}if(a.children)for(const u of a.children)aA(u,e,o)}const lA=["","wall","door","roof","window","lamp","logo"];class cA{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:oA(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const o=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=Dr.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),e++;this.aabb=o}return this.aabb}}class hv{constructor(e,o,u,d,g,y,T,C){this.id=u,this.layers=e,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=ty.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=ty.HasMapboxMeshFeatures),g&&(this.modelTraits|=ty.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=C,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const I of o)this.nodesInfo.push(new cA(I)),aA(I,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,o){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&o.push({footprint:d.footprint,id:e})}}update(e){const o=Object.keys(e).length!==0;if(o&&!this.stateDependentLayers.length)return;const u=o?this.stateDependentLayers:this.layers;if(!qa(e,this.states))for(const d of u)this.evaluate(d,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const d=u.node;this.uploaded?this.updatePbrBuffer(d):Ib(d,e,!0)}for(const u of o)uv(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let o=!1;if(!e.meshes)return o;for(const u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(e,o,u){const d=e.transform.projectionOptions,g=e.style.getBrightness(),y=this.brightness!==g;if(!this.uploaded||this.dirty||d.name!==this.projection.name||C_(u.paint.get("model-color").value,y)||C_(u.paint.get("model-color-mix-intensity").value,y)||C_(u.paint.get("model-roughness").value,y)||C_(u.paint.get("model-emissive-strength").value,y)||C_(u.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=d,this.brightness=g;const T=this.getNodesInfo();for(const C of T)C.state=null;return!0}return!1}evaluateTransform(e,o){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const g of u){const y=g.feature;g.evaluatedTranslation=o.paint.get("model-translation").evaluate(y,{},d),g.evaluatedScale=o.paint.get("model-scale").evaluate(y,{},d)}}evaluate(e,o){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const g=d.feature,y=o&&o[g.id];if(qa(y,d.state))continue;d.state=structuredClone(y);const T=d.node.meshes&&d.node.meshes[0].featureData,C=d.evaluatedColor[2],I=d.evaluatedRMEA[2],N=this.id.canonical;if(d.hasTranslucentParts=!1,T){for(let O=0;O<lA.length;O++){const L=lA[O];L.length&&(g.properties.part=L);const V=e.paint.get("model-color").evaluate(g,y,N).toPremultipliedRenderColor(null),H=e.paint.get("model-color-mix-intensity").evaluate(g,y,N);d.evaluatedColor[O]=[V.r,V.g,V.b,H],d.evaluatedRMEA[O][0]=e.paint.get("model-roughness").evaluate(g,y,N),d.evaluatedRMEA[O][2]=e.paint.get("model-emissive-strength").evaluate(g,y,N),d.evaluatedRMEA[O][3]=V.a,d.emissionHeightBasedParams[O]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,y,N),!d.hasTranslucentParts&&V.a<1&&(d.hasTranslucentParts=!0)}delete g.properties.part,s3(d,C!==d.evaluatedColor[2]||I!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(g,y,N);d.evaluatedTranslation=e.paint.get("model-translation").evaluate(g,y,N),d.evaluatedScale=e.paint.get("model-scale").evaluate(g,y,N),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,o,u,d){const g=e.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const y=ny.create(e,u,g);if(!y)return;this.modelTraits&ty.HasMapboxMeshFeatures&&this.updateDEM(e,y,u,d);for(const T of this.getNodesInfo()){const C=T.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const I=C.footprint.vertices;let N=y.getElevationAt(I[0].x,I[0].y,!0,!0);for(let O=1;O<I.length;O++)N=Math.min(N,y.getElevationAt(I[O].x,I[O].y,!0,!0));C.elevation=N}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=o}}updateDEM(e,o,u,d){let g=o._dem._modifiedForSources[d];if(g===void 0&&(o._dem._modifiedForSources[d]=[],g=o._dem._modifiedForSources[d]),g.includes(u.canonical))return;const y=o._dem.dim;g.push(u.canonical);let T=!1;for(const C of this.getNodesInfo()){const I=C.node;if(!I.footprint||!I.footprint.grid)continue;const N=I.footprint.grid,O=o.tileCoordToPixel(N.min.x,N.min.y),L=o.tileCoordToPixel(N.max.x,N.max.y),V=Math.min(Math.min(y-L.y,O.x),Math.min(O.y,y-L.x));if(V<0)continue;const H=Ee(V,2,5);let K=Math.max(0,O.x-H),te=Math.max(0,O.y-H),ae=Math.min(L.x+H,y-1),fe=Math.min(L.y+H,y-1);for(let me=te;me<=fe;++me)for(let _e=K;_e<=ae;++_e)Qm[me*y+_e]=255;let pe=0,Q=0;for(let me=0;me<N.cellsY;++me)for(let _e=0;_e<N.cellsX;++_e){if(!N.cells[me*N.cellsX+_e])continue;const De=o.tileCoordToPixel(N.min.x+_e/N.xScale,N.min.y+me/N.yScale),Pe=o.tileCoordToPixel(N.min.x+(_e+1)/N.xScale,N.min.y+(me+1)/N.yScale);for(let Oe=De.y;Oe<=Math.min(Pe.y+1,y-1);++Oe)for(let Ve=De.x;Ve<=Math.min(Pe.x+1,y-1);++Ve)Qm[Oe*y+Ve]===255&&(Qm[Oe*y+Ve]=0,pe+=o.getElevationAtPixel(Ve,Oe),Q++)}const he=pe/Q;K=Math.max(1,O.x-H),te=Math.max(1,O.y-H),ae=Math.min(L.x+H,y-2),fe=Math.min(L.y+H,y-2),T=!0;for(let me=te;me<=fe;++me)for(let _e=K;_e<=ae;++_e)Qm[me*y+_e]===0&&(kb[me*y+_e]=o._dem.set(_e,me,he));for(let me=1;me<H;++me){K=Math.max(1,O.x-me),te=Math.max(1,O.y-me),ae=Math.min(L.x+me,y-2),fe=Math.min(L.y+me,y-2);for(let _e=te;_e<=fe;++_e)for(let De=K;De<=ae;++De){const Pe=_e*y+De;if(Qm[Pe]===255){let Oe=0,Ve=0,tt=-1,vt=-1;for(let ft=-1;ft<=1;++ft)for(let xt=-1;xt<=1;++xt){const St=(_e+ft)*y+De+xt;if(Qm[St]>=me)continue;const rt=kb[St],_t=Math.abs(rt);_t>Ve&&(Oe=rt,Ve=_t,tt=xt,vt=ft)}if(Ve>.1){const ft=1-(me+.5*Math.abs(tt*vt))/H;let xt=o._dem.get(De,_e)+Oe*ft;const St=o._dem.get(De+tt,_e+vt),rt=o._dem.get(De-tt,_e-vt,!0);(xt-St)*(xt-rt)>0&&(xt=(St+rt)/2),kb[Pe]=o._dem.set(De,_e,xt),Qm[Pe]=me}}}}}T&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=Wa.now())}setFilter(e){this.filter=e?Kd(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Hr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const o of e)uv(o.node),Mb(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(e.toUnwrapped());for(const d of this.getNodesInfo()){const g=d.node.footprint;d.hiddenByReplacement=!!g&&!u.find(y=>y.footprint===g)}}getHeightAtTileCoord(e,o){const u=[],d=[0,0,0],g=W([]);for(const y of this.getNodesInfo()){const T=y.node.meshes[0],C=T.transformedAabb;if(e<C.min[0]||o<C.min[1]||e>C.max[0]||o>C.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};re(g,y.node.matrix),d[0]=e,d[1]=o,An(d,d,g);const I=(d[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*Jm|0,N=Math.min(63,(d[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*Jm|0)*Jm+Math.min(63,I),O=T.heightmap[N];if(!(O<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:O,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Ot(e,o),new Ot(e,o),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function C_(a,e){return a instanceof Kc&&!a.isLightConstant&&e}function i3(a,e,o,u,d,g,y,T){let C=(61440&e|(61440&e)>>4)>>8,I=(3840&e|(3840&e)>>4)>>4,N=240&e|(240&e)>>4;o[3]>0&&(C=Mn(C,255*o[0],o[3]),I=Mn(I,255*o[1],o[3]),N=Mn(N,255*o[2],o[3]));const O=C<<8|I,L=N<<8|Math.floor(255*u[3]),V=function(me){const _e=Ee(me,0,2);return Math.min(Math.round(.5*_e*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],H=Ee(d[0],0,1),K=Ee(d[1],0,1),te=Ee(d[2],0,1),ae=Ee(d[3],0,1);let fe,pe,Q,he;if(H!==K&&y!==g&&K!==H){const me=y-g;pe=1/(me*(K-H)),Q=-(g+me*H)/(me*(K-H));const _e=Ee(d[4],-1,1);he=Math.pow(10,_e),fe=255*te<<8|255*ae}else fe=65535,pe=0,Q=1,he=1;if(a.emplaceBack(O,L,V,fe,pe,Q,he),T){const me=T.length;T.clear();for(let _e=0;_e<me;_e++)T.emplaceBack(O,L,V,fe,pe,Q,he)}}function s3(a,e,o){const u=a.node;let d=0;const g=o&ty.HasMeshoptCompression;for(const y of u.meshes){if(u.lights&&u.lightMeshIndex===d||!y.featureData)continue;y.featureArray=new ed,y.featureArray.reserve(y.featureData.length);let T=e;for(const C of y.featureData){const I=g?65535&C:C>>16&65535,N=g?C>>16&65535:65535&C,O=(15&N)<8?15&N:0,L=a.evaluatedRMEA[O],V=a.evaluatedColor[O],H=a.emissionHeightBasedParams[O];let K;if(T&&O===2&&u.lights&&(K=new ed,K.resize(10*u.lights.length)),i3(y.featureArray,I,V,L,H,y.aabb.min[2],y.aabb.max[2],K),K&&T){T=!1;const te=u.meshes[u.lightMeshIndex];te.featureArray=K,te.featureArray._trim()}}y.featureArray._trim(),d++}}function uA(a,e,o,u){const d=1<<a.z;e.lat=Be((u/jt+a.y)/d),e.lng=Re((o/jt+a.x)/d)}function o3(a,e,o,u){const d=a.getNodesInfo()[e];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let g=Number.MAX_VALUE;const y=d.node,T=o.tile,C=u.calculatePosMatrix(T.tileID.toUnwrapped(),u.worldSize),I=d.evaluatedScale;let N=0;u.elevation&&y.elevation&&(N=y.elevation*u.elevation.exaggeration()),Me(C,C,[(y.anchor?y.anchor[0]:0)*(I[0]-1),(y.anchor?y.anchor[1]:0)*(I[1]-1),N]),Fe(C,C,I);const O=o.queryGeometry,L=O.isPointQuery()?O.screenBounds:O.screenGeometry,V=function(K){const te=de([],C,K.matrix);de(te,u.expandedFarZProjMatrix,te);for(let ae=0;ae<K.meshes.length;++ae){const fe=K.meshes[ae];if(ae===K.lightMeshIndex)continue;const pe=QC(L,u,te,fe.aabb);pe!=null&&(g=Math.min(pe,g))}if(K.children)for(const ae of K.children)V(ae)};if(V(y),g===Number.MAX_VALUE)return;const H=new ce(0,0);return uA(T.tileID.canonical,H,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:g,position:H,feature:d.feature}}Zt(hv,"Tiled3dModelBucket",{omit:["layers"]}),Zt(cA,"Tiled3dModelFeature");const a3={circle:class extends lo{constructor(a,e,o,u){super(a,{layout:Hg||(Hg=new Di({"circle-sort-key":new zt($e.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt($e.layout_circle["circle-elevation-reference"]),visibility:new Tt($e.layout_circle.visibility)})),paint:Hm||(Hm=new Di({"circle-radius":new zt($e.paint_circle["circle-radius"]),"circle-color":new zt($e.paint_circle["circle-color"]),"circle-blur":new zt($e.paint_circle["circle-blur"]),"circle-opacity":new zt($e.paint_circle["circle-opacity"]),"circle-translate":new Tt($e.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt($e.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}createBucket(a){return new da(a)}queryRadius(a){const e=a;return Sp("circle-radius",this,e)+Sp("circle-stroke-width",this,e)+Um(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,o,u,d,g,y,T){const C=$m(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return w2(a,u,g,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,o){const u=b2(this);return{config:new Po(this,{zoom:e,lut:o}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends lo{createBucket(a){return new T2(a)}constructor(a,e,o,u){super(a,{layout:E2||(E2=new Di({visibility:new Tt($e.layout_heatmap.visibility)})),paint:C2||(C2=new Di({"heatmap-radius":new zt($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pc($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt($e.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=e_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Sp("heatmap-radius",this,a)}queryIntersectsFeature(a,e,o,u,d,g,y,T){const C=this.paint.get("heatmap-radius").evaluate(e,o);return w2(a,u,g,y,T,!0,!0,new Ot(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,o){return a==="heatmap"?{config:new Po(this,{zoom:e,lut:o}),overrideFog:!1}:{}}},hillshade:class extends lo{constructor(a,e,o,u){super(a,{layout:A2||(A2=new Di({visibility:new Tt($e.layout_hillshade.visibility)})),paint:I2||(I2=new Di({"hillshade-illumination-direction":new Tt($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt($e.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,o){return{overrideFog:!1}}},fill:class extends lo{constructor(a,e,o,u){super(a,{layout:$2||($2=new Di({"fill-sort-key":new zt($e.layout_fill["fill-sort-key"]),visibility:new Tt($e.layout_fill.visibility),"fill-elevation-reference":new Tt($e.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new zt($e.layout_fill["fill-construct-bridge-guard-rail"])})),paint:H2||(H2=new Di({"fill-antialias":new Tt($e.paint_fill["fill-antialias"]),"fill-opacity":new zt($e.paint_fill["fill-opacity"]),"fill-color":new zt($e.paint_fill["fill-color"]),"fill-outline-color":new zt($e.paint_fill["fill-outline-color"]),"fill-translate":new Tt($e.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new zt($e.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt($e.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt($e.paint_fill["fill-emissive-strength"]),"fill-z-offset":new zt($e.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new zt($e.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new zt($e.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(a,e,o){return{config:new Po(this,{zoom:e,lut:o}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new V1(a)}queryRadius(){return Um(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,o,u,d,g){return!a.queryGeometry.isAboveHorizon&&fa($g(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends lo{constructor(a,e,o,u){super(a,{layout:mE||(mE=new Di({visibility:new Tt($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:gE||(gE=new Di({"fill-extrusion-opacity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zt($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt($e["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new zt($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt($e["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt($e["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zt($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new zt($e["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt($e["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Lx(a)}queryRadius(){return Um(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,o,u,d,g,y,T,C){const I=$m(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(e,o),O=this.paint.get("fill-extrusion-base").evaluate(e,o),L=[0,0],V=T&&g.elevation,H=g.elevation?g.elevation.exaggeration():1,K=a.tile.getBucket(this);if(V&&K instanceof Lx){const Q=K.centroidVertexArray,he=C+1;he<Q.length&&(L[0]=Q.geta_centroid_pos0(he),L[1]=Q.geta_centroid_pos1(he))}if(L[0]===0&&L[1]===1)return!1;g.projection.name==="globe"&&(u=pE([u],[new Ot(0,0),new Ot(jt,jt)],a.tileID.canonical).map(Q=>Q.polygon).flat());const te=V?T:null,[ae,fe]=function(Q,he,me,_e,De,Pe,Oe,Ve,tt,vt,ft){return Q.projection.name==="globe"?function(xt,St,rt,_t,et,nt,Mt,Pt,_n,nn,$t){const At=[],Gn=[],tn=xt.projection.upVectorScale($t,xt.center.lat,xt.worldSize).metersToTile,sn=[0,0,0,1],jn=[0,0,0,1],nr=(ur,ir,hr,qr)=>{ur[0]=ir,ur[1]=hr,ur[2]=qr,ur[3]=1},Kn=fE();rt>0&&(rt+=Kn),_t+=Kn;for(const ur of St){const ir=[],hr=[];for(const qr of ur){const Si=qr.x+et.x,ye=qr.y+et.y,Se=xt.projection.projectTilePoint(Si,ye,$t),ot=xt.projection.upVector($t,qr.x,qr.y);let Lt=rt,Gt=_t;if(Mt){const Ut=wE(Si,ye,rt,_t,Mt,Pt,_n,nn);Lt+=Ut.base,Gt+=Ut.top}rt!==0?nr(sn,Se.x+ot[0]*tn*Lt,Se.y+ot[1]*tn*Lt,Se.z+ot[2]*tn*Lt):nr(sn,Se.x,Se.y,Se.z),nr(jn,Se.x+ot[0]*tn*Gt,Se.y+ot[1]*tn*Gt,Se.z+ot[2]*tn*Gt),An(sn,sn,nt),An(jn,jn,nt),ir.push(new Zm(sn[0],sn[1],sn[2])),hr.push(new Zm(jn[0],jn[1],jn[2]))}At.push(ir),Gn.push(hr)}return[At,Gn]}(Q,he,me,_e,De,Pe,Oe,Ve,tt,vt,ft):Oe?function(xt,St,rt,_t,et,nt,Mt,Pt,_n){const nn=[],$t=[],At=[0,0,0,1];for(const Gn of xt){const tn=[],sn=[];for(const jn of Gn){const nr=jn.x+_t.x,Kn=jn.y+_t.y,ur=wE(nr,Kn,St,rt,nt,Mt,Pt,_n);At[0]=nr,At[1]=Kn,At[2]=ur.base,At[3]=1,zi(At,At,et),At[3]=Math.max(At[3],1e-5);const ir=new Zm(At[0]/At[3],At[1]/At[3],At[2]/At[3]);At[0]=nr,At[1]=Kn,At[2]=ur.top,At[3]=1,zi(At,At,et),At[3]=Math.max(At[3],1e-5);const hr=new Zm(At[0]/At[3],At[1]/At[3],At[2]/At[3]);tn.push(ir),sn.push(hr)}nn.push(tn),$t.push(sn)}return[nn,$t]}(he,me,_e,De,Pe,Oe,Ve,tt,vt):function(xt,St,rt,_t,et){const nt=[],Mt=[],Pt=et[8]*St,_n=et[9]*St,nn=et[10]*St,$t=et[11]*St,At=et[8]*rt,Gn=et[9]*rt,tn=et[10]*rt,sn=et[11]*rt;for(const jn of xt){const nr=[],Kn=[];for(const ur of jn){const ir=ur.x+_t.x,hr=ur.y+_t.y,qr=et[0]*ir+et[4]*hr+et[12],Si=et[1]*ir+et[5]*hr+et[13],ye=et[2]*ir+et[6]*hr+et[14],Se=et[3]*ir+et[7]*hr+et[15],ot=qr+Pt,Lt=Si+_n,Gt=ye+nn,Ut=Math.max(Se+$t,1e-5),en=qr+At,zn=Si+Gn,gr=ye+tn,yr=Math.max(Se+sn,1e-5);nr.push(new Zm(ot/Ut,Lt/Ut,Gt/Ut)),Kn.push(new Zm(en/yr,zn/yr,gr/yr))}nt.push(nr),Mt.push(Kn)}return[nt,Mt]}(he,me,_e,De,Pe)}(g,u,O,N,I,y,te,L,H,g.center.lat,a.tileID.canonical),pe=a.queryGeometry;return function(Q,he,me){let _e=1/0;fa(me,he)&&(_e=bE(me,he[0]));for(let De=0;De<he.length;De++){const Pe=he[De],Oe=Q[De];for(let Ve=0;Ve<Pe.length-1;Ve++){const tt=Pe[Ve],vt=[tt,Pe[Ve+1],Oe[Ve+1],Oe[Ve],tt];Xo(me,vt)&&(_e=Math.min(_e,bE(me,vt)))}}return _e!==1/0&&_e}(ae,fe,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},building:class extends lo{constructor(a,e,o,u){super(a,{layout:DE||(DE=new Di({visibility:new Tt($e.layout_building.visibility),"building-roof-shape":new zt($e.layout_building["building-roof-shape"]),"building-height":new zt($e.layout_building["building-height"]),"building-base":new zt($e.layout_building["building-base"])})),paint:OE||(OE=new Di({"building-opacity":new Tt($e.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Tt($e.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt($e.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt($e.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt($e.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt($e.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt($e.paint_building["building-cast-shadows"]),"building-color":new zt($e.paint_building["building-color"]),"building-emissive-strength":new zt($e.paint_building["building-emissive-strength"]),"building-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new NE(a)}},line:class extends lo{constructor(a,e,o,u){const d=GE();super(a,d,e,o,u),d.layout&&(this.layout=new ml(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(p_)return p_;const o=GE();return p_=new ij(o.paint.properties["line-width"].specification),p_.useIntegerZoom=!0,p_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new eb(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,o){const u=$E(this);return{config:new Po(this,{zoom:e,lut:o}),defines:u,overrideFog:!1}}queryRadius(a){const e=a,o=qE(Sp("line-width",this,e),Sp("line-gap-width",this,e)),u=Sp("line-offset",this,e);return o/2+Math.abs(u)+Um(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,o,u,d,g){if(a.queryGeometry.isAboveHorizon)return!1;const y=$g(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=a.pixelToTileUnitsFactor/2*qE(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),C=this.paint.get("line-offset").evaluate(e,o);return C&&(u=function(I,N){const O=[],L=new Ot(0,0);for(let V=0;V<I.length;V++){const H=I[V],K=[];for(let te=0;te<H.length;te++){const ae=H[te],fe=H[te+1],pe=te===0?L:ae.sub(H[te-1])._unit()._perp(),Q=te===H.length-1?L:fe.sub(ae)._unit()._perp(),he=pe._add(Q)._unit();he._mult(1/(he.x*Q.x+he.y*Q.y)),K.push(he._mult(N)._add(ae))}O.push(K)}return O}(u,C*a.pixelToTileUnitsFactor)),function(I,N,O){for(let L=0;L<N.length;L++){const V=N[L];if(I.length>=3){for(let H=0;H<V.length;H++)if(xl(I,V[H]))return!0}if(pa(I,V,O))return!0}return!1}(y,u,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:rv,background:class extends lo{constructor(a,e,o,u){super(a,{layout:LC||(LC=new Di({visibility:new Tt($e.layout_background.visibility)})),paint:zC||(zC=new Di({"background-pitch-alignment":new Tt($e.paint_background["background-pitch-alignment"]),"background-color":new Tt($e.paint_background["background-color"]),"background-pattern":new Tt($e.paint_background["background-pattern"]),"background-opacity":new Tt($e.paint_background["background-opacity"]),"background-emissive-strength":new Tt($e.paint_background["background-emissive-strength"]),"background-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,o){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:UC,"raster-particle":ZC,sky:class extends lo{constructor(a,e,o,u){super(a,{layout:GC||(GC=new Di({visibility:new Tt($e.layout_sky.visibility)})),paint:qC||(qC=new Di({"sky-type":new Tt($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new pc($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt($e.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=e_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,g=a.style.light,y=g.properties.get("position");return d&&g.properties.get("anchor")==="viewport"&&Hn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Sb(y.azimuthal,90-y.polar,e):Sb(u[0],90-u[1],e)}const o=this.paint.get("sky-gradient-center");return Sb(o[0],90-o[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends lo{constructor(a,e,o,u){super(a,{paint:WC||(WC=new Di({}))},e,null)}},model:class extends lo{constructor(a,e,o,u){super(a,{layout:rA||(rA=new Di({visibility:new Tt($e.layout_model.visibility),"model-id":new zt($e.layout_model["model-id"])})),paint:iA||(iA=new Di({"model-opacity":new zt($e.paint_model["model-opacity"]),"model-rotation":new zt($e.paint_model["model-rotation"]),"model-scale":new zt($e.paint_model["model-scale"]),"model-translation":new zt($e.paint_model["model-translation"]),"model-color":new zt($e.paint_model["model-color"]),"model-color-mix-intensity":new zt($e.paint_model["model-color-mix-intensity"]),"model-type":new Tt($e.paint_model["model-type"]),"model-cast-shadows":new Tt($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zt($e.paint_model["model-emissive-strength"]),"model-roughness":new zt($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zt($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt($e.paint_model["model-front-cutoff"]),"model-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},e,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Ab(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof hv?jt-1:0}queryIntersectsFeature(a,e,o,u,d,g){if(!this.modelManager)return!1;const y=this.modelManager,T=a.tile.getBucket(this);if(!(T&&T instanceof Ab))return!1;for(const C in T.instancesPerModel){const I=T.instancesPerModel[C],N=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(I.idToFeaturesIndex.hasOwnProperty(N)){const O=I.features[I.idToFeaturesIndex[N]],L=y.getModel(C,this.scope);if(!L)return!1;let V=Y();const H=new ce(0,0),K=T.canonical;let te=Number.MAX_VALUE;for(let ae=0;ae<O.instancedDataCount;++ae){const fe=16*(O.instancedDataOffset+ae),pe=I.instancedDataArray.float32,Q=[pe[fe+4],pe[fe+5],pe[fe+6]];uA(K,H,pe[fe],0|pe[fe+1]),sA(V,L,g,H,O.rotation,O.scale,Q,!1,!1,!1),g.projection.name==="globe"&&(V=Eb(V,g));const he=de([],g.projMatrix,V),me=a.queryGeometry,_e=QC(me.isPointQuery()?me.screenBounds:me.screenGeometry,g,he,L.aabb);_e!=null&&(te=Math.min(_e,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(a,e,o){return!(!this.layout||e.isDataDriven()||o.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Yc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends lo{constructor(a,e,o,u){super(a,{layout:G2||(G2=new Di({"clip-layer-types":new Tt($e.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt($e.layout_clip["clip-layer-scope"])})),paint:q2||(q2=new Di({}))},e,o,u)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new W2(a)}is3D(a){return!0}}},Pb=new Ir(0,0,0),Rb={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Nb={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},dv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},l3={PAINT_ORDER_FILL_AND_STROKE:1},A_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},hA={MASK_TYPE_LUMINANCE:1};function c3(a,e,o){a===1&&e.icons.push(function(u,d){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:y}=g;if(y.content_area){const{content_area:T}=y;T.top==null&&(T.top=T.left),T.width==null&&(T.width=g.usvg_tree.width),T.height==null&&(T.height=T.width)}return y.stretch_x&&y.stretch_x.length&&dA(y,"x"),y.stretch_y&&y.stretch_y.length&&dA(y,"y"),g}(u.readFields(u3,{name:void 0},d))}(o,o.readVarint()+o.pos))}function dA(a,e){const o=[],u=a[`stretch_${e}`];let d=null;for(let g=0;g<u.length;g++)d===null?d=o.length===0?u[0]:o[o.length-1][1]+u[g]:(o.push([d,d+u[g]]),d=null);a[`stretch_${e}_areas`]=o}function u3(a,e,o){a===1?e.name=o.readString():a===2?e.metadata=function(u,d){return u.readFields(h3,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)}(o,o.readVarint()+o.pos):a===3&&(e.usvg_tree=function(u,d){return u.readFields(p3,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)}(o,o.readVarint()+o.pos),e.data="usvg_tree")}function h3(a,e,o){a===1?e.stretch_x=o.readPackedVarint():a===2?e.stretch_y=o.readPackedVarint():a===3?e.content_area=function(u,d){return u.readFields(d3,{left:0},d)}(o,o.readVarint()+o.pos):a===4&&e.variables.push(function(u,d){return u.readFields(f3,{name:void 0},d)}(o,o.readVarint()+o.pos))}function d3(a,e,o){a===1?e.left=o.readVarint():a===2?e.width=o.readVarint():a===3?e.top=o.readVarint():a===4&&(e.height=o.readVarint())}function f3(a,e,o){a===1?e.name=o.readString():a===2&&(e.rgb_color=mv(o.readVarint()),e.value="rgb_color")}function p3(a,e,o){a===1?e.width=e.height=o.readVarint():a===2?e.height=o.readVarint():a===3?e.children.push(fv(o,o.readVarint()+o.pos)):a===4?e.linear_gradients.push(function(u,d){return u.readFields(b3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)}(o,o.readVarint()+o.pos)):a===5?e.radial_gradients.push(function(u,d){return u.readFields(S3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)}(o,o.readVarint()+o.pos)):a===7?e.clip_paths.push(function(u,d){return u.readFields(T3,{children:[]},d)}(o,o.readVarint()+o.pos)):a===8&&e.masks.push(function(u,d){const g=u.readFields(E3,{left:0,width:20,mask_type:hA.MASK_TYPE_LUMINANCE,children:[]},d);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(o,o.readVarint()+o.pos))}function fv(a,e){return a.readFields(m3,{},e)}function m3(a,e,o){a===1?(e.group=function(u,d){return u.readFields(g3,{opacity:255,children:[]},d)}(o,o.readVarint()+o.pos),e.node="group"):a===2&&(e.path=function(u,d){return u.readFields(_3,{paint_order:1,commands:[],step:1,diffs:[],rule:Rb.PATH_RULE_NON_ZERO},d)}(o,o.readVarint()+o.pos),e.node="path")}function g3(a,e,o){a===1?e.transform=pv(o,o.readVarint()+o.pos):a===2?e.opacity=o.readVarint():a===5?e.clip_path_idx=o.readVarint():a===6?e.mask_idx=o.readVarint():a===7&&e.children.push(fv(o,o.readVarint()+o.pos))}function pv(a,e){return a.readFields(y3,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function y3(a,e,o){a===1?e.sx=o.readFloat():a===2?e.ky=o.readFloat():a===3?e.kx=o.readFloat():a===4?e.sy=o.readFloat():a===5?e.tx=o.readFloat():a===6&&(e.ty=o.readFloat())}function _3(a,e,o){a===1?e.fill=function(u,d){return u.readFields(x3,{rgb_color:Pb,paint:"rgb_color",opacity:255},d)}(o,o.readVarint()+o.pos):a===2?e.stroke=function(u,d){return u.readFields(v3,{rgb_color:Pb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)}(o,o.readVarint()+o.pos):a===3?e.paint_order=o.readVarint():a===5?o.readPackedVarint(e.commands):a===6?e.step=o.readFloat():a===7?o.readPackedSVarint(e.diffs):a===8&&(e.rule=o.readVarint())}function x3(a,e,o){a===1?(e.rgb_color=mv(o.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=o.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=o.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=o.readVarint())}function mv(a){return new Ir((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function v3(a,e,o){a===1?(e.rgb_color=mv(o.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=o.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=o.readVarint(),e.paint="radial_gradient_idx"):a===5?o.readPackedFloat(e.dasharray):a===6?e.dashoffset=o.readFloat():a===7?e.miterlimit=o.readFloat():a===8?e.opacity=o.readVarint():a===9?e.width=o.readFloat():a===10?e.linecap=o.readVarint():a===11&&(e.linejoin=o.readVarint())}function b3(a,e,o){a===1?e.transform=pv(o,o.readVarint()+o.pos):a===2?e.spread_method=o.readVarint():a===3?e.stops.push(fA(o,o.readVarint()+o.pos)):a===4?e.x1=o.readFloat():a===5?e.y1=o.readFloat():a===6?e.x2=o.readFloat():a===7&&(e.y2=o.readFloat())}function fA(a,e){return a.readFields(w3,{offset:0,opacity:255,rgb_color:Pb},e)}function w3(a,e,o){a===1?e.offset=o.readFloat():a===2?e.opacity=o.readVarint():a===3&&(e.rgb_color=mv(o.readVarint()))}function S3(a,e,o){a===1?e.transform=pv(o,o.readVarint()+o.pos):a===2?e.spread_method=o.readVarint():a===3?e.stops.push(fA(o,o.readVarint()+o.pos)):a===4?e.cx=o.readFloat():a===5?e.cy=o.readFloat():a===6?e.r=o.readFloat():a===7?e.fx=o.readFloat():a===8?e.fy=o.readFloat():a===9&&(e.fr=o.readFloat())}function T3(a,e,o){a===1?e.transform=pv(o,o.readVarint()+o.pos):a===2?e.clip_path_idx=o.readVarint():a===3&&e.children.push(fv(o,o.readVarint()+o.pos))}function E3(a,e,o){a===1?e.left=e.top=o.readFloat():a===2?e.width=e.height=o.readFloat():a===3?e.top=o.readFloat():a===4?e.height=o.readFloat():a===5?e.mask_type=o.readVarint():a===6?e.mask_idx=o.readVarint():a===7&&e.children.push(fv(o,o.readVarint()+o.pos))}class C3{static calculate(e={},o=[]){const u=new Map,d=new Map;if(Object.keys(e).length===0)return u;o.forEach(g=>{d.set(g.name,g.rgb_color||new Ir(0,0,0))});for(const[g,y]of Object.entries(e))d.has(g)?u.set(d.get(g).toString(),y):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function ry(a,e=255,o){const u=e/255,d=a.toString(),g=o.has(d)?o.get(d).clone():a.clone();return g.a*=u,g.toString()}function I_(a,e){if(!yh()){const o=document.createElement("canvas");return o.width=a,o.height=e,o}return new OffscreenCanvas(a,e)}function A3(a,e){const o=C3.calculate(e.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,d=u.width,g=u.height,y=e.transform?e.transform:new DOMMatrix,T=Math.max(1,Math.round(d*y.a)),C=Math.max(1,Math.round(g*y.d)),I=new DOMMatrix([T/d,0,0,C/g,0,0]),N=I_(T,C).getContext("2d");return Db(N,I,u,u,o),N.getImageData(0,0,T,C)}function Db(a,e,o,u,d){for(const g of u.children)pA(a,e,o,g,d)}function pA(a,e,o,u,d){u.group?(a.save(),function(g,y,T,C,I){const N=C.mask_idx!=null?T.masks[C.mask_idx]:null,O=C.clip_path_idx!=null?T.clip_paths[C.clip_path_idx]:null;if(C.transform&&(y=iy(C.transform).preMultiplySelf(y)),!function(H,K,te){return H.opacity!==255||K||te}(C,O!=null,N!=null))return void Db(g,y,T,C,I);const L=I_(g.canvas.width,g.canvas.height),V=L.getContext("2d");Db(V,y,T,C,I),O&&bA(V,y,T,O),N&&wA(V,y,T,N,I),g.globalAlpha=C.opacity/255,g.drawImage(L,0,0)}(a,e,o,u.group,d),a.restore()):u.path&&(a.save(),function(g,y,T,C,I){g.setTransform(y),C.paint_order===l3.PAINT_ORDER_FILL_AND_STROKE?(mA(g,T,C,I),yA(g,T,C,I)):(yA(g,T,C,I),mA(g,T,C,I))}(a,e,o,u.path,d),a.restore())}function mA(a,e,o,u){const d=o.fill;if(!d)return;const g=d.opacity/255;switch(a.save(),a.beginPath(),SA(o,a),d.paint){case"rgb_color":a.fillStyle=ry(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const y=e.linear_gradients[d.linear_gradient_idx];y.transform&&a.setTransform(iy(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=_A(a,y,g,u);break}case"radial_gradient_idx":{const y=e.radial_gradients[d.radial_gradient_idx];y.transform&&a.setTransform(iy(y.transform).preMultiplySelf(a.getTransform())),a.fillStyle=xA(a,y,g,u)}}a.fill(gA(o)),a.restore()}function gA(a){return a.rule===Rb.PATH_RULE_NON_ZERO?"nonzero":a.rule===Rb.PATH_RULE_EVEN_ODD?"evenodd":void 0}function yA(a,e,o,u){const d=o.stroke;if(!d)return;const g=TA(o);a.lineWidth=d.width,a.miterLimit=d.miterlimit,a.setLineDash(d.dasharray),a.lineDashOffset=d.dashoffset;const y=d.opacity/255;switch(d.paint){case"rgb_color":a.strokeStyle=ry(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=_A(a,e.linear_gradients[d.linear_gradient_idx],y,u,!0);break;case"radial_gradient_idx":a.strokeStyle=xA(a,e.radial_gradients[d.radial_gradient_idx],y,u,!0)}switch(d.linejoin){case dv.LINE_JOIN_MITER_CLIP:case dv.LINE_JOIN_MITER:a.lineJoin="miter";break;case dv.LINE_JOIN_ROUND:a.lineJoin="round";break;case dv.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(d.linecap){case Nb.LINE_CAP_BUTT:a.lineCap="butt";break;case Nb.LINE_CAP_ROUND:a.lineCap="round";break;case Nb.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function _A(a,e,o,u,d=!1){if(e.stops.length===1){const L=e.stops[0];return ry(L.rgb_color,L.opacity*o,u)}const{x1:g,y1:y,x2:T,y2:C}=e;let I=new DOMPoint(g,y),N=new DOMPoint(T,C);if(d){const L=iy(e.transform);I=L.transformPoint(I),N=L.transformPoint(N)}const O=a.createLinearGradient(I.x,I.y,N.x,N.y);for(const L of e.stops)O.addColorStop(L.offset,ry(L.rgb_color,L.opacity*o,u));return O}function xA(a,e,o,u,d=!1){if(e.stops.length===1){const ae=e.stops[0];return ry(ae.rgb_color,ae.opacity*o,u)}const g=iy(e.transform),{fx:y,fy:T,fr:C,cx:I,cy:N,r:O}=e;let L=new DOMPoint(y,T),V=new DOMPoint(I,N),H=C,K=O;if(d){L=g.transformPoint(L),V=g.transformPoint(V);const ae=(g.a+g.d)/2;H=C*ae,K=e.r*ae}const te=a.createRadialGradient(L.x,L.y,H,V.x,V.y,K);for(const ae of e.stops)te.addColorStop(ae.offset,ry(ae.rgb_color,ae.opacity*o,u));return te}function vA(a,e,o,u){const d=u.transform?iy(u.transform).preMultiplySelf(e):e,g=I_(a.canvas.width,a.canvas.height),y=g.getContext("2d");for(const C of u.children)if(C.group)vA(y,d,o,C.group);else if(C.path){const I=C.path,N=new Path2D;N.addPath(TA(I),d),y.fill(N,gA(I))}const T=u.clip_path_idx!=null?o.clip_paths[u.clip_path_idx]:null;T&&bA(y,d,o,T),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function bA(a,e,o,u){const d=I_(a.canvas.width,a.canvas.height);vA(d.getContext("2d"),e,o,u),a.globalCompositeOperation="destination-in",a.drawImage(d,0,0)}function wA(a,e,o,u,d){if(u.children.length===0)return;const g=u.mask_idx!=null?o.masks[u.mask_idx]:null;g&&wA(a,e,o,g,d);const y=a.canvas.width,T=a.canvas.height,C=I_(y,T),I=C.getContext("2d"),N=u.width,O=u.height,L=u.left,V=u.top,H=new Path2D,K=new Path2D;K.rect(L,V,N,O),H.addPath(K,e),I.clip(H);for(const fe of u.children)pA(I,e,o,fe,d);const te=I.getImageData(0,0,y,T),ae=te.data;if(u.mask_type===hA.MASK_TYPE_LUMINANCE)for(let fe=0;fe<ae.length;fe+=4)ae[fe+3]=ae[fe+3]/255*(.2126*ae[fe]+.7152*ae[fe+1]+.0722*ae[fe+2]);I.putImageData(te,0,0),a.globalCompositeOperation="destination-in",a.drawImage(C,0,0)}function iy(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function SA(a,e){const o=a.step;let u=a.diffs[0]*o,d=a.diffs[1]*o;e.moveTo(u,d);for(let g=0,y=2;g<a.commands.length;g++)switch(a.commands[g]){case A_.PATH_COMMAND_MOVE:u+=a.diffs[y++]*o,d+=a.diffs[y++]*o,e.moveTo(u,d);break;case A_.PATH_COMMAND_LINE:u+=a.diffs[y++]*o,d+=a.diffs[y++]*o,e.lineTo(u,d);break;case A_.PATH_COMMAND_QUAD:{const T=u+a.diffs[y++]*o,C=d+a.diffs[y++]*o;u=T+a.diffs[y++]*o,d=C+a.diffs[y++]*o,e.quadraticCurveTo(T,C,u,d);break}case A_.PATH_COMMAND_CUBIC:{const T=u+a.diffs[y++]*o,C=d+a.diffs[y++]*o,I=T+a.diffs[y++]*o,N=C+a.diffs[y++]*o;u=I+a.diffs[y++]*o,d=N+a.diffs[y++]*o,e.bezierCurveTo(T,C,I,N,u,d);break}case A_.PATH_COMMAND_CLOSE:e.closePath()}return e}function TA(a){return SA(a,new Path2D)}class gv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const o=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,o),o}put(e,o){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,o)}delete(e){this.cache.delete(e)}}Zt(gv,"LRUCache");class Ob{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Do(e,e.data)}getFromCache(e,o,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new gv(150)),this.cacheMap.get(u).get(Ul(e.toString(),o))}setInCache(e,o,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new gv(150));const g=this.cacheDependenciesMap.get(d),y=Ul(e.id.toString(),u);g.get(y)||g.set(y,new Set);const T=this.cacheMap.get(d),C=e.toString();g.get(y).add(C),T.put(Ul(e.toString(),u),o)}removeImagesFromCacheByIds(e,o,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const y of e){const T=Ul(y.toString(),o);if(g.has(T)){for(const C of g.get(T))d.delete(C);g.delete(T)}}}rasterize(e,o,u,d,g=A3){const y=this.getFromCache(e,u,d);if(y)return y.clone();const T=g(o.icon,e.options),C=Ob._getImage(T);return this.setInCache(e,C,u,d),C.clone()}}class EA{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const u=this.toIdx(e,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function CA(a,e,o,u){let d=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(u[y])<1e-15){if(o[y]<a[y]||o[y]>e[y])return null}else{const T=1/u[y];let C=(a[y]-o[y])*T,I=(e[y]-o[y])*T;if(C>I){const N=C;C=I,I=N}if(C>d&&(d=C),I<g&&(g=I),d>g)return null}return d}function AA(a,e,o,u,d,g,y,T,C,I,N){const O=u-a,L=d-e,V=g-o,H=y-a,K=T-e,te=C-o,ae=N[1]*te-N[2]*K,fe=N[2]*H-N[0]*te,pe=N[0]*K-N[1]*H,Q=O*ae+L*fe+V*pe;if(Math.abs(Q)<1e-15)return null;const he=1/Q,me=I[0]-a,_e=I[1]-e,De=I[2]-o,Pe=(me*ae+_e*fe+De*pe)*he;if(Pe<0||Pe>1)return null;const Oe=_e*V-De*L,Ve=De*O-me*V,tt=me*L-_e*O,vt=(N[0]*Oe+N[1]*Ve+N[2]*tt)*he;return vt<0||Pe+vt>1?null:(H*Oe+K*Ve+te*tt)*he}function IA(a,e,o){return(a-e)/(o-e)}function MA(a,e,o,u,d,g,y,T,C){const I=1<<o,N=g-u,O=y-d,L=(a+1)/I*N+u,V=(e+0)/I*O+d,H=(e+1)/I*O+d;T[0]=(a+0)/I*N+u,T[1]=V,C[0]=L,C[1]=H}class kA{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(g){const y=Math.ceil(Math.log2(g.dim/8)),T=[];let C=Math.ceil(Math.pow(2,y));const I=1/C,N=(V,H,K,te,ae)=>{const fe=te?1:0,pe=(V+1)*K-fe,Q=H*K,he=(H+1)*K-fe;ae[0]=V*K,ae[1]=Q,ae[2]=pe,ae[3]=he};let O=new EA(C);const L=[];for(let V=0;V<C*C;V++){N(V%C,Math.floor(V/C),I,!1,L);const H=Mp(L[0],L[1],g),K=Mp(L[2],L[1],g),te=Mp(L[2],L[3],g),ae=Mp(L[0],L[3],g);O.minimums.push(Math.min(H,K,te,ae)),O.maximums.push(Math.max(H,K,te,ae)),O.leaves.push(1)}for(T.push(O),C/=2;C>=1;C/=2){const V=T[T.length-1];O=new EA(C);for(let H=0;H<C*C;H++){N(H%C,Math.floor(H/C),2,!0,L);const K=V.getElevation(L[0],L[1]),te=V.getElevation(L[2],L[1]),ae=V.getElevation(L[2],L[3]),fe=V.getElevation(L[0],L[3]),pe=V.isLeaf(L[0],L[1]),Q=V.isLeaf(L[2],L[1]),he=V.isLeaf(L[2],L[3]),me=V.isLeaf(L[0],L[3]),_e=Math.min(K.min,te.min,ae.min,fe.min),De=Math.max(K.max,te.max,ae.max,fe.max),Pe=pe&&Q&&he&&me;O.maximums.push(De),O.minimums.push(_e),O.leaves.push(De-_e<=5&&Pe?1:0)}T.push(O)}return T}(this.dem),u=o.length-1,d=o[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(e,o,u,d,g,y,T=1){return CA([e,o,-100],[u,d,this.maximums[0]*T],g,y)}raycast(e,o,u,d,g,y,T=1){if(!this.nodeCount)return null;const C=this.raycastRoot(e,o,u,d,g,y,T);if(C==null)return null;const I=[],N=[],O=[],L=[],V=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:H,t:K,nodex:te,nodey:ae,depth:fe}=V.pop();if(this.leaves[H]){MA(te,ae,fe,e,o,u,d,O,L);const Q=1<<fe,he=(te+0)/Q,me=(te+1)/Q,_e=(ae+0)/Q,De=(ae+1)/Q,Pe=Mp(he,_e,this.dem)*T,Oe=Mp(me,_e,this.dem)*T,Ve=Mp(me,De,this.dem)*T,tt=Mp(he,De,this.dem)*T,vt=AA(O[0],O[1],Pe,L[0],O[1],Oe,L[0],L[1],Ve,g,y),ft=AA(L[0],L[1],Ve,O[0],L[1],tt,O[0],O[1],Pe,g,y),xt=Math.min(vt!==null?vt:Number.MAX_VALUE,ft!==null?ft:Number.MAX_VALUE);if(xt!==Number.MAX_VALUE)return xt;{const St=qe([],g,y,K);if(PA(Pe,Oe,tt,Ve,IA(St[0],O[0],L[0]),IA(St[1],O[1],L[1]))>=St[2])return K}continue}let pe=0;for(let Q=0;Q<this._siblingOffset.length;Q++){MA((te<<1)+this._siblingOffset[Q][0],(ae<<1)+this._siblingOffset[Q][1],fe+1,e,o,u,d,O,L),O[2]=-100,L[2]=this.maximums[this.childOffsets[H]+Q]*T;const he=CA(O,L,g,y);if(he!=null){const me=he;I[Q]=me;let _e=!1;for(let De=0;De<pe&&!_e;De++)me>=I[N[De]]&&(N.splice(De,0,Q),_e=!0);_e||(N[pe]=Q),pe++}}for(let Q=0;Q<pe;Q++){const he=N[Q];V.push({idx:this.childOffsets[H]+he,t:I[he],nodex:(te<<1)+this._siblingOffset[he][0],nodey:(ae<<1)+this._siblingOffset[he][1],depth:fe+1})}}return null}_addNode(e,o,u){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,u,d,g){if(e[d].isLeaf(o,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=d-1,T=e[y];let C=0,I=0;for(let N=0;N<this._siblingOffset.length;N++){const O=2*o+this._siblingOffset[N][0],L=2*u+this._siblingOffset[N][1],V=T.getElevation(O,L),H=T.isLeaf(O,L),K=this._addNode(V.min,V.max,H);H&&(C|=1<<N),I||(I=K)}for(let N=0;N<this._siblingOffset.length;N++)C&1<<N||this._construct(e,2*o+this._siblingOffset[N][0],2*u+this._siblingOffset[N][1],y,I+N)}}function PA(a,e,o,u,d,g){return Mn(Mn(a,o,g),Mn(e,u,g),d)}function Mp(a,e,o){const u=o.dim,d=Ee(a*u-.5,0,u-1),g=Ee(e*u-.5,0,u-1),y=Math.floor(d),T=Math.floor(g),C=Math.min(y+1,u-1),I=Math.min(T+1,u-1);return PA(o.get(y,T),o.get(C,T),o.get(y,I),o.get(C,I),d-y,g-T)}const I3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function M3(a,e,o){return(256*a*256+256*e+o)/10-1e4}function k3(a,e,o){return 256*a+e+o/256-32768}class yv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,u,d=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void Hn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const g=this.dim=o.height-2,y=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let C=0;C<g;C++)y[this._idx(-1,C)]=y[this._idx(0,C)],y[this._idx(g,C)]=y[this._idx(g-1,C)],y[this._idx(C,-1)]=y[this._idx(C,0)],y[this._idx(C,g)]=y[this._idx(C,g-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(g,-1)]=y[this._idx(g-1,0)],y[this._idx(-1,g)]=y[this._idx(0,g-1)],y[this._idx(g,g)]=y[this._idx(g-1,g-1)]}const T=u==="terrarium"?k3:M3;for(let C=0;C<y.length;++C){const I=4*C;this.floatView[C]=T(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Wa.now()}_buildQuadTree(){this._tree=new kA(this)}get(e,o,u=!1){u&&(e=Ee(e,-1,this.dim),o=Ee(o,-1,this.dim));const d=this._idx(e,o);return this.floatView[d]}set(e,o,u){const d=this._idx(e,o),g=this.floatView[d];return this.floatView[d]=u,u-g}static getUnpackVector(e){return I3[e]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}static pack(e,o){const u=[0,0,0,0],d=yv.getUnpackVector(o);let g=Math.floor((e+d[3])/d[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new P2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,o,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,g=o*this.dim+this.dim,y=u*this.dim,T=u*this.dim+this.dim;switch(o){case-1:d=g-1;break;case 1:g=d+1}switch(u){case-1:y=T-1;break;case 1:T=y+1}const C=-o*this.dim,I=-u*this.dim;for(let N=y;N<T;N++)for(let O=d;O<g;O++){const L=4*this._idx(O,N),V=4*this._idx(O+C,N+I);this.pixels[L+0]=e.pixels[V+0],this.pixels[L+1]=e.pixels[V+1],this.pixels[L+2]=e.pixels[V+2],this.pixels[L+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function P3(a,e,o){a===1?e.headerLength=o.readFixed32():a===2?e.x=o.readVarint():a===3?e.y=o.readVarint():a===4?e.z=o.readVarint():a===5&&e.layers.push(function(u,d){return u.readFields(L3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)}(o,o.readVarint()+o.pos))}function R3(a,e,o){a===1?(e.delta_filter=function(u,d){return u.readFields(N3,{blockSize:0},d)}(o,o.readVarint()+o.pos),e.filter="delta_filter"):a===2?(o.readVarint(),e.filter="zigzag_filter"):a===3?(o.readVarint(),e.filter="bitshuffle_filter"):a===4&&(o.readVarint(),e.filter="byteshuffle_filter")}function N3(a,e,o){a===1&&(e.blockSize=o.readVarint())}function D3(a,e,o){a===1?(o.readVarint(),e.codec="gzip_data"):a===2?(o.readVarint(),e.codec="jpeg_image"):a===3?(o.readVarint(),e.codec="webp_image"):a===4&&(o.readVarint(),e.codec="png_image")}function O3(a,e,o){let u=0,d=0;a===1?e.firstByte=o.readFixed64():a===2?e.lastByte=o.readFixed64():a===3?e.filters.push(function(g,y){return g.readFields(R3,{},y)}(o,o.readVarint()+o.pos)):a===4?e.codec=function(g,y){return g.readFields(D3,{},y)}(o,o.readVarint()+o.pos):a===5?d=o.readFloat():a===6?u=o.readFloat():a===7?e.bands.push(o.readString()):a===8?e.offset=o.readDouble():a===9&&(e.scale=o.readDouble()),e.offset===0&&(e.offset=d),e.scale===0&&(e.scale=u)}function L3(a,e,o){a===1?e.version=o.readVarint():a===2?e.name=o.readString():a===3?e.units=o.readString():a===4?e.tileSize=o.readVarint():a===5?e.buffer=o.readVarint():a===6?e.pixelFormat=o.readVarint():a===7&&e.dataIndex.push(function(u,d){return u.readFields(O3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)}(o,o.readVarint()+o.pos))}function z3(a,e,o){if(a===2)(function(u,d,g){u.readFields(j3,g,d)})(o,o.readVarint()+o.pos,e);else if(a===3)throw new Error("Not implemented")}function j3(a,e,o){if(a===1){let u=0;const d=o.readVarint()+o.pos;for(;o.pos<d;)e[u++]=o.readVarint()}}function F3(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let o=e[3];for(let u=2;u>=1;u--){const d=u===1?1:0,g=u===2?1:0;for(let y=0;y<e[0];y++){const T=e[1]*y;for(let C=d;C<e[1];C++){const I=e[2]*(C+T);for(let N=g;N<e[2];N++){const O=e[3]*(N+I);for(let L=0;L<e[3];L++){const V=O+L;a[V]+=a[V-o]}}}}o*=e[u]}return a}function B3(a){for(let e=0,o=a.length;e<o;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function V3(a,e){switch(e){case"uint32":return a;case"uint16":for(let o=0;o<a.length;o+=2){const u=a[o],d=a[o+1];a[o]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,a[o+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return a;case"uint8":for(let o=0;o<a.length;o+=4){const u=a[o],d=a[o+1],g=a[o+2],y=a[o+3];a[o+0]=(192&u)>>6|(192&d)>>4|(192&g)>>2|192&y,a[o+1]=(48&u)>>4|(48&d)>>2|48&g|(48&y)<<2,a[o+2]=(12&u)>>2|12&d|(12&g)<<2|(12&y)<<4,a[o+3]=3&u|(3&d)<<2|(3&g)<<4|(3&y)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}Zt(yv,"DEMData"),Zt(kA,"DemMinMaxQuadTree",{omit:["dem"]});var Sc=Uint8Array,M_=Uint16Array,U3=Int32Array,RA=new Sc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),NA=new Sc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$3=new Sc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),DA=function(a,e){for(var o=new M_(31),u=0;u<31;++u)o[u]=e+=1<<a[u-1];var d=new U3(o[30]);for(u=1;u<30;++u)for(var g=o[u];g<o[u+1];++g)d[g]=g-o[u]<<5|u;return{b:o,r:d}},OA=DA(RA,2),LA=OA.b,H3=OA.r;LA[28]=258,H3[258]=28;for(var G3=DA(NA,0).b,zA=new M_(32768),Ns=0;Ns<32768;++Ns){var sy=(43690&Ns)>>1|(21845&Ns)<<1;zA[Ns]=((65280&(sy=(61680&(sy=(52428&sy)>>2|(13107&sy)<<2))>>4|(3855&sy)<<4))>>8|(255&sy)<<8)>>1}var k_=function(a,e,o){for(var u=a.length,d=0,g=new M_(e);d<u;++d)a[d]&&++g[a[d]-1];var y,T=new M_(e);for(d=1;d<e;++d)T[d]=T[d-1]+g[d-1]<<1;y=new M_(1<<e);var C=15-e;for(d=0;d<u;++d)if(a[d])for(var I=d<<4|a[d],N=e-a[d],O=T[a[d]-1]++<<N,L=O|(1<<N)-1;O<=L;++O)y[zA[O]>>C]=I;return y},P_=new Sc(288);for(Ns=0;Ns<144;++Ns)P_[Ns]=8;for(Ns=144;Ns<256;++Ns)P_[Ns]=9;for(Ns=256;Ns<280;++Ns)P_[Ns]=7;for(Ns=280;Ns<288;++Ns)P_[Ns]=8;var jA=new Sc(32);for(Ns=0;Ns<32;++Ns)jA[Ns]=5;var q3=k_(P_,9),W3=k_(jA,5),Lb=function(a){for(var e=a[0],o=1;o<a.length;++o)a[o]>e&&(e=a[o]);return e},sh=function(a,e,o){var u=e/8|0;return(a[u]|a[u+1]<<8)>>(7&e)&o},zb=function(a,e){var o=e/8|0;return(a[o]|a[o+1]<<8|a[o+2]<<16)>>(7&e)},Z3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],oh=function(a,e,o){var u=new Error(e||Z3[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,oh),!o)throw u;return u},X3=new Sc(0),K3=typeof TextDecoder<"u"&&new TextDecoder;try{K3.decode(X3,{stream:!0})}catch{}const Y3={gzip_data:"gzip"};class lu extends Error{constructor(e){super(e),this.name="MRTError"}}const J3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},FA={uint32:1,uint16:2,uint8:4},Q3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let jb;class _v{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const o=this.layers[e];if(!o)throw new lu(`Layer '${e}' not found`);return o}getHeaderLength(e){const o=new Uint8Array(e),u=new DataView(e);if(o[0]!==13)throw new lu("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){const o=new Uint8Array(e),u=this.getHeaderLength(e);if(o.length<u)throw new lu(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const d=function(g,y){return g.readFields(P3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new jb(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new lu(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new BA(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const o=[],u=this.getLayer(e.layerName);for(let d of e.blockIndices){const g=u.dataIndex[d],y=g.firstByte-e.firstByte,T=g.lastByte-e.firstByte;if(u._blocksInProgress.has(d))continue;const C={layerName:u.name,firstByte:y,lastByte:T,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(I=>I.filter)};u._blocksInProgress.add(d),o.push(C)}return new VA(o,()=>{o.forEach(d=>u._blocksInProgress.delete(d.blockIndex))},(d,g)=>{if(o.forEach(y=>u._blocksInProgress.delete(y.blockIndex)),d)throw d;g.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class BA{constructor({version:e,name:o,units:u,tileSize:d,pixelFormat:g,buffer:y,dataIndex:T},C){if(this.version=e,this.version!==1)throw new lu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=o,this.units=u,this.tileSize=d,this.buffer=y,this.pixelFormat=J3[g],this.dataIndex=T,this.bandShape=[d+2*y,d+2*y,FA[this.pixelFormat]],this._decodedBlocks=new gv(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return FA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const o=e.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,e.data)}getBlockForBand(e){let o=0;switch(typeof e){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[g,y]of d.bands.entries())if(y===e)return{bandIndex:o+g,blockIndex:u,blockBandIndex:g};o+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(e>=o&&e<o+d.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-o};o+=d.bands.length}break;default:throw new lu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let o=1/0,u=-1/0;const d=[],g=new Set;for(const y of e){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new lu(`Invalid band: ${JSON.stringify(y)}`);const C=this.dataIndex[T];d.includes(T)||d.push(T),g.add(T),o=Math.min(o,C.firstByte),u=Math.max(u,C.lastByte)}if(g.size>this.cacheSize)throw new lu(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:d}}hasBand(e){const{blockIndex:o}=this.getBlockForBand(e);return o>=0}hasDataForBand(e){const{blockIndex:o}=this.getBlockForBand(e);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(e){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(e);if(o<0)throw new lu(`Band not found: ${JSON.stringify(e)}`);const d=this._decodedBlocks.get(o.toString());if(!d)throw new lu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[o],y=this.bandShape.reduce((I,N)=>I*N,1),T=u*y,C=d.subarray(T,T+y);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}_v.setPbf=function(a){jb=a};class VA{constructor(e,o,u){this.tasks=e,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,o){this._finalized||(this._onComplete(e,o),this._finalized=!0)}}function eg(a,e){const o=a.json.bufferViews[e.bufferView],u=Fx[e.componentType];return new u(a.buffers[o.buffer],(e.byteOffset||0)+(o.byteOffset||0),e.count*(o.byteStride&&o.byteStride!==f_[e.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:f_[e.type]))}function Fb(a,e,o,u){const d=Fx[e.componentType],g=function(N){switch(N){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(d),y=a.json.bufferViews[e.bufferView],T=y.byteStride?y.byteStride/d.BYTES_PER_ELEMENT:f_[e.type],C=o.float32,I=C.length/o.capacity;for(let N=0,O=0;N<e.count*T;N+=T,O+=I)for(let L=0;L<I;L++)C[O+L]=u[N+L]*g;o._trim()}function eF(a,e,o){const u=a.indices,d=a.attributes,g={};g.indexArray=new Rs;const y=e.json.accessors[u],T=y.count/3;g.indexArray.reserve(T);const C=eg(e,y);for(let L=0;L<T;L++)g.indexArray.emplaceBack(C[3*L],C[3*L+1],C[3*L+2]);g.indexArray._trim(),g.vertexArray=new gl;const I=e.json.accessors[d.POSITION];g.vertexArray.reserve(I.count);const N=eg(e,I);for(let L=0;L<I.count;L++)g.vertexArray.emplaceBack(N[3*L],N[3*L+1],N[3*L+2]);if(g.vertexArray._trim(),g.aabb=new Dr(I.min,I.max),g.centroid=function(L,V){const H=[0,0,0],K=L.length;if(K>0){for(let te=0;te<K;te++){const ae=3*L[te];H[0]+=V[ae],H[1]+=V[ae+1],H[2]+=V[ae+2]}H[0]/=K,H[1]/=K,H[2]/=K}return H}(C,N),d.COLOR_0!==void 0){const L=e.json.accessors[d.COLOR_0],V=f_[L.type],H=eg(e,L);g.colorArray=V===3?new gl:new Ps,g.colorArray.resize(L.count),Fb(e,L,g.colorArray,H)}if(d.NORMAL!==void 0){g.normalArray=new gl;const L=e.json.accessors[d.NORMAL];g.normalArray.resize(L.count);const V=eg(e,L);Fb(e,L,g.normalArray,V)}if(d.TEXCOORD_0!==void 0&&o.length>0){g.texcoordArray=new Zu;const L=e.json.accessors[d.TEXCOORD_0];g.texcoordArray.resize(L.count);const V=eg(e,L);Fb(e,L,g.texcoordArray,V)}if(d._FEATURE_ID_RGBA4444!==void 0){const L=e.json.accessors[d._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=eg(e,L))}d._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(eg(e,e.json.accessors[d._FEATURE_RGBA4444]).buffer));const O=a.material;return g.material=function(L,V){const{emissiveFactor:H=[0,0,0],alphaMode:K="OPAQUE",alphaCutoff:te=.5,normalTexture:ae,occlusionTexture:fe,emissiveTexture:pe,doubleSided:Q}=L,{baseColorFactor:he=[1,1,1,1],metallicFactor:me=1,roughnessFactor:_e=1,baseColorTexture:De,metallicRoughnessTexture:Pe}=L.pbrMetallicRoughness||{},Oe=fe?V[fe.index]:void 0;if(fe&&fe.extensions&&fe.extensions.KHR_texture_transform&&Oe){const Ve=fe.extensions.KHR_texture_transform;Oe.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ir(...he),metallicFactor:me,roughnessFactor:_e,baseColorTexture:De?V[De.index]:void 0,metallicRoughnessTexture:Pe?V[Pe.index]:void 0},doubleSided:Q,emissiveFactor:new Ir(...H),alphaMode:K,alphaCutoff:te,normalTexture:ae?V[ae.index]:void 0,occlusionTexture:Oe,emissionTexture:pe?V[pe.index]:void 0,defined:L.defined===void 0}}(O!==void 0?e.json.materials[O]:{defined:!1},o),g}function UA(a,e,o){const{matrix:u,rotation:d,translation:g,scale:y,mesh:T,extras:C,children:I}=a,N={};if(N.matrix=u||function(O,L,V,H){var K=L[0],te=L[1],ae=L[2],fe=L[3],pe=K+K,Q=te+te,he=ae+ae,me=K*pe,_e=K*Q,De=K*he,Pe=te*Q,Oe=te*he,Ve=ae*he,tt=fe*pe,vt=fe*Q,ft=fe*he,xt=H[0],St=H[1],rt=H[2];return O[0]=(1-(Pe+Ve))*xt,O[1]=(_e+ft)*xt,O[2]=(De-vt)*xt,O[3]=0,O[4]=(_e-ft)*St,O[5]=(1-(me+Ve))*St,O[6]=(Oe+tt)*St,O[7]=0,O[8]=(De+vt)*rt,O[9]=(Oe-tt)*rt,O[10]=(1-(me+Pe))*rt,O[11]=0,O[12]=V[0],O[13]=V[1],O[14]=V[2],O[15]=1,O}([],d||[0,0,0,1],g||[0,0,0],y||[1,1,1]),T!==void 0){N.meshes=o[T];const O=N.anchor=[0,0];for(const L of N.meshes){const{min:V,max:H}=L.aabb;O[0]+=V[0]+H[0],O[1]+=V[1]+H[1]}O[0]=Math.floor(O[0]/N.meshes.length/2),O[1]=Math.floor(O[1]/N.meshes.length/2)}if(C&&(C.id&&(N.id=C.id),C.lights&&(N.lights=function(O){if(!O.length)return[];const L=function(ae){const fe=atob(ae),pe=new Uint8Array(fe.length);for(let Q=0;Q<fe.length;Q++)pe[Q]=fe.codePointAt(Q);return pe}(O),V=[],H=L.length/24,K=new Uint16Array(L.buffer),te=new Float32Array(L.buffer);for(let ae=0;ae<H;ae++){const fe=K[2*ae*6]/30,pe=K[2*ae*6+1]/30,Q=K[2*ae*6+10]/100,he=te[6*ae+1],me=te[6*ae+2],_e=te[6*ae+3],De=te[6*ae+4],Pe=_e-he,Oe=De-me,Ve=Math.hypot(Pe,Oe);V.push({pos:[he+.5*Pe,me+.5*Oe,pe],normal:[Oe/Ve,-Pe/Ve,0],width:Ve,height:fe,depth:Q,points:[he,me,_e,De]})}return V}(C.lights))),I){const O=[];for(const L of I)O.push(UA(e.json.nodes[L],e,o));N.children=O}return N}function tF(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new U1(a.vertices,a.indices,8,256),[o,u]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:o,max:u}}function nF(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const o=e[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const y of o){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],C=y[1];typeof T=="number"&&typeof C=="number"&&u.push(new Ot(T,C))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let y=0;y<u.length;y++){const T=u[y],C=u[(y+1)%u.length],I=u[(y+2)%u.length];d+=(T.x-C.x)*(I.y-C.y)-(I.x-C.x)*(T.y-C.y)}d>0&&u.reverse();const g=t_(u.flatMap(y=>[y.x,y.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function rF(a,e){const o=[],u=[];let d=0;const g=[];for(const y of a){d=o.length;const T=y.vertexArray.float32,C=y.indexArray.uint16;for(let I=0;I<y.vertexArray.length;I++)g[0]=T[3*I+0],g[1]=T[3*I+1],g[2]=T[3*I+2],An(g,g,e),o.push(new Ot(g[0],g[1]));for(let I=0;I<3*y.indexArray.length;I++)u.push(C[I]+d)}if(u.length%3!=0)return null;for(let y=0;y<u.length;y+=3){const T=o[u[y+0]],C=o[u[y+1]],I=o[u[y+2]];(T.x-C.x)*(I.y-C.y)-(I.x-C.x)*(T.y-C.y)>0&&([u[y+1],u[y+2]]=[u[y+2],u[y+1]])}return{vertices:o,indices:u}}function $A(a){const e=function(C,I){const N=[],O=WebGL2RenderingContext;if(C.json.textures)for(const L of C.json.textures){const V={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};L.sampler!==void 0&&Object.assign(V,C.json.samplers[L.sampler]),N.push({image:I[L.source],sampler:V,uploaded:!1})}return N}(a,a.images),o=function(C,I){const N=[];for(const O of C.json.meshes){const L=[];for(const V of O.primitives)L.push(eF(V,C,I));N.push(L)}return N}(a,e),{scenes:u,scene:d,nodes:g}=a.json,y=u?u[d||0].nodes:g,T=[];for(const C of y)T.push(UA(g[C],a,o));return function(C,I,N){const O={},L=new Set;for(let V=0;V<C.length;V++){const H=N[I[V]];if(!H.extras)continue;const K=H.extras["mapbox:footprint:version"],te=H.extras["mapbox:footprint:id"];(K||te)&&L.add(V),K==="1.0.0"&&te&&(O[te]=V)}for(let V=0;V<C.length;V++){if(L.has(V))continue;const H=C[V],K=N[I[V]];if(!K.extras)continue;let te=null;H.id in O&&(te=rF(C[O[H.id]].meshes,H.matrix)),te||(te=nF(K)),te&&(H.footprint=tF(te))}if(L.size>0){const V=Array.from(L.values()).sort((H,K)=>H-K);for(let H=V.length-1;H>=0;H--)C.splice(V[H],1)}}(T,y,a.json.nodes),T}function iF(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,o=a.aabb.min[0]-1,u=a.aabb.min[1]-1,d=Jm/(a.aabb.max[0]-o+2),g=Jm/(a.aabb.max[1]-u+2);for(let y=0;y<e.length;y+=3){const T=e[y+2],C=(e[y+0]-o)*d|0,I=(e[y+1]-u)*g|0;T>a.heightmap[I*Jm+C]&&(a.heightmap[I*Jm+C]=T)}}function sF(a,e){const o={};o.indexArray=new Rs,o.indexArray.reserve(4*a.length),o.vertexArray=new gl,o.vertexArray.reserve(10*a.length),o.colorArray=new Ps,o.vertexArray.reserve(10*a.length);let u=0;for(const y of a){const T=Math.min(10,Math.max(4,1.3*y.height))*e,C=[-y.normal[1],y.normal[0],0],I=Math.min(.29,.1*y.width/y.depth),N=y.width-2*y.depth*e*(I+.01),O=qe([],y.pos,C,N/2),L=qe([],y.pos,C,-N/2),V=[O[0],O[1],O[2]+y.height],H=[L[0],L[1],L[2]+y.height],K=qe([],y.normal,C,I);Ht(K,K,T);const te=qe([],y.normal,C,-I);Ht(te,te,T),wn(K,O,K),wn(te,L,te),O[2]+=.1,L[2]+=.1,o.vertexArray.emplaceBack(K[0],K[1],K[2]),o.vertexArray.emplaceBack(te[0],te[1],te[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack(H[0],H[1],H[2]),o.vertexArray.emplaceBack(O[0],O[1],O[2]),o.vertexArray.emplaceBack(L[0],L[1],L[2]),o.vertexArray.emplaceBack(K[0],K[1],K[2]),o.vertexArray.emplaceBack(te[0],te[1],te[2]);const ae=N/T/2;o.colorArray.emplaceBack(-ae-I,-1,ae,.8),o.colorArray.emplaceBack(ae+I,-1,ae,.8),o.colorArray.emplaceBack(-ae,0,ae,1.3),o.colorArray.emplaceBack(ae,0,ae,1.3),o.colorArray.emplaceBack(ae+I,-.8,ae,.7),o.colorArray.emplaceBack(ae+I,-.8,ae,.7),o.colorArray.emplaceBack(0,0,ae,1.3),o.colorArray.emplaceBack(0,0,ae,1.3),o.colorArray.emplaceBack(ae+I,-1.2,ae,.8),o.colorArray.emplaceBack(ae+I,-1.2,ae,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const d={defined:!0};d.emissiveFactor=Ir.black;const g={};return g.baseColorFactor=Ir.white,d.pbrMetallicRoughness=g,o.material=d,o.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}_v.performDecoding=function(a,e){const o=new Uint8Array(a);return Promise.all(e.tasks.map(u=>{const{layerName:d,firstByte:g,lastByte:y,pixelFormat:T,blockShape:C,blockIndex:I,filters:N,codec:O}=u,L=o.subarray(g,y+1),V=new Uint32Array(C[0]*C[1]*C[2]);let H;if(O!=="gzip_data")throw new lu(`Unhandled codec: ${O}`);return H=function(K,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((Q=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||oh(6,"invalid gzip data");var De=_e[3],Pe=10;4&De&&(Pe+=2+(_e[10]|_e[11]<<8));for(var Oe=(De>>3&1)+(De>>4&1);Oe>0;Oe-=!_e[Pe++]);return Pe+(2&De)}(pe=K))+8>pe.length&&oh(6,"invalid gzip data"),function(_e,De,Pe,Oe){var Ve=_e.length;if(!Ve||De.f&&!De.l)return Pe||new Sc(0);var tt=!Pe,vt=tt||De.i!=2,ft=De.i;tt&&(Pe=new Sc(3*Ve));var xt,St,rt=function(Qi){var Ii=Pe.length;if(Qi>Ii){var _i=new Sc(Math.max(2*Ii,Qi));_i.set(Pe),Pe=_i}},_t=De.f||0,et=De.p||0,nt=De.b||0,Mt=De.l,Pt=De.d,_n=De.m,nn=De.n,$t=8*Ve;do{if(!Mt){_t=sh(_e,et,1);var At=sh(_e,et+1,3);if(et+=3,!At){var Gn=_e[(ye=4+((et+7)/8|0))-4]|_e[ye-3]<<8,tn=ye+Gn;if(tn>Ve){ft&&oh(0);break}vt&&rt(nt+Gn),Pe.set(_e.subarray(ye,tn),nt),De.b=nt+=Gn,De.p=et=8*tn,De.f=_t;continue}if(At==1)Mt=q3,Pt=W3,_n=9,nn=5;else if(At==2){var sn=sh(_e,et,31)+257,jn=sh(_e,et+10,15)+4,nr=sn+sh(_e,et+5,31)+1;et+=14;for(var Kn=new Sc(nr),ur=new Sc(19),ir=0;ir<jn;++ir)ur[$3[ir]]=sh(_e,et+3*ir,7);et+=3*jn;var hr=Lb(ur),qr=(1<<hr)-1,Si=k_(ur,hr);for(ir=0;ir<nr;){var ye,Se=Si[sh(_e,et,qr)];if(et+=15&Se,(ye=Se>>4)<16)Kn[ir++]=ye;else{var ot=0,Lt=0;for(ye==16?(Lt=3+sh(_e,et,3),et+=2,ot=Kn[ir-1]):ye==17?(Lt=3+sh(_e,et,7),et+=3):ye==18&&(Lt=11+sh(_e,et,127),et+=7);Lt--;)Kn[ir++]=ot}}var Gt=Kn.subarray(0,sn),Ut=Kn.subarray(sn);_n=Lb(Gt),nn=Lb(Ut),Mt=k_(Gt,_n),Pt=k_(Ut,nn)}else oh(1);if(et>$t){ft&&oh(0);break}}vt&&rt(nt+131072);for(var en=(1<<_n)-1,zn=(1<<nn)-1,gr=et;;gr=et){var yr=(ot=Mt[zb(_e,et)&en])>>4;if((et+=15&ot)>$t){ft&&oh(0);break}if(ot||oh(2),yr<256)Pe[nt++]=yr;else{if(yr==256){gr=et,Mt=null;break}var sr=yr-254;yr>264&&(sr=sh(_e,et,(1<<(_r=RA[ir=yr-257]))-1)+LA[ir],et+=_r);var Kr=Pt[zb(_e,et)&zn],yi=Kr>>4;if(Kr||oh(3),et+=15&Kr,Ut=G3[yi],yi>3){var _r=NA[yi];Ut+=zb(_e,et)&(1<<_r)-1,et+=_r}if(et>$t){ft&&oh(0);break}vt&&rt(nt+131072);var qi=nt+sr;if(nt<Ut){var Ti=0-Ut,Wr=Math.min(Ut,qi);for(Ti+nt<0&&oh(3);nt<Wr;++nt)Pe[nt]=(void 0)[Ti+nt]}for(;nt<qi;++nt)Pe[nt]=Pe[nt-Ut]}}De.l=Mt,De.p=gr,De.b=nt,De.f=_t,Mt&&(_t=1,De.m=_n,De.d=Pt,De.n=nn)}while(!_t);return nt!=Pe.length&&tt?(xt=Pe,((St=nt)==null||St>xt.length)&&(St=xt.length),new Sc(xt.subarray(0,St))):Pe.subarray(0,nt)}(pe.subarray(Q,-8),{i:2},new Sc(((ae=pe)[(fe=ae.length)-4]|ae[fe-3]<<8|ae[fe-2]<<16|ae[fe-1]<<24)>>>0))));var ae,fe,pe,Q;const he=Y3[te];if(!he)throw new Error(`Unhandled codec: ${te}`);const me=new globalThis.DecompressionStream(he);return new Response(new Blob([K]).stream().pipeThrough(me)).arrayBuffer().then(_e=>new Uint8Array(_e))}(L,O).then(K=>(function(te,ae){te.readFields(z3,ae)}(new jb(K),V),new Q3[T](V.buffer))),H.then(K=>{for(let te=N.length-1;te>=0;te--)switch(N[te]){case"delta_filter":F3(K,C);break;case"zigzag_filter":B3(K);break;case"bitshuffle_filter":V3(K,T);break;default:throw new lu(`Unhandled filter "${N[te]}"`)}return{layerName:d,blockIndex:I,data:K}}).catch(K=>{throw K})}))},Zt(VA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Zt(_v,"MapboxRasterTile"),Zt(BA,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class HA{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const u=e[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const oF=["id","tile","layer","source","sourceLayer","state"];class oy{constructor(e,o,u,d,g){this.type="Feature",this._vectorTileFeature=e,this._z=o,this._x=u,this._y=d,this.properties=e.properties,this.id=g}clone(){const e=new oy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of oF)this[o]!==void 0&&(e[o]=this[o]);return e}}class GA{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new zs(jt,16,0),this.featureIndexArray=new xp,this.promoteId=o,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,o,u,d,g,y=0,T=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,g,y);const I=this.grid;for(let N=0;N<o.length;N++){const O=o[N],L=[1/0,1/0,-1/0,-1/0];for(let V=0;V<O.length;V++){const H=O[V];L[0]=Math.min(L[0],H.x),L[1]=Math.min(L[1],H.y),L[2]=Math.max(L[2],H.x),L[3]=Math.max(L[3],H.y)}T!==0&&(L[0]-=T,L[1]-=T,L[2]+=T,L[3]+=T),L[0]<jt&&L[1]<jt&&L[2]>=0&&L[3]>=0&&I.insert(C,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new er.VectorTile(new Vx(this.rawTileData)).layers,this.sourceLayerCoder=new HA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,o){const{tilespaceGeometry:u,transform:d,tileTransform:g,pixelPosMatrix:y,availableImages:T,worldview:C}=o;this.loadVTLayers(),this.serializedLayersCache.clear();const I=u.bufferedTilespaceBounds,N=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(H,K,te,ae)=>bc(u.bufferedTilespaceGeometry,H,K,te,ae));N.sort(aF);let O=null;d.elevation&&N.length>0&&(O=ny.create(d.elevation,this.tileID));const L={};let V;for(let H=0;H<N.length;H++){const K=N[H];if(K===V)continue;V=K;const te=this.featureIndexArray.get(K);let ae=null;this.is3DTile?this.loadMatchingModelFeature(L,te,e,u,d,C):this.loadMatchingFeature(L,te,e,T,C,(fe,pe,Q,he=0)=>(ae||(ae=qt(fe,this.tileID.canonical,g)),pe.queryIntersectsFeature(u,fe,Q,ae,this.z,d,y,O,he)))}return L}loadMatchingFeature(e,o,u,d,g,y){const{featureIndex:T,bucketIndex:C,sourceLayerIndex:I,layoutVertexArrayOffset:N}=o,O=this.bucketLayerIDs[C],L=u.layers,V=Object.keys(L);if(V.length&&!Un(V,O))return;const H=u.sourceCache,K=this.sourceLayerCoder.decode(I),te=this.vtLayers[K].feature(T),ae=this.getId(te,K);for(let fe=0;fe<O.length;fe++){const pe=O[fe];if(!L[pe])continue;const{styleLayer:Q,targets:he}=L[pe];let me={};ae!==void 0&&(me=H.getFeatureState(Q.sourceLayer,ae));const _e=!y||y(te,Q,me,N);if(!_e)continue;const De=new oy(te,this.z,this.x,this.y,ae);De.tile=this.tileID.canonical,De.state=me;let Pe=this.serializedLayersCache.get(pe);Pe||(Pe=Q.serialize(),Pe.id=pe,this.serializedLayersCache.set(pe,Pe)),De.source=Pe.source,De.sourceLayer=Pe["source-layer"],De.layer=Xe({},Pe),De.layer.paint=qA(Pe.paint,Q.paint,te,me,d),De.layer.layout=qA(Pe.layout,Q.layout,te,me,d);let Oe=!1;for(const Ve of he){this.updateFeatureProperties(De,Ve);const{filter:tt}=Ve;if(tt){if(te.properties=De.properties,tt.needGeometry){const vt=Bt(te,!0);if(!tt.filter(new Hr(this.tileID.overscaledZ,{worldview:g}),vt,this.tileID.canonical))continue}else if(!tt.filter(new Hr(this.tileID.overscaledZ,{worldview:g}),te))continue}Oe=!0,Ve.targetId&&this.addFeatureVariant(De,Ve)}Oe&&this.appendToResult(e,pe,T,De,_e)}}loadMatchingModelFeature(e,o,u,d,g,y){const{featureIndex:T,bucketIndex:C}=o,I=this.bucketLayerIDs[C],N=u.layers,O=Object.keys(N);if(!O.length||Un(O,I))for(let L=0;L<I.length;L++){const V=I[L],{styleLayer:H,targets:K}=N[V];if(H.type!=="model")continue;const te=d.tile,ae=te.getBucket(H);if(!(ae&&ae instanceof hv))continue;const fe=o3(ae,T,d,g);if(!fe)continue;const{z:pe,x:Q,y:he}=te.tileID.canonical,{feature:me,intersectionZ:_e,position:De}=fe;let Pe={};me.id!==void 0&&(Pe=u.sourceCache.getFeatureState(H.sourceLayer,me.id));const Oe=new oy({},pe,Q,he,me.id);Oe.tile=this.tileID.canonical,Oe.state=Pe,Oe.properties=me.properties,Oe.geometry={type:"Point",coordinates:[De.lng,De.lat]};let Ve=this.serializedLayersCache.get(V);Ve||(Ve=H.serialize(),Ve.id=V,this.serializedLayersCache.set(V,Ve)),Oe.source=Ve.source,Oe.sourceLayer=Ve["source-layer"],Oe.layer=Xe({},Ve);let tt=!1;for(const vt of K){this.updateFeatureProperties(Oe,vt);const{filter:ft}=vt;if(ft){if(me.properties=Oe.properties,ft.needGeometry){if(!ft.filter(new Hr(this.tileID.overscaledZ,{worldview:y}),me,this.tileID.canonical))continue}else if(!ft.filter(new Hr(this.tileID.overscaledZ,{worldview:y}),me))continue}tt=!0,vt.targetId&&this.addFeatureVariant(Oe,vt)}tt&&this.appendToResult(e,V,T,Oe,_e)}}updateFeatureProperties(e,o,u){if(o.properties){const d={};for(const g in o.properties){const y=o.properties[g].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);y!=null&&(d[g]=y)}e.properties=d}}addFeatureVariant(e,o,u){const d={target:o.target,namespace:o.namespace,uniqueFeatureID:o.uniqueFeatureID};o.properties&&(d.properties=e.properties),e.variants=e.variants||{},e.variants[o.targetId]=e.variants[o.targetId]||[],e.variants[o.targetId].push(d)}appendToResult(e,o,u,d,g){let y=e[o];y===void 0&&(y=e[o]=[]),y.push({featureIndex:u,feature:d,intersectionZ:g})}lookupSymbolFeatures(e,o,u,d,g,y){const T={};this.loadVTLayers();for(const C of e)this.loadMatchingFeature(T,{bucketIndex:o,sourceLayerIndex:u,featureIndex:C,layoutVertexArrayOffset:0},d,g,y);return T}loadFeature(e){const{featureIndex:o,sourceLayerIndex:u}=e;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),g=this.vtFeatures[d];if(g[o])return g[o];const y=this.vtLayers[d].feature(o);return g[o]=y,y}hasLayer(e){for(const o of this.bucketLayerIDs)for(const u of o)if(e===u)return!0;return!1}getId(e,o){let u=e.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[o];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const g=zl(d);if(g.result!=="success"){const y=g.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void Hn(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=g.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new kd),u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function qA(a,e,o,u,d){return ke(a,(g,y)=>{const T=e instanceof ml?e.get(y):null;return T&&T.evaluate?T.evaluate(o,u,void 0,d):T})}function aF(a,e){return e-a}Zt(GA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const WA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Bb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(e,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const g=WA[15&u];if(!g)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[T]=new Uint32Array(e,4,1);return new Bb(T,y,g,e)}constructor(e,o=64,u=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const g=WA.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,T=e*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+C,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+C),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+T+C,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=e)}add(e,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=o,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,o,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:T}=this,C=[0,g.length-1,0],I=[];for(;C.length;){const N=C.pop()||0,O=C.pop()||0,L=C.pop()||0;if(O-L<=T){for(let te=L;te<=O;te++){const ae=y[2*te],fe=y[2*te+1];ae>=e&&ae<=u&&fe>=o&&fe<=d&&I.push(g[te])}continue}const V=L+O>>1,H=y[2*V],K=y[2*V+1];H>=e&&H<=u&&K>=o&&K<=d&&I.push(g[V]),(N===0?e<=H:o<=K)&&(C.push(L),C.push(V-1),C.push(1-N)),(N===0?u>=H:d>=K)&&(C.push(V+1),C.push(O),C.push(1-N))}return I}within(e,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,T=[0,d.length-1,0],C=[],I=u*u;for(;T.length;){const N=T.pop()||0,O=T.pop()||0,L=T.pop()||0;if(O-L<=y){for(let te=L;te<=O;te++)XA(g[2*te],g[2*te+1],e,o)<=I&&C.push(d[te]);continue}const V=L+O>>1,H=g[2*V],K=g[2*V+1];XA(H,K,e,o)<=I&&C.push(d[V]),(N===0?e-u<=H:o-u<=K)&&(T.push(L),T.push(V-1),T.push(1-N)),(N===0?e+u>=H:o+u>=K)&&(T.push(V+1),T.push(O),T.push(1-N))}return C}}function Vb(a,e,o,u,d,g){if(d-u<=o)return;const y=u+d>>1;ZA(a,e,y,u,d,g),Vb(a,e,o,u,y-1,1-g),Vb(a,e,o,y+1,d,1-g)}function ZA(a,e,o,u,d,g){for(;d>u;){if(d-u>600){const I=d-u+1,N=o-u+1,O=Math.log(I),L=.5*Math.exp(2*O/3),V=.5*Math.sqrt(O*L*(I-L)/I)*(N-I/2<0?-1:1);ZA(a,e,o,Math.max(u,Math.floor(o-N*L/I+V)),Math.min(d,Math.floor(o+(I-N)*L/I+V)),g)}const y=e[2*o+g];let T=u,C=d;for(R_(a,e,u,o),e[2*d+g]>y&&R_(a,e,u,d);T<C;){for(R_(a,e,T,C),T++,C--;e[2*T+g]<y;)T++;for(;e[2*C+g]>y;)C--}e[2*u+g]===y?R_(a,e,u,C):(C++,R_(a,e,C,d)),C<=o&&(u=C+1),o<=C&&(d=C-1)}}function R_(a,e,o,u){Ub(a,o,u),Ub(e,2*o,2*u),Ub(e,2*o+1,2*u+1)}function Ub(a,e,o){const u=a[e];a[e]=a[o],a[o]=u}function XA(a,e,o,u){const d=a-o,g=e-u;return d*d+g*g}i.$=Ms,i.A=jc,i.B=ic,i.C=Ul,i.D=Wg,i.E=Fc,i.F=2,i.G=__,i.H=fC,i.I=_o,i.J=sc,i.K=class extends cv{},i.L=Al,i.M=Fs,i.N=$h,i.O=Uh,i.P=Ot,i.Q=Gd,i.R=Xa,i.S=hc,i.T=wb,i.U=Wo,i.V=cv,i.W=$u,i.X=zl,i.Y=Nh,i.Z=Wc,i._=cc,i.a=function(a){return Gs.API_CDN_URL_REGEX.test(a)},i.a$=Ze,i.a0=qs,i.a1=ru,i.a2=Xc,i.a3=Hd,i.a4=function(a){const e=a.value;let o=[];if(!e)return o;const u=sc(e);return u!=="string"?(o=o.concat([new cv(a.key,e,`string expected, "${u}" found`)]),o):(Cb(e,!0)||(o=o.concat([new cv(a.key,e,`invalid url "${e}"`)])),o)},i.a5=$e,i.a6=fs,i.a7=Di,i.a8=Tt,i.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return bi(a.expression.evaluate(e))}interpolate(a,e,o){return{x:Mn(a.x,e.x,o),y:Mn(a.y,e.y,o),z:Mn(a.z,e.z,o),azimuthal:Mn(a.azimuthal,e.azimuthal,o),polar:Mn(a.polar,e.polar,o)}}},i.aA=zi,i.aB=E,i.aC=xl,i.aD=Te,i.aE=Ye,i.aF=function(a,e){const o={};for(let u=0;u<e.length;u++){const d=e[u];d in a&&(o[d]=a[d])}return o},i.aG=ge,i.aH=be,i.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,o,u){const d=this.entries[a]=this.entries[a]||{callbacks:[]};if(d.result){const[g,y]=d.result;return this.scheduler?this.scheduler.add(()=>{u(g,y)},e):u(g,y),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=o((g,y)=>{d.result=[g,y];for(const T of d.callbacks)this.scheduler?this.scheduler.add(()=>{T(g,y)},e):T(g,y);setTimeout(()=>delete this.entries[a],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(g=>g!==u),d.callbacks.length||(d.cancel(),delete this.entries[a]))}}},i.aJ=function(a,e,o){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},d=>{const g=Td(a.request,(y,T,C,I)=>{y?d(y):T&&d(null,{vectorTile:o?void 0:new er.VectorTile(new Vx(T)),rawData:T,cacheControl:C,expires:I})});return()=>{g.cancel(),d()}},e)},i.aK=function(a){Nf++,Nf>pi&&(a.getActor().send("enforceCacheSizeLimit",Aa),Nf=0)},i.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},i.aM=No,i.aN=UC,i.aO=ZC,i.aP=VC,i.aQ=function(a,e){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let u=0;u<a.length;u++){const d=document.createElement("source");Ig(a[u])||(o.crossOrigin="Anonymous"),d.src=a[u],o.appendChild(d)}return{cancel:()=>{}}},i.aR=iv,i.aS=function(a){return fetch(a).then(e=>e.arrayBuffer()).then(e=>RE(e,0,a))},i.aT=$A,i.aU=class{constructor(a,e,o,u){this.id=a,this.position=e!=null?new ce(e[0],e[1]):new ce(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(de(a.matrix,e,a.matrix),a.meshes)for(const o of a.meshes){const u=Dr.applyTransformFast(o.aabb,a.matrix);this.aabb.encapsulate(u)}if(a.children)for(const o of a.children)this._applyTransformations(o,a.matrix)}computeBoundsAndApplyParent(){const a=W([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,o,u,d,g,y=!1){sA(this.matrix,this,a.transform,this.position,e,o,u,d,g,y)}upload(a){if(!this.uploaded){for(const e of this.nodes)Ib(e,a);for(const e of this.nodes)uv(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)Mb(a)}},i.aV=Qt,i.aW=v_,i.aX=Re,i.aY=Be,i.aZ=Yh,i.a_=Rs,i.aa=Hr,i.ab=Yc,i.ac=Le,i.ad=An,i.ae=Bn,i.af=ze,i.ag=ml,i.ah=pr,i.ai=Mn,i.aj=jt,i.ak=Sh,i.al=Sr,i.am=Ir,i.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return function([o,u]){const d=bi([1,o,u]);return{x:d.x,y:d.y,z:d.z}}(a.expression.evaluate(e))}interpolate(a,e,o){return{x:Mn(a.x,e.x,o),y:Mn(a.y,e.y,o),z:Mn(a.z,e.z,o)}}},i.ao=function(a,e,o=0,u=!0){const d=new Ot(o,o),g=a.sub(d),y=e.add(d),T=[g,new Ot(y.x,g.y),y,new Ot(g.x,y.y)];return u&&T.push(g.clone()),T},i.ap=function(a,e){const o=[];for(let u=0;u<a.length;u++){const d=We(u-1,-1,a.length-1),g=We(u+1,-1,a.length-1),y=a[u],T=a[g],C=a[d].sub(y).unit(),I=T.sub(y).unit(),N=I.angleWithSep(C.x,C.y),O=C.add(I).unit().mult(-1*e/Math.sin(N/2));o.push(y.add(O))}return o},i.aq=AC,i.ar=bc,i.as=function(a,e,o=0){return Ft(((e.x-o)*a.scale-a.x)*jt,(e.y*a.scale-a.y)*jt,Ge(e.z,e.y))},i.at=Or,i.au=Nn,i.av=gi,i.aw=FE,i.ax=function(a){let e=1/0,o=1/0,u=-1/0,d=-1/0;for(const g of a)e=Math.min(e,g.x),o=Math.min(o,g.y),u=Math.max(u,g.x),d=Math.max(d,g.y);return{min:new Ot(e,o),max:new Ot(u,d)}},i.ay=Ee,i.az=de,i.b=function(a){return Gs.API_FONTS_REGEX.test(a)},i.b$=function(a,e,o){o*=.5;var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+d*T,a[1]=d*C-u*T,a[2]=g*C+y*T,a[3]=y*C-g*T,a},i.b0=td,i.b1=nv,i.b2=function(){pl.isLoading()||pl.isLoaded()||fc()!=="deferred"||rp()},i.b3=Kd,i.b4=Bt,i.b5=oy,i.b6=Nr,i.b7=eb,i.b8=V1,i.b9=qt,i.bA=function(a,e){const{x:o,y:u}=a.point,d=dr(o,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return de(d,d,ut(Qe(e)))},i.bB=D,i.bC=function(a){return a[0]=0,a[1]=0,a[2]=0,a},i.bD=function(a,e){return Math.hypot(e[0]-a[0],e[1]-a[1],e[2]-a[2])},i.bE=qe,i.bF=un,i.bG=cn,i.bH=y_,i.bI=vl,i.bJ=lb,i.bK=function(a,e,o,u,d){const g=5*e+2;a.float32[g+0]=o,a.float32[g+1]=u,a.float32[g+2]=d},i.bL=tv,i.bM=zx,i.bN=Xo,i.bO=co,i.bP=Z2,i.bQ=eA,i.bR=Q2,i.bS=eE,i.bT=ab,i.bU=vC,i.bV=db,i.bW=Bb,i.bX=We,i.bY=Ht,i.bZ=$s,i.b_=to,i.ba=Hl,i.bb=Ys,i.bc=k,i.bd=si,i.be=t_,i.bf=xb,i.bg=function(a,e){const o=pr(e.zoom);if(o===0)return Qe(a);const u=an(a),d=Wn(u),g=Te(u.getWest())*e.worldSize,y=Te(u.getEast())*e.worldSize,T=be(u.getNorth())*e.worldSize,C=be(u.getSouth())*e.worldSize,I=[g,T,0],N=[y,T,0],O=[g,C,0],L=[y,C,0],V=re([],e.globeMatrix);return An(I,I,V),An(N,N,V),An(O,O,V),An(L,L,V),d[0]=Et(d[0],O,o),d[1]=Et(d[1],L,o),d[2]=Et(d[2],N,o),d[3]=Et(d[3],I,o),Dr.fromPoints(d)},i.bh=yt,i.bi=re,i.bj=tr,i.bk=Et,i.bl=Kh,i.bm=w,i.bn=kt,i.bo=Me,i.bp=_v,i.bq=Vx,i.br=Td,i.bs=function(a,e){const o=[];for(const u in a)u in e||o.push(u);return o},i.bt=je,i.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bv=qa,i.bw=function(a){var e=new P(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e},i.bx=W,i.by=Dt,i.bz=Y,i.c=Rf,i.c$=jx,i.c0=Qo,i.c1=Ui,i.c2=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},i.c3=fn,i.c4=function(a,e,o,u,d){var g,y=1/Math.tan(e/2);return a[0]=y/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=y,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,d!=null&&d!==1/0?(a[10]=(d+u)*(g=1/(u-d)),a[14]=2*d*u*g):(a[10]=-1,a[14]=-2*u),a},i.c5=function(a,e,o,u,d,g,y){var T=1/(e-o),C=1/(u-d),I=1/(g-y);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*I,a[11]=0,a[12]=(e+o)*T,a[13]=(d+u)*C,a[14]=(y+g)*I,a[15]=1,a},i.c6=Ie,i.c7=function(a,e,o){a[4*e+0]=o[0],a[4*e+1]=o[1],a[4*e+2]=o[2],a[4*e+3]=o[3]},i.c8=Ju,i.c9=qn,i.cA=av,i.cB=En,i.cC=XC,i.cD=function(a){const e=XC(a,!0);return D([],[e[0],e[1],e[4],e[5]])},i.cE=Fe,i.cF=Gr,i.cG=ht,i.cH=function(a){const{x:e,y:o}=a.point,{lng:u,lat:d}=a._center;return dr(e,o,a.worldSize,u,d)},i.cI=Cn,i.cJ=Ke,i.cK=au,i.cL=M,i.cM=function(a,e,o){let u=0;for(let d=0;d<2;++d)a[d]>0&&(u+=(a[d]-0)*(a[d]-0)),e[d]<0&&(u+=(0-e[d])*(0-e[d]));return u},i.cN=function(a){return a*a*a*a*a},i.cO=Ae,i.cP=45,i.cQ=vc,i.cR=function(a,e,o){const u=Math.sqrt(a*a+e*e+o*o),d=u>0?Math.acos(o/u)*Ql:0;let g=a!==0||e!==0?Math.atan2(-e,-a)*Ql+90:0;return g<0&&(g+=360),[u,g,d]},i.cS=Ft,i.cT=bi,i.cU=Je,i.cV=wn,i.cW=Dr,i.cX=Yt,i.cY=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},i.cZ=Cb,i.c_=function(a,e){return a.readFields(c3,{icons:[]},e)},i.ca=Xr,i.cb=ql,i.cc=rd,i.cd=ce,i.ce=RC,i.cf=function(){var a=new P(4);return P!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},i.cg=function(a,e,o){var u=e[0],d=e[1],g=e[2],y=e[3],T=Math.sin(o),C=Math.cos(o);return a[0]=u*C+g*T,a[1]=d*C+y*T,a[2]=u*-T+g*C,a[3]=d*-T+y*C,a},i.ch=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},i.ci=ni,i.cj=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},i.ck=Hs,i.cl=Zr,i.cm=Gm,i.cn=wi,i.co=KC,i.cp=df,i.cq=mn,i.cr=function(a,e,o,u,d,g,y,T,C){if(C.name==="globe")return mn(a,e,new df(o,u,d),!1);const I=v_({z:o,x:u,y:d},C);return new Dr([(g+I.x/I.scale)*e,e*(I.y/I.scale),y],[(g+I.x2/I.scale)*e,e*(I.y2/I.scale),T])},i.cs=function(a,e,o){return a[0]=Math.min(e[0],o[0]),a[1]=Math.min(e[1],o[1]),a[2]=Math.min(e[2],o[2]),a[3]=Math.min(e[3],o[3]),a},i.ct=function(a,e,o){return a[0]=Math.max(e[0],o[0]),a[1]=Math.max(e[1],o[1]),a[2]=Math.max(e[2],o[2]),a[3]=Math.max(e[3],o[3]),a},i.cu=function(a){const e=Math.round((a+45+360)%360/90)%4;return le[e]},i.cv=st,i.cw=mo,i.cx=R,i.cy=function(a){const e=W(new Float64Array(16));de(e,a.pixelMatrix,a.globeMatrix);const o=[0,$,0],u=[0,q,0];return An(o,o,e),An(u,u,e),[o[0]>0&&o[0]<=a.width&&o[1]>0&&o[1]<=a.height&&!zr(a,new ce(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!zr(a,new ce(a.center.lat,-90))]},i.cz=function(a,e){const{scale:o}=a.tileTransform,u=o*jt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(d,g,y){var T=g[1],C=g[2],I=g[3],N=y[0],O=y[1];return d[0]=g[0]*N,d[1]=T*N,d[2]=C*O,d[3]=I*O,d}(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},i.d=function(a){return Gs.API_TILEJSON_REGEX.test(a)},i.d$=gp,i.d0=Jg,i.d1=ub,i.d2=Sd,i.d3=nu,i.d4=Eo,i.d5=Su,i.d6=gn,i.d7=function(a){const e=a.indexOf(iu);return e>=0?a.slice(0,e):a},i.d8=function(a){return a.indexOf(iu)>=0},i.d9=function(a){const e=a.lastIndexOf(iu);return e>=0?a.slice(e+1):""},i.dA=Sn,i.dB=hs,i.dC=yo,i.dD=256,i.dE=function(a,e){const o=[0,0,0];return An(o,o,yt(Qe(e.canonical))),An(o,o,a),o},i.dF=a=>({u_matrix:new rd(a),u_texsize:new ql(a),u_pixels_to_tile_units:new eh(a),u_device_pixel_ratio:new Xr(a),u_width_scale:new Xr(a),u_floor_width_scale:new Xr(a),u_image:new Ju(a),u_units_to_pixels:new ql(a),u_tile_units_to_pixels:new Xr(a),u_alpha_discard_threshold:new Xr(a),u_trim_offset:new ql(a),u_trim_fade_range:new ql(a),u_trim_color:new vc(a),u_emissive_strength:new Xr(a),u_zbias_factor:new Xr(a),u_tile_to_meter:new Xr(a),u_ground_shadow_factor:new qn(a),u_pattern_transition:new Xr(a)}),i.dG=a=>({u_matrix:new rd(a),u_pixels_to_tile_units:new eh(a),u_device_pixel_ratio:new Xr(a),u_width_scale:new Xr(a),u_floor_width_scale:new Xr(a),u_units_to_pixels:new ql(a),u_dash_image:new Ju(a),u_gradient_image:new Ju(a),u_image_height:new Xr(a),u_texsize:new ql(a),u_tile_units_to_pixels:new Xr(a),u_alpha_discard_threshold:new Xr(a),u_trim_offset:new ql(a),u_trim_fade_range:new ql(a),u_trim_color:new vc(a),u_emissive_strength:new Xr(a),u_zbias_factor:new Xr(a),u_tile_to_meter:new Xr(a),u_ground_shadow_factor:new qn(a)}),i.dH=a=>({u_camera_to_center_distance:new Xr(a),u_extrude_scale:new eh(a),u_device_pixel_ratio:new Xr(a),u_matrix:new rd(a),u_inv_rot_matrix:new rd(a),u_merc_center:new ql(a),u_tile_id:new qn(a),u_zoom_transition:new Xr(a),u_up_dir:new qn(a),u_emissive_strength:new Xr(a)}),i.dI=tf,i.dJ=fj,i.dK=b2,i.dL=(a,e,o,u,d,g)=>{const y=a.transform,T=y.projection.name==="globe";let C;if(g.paint.get("circle-pitch-alignment")==="map")if(T){const N=Sn(y.zoom,e.canonical)*y._pixelsPerMercatorPixel;C=Float32Array.from([N,0,0,N])}else C=y.calculatePixelsToTileUnitsMatrix(o);else C=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(y.projection),u_matrix:a.translatePosMatrix(e.projMatrix,o,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Wa.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:N1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(T){I.u_inv_rot_matrix=u,I.u_merc_center=d,I.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],I.u_zoom_transition=pr(y.zoom);const N=d[0]*jt,O=d[1]*jt;I.u_up_dir=y.projection.upVector(new df(0,0,0),N,O)}return I},i.dM=$E,i.dN=Uo,i.dO=(a,e,o,u,d,g,y,T,C,I)=>{const N=a.transform,O=N.pitch<15?BE(.07,.7,Ee((14-N.zoom)/5,0,1)):.07,L=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:UE(a,e,o,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:N.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:d,u_width_scale:g,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:VE(e,N),u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:Je(e.tileID.canonical,0),u_ground_shadow_factor:C,u_pattern_transition:I}},i.dP=(a,e,o,u,d,g,y,T,C,I)=>{const N=a.transform,O=N.calculatePixelsToTileUnitsMatrix(e),L=o.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=N.pitch<15?BE(.07,.7,Ee((14-N.zoom)/5,0,1)):.07;return{u_matrix:UE(a,e,o,u),u_pixels_to_tile_units:O,u_device_pixel_ratio:g,u_width_scale:y,u_floor_width_scale:T,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:HE(o)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VE(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:C,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:Je(e.tileID.canonical,0),u_ground_shadow_factor:I}},i.dQ=Nt,i.dR=e_,i.dS=Ge,i.dT=R1,i.dU=Lx,i.dV=fE,i.dW=Ep,i.dX=450,i.dY=7,i.dZ=Zj,i.d_=Tr,i.da=function(a){const e=[],o=a.id;return o===void 0&&e.push({message:`layers.${o}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${o}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},i.db=function(a,e,o,u){return a.type==="custom"?new Xj(a,e):new a3[a.type](a,e,o,u)},i.dc=Wt,i.dd=function(a){const e=a.indexOf(iu);return e>=0?a.slice(e+1):""},i.de=class extends oy{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},i.df=rs,i.dg=Cl,i.dh=function(a){return a({pluginStatus:ao,pluginURL:ua}),rs.on("pluginStateChange",a),a},i.di=vp,i.dj=class extends xc{constructor(a){super(a),this.current=Qu}set(a,e,o){if(this.fetchUniformLocation(a,e)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},i.dk=ue,i.dl=function(a,e,o){const u=pr(o.zoom),d=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!d&&!g},i.dm=function(a){const e=a.pixelsPerMeter,o=e/Ie(1,a.center.lat),u=W(new Float64Array(16));return Me(u,u,[a.point.x,a.point.y,0]),Fe(u,u,[o,o,e]),Float32Array.from(u)},i.dn=an,i.dp=function(a){const e=st-5;a=Ee(a,-80.051129,e)/e*90;const o=Math.pow(Math.abs(Math.sin(Sr(a))),3);return Math.round(o*(G.length-1))},i.dq=function(a,e,o,u){const d=e.getNorth(),g=e.getSouth(),y=e.getWest(),T=e.getEast(),C=1<<a.z,I=T-y,N=d-g,O=I/F,L=-N/G[o],V=[0,O,0,L,0,0,d,y,0];if(a.z>0){const H=180/u;X(V,V,[H/I+1,0,0,0,H/N+1,0,-.5*H/O,.5*H/L,1])}return V[2]=C,V[5]=a.x,V[8]=a.y,V},i.dr=Qe,i.ds=function(a,e,o){const u=W(new Float64Array(16)),d=(e/(1<<a)-.5)*Math.PI*2;return at(u,o.globeMatrix,d),Float32Array.from(u)},i.dt=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const o=e.getSource().maxzoom,u=1<<o,d=Math.floor(a.x),g=Math.floor((a.x-d)*u),y=Math.floor(a.y*u),T=this.findDEMTileFor(new No(o,d,o,g,y));return!(!T||!T.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,o=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const u=this._source();if(!u||a.y<0||a.y>1)return e;const d=u.getSource().maxzoom,g=1<<d,y=Math.floor(a.x),T=a.x-y,C=new No(d,y,d,Math.floor(T*g),Math.floor(a.y*g)),I=this.findDEMTileFor(C);if(!I||!I.dem)return e;const N=I.dem,O=1<<I.tileID.canonical.z,L=(T*O-I.tileID.canonical.x)*N.dim,V=(a.y*O-I.tileID.canonical.y)*N.dim,H=Math.floor(L),K=Math.floor(V);return(o?this.exaggeration():1)*Mn(Mn(N.get(H,K),N.get(H,K+1),V-K),Mn(N.get(H+1,K),N.get(H+1,K+1),V-K),L-H)}getAtTileOffset(a,e,o){const u=1<<a.canonical.z;return this.getAtPointOrZero(new Le(a.wrap+(a.canonical.x+e/jt)/u,(a.canonical.y+o/jt)/u))}getAtTileOffsetFunc(a,e,o,u){return d=>{const g=this.getAtTileOffset(a,d.x,d.y),y=u.upVector(a.canonical,d.x,d.y);return Ht(y,y,g*u.upVectorScale(a.canonical,e,o).metersToTile),y}}getForTilePoints(a,e,o,u){if(this.isUsingMockSource())return!1;const d=ny.create(this,a,u);return!!d&&(e.forEach(g=>{g[2]=this.exaggeration()*d.getElevationAt(g[0],g[1],o)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const o=e.dem.tree,u=e.tileID,d=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/d-u.canonical.x,y=a.canonical.y/d-u.canonical.y,T=0;for(let C=0;C<a.canonical.z-u.canonical.z&&!o.leaves[T];C++){g*=2,y*=2;const I=2*Math.floor(y)+Math.floor(g);T=o.childOffsets[T]+I,g%=1,y%=1}return{min:this.exaggeration()*o.minimums[T],max:this.exaggeration()*o.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of a){const g=this.getMinMaxForTile(d.tileID);g&&(o=Math.min(o,g.min),u=Math.max(u,g.max),e=!0)}return e?{min:o,max:u}:null}},i.du=P2,i.dv=B,i.dw=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},i.dx=j,i.dy=function(a,e){var o=Math.sin(e),u=Math.cos(e);return a[0]=u,a[1]=o,a[2]=0,a[3]=-o,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},i.dz=Fn,i.e=Gs,i.e$=HA,i.e0=256,i.e1=ut,i.e2=gl,i.e3=at,i.e4=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},i.e5=_c,i.e6=Qh,i.e7=Ll,i.e8=function(a,e,o,u,d){return Ee((a-e)/(o-e)*(d-u)+u,u,d)},i.e9=To,i.eA=function(a,e,o){return a[0]=e[0]/o[0],a[1]=e[1]/o[1],a[2]=e[2]/o[2],a},i.eB=vs,i.eC=J,i.eD=Pn,i.eE=function(a,e,o,u){return a[0]=e,a[1]=o,a[2]=u,a},i.eF=function([a,e,o]){const u=Math.hypot(a,e,o),d=Math.atan2(a,o),g=.5*Math.PI-Math.acos(-e/u);return new ce(Ke(d),Ke(g))},i.eG=El,i.eH=Tb,i.eI=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!function(o){if(ji==null){const u=o.navigator?o.navigator.userAgent:null;ji=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ji}(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.eJ=function(a,e){Aa=a,pi=e},i.eK=zr,i.eL=Er,i.eM=function(a){const e=[0,0,0],o=W(new Float64Array(16));return de(o,a.pixelMatrix,a.globeMatrix),An(e,e,o),new Ot(e[0],e[1])},i.eN=function(){const a=h_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(Z1),h_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.eO=function(){jx().acquire(Z1)},i.eP=fc,i.eQ=function(a,e,o=!1){if(ao===oo.deferred||ao===oo.loading||ao===oo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ua=Wa.resolveURL(a),ao=oo.deferred,dc=e,Wh(),o||rp()},i.eR=function(a){Zg=Wa.resolveURL(a),Xg||(Xg=new Wg(jx(),new Fc)),Xg.broadcast("setMeshoptUrl",Zg)},i.eS=CE,i.eT=function(a){K1=Wa.resolveURL(a),Xg||(Xg=new Wg(jx(),new Fc)),Xg.broadcast("setDracoUrl",K1)},i.eU=EE,i.eV=u_,i.eW=function(a){const e=Dc();if(!e)return;const o=e.delete(ec);a&&o.then(()=>a()).catch(a)},i.eX=Xm,i.eY=Zt,i.eZ=Tp,i.e_=ih,i.ea=function(a,e){var o=e[0],u=e[1],d=e[2],g=e[3],y=e[4],T=e[5],C=e[6],I=e[7],N=e[8],O=N*y-T*I,L=-N*g+T*C,V=I*g-y*C,H=o*O+u*L+d*V;return H?(a[0]=O*(H=1/H),a[1]=(-N*u+d*I)*H,a[2]=(T*u-d*y)*H,a[3]=L*H,a[4]=(N*o-d*C)*H,a[5]=(-T*o+d*g)*H,a[6]=V*H,a[7]=(-I*o+u*C)*H,a[8]=(y*o-u*g)*H,a):null},i.eb=Zn,i.ec=mt,i.ed=Eb,i.ee=function(a,e){if(a===e){var o=e[1],u=e[2],d=e[3],g=e[6],y=e[7],T=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=o,a[6]=e[9],a[7]=e[13],a[8]=u,a[9]=g,a[11]=e[14],a[12]=d,a[13]=y,a[14]=T}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},i.ef=xn,i.eg=[1,1,1],i.eh=class{constructor(a,e,o,u){this.context=a,this.format=u,this.size=o,this.texture=a.gl.createTexture();const[d,g,y]=this.size,{gl:T}=a;T.bindTexture(T.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,d,g,y,0,vb(this.format),bb(this.format),e.data)}bind(a,e){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},i.ei=ny,i.ej=function(a,e,o,u){var d=new P(4);return d[0]=a,d[1]=e,d[2]=o,d[3]=u,d},i.ek=Hi,i.el=function(a,e,o,u){var d=e[0],g=e[1],y=e[2],T=e[3];return a[0]=d+u*(o[0]-d),a[1]=g+u*(o[1]-g),a[2]=y+u*(o[2]-y),a[3]=T+u*(o[3]-T),a},i.em=ty,i.en=yc,i.eo=Zu,i.ep=function(a,e,o,u,d,g,y,T,C,I,N,O,L,V,H,K){var te=new P(16);return te[0]=a,te[1]=e,te[2]=o,te[3]=u,te[4]=d,te[5]=g,te[6]=y,te[7]=T,te[8]=C,te[9]=I,te[10]=N,te[11]=O,te[12]=L,te[13]=V,te[14]=H,te[15]=K,te},i.eq=ie,i.er=nf,i.es=mp,i.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ot(1/0,1/0),max:new Ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const o=K2(new Ot(0,0),new Ot(jt,jt),a),u=[];if(e&&!$1(o,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!$1(o,d))continue;const g=kz(d.min,d.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(a){this._setSources(a.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const o=[];for(const u of e.cache.getVisibleCoordinates()){const d=e.cache.getTile(u).buckets[e.layer];d&&d.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const o=a.getOrder(),u=a.getClipMask(),d=a.getClipScope();for(const g of e){if(!g.footprint)continue;const y=K2(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:o,clipMask:u,clipScope:d})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,o)=>e.priority-o.priority||Dx(e.min,o.min)||Dx(e.max,o.max)||e.order-o.order||e.clipMask-o.clipMask||function(u,d){const g=(y,T)=>y+T;return u.length-d.length||u.reduce(g,"").localeCompare(d.reduce(g,""))}(e.clipScope,o.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const o=this._activeRegions[e],u=this._prevRegions[e];a=o.priority!==u.priority||!X2(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!qa(o.clipScope,u.clipScope),++e}}if(a){++this._updateTime;for(const o of this._activeRegions)o.order!==Nx&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const e=o=>{const u=this._activeRegions;if(o>=u.length)return o;const d=u[o].priority;for(;o<u.length&&u[o].priority===d;)++o;return o};if(this._sourceIds.length>1){let o=0,u=e(o);for(;o!==u;){let d=o;const g=o;for(;d!==u;){const y=this._activeRegions[d];y.hiddenByOverlap=!1;for(let T=0;T<g;T++){const C=this._activeRegions[T];if(!C.hiddenByOverlap&&y.order===Nx&&$1(y,C)&&(y.hiddenByOverlap=J2(y.footprint,y.tileId,C.footprint,C.tileId),y.hiddenByOverlap))break}++d}o=u,u=e(o)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},i.eu=Nx,i.ev=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const o=new Hl,u=new Rs,d=[],g=a+1+2,y=e[0]+1,T=e[0]+1+(1+e.length),C=(I,N,O)=>{let L=I===g-1?I-2:I===0?I:I-1;return L+=O?24575:0,[L,N]};for(let I=0;I<g;++I)o.emplaceBack(...C(I,0,!0));for(let I=0;I<y;++I)for(let N=0;N<g;++N)o.emplaceBack(...C(N,I,(N===0||N===g-1)&&!0));for(let I=0;I<e.length;++I){const N=e[I];for(let O=0;O<g;++O)o.emplaceBack(...C(O,N,!0))}for(let I=0;I<e.length;++I){const N=u.length,O=e[I]+1+2,L=new Rs;for(let K=0;K<O-1;K++){const te=K===O-2,ae=te?g*(T-e.length+I-K):g;for(let fe=0;fe<g-1;fe++){const pe=K*g+fe;K===0||te||fe===0||fe===g-2?(L.emplaceBack(pe+1,pe,pe+ae),L.emplaceBack(pe+ae,pe+ae+1,pe+1)):(u.emplaceBack(pe+1,pe,pe+ae),u.emplaceBack(pe+ae,pe+ae+1,pe+1))}}const V=si.simpleSegment(0,N,o.length,u.length-N);for(let K=0;K<L.uint16.length;K+=3)u.emplaceBack(L.uint16[K],L.uint16[K+1],L.uint16[K+2]);const H=si.simpleSegment(0,N,o.length,u.length-N);d.push({withoutSkirts:V,withSkirts:H})}return{vertices:o,indices:u,segments:d}}_createGrid(a){const e=this._fillGridMeshWithLods(F,G);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,k.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new Rs;for(let y=0;y<=F;y++)e.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const o=new _c,u=new _c,d=new _c,g=new _c;this._poleSegments=[];for(let y=0,T=0;y<M;y++){const C=360/(1<<y);o.emplaceBack(0,-E,0,.5,0),u.emplaceBack(0,-E,0,.5,1),d.emplaceBack(0,-E,0,.5,.5),g.emplaceBack(0,-E,0,.5,.5);for(let I=0;I<=F;I++){let N=I/F,O=0;const L=Mn(0,C,N),[V,H,K]=ne(Zi,sd,L,E);o.emplaceBack(V,H,K,N,O),u.emplaceBack(V,H,K,N,1-O);const te=Sr(L);N=.5+.5*Math.sin(te),O=.5+.5*Math.cos(te),d.emplaceBack(V,H,K,N,O),g.emplaceBack(V,H,K,N,1-O)}this._poleSegments.push(si.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(o,_,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,_,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(d,_,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,_,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},i.ew=ve,i.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.ey=Ne,i.ez=Ue,i.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(e,o)=>String.fromCharCode(+("0x"+o))))},i.f0=GA,i.f1=LE,i.f2=cr,i.f3="hd_road_elevation",i.f4=Oa,i.f5=ke,i.f6=Wm,i.f7=cb,i.f8=Km,i.f9=function(a,e,o,u,d,g,y,T=1,C,I,N){a.createArrays(),a.tilePixelRatio=jt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const O=a.layers[0].layout,L=a.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=T,V.textSizeScaleRange=O.get("text-size-scale-range"),V.iconSizeScaleRange=O.get("icon-size-scale-range");const[H,K]=V.textSizeScaleRange,[te,ae]=V.iconSizeScaleRange;V.textScaleFactor=Ee(V.scaleFactor,H,K),V.iconScaleFactor=Ee(V.scaleFactor,te,ae);const fe=L["text-size"],pe=L["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:Pe,maxZoom:Oe}=a.textSizeData;V.compositeTextSizes=[fe.possiblyEvaluate(new Hr(Pe,{worldview:N}),g),fe.possiblyEvaluate(new Hr(Oe,{worldview:N}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Pe,maxZoom:Oe}=a.iconSizeData;V.compositeIconSizes=[pe.possiblyEvaluate(new Hr(Pe,{worldview:N}),g),pe.possiblyEvaluate(new Hr(Oe,{worldview:N}),g)]}V.layoutTextSize=fe.possiblyEvaluate(new Hr(y+1,{worldview:N}),g),V.layoutIconSize=pe.possiblyEvaluate(new Hr(y+1,{worldview:N}),g),V.textMaxSize=fe.possiblyEvaluate(new Hr(18,{worldview:N}),g);const Q=O.get("symbol-placement"),he=O.get("text-rotation-alignment")==="map"&&Q!=="point",me=O.get("text-size");let _e=!1;const De=[];for(const Pe of a.features){const Oe=O.get("text-font").evaluate(Pe,{},g).join(","),Ve=me.evaluate(Pe,{},g)*V.textScaleFactor,tt=V.layoutTextSize.evaluate(Pe,{},g)*V.textScaleFactor,vt=V.layoutIconSize.evaluate(Pe,{},g)*V.iconScaleFactor,ft={horizontal:{},vertical:void 0},xt=Pe.text;let St,rt=[0,0];if(xt){const jn=xt.toString(),nr=O.get("text-letter-spacing").evaluate(Pe,{},g)*co,Kn=O.get("text-line-height").evaluate(Pe,{},g)*co,ur=tu(jn)?nr:0,ir=O.get("text-anchor").evaluate(Pe,{},g),hr=O.get("text-variable-anchor");if(!hr){const ot=O.get("text-radial-offset").evaluate(Pe,{},g);if(ot)rt=vC(ir,[ot*co,hb]);else{const Lt=O.get("text-offset").evaluate(Pe,{},g);rt=[Lt[0]*co,Lt[1]*co]}}let qr=he?"center":O.get("text-justify").evaluate(Pe,{},g);const Si=Q==="point",ye=Si?O.get("text-max-width").evaluate(Pe,{},g)*co:1/0,Se=ot=>{a.allowVerticalPlacement&&Ra(jn)&&(ft.vertical=ob(xt,e,o,d,Oe,ye,Kn,ir,ot,ur,rt,vl.vertical,!0,tt,Ve,C))};if(!he&&hr){const ot=qr==="auto"?hr.map(Gt=>db(Gt)):[qr];let Lt=!1;for(let Gt=0;Gt<ot.length;Gt++){const Ut=ot[Gt];if(!ft.horizontal[Ut])if(Lt)ft.horizontal[Ut]=ft.horizontal[0];else{const en=ob(xt,e,o,d,Oe,ye,Kn,"center",Ut,ur,rt,vl.horizontal,!1,tt,Ve,C);en&&(ft.horizontal[Ut]=en,Lt=en.positionedLines.length===1)}}Se("left")}else{if(qr==="auto"&&(qr=db(ir)),Si||O.get("text-writing-mode").indexOf("horizontal")>=0||!Ra(jn)){const ot=ob(xt,e,o,d,Oe,ye,Kn,ir,qr,ur,rt,vl.horizontal,!1,tt,Ve,C);ot&&(ft.horizontal[qr]=ot)}Se(Si?"left":qr)}}let _t,et,nt,Mt,Pt,_n,nn=!1;const $t=O.get("icon-text-fit").evaluate(Pe,{},g);if(Pe.icon&&Pe.icon.hasPrimary()){const jn=wC(Pe.icon,a.iconSizeData,L["icon-size"],g,a.zoom,Pe,C,V.iconScaleFactor,N);_t=jn.iconPrimary,nt=jn.iconSecondary;const nr=_t.toString();if(et=u.get(nr),et&&(Pt=O.get("icon-offset").evaluate(Pe,{},g),_n=O.get("icon-anchor").evaluate(Pe,{},g),St=Tj(d.get(nr),nt?d.get(nt.toString()):void 0,Pt,_n),nn=et.sdf,a.sdfIcons===void 0?a.sdfIcons=et.sdf:a.sdfIcons!==et.sdf&&Hn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==a.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),nt){const Kn=nt.toString();Mt=u.get(Kn)}}_e=_e||!(!Pe.icon||!Pe.icon.hasSecondary());const At=fb(ft.horizontal)||ft.vertical;a.iconsInText||(a.iconsInText=!!At&&At.iconsInText);const Gn=tt*V.textScaleFactor/co,{defaultShapedIcon:tn,verticallyShapedIcon:sn}=Dj(a,St,O,Pe,g,ft,Gn,Pt,$t);$t!=="none"&&St&&(iC(St)||sC(St))&&(Wx(0,et,_t,St,tn,$t,I,u,d),Wx(0,Mt,nt,St,tn,$t,I,u,d),sn&&(Wx(0,et,_t,St,sn,$t,I,u,d),Wx(0,Mt,nt,St,sn,$t,I,u,d))),St=tn,De.push({feature:Pe,shapedTextOrientations:ft,shapedText:At,shapedIcon:St,iconPrimary:_t,iconSecondary:nt,iconOffset:Pt,iconAnchor:_n,verticallyShapedIcon:sn,layoutTextSize:tt,layoutIconSize:vt,textOffset:rt,isSDFIcon:nn,iconTextFit:$t})}return{featureData:De,sizes:V,hasAnySecondaryIcon:_e,textAlongLine:he,symbolPlacement:Q}},i.fa=pC,i.fb=function(a,e,o,u,d,g,y,T,C,I){const{featureData:N,hasAnySecondaryIcon:O,sizes:L,textAlongLine:V,symbolPlacement:H}=e;for(const K of N){const{shapedIcon:te,verticallyShapedIcon:ae,feature:fe,shapedTextOrientations:pe,shapedText:Q,layoutTextSize:he,textOffset:me,isSDFIcon:_e,iconPrimary:De,iconSecondary:Pe,iconTextFit:Oe,iconOffset:Ve}=K;SC(te,I.iconPositions,De,Pe),SC(ae,I.iconPositions,De,Pe),Nj(pe,I.iconPositions),Rj(De,Pe,I.iconPositions),(Q||te)&&Oj(a,fe,pe,te,ae,C,L,he,0,me,_e,u,d,y,T,O,Oe,Ve,V,H)}o&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,L.textScaleFactor)},i.fc=er,i.fd=yv,i.fe=Ga,i.ff=Vn,i.fg=KE,i.fh=ui,i.fi=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==IE){const o=new Uint32Array(a,0,7),[,,u,d,g,y]=o;e=o.byteLength+d+g+y+g,(u!==a.byteLength||e>=a.byteLength)&&Hn("Invalid b3dm header information.")}return RE(a,e)},i.fj=function(a,e){const o=$A(a);for(const u of o){for(const d of u.meshes)iF(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(sF(u.lights,e)))}return o},i.fk=hv,i.fl=Fr,i.fm=SE,i.fn=pl,i.fo=oo,i.fp=function(a){vu(),ll?.then(e=>{e.keys().then(o=>{for(let u=0;u<o.length-a;u++)e.delete(o[u]).catch(d=>Hn(d.message))}).catch(o=>Hn(o.message))}).catch(e=>Hn(e.message))},i.g=function(a,e){return Cl(Xe(a,{method:"GET"}),e)},i.h=Xe,i.i=function(a){return Gs.API_STYLE_REGEX.test(a)&&!Rf(a)},i.j=function(a){return a.indexOf("mapbox:")===0},i.k=kc,i.l=wd,i.m=function(a){return decodeURIComponent(atob(a).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.n=function(a,e){return Cl(Xe(a,{type:"json"}),e)},i.o=bu,i.p=function(a,e){return Cl(Xe(a,{method:"POST"}),e)},i.q=Wa,i.r=Do,i.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=yh,i.u=function(){return function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},i.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},i.w=Hn,i.x=function(){return X1||(X1=new Xm),X1},i.y=Ob,i.z=cl}),m(["./shared"],function(i){function A(Ke){const le=Ke?Ke.url.toString():void 0;return le?performance.getEntriesByName(le):[]}function P(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let ue="[";for(const ve of Ke)ue+=`${P(ve)},`;return`${ue}]`}let le="{";for(const ue of Object.keys(Ke).sort())le+=`${ue}:${P(Ke[ue])},`;return`${le}}`}function D(Ke){let le="";for(const ue of i.bu)le+=`/${P(Ke[ue])}`;return le}class j{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,ue){this._layerConfigs={},this._layers={},this.update(le,[],ue)}update(le,ue,ve){this._options=ve;for(const Ee of le)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=i.db(Ee,this.scope,null,this._options)).compileFilter(ve),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ue)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Ne=function(Ee,ze){const We={};for(let Xe=0;Xe<Ee.length;Xe++){const dt=Ee[Xe];let Ze=ze&&ze[dt.id];Ze||(dt.type==="symbol"?Ze=dt.id:(Ze=D(dt),dt.type==="line"&&dt.paint&&function Qt(ke){return typeof ke=="string"&&ke==="line-progress"||(Array.isArray(ke)?ke.some(Qt):!(!ke||typeof ke!="object")&&Object.values(ke).some(Qt))}(dt.paint["line-width"])&&(Ze+=`/${P(dt.paint["line-width"])}`))),ze&&(ze[dt.id]=Ze);let Nt=We[Ze];Nt||(Nt=We[Ze]=[]),Nt.push(dt)}const je=[];for(const Xe in We)je.push(We[Xe]);return je}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Ne){const ze=Ee.map(Nt=>this._layers[Nt.id]),We=ze[0];if(We.visibility==="none")continue;const je=We.source||"";let Xe=this.familiesBySource[je];Xe||(Xe=this.familiesBySource[je]={});const dt=We.sourceLayer||"_geojsonTileLayer";let Ze=Xe[dt];Ze||(Ze=Xe[dt]=[]),Ze.push(ze)}}}const U=1*i.e_;class X{constructor(le){const ue={},ve=[];for(const We in le){const je=le[We],Xe=ue[We]={};for(const dt in je.glyphs){const Ze=je.glyphs[+dt];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Nt=Ze.metrics.localGlyph?U:1,Qt={x:0,y:0,w:Ze.bitmap.width+2*Nt,h:Ze.bitmap.height+2*Nt};ve.push(Qt),Xe[dt]=Qt}}const{w:Ne,h:Ee}=i.H(ve),ze=new i.eZ({width:Ne||1,height:Ee||1});for(const We in le){const je=le[We];for(const Xe in je.glyphs){const dt=je.glyphs[+Xe];if(!dt||dt.bitmap.width===0||dt.bitmap.height===0)continue;const Ze=ue[We][Xe],Nt=dt.metrics.localGlyph?U:1;i.eZ.copy(dt.bitmap,ze,{x:0,y:0},{x:Ze.x+Nt,y:Ze.y+Nt},dt.bitmap)}}this.image=ze,this.positions=ue}}i.eY(X,"GlyphAtlas");class Y{constructor(le){this.tileID=new i.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.lut=le.lut,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.scope=le.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.request&&le.request.collectResourceTiming,this.promoteId=le.promoteId,this.isSymbolTile=le.isSymbolTile,this.tileTransform=i.aW(le.tileID.canonical,le.projection),this.projection=le.projection,this.worldview=le.worldview,this.localizableLayerIds=le.localizableLayerIds,this.brightness=le.brightness,this.extraShadowCaster=!!le.extraShadowCaster,this.tessellationStep=le.tessellationStep,this.scaleFactor=le.scaleFactor,this.worldview=le.worldview}parse(le,ue,ve,Ne,Ee,ze){this.status="parsing",this.data=le,this.collisionBoxArray=new i.b0;const We=new i.e$(Object.keys(le.layers).sort()),je=new i.f0(this.tileID,this.promoteId);je.bucketLayerIDs=[];const Xe={},dt=new i.f1(256,256),Ze={featureIndex:je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:dt,availableImages:ve,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Nt=[],Qt=ue.familiesBySource[this.source];for(const Wt in Qt){const gn=le.layers[Wt];if(!gn)continue;let Un=!1,rr=!1,Hn=!1;for(const Fr of Qt[Wt])Fr[0].type==="symbol"?Un=!0:rr=!0,Fr[0].is3D()&&Fr[0].type!=="model"&&(Hn=!0);if(this.extraShadowCaster&&!Hn||this.isSymbolTile===!0&&!Un||this.isSymbolTile===!1&&!rr)continue;gn.version===1&&i.w(`Vector tile source "${this.source}" layer "${Wt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ri=We.encode(Wt),mr=[];let bi=!1;for(let Fr=0,Nr=0;Fr<gn.length;Fr++){const ji=gn.feature(Fr),Ui=je.getId(ji,Wt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Wt)){const Ri=ji.properties?ji.properties.worldview:null;if(this.worldview&&typeof Ri=="string")if(Ri==="all")ji.properties.$localized=!0;else{if(!Ri.split(",").includes(this.worldview))continue;ji.properties.$localized=!0,ji.properties.worldview=this.worldview}}!bi&&ji.properties&&ji.properties.hasOwnProperty(i.f2)&&(bi=!0),mr.push({feature:ji,id:Ui,index:Nr,sourceLayerIndex:ri}),Nr++}bi&&!Ze.elevationFeatures&&le.layers.hasOwnProperty(i.f3)&&(Ze.elevationFeatures=i.f4.parseFrom(le.layers[i.f3],this.canonical));for(const Fr of Qt[Wt]){const Nr=Fr[0];if(this.extraShadowCaster&&(!Nr.is3D()||Nr.type==="model")||this.isSymbolTile!==void 0&&Nr.type==="symbol"!==this.isSymbolTile||Nr.minzoom&&this.zoom<Math.floor(Nr.minzoom)||Nr.maxzoom&&this.zoom>=Nr.maxzoom||Nr.visibility==="none")continue;W(Fr,this.zoom,Ze.brightness,ve,this.worldview);const ji=Xe[Nr.id]=Nr.createBucket({index:je.bucketLayerIDs.length,layers:Fr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ri,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ne,worldview:this.worldview});je.bucketLayerIDs.push(Fr.map(Ri=>i.C(Ri.id,Ri.scope)));let Ui=ji.prepare?ji.prepare():null;Ui!=null?(Ui=Ui.then(()=>ji.populate(mr,Ze,this.tileID.canonical,this.tileTransform)),Nt.push(Ui)):ji.populate(mr,Ze,this.tileID.canonical,this.tileTransform)}}const ke=()=>{let Wt,gn,Un,rr,Hn,ri;dt.trim();const mr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},bi=()=>{if(Wt)return this.status="done",ze(Wt);if(this.extraShadowCaster)this.status="done",ze(null,{buckets:Object.values(Xe).filter(Nr=>!Nr.isEmpty()),featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(gn&&Un&&rr){const Nr=new X(gn),ji=new Map;for(const[gs,hs]of Un.entries()){const{imagePosition:yo}=i.f7(gs,hs,i.f8);ji.set(gs,yo)}const Ui={};for(const gs in Xe){const hs=Xe[gs];hs instanceof i.b1&&(W(hs.layers,this.zoom,Ze.brightness,ve,this.worldview),Ui[gs]=i.f9(hs,gn,Nr.positions,Un,ji,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Hn,this.worldview))}const Ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,Un,Hn,()=>{Ri.iconsPending=!1,Fr(Ui,Nr,Ri)}),this.rasterizeIfNeeded(Ee,rr,ri,()=>{Ri.patternsPending=!1,Fr(Ui,Nr,Ri)})}},Fr=(Nr,ji,Ui,Ri)=>{if(Ui.iconsPending||Ui.patternsPending)return;const gs=new i.fa(Un,rr,this.lut);for(const hs in Xe){const yo=Xe[hs];if(hs in Nr)i.fb(yo,Nr[hs],this.showCollisionBoxes,ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Un,gs);else if(yo.hasPattern&&(yo instanceof i.b7||yo instanceof i.b8||yo instanceof i.dU)){W(yo.layers,this.zoom,Ze.brightness,ve,this.worldview);const Bo=Object.fromEntries(gs.patternPositions);yo.addFeatures(Ze,this.tileID.canonical,Bo,ve,this.tileTransform,this.brightness)}}this.status="done",ze(null,{buckets:Object.values(Xe).filter(hs=>!hs.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ji.image,lineAtlas:dt,imageAtlas:gs,brightness:Ze.brightness})};if(!this.extraShadowCaster){const Nr=i.f5(Ze.glyphDependencies,Ri=>Object.keys(Ri).map(Number));Object.keys(Nr).length?Ee.send("getGlyphs",{uid:this.uid,stacks:Nr,scope:this.scope},(Ri,gs)=>{Wt||(Wt=Ri,gn=gs,bi())},void 0,!1,mr):gn={};const ji=Array.from(Ze.iconDependencies.keys()).map(Ri=>i.I.parse(Ri));ji.length?Ee.send("getImages",{images:ji,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ri,gs)=>{Wt||(Wt=Ri,Un=new Map,Hn=this.updateImageMapAndGetImageTaskQueue(Un,gs,Ze.iconDependencies),bi())},void 0,!1,mr):(Un=new Map,Hn=new Map);const Ui=Array.from(Ze.patternDependencies.keys()).map(Ri=>i.I.parse(Ri));Ui.length?Ee.send("getImages",{images:Ui,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ri,gs)=>{Wt||(Wt=Ri,rr=new Map,ri=this.updateImageMapAndGetImageTaskQueue(rr,gs,Ze.patternDependencies),bi())},void 0,!1,mr):(rr=new Map,ri=new Map)}if(Ze.elevationFeatures&&Ze.elevationFeatures.length>0){const Nr=[];for(const Ui of Object.values(Xe))if(Ui instanceof i.b8){const Ri=Ui.getUnevaluatedPortalGraph();Ri&&Nr.push(Ri)}const ji=i.f6.evaluate(Nr);for(const Ui of Object.values(Xe))if(Ui instanceof i.b8){const Ri=le.layers[We.decode(Ui.sourceLayerIndex)];Ui.setEvaluatedPortalGraph(ji,Ri,this.tileID.canonical,Ze.availableImages,Ze.brightness)}}bi()};Nt.length>0?Promise.allSettled(Nt).then(ke).catch(ze):ke()}rasterizeIfNeeded(le,ue,ve,Ne){Array.from(ue.values()).some(Ee=>Ee.usvg)?this.rasterize(le,ue,ve,Ne):Ne()}updateImageMapAndGetImageTaskQueue(le,ue,ve){const Ne=new Map;for(const Ee of ue.keys()){const ze=ve.get(Ee)||[];for(const We of ze){const je=We.toString(),Xe=ue.get(We.id.toString());Xe.usvg?Ne.has(je)||(Ne.set(je,We),le.set(je,Object.assign({},Xe))):le.set(je,Xe)}}return Ne}rasterize(le,ue,ve,Ne){this.rasterizeTask=le.send("rasterizeImages",{scope:this.scope,tasks:ve},(Ee,ze)=>{if(!Ee)for(const[We,je]of ze.entries()){const Xe=Object.assign(ue.get(We),{data:je});ue.set(We,Xe)}Ne()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function W(Ke,le,ue,ve,Ne){const Ee=new i.aa(le,{brightness:ue,worldview:Ne});for(const ze of Ke)ze.recalculate(Ee,ve)}class re extends i.E{constructor(le,ue,ve,Ne,Ee,ze,We){super(),this.actor=le,this.layerIndex=ue,this.availableImages=ve,this.availableModels=Ne,this.loadVectorData=ze||i.aJ,this.loading={},this.loaded={},this.deduped=new i.aI(le.scheduler),this.isSpriteLoaded=Ee,this.scheduler=le.scheduler,this.brightness=We}loadTile(le,ue){const ve=le.uid,Ne=le&&le.request,Ee=Ne&&Ne.collectResourceTiming,ze=this.loading[ve]=new Y(le);ze.abort=this.loadVectorData(le,(We,je)=>{const Xe=!this.loading[ve];if(delete this.loading[ve],ze.cancelRasterize(),Xe||We||!je)return ze.status="done",Xe||(this.loaded[ve]=ze),ue(We);const dt=je.rawData,Ze={};je.expires&&(Ze.expires=je.expires),je.cacheControl&&(Ze.cacheControl=je.cacheControl),ze.vectorTile=je.vectorTile||new i.fc.VectorTile(new i.bq(dt));const Nt=()=>{ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,ke)=>{if(Qt||!ke)return ue(Qt);const Wt={};if(Ee){const gn=A(Ne);gn.length>0&&(Wt.resourceTiming=JSON.parse(JSON.stringify(gn)))}ue(null,i.h({rawTileData:dt.slice(0)},ke,Ze,Wt))})};this.isSpriteLoaded?Nt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Nt,{type:"parseTile",isSymbolTile:le.isSymbolTile,zoom:le.tileZoom}):Nt()}),this.loaded=this.loaded||{},this.loaded[ve]=ze})}reloadTile(le,ue){const ve=this.loaded,Ne=le.uid;if(ve&&ve[Ne]){const Ee=ve[Ne];Ee.scaleFactor=le.scaleFactor,Ee.showCollisionBoxes=le.showCollisionBoxes,Ee.projection=le.projection,Ee.brightness=le.brightness,Ee.tileTransform=i.aW(le.tileID.canonical,le.projection),Ee.extraShadowCaster=le.extraShadowCaster,Ee.lut=le.lut,Ee.worldview=le.worldview;const ze=(We,je)=>{const Xe=Ee.reloadCallback;Xe&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),ue(We,je)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ze):ze())}else ue(null,void 0)}abortTile(le,ue){const ve=le.uid,Ne=this.loading[ve];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ve]),ue()}removeTile(le,ue){const ve=this.loaded,Ne=le.uid;ve&&ve[Ne]&&delete ve[Ne],ue()}}class de{loadTile(le,ue){const{uid:ve,encoding:Ne,rawImageData:Ee,padding:ze}=le,We=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,ze):Ee;ue(null,new i.fd(ve,We,Ne,ze<1))}reloadTile(le,ue){ue(null,null)}abortTile(le,ue){ue()}removeTile(le,ue){ue()}getImageData(le,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const ve=this.offscreenCanvasContext.getImageData(-ue,-ue,le.width+2*ue,le.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ve}}i.bp.setPbf(i.bq);class Me{constructor(le){this._mrt=new i.bp(le.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=le.uid,this.tileID=le.tileID,this.source=le.source}parse(le,ue){const ve=this._mrt;this.status="parsing",this._entireBuffer=le;try{ve.parseHeader(le),this._isHeaderLoaded=!0;const Ne=[];for(const Ee in ve.layers){const ze=ve.getLayer(Ee),We=ze.getDataRange(ze.getBandList()),je=ve.createDecodingTask(We),Xe=le.slice(We.firstByte,We.lastByte+1),dt=i.bp.performDecoding(Xe,je).then(Ze=>je.complete(null,Ze)).catch(Ze=>je.complete(Ze,null));Ne.push(dt)}Promise.allSettled(Ne).then(()=>ue(null,ve)).catch(Ee=>ue(Ee))}catch(Ne){ue(Ne)}}}class Fe{constructor(le){this.actor=le,this.loading={},this.loaded={}}loadTile(le,ue){const ve=le.uid,Ne=le.request,Ee=this.loading[ve]=new Me(le),{cancel:ze}=i.br(Ne,(We,je,Xe,dt)=>{const Ze=!this.loading[ve];if(delete this.loading[ve],Ze||We||!je)return Ee.status="done",Ze||(this.loaded[ve]=Ee),ue(We);Ee.parse(je,(Nt,Qt)=>{if(Nt||!Qt)return ue(Nt);ue(null,Qt,Xe,dt)}),this.loaded[ve]=Ee});Ee.abort=ze}reloadTile(le,ue){ue(null,void 0)}abortTile(le,ue){const ve=le.uid,Ne=this.loading[ve];Ne&&(Ne.abort&&Ne.abort(),delete this.loading[ve]),ue()}removeTile(le,ue){const ve=le.uid;this.loaded[ve]&&delete this.loaded[ve],ue()}decodeRasterArray(le,ue){i.bp.performDecoding(le.buffer,le.task).then(ve=>ue(null,ve)).catch(ve=>ue(ve))}}const ht=i.fc.VectorTileFeature.prototype.toGeoJSON;class at{constructor(le){this._feature=le,this.extent=i.aj,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(this._feature.type===1){const le=[];for(const ue of this._feature.geometry)le.push([new i.P(ue[0],ue[1])]);return le}{const le=[];for(const ue of this._feature.geometry){const ve=[];for(const Ne of ue)ve.push(new i.P(Ne[0],Ne[1]));le.push(ve)}return le}}toGeoJSON(le,ue,ve){return ht.call(this,le,ue,ve)}}class Dt{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.aj,this.length=le.length,this._features=le}feature(le){return new at(this._features[le])}}class kt{constructor(le,ue){this.name=le,this.extent=i.aj,this.length=ue.length,this._features=ue}feature(le){return new at(this._features[le])}}class Rt extends Dt{constructor(le){super([]),this.layers={};for(const ue in le)this.layers[ue]=new kt(ue,le[ue])}}const fn=64/4096,En=128;class xn{constructor(){this.features=new Map}clear(){this.features.clear()}load(le=[],ue){for(const ve of le){const Ne=ve.id;if(Ne==null)continue;let Ee=this.features.get(Ne);Ee&&this.updateCache(Ee,ue),ve.geometry?(Ee=Bn(ve),this.updateCache(Ee,ue),this.features.set(Ne,Ee)):this.features.delete(Ne),this.updateCache(Ee,ue)}}updateCache(le,ue){for(const{canonical:ve,uid:Ne}of Object.values(ue)){const{z:Ee,x:ze,y:We}=ve;Tn(le,Math.pow(2,Ee),ze,We)&&delete ue[Ne]}}getTile(le,ue,ve){const Ne=Math.pow(2,le),Ee=[];for(const ze of this.features.values())Tn(ze,Ne,ue,ve)&&Ee.push(Cn(ze,Ne,ue,ve));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function Tn({minX:Ke,minY:le,maxX:ue,maxY:ve},Ne,Ee,ze){return Ke<(Ee+1+fn)/Ne&&le<(ze+1+fn)/Ne&&ue>(Ee-fn)/Ne&&ve>(ze-fn)/Ne}function Bn(Ke){const{id:le,geometry:ue,properties:ve}=Ke;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ne,coordinates:Ee}=ue,ze={id:le,type:1,geometry:[],tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},We=ze.geometry;if(Ne==="Point")Ft(Ee,We,ze);else if(Ne==="MultiPoint")for(const je of Ee)Ft(je,We,ze);else if(Ne==="LineString")ze.type=2,wn(Ee,We,ze);else if(Ne==="MultiLineString")ze.type=2,Yt(Ee,We,ze);else if(Ne==="Polygon")ze.type=3,Yt(Ee,We,ze,!0);else{if(Ne!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ze.type=3;for(const je of Ee)Yt(je,We,ze,!0)}return ze}function Ft([Ke,le],ue,ve){const Ne=i.aD(Ke);let Ee=i.aH(le);Ee=Ee<0?0:Ee>1?1:Ee,ue.push(Ne,Ee),ve.minX=Math.min(ve.minX,Ne),ve.minY=Math.min(ve.minY,Ee),ve.maxX=Math.max(ve.maxX,Ne),ve.maxY=Math.max(ve.maxY,Ee)}function wn(Ke,le,ue,ve=!1,Ne=!1){const Ee=[];for(const ze of Ke)Ft(ze,Ee,ue);le.push(Ee),ve&&function(ze,We){let je=0;for(let Xe=0,dt=ze.length,Ze=dt-2;Xe<dt;Ze=Xe,Xe+=2)je+=(ze[Xe]-ze[Ze])*(ze[Xe+1]+ze[Ze+1]);if(je>0===We)for(let Xe=0,dt=ze.length;Xe<dt/2;Xe+=2){const Ze=ze[Xe],Nt=ze[Xe+1];ze[Xe]=ze[dt-2-Xe],ze[Xe+1]=ze[dt-1-Xe],ze[dt-2-Xe]=Ze,ze[dt-1-Xe]=Nt}}(Ee,Ne)}function Yt(Ke,le,ue,ve=!1){for(let Ne=0;Ne<Ke.length;Ne++)wn(Ke[Ne],le,ue,ve,Ne===0)}function Cn(Ke,le,ue,ve){const{id:Ne,type:Ee,geometry:ze,tags:We}=Ke,je=[];if(Ee===1)(function(Xe,dt,Ze,Nt,Qt){for(let ke=0;ke<Xe.length;ke+=2){const Wt=Math.round(i.aj*(Xe[ke+0]*dt-Ze)),gn=Math.round(i.aj*(Xe[ke+1]*dt-Nt));Qt.push([Wt,gn])}})(ze,le,ue,ve,je);else for(const Xe of ze)gt(Xe,le,ue,ve,je);return{id:Ne,type:Ee,geometry:je,tags:We}}function gt(Ke,le,ue,ve,Ne){const ze=i.aj+En;let We;for(let je=0;je<Ke.length-2;je+=2){let Xe=Math.round(i.aj*(Ke[je+0]*le-ue)),dt=Math.round(i.aj*(Ke[je+1]*le-ve)),Ze=Math.round(i.aj*(Ke[je+2]*le-ue)),Nt=Math.round(i.aj*(Ke[je+3]*le-ve));const Qt=Ze-Xe,ke=Nt-dt;Xe<-128&&Ze<-128||(Xe<-128?(dt+=Math.round(ke*((-128-Xe)/Qt)),Xe=-128):Ze<-128&&(Nt=dt+Math.round(ke*((-128-Xe)/Qt)),Ze=-128),dt<-128&&Nt<-128||(dt<-128?(Xe+=Math.round(Qt*((-128-dt)/ke)),dt=-128):Nt<-128&&(Ze=Xe+Math.round(Qt*((-128-dt)/ke)),Nt=-128),Xe>=ze&&Ze>=ze||(Xe>=ze?(dt+=Math.round(ke*((ze-Xe)/Qt)),Xe=ze):Ze>=ze&&(Nt=dt+Math.round(ke*((ze-Xe)/Qt)),Ze=ze),dt>=ze&&Nt>=ze||(dt>=ze?(Xe+=Math.round(Qt*((ze-dt)/ke)),dt=ze):Nt>=ze&&(Ze=Xe+Math.round(Qt*((ze-dt)/ke)),Nt=ze),We&&Xe===We[We.length-1][0]&&dt===We[We.length-1][1]||(We=[[Xe,dt]],Ne.push(We)),We.push([Ze,Nt])))))}}var Jt,Ht,qe,Ct={exports:{}},Pn=function(){if(qe)return Ct.exports;qe=1;var Ke=i.fg(),le=function(){if(Ht)return Jt;Ht=1;var dt=i.fe(),Ze=i.ff().VectorTileFeature;function Nt(ke,Wt){this.options=Wt||{},this.features=ke,this.length=ke.length}function Qt(ke,Wt){this.id=typeof ke.id=="number"?ke.id:void 0,this.type=ke.type,this.rawGeometry=ke.type===1?[ke.geometry]:ke.geometry,this.properties=ke.tags,this.extent=Wt||4096}return Jt=Nt,Nt.prototype.feature=function(ke){return new Qt(this.features[ke],this.options.extent)},Qt.prototype.loadGeometry=function(){var ke=this.rawGeometry;this.geometry=[];for(var Wt=0;Wt<ke.length;Wt++){for(var gn=ke[Wt],Un=[],rr=0;rr<gn.length;rr++)Un.push(new dt(gn[rr][0],gn[rr][1]));this.geometry.push(Un)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ke=this.geometry,Wt=1/0,gn=-1/0,Un=1/0,rr=-1/0,Hn=0;Hn<ke.length;Hn++)for(var ri=ke[Hn],mr=0;mr<ri.length;mr++){var bi=ri[mr];Wt=Math.min(Wt,bi.x),gn=Math.max(gn,bi.x),Un=Math.min(Un,bi.y),rr=Math.max(rr,bi.y)}return[Wt,Un,gn,rr]},Qt.prototype.toGeoJSON=Ze.prototype.toGeoJSON,Jt}();function ue(dt){var Ze=new Ke;return function(Nt,Qt){for(var ke in Nt.layers)Qt.writeMessage(3,ve,Nt.layers[ke])}(dt,Ze),Ze.finish()}function ve(dt,Ze){var Nt;Ze.writeVarintField(15,dt.version||1),Ze.writeStringField(1,dt.name||""),Ze.writeVarintField(5,dt.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(Nt=0;Nt<dt.length;Nt++)Qt.feature=dt.feature(Nt),Ze.writeMessage(2,Ne,Qt);var ke=Qt.keys;for(Nt=0;Nt<ke.length;Nt++)Ze.writeStringField(3,ke[Nt]);var Wt=Qt.values;for(Nt=0;Nt<Wt.length;Nt++)Ze.writeMessage(4,Xe,Wt[Nt])}function Ne(dt,Ze){var Nt=dt.feature;Nt.id!==void 0&&Ze.writeVarintField(1,Nt.id),Ze.writeMessage(2,Ee,dt),Ze.writeVarintField(3,Nt.type),Ze.writeMessage(4,je,Nt)}function Ee(dt,Ze){var Nt=dt.feature,Qt=dt.keys,ke=dt.values,Wt=dt.keycache,gn=dt.valuecache;for(var Un in Nt.properties){var rr=Nt.properties[Un],Hn=Wt[Un];if(rr!==null){Hn===void 0&&(Qt.push(Un),Wt[Un]=Hn=Qt.length-1),Ze.writeVarint(Hn);var ri=typeof rr;ri!=="string"&&ri!=="boolean"&&ri!=="number"&&(rr=JSON.stringify(rr));var mr=ri+":"+rr,bi=gn[mr];bi===void 0&&(ke.push(rr),gn[mr]=bi=ke.length-1),Ze.writeVarint(bi)}}}function ze(dt,Ze){return(Ze<<3)+(7&dt)}function We(dt){return dt<<1^dt>>31}function je(dt,Ze){for(var Nt=dt.loadGeometry(),Qt=dt.type,ke=0,Wt=0,gn=Nt.length,Un=0;Un<gn;Un++){var rr=Nt[Un],Hn=1;Qt===1&&(Hn=rr.length),Ze.writeVarint(ze(1,Hn));for(var ri=Qt===3?rr.length-1:rr.length,mr=0;mr<ri;mr++){mr===1&&Qt!==1&&Ze.writeVarint(ze(2,ri-1));var bi=rr[mr].x-ke,Fr=rr[mr].y-Wt;Ze.writeVarint(We(bi)),Ze.writeVarint(We(Fr)),ke+=bi,Wt+=Fr}Qt===3&&Ze.writeVarint(ze(7,1))}}function Xe(dt,Ze){var Nt=typeof dt;Nt==="string"?Ze.writeStringField(1,dt):Nt==="boolean"?Ze.writeBooleanField(7,dt):Nt==="number"&&(dt%1!=0?Ze.writeDoubleField(3,dt):dt<0?Ze.writeSVarintField(6,dt):Ze.writeVarintField(5,dt))}return Ct.exports=ue,Ct.exports.fromVectorTileJs=ue,Ct.exports.fromGeojsonVt=function(dt,Ze){Ze=Ze||{};var Nt={};for(var Qt in dt)Nt[Qt]=new le(dt[Qt].features,Ze),Nt[Qt].name=Qt,Nt[Qt].version=Ze.version,Nt[Qt].extent=Ze.extent;return ue({layers:Nt})},Ct.exports.GeoJSONWrapper=le,Ct.exports}(),Zn=i.fh(Pn);const Nn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},cn=Math.fround||(un=new Float32Array(1),Ke=>(un[0]=+Ke,un[0]));var un;const $n=3,An=5,Fn=6;class Zr{constructor(le){this.options=Object.assign(Object.create(Nn),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:ue,minZoom:ve,maxZoom:Ne}=this.options;ue&&console.time("total time");const Ee=`prepare ${le.length} points`;ue&&console.time(Ee),this.points=le;const ze=[];for(let je=0;je<le.length;je++){const Xe=le[je];if(!Xe.geometry)continue;const[dt,Ze]=Xe.geometry.coordinates,Nt=cn(vs(dt)),Qt=cn($s(Ze));ze.push(Nt,Qt,1/0,je,-1,1),this.options.reduce&&ze.push(0)}let We=this.trees[Ne+1]=this._createTree(ze);ue&&console.timeEnd(Ee);for(let je=Ne;je>=ve;je--){const Xe=+Date.now();We=this.trees[je]=this._createTree(this._cluster(We,je)),ue&&console.log("z%d: %d clusters in %dms",je,We.numItems,+Date.now()-Xe)}return ue&&console.timeEnd("total time"),this}getClusters(le,ue){let ve=((le[0]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,le[1]));let Ee=le[2]===180?180:((le[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)ve=-180,Ee=180;else if(ve>Ee){const Ze=this.getClusters([ve,Ne,180,ze],ue),Nt=this.getClusters([-180,Ne,Ee,ze],ue);return Ze.concat(Nt)}const We=this.trees[this._limitZoom(ue)],je=We.range(vs(ve),$s(ze),vs(Ee),$s(Ne)),Xe=We.data,dt=[];for(const Ze of je){const Nt=this.stride*Ze;dt.push(Xe[Nt+An]>1?ni(Xe,Nt,this.clusterProps):this.points[Xe[Nt+$n]])}return dt}getChildren(le){const ue=this._getOriginId(le),ve=this._getOriginZoom(le),Ne="No cluster with the specified id.",Ee=this.trees[ve];if(!Ee)throw new Error(Ne);const ze=Ee.data;if(ue*this.stride>=ze.length)throw new Error(Ne);const We=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),je=Ee.within(ze[ue*this.stride],ze[ue*this.stride+1],We),Xe=[];for(const dt of je){const Ze=dt*this.stride;ze[Ze+4]===le&&Xe.push(ze[Ze+An]>1?ni(ze,Ze,this.clusterProps):this.points[ze[Ze+$n]])}if(Xe.length===0)throw new Error(Ne);return Xe}getLeaves(le,ue,ve){const Ne=[];return this._appendLeaves(Ne,le,ue=ue||10,ve=ve||0,0),Ne}getTile(le,ue,ve){const Ne=this.trees[this._limitZoom(le)],Ee=Math.pow(2,le),{extent:ze,radius:We}=this.options,je=We/ze,Xe=(ve-je)/Ee,dt=(ve+1+je)/Ee,Ze={features:[]};return this._addTileFeatures(Ne.range((ue-je)/Ee,Xe,(ue+1+je)/Ee,dt),Ne.data,ue,ve,Ee,Ze),ue===0&&this._addTileFeatures(Ne.range(1-je/Ee,Xe,1,dt),Ne.data,Ee,ve,Ee,Ze),ue===Ee-1&&this._addTileFeatures(Ne.range(0,Xe,je/Ee,dt),Ne.data,-1,ve,Ee,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(le){let ue=this._getOriginZoom(le)-1;for(;ue<=this.options.maxZoom;){const ve=this.getChildren(le);if(ue++,ve.length!==1)break;le=ve[0].properties.cluster_id}return ue}_appendLeaves(le,ue,ve,Ne,Ee){const ze=this.getChildren(ue);for(const We of ze){const je=We.properties;if(je&&je.cluster?Ee+je.point_count<=Ne?Ee+=je.point_count:Ee=this._appendLeaves(le,je.cluster_id,ve,Ne,Ee):Ee<Ne?Ee++:le.push(We),le.length===ve)break}return Ee}_createTree(le){const ue=new i.bW(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ve=0;ve<le.length;ve+=this.stride)ue.add(le[ve],le[ve+1]);return ue.finish(),ue.data=le,ue}_addTileFeatures(le,ue,ve,Ne,Ee,ze){for(const We of le){const je=We*this.stride,Xe=ue[je+An]>1;let dt,Ze,Nt;if(Xe)dt=Or(ue,je,this.clusterProps),Ze=ue[je],Nt=ue[je+1];else{const Wt=this.points[ue[je+$n]];dt=Wt.properties;const[gn,Un]=Wt.geometry.coordinates;Ze=vs(gn),Nt=$s(Un)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(Ze*Ee-ve)),Math.round(this.options.extent*(Nt*Ee-Ne))]],tags:dt};let ke;ke=Xe||this.options.generateId?ue[je+$n]:this.points[ue[je+$n]].id,ke!==void 0&&(Qt.id=ke),ze.features.push(Qt)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,ue){const{radius:ve,extent:Ne,reduce:Ee,minPoints:ze}=this.options,We=ve/(Ne*Math.pow(2,ue)),je=le.data,Xe=[],dt=this.stride;for(let Ze=0;Ze<je.length;Ze+=dt){if(je[Ze+2]<=ue)continue;je[Ze+2]=ue;const Nt=je[Ze],Qt=je[Ze+1],ke=le.within(je[Ze],je[Ze+1],We),Wt=je[Ze+An];let gn=Wt;for(const Un of ke){const rr=Un*dt;je[rr+2]>ue&&(gn+=je[rr+An])}if(gn>Wt&&gn>=ze){let Un,rr=Nt*Wt,Hn=Qt*Wt,ri=-1;const mr=(Ze/dt<<5)+(ue+1)+this.points.length;for(const bi of ke){const Fr=bi*dt;if(je[Fr+2]<=ue)continue;je[Fr+2]=ue;const Nr=je[Fr+An];rr+=je[Fr]*Nr,Hn+=je[Fr+1]*Nr,je[Fr+4]=mr,Ee&&(Un||(Un=this._map(je,Ze,!0),ri=this.clusterProps.length,this.clusterProps.push(Un)),Ee(Un,this._map(je,Fr)))}je[Ze+4]=mr,Xe.push(rr/gn,Hn/gn,1/0,mr,-1,gn),Ee&&Xe.push(ri)}else{for(let Un=0;Un<dt;Un++)Xe.push(je[Ze+Un]);if(gn>1)for(const Un of ke){const rr=Un*dt;if(!(je[rr+2]<=ue)){je[rr+2]=ue;for(let Hn=0;Hn<dt;Hn++)Xe.push(je[rr+Hn])}}}}return Xe}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,ue,ve){if(le[ue+An]>1){const ze=this.clusterProps[le[ue+Fn]];return ve?Object.assign({},ze):ze}const Ne=this.points[le[ue+$n]].properties,Ee=this.options.map(Ne);return ve&&Ee===Ne?Object.assign({},Ee):Ee}}function ni(Ke,le,ue){return{type:"Feature",id:Ke[le+$n],properties:Or(Ke,le,ue),geometry:{type:"Point",coordinates:[(ve=Ke[le],360*(ve-.5)),Hi(Ke[le+1])]}};var ve}function Or(Ke,le,ue){const ve=Ke[le+An],Ne=ve>=1e4?`${Math.round(ve/1e3)}k`:ve>=1e3?Math.round(ve/100)/10+"k":ve,Ee=Ke[le+Fn],ze=Ee===-1?{}:Object.assign({},ue[Ee]);return Object.assign(ze,{cluster:!0,cluster_id:Ke[le+$n],point_count:ve,point_count_abbreviated:Ne})}function vs(Ke){return Ke/360+.5}function $s(Ke){const le=Math.sin(Ke*Math.PI/180),ue=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ue<0?0:ue>1?1:ue}function Hi(Ke){const le=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function mo(Ke,le,ue,ve){let Ne=ve;const Ee=le+(ue-le>>1);let ze,We=ue-le;const je=Ke[le],Xe=Ke[le+1],dt=Ke[ue],Ze=Ke[ue+1];for(let Nt=le+3;Nt<ue;Nt+=3){const Qt=El(Ke[Nt],Ke[Nt+1],je,Xe,dt,Ze);if(Qt>Ne)ze=Nt,Ne=Qt;else if(Qt===Ne){const ke=Math.abs(Nt-Ee);ke<We&&(ze=Nt,We=ke)}}Ne>ve&&(ze-le>3&&mo(Ke,le,ze,ve),Ke[ze+2]=Ne,ue-ze>3&&mo(Ke,ze,ue,ve))}function El(Ke,le,ue,ve,Ne,Ee){let ze=Ne-ue,We=Ee-ve;if(ze!==0||We!==0){const je=((Ke-ue)*ze+(le-ve)*We)/(ze*ze+We*We);je>1?(ue=Ne,ve=Ee):je>0&&(ue+=ze*je,ve+=We*je)}return ze=Ke-ue,We=le-ve,ze*ze+We*We}function zi(Ke,le,ue,ve){const Ne={id:Ke??null,type:le,geometry:ue,tags:ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(le==="Point"||le==="MultiPoint"||le==="LineString")Ki(Ne,ue);else if(le==="Polygon")Ki(Ne,ue[0]);else if(le==="MultiLineString")for(const Ee of ue)Ki(Ne,Ee);else if(le==="MultiPolygon")for(const Ee of ue)Ki(Ne,Ee[0]);return Ne}function Ki(Ke,le){for(let ue=0;ue<le.length;ue+=3)Ke.minX=Math.min(Ke.minX,le[ue]),Ke.minY=Math.min(Ke.minY,le[ue+1]),Ke.maxX=Math.max(Ke.maxX,le[ue]),Ke.maxY=Math.max(Ke.maxY,le[ue+1])}function to(Ke,le,ue,ve){if(!le.geometry)return;const Ne=le.geometry.coordinates;if(Ne&&Ne.length===0)return;const Ee=le.geometry.type,ze=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let We=[],je=le.id;if(ue.promoteId?je=le.properties[ue.promoteId]:ue.generateId&&(je=ve||0),Ee==="Point")Qo(Ne,We);else if(Ee==="MultiPoint")for(const Xe of Ne)Qo(Xe,We);else if(Ee==="LineString")To(Ne,We,ze,!1);else if(Ee==="MultiLineString"){if(ue.lineMetrics){for(const Xe of Ne)We=[],To(Xe,We,ze,!1),Ke.push(zi(je,"LineString",We,le.properties));return}Cs(Ne,We,ze,!1)}else if(Ee==="Polygon")Cs(Ne,We,ze,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Xe of le.geometry.geometries)to(Ke,{id:je,geometry:Xe,properties:le.properties},ue,ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Ne){const dt=[];Cs(Xe,dt,ze,!0),We.push(dt)}}Ke.push(zi(je,Ee,We,le.properties))}function Qo(Ke,le){le.push(Ua(Ke[0]),wa(Ke[1]),0)}function To(Ke,le,ue,ve){let Ne,Ee,ze=0;for(let je=0;je<Ke.length;je++){const Xe=Ua(Ke[je][0]),dt=wa(Ke[je][1]);le.push(Xe,dt,0),je>0&&(ze+=ve?(Ne*dt-Xe*Ee)/2:Math.sqrt(Math.pow(Xe-Ne,2)+Math.pow(dt-Ee,2))),Ne=Xe,Ee=dt}const We=le.length-3;le[2]=1,mo(le,0,We,ue),le[We+2]=1,le.size=Math.abs(ze),le.start=0,le.end=le.size}function Cs(Ke,le,ue,ve){for(let Ne=0;Ne<Ke.length;Ne++){const Ee=[];To(Ke[Ne],Ee,ue,ve),le.push(Ee)}}function Ua(Ke){return Ke/360+.5}function wa(Ke){const le=Math.sin(Ke*Math.PI/180),ue=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return ue<0?0:ue>1?1:ue}function is(Ke,le,ue,ve,Ne,Ee,ze,We){if(ve/=le,Ee>=(ue/=le)&&ze<ve)return Ke;if(ze<ue||Ee>=ve)return null;const je=[];for(const Xe of Ke){const dt=Xe.geometry;let Ze=Xe.type;const Nt=Ne===0?Xe.minX:Xe.minY,Qt=Ne===0?Xe.maxX:Xe.maxY;if(Nt>=ue&&Qt<ve){je.push(Xe);continue}if(Qt<ue||Nt>=ve)continue;let ke=[];if(Ze==="Point"||Ze==="MultiPoint")Sa(dt,ke,ue,ve,Ne);else if(Ze==="LineString")Hs(dt,ke,ue,ve,Ne,!1,We.lineMetrics);else if(Ze==="MultiLineString")ss(dt,ke,ue,ve,Ne,!1);else if(Ze==="Polygon")ss(dt,ke,ue,ve,Ne,!0);else if(Ze==="MultiPolygon")for(const Wt of dt){const gn=[];ss(Wt,gn,ue,ve,Ne,!0),gn.length&&ke.push(gn)}if(ke.length){if(We.lineMetrics&&Ze==="LineString"){for(const Wt of ke)je.push(zi(Xe.id,Ze,Wt,Xe.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(ke.length===1?(Ze="LineString",ke=ke[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=ke.length===3?"Point":"MultiPoint"),je.push(zi(Xe.id,Ze,ke,Xe.tags))}}return je.length?je:null}function Sa(Ke,le,ue,ve,Ne){for(let Ee=0;Ee<Ke.length;Ee+=3){const ze=Ke[Ee+Ne];ze>=ue&&ze<=ve&&go(le,Ke[Ee],Ke[Ee+1],Ke[Ee+2])}}function Hs(Ke,le,ue,ve,Ne,Ee,ze){let We=Fo(Ke);const je=Ne===0?Ta:Ea;let Xe,dt,Ze=Ke.start;for(let gn=0;gn<Ke.length-3;gn+=3){const Un=Ke[gn],rr=Ke[gn+1],Hn=Ke[gn+2],ri=Ke[gn+3],mr=Ke[gn+4],bi=Ne===0?Un:rr,Fr=Ne===0?ri:mr;let Nr=!1;ze&&(Xe=Math.sqrt(Math.pow(Un-ri,2)+Math.pow(rr-mr,2))),bi<ue?Fr>ue&&(dt=je(We,Un,rr,ri,mr,ue),ze&&(We.start=Ze+Xe*dt)):bi>ve?Fr<ve&&(dt=je(We,Un,rr,ri,mr,ve),ze&&(We.start=Ze+Xe*dt)):go(We,Un,rr,Hn),Fr<ue&&bi>=ue&&(dt=je(We,Un,rr,ri,mr,ue),Nr=!0),Fr>ve&&bi<=ve&&(dt=je(We,Un,rr,ri,mr,ve),Nr=!0),!Ee&&Nr&&(ze&&(We.end=Ze+Xe*dt),le.push(We),We=Fo(Ke)),ze&&(Ze+=Xe)}let Nt=Ke.length-3;const Qt=Ke[Nt],ke=Ke[Nt+1],Wt=Ne===0?Qt:ke;Wt>=ue&&Wt<=ve&&go(We,Qt,ke,Ke[Nt+2]),Nt=We.length-3,Ee&&Nt>=3&&(We[Nt]!==We[0]||We[Nt+1]!==We[1])&&go(We,We[0],We[1],We[2]),We.length&&le.push(We)}function Fo(Ke){const le=[];return le.size=Ke.size,le.start=Ke.start,le.end=Ke.end,le}function ss(Ke,le,ue,ve,Ne,Ee){for(const ze of Ke)Hs(ze,le,ue,ve,Ne,Ee,!1)}function go(Ke,le,ue,ve){Ke.push(le,ue,ve)}function Ta(Ke,le,ue,ve,Ne,Ee){const ze=(Ee-le)/(ve-le);return go(Ke,Ee,ue+(Ne-ue)*ze,1),ze}function Ea(Ke,le,ue,ve,Ne,Ee){const ze=(Ee-ue)/(Ne-ue);return go(Ke,le+(ve-le)*ze,Ee,1),ze}function Ca(Ke,le){const ue=[];for(let ve=0;ve<Ke.length;ve++){const Ne=Ke[ve],Ee=Ne.type;let ze;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ze=As(Ne.geometry,le);else if(Ee==="MultiLineString"||Ee==="Polygon"){ze=[];for(const We of Ne.geometry)ze.push(As(We,le))}else if(Ee==="MultiPolygon"){ze=[];for(const We of Ne.geometry){const je=[];for(const Xe of We)je.push(As(Xe,le));ze.push(je)}}ue.push(zi(Ne.id,Ee,ze,Ne.tags))}return ue}function As(Ke,le){const ue=[];ue.size=Ke.size,Ke.start!==void 0&&(ue.start=Ke.start,ue.end=Ke.end);for(let ve=0;ve<Ke.length;ve+=3)ue.push(Ke[ve]+le,Ke[ve+1],Ke[ve+2]);return ue}function $a(Ke,le){if(Ke.transformed)return Ke;const ue=1<<Ke.z,ve=Ke.x,Ne=Ke.y;for(const Ee of Ke.features){const ze=Ee.geometry,We=Ee.type;if(Ee.geometry=[],We===1)for(let je=0;je<ze.length;je+=2)Ee.geometry.push(On(ze[je],ze[je+1],le,ue,ve,Ne));else for(let je=0;je<ze.length;je++){const Xe=[];for(let dt=0;dt<ze[je].length;dt+=2)Xe.push(On(ze[je][dt],ze[je][dt+1],le,ue,ve,Ne));Ee.geometry.push(Xe)}}return Ke.transformed=!0,Ke}function On(Ke,le,ue,ve,Ne,Ee){return[Math.round(ue*(Ke*ve-Ne)),Math.round(ue*(le*ve-Ee))]}function ui(Ke,le,ue,ve,Ne){const Ee=le===Ne.maxZoom?0:Ne.tolerance/((1<<le)*Ne.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:ue,y:ve,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Ke)fi(ze,We,Ee,Ne);return ze}function fi(Ke,le,ue,ve){const Ne=le.geometry,Ee=le.type,ze=[];if(Ke.minX=Math.min(Ke.minX,le.minX),Ke.minY=Math.min(Ke.minY,le.minY),Ke.maxX=Math.max(Ke.maxX,le.maxX),Ke.maxY=Math.max(Ke.maxY,le.maxY),Ee==="Point"||Ee==="MultiPoint")for(let We=0;We<Ne.length;We+=3)ze.push(Ne[We],Ne[We+1]),Ke.numPoints++,Ke.numSimplified++;else if(Ee==="LineString")Vi(ze,Ne,Ke,ue,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let We=0;We<Ne.length;We++)Vi(ze,Ne[We],Ke,ue,Ee==="Polygon",We===0);else if(Ee==="MultiPolygon")for(let We=0;We<Ne.length;We++){const je=Ne[We];for(let Xe=0;Xe<je.length;Xe++)Vi(ze,je[Xe],Ke,ue,!0,Xe===0)}if(ze.length){let We=le.tags||null;if(Ee==="LineString"&&ve.lineMetrics){We={};for(const Xe in le.tags)We[Xe]=le.tags[Xe];We.mapbox_clip_start=Ne.start/Ne.size,We.mapbox_clip_end=Ne.end/Ne.size}const je={geometry:ze,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:We};le.id!==null&&(je.id=le.id),Ke.features.push(je)}}function Vi(Ke,le,ue,ve,Ne,Ee){const ze=ve*ve;if(ve>0&&le.size<(Ne?ze:ve))return void(ue.numPoints+=le.length/3);const We=[];for(let je=0;je<le.length;je+=3)(ve===0||le[je+2]>ze)&&(ue.numSimplified++,We.push(le[je],le[je+1])),ue.numPoints++;Ne&&function(je,Xe){let dt=0;for(let Ze=0,Nt=je.length,Qt=Nt-2;Ze<Nt;Qt=Ze,Ze+=2)dt+=(je[Ze]-je[Qt])*(je[Ze+1]+je[Qt+1]);if(dt>0===Xe)for(let Ze=0,Nt=je.length;Ze<Nt/2;Ze+=2){const Qt=je[Ze],ke=je[Ze+1];je[Ze]=je[Nt-2-Ze],je[Ze+1]=je[Nt-1-Ze],je[Nt-2-Ze]=Qt,je[Nt-1-Ze]=ke}}(We,Ee),Ke.push(We)}const Is={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ha{constructor(le,ue){const ve=(ue=this.options=function(Ee,ze){for(const We in ze)Ee[We]=ze[We];return Ee}(Object.create(Is),ue)).debug;if(ve&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ne=function(Ee,ze){const We=[];if(Ee.type==="FeatureCollection")for(let je=0;je<Ee.features.length;je++)to(We,Ee.features[je],ze,je);else to(We,Ee.type==="Feature"?Ee:{geometry:Ee},ze);return We}(le,ue);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=function(Ee,ze){const We=ze.buffer/ze.extent;let je=Ee;const Xe=is(Ee,1,-1-We,We,0,-1,2,ze),dt=is(Ee,1,1-We,2+We,0,-1,2,ze);return(Xe||dt)&&(je=is(Ee,1,-We,1+We,0,-1,2,ze)||[],Xe&&(je=Ca(Xe,1).concat(je)),dt&&(je=je.concat(Ca(dt,-1)))),je}(Ne,ue),Ne.length&&this.splitTile(Ne,0,0,0),ve&&(Ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(le,ue,ve,Ne,Ee,ze,We){const je=[le,ue,ve,Ne],Xe=this.options,dt=Xe.debug;for(;je.length;){Ne=je.pop(),ve=je.pop(),ue=je.pop(),le=je.pop();const Ze=1<<ue,Nt=Ga(ue,ve,Ne);let Qt=this.tiles[Nt];if(!Qt&&(dt>1&&console.time("creation"),Qt=this.tiles[Nt]=ui(le,ue,ve,Ne,Xe),this.tileCoords.push({z:ue,x:ve,y:Ne}),dt)){dt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ve,Ne,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Nr=`z${ue}`;this.stats[Nr]=(this.stats[Nr]||0)+1,this.total++}if(Qt.source=le,Ee==null){if(ue===Xe.indexMaxZoom||Qt.numPoints<=Xe.indexMaxPoints)continue}else{if(ue===Xe.maxZoom||ue===Ee)continue;if(Ee!=null){const Nr=Ee-ue;if(ve!==ze>>Nr||Ne!==We>>Nr)continue}}if(Qt.source=null,le.length===0)continue;dt>1&&console.time("clipping");const ke=.5*Xe.buffer/Xe.extent,Wt=.5-ke,gn=.5+ke,Un=1+ke;let rr=null,Hn=null,ri=null,mr=null,bi=is(le,Ze,ve-ke,ve+gn,0,Qt.minX,Qt.maxX,Xe),Fr=is(le,Ze,ve+Wt,ve+Un,0,Qt.minX,Qt.maxX,Xe);le=null,bi&&(rr=is(bi,Ze,Ne-ke,Ne+gn,1,Qt.minY,Qt.maxY,Xe),Hn=is(bi,Ze,Ne+Wt,Ne+Un,1,Qt.minY,Qt.maxY,Xe),bi=null),Fr&&(ri=is(Fr,Ze,Ne-ke,Ne+gn,1,Qt.minY,Qt.maxY,Xe),mr=is(Fr,Ze,Ne+Wt,Ne+Un,1,Qt.minY,Qt.maxY,Xe),Fr=null),dt>1&&console.timeEnd("clipping"),je.push(rr||[],ue+1,2*ve,2*Ne),je.push(Hn||[],ue+1,2*ve,2*Ne+1),je.push(ri||[],ue+1,2*ve+1,2*Ne),je.push(mr||[],ue+1,2*ve+1,2*Ne+1)}}getTile(le,ue,ve){le=+le,ue=+ue,ve=+ve;const Ne=this.options,{extent:Ee,debug:ze}=Ne;if(le<0||le>24)return null;const We=1<<le,je=Ga(le,ue=ue+We&We-1,ve);if(this.tiles[je])return $a(this.tiles[je],Ee);ze>1&&console.log("drilling down to z%d-%d-%d",le,ue,ve);let Xe,dt=le,Ze=ue,Nt=ve;for(;!Xe&&dt>0;)dt--,Ze>>=1,Nt>>=1,Xe=this.tiles[Ga(dt,Ze,Nt)];return Xe&&Xe.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",dt,Ze,Nt),console.time("drilling down")),this.splitTile(Xe.source,dt,Ze,Nt,le,ue,ve),ze>1&&console.timeEnd("drilling down"),this.tiles[je]?$a(this.tiles[je],Ee):null):null}}function Ga(Ke,le,ue){return 32*((1<<Ke)*ue+le)+Ke}function Ot(Ke,le){const ue=Ke.tileID.canonical;if(!this._geoJSONIndex)return void le(null,null);const ve=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!ve)return void le(null,null);const Ne=je=>je.tags&&"3d_elevation_id"in je.tags&&"source"in je.tags&&je.tags.source==="elevation",Ee=ve.features.filter(je=>Ne(je));let ze;if(Ee.length>0){const je=ve.features.filter(Xe=>!Ne(Xe));ze=new Rt({_geojsonTileLayer:je,hd_road_elevation:Ee})}else ze=new Dt(ve.features);let We=Zn(ze);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),le(null,{vectorTile:ze,rawData:We.buffer})}class qa extends re{constructor(le,ue,ve,Ne,Ee,ze,We){super(le,ue,ve,Ne,Ee,Ot,We),ze&&(this.loadGeoJSON=ze),this._dynamicIndex=new xn}loadData(le,ue){const ve=le&&le.request,Ne=ve&&ve.collectResourceTiming;this.loadGeoJSON(le,(Ee,ze)=>{if(Ee||!ze)return ue(Ee);if(typeof ze!="object")return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{try{if(le.filter){const je=i.X(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));ze.features=ze.features.filter(Xe=>je.value.evaluate({zoom:0},Xe))}le.dynamic?(ze.type==="Feature"&&(ze={type:"FeatureCollection",features:[ze]}),le.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ze.features,this.loaded),le.cluster&&(ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=le.cluster?new Zr(function({superclusterOptions:je,clusterProperties:Xe}){if(!Xe||!je)return je;const dt={},Ze={},Nt={accumulated:null,zoom:0},Qt={properties:null},ke=Object.keys(Xe);for(const Wt of ke){const[gn,Un]=Xe[Wt],rr=i.X(Un),Hn=i.X(typeof gn=="string"?[gn,["accumulated"],["get",Wt]]:gn);dt[Wt]=rr.value,Ze[Wt]=Hn.value}return je.map=Wt=>{Qt.properties=Wt;const gn={};for(const Un of ke)gn[Un]=dt[Un].evaluate(Nt,Qt);return gn},je.reduce=(Wt,gn)=>{Qt.properties=gn;for(const Un of ke)Nt.accumulated=Wt[Un],Wt[Un]=Ze[Un].evaluate(Nt,Qt)},je}(le)).load(ze.features):le.dynamic?this._dynamicIndex:function(je,Xe){return new Ha(je,Xe)}(ze,le.geojsonVtOptions)}catch(je){return ue(je)}const We={};if(Ne){const je=A(ve);je&&(We.resourceTiming={},We.resourceTiming[le.source]=JSON.parse(JSON.stringify(je)))}ue(null,We)}})}reloadTile(le,ue){const ve=this.loaded;return ve&&ve[le.uid]?le.partial?ue(null,void 0):super.reloadTile(le,ue):this.loadTile(le,ue)}loadGeoJSON(le,ue){if(le.request)i.n(le.request,ue);else{if(typeof le.data!="string")return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(le.data))}catch{return ue(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(ve){ue(ve)}}getClusterChildren(le,ue){try{ue(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(ve){ue(ve)}}getClusterLeaves(le,ue){try{ue(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(ve){ue(ve)}}}class gh{constructor(le,ue,ve){this.tileID=new i.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=ue,this.worldview=ve}parse(le,ue,ve,Ne){this.status="parsing";const Ee=new i.aM(ve.tileID.overscaledZ,ve.tileID.wrap,ve.tileID.canonical.z,ve.tileID.canonical.x,ve.tileID.canonical.y),ze=[],We=ue.familiesBySource[ve.source],je=new i.f0(Ee,ve.promoteId);je.bucketLayerIDs=[],je.is3DTile=!0,i.fi(le).then(Xe=>{if(!Xe)return Ne(new Error("Could not parse tile"));const dt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,Ze=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),Nt=new i.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qt in We)for(const ke of We[Qt]){const Wt=ke[0];je.bucketLayerIDs.push(ke.map(rr=>i.C(rr.id,rr.scope))),Wt.recalculate(Nt,[]);const gn=i.fj(Xe,1/i.cU(ve.tileID.canonical)),Un=new i.fk(ke,gn,Ee,dt,Ze,this.brightness,je,this.worldview);dt||(Un.needsUpload=!0),ze.push(Un),Un.evaluate(Wt)}this.status="done",Ne(null,{buckets:ze,featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Ne(new Error(Xe.message)))}}class Ql{constructor(le,ue,ve,Ne,Ee,ze,We,je){this.actor=le,this.layerIndex=ue,this.availableImages=ve,this.availableModels=Ne,this.brightness=We,this.loading={},this.loaded={},this.worldview=je}loadTile(le,ue){const ve=le.uid,Ne=this.loading[ve]=new gh(le,this.brightness,this.worldview);i.br(le.request,(Ee,ze)=>{const We=!this.loading[ve];return delete this.loading[ve],We||Ee?(Ne.status="done",We||(this.loaded[ve]=Ne),ue(Ee)):ze&&ze.byteLength!==0?void Ne.parse(ze,this.layerIndex,le,(je,Xe)=>{Ne.status="done",this.loaded=this.loaded||{},this.loaded[ve]=Ne,je||!Xe?ue(je):ue(null,Xe)}):(Ne.status="done",this.loaded[ve]=Ne,ue())})}reloadTile(le,ue){const ve=this.loaded,Ne=le.uid;if(ve&&ve[Ne]){const Ee=ve[Ne];Ee.projection=le.projection,Ee.brightness=le.brightness;const ze=(We,je)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(le,ue)),ue(We,je)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&this.loadTile(le,ue)}}abortTile(le,ue){const ve=le.uid;this.loading[ve]&&delete this.loading[ve],ue()}removeTile(le,ue){const ve=this.loaded,Ne=le.uid;ve&&ve[Ne]&&delete ve[Ne],ue()}}class Sr{constructor(le){this.self=le,this.actor=new i.fm(le,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.ce({name:"mercator"}),this.workerSourceTypes={vector:re,geojson:qa,"raster-dem":de,"raster-array":Fe,"batched-model":Ql},this.workerSources={},this.self.registerWorkerSource=(ue,ve)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=ve},this.self.registerRTLTextPlugin=ue=>{if(i.fn.isParsed())throw new Error("RTL text plugin already registered.");i.fn.setState({pluginStatus:i.fo.parsed,pluginURL:i.fn.getPluginURL()}),i.fn.applyArabicShaping=ue.applyArabicShaping,i.fn.processBidirectionalText=ue.processBidirectionalText,i.fn.processStyledBidirectionalText=ue.processStyledBidirectionalText;for(const ve of this.rtlPluginParsingListeners)ve(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(le,ue,ve){delete this.layerIndexes[le],delete this.availableImages[le],delete this.availableModels[le],delete this.workerSources[le],ve()}checkIfReady(le,ue,ve){ve()}setReferrer(le,ue){this.referrer=ue}spriteLoaded(le,ue){this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={});const{scope:ve,isLoaded:Ne}=ue;if(this.isSpriteLoaded[le][ve]=Ne,this.workerSources[le]&&this.workerSources[le][ve])for(const Ee in this.workerSources[le][ve]){const ze=this.workerSources[le][ve][Ee];for(const We in ze){const je=ze[We];je instanceof re&&(je.isSpriteLoaded=Ne,je.fire(new i.A("isSpriteLoaded")))}}}setImages(le,ue,ve){this.availableImages[le]||(this.availableImages[le]={});const{scope:Ne,images:Ee}=ue;if(this.availableImages[le][Ne]=Ee,this.workerSources[le]&&this.workerSources[le][Ne]){for(const ze in this.workerSources[le][Ne]){const We=this.workerSources[le][Ne][ze];for(const je in We)We[je].availableImages=Ee}ve()}else ve()}setModels(le,{scope:ue,models:ve},Ne){if(this.availableModels[le]||(this.availableModels[le]={}),this.availableModels[le][ue]=ve,this.workerSources[le]&&this.workerSources[le][ue]){for(const Ee in this.workerSources[le][ue]){const ze=this.workerSources[le][ue][Ee];for(const We in ze)ze[We].availableModels=ve}Ne()}else Ne()}setProjection(le,ue){this.projections[le]=i.ce(ue)}setBrightness(le,ue,ve){this.brightness=ue,ve()}setWorldview(le,ue,ve){this.worldview=ue,ve()}setLayers(le,ue,ve){this.getLayerIndex(le,ue.scope).replace(ue.layers,ue.options),ve()}updateLayers(le,ue,ve){this.getLayerIndex(le,ue.scope).update(ue.layers,ue.removedIds,ue.options),ve()}loadTile(le,ue,ve){ue.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,ue.type,ue.source,ue.scope).loadTile(ue,ve)}decodeRasterArray(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).decodeRasterArray(ue,ve)}reloadTile(le,ue,ve){ue.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,ue.type,ue.source,ue.scope).reloadTile(ue,ve)}abortTile(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).abortTile(ue,ve)}removeTile(le,ue,ve){this.getWorkerSource(le,ue.type,ue.source,ue.scope).removeTile(ue,ve)}removeSource(le,ue,ve){if(!(this.workerSources[le]&&this.workerSources[le][ue.scope]&&this.workerSources[le][ue.scope][ue.type]&&this.workerSources[le][ue.scope][ue.type][ue.source]))return;const Ne=this.workerSources[le][ue.scope][ue.type][ue.source];delete this.workerSources[le][ue.scope][ue.type][ue.source],Ne.removeSource!==void 0?Ne.removeSource(ue,ve):ve()}loadWorkerSource(le,ue,ve){try{this.self.importScripts(ue.url),ve()}catch(Ne){ve(Ne.toString())}}syncRTLPluginState(le,ue,ve){if(i.fn.isParsed())ve(null,!0);else if(i.fn.isParsing())this.rtlPluginParsingListeners.push(ve);else try{i.fn.setState(ue);const Ne=i.fn.getPluginURL();!i.fn.isLoaded()||i.fn.isParsed()||i.fn.isParsing()||Ne==null||(i.fn.setState({pluginStatus:i.fo.parsing,pluginURL:i.fn.getPluginURL()}),this.self.importScripts(Ne),i.fn.isParsed()?ve(null,!0):this.rtlPluginParsingListeners.push(ve))}catch(Ne){ve(Ne.toString())}}setDracoUrl(le,ue){this.dracoUrl=ue}getAvailableImages(le,ue){this.availableImages[le]||(this.availableImages[le]={});let ve=this.availableImages[le][ue];return ve||(ve=[]),ve}getAvailableModels(le,ue){this.availableModels[le]||(this.availableModels[le]={});let ve=this.availableModels[le][ue];return ve||(ve={}),ve}getLayerIndex(le,ue){this.layerIndexes[le]||(this.layerIndexes[le]={});let ve=this.layerIndexes[le][ue];return ve||(ve=this.layerIndexes[le][ue]=new j,ve.scope=ue),ve}getWorkerSource(le,ue,ve,Ne){const Ee=this.workerSources;return Ee[le]||(Ee[le]={}),Ee[le][Ne]||(Ee[le][Ne]={}),Ee[le][Ne][ue]||(Ee[le][Ne][ue]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),Ee[le][Ne][ue][ve]||(Ee[le][Ne][ue][ve]=new this.workerSourceTypes[ue]({send:(ze,We,je,Xe,dt,Ze)=>this.actor.send(ze,We,je,le,dt,Ze),scheduler:this.actor.scheduler},this.getLayerIndex(le,Ne),this.getAvailableImages(le,Ne),this.getAvailableModels(le,Ne),this.isSpriteLoaded[le][Ne],void 0,this.brightness,this.worldview)),Ee[le][Ne][ue][ve]}rasterizeImagesWorker(le,ue,ve){const Ne=new Map;for(const[Ee,{image:ze,imageVariant:We}]of ue.tasks.entries()){const je=this.imageRasterizer.rasterize(We,ze,ue.scope,le);Ne.set(Ee,je)}ve(void 0,Ne)}removeRasterizedImages(le,ue,ve){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,le),ve()}enforceCacheSizeLimit(le,ue){i.fp(ue)}getWorkerPerformanceMetrics(le,ue,ve){ve(void 0,void 0)}}return i.fl(self)&&(self.worker=new Sr(self)),Sr}),m(["./shared"],function(i){var A="3.13.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},D={mark(f){performance.mark(f)},measure(f,r,c){performance.measure(f,r,c)}};function j(f){const r=f.name.split("?")[0];return i.a(r)&&r.includes("mapbox-gl.js")?"javascript":i.a(r)&&r.includes("mapbox-gl.css")?"css":i.b(r)?"fontRange":i.c(r)?"sprite":i.i(r)?"style":i.d(r)?"tilejson":"other"}var U,X={},Y=function(){if(U)return X;function f(p){return!r(p)}function r(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,E,M=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(M);try{E=new Worker(R),S=!0}catch{S=!1}return E&&E.terminate(),URL.revokeObjectURL(R),S}()?function(){var S=document.createElement("canvas");S.width=S.height=1;var E=S.getContext("2d");if(!E)return!1;var M=E.getImageData(0,0,1,1);return M&&M.width===S.width}()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=function(S){var E,M=function(R){var z=document.createElement("canvas"),F=Object.create(f.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=R,z.getContext("webgl2",F)}(S);if(!M)return!1;try{E=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!E||M.isContextLost())&&(M.shaderSource(E,"void main() {}"),M.compileShader(E),M.getShaderParameter(E,M.COMPILE_STATUS)===!0)}(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}U=1,X.supported=f,X.notSupportedReason=r;var c={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},X}();function W(f,r,c){const p=document.createElement(f);return r!=null&&(p.className=r),c&&c.appendChild(p),p}function re(f,r,c){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(r))p.setAttributeNS(null,x,String(r[x]));return c&&c.appendChild(p),p}const de=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Me=de&&de.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Fe;function ht(){de&&Me&&(Fe=de[Me],de[Me]="none")}function at(){de&&Me&&(de[Me]=Fe)}function Dt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",Dt,!0)}function kt(){window.addEventListener("click",Dt,!0),window.setTimeout(()=>{window.removeEventListener("click",Dt,!0)},0)}function Rt(f,r){const c=f.getBoundingClientRect();return xn(f,c,r)}function fn(f,r){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<r.length;x++)p.push(xn(f,c,r[x]));return p}function En(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function xn(f,r,c){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new i.P((c.clientX-r.left)*p,(c.clientY-r.top)*p)}const Tn="01",Bn="NO_ACCESS_TOKEN";class Ft{constructor(r,c,p){this._transformRequestFn=r,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const r=function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Tn,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,c){return this._transformRequestFn&&this._transformRequestFn(r,c)||{url:r}}normalizeStyleURL(r,c){if(!i.j(r))return r;const p=Yt(r);return p.params.push(`sdk=js-${A}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(r,c){if(!i.j(r))return r;const p=Yt(r);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(r,c){if(!i.j(r))return r;const p=Yt(r);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(r,c,p,x){if(!i.j(r))return r;const S=Yt(r);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),p&&S.params.push(`language=${p}`),x&&S.params.push(`worldview=${x}`),this._makeAPIURL(S,this._customAccessToken||c)}normalizeIconsetURL(r,c){const p=Yt(r);return i.j(r)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):Cn(p)}normalizeSpriteURL(r,c,p,x){const S=Yt(r);return i.j(r)?(S.path=`/styles/v1${S.path}/sprite${c}${p}`,this._makeAPIURL(S,this._customAccessToken||x)):(S.path+=`${c}${p}`,Cn(S))}normalizeTileURL(r,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!i.j(r))return r;const x=Yt(r);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${i.l.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${i.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${i.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${i.e.TILE_URL_VERSION}${x.path}`);const S=this._customAccessToken||function(E){for(const M of E){const R=M.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(x.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,S)}canonicalizeTileURL(r,c){const p=Yt(r);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return r;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let S=p.params;return c&&(S=S.filter(E=>!E.match(/^access_token=/))),S.length&&(x+=`?${S.join("&")}`),x}canonicalizeTileset(r,c){const p=!!c&&i.j(c),x=[];for(const S of r.tiles||[])i.k(S)?x.push(this.canonicalizeTileURL(S,p)):x.push(S);return x}_makeAPIURL(r,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Yt(i.e.API_URL);if(r.protocol=x.protocol,r.authority=x.authority,r.protocol==="http"){const S=r.params.indexOf("secure");S>=0&&r.params.splice(S,1)}if(x.path!=="/"&&(r.path=`${x.path}${r.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return Cn(r);if(c=c||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return r.params=r.params.filter(S=>S.indexOf("access_token")===-1),r.params.push(`access_token=${c||""}`),Cn(r)}}const wn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Yt(f){const r=f.match(wn);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Cn(f){const r=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${r}`}const gt="mapbox.eventData";function Jt(f){if(!f)return null;const r=f.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(i.m(r[1]))}catch{return null}}class Ht{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const c=Jt(i.e.ACCESS_TOKEN);let p="";return p=c&&c.u?i.f(c.u):i.e.ACCESS_TOKEN||"",r?`${gt}.${r}:${p}`:`${gt}:${p}`}fetchEventData(){const r=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid");if(r)try{const x=localStorage.getItem(c);x&&(this.eventData=JSON.parse(x));const S=localStorage.getItem(p);S&&(this.anonId=S)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const r=i.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.anonId;if(r&&x)try{localStorage.setItem(p,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,p,x){if(!i.e.EVENTS_URL)return;const S=Yt(i.e.EVENTS_URL);S.params.push(`access_token=${x||i.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(r).toISOString()},M=c?i.h(E,c):E,R={url:Cn(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=i.p(R,z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}const qe=new class extends Ht{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,r){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(c=>i.j(c)||i.k(c))&&this.queueRequest(Date.now(),r)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Jt(i.e.ACCESS_TOKEN),c=r?r.u:i.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),E=new Date(x),M=(x-this.eventData.lastSuccess)/864e5;p=p||M>=1||M<-1||S.getDate()!==E.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Tn,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)},f):this.processRequests()}},Ct=qe.postTurnstileEvent.bind(qe),Pn=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,r,c,p){this.skuToken=r,this.errorCb=p,i.e.EVENTS_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Bn)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:A,skuId:Tn,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f))}remove(){this.errorCb=null}},Zn=Pn.postMapLoadEvent.bind(Pn),Nn=new class extends Ht{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let r=this.mapInstanceIdMap.get(f);return r||(r=i.u(),this.mapInstanceIdMap.set(f,r)),r}getEventId(f){const r=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,r+1),r}postStyleLoadEvent(f,r){const{map:c,style:p,importedStyles:x}=r;if(!i.e.EVENTS_URL||!f&&!i.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(c),E={mapInstanceId:S,eventId:this.getEventId(S),style:p};x.length&&(E.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:E},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},f)}},cn=Nn.postStyleLoadEvent.bind(Nn),un=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(f,r){i.e.EVENTS_URL&&(f||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:c}=this.queue.shift(),p=function(x){const S=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),M=function(q){const ne={};if(q){for(const J in q)if(J!=="other")for(const ie of q[J]){const oe=`${J}ResolveRangeMin`,ce=`${J}ResolveRangeMax`,ge=`${J}RequestCount`,xe=`${J}RequestCachedCount`;ne[oe]=Math.min(ne[oe]||1/0,ie.startTime),ne[ce]=Math.max(ne[ce]||-1/0,ie.responseEnd);const Ce=Ae=>{ne[Ae]===void 0&&(ne[Ae]=0),++ne[Ae]};ie.transferSize!==void 0&&ie.transferSize===0&&Ce(xe),Ce(ge)}}return ne}(function(q,ne){const J={};if(q)for(const ie of q){const oe=ne(ie);J[oe]===void 0&&(J[oe]=[]),J[oe].push(ie)}return J}(S,j)),R=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=z?z.effectiveType:void 0,G={counters:[],metadata:[],attributes:[]},$=(q,ne,J)=>{J!=null&&q.push({name:ne,value:J.toString()})};for(const q in M)$(G.counters,q,M[q]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&($(G.counters,"interactionRangeMin",x.interactionRange[0]),$(G.counters,"interactionRangeMax",x.interactionRange[1])),E)for(const q of Object.keys(P)){const ne=P[q],J=E.find(ie=>ie.name===ne);J&&$(G.counters,ne,J.startTime)}return $(G.counters,"visibilityHidden",x.visibilityHidden),$(G.attributes,"style",function(q){if(q)for(const ne of q){const J=ne.name.split("?")[0];if(i.i(J)){const ie=J.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(S)),$(G.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),$(G.attributes,"fogEnabled",x.fogEnabled?"true":"false"),$(G.attributes,"projection",x.projection),$(G.attributes,"zoom",x.zoom),$(G.metadata,"devicePixelRatio",R),$(G.metadata,"connectionEffectiveType",F),$(G.metadata,"navigatorUserAgent",navigator.userAgent),$(G.metadata,"screenWidth",window.screen.width),$(G.metadata,"screenHeight",window.screen.height),$(G.metadata,"windowWidth",window.innerWidth),$(G.metadata,"windowHeight",window.innerHeight),$(G.metadata,"mapWidth",x.width/R),$(G.metadata,"mapHeight",x.height/R),$(G.metadata,"webglRenderer",x.renderer),$(G.metadata,"webglVendor",x.vendor),$(G.metadata,"sdkVersion",A),$(G.metadata,"sdkIdentifier","mapbox-gl-js"),G}(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(r,p,()=>{},f)}},$n=un.postPerformanceEvent.bind(un),An=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,r,c,p){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const x=Yt(i.e.API_URL+i.e.SESSION_PATH);x.params.push(`sku=${r||""}`),x.params.push(`access_token=${p||i.e.ACCESS_TOKEN||""}`);const S={url:Cn(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(S,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,r,c,p){this.skuToken=r,this.errorCb=p,i.e.SESSION_PATH&&i.e.API_URL&&(c||i.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},c):this.errorCb(new Error(Bn)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,p=>{p?this.errorCb(p):r&&(this.success[r]=!0)},f)}remove(){this.errorCb=null}},Fn=An.getSessionAPI.bind(An),Zr=new Set;function ni(f,r){r?Zr.add(f):Zr.delete(f)}class Or{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,c){this._updatedSourceCaches[r]=c,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const c=r.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(r.id),this.setDirty()}removeLayer(r){const c=r.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][r.id]=r,this._updatedLayers[c].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const c in this._updatedLayers)r[c]=r[c]||{},r[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)r[c]=r[c]||{},r[c].removedIds=Object.keys(this._removedLayers[c]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(i.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function vs(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class $s extends i.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new i.r({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const c=this.atlasTexture.get(r);c&&(c.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(r.id,r)}removeImageProvider(r,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(r)}getPendingImageProviders(){const r=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&r.push(p);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,c){if(this.loaded.get(c)!==r&&(this.loaded.set(c,r),r)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(r,c){return!!this.getImage(r,c)}getImage(r,c){return this.images.get(c).get(r.toString())}addImage(r,c,p){this._validate(r,p)&&this.images.get(c).set(r.toString(),p)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new i.z(new Error(`Image "${r.name}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const x of r){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(r,c){return r?r.length!==4||!c.usvg&&(r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,c,p){const x=this.images.get(c).get(r.toString());p.version=x.version+1,this.images.get(c).set(r.toString(),p),this.updatedImages.get(c).add(r),this.removeFromImageRasterizerCache(r,c)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,c){this.spriteFormat!=="raster"&&(i.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([r],c))}removeImage(r,c){const p=this.images.get(c),x=p.get(r.toString());p.delete(r.toString()),this.patterns.get(c).delete(r.toString()),this.removeFromImageRasterizerCache(r,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(c=>i.I.from(c))}getImages(r,c,p){const x=[],S=[],E=this.imageProviders.get(c);for(const F of r){if(!F.iconsetId){x.push(F);continue}const G=E.get(F.iconsetId);G&&(this.getImage(F,c)?S.push(F):G.addPendingRequest(F))}if(x.length===0)return void this._notify(S,c,p);let M=!0;const R=!!this.loaded.get(c),z=this.images.get(c);if(!R)for(const F of x)z.has(F.toString())||(M=!1);R||M?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(r,c){const p=new Map,{tasks:x,scope:S}=r;for(const[E,M]of x.entries()){const R=this.getImage(M.id,S);R&&p.set(E,{image:R,imageVariant:M})}this._rasterizeImages(S,p,c)}_rasterizeImages(r,c,p){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:r},p);else{const x=new Map;for(const[S,{image:E,imageVariant:M}]of c.entries())x.set(S,this.imageRasterizer.rasterize(M,E,r,0));p(void 0,x)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,c,p){const x=this.images.get(c),S=new Map;for(const E of r){if(!x.get(E.toString())){if(E.iconsetId)continue;this.fire(new i.A("styleimagemissing",{id:E.name}))}const M=x.get(E.toString());if(!M){i.w(`Image "${E.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:M.usvg?null:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,usvg:M.usvg,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)};M.usvg&&Object.assign(R,{width:M.icon.usvg_tree.width,height:M.icon.usvg_tree.height}),S.set(i.I.toString(E),R)}p(null,S)}getPixelSize(r){const{width:c,height:p}=this.atlasImage.get(r);return{width:c,height:p}}getPattern(r,c,p){const x=r.toString(),S=this.patterns.get(c),E=S.get(x),M=this.getImage(r,c);if(!M)return null;if(E){if(E.position.version===M.version)return E.position;E.position.version=M.version}else{if(M.usvg&&!M.data){const R=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const z=new i.B(r).scaleSelf(i.q.devicePixelRatio),F=new Map([[z.toString(),{image:M,imageVariant:z}]]);return this._rasterizeImages(c,F,(G,$)=>this.storePatternImage(z,c,M,p,$)),null}this.storePattern(r,c,M)}return this._updatePatternAtlas(c,p),S.get(x).position}getPatternInFlightId(r,c){return i.C(r,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,c,p,x,S){const E=r.toString(),M=S?S.get(E):void 0;M&&(p.data=M,this.storePattern(r.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),c)))}storePattern(r,c,p){const x={w:p.data.width+2*i.F,h:p.data.height+2*i.F,x:0,y:0},S=new i.G(x,p,i.F);this.patterns.get(c).set(r.toString(),{bin:x,position:S})}bind(r,c){const p=r.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new i.T(r,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(r,c){const p=this.patterns.get(r),x=Array.from(p.values()).map(({bin:z})=>z),{w:S,h:E}=i.H(x),M=this.atlasImage.get(r);M.resize({width:S||1,height:E||1});const R=this.images.get(r);for(const[z,{bin:F,position:G}]of p.entries()){let $=G.padding;const q=F.x+$,ne=F.y+$,J=R.get(z).data,ie=J.width,oe=J.height;$=$>1?$-1:$,i.r.copy(J,M,{x:0,y:0},{x:q,y:ne},{width:ie,height:oe},c),i.r.copy(J,M,{x:0,y:oe-$},{x:q,y:ne-$},{width:ie,height:$},c),i.r.copy(J,M,{x:0,y:0},{x:q,y:ne+oe},{width:ie,height:$},c),i.r.copy(J,M,{x:ie-$,y:0},{x:q-$,y:ne},{width:$,height:oe},c),i.r.copy(J,M,{x:0,y:0},{x:q+ie,y:ne},{width:$,height:oe},c),i.r.copy(J,M,{x:ie-$,y:oe-$},{x:q-$,y:ne-$},{width:$,height:$},c),i.r.copy(J,M,{x:0,y:oe-$},{x:q+ie,y:ne-$},{width:$,height:$},c),i.r.copy(J,M,{x:0,y:0},{x:q+ie,y:ne+oe},{width:$,height:$},c),i.r.copy(J,M,{x:ie-$,y:0},{x:q-$,y:ne+oe},{width:$,height:$},c)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,c){const p=this.images.get(c);for(const x of r){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const S=p.get(x.toString());vs(S)&&this.updateImage(x,c,S)}}}function Hi(f){const r=f.key,c=f.value,p=f.valueSpec||{},x=f.objectElementValidators||{},S=f.style,E=f.styleSpec;let M=[];const R=i.J(c);if(R!=="object")return[new i.V(r,c,`object expected, ${R} found`)];for(const z in c){const F=z.split(".")[0];let G;x[F]?G=x[F]:p[F]?G=On:x["*"]?G=x["*"]:p["*"]&&(G=On),G?M=M.concat(G({key:(r&&`${r}.`)+z,value:c[z],valueSpec:p[F]||p["*"],style:S,styleSpec:E,object:c,objectKey:z},c)):M.push(new i.K(r,c[z],`unknown property "${z}"`))}for(const z in p)x[z]||p[z].required&&p[z].default===void 0&&c[z]===void 0&&M.push(new i.V(r,c,`missing required property "${z}"`));return M}function mo(f){const r=f.value,c=f.valueSpec,p=f.style,x=f.styleSpec,S=f.key,E=f.arrayElementValidator||On;if(i.J(r)!=="array")return[new i.V(S,r,`array expected, ${i.J(r)} found`)];if(c.length&&r.length!==c.length)return[new i.V(S,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new i.V(S,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let M={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(M.function=c.function),i.J(c.value)==="object"&&(M=c.value);let R=[];for(let z=0;z<r.length;z++)R=R.concat(E({array:r,arrayIndex:z,value:r[z],valueSpec:M,style:p,styleSpec:x,key:`${S}[${z}]`},!0));return R}function El(f){const r=f.key,c=f.value,p=f.valueSpec;let x=i.J(c);if(x==="number"&&c!=c&&(x="NaN"),x!=="number")return[new i.V(r,c,`number expected, ${x} found`)];if("minimum"in p){let S=p.minimum;if(i.J(p.minimum)==="array"&&(S=p.minimum[f.arrayIndex]),c<S)return[new i.V(r,c,`${c} is less than the minimum value ${S}`)]}if("maximum"in p){let S=p.maximum;if(i.J(p.maximum)==="array"&&(S=p.maximum[f.arrayIndex]),c>S)return[new i.V(r,c,`${c} is greater than the maximum value ${S}`)]}return[]}function zi(f){const r=f.valueSpec,c=i.M(f.value.type);let p,x,S,E={};const M=c!=="categorical"&&f.value.property===void 0,R=!M,z=i.J(f.value.stops)==="array"&&i.J(f.value.stops[0])==="array"&&i.J(f.value.stops[0][0])==="object",F=Hi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(c==="identity")return[new i.V(q.key,q.value,'identity function may not have a "stops" property')];let ne=[];const J=q.value;return ne=ne.concat(mo({key:q.key,value:J,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:G})),i.J(J)==="array"&&J.length===0&&ne.push(new i.V(q.key,J,"array must have at least one stop")),ne},default:function(q){return On({key:q.key,value:q.value,valueSpec:r,style:q.style,styleSpec:q.styleSpec})}}});return c==="identity"&&M&&F.push(new i.V(f.key,f.value,'missing required property "property"')),c==="identity"||f.value.stops||F.push(new i.V(f.key,f.value,'missing required property "stops"')),c==="exponential"&&f.valueSpec.expression&&!i.N(f.valueSpec)&&F.push(new i.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(R&&!i.O(f.valueSpec)?F.push(new i.V(f.key,f.value,"property functions not supported")):M&&!i.Q(f.valueSpec)&&F.push(new i.V(f.key,f.value,"zoom functions not supported"))),c!=="categorical"&&!z||f.value.property!==void 0||F.push(new i.V(f.key,f.value,'"property" property is required')),F;function G(q){let ne=[];const J=q.value,ie=q.key;if(i.J(J)!=="array")return[new i.V(ie,J,`array expected, ${i.J(J)} found`)];if(J.length!==2)return[new i.V(ie,J,`array length 2 expected, length ${J.length} found`)];if(z){if(i.J(J[0])!=="object")return[new i.V(ie,J,`object expected, ${i.J(J[0])} found`)];if(J[0].zoom===void 0)return[new i.V(ie,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new i.V(ie,J,"object stop key must have value")];const oe=i.M(J[0].zoom);if(typeof oe!="number")return[new i.V(ie,J[0].zoom,"stop zoom values must be numbers")];if(S&&S>oe)return[new i.V(ie,J[0].zoom,"stop zoom values must appear in ascending order")];oe!==S&&(S=oe,x=void 0,E={}),ne=ne.concat(Hi({key:`${ie}[0]`,value:J[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:El,value:$}}))}else ne=ne.concat($({key:`${ie}[0]`,value:J[0],style:q.style,styleSpec:q.styleSpec},J));return i.S(i.U(J[1]))?ne.concat([new i.V(`${ie}[1]`,J[1],"expressions are not allowed in function stops.")]):ne.concat(On({key:`${ie}[1]`,value:J[1],valueSpec:r,style:q.style,styleSpec:q.styleSpec}))}function $(q,ne){const J=i.J(q.value),ie=i.M(q.value),oe=q.value!==null?q.value:ne;if(p){if(J!==p)return[new i.V(q.key,oe,`${J} stop domain type must match previous stop domain type ${p}`)]}else p=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new i.V(q.key,oe,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&c!=="categorical"){let ce=`number expected, ${J} found`;return i.O(r)&&c===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(q.key,oe,ce)]}return c!=="categorical"||J!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?c!=="categorical"&&J==="number"&&typeof ie=="number"&&typeof x=="number"&&x!==void 0&&ie<x?[new i.V(q.key,oe,"stop domain values must appear in ascending order")]:(x=ie,c==="categorical"&&ie in E?[new i.V(q.key,oe,"stop domain values must be unique")]:(E[ie]=!0,[])):[new i.V(q.key,oe,`integer expected, found ${String(ie)}`)]}}function Ki(f){const r=(f.expressionContext==="property"?i.W:i.X)(i.U(f.value),f.valueSpec);if(r.result==="error")return r.value.map(p=>new i.V(`${f.key}${p.key}`,f.value,p.message));const c=r.value.expression||r.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!c.outputDefined())return[new i.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!i.Y(c))return[new i.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return to(c,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!i.Z(c,["zoom","feature-state"]))return[new i.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!i._(c))return[new i.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function to(f,r){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const x of r.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return f instanceof i.$&&c.has(f.name)?[new i.V(r.key,r.value,`["${f.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(f.eachChild(x=>{p.push(...to(x,r))}),p)}function Qo(f){const r=f.key,c=f.value,p=f.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(i.M(c))===-1&&x.push(new i.V(r,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(i.M(c))===-1&&x.push(new i.V(r,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function To(f){return i.a1(i.U(f.value))?Ki(i.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Cs(f)}function Cs(f){const r=f.value,c=f.key;if(i.J(r)!=="array")return[new i.V(c,r,`array expected, ${i.J(r)} found`)];const p=f.styleSpec;let x,S=[];if(r.length<1)return[new i.V(c,r,"filter array must have at least 1 element")];switch(S=S.concat(Qo({key:`${c}[0]`,value:r[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),i.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&i.M(r[1])==="$type"&&S.push(new i.V(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&S.push(new i.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(x=i.J(r[1]),x!=="string"&&S.push(new i.V(`${c}[1]`,r[1],`string expected, ${x} found`)));for(let E=2;E<r.length;E++)x=i.J(r[E]),i.M(r[1])==="$type"?S=S.concat(Qo({key:`${c}[${E}]`,value:r[E],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&S.push(new i.V(`${c}[${E}]`,r[E],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let E=1;E<r.length;E++)S=S.concat(Cs({key:`${c}[${E}]`,value:r[E],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":x=i.J(r[1]),r.length!==2?S.push(new i.V(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):x!=="string"&&S.push(new i.V(`${c}[1]`,r[1],`string expected, ${x} found`))}return S}function Ua(f,r){const c=f.key,p=f.style,x=f.layer,S=f.styleSpec,E=f.value,M=f.objectKey,R=S[`${r}_${f.layerType}`];if(!R)return[];const z=M.match(/^(.*)-use-theme$/);if(r==="paint"&&z&&R[z[1]])return i.S(E)?[].concat(On({key:f.key,value:E,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:S,expressionContext:"property",propertyType:r,propertyKey:M})):On({key:c,value:E,valueSpec:{type:"string"},style:p,styleSpec:S});const F=M.match(/^(.*)-transition$/);if(r==="paint"&&F&&R[F[1]]&&R[F[1]].transition)return On({key:c,value:E,valueSpec:S.transition,style:p,styleSpec:S});const G=f.valueSpec||R[M];if(!G)return[new i.K(c,E,`unknown property "${M}"`)];let $;if(i.J(E)==="string"&&i.O(G)&&!G.tokens&&($=/^{([^}]+)}$/.exec(E))){const ne=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new i.V(c,E,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${ne}.`)]}const q=[];if(f.layerType==="symbol")M!=="text-field"||!p||p.glyphs||p.imports||q.push(new i.V(c,E,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&i.a2(i.U(E))&&i.M(E.type)==="identity"&&q.push(new i.V(c,E,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&r==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&i.O(G)&&(i.a3(G)||i.Q(G))){const ne=i.W(i.U(E),G),J=ne.value.expression||ne.value._styleExpression.expression;J&&!i.Z(J,["measure-light"])&&(M==="model-emissive-strength"&&i._(J)&&i.Y(J)||q.push(new i.V(c,E,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(On({key:f.key,value:E,valueSpec:G,style:p,styleSpec:S,expressionContext:"property",propertyType:r,propertyKey:M}))}function wa(f){return Ua(f,"paint")}function is(f){return Ua(f,"layout")}function Sa(f){let r=[];const c=f.value,p=f.key,x=f.style,S=f.styleSpec;c.type||c.ref||r.push(new i.V(p,c,'either "type" or "ref" is required'));let E=i.M(c.type);const M=i.M(c.ref);if(c.id){const R=i.M(c.id);for(let z=0;z<f.arrayIndex;z++){const F=x.layers[z];i.M(F.id)===R&&r.push(new i.V(p,c.id,`duplicate layer id "${c.id}", previously used at line ${F.id.__line__}`))}}if("ref"in c){let R;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&r.push(new i.V(p,c[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{i.M(z.id)===M&&(R=z)}),R?R.ref?r.push(new i.V(p,c.ref,"ref cannot reference another ref layer")):E=i.M(R.type):typeof M=="string"&&r.push(new i.V(p,c.ref,`ref layer "${M}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(c.source){const R=x.sources&&x.sources[c.source],z=R&&i.M(R.type);R?z==="vector"&&E==="raster"?r.push(new i.V(p,c.source,`layer "${c.id}" requires a raster source`)):z==="raster"&&E!=="raster"?r.push(new i.V(p,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&E!=="hillshade"?r.push(new i.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(E)?E==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&z==="geojson"&&!R.lineMetrics?r.push(new i.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):E==="raster-particle"&&z!=="raster-array"&&r.push(new i.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):r.push(new i.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new i.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new i.V(p,c.source,`source "${c.source}" not found`))}else r.push(new i.V(p,c,'missing required property "source"'));return r=r.concat(Hi({key:p,value:c,valueSpec:S.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>On({key:`${p}.type`,value:c.type,valueSpec:S.layer.type,style:f.style,styleSpec:f.styleSpec,object:c,objectKey:"type"}),filter:R=>To(i.L({layerType:E},R)),layout:R=>Hi({layer:c,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>is(i.L({layerType:E},z))}}),paint:R=>Hi({layer:c,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>wa(i.L({layerType:E,layer:c},z))}})}})),r}function Hs(f){const r=f.value,c=f.key,p=i.J(r);return p!=="string"?[new i.V(c,r,`string expected, ${p} found`)]:[]}const Fo={promoteId:function f({key:r,value:c}){if(i.J(c)==="string")return Hs({key:r,value:c});if(Array.isArray(c)){const p=[],x=i.U(c),S=i.X(x);return S.result==="error"&&S.value.forEach(E=>{p.push(new i.V(`${r}${E.key}`,null,`${E.message}`))}),i.Z(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||p.push(new i.V(`${r}`,null,"promoteId expression should be only feature dependent")),p}{const p=[];for(const x in c)p.push(...f({key:`${r}.${x}`,value:c[x]}));return p}}};function ss(f){const r=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!r.type)return[new i.V(c,r,'"type" is required')];const S=i.M(r.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&(r.url||r.tiles||E.push(new i.K(c,r,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Hi({key:c,value:r,valueSpec:p[`source_${S.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Fo})),E;case"geojson":if(E=Hi({key:c,value:r,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Fo}),r.cluster)for(const M in r.clusterProperties){const[R,z]=r.clusterProperties[M],F=typeof R=="string"?[R,["accumulated"],["get",M]]:R;E.push(...Ki({key:`${c}.${M}.map`,value:z,expressionContext:"cluster-map"})),E.push(...Ki({key:`${c}.${M}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return E;case"video":return Hi({key:c,value:r,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return Hi({key:c,value:r,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new i.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qo({key:`${c}.type`,value:r.type,valueSpec:{values:go(p)}})}}function go(f){return f.source.reduce((r,c)=>{const p=f[c];return p.type.type==="enum"&&(r=r.concat(Object.keys(p.type.values))),r},[])}function Ta(f){const r=f.value,c=f.styleSpec,p=c.light,x=f.style;let S=[];const E=i.J(r);if(r===void 0)return S;if(E!=="object")return S=S.concat([new i.V("light",r,`object expected, ${E} found`)]),S;for(const M in r){const R=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);S=S.concat(z&&p[z[1]]?On({key:M,value:r[M],valueSpec:{type:"string"},style:x,styleSpec:c}):R&&p[R[1]]&&p[R[1]].transition?On({key:M,value:r[M],valueSpec:c.transition,style:x,styleSpec:c}):p[M]?On({key:M,value:r[M],valueSpec:p[M],style:x,styleSpec:c}):[new i.V(M,r[M],`unknown property "${M}"`)])}return S}function Ea(f){const r=f.value;let c=[];if(!r)return c;const p=i.J(r);if(p!=="object")return c=c.concat([new i.V("light-3d",r,`object expected, ${p} found`)]),c;const x=f.styleSpec,S=x["light-3d"],E=f.key,M=f.style,R=f.style.lights;for(const G of["type","id"])if(!(G in r))return c=c.concat([new i.V("light-3d",r,`missing property ${G} on light`)]),c;if(r.type&&R)for(let G=0;G<f.arrayIndex;G++){const $=i.M(r.type),q=R[G];i.M(q.type)===$&&c.push(new i.V(E,r.id,`duplicate light type "${r.type}", previously defined at line ${q.id.__line__}`))}const z=`properties_light_${r.type}`;if(!(z in x))return c=c.concat([new i.V("light-3d",r,`Invalid light type ${r.type}`)]),c;const F=x[z];for(const G in r)if(G==="properties"){const $=r[G],q=i.J($);if(q!=="object")return c=c.concat([new i.V("properties",$,`object expected, ${q} found`)]),c;for(const ne in $){const J=ne.match(/^(.*)-transition$/),ie=ne.match(/^(.*)-use-theme$/);c=c.concat(ie&&F[ie[1]]?On({key:G,value:$[ne],valueSpec:{type:"string"},style:M,styleSpec:x}):J&&F[J[1]]&&F[J[1]].transition?On({key:G,value:r[G],valueSpec:x.transition,style:M,styleSpec:x}):F[ne]?On({key:ne,value:$[ne],valueSpec:F[ne],style:M,styleSpec:x}):[new i.K(f.key,$[ne],`unknown property "${ne}"`)])}}else c=c.concat(S[G]?On({key:G,value:r[G],valueSpec:S[G],style:M,styleSpec:x}):[new i.K(G,r[G],`unknown property "${G}"`)]);return c}function Ca(f){const r=f.value,c=f.key,p=f.style,x=f.styleSpec,S=x.terrain;let E=[];const M=i.J(r);if(r===void 0||M==="null")return E;if(M!=="object")return E=E.concat([new i.V("terrain",r,`object expected, ${M} found`)]),E;for(const R in r){const z=R.match(/^(.*)-transition$/),F=R.match(/^(.*)-use-theme$/);E=E.concat(F&&S[F[1]]?On({key:R,value:r[R],valueSpec:{type:"string"},style:p,styleSpec:x}):z&&S[z[1]]&&S[z[1]].transition?On({key:R,value:r[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?On({key:R,value:r[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,r[R],`unknown property "${R}"`)])}if(r.source){const R=p.sources&&p.sources[r.source],z=R&&i.M(R.type);R?z!=="raster-dem"&&E.push(new i.V(c,r.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):E.push(new i.V(c,r.source,`source "${r.source}" not found`))}else E.push(new i.V(c,r,'terrain is missing required property "source"'));return E}function As(f){const r=f.value,c=f.style,p=f.styleSpec,x=p.fog;let S=[];const E=i.J(r);if(r===void 0)return S;if(E!=="object")return S=S.concat([new i.V("fog",r,`object expected, ${E} found`)]),S;for(const M in r){const R=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);S=S.concat(z&&x[z[1]]?On({key:M,value:r[M],valueSpec:{type:"string"},style:c,styleSpec:p}):R&&x[R[1]]&&x[R[1]].transition?On({key:M,value:r[M],valueSpec:p.transition,style:c,styleSpec:p}):x[M]?On({key:M,value:r[M],valueSpec:x[M],style:c,styleSpec:p}):[new i.K(M,r[M],`unknown property "${M}"`)])}return S}const $a={"*":()=>[],array:mo,boolean:function(f){const r=f.value,c=f.key,p=i.J(r);return p!=="boolean"?[new i.V(c,r,`boolean expected, ${p} found`)]:[]},number:El,color:function(f){const r=f.key,c=f.value,p=i.J(c);return p!=="string"?[new i.V(r,c,`color expected, ${p} found`)]:i.a0.parseCSSColor(c)===null?[new i.V(r,c,`color expected, "${c}" found`)]:[]},enum:Qo,filter:To,function:zi,layer:Sa,object:Hi,source:ss,model:i.a4,light:Ta,"light-3d":Ea,terrain:Ca,fog:As,string:Hs,formatted:function(f){return Hs(f).length===0?[]:Ki(f)},resolvedImage:function(f){return Hs(f).length===0?[]:Ki(f)},projection:function(f){const r=f.value,c=f.styleSpec,p=c.projection,x=f.style;let S=[];const E=i.J(r);if(E==="object")for(const M in r)S=S.concat(On({key:M,value:r[M],valueSpec:p[M],style:x,styleSpec:c}));else E!=="string"&&(S=S.concat([new i.V("projection",r,`object or string expected, ${E} found`)]));return S},import:function(f){const{value:r,styleSpec:c}=f,{data:p,...x}=r;Object.defineProperty(x,"__line__",{value:r.__line__,enumerable:!1});let S=Hi(i.L({},f,{value:x,valueSpec:c.import}));return i.M(x.id)===""&&S.push(new i.V(`${f.key}.id`,x,"import id can't be an empty string")),p&&(S=S.concat(fi(p,c,{key:`${f.key}.data`}))),S},iconset:function(f){const r=f.value,c=f.key,p=f.styleSpec,x=f.style;if(!r.type)return[new i.V(c,r,'"type" is required')];const S=i.M(r.type);let E=[];if(E=E.concat(Hi({key:c,value:r,valueSpec:p[`iconset_${S}`],style:x,styleSpec:p})),S==="source"&&r.source){const M=x.sources&&x.sources[r.source],R=M&&i.M(M.type);M?R!=="raster-array"&&E.push(new i.V(c,r.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):E.push(new i.V(c,r.source,`source "${r.source}" not found`))}return E}};function On(f,r=!1){const c=f.value,p=f.valueSpec,x=f.styleSpec;if(p.expression&&i.a2(i.M(c)))return zi(f);if(p.expression&&i.S(i.U(c)))return Ki(f);if(p.type&&$a[p.type]){const S=$a[p.type](f);return r===!0&&S.length>0&&i.J(f.value)==="array"?Ki(f):S}return Hi(i.L({},f,{valueSpec:p.type?x[p.type]:p}))}function ui(f){const r=f.value,c=f.key,p=Hs(f);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new i.V(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new i.V(c,r,'"glyphs" url must include a "{range}" token'))),p}function fi(f,r=i.a5,c={}){return On({key:c.key||"",value:f,valueSpec:r.$root,styleSpec:r,style:f,objectElementValidators:{glyphs:ui,"*":()=>[]}})}function Vi(f,r=i.a5){return Ne(fi(f,r))}const Is=f=>Ne(ss(f)),Ha=f=>Ne(Ta(f)),Ga=f=>Ne(Ea(f)),Ot=f=>Ne(Ca(f)),qa=f=>Ne(As(f)),gh=f=>Ne(function(r){const c=r.value,p=r.style,x=r.styleSpec,S=x.snow;let E=[];const M=i.J(c);if(c===void 0)return E;if(M!=="object")return E=E.concat([new i.V("snow",c,`object expected, ${M} found`)]),E;for(const R in c){const z=R.match(/^(.*)-transition$/);E=E.concat(z&&S[z[1]]&&S[z[1]].transition?On({key:R,value:c[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?On({key:R,value:c[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,c[R],`unknown property "${R}"`)])}return E}(f)),Ql=f=>Ne(function(r){const c=r.value,p=r.style,x=r.styleSpec,S=x.rain;let E=[];const M=i.J(c);if(c===void 0)return E;if(M!=="object")return E=E.concat([new i.V("rain",c,`object expected, ${M} found`)]),E;for(const R in c){const z=R.match(/^(.*)-transition$/);E=E.concat(z&&S[z[1]]&&S[z[1]].transition?On({key:R,value:c[R],valueSpec:x.transition,style:p,styleSpec:x}):S[R]?On({key:R,value:c[R],valueSpec:S[R],style:p,styleSpec:x}):[new i.K(R,c[R],`unknown property "${R}"`)])}return E}(f)),Sr=f=>Ne(Sa(f)),Ke=f=>Ne(To(f)),le=f=>Ne(wa(f)),ue=f=>Ne(is(f)),ve=f=>Ne(i.a4(f));function Ne(f){return f.slice().sort((r,c)=>r.line&&c.line?r.line-c.line:0)}function Ee(f,r){let c=!1;if(r&&r.length)for(const p of r)p instanceof i.K?i.w(p.message):(f.fire(new i.z(new Error(p.message))),c=!0);return c}let ze;class We extends i.E{constructor(r,c="flat"){super(),this._transitionable=new i.a6(ze||(ze=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(r,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c,p={}){this._validate(Ha,r,p)||(this._transitionable.setTransitionOrValue(r),this.id=c)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&Ee(this,r.call(Vi,i.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let je=class extends i.E{constructor(f,r,c,p,x){super(),this.scope=c,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=x}get(){return this._transitionable.serialize()}set(f,r){this._transitionable.setTransitionOrValue(f,r)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new i.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const r=f.value.expression;if(!r)return null;let c=-1,p=-1,x=1;for(const S of r.zoomStops)x=r.evaluate(new i.aa(S,{worldview:this.worldview})),x>.01?(c=S,p=-1):p=S;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof i.ab}};const Xe=45,dt=65,Ze=.05;function Nt(f,r,c,p){const x=i.af(Xe,dt,c),[S,E]=Qt(f,p);let M=1-Math.min(1,Math.exp((r-S)/(E-S)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*x*f.alpha}function Qt(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}function ke(f,r,c,p,x){const S=i.ad([],[r,c,p],x.mercatorFogMatrix);return Nt(f,i.ae(S),x.pitch,x._fov)}function Wt(f,r,c,p,x,S,E){const M=[[c,p,0],[x,p,0],[x,S,0],[c,S,0]];let R=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const F of M){const G=i.ad([],F,r),$=i.ae(G);R=Math.min(R,$),z=Math.max(z,$)}return[Nt(f,R,E.pitch,E._fov),Nt(f,z,E.pitch,E._fov)]}class gn extends i.E{constructor(r,c,p,x){super();const S=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(S,p,new Map(x)),this.set(r,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new i.ag(S),this.scope=p}get state(){const r=this._transform,c=r.projection.name==="globe",p=i.ah(r.zoom),x=this.properties.get("range"),S=[.5,3];return{range:c?[i.ai(S[0],x[0],p),i.ai(S[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c,p={}){if(this._validate(qa,r,p))return;const x=i.h({},r);for(const S of Object.keys(i.a5.fog))x[S]===void 0&&(x[S]=i.a5.fog[S].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.af(Xe,dt,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(p,x,S){const E=i.ac.fromLngLat(x),M=S.elevation?S.elevation.getAtPointOrZero(E):0;return ke(p,E.x,E.y,M,S)}(this.state,r,c):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(r.toUnwrapped());return Wt(this.state,c,0,0,i.aj,i.aj,this._transform)}getOpacityForBounds(r,c,p,x,S){return this._transform.projection.supportsFog?Wt(this.state,r,c,p,x,S,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Qt(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=r.points[p];let S;if(x[2]>=0)S=x;else{const E=r.points[p-4];S=i.ak(E,x,E[2]/(E[2]-x[2]))}if(ke(this.state,S[0],S[1],0,this._transform)>=Ze)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||p.validate!==!1)&&Ee(this,r.call(Vi,i.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Un,rr,Hn,ri,mr=class extends i.E{constructor(f,r,c,p){super();const x=Un||(Un=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(x),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=i.al(c[0]),x=-Math.max(i.al(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=E,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(r.r,r.g,r.b,r.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(gh,f,c))return;const p=i.h({},f);for(const x of Object.keys(i.a5.snow))p[x]===void 0&&(p[x]=i.a5.snow[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&Ee(this,f.call(Vi,i.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},bi=class extends i.E{constructor(f,r,c,p){super();const x=rr||(rr=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(x,c,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ag(x),this.scope=c}get state(){const f=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),p=i.al(c[0]),x=-Math.max(i.al(c[1]),.01),S=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],E=this.properties.get("vignette-color");return E.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.am(r.r,r.g,r.b,r.a*f),direction:S,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,r,c={}){if(this._validate(Ql,f,c))return;const p=i.h({},f);for(const x of Object.keys(i.a5.rain))p[x]===void 0&&(p[x]=i.a5.rain[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,r,c){return(!c||c.validate!==!1)&&Ee(this,f.call(Vi,i.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class Fr extends i.E{constructor(r,c,p,x){super(),this.scope=p,this._options=r,this.properties=new i.ag(c),this._transitionable=new i.a6(c,p,new Map(x)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,c){this._options=r,this._transitionable.setTransitionOrValue(r.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Nr{constructor(r,c,p,x){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(r,c){let p,x;if(r instanceof i.P||typeof r[0]=="number"){const S=i.P.convert(r);p=[S],x=c.isPointAboveHorizon(S)}else{const S=i.P.convert(r[0]),E=i.P.convert(r[1]),M=S.add(E)._div(2);p=[S,E],x=i.ao(S,E).every(R=>c.isPointAboveHorizon(R))&&c.isPointAboveHorizon(M)}return new Nr(p,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return i.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.ao(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),i.ap(x,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],x=i.ao(c,p,r),S=this.cameraPoint.clone();switch(3*((S.y>c.y)+(S.y>p.y))+((S.x>c.x)+(S.x>p.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(r,c,p,x=0){const S=r.queryPadding/c._pixelsPerMercatorPixel+1,E=p?this._bufferedCameraMercator(S,c):this._bufferedScreenMercator(S,c);let M=r.tileID.wrap+(E.unwrapped?x:0);const R=E.polygon.map(ie=>i.aq(r.tileTransform,ie,M));if(!i.ar(R,0,0,i.aj,i.aj))return;M=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(ie=>i.as(r.tileTransform,ie,M)),F=z.map(ie=>new i.P(ie[0],ie[1])),G=c.getFreeCameraOptions().position||new i.ac(0,0,0),$=i.as(r.tileTransform,G,M),q=z.map(ie=>{const oe=i.at(ie,ie,$);return i.au(oe,oe),new i.av($,oe)}),ne=i.aw(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:q,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(J=i.ax(R),J.min.x=i.ay(J.min.x,0,i.aj),J.min.y=i.ay(J.min.y,0,i.aj),J.max.x=i.ay(J.max.x,0,i.aj),J.max.y=i.ay(J.max.y,0,i.aj),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ne};var J}_bufferedScreenMercator(r,c){const p=Ri(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(r,c){const p=Ri(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(S=>c.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(r,c){const p=function(S,E){const M=i.az([],E.pixelMatrix,E.globeMatrix),R=[0,-i.aB,0,1],z=[0,i.aB,0,1],F=[0,0,0,1];i.aA(R,R,M),i.aA(z,z,M),i.aA(F,F,M);const G=new i.P(R[0]/R[3],R[1]/R[3]),$=new i.P(z[0]/z[3],z[1]/z[3]),q=i.aC(S,G)&&R[3]<F[3],ne=i.aC(S,$)&&z[3]<F[3];if(!q&&!ne)return null;const J=function(Te,be,Ie){for(let Re=1;Re<Te.length;Re++){const Be=Ui(be.pointCoordinate3D(Te[Re-1]).x),Ge=Ui(be.pointCoordinate3D(Te[Re]).x);if(Ie<0){if(Be<Ge)return{idx:Re,t:-Be/(Ge-1-Be)}}else if(Ge<Be)return{idx:Re,t:(1-Be)/(Ge+1-Be)}}return null}(S,E,q?-1:1);if(!J)return null;const{idx:ie,t:oe}=J;let ce=ie>1?ji(S.slice(0,ie),E):[],ge=ie<S.length?ji(S.slice(ie),E):[];ce=ce.map(Te=>new i.P(Ui(Te.x),Te.y)),ge=ge.map(Te=>new i.P(Ui(Te.x),Te.y));const xe=[...ce];xe.length===0&&xe.push(ge[ge.length-1]);const Ce=i.ai(xe[xe.length-1].y,(ge.length===0?ce[0]:ge[0]).y,oe);let Ae;return Ae=q?[new i.P(0,Ce),new i.P(0,0),new i.P(1,0),new i.P(1,Ce)]:[new i.P(1,Ce),new i.P(1,1),new i.P(0,1),new i.P(0,Ce)],xe.push(...Ae),ge.length===0?xe.push(ce[0]):xe.push(...ge),{polygon:xe.map(Te=>new i.ac(Te.x,Te.y)),unwrapped:!1}}(r,c);if(p)return p;const x=function(S,E){let M=!1,R=-1/0,z=0;for(let G=0;G<S.length-1;G++)S[G].x>R&&(R=S[G].x,z=G);for(let G=0;G<S.length-1;G++){const $=(z+G)%(S.length-1),q=S[$],ne=S[$+1];Math.abs(q.x-ne.x)>.5&&(q.x<ne.x?(q.x+=1,$===0&&(S[S.length-1].x+=1)):(ne.x+=1,$+1===S.length-1&&(S[0].x+=1)),M=!0)}const F=i.aD(E.center.lng);return M&&F<Math.abs(F-1)&&S.forEach(G=>{G.x-=1}),{polygon:S,unwrapped:M}}(ji(r,c).map(S=>new i.P(Ui(S.x),S.y)),c);return{polygon:x.polygon.map(S=>new i.ac(S.x,S.y)),unwrapped:x.unwrapped}}}function ji(f,r){return i.aE(f,c=>{const p=r.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Ui(f){return f<0?1+f%1:f%1}function Ri(f){return 100*f|0}function gs(f,r,c,p,x){const S=function(M,R){if(M)return x(M);if(R){if(f.url&&R.tiles&&f.tiles&&delete f.tiles,R.variants){if(!Array.isArray(R.variants))return x(new Error("variants must be an array"));for(const F of R.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){R=i.h(R,F);break}}}const z=i.aF(i.h({},R,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=r.canonicalizeTileset(z,f.url),x(null,z)}},E=function(M,R,z){if(!M)return null;if(!R&&!z)return M;z=z||M.worldview_default;const F=Object.values(M.language||{});if(F.length===0)return null;const G=Object.values(M.worldview||{});if(G.length===0)return null;const $=F.every(ne=>ne===R),q=G.every(ne=>ne===z);return $&&q?M:R in(M.language_options||{})||z in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(f.data,c,p);return E?i.q.frame(()=>S(null,E)):f.url?i.n(r.transformRequest(r.normalizeSourceURL(f.url,null,c,p),i.R.Source),S):i.q.frame(()=>{const{data:M,...R}=f;S(null,R)})}function hs(f,r){const c=Math.pow(2,r.z),p=Math.floor(i.aD(f.getWest())*c),x=Math.floor(i.aH(f.getNorth())*c),S=Math.ceil(i.aD(f.getEast())*c),E=Math.ceil(i.aH(f.getSouth())*c);return r.x>=p&&r.x<S&&r.y>=x&&r.y<E}class yo{constructor(r,c,p){this.bounds=r?i.aG.convert(this.validateBounds(r)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const c of r)this.extraBounds.push(i.aG.convert(this.validateBounds(c)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!hs(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(hs(c,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const c=new yo(r.bounds,r.minzoom,r.maxzoom);return c.addExtraBounds(r.extra_bounds),c}}class Bo extends i.E{constructor(r,c,p,x){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.h(this,i.aF(c,["url","scheme","tileSize","promoteId"])),this._options=i.h({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new i.aI}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,c,p,(x,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new i.z(x));else if(S){if(i.h(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const E of S.vector_layers)this.vectorLayerIds.push(E.id),S.worldview&&S.worldview[E.source]&&this.localizableLayerIds.add(E.id)}this.tileBounds=yo.fromTileJSON(S),Ct(S.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(x)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}loadTile(r,c){const p=r.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),S=this.map._requestManager.transformRequest(x,i.R.Tile),E=this.map.style?this.map.style.getLut(this.scope):null,M=E?{image:E.image.clone()}:null,R={request:S,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&i.j(p)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=c:r.request=r.actor.send("reloadTile",R,z.bind(this));else if(r.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",R,z.bind(this),void 0,!0);else{const F=i.aJ.call({deduped:this._deduped},R,(G,$)=>{G||!$?z.call(this,G):(R.data={cacheControl:$.cacheControl,expires:$.expires,rawData:$.rawData.slice(0)},r.actor&&r.actor.send("loadTile",R,z.bind(this),void 0,!0))},!0);r.request={cancel:F}}function z(F,G){return delete r.request,r.aborted?c(null):F&&F.status!==404?c(F):(G&&G.resourceTiming&&(r.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&r.setExpiryData(G),r.loadVectorData(G,this.map.painter),i.aK(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Gs extends i.E{constructor(r,c,p,x){super(),this.id=r,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.h({type:"raster"},c),i.h(this,i.aF(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,null,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new i.z(p)):x&&(i.h(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=yo.fromTileJSON(x),Ct(x.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return i.h({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=i.q.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=i.o(this.map._requestManager.transformRequest(x,i.R.Tile),(S,E,M,R)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):S?(r.state="errored",c(S)):E?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:M,expires:R}),r.setTexture(E,this.map.painter),r.state="loaded",i.aK(this.dispatcher),void c(null)):c(null)))}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c&&c()}unloadTile(r,c){r.texture&&r.texture instanceof i.T?(r.destroy(!0),r.texture&&r.texture instanceof i.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class kc extends Gs{constructor(r,c,p,x){super(r,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=i.h({type:"raster-array"},c)}triggerRepaint(r){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,r.tileID),this.map.triggerRepaint()}loadTile(r,c){const p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,i.R.Tile),S={request:x,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=x,r.actor||(r.actor=this.dispatcher.getActor());const E=(M,R,z,F)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(M)return M.name==="AbortError"?void 0:(r.state="errored",c(M));if(this.map._refreshExpiredTiles&&R&&r.setExpiryData({cacheControl:z,expires:F}),this.partial)r.state="empty";else{if(!R)return c(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=R}c(null)};r.request=this.partial?r.fetchHeader(void 0,E.bind(this)):r.actor.send("loadTile",S,E.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){const p=r.texture;p&&p instanceof i.T?(r.destroy(!0),this.map.painter.saveTileTexture(p)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,c,p){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(c,p,(x,S)=>{if(x)return r.state="errored",this.fire(new i.z(x)),void this.triggerRepaint(r);S&&(r._isHeaderLoaded=!0,r.setTexture(S,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:S})=>S===r),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(r,c,p){if(!r)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let S=null;c instanceof i.aN?S=c.paint.get("raster-array-band"):c instanceof i.aO&&(S=c.paint.get("raster-particle-array-band"));const E=S||this.getInitialBand(x);if(E!=null)if(r.textureDescriptor){if(!r.updateNeeded(x,E)||p)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,x,E)}getImages(r,c){const p=new Map;for(const x of r)for(const S of c){const[E,M]=S.split("/"),R=x.getLayer(E);if(!R||!R.hasBand(M)||!R.hasDataForBand(M))continue;const{bytes:z,tileSize:F,buffer:G}=R.getBandView(M),$=F+2*G,q={data:new i.r({width:$,height:$},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(S,q)}return p}}const Rf={vector:Bo,raster:Gs,"raster-dem":class extends Gs{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=i.h({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,S){x&&(f.state="errored",r(x)),S&&(f.dem=S,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=i.o(this.map._requestManager.transformRequest(c,i.R.Tile),(function(x,S,E,M){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(x)f.state="errored",r(x);else if(S){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:E,expires:M});const R=ImageBitmap&&S instanceof ImageBitmap&&i.t(),z=1-(S.width-i.aL(S.width))/2;z<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const F=R?S:i.q.getImageData(S,z),G={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:z};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",G,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,x=r.x===0?f.wrap-1:f.wrap,S=(r.x+1+c)%c,E=r.x+1===c?f.wrap+1:f.wrap,M={};return M[new i.aM(f.overscaledZ,x,r.z,p,r.y).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,r.z,S,r.y).key]={backfilled:!1},r.y>0&&(M[new i.aM(f.overscaledZ,x,r.z,p,r.y-1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,r.z,S,r.y-1).key]={backfilled:!1}),r.y+1<c&&(M[new i.aM(f.overscaledZ,x,r.z,p,r.y+1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},M[new i.aM(f.overscaledZ,E,r.z,S,r.y+1).key]={backfilled:!1}),M}},"raster-array":kc,geojson:class extends i.E{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=i.h({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=i.aj/this.tileSize;this.workerOptions=i.h({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*x,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*x,extent:i.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:i.aj,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const c of this._data.features)r.set(c.id,c);for(const c of f.features)r.set(c.id,c);this._data.features=[...r.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=i.h({append:f},this.workerOptions);r.scope=this.scope;const c=this._data;typeof c=="string"?(r.request=this.map._requestManager.transformRequest(i.q.resolveURL(c),i.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new i.z(p));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new i.A("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=i.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,S=this._partialReload,E={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:S,worldview:this.map.getWorldview()};f.request=this.actor.send(c,E,(M,R)=>S&&!R?(f.state="loaded",r(null)):(delete f.request,f.destroy(),f.aborted?r(null):M?r(M):(f.loadVectorData(R,this.map.painter,c==="reloadTile"),r(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,r){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aP{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,i.R.Source).url);i.aQ(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new i.z(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(f,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aP,model:class extends i.E{constructor(f,r,c,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const f=[];for(const r in this._options.models){const c=this._options.models[r],p=i.aS(this.map._requestManager.transformRequest(c.uri,i.R.Model).url).then(x=>{if(!x)return;const S=i.aT(x),E=new i.aU(r,c.position,c.orientation,S);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(x=>{this.fire(new i.z(new Error(`Could not load model ${r} from ${c.uri}: ${x.message}`)))});f.push(p)}Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this._loaded=!0,this.fire(new i.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,r){}serialize(){return this._options}},"batched-model":class extends i.E{constructor(f,r,c,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,r,c,(p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new i.z(p))):x&&(i.h(this,x),x.bounds&&(this.tileBounds=new yo(x.bounds,this.minzoom,this.maxzoom)),Ct(x.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,i.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=r;else{if(f.buckets){const S=Object.values(f.buckets);for(const E of S)E.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,x.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(S,E){return f.aborted?r(null):S&&S.status!==404?r(S):(this.map._refreshExpiredTiles&&E&&f.setExpiryData(E),f.loadModelData(E,this.map.painter),f.state="loaded",void r(null))}}serialize(){return i.h({},this._options)}},canvas:class extends i.aP{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new i.z(new i.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof i.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends i.E{constructor(f,r,c,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new yo(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),i.h(this,i.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:r,y:c,z:p}=f.canonical;return this._implementation.hasTile({x:r,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,r){const{x:c,y:p,z:x}=f.tileID.canonical,S=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:S.signal})).then((function(E){return delete f.request,f.aborted?(f.state="unloaded",r(null)):E===void 0?(f.state="errored",r(null)):E===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",r(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(E)?(this.loadTileData(f,E),f.state="loaded",void r(null)):(f.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.name!=="AbortError"&&(f.state="errored",r(E))}),f.request.cancel=()=>S.abort()}loadTileData(f,r){f.setTexture(r,this.map.painter)}unloadTile(f,r){if(f.texture&&f.texture instanceof i.T?(f.destroy(!0),f.texture&&f.texture instanceof i.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}r&&r()}abortTile(f,r){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=i.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Pc=function(f,r,c,p){const x=new Rf[r.type](f,r,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return i.aV(["load","abort","unload","serialize","prepare"],x),x};function Rc(f,r,c=""){return`${c}:${r.id||""}:${r.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:S}=p;return`featureset:${x}${S?`:import:${S}`:""}`}}(f.target)}`}function Nc(f,r,c,p=""){if(f.uniqueFeatureID){const x=Rc(f,r,p);if(c.has(x))return!0;c.add(x)}return!1}function yu(f,r,c,p,x=!1){const S=r.sourceCache.transform,E=r.sourceCache.tilesIn(f,r.has3DLayers,x);E.sort(yh);const M=[];for(const R of E){const z=R.tile.queryRenderedFeatures(r,R,c,p,S,x);Object.keys(z).length&&M.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:z})}return M.length===0?{}:function(R){const z={},F={};for(const G of R){const $=G.queryResults,q=G.wrappedTileID,ne=F[q]=F[q]||{};for(const J in $){const ie=$[J],oe=ne[J]=ne[J]||{},ce=z[J]=z[J]||[];for(const ge of ie)oe[ge.featureIndex]||(oe[ge.featureIndex]=!0,ce.push(ge))}}return z}(M)}function _u(f,r,c,p,x,S){const E={},M=p.queryRenderedSymbols(f),R=[];for(const z of Object.keys(M).map(Number))R.push(x[z]);R.sort(yh);for(const z of R){const F=z.featureIndex.lookupSymbolFeatures(M[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,r,c,S);for(const G in F){const $=E[G]=E[G]||[],q=F[G];q.sort((ne,J)=>{const ie=z.featureSortOrder;if(ie){const oe=ie.indexOf(ne.featureIndex);return ie.indexOf(J.featureIndex)-oe}return J.featureIndex-ne.featureIndex});for(const ne of q)$.push(ne)}}return E}function bd(f,r){const c=f.getRenderableIds().map(S=>f.getTileByID(S)),p=[],x={};for(let S=0;S<c.length;S++){const E=c[S],M=E.tileID.canonical.key;x[M]||(x[M]=!0,E.querySourceFeatures(p,r))}return p}function yh(f,r){const c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Wa(f,r){const c={};if(!r)return c;for(const p of f){const x=p.layerIds.map(S=>r.getLayer(S)).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(S=>x.filter(E=>E.id===S)[0]));for(const S of x)c[S.fqid]=p}}return c}const Vo=32,Eo=33,ec=new Uint16Array(8184);for(let f=0;f<2046;f++){let r=f+2,c=0,p=0,x=0,S=0,E=0,M=0;for(1&r?x=S=E=Vo:c=p=M=Vo;(r>>=1)>1;){const z=c+x>>1,F=p+S>>1;1&r?(x=c,S=p,c=E,p=M):(c=x,p=S,x=E,S=M),E=z,M=F}const R=4*f;ec[R+0]=c,ec[R+1]=p,ec[R+2]=x,ec[R+3]=S}const Aa=new Uint16Array(2178),pi=new Uint8Array(1089),_h=new Uint16Array(1089);function ll(f){return f===0?-.03125:f===32?.03125:0}const xu={type:2,extent:i.aj,loadGeometry:()=>[[new i.P(0,0),new i.P(i.aj+1,0),new i.P(i.aj+1,i.aj+1),new i.P(0,i.aj+1),new i.P(0,0)]]};class Dc{constructor(r,c,p,x,S,E){this.tileID=r,this.uid=i.a$(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=E}registerFadeDuration(r){const c=r+this.timeAdded;c<i.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,p){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=Wa(r.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof i.b1){if(this.hasSymbolBuckets=!0,!p)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof i.b1&&S.hasRTLText){this.hasRTLText=!0,i.b2();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x],E=c.style.getOwnLayer(x);if(!E)continue;const M=E.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,M)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new i.b0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,c,p){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,Wa(r.buckets,c.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const x in this.buckets){const S=this.buckets[x];S.uploadPending()&&S.upload(r)}const c=r.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new i.T(r,p.image,c.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(r,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(r,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(r,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(r,c,p,x,S,E){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=function(R,z){const F=i.bn([],[.5*R.width,.5*-R.height,1]);return i.bo(F,F,[1,-1,0]),i.az(F,F,R.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(F)}(S,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:c,pixelPosMatrix:M,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(r,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),S=c?c.sourceLayer:"",E=x._geojsonTileLayer||x[S];if(!E)return;const M=i.b3(c&&c.filter),{z:R,x:z,y:F}=this.tileID.canonical,G={z:R,x:z,y:F};for(let $=0;$<E.length;$++){const q=E.feature($);if(M.needGeometry){const ie=i.b4(q,!0);if(!M.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),ie,this.tileID.canonical))continue}else if(!M.filter(new i.aa(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const ne=p.getId(q,S),J=new i.b5(q,R,z,F,ne);J.tile=G,r.push(J)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const c=this.expirationTime;if(r.cacheControl){const p=i.b6(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const S=this.expirationTime-c;S?this.expirationTime=p+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,c){if(!this.latestFeatureIndex||!r.style)return;const p=this.latestFeatureIndex.loadVTLayers(),x=r.style.listImages(),S=r.style.getBrightness();for(const E in this.buckets){if(!r.style.hasLayer(E))continue;const M=this.buckets[E],R=M.layers[0],z=R.sourceLayer||"_geojsonTileLayer",F=p[z],G=r.style.getLayerSourceCache(R);let $={};G&&($=G._state.getState(z,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},ne=Object.keys($).length>0&&!c;ne&&!M.stateDependentLayers.length&&!c||M.update($,F,x,q,ne?M.stateDependentLayers:M.layers,c,S),(M instanceof i.b7||M instanceof i.b8)&&r._terrain&&r._terrain.enabled&&G&&M.uploadPending()&&r._terrain._clearRenderCacheForTile(G.id,this.tileID);const J=r&&r.style&&r.style.getOwnLayer(E);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=i.q.now()+r}setTexture(r,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r):(this.texture=new i.T(p,r,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(r,c){const p={};for(const x of c)p[x]=!0;this.dependencies[r]=p}hasDependency(r,c){for(const p of r){const x=this.dependencies[p];if(x){for(const S of c)if(x[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=i.b9(xu,this.tileID.canonical,this.tileTransform)[0],x=new i.ba,S=new i.bb;for(let E=0;E<p.length;E++){const{x:M,y:R}=p[E];x.emplaceBack(M,R),S.emplaceBack(E)}S.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(S),this._tileDebugBuffer=r.createVertexBuffer(x,i.bc.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,x.length,S.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=i.b9(xu,this.tileID.canonical,this.tileTransform)[0];let x,S;if(this.isRaster){const E=function(M,R){const z=i.aW(M,R),F=Math.pow(2,M.z);for(let ie=0;ie<Eo;ie++)for(let oe=0;oe<Eo;oe++){const ce=i.aX((M.x+(oe+ll(oe))/Vo)/F),ge=i.aY((M.y+(ie+ll(ie))/Vo)/F),xe=R.project(ce,ge),Ce=ie*Eo+oe;Aa[2*Ce+0]=Math.round((xe.x*z.scale-z.x)*i.aj),Aa[2*Ce+1]=Math.round((xe.y*z.scale-z.y)*i.aj)}pi.fill(0),_h.fill(0);for(let ie=2045;ie>=0;ie--){const oe=4*ie,ce=ec[oe+0],ge=ec[oe+1],xe=ec[oe+2],Ce=ec[oe+3],Ae=ce+xe>>1,Te=ge+Ce>>1,be=Ae+Te-ge,Ie=Te+ce-Ae,Re=ge*Eo+ce,Be=Ce*Eo+xe,Ge=Te*Eo+Ae,st=Math.hypot((Aa[2*Re+0]+Aa[2*Be+0])/2-Aa[2*Ge+0],(Aa[2*Re+1]+Aa[2*Be+1])/2-Aa[2*Ge+1])>=16;pi[Ge]=pi[Ge]||(st?1:0),ie<1022&&(pi[Ge]=pi[Ge]||pi[(ge+Ie>>1)*Eo+(ce+be>>1)]||pi[(Ce+Ie>>1)*Eo+(xe+be>>1)])}const G=new i.aZ,$=new i.a_;let q=0;function ne(ie,oe){const ce=oe*Eo+ie;return _h[ce]===0&&(G.emplaceBack(Aa[2*ce+0],Aa[2*ce+1],ie*i.aj/Vo,oe*i.aj/Vo),_h[ce]=++q),_h[ce]-1}function J(ie,oe,ce,ge,xe,Ce){const Ae=ie+ce>>1,Te=oe+ge>>1;if(Math.abs(ie-xe)+Math.abs(oe-Ce)>1&&pi[Te*Eo+Ae])J(xe,Ce,ie,oe,Ae,Te),J(ce,ge,xe,Ce,Ae,Te);else{const be=ne(ie,oe),Ie=ne(ce,ge),Re=ne(xe,Ce);$.emplaceBack(be,Ie,Re)}}return J(0,0,Vo,Vo,Vo,0),J(Vo,Vo,0,0,0,Vo),{vertices:G,indices:$}}(this.tileID.canonical,c);x=E.vertices,S=E.indices}else{x=new i.aZ,S=new i.a_;for(const{x:M,y:R}of p)x.emplaceBack(M,R,0,0);const E=i.be(x.int16.subarray(0,4*x.length),void 0,4);for(let M=0;M<E.length;M+=3)S.emplaceBack(E[M],E[M+1],E[M+2])}this._tileBoundsBuffer=r.createVertexBuffer(x,i.bf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(S),this._tileBoundsSegments=i.bd.simpleSegment(0,0,x.length,S.length)}_makeGlobeTileDebugBuffers(r,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,S=i.bg(x,c),E=i.bh(S),M=i.ah(c.zoom);let R;M>0&&(R=i.bi(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,x,c,E,R,M),this._makeGlobeTileDebugTextBuffer(r,x,c,E,R,M)}_globePoint(r,c,p,x,S,E,M){let R=i.bj(r,c,p);if(E){const z=1<<p.z,F=i.aD(x.center.lng),G=i.aH(x.center.lat),$=(p.x+.5)/z-F;let q=0;$>.5?q=-1:$<-.5&&(q=1);let ne=(r/i.aj+p.x)/z+q,J=(c/i.aj+p.y)/z;ne=(ne-F)*x._pixelsPerMercatorPixel+F,J=(J-G)*x._pixelsPerMercatorPixel+G;const ie=[ne*x.worldSize,J*x.worldSize,0];i.ad(ie,ie,E),R=i.bk(R,ie,M)}return i.ad(R,R,S)}_makeGlobeTileDebugBorderBuffer(r,c,p,x,S,E){const M=new i.ba,R=new i.bb,z=new i.bl,F=($,q,ne,J,ie)=>{const oe=(ne-$)/(ie-1),ce=(J-q)/(ie-1),ge=M.length;for(let xe=0;xe<ie;xe++){const Ce=$+xe*oe,Ae=q+xe*ce;M.emplaceBack(Ce,Ae);const Te=this._globePoint(Ce,Ae,c,p,x,S,E);z.emplaceBack(Te[0],Te[1],Te[2]),R.emplaceBack(ge+xe)}},G=i.aj;F(0,0,G,0,16),F(G,0,G,G,16),F(G,G,0,G,16),F(0,G,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(R),this._tileDebugBuffer=r.createVertexBuffer(M,i.bc.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(z,i.bm.members),this._tileDebugSegments=i.bd.simpleSegment(0,0,M.length,R.length)}_makeGlobeTileDebugTextBuffer(r,c,p,x,S,E){const M=i.aj/4,R=new i.ba,z=new i.a_,F=new i.bl,G=25;z.reserve(32),R.reserve(G),F.reserve(G);const $=(q,ne)=>G*q+ne;for(let q=0;q<G;q++){const ne=q*M;for(let J=0;J<G;J++){const ie=J*M;R.emplaceBack(ie,ne);const oe=this._globePoint(ie,ne,c,p,x,S,E);F.emplaceBack(oe[0],oe[1],oe[2])}}for(let q=0;q<4;q++)for(let ne=0;ne<4;ne++){const J=$(q,ne),ie=$(q,ne+1),oe=$(q+1,ne),ce=$(q+1,ne+1);z.emplaceBack(J,ie,oe),z.emplaceBack(oe,ie,ce)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(z),this._tileDebugTextBuffer=r.createVertexBuffer(R,i.bc.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(F,i.bm.members),this._tileDebugTextSegments=i.bd.simpleSegment(0,0,G,32)}destroy(r=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bp.setPbf(i.bq);class vu extends Dc{constructor(r,c,p,x,S){super(r,c,p,x,S),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexture(r,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof i.T?this.texture.update(r,{premultiply:!1}):this.texture=new i.T(p,r,x.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,c){const p=this._mrt=new i.bp(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=i.br(x,(S,E,M,R)=>{if(S)c(S);else try{const z=p.getHeaderLength(E);if(z>r)return void(this.request=this.fetchHeader(z,c));p.parseHeader(E),this._isHeaderLoaded=!0;let F=0;for(const G of Object.values(p.layers))F=Math.max(F,G.dataIndex[G.dataIndex.length-1].lastByte);E.byteLength>=F&&(this.entireBuffer=E),c(null,this.entireBuffer||E,M,R)}catch(z){c(z)}}),this.request}fetchBand(r,c,p){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void p(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void p(new Error("Can't fetch tile band without an actor"));let E;const M=(G,$)=>{E.complete(G,$),G?p(G):(this.updateTextureDescriptor(r,c),p(null,this.textureDescriptor&&this.textureDescriptor.img))},R=(G,$)=>{if(G)return p(G);const q=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:$,task:E},M,void 0,!0);this._workQueue.push(()=>{q&&q.cancel(),E.cancel()})},z=x.getLayer(r);if(!z)return void p(new Error(`Unknown sourceLayer "${r}"`));if(z.hasDataForBand(c))return this.updateTextureDescriptor(r,c),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);const F=z.getDataRange([c]);if(E=x.createDecodingTask(F),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)R(null,this.entireBuffer.slice(F.firstByte,F.lastByte+1));else{const G=Object.assign({},this.requestParams,{headers:{Range:`bytes=${F.firstByte}-${F.lastByte}`}}),$=i.br(G,R);this._fetchQueue.push(()=>{$.cancel(),E.cancel()})}else p(null)}updateNeeded(r,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,c){if(!this._mrt)return;const p=this._mrt.getLayer(r);if(!p||!p.hasBand(c)||!p.hasDataForBand(c))return;const{bytes:x,tileSize:S,buffer:E,offset:M,scale:R}=p.getBandView(c),z=S+2*E,F=new i.r({width:z,height:z},x),G=this.texture;G&&G instanceof i.T&&G.update(F,{premultiply:!1}),this.textureDescriptor={layer:r,band:c,img:F,buffer:E,offset:M,tileSize:S,format:p.pixelFormat,mix:[R,256*R,65536*R,16777216*R]}}}class Nf{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(const r in this.data)for(const c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,p){const x=r.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:c,timeout:void 0};if(p!==void 0&&(S.timeout=setTimeout(()=>{this.remove(r,S)},p)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){const c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;const p=r.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),S=this.data[p][x];return this.data[p].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){const c=[];for(const p in this.data)for(const x of this.data[p])r(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class wd{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,p){const x=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][x]=this.stateChanges[r][x]||{},i.h(this.stateChanges[r][x],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const S in this.state[r])S!==x&&(this.deletedStates[r][S]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][x]===null){this.deletedStates[r][x]={};for(const S in this.state[r][x])p[S]||(this.deletedStates[r][x][S]=null)}else for(const S in p)this.deletedStates[r]&&this.deletedStates[r][x]&&this.deletedStates[r][x][S]===null&&delete this.deletedStates[r][x][S]}removeFeatureState(r,c,p){if(this.deletedStates[r]===null)return;const x=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&c!==void 0)this.deletedStates[r][x]!==null&&(this.deletedStates[r][x]=this.deletedStates[r][x]||{},this.deletedStates[r][x][p]=null);else if(c!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][x])for(p in this.deletedStates[r][x]={},this.stateChanges[r][x])this.deletedStates[r][x][p]=null;else this.deletedStates[r][x]=null;else this.deletedStates[r]=null}getState(r,c){const p=this.state[r]||{},x=this.stateChanges[r]||{},S=this.deletedStates[r];if(S===null)return{};if(c!==void 0){const M=String(c),R=i.h({},p[M],x[M]);if(S){const z=S[c];if(z===null)return{};for(const F in z)delete R[F]}return R}const E=i.h({},p,x);if(S)for(const M in S)delete E[M];return E}initializeTileState(r,c){r.refreshFeatureState(c)}coalesceChanges(r,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const E in this.stateChanges[x])this.state[x][E]||(this.state[x][E]={}),i.h(this.state[x][E],this.stateChanges[x][E]),S[E]=this.state[x][E];p[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const E in this.state[x])S[E]={},this.state[x][E]={};else for(const E in this.deletedStates[x]){if(this.deletedStates[x][E]===null)this.state[x][E]={};else if(this.state[x][E])for(const M of Object.keys(this.deletedStates[x][E]))delete this.state[x][E][M];S[E]=this.state[x][E]}p[x]=p[x]||{},i.h(p[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in r)r[x].refreshFeatureState(c)}}class no extends i.E{constructor(r,c,p){super(),this.id=r,this._onlySymbols=p,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Nf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new wd,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(r),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(ea).map(r=>r.key)}getRenderableIds(r,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,r,c)&&p.push(this._tiles[x]);return r?p.sort((x,S)=>{const E=x.tileID,M=S.tileID,R=new i.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),z=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-M.overscaledZ||z.y-R.y||z.x-R.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(ea).map(x=>x.key)}hasRenderableParent(r){const c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())&&(p||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,r,c)))}_tileLoaded(r,c,p,x){if(x)if(r.state="errored",x.status!==404)this._source.fire(new i.z(x,{tile:r}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=i.q.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const S=c[x];if(r.neighboringTiles&&r.neighboringTiles[S]){const E=this.getTileByID(S);p(r,E),p(E,r)}}function p(x,S){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let E=S.tileID.canonical.x-x.tileID.canonical.x;const M=S.tileID.canonical.y-x.tileID.canonical.y,R=Math.pow(2,x.tileID.canonical.z),z=S.tileID.key;E===0&&M===0||Math.abs(M)>1||(Math.abs(E)>1&&(Math.abs(E+R)===1?E+=R:Math.abs(E-R)===1&&(E-=R)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,E,M),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,p,x){for(const S in this._tiles){let E=this._tiles[S];if(x[S]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>p)continue;let M=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(M=z)}let R=M;for(;R.overscaledZ>c;)if(R=R.scaledTo(R.overscaledZ-1),r[R.key]){x[M.key]=M;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=r.overscaledZ-1;p>=c;p--){const x=r.scaledTo(p),S=this._getLoadedTile(x);if(S)return S}}_getLoadedTile(r){const c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;const p=Math.ceil(r.width/c)+1,x=Math.ceil(r.height/c)+1,S=Math.floor(p*x*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(M)}handleWrapJump(r){const c=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,c){const p={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),p[S.tileID.key]=S}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(r,c,p,x,S){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(r,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const E=this._source.type==="batched-model";let M,R=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const $=z.attenuationRange()[0],q=Math.floor($)-Math.log2(z.getDemUpscale());R>q&&(R=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=r.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new i.aM($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y));else if(this.tileCoverLift!==0){const $=r.clone();$.tileCoverLift=this.tileCoverLift,M=$.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.minzoom<=1&&r.projection.name==="globe"&&(M.push(new i.aM(1,0,1,0,0)),M.push(new i.aM(1,0,1,1,0)),M.push(new i.aM(1,0,1,0,1)),M.push(new i.aM(1,0,1,1,1)))}else if(M=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:E}),this._source.hasTile){const $=this._source.hasTile.bind(this._source);M=M.filter(q=>$(q))}}else M=[];if(M.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Za(this._source.type)){const $=r.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),q=Math.min($,this._source.maxzoom);if(E){const ne=r.extendTileCover(M,q);for(const J of ne)M.push(J)}else if(S){const ne=r.extendTileCover(M,q,this.transform._camera.forward());for(const J of ne)M.push(J)}else if(this.castsShadows&&x){const ne=r.extendTileCover(M,q,x);for(const J of ne)this._shadowCasterTiles[J.key]=!0,M.push(J)}}const F=this._updateRetainedTiles(M);if(Za(this._source.type)&&M.length!==0){const $={},q={},ne=Object.keys(F);for(const ie of ne){const oe=F[ie],ce=this._tiles[ie];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=i.q.now())continue;const ge=this.findLoadedParent(oe,Math.max(oe.overscaledZ-no.maxOverzooming,this._source.minzoom));ge&&(this._addTile(ge.tileID),$[ge.tileID.key]=ge.tileID),q[ie]=oe}const J=M[M.length-1].overscaledZ;for(const ie in this._tiles){const oe=this._tiles[ie];if(F[ie]||!oe.hasData())continue;let ce=oe.tileID;for(;ce.overscaledZ>J;){ce=ce.scaledTo(ce.overscaledZ-1);const ge=this._tiles[ce.key];if(ge&&ge.hasData()&&q[ce.key]){F[ie]=oe.tileID;break}}}for(const ie in $)F[ie]||(this._coveredTiles[ie]=!0,F[ie]=$[ie])}for(const $ in F)this._tiles[$].clearFadeHold();const G=i.bs(this._tiles,F);for(const $ of G){const q=this._tiles[$];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+$)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const c={};if(r.length===0)return c;const p={},x=r.reduce((z,F)=>Math.min(z,F.overscaledZ),1/0),S=r[0].overscaledZ,E=Math.max(S-no.maxOverzooming,this._source.minzoom),M=Math.max(S+no.maxUnderzooming,this._source.minzoom),R={};for(const z of r){const F=this._addTile(z);c[z.key]=z,F.hasData()||x<this._source.maxzoom&&(R[z.key]=z)}this._retainLoadedChildren(R,x,M,c);for(const z of r){let F=this._tiles[z.key];if(F.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const $=z.children(this._source.maxzoom)[0],q=this.getTile($);if(q&&q.hasData()){c[$.key]=$;continue}}else{const $=z.children(this._source.maxzoom);if(c[$[0].key]&&c[$[1].key]&&c[$[2].key]&&c[$[3].key])continue}let G=F.wasRequested();for(let $=z.overscaledZ-1;$>=E;--$){const q=z.scaledTo($);if(p[q.key]||(p[q.key]=!0,F=this.getTile(q),!F&&G&&(F=this._addTile(q)),F&&(c[q.key]=q,G=F.wasRequested(),F.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const c=[];let p,x=this._tiles[r].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(S),p)break;x=S}for(const S of c)this._loadedParentTiles[S]=p}}_addTile(r){let c=this._tiles[r.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,S=this._source.tileSize*r.overscaleFactor();c=this._source.type==="raster-array"?new vu(r,S,this.transform.tileZoom,x,this._isRaster):new Dc(r,S,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c.uses++,this._tiles[r.key]=c,p||this._source.fire(new i.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=c.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,c,p){const x=[],S=this.transform;if(!S)return x;const E=S.projection.name==="globe",M=i.aD(S.center.lng);for(const R in this._tiles){const z=this._tiles[R];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let F;if(E){const G=z.tileID.canonical;if(G.z===0){const $=[Math.abs(i.ay(M,...Ia(G,-1))-M),Math.abs(i.ay(M,...Ia(G,1))-M)];F=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(i.ay(M,...Ia(G,-1))-M),Math.abs(i.ay(M,...Ia(G,0))-M),Math.abs(i.ay(M,...Ia(G,1))-M)];F=[$.indexOf(Math.min(...$))-1]}}else F=[0];for(const G of F){const $=r.containsTile(z,S,c,G);$&&x.push($)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,c){const p=this.getRenderableIds(r,c).map(S=>this._tiles[S].tileID),x=this.transform.projection.name==="globe";for(const S of p)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=x?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return p}sortCoordinatesByDistance(r){const c=r.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),S={};for(const E of c){const M=1/(1<<E.canonical.z);S[E.key]=((E.canonical.x+.5)*M+E.wrap-p[0])*x[0]+((E.canonical.y+.5)*M-p[1])*x[1]-p[2]*x[2]}return c.sort((E,M)=>S[E.key]-S[M.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Za(this._source.type))for(const r in this._tiles){const c=this._tiles[r];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(r,c,p){this._state.updateState(r=r||"_geojsonTileLayer",c,p)}removeFeatureState(r,c,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,p)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,p){const x=this._tiles[r];x&&x.setDependencies(c,p)}reloadTilesForDependencies(r,c){for(const p in this._tiles)this._tiles[p].hasDependency(r,c)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(r,c))}_preloadTiles(r,c){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(r,c))};return void this._source.on("data",R)}const p=new Map,x=Array.isArray(r)?r:[r],S=this.map.painter.terrain,E=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const R of x){const z=R.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of z)p.set(F.key,F);this.usedForTerrain&&R.updateElevation(!1)}const M=Array.from(p.values());i.bt(M,(R,z)=>{const F=new Dc(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,G=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),z(G,F)})},c)}}function ea(f,r){const c=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return f.overscaledZ-r.overscaledZ||p-c||r.canonical.y-f.canonical.y||r.canonical.x-f.canonical.x}function Za(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Ia(f,r){const c=1<<f.z;return[f.x/c+r,(f.x+1)/c+r]}no.maxOverzooming=10,no.maxUnderzooming=3;class xh{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:r,visibilityChanged:c});else if(x.type==="model"){const S=this.style.getLayerSource(x);S&&S.type==="batched-model"&&this.layers.push({layer:x,visible:r,visibilityChanged:c})}}}onNewFrame(r){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(r)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(r)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(r)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(r,c){this.currentBuildingBuckets=[];for(const x of this.layers){const S=x.layer,E=this.style.getLayerSourceCache(S);let M=1;S.type==="fill-extrusion"?M=x.visible?S.paint.get("fill-extrusion-vertical-scale"):0:S.type==="building"&&(M=x.visible?S.paint.get("building-vertical-scale"):0);let R=E?E.getTile(c):null;if(!R&&E&&c.canonical.z>E.getSource().minzoom){let z=c.scaledTo(Math.min(E.getSource().maxzoom,c.overscaledZ-1));for(;z.overscaledZ>=E.getSource().minzoom&&(R=E.getTile(z),!R&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:R?R.getBucket(S):null,tileID:R?R.tileID:c,verticalScale:M})}r.hasAnyZOffset=!1;let p=!1;for(let x=0;x<r.symbolInstances.length;x++){const S=r.symbolInstances.get(x),E=S.zOffset,M=this._getHeightAtTileOffset(c,S.tileAnchorX,S.tileAnchorY);S.zOffset=M!==Number.NEGATIVE_INFINITY?M:E,p||E===S.zOffset||(p=!0),r.hasAnyZOffset||S.zOffset===0||(r.hasAnyZOffset=!0)}p&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,c,p,x){let S=c,E=p;if(r.canonical.z!==x.canonical.z){const M=x.canonical,R=1/(1<<r.canonical.z-M.z);S=(c+r.canonical.x*i.aj)*R-M.x*i.aj|0,E=(p+r.canonical.y*i.aj)*R-M.y*i.aj|0}return{tileX:S,tileY:E}}_getHeightAtTileOffset(r,c,p){let x,S;for(let E=0;E<this.layers.length;++E){const M=this.layers[E].layer;if(M.type!=="fill-extrusion"&&M.type!=="building")continue;const{bucket:R,tileID:z,verticalScale:F}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:G,tileY:$}=this._mapCoordToOverlappingTile(r,c,p,z),q=R.getHeightAtTileCoord(G,$);q&&q.height!==void 0&&(q.hidden?x=q.height:S=Math.max(q.height*F,S||0))}if(S!==void 0)return S;for(let E=0;E<this.layers.length;++E){const M=this.layers[E];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:R,tileID:z}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:F,tileY:G}=this._mapCoordToOverlappingTile(r,c,p,z),$=R.getHeightAtTileCoord(F,G);if($&&!$.hidden)return $.height===void 0&&x!==void 0?Math.min($.maxHeight,x)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vh(f,r){const c={};for(const p in f)p!=="ref"&&(c[p]=f[p]);return i.bu.forEach(p=>{p in r&&(c[p]=r[p])}),c}function Xa(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=vh(f[c],r[f[c].ref]));return f}const Ar={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Sd(f,r,c){c.push({command:Ar.addSource,args:[f,r[f]]})}function Cl(f,r,c){r.push({command:Ar.removeSource,args:[f]}),c[f]=!0}function Td(f,r,c,p){Cl(f,c,p),Sd(f,r,c)}function Ig(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&p!=="data"&&!i.bv(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&p!=="data"&&!i.bv(f[c][p],r[c][p]))return!1;return!0}function Oc(f,r,c,p,x,S){let E;for(E in r=r||{},f=f||{})f.hasOwnProperty(E)&&(i.bv(f[E],r[E])||c.push({command:S,args:[p,E,r[E],x]}));for(E in r)r.hasOwnProperty(E)&&!f.hasOwnProperty(E)&&(i.bv(f[E],r[E])||c.push({command:S,args:[p,E,r[E],x]}))}function Lc(f){return f.id}function zc(f,r){return f[r.id]=r,f}class bu{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=i.ay(r,0,1);let c=1,p=this._distances[c];const x=r*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const S=c-1,E=this._distances[S],M=p-E,R=M>0?(x-E)/M:0;return this.points[S].mult(1-R).add(this.points[c].mult(R))}}class wu{constructor(r,c,p){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,x,S){this._forEachCell(c,p,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(r,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(r,c,p,x,S,E){this.boxCells[S].push(E)}_insertCircleCell(r,c,p,x,S,E){this.circleCells[S].push(E)}_query(r,c,p,x,S,E){if(p<0||r>this.width||x<0||c>this.height)return!S&&[];const M=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=x){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],F=this.circles[3*R+1],G=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:z-G,y1:F-G,x2:z+G,y2:F+G})}return E?M.filter(E):M}return this._forEachCell(r,c,p,x,this._queryCell,M,{hitTest:S,seenUids:{box:{},circle:{}}},E),S?M.length>0:M}_queryCircle(r,c,p,x,S){const E=r-p,M=r+p,R=c-p,z=c+p;if(M<0||E>this.width||z<0||R>this.height)return!x&&[];const F=[];return this._forEachCell(E,R,M,z,this._queryCellCircle,F,{hitTest:x,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},S),x?F.length>0:F}query(r,c,p,x,S){return this._query(r,c,p,x,!1,S)}hitTest(r,c,p,x,S){return this._query(r,c,p,x,!0,S)}hitTestCircle(r,c,p,x){return this._queryCircle(r,c,p,!0,x)}_queryCell(r,c,p,x,S,E,M,R){const z=M.seenUids,F=this.boxCells[S];if(F!==null){const $=this.bboxes;for(const q of F)if(!z.box[q]){z.box[q]=!0;const ne=4*q;if(r<=$[ne+2]&&c<=$[ne+3]&&p>=$[ne+0]&&x>=$[ne+1]&&(!R||R(this.boxKeys[q]))){if(M.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[q],x1:$[ne],y1:$[ne+1],x2:$[ne+2],y2:$[ne+3]})}}}const G=this.circleCells[S];if(G!==null){const $=this.circles;for(const q of G)if(!z.circle[q]){z.circle[q]=!0;const ne=3*q;if(this._circleAndRectCollide($[ne],$[ne+1],$[ne+2],r,c,p,x)&&(!R||R(this.circleKeys[q]))){if(M.hitTest)return E.push(!0),!0;{const J=$[ne],ie=$[ne+1],oe=$[ne+2];E.push({key:this.circleKeys[q],x1:J-oe,y1:ie-oe,x2:J+oe,y2:ie+oe})}}}}}_queryCellCircle(r,c,p,x,S,E,M,R){const z=M.circle,F=M.seenUids,G=this.boxCells[S];if(G!==null){const q=this.bboxes;for(const ne of G)if(!F.box[ne]){F.box[ne]=!0;const J=4*ne;if(this._circleAndRectCollide(z.x,z.y,z.radius,q[J+0],q[J+1],q[J+2],q[J+3])&&(!R||R(this.boxKeys[ne])))return E.push(!0),!0}}const $=this.circleCells[S];if($!==null){const q=this.circles;for(const ne of $)if(!F.circle[ne]){F.circle[ne]=!0;const J=3*ne;if(this._circlesCollide(q[J],q[J+1],q[J+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[ne])))return E.push(!0),!0}}}_forEachCell(r,c,p,x,S,E,M,R){const z=this._convertToXCellCoord(r),F=this._convertToYCellCoord(c),G=this._convertToXCellCoord(p),$=this._convertToYCellCoord(x);for(let q=z;q<=G;q++)for(let ne=F;ne<=$;ne++)if(S.call(this,r,c,p,x,this.xCellCount*ne+q,E,M,R))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,x,S,E){const M=x-r,R=S-c,z=p+E;return z*z>M*M+R*R}_circleAndRectCollide(r,c,p,x,S,E,M){const R=(E-x)/2,z=Math.abs(r-(x+R));if(z>R+p)return!1;const F=(M-S)/2,G=Math.abs(c-(S+F));if(G>F+p)return!1;if(z<=R||G<=F)return!0;const $=z-R,q=G-F;return $*$+q*q<=p*p}}const Ka={unknown:0,flipRequired:1,flipNotRequired:2},Ed=Math.tan(85*Math.PI/180);function tc(f,r,c,p,x,S,E){const M=i.bz();if(c)if(S.name==="globe"){const R=i.bA(x,r);i.az(M,M,R)}else{const R=i.bB([],E);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],p||i.by(M,M,x.angle)}else i.az(M,x.labelPlaneMatrix,f);return M}function Df(f,r,c,p,x,S,E){const M=tc(f,r,c,p,x,S,E);return S.name==="globe"&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function bh(f,r,c,p,x,S,E){if(c){if(S.name==="globe"){const M=tc(f,r,c,p,x,S,E);return i.bi(M,M),i.az(M,f,M),M}{const M=i.bw(f),R=i.bx([]);return R[0]=E[0],R[1]=E[1],R[4]=E[2],R[5]=E[3],i.az(M,M,R),p||i.by(M,M,-x.angle),M}}return x.glCoordMatrix}function ta(f,r,c,p){const x=[f,r,c,1];c?i.aA(x,x,p):Ir(x,x,p);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function Su(f,r){return Math.min(.5+f/r*.5,1.5)}function jc(f,r){const c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function cl(f,r,c,p,x,S,E,M,R,z){const F=c.transform,G=p?f.textSizeData:f.iconSizeData,$=i.bH(G,c.transform.zoom),q=F.projection.name==="globe",ne=[256/c.width*2+1,256/c.height*2+1],J=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;J.clear();let ie=null;q&&(ie=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const oe=f.lineVertexArray,ce=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ge=c.transform.width/c.transform.height;let xe,Ce=!1;for(let Ae=0;Ae<ce.length;Ae++){const Te=ce.get(Ae),{numGlyphs:be,writingMode:Ie}=Te;if(Ie!==i.bI.vertical||Ce||xe===i.bI.horizontal||(Ce=!0),xe=Ie,(Te.hidden||Ie===i.bI.vertical)&&!Ce){qs(be,J);continue}Ce=!1;const Re=new i.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Be,y:Ge,z:st}=F.projection.projectTilePoint(Re.x,Re.y,z.canonical);if(R){const[Vt,qt,Bt]=R(Re);Be+=Vt,Ge+=qt,st+=Bt}const it=[Be,Ge,st,1];if(i.aA(it,it,r),!jc(it,ne)){qs(be,J);continue}const mt=it[3],Ue=Su(c.transform.getCameraToCenterDistance(F.projection),mt),Je=i.bJ(G,$,Te),Le=E?Je/Ue:Je*Ue,lt=ta(Be,Ge,st,x);if(lt[3]<=0){qs(be,J);continue}let Ye={};const pt=i.al(f.layers[0].layout.get("text-max-angle")),It=Math.cos(pt),ct=E?null:R,wt=Fc(Te,Le,!1,M,r,x,S,f.glyphOffsetArray,oe,J,ie,lt,Re,Ye,ge,ct,F.projection,z,E,It);Ce=wt.useVertical,ct&&wt.needsFlipping&&(Ye={}),(wt.notEnoughRoom||Ce||wt.needsFlipping&&Fc(Te,Le,!0,M,r,x,S,f.glyphOffsetArray,oe,J,ie,lt,Re,Ye,ge,ct,F.projection,z,E,It).notEnoughRoom)&&qs(be,J)}p?(f.text.dynamicLayoutVertexBuffer.updateData(J),ie&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(ie)):(f.icon.dynamicLayoutVertexBuffer.updateData(J),ie&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(ie))}function Cd(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie){const{lineStartIndex:oe,glyphStartIndex:ce,segment:ge}=M,xe=ce+M.numGlyphs,Ce=oe+M.lineLength,Ae=r.getoffsetX(ce),Te=r.getoffsetX(xe-1),be=Eu(f*Ae,c,p,x,S,E,ge,oe,Ce,R,z,F,G,$,!0,q,ne,J,ie);if(!be)return null;const Ie=Eu(f*Te,c,p,x,S,E,ge,oe,Ce,R,z,F,G,$,!0,q,ne,J,ie);return Ie?{first:be,last:Ie}:null}function Tu(f,r,c,p){return f===i.bI.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:f===i.bI.vertical?p>0?{needsFlipping:!0}:null:r!==Ka.unknown&&function(x,S){return x===0||Math.abs(S/x)>Ed}(c,p)?r===Ka.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Fc(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce,ge){const xe=r/24,Ce=f.lineOffsetX*xe,Ae=f.lineOffsetY*xe,{lineStartIndex:Te,glyphStartIndex:be,numGlyphs:Ie,segment:Re,writingMode:Be,flipState:Ge}=f,st=Te+f.lineLength,it=mt=>{if(F){const[lt,Ye,pt]=mt.up,It=z.length;i.bK(F,It+0,lt,Ye,pt),i.bK(F,It+1,lt,Ye,pt),i.bK(F,It+2,lt,Ye,pt),i.bK(F,It+3,lt,Ye,pt)}const[Ue,Je,Le]=mt.point;i.bL(z,Ue,Je,Le,mt.angle)};if(Ie>1){const mt=Cd(xe,M,Ce,Ae,c,G,$,f,R,S,q,J,!1,ie,oe,ce,ge);if(!mt)return{notEnoughRoom:!0};if(p&&!c){let[Ue,Je,Le]=mt.first.point,[lt,Ye,pt]=mt.last.point;[Ue,Je]=ta(Ue,Je,Le,E),[lt,Ye]=ta(lt,Ye,pt,E);const It=Tu(Be,Ge,(lt-Ue)*ne,Ye-Je);if(f.flipState=It&&It.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,It)return It}it(mt.first);for(let Ue=be+1;Ue<be+Ie-1;Ue++){const Je=Eu(xe*M.getoffsetX(Ue),Ce,Ae,c,G,$,Re,Te,st,R,S,q,J,!1,!1,ie,oe,ce,ge);if(!Je)return z.length-=4*(Ue-be),{notEnoughRoom:!0};it(Je)}it(mt.last)}else{if(p&&!c){const Ue=ta($.x,$.y,0,x),Je=Te+Re+1,Le=new i.P(R.getx(Je),R.gety(Je)),lt=ta(Le.x,Le.y,0,x),Ye=lt[3]>0?lt:wh($,Le,Ue,1,x,void 0,ie,oe.canonical),pt=Tu(Be,Ge,(Ye[0]-Ue[0])*ne,Ye[1]-Ue[1]);if(f.flipState=pt&&pt.needsFlipping?Ka.flipRequired:Ka.flipNotRequired,pt)return pt}const mt=Eu(xe*M.getoffsetX(be),Ce,Ae,c,G,$,Re,Te,st,R,S,q,J,!1,!1,ie,oe,ce,ge);if(!mt)return{notEnoughRoom:!0};it(mt)}return{}}function _o(f,r,c,p,x){const{x:S,y:E,z:M}=p.projectTilePoint(f.x,f.y,r);if(!x)return ta(S,E,M,c);const[R,z,F]=x(f);return ta(S+R,E+z,M+F,c)}function wh(f,r,c,p,x,S,E,M){const R=_o(f.sub(r)._unit()._add(f),M,x,E,S);return i.at(R,c,R),i.au(R,R),i.bE(R,c,R,p)}function Eu(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce){const ge=p?f-r:f+r;let xe=ge>0?1:-1,Ce=0;p&&(xe*=-1,Ce=Math.PI),xe<0&&(Ce+=Math.PI);let Ae=M+E+(xe>0?0:1)|0,Te=x,be=x,Ie=0,Re=0;const Be=Math.abs(ge),Ge=[],st=[];let it=S,mt=it,Ue=i.bC([]);const Je=()=>wh(mt,it,be,Be-Ie+1,F,$,J,ie.canonical);for(;Ie+Re<=Be;){if(Ae+=xe,Ae<M||Ae>=R)return null;if(be=Te,mt=it,Ge.push(be),q&&st.push(mt),it=new i.P(z.getx(Ae),z.gety(Ae)),Te=G[Ae],!Te){const Bt=_o(it,ie.canonical,F,J,$);Te=Bt[3]>0?G[Ae]=Bt:Je()}Ie+=Re;const Vt=i.at([],Te,be),qt=i.bD(be,Te);if(c&&qt>0&&Re>0&&i.bG(Ue,Vt)/(Re*qt)<ce)return null;Re=qt,Ue=Vt}ne&&$&&(G[Ae]&&(Te=Je(),Re=i.bD(be,Te),Ue=i.at([],Te,be)),G[Ae]=Te);const Le=(Be-Ie)/Re,lt=it.sub(mt)._mult(Le)._add(mt),Ye=i.bE([],be,Ue,Le);let pt=[0,0,1],It=Ue[0],ct=Ue[1];if(oe&&(pt=J.upVector(ie.canonical,lt.x,lt.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const Vt=[pt[2],0,-pt[0]],qt=i.bF([],pt,Vt);i.au(Vt,Vt),i.au(qt,qt),It=i.bG(Ue,Vt),ct=i.bG(Ue,qt)}if(c){const Vt=i.bF([],pt,Ue);i.au(Vt,Vt),i.bE(Ye,Ye,Vt,c*xe)}const wt=Ce+Math.atan2(ct,It);return Ge.push(Ye),q&&st.push(lt),{point:Ye,angle:wt,path:Ge,tilePath:st,up:pt}}function qs(f,r){const c=r.length,p=c+4*f;r.resize(p),r.float32.fill(-1/0,4*c,4*p)}function Ir(f,r,c){const p=r[0],x=r[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const Ma=100;class Ad{constructor(r,c,p=new wu(r.width+200,r.height+200,25),x=new wu(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Ma,this.screenBottomBoundary=r.height+Ma,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,x,S,E,M,R){let z=p.projectedAnchorX,F=p.projectedAnchorY,G=p.projectedAnchorZ;const $=p.elevation,q=p.tileID,ne=r.getProjection();if($&&q){const[Ae,Te,be]=ne.upVector(q.canonical,p.tileAnchorX,p.tileAnchorY),Ie=ne.upVectorScale(q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Ae*$*Ie,F+=Te*$*Ie,G+=be*$*Ie}const J=this.projectAndGetPerspectiveRatio(M,z,F,G,p.tileID,ne.name==="globe"||!!$||this.transform.pitch>0,ne),ie=E*J.perspectiveRatio,oe=(p.x1*c+x.x-p.padding)*ie+J.point.x,ce=(p.y1*c+x.y-p.padding)*ie+J.point.y,ge=(p.x2*c+x.x+p.padding)*ie+J.point.x,xe=(p.y2*c+x.y+p.padding)*ie+J.point.y,Ce=J.perspectiveRatio<=.55||J.occluded;return!this.isInsideGrid(oe,ce,ge,xe)||!S&&this.grid.hitTest(oe,ce,ge,xe,R)||Ce?{box:[],offscreen:!1,occluded:J.occluded}:{box:[oe,ce,ge,xe],offscreen:this.isOffscreen(oe,ce,ge,xe),occluded:!1}}placeCollisionCircles(r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J){const ie=[],oe=this.transform.elevation,ce=r.getProjection(),ge=oe?oe.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,ce):null,xe=new i.P(p.tileAnchorX,p.tileAnchorY);let{x:Ce,y:Ae,z:Te}=ce.projectTilePoint(xe.x,xe.y,J.canonical);if(ge){const[pt,It,ct]=ge(xe);Ce+=pt,Ae+=It,Te+=ct}const be=ce.name==="globe",Ie=this.projectAndGetPerspectiveRatio(M,Ce,Ae,Te,J,be||!!oe||this.transform.pitch>0,ce),{perspectiveRatio:Re}=Ie,Be=(G?E/Re:E*Re)/i.bO,Ge=ta(Ce,Ae,Te,R),st=p.lineOffsetX*Be,it=p.lineOffsetY*Be,mt=i.al(r.layers[0].layout.get("text-max-angle")),Ue=Math.cos(mt),Je=Ie.signedDistanceFromCamera>0?Cd(Be,S,st,it,!1,Ge,xe,p,x,R,{},oe&&!G?ge:null,G&&!!oe,ce,J,G,Ue):null;let Le=!1,lt=!1,Ye=!0;if(Je&&!Ie.occluded){const pt=.5*q*Re+ne,It=new i.P(-100,-100),ct=new i.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new bu,{first:Vt,last:qt}=Je,Bt=Vt.path.length;let Xt=[];for(let Ln=Bt-1;Ln>=1;Ln--)Xt.push(Vt.path[Ln]);for(let Ln=1;Ln<qt.path.length;Ln++)Xt.push(qt.path[Ln]);const hn=2.5*pt;z&&(Xt=Xt.map(([Ln,Qn,br],oi)=>(ge&&!be&&(br=ge(oi<Bt-1?Vt.tilePath[Bt-1-oi]:qt.tilePath[oi-Bt+2])[2]),ta(Ln,Qn,br,z))),Xt.some(Ln=>Ln[3]<=0)&&(Xt=[]));let yn=[];if(Xt.length>0){let Ln=1/0,Qn=-1/0,br=1/0,oi=-1/0;for(const Vr of Xt)Ln=Math.min(Ln,Vr[0]),br=Math.min(br,Vr[1]),Qn=Math.max(Qn,Vr[0]),oi=Math.max(oi,Vr[1]);Qn>=It.x&&Ln<=ct.x&&oi>=It.y&&br<=ct.y&&(yn=[Xt.map(Vr=>new i.P(Vr[0],Vr[1]))],(Ln<It.x||Qn>ct.x||br<It.y||oi>ct.y)&&(yn=i.bM(yn,It.x,It.y,ct.x,ct.y)))}for(const Ln of yn){wt.reset(Ln,.25*pt);let Qn=0;Qn=wt.length<=.5*pt?1:Math.ceil(wt.paddedLength/hn)+1;for(let br=0;br<Qn;br++){const oi=br/Math.max(Qn-1,1),Vr=wt.lerp(oi),Pr=Vr.x+Ma,$i=Vr.y+Ma;ie.push(Pr,$i,pt,0);const Vn=Pr-pt,er=$i-pt,cr=Pr+pt,ai=$i+pt;if(Ye=Ye&&this.isOffscreen(Vn,er,cr,ai),lt=lt||this.isInsideGrid(Vn,er,cr,ai),!c&&this.grid.hitTestCircle(Pr,$i,pt,$)&&(Le=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!F&&Le||!lt?[]:ie,offscreen:Ye,collisionDetected:Le,occluded:Ie.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,S=-1/0,E=-1/0;for(const F of r){const G=new i.P(F.x+Ma,F.y+Ma);p=Math.min(p,G.x),x=Math.min(x,G.y),S=Math.max(S,G.x),E=Math.max(E,G.y),c.push(G)}const M=this.grid.query(p,x,S,E).concat(this.ignoredGrid.query(p,x,S,E)),R={},z={};for(const F of M){const G=F.key;if(R[G.bucketInstanceId]===void 0&&(R[G.bucketInstanceId]={}),R[G.bucketInstanceId][G.featureIndex])continue;const $=[new i.P(F.x1,F.y1),new i.P(F.x2,F.y1),new i.P(F.x2,F.y2),new i.P(F.x1,F.y2)];i.bN(c,$)&&(R[G.bucketInstanceId][G.featureIndex]=!0,z[G.bucketInstanceId]===void 0&&(z[G.bucketInstanceId]=[]),z[G.bucketInstanceId].push(G.featureIndex))}return z}insertCollisionBox(r,c,p,x,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:S},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,x,S){const E=c?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:x,collisionGroupID:S};for(let R=0;R<r.length;R+=4)E.insertCircle(M,r[R],r[R+1],r[R+2])}projectAndGetPerspectiveRatio(r,c,p,x,S,E,M){const R=[c,p,x,1];let z=!1;x||this.transform.pitch>0?(i.aA(R,R,r),this.fogState&&S&&M.name!=="globe"&&(z=function($,q,ne,J,ie,oe){const ce=oe.calculateFogTileMatrix(ie),ge=[q,ne,J];return i.ad(ge,ge,ce),Nt($,i.ae(ge),oe.pitch,oe._fov)}(this.fogState,c,p,x,S.toUnwrapped(),this.transform)>.9)):Ir(R,R,r);const F=R[3];return{point:new i.P((R[0]/F+1)/2*this.transform.width+Ma,(-R[1]/F+1)/2*this.transform.height+Ma),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/F*.5,1.5),signedDistanceFromCamera:F,occluded:E&&R[2]>F||z}}isOffscreen(r,c,p,x){return p<Ma||r>=this.screenRightBoundary||x<Ma||c>this.screenBottomBoundary}isInsideGrid(r,c,p,x){return p>=0&&r<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=i.bx([]);return i.bo(r,r,[-100,-100,0]),r}}function pm(f,r,c){const p=r.createTileMatrix(f,f.worldSize,c.toUnwrapped());return i.az(new Float32Array(16),f.projMatrix,p)}function Mn(f,r,c){if(r.projection.name===c.projection.name)return f.projMatrix;const p=c.clone();return p.setProjection(r.projection),pm(p,r.getProjection(),f)}function Sh(f,r,c){return r.name===c.projection.name?f.projMatrix:pm(c,r,f)}class nc{constructor(r,c,p,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Al{constructor(r,c,p,x,S,E=!1){this.text=new nc(r?r.text:null,c,p,S),this.icon=new nc(r?r.icon:null,c,x,S),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class na{constructor(r,c,p,x=!1){this.text=r,this.icon=c,this.skipFade=p,this.clipped=x}}class mm{constructor(){this.invProjMatrix=i.bz(),this.viewportMatrix=i.bz(),this.circles=[]}}class Th{constructor(r,c,p,x,S){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=S}}class ln{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function Ur(f,r,c,p,x){const{horizontalAlign:S,verticalAlign:E}=i.bT(f),M=-(S-.5)*r,R=-(E-.5)*c,z=i.bU(f,p);return new i.P(M+z[0]*x,R+z[1]*x)}function Br(f,r,c,p,x){const S=new i.P(f,r);return c&&S._rotate(p?x:-x),S}class ra{constructor(r,c,p,x,S,E){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Ad(this.transform,S),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ln(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,x,S=1){const E=p.getBucket(c),M=p.latestFeatureIndex;if(!E||!M||c.fqid!==E.layerIds[0])return;const R=E.layers[0].layout,z=E.layers[0].paint,F=p.collisionBoxArray,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/i.aj,q=p.tileID.toUnwrapped();this.transform.setProjection(E.projection);const ne=(J=p.tileID,ie=E.getProjection(),oe=this.transform,ie.name===this.projection?oe.calculateProjMatrix(J.toUnwrapped()):pm(oe,ie,J));var J,ie,oe;const ce=R.get("text-pitch-alignment")==="map",ge=R.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const xe=c.dynamicFilter(),Ce=c.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(p),Te=Df(ne,p.tileID.canonical,ce,ge,this.transform,E.getProjection(),Ae);let be=null;if(ce){const Je=bh(ne,p.tileID.canonical,ce,ge,this.transform,E.getProjection(),Ae);be=i.az([],this.transform.labelPlaneMatrix,Je)}let Ie=null;xe&&p.latestFeatureIndex&&(Ie={unwrappedTileID:q,dynamicFilter:xe,dynamicFilterNeedsFeature:Ce}),this.retainedQueryData[E.bucketInstanceId]=new Th(E.bucketInstanceId,M,E.sourceLayerIndex,E.index,p.tileID);const[Re,Be]=E.layers[0].layout.get("text-size-scale-range"),Ge=i.ay(S,Re,Be),[st,it]=R.get("icon-size-scale-range"),mt=i.ay(S,st,it),Ue={bucket:E,layout:R,paint:z,posMatrix:ne,textLabelPlaneMatrix:Te,labelToScreenMatrix:be,clippingData:Ie,scale:G,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:i.bH(E.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:i.bH(E.iconSizeData,this.transform.zoom,mt),collisionGroup:this.collisionGroups.get(E.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Je of E.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:lt,symbolInstanceEnd:Ye}=Je;r.push({sortKey:Le,symbolInstanceStart:lt,symbolInstanceEnd:Ye,parameters:Ue})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce){const{textOffset0:ge,textOffset1:xe,crossTileID:Ce}=$,Ae=[ge,xe],Te=Ur(r,p,x,Ae,S),be=this.collisionIndex.placeCollisionBox(ne,S,c,Br(Te.x,Te.y,E,M,this.transform.angle),G,R,z,F.predicate);if(ie){const Ie=ne.getSymbolInstanceIconSize(ce,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Ie,ie,Br(Te.x,Te.y,E,M,this.transform.angle),G,R,z,F.predicate).box.length===0)return}if(be.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(Ie=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:Ae,width:p,height:x,anchor:r,textScale:S,prevAnchor:Ie},this.markUsedJustification(ne,r,$,J),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,J,$),this.placedOrientations[Ce]=J),{shift:Te,placedGlyphBoxes:be}}}placeLayerBucketPart(r,c,p,x,S=1){const{bucket:E,layout:M,paint:R,posMatrix:z,textLabelPlaneMatrix:F,labelToScreenMatrix:G,clippingData:$,textPixelRatio:q,holdingForFade:ne,collisionBoxArray:J,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:oe,collisionGroup:ce,latestFeatureIndex:ge}=r.parameters,xe=M.get("text-optional"),Ce=M.get("icon-optional"),Ae=M.get("text-allow-overlap"),Te=M.get("icon-allow-overlap"),be=M.get("text-rotation-alignment")==="map",Ie=M.get("text-pitch-alignment")==="map",Re=R.get("symbol-z-offset"),Be=M.get("symbol-elevation-reference")==="sea",[Ge,st]=M.get("text-size-scale-range"),[it,mt]=M.get("icon-size-scale-range"),Ue=i.ay(S,Ge,st),Je=i.ay(S,it,mt);this.transform.setProjection(E.projection);let Le=Ae&&(Te||!E.hasIconData()||Ce),lt=Te&&(Ae||!E.hasTextData()||xe);const Ye=!Re.isConstant();!E.collisionArrays&&J&&E.deserializeCollisionBoxes(J),p&&x&&E.updateCollisionDebugBuffers(this.transform.zoom,J,Ue,Je);const pt=(ct,wt,Vt)=>{const{crossTileID:qt,numVerticalGlyphVertices:Bt}=ct;let Xt=null;if($&&$.dynamicFilterNeedsFeature||Ye){const Gr=this.retainedQueryData[E.bucketInstanceId];Xt=ge.loadFeature({featureIndex:ct.featureIndex,bucketIndex:Gr.bucketIndex,sourceLayerIndex:Gr.sourceLayerIndex,layoutVertexArrayOffset:0})}if($&&!(0,$.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Xt,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new i.P(ct.tileAnchorX,ct.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[qt]=new na(!1,!1,!1,!0),void c.add(qt);const hn=Re.evaluate(Xt,{});if(c.has(qt))return;if(ne)return void(this.placements[qt]=new na(!1,!1,!1));let yn=!1,Ln=!1,Qn=!0,br=!1,oi=!1,Vr=null,Pr={box:null,offscreen:null,occluded:null},$i={box:null},Vn=null,er=null,cr=null,ai=0,Ji=0,hi=0;Vt.textFeatureIndex?ai=Vt.textFeatureIndex:ct.useRuntimeCollisionCircles&&(ai=ct.featureIndex),Vt.verticalTextFeatureIndex&&(Ji=Vt.verticalTextFeatureIndex);const Lr=Gr=>{Gr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID;const di=this.transform.elevation;Gr.elevation=Be?hn:hn+(di?di.getAtTileOffset(Gr.tileID,Gr.tileAnchorX,Gr.tileAnchorY):0),Gr.elevation+=ct.zOffset},Fi=Vt.textBox;if(Fi){Lr(Fi);const Gr=Xn=>{let Gi=i.bI.horizontal;if(E.allowVerticalPlacement&&!Xn&&this.prevPlacement){const Bs=this.prevPlacement.placedOrientations[qt];Bs&&(this.placedOrientations[qt]=Bs,Gi=Bs,this.markUsedOrientation(E,Gi,ct))}return Gi},di=(Xn,Gi)=>{if(E.allowVerticalPlacement&&Bt>0&&Vt.verticalTextBox){for(const Bs of E.writingModes)if(Bs===i.bI.vertical?(Pr=Gi(),$i=Pr):Pr=Xn(),Pr&&Pr.box&&Pr.box.length)break}else Pr=Xn()};if(M.get("text-variable-anchor")){let Xn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qt]){const wi=this.prevPlacement.variableOffsets[qt];Xn.indexOf(wi.anchor)>0&&(Xn=Xn.filter(Dr=>Dr!==wi.anchor),Xn.unshift(wi.anchor))}const Gi=(wi,Dr,Zo)=>{const Ro=E.getSymbolInstanceTextSize(ie,ct,this.transform.zoom,wt),Oa=(wi.x2-wi.x1)*Ro+2*wi.padding,ws=(wi.y2-wi.y1)*Ro+2*wi.padding,da=ct.hasIconTextFit&&!Te?Dr:null;da&&Lr(da);let Xo={box:[],offscreen:!1,occluded:!1};const Ko=Ae?2*Xn.length:Xn.length;for(let fa=0;fa<Ko;++fa){const pa=this.attemptAnchorPlacement(Xn[fa%Xn.length],wi,Oa,ws,Ro,be,Ie,q,z,ce,fa>=Xn.length,ct,wt,E,Zo,da,ie,oe);if(pa&&(Xo=pa.placedGlyphBoxes,Xo&&Xo.box&&Xo.box.length)){yn=!0,Vr=pa.shift;break}}return Xo};di(()=>Gi(Fi,Vt.iconBox,i.bI.horizontal),()=>{const wi=Vt.verticalTextBox;return wi&&Lr(wi),E.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&Bt>0&&wi?Gi(wi,Vt.verticalIconBox,i.bI.vertical):{box:null,offscreen:null,occluded:null}}),Pr&&(yn=Pr.box,Qn=Pr.offscreen,br=Pr.occluded);const Bs=Gr(!(!Pr||!Pr.box));if(!yn&&this.prevPlacement){const wi=this.prevPlacement.variableOffsets[qt];wi&&(this.variableOffsets[qt]=wi,this.markUsedJustification(E,wi.anchor,ct,Bs))}}else{const Xn=(Gi,Bs)=>{const wi=E.getSymbolInstanceTextSize(ie,ct,this.transform.zoom,wt,S),Dr=this.collisionIndex.placeCollisionBox(E,wi,Gi,new i.P(0,0),Ae,q,z,ce.predicate);return Dr&&Dr.box&&Dr.box.length&&(this.markUsedOrientation(E,Bs,ct),this.placedOrientations[qt]=Bs),Dr};di(()=>Xn(Fi,i.bI.horizontal),()=>{const Gi=Vt.verticalTextBox;return E.allowVerticalPlacement&&Bt>0&&Gi?(Lr(Gi),Xn(Gi,i.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Gr(!!(Pr&&Pr.box&&Pr.box.length))}}if(Vn=Pr,yn=Vn&&Vn.box&&Vn.box.length>0,Qn=Vn&&Vn.offscreen,br=Vn&&Vn.occluded,ct.useRuntimeCollisionCircles){const Gr=E.text.placedSymbolArray.get(ct.centerJustifiedTextSymbolIndex>=0?ct.centerJustifiedTextSymbolIndex:ct.verticalPlacedTextSymbolIndex),di=i.bJ(E.textSizeData,ie,Gr),Xn=M.get("text-padding");er=this.collisionIndex.placeCollisionCircles(E,Ae,Gr,E.lineVertexArray,E.glyphOffsetArray,di,z,F,G,p,Ie,ce.predicate,ct.collisionCircleDiameter*di/i.bO,Xn,this.retainedQueryData[E.bucketInstanceId].tileID),yn=Ae||er.circles.length>0&&!er.collisionDetected,Qn=Qn&&er.offscreen,br=er.occluded}if(Vt.iconFeatureIndex&&(hi=Vt.iconFeatureIndex),Vt.iconBox){const Gr=di=>{Lr(di);const Xn=ct.hasIconTextFit&&Vr?Br(Vr.x,Vr.y,be,Ie,this.transform.angle):new i.P(0,0),Gi=E.getSymbolInstanceIconSize(oe,this.transform.zoom,ct.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,Gi,di,Xn,Te,q,z,ce.predicate)};$i&&$i.box&&$i.box.length&&Vt.verticalIconBox?(cr=Gr(Vt.verticalIconBox),Ln=cr.box.length>0):(cr=Gr(Vt.iconBox),Ln=cr.box.length>0),Qn=Qn&&cr.offscreen,oi=cr.occluded}const vr=xe||ct.numHorizontalGlyphVertices===0&&Bt===0,Bi=Ce||ct.numIconVertices===0;if(vr||Bi?Bi?vr||(Ln=Ln&&yn):yn=Ln&&yn:Ln=yn=Ln&&yn,yn&&Vn&&Vn.box&&this.collisionIndex.insertCollisionBox(Vn.box,M.get("text-ignore-placement"),E.bucketInstanceId,$i&&$i.box&&Ji?Ji:ai,ce.ID),Ln&&cr&&this.collisionIndex.insertCollisionBox(cr.box,M.get("icon-ignore-placement"),E.bucketInstanceId,hi,ce.ID),er&&(yn&&this.collisionIndex.insertCollisionCircles(er.circles,M.get("text-ignore-placement"),E.bucketInstanceId,ai,ce.ID),p)){const Gr=E.bucketInstanceId;let di=this.collisionCircleArrays[Gr];di===void 0&&(di=this.collisionCircleArrays[Gr]=new mm);for(let Xn=0;Xn<er.circles.length;Xn+=4)di.circles.push(er.circles[Xn+0]),di.circles.push(er.circles[Xn+1]),di.circles.push(er.circles[Xn+2]),di.circles.push(er.collisionDetected?1:0)}const gi=E.projection.name!=="globe";Le=Le&&(gi||!br),lt=lt&&(gi||!oi),this.placements[qt]=new na(yn||Le,Ln||lt,Qn||E.justReloaded),c.add(qt)},It=this.retainedQueryData[E.bucketInstanceId].tileID;if(E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,It),E.elevationType==="road"&&E.updateRoadElevation(It.canonical),E.updateZOffset(),E.sortFeaturesByY){const ct=E.getSortedSymbolIndexes(this.transform.angle);for(let wt=ct.length-1;wt>=0;--wt){const Vt=ct[wt];pt(E.symbolInstances.get(Vt),Vt,E.collisionArrays[Vt])}E.hasAnyZOffset&&i.w(`${E.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(E.hasAnyZOffset){const ct=E.getSortedIndexesByZOffset();for(let wt=0;wt<ct.length;++wt){const Vt=ct[wt];pt(E.symbolInstances.get(Vt),Vt,E.collisionArrays[Vt])}}else for(let ct=r.symbolInstanceStart;ct<r.symbolInstanceEnd;ct++)pt(E.symbolInstances.get(ct),ct,E.collisionArrays[ct]);if(p&&E.bucketInstanceId in this.collisionCircleArrays){const ct=this.collisionCircleArrays[E.bucketInstanceId];i.bi(ct.invProjMatrix,z),ct.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(r,c,p,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R,crossTileID:z}=p,F=i.bV(c),G=x===i.bI.vertical?R:F==="left"?S:F==="center"?E:F==="right"?M:-1;S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=G>=0&&S!==G?0:z),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=G>=0&&E!==G?0:z),M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=G>=0&&M!==G?0:z),R>=0&&(r.text.placedSymbolArray.get(R).crossTileID=G>=0&&R!==G?0:z)}markUsedOrientation(r,c,p){const x=c===i.bI.horizontal||c===i.bI.horizontalOnly?c:0,S=c===i.bI.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z}=p,F=r.text.placedSymbolArray;E>=0&&(F.get(E).placedOrientation=x),M>=0&&(F.get(M).placedOrientation=x),R>=0&&(F.get(R).placedOrientation=x),z>=0&&(F.get(z).placedOrientation=S)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(r):1,S=c?c.opacities:{},E=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const R in this.placements){const z=this.placements[R],F=S[R];F?(this.opacities[R]=new Al(F,x,z.text,z.icon,null,z.clipped),p=p||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[R]=new Al(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const R in S){const z=S[R];if(!this.opacities[R]){const F=new Al(z,x,!1,!1);F.isHidden()||(this.opacities[R]=F,p=p||z.text.placed||z.icon.placed)}}for(const R in E)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=E[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c,p,x){const S=new Set;for(const E of c){const M=E.getBucket(r);M&&E.latestFeatureIndex&&r.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,S,E,E.collisionBoxArray,p,x,E.tileID,r.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,E.tileID),M.elevationType==="road"&&M.updateRoadElevation(E.tileID.canonical),M.updateZOffset())}}updateBucketOpacities(r,c,p,x,S,E,M,R){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const z=r.layers[0].layout,F=r.layers[0].paint,G=!!r.layers[0].dynamicFilter(),$=new Al(null,0,!1,!1,!0),q=z.get("text-allow-overlap"),ne=z.get("icon-allow-overlap"),J=z.get("text-variable-anchor"),ie=z.get("text-rotation-alignment")==="map",oe=z.get("text-pitch-alignment")==="map",ce=F.get("symbol-z-offset"),ge=z.get("symbol-elevation-reference")==="sea",xe=!ce.isConstant(),Ce=new Al(null,0,q&&(ne||!r.hasIconData()||z.get("icon-optional")),ne&&(q||!r.hasTextData()||z.get("text-optional")),!0);!r.collisionArrays&&x&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(x);const Ae=(be,Ie,Re)=>{for(let Be=0;Be<Ie/4;Be++)be.opacityVertexArray.emplaceBack(Re)};let Te=0;E&&r.updateReplacement(M,E);for(let be=0;be<r.symbolInstances.length;be++){const Ie=r.symbolInstances.get(be),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Be,crossTileID:Ge,numIconVertices:st,tileAnchorX:it,tileAnchorY:mt}=Ie;let Ue=null;const Je=this.retainedQueryData[r.bucketInstanceId];xe&&Ie&&Je&&(Ue=p.latestFeatureIndex.loadFeature({featureIndex:Ie.featureIndex,bucketIndex:Je.bucketIndex,sourceLayerIndex:Je.sourceLayerIndex,layoutVertexArrayOffset:0}));const Le=ce.evaluate(Ue,{}),lt=c.has(Ge);let Ye=this.opacities[Ge];lt?Ye=$:Ye||(Ye=Ce,this.opacities[Ge]=Ye),c.add(Ge);const pt=Re>0||Be>0,It=st>0,ct=this.placedOrientations[Ge],wt=ct===i.bI.vertical,Vt=ct===i.bI.horizontal||ct===i.bI.horizontalOnly;!pt&&!It||Ye.isHidden()||Te++;let qt=!1;if((pt||It)&&E)for(const Bt of r.activeReplacements){if(i.bP(Bt,S,i.bQ.Symbol,R)||Bt.min.x>it||it>Bt.max.x||Bt.min.y>mt||mt>Bt.max.y)continue;const Xt=i.bR(it,mt,M.canonical,Bt.footprintTileId.canonical);if(qt=i.bS(Xt,Bt.footprint),qt)break}if(pt){const Bt=qt?Vc:Bc(Ye.text);Ae(r.text,Re,wt?Vc:Bt),Ae(r.text,Be,Vt?Vc:Bt);const Xt=Ye.text.isHidden(),{leftJustifiedTextSymbolIndex:hn,centerJustifiedTextSymbolIndex:yn,rightJustifiedTextSymbolIndex:Ln,verticalPlacedTextSymbolIndex:Qn}=Ie,br=r.text.placedSymbolArray,oi=Xt||wt?1:0;hn>=0&&(br.get(hn).hidden=oi),yn>=0&&(br.get(yn).hidden=oi),Ln>=0&&(br.get(Ln).hidden=oi),Qn>=0&&(br.get(Qn).hidden=Xt||Vt?1:0);const Vr=this.variableOffsets[Ge];Vr&&this.markUsedJustification(r,Vr.anchor,Ie,ct);const Pr=this.placedOrientations[Ge];Pr&&(this.markUsedJustification(r,"left",Ie,Pr),this.markUsedOrientation(r,Pr,Ie))}if(It){const Bt=qt?Vc:Bc(Ye.icon),{placedIconSymbolIndex:Xt,verticalPlacedIconSymbolIndex:hn}=Ie,yn=r.icon.placedSymbolArray,Ln=Ye.icon.isHidden()?1:0;Xt>=0&&(Ae(r.icon,st,wt?Vc:Bt),yn.get(Xt).hidden=Ln),hn>=0&&(Ae(r.icon,Ie.numVerticalIconVertices,Vt?Vc:Bt),yn.get(hn).hidden=Ln)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Bt=r.collisionArrays[be];if(Bt){let Xt=new i.P(0,0),hn=!0;if(Bt.textBox||Bt.verticalTextBox){if(J){const Ln=this.variableOffsets[Ge];Ln?(Xt=Ur(Ln.anchor,Ln.width,Ln.height,Ln.textOffset,Ln.textScale),ie&&Xt._rotate(oe?this.transform.angle:-this.transform.angle)):hn=!1}G&&(hn=!Ye.clipped),Bt.textBox&&rc(r.textCollisionBox.collisionVertexArray,Ye.text.placed,!hn||wt,Le,ge,Xt.x,Xt.y),Bt.verticalTextBox&&rc(r.textCollisionBox.collisionVertexArray,Ye.text.placed,!hn||Vt,Le,ge,Xt.x,Xt.y)}const yn=hn&&!!(!Vt&&Bt.verticalIconBox);Bt.iconBox&&rc(r.iconCollisionBox.collisionVertexArray,Ye.icon.placed,yn,Le,ge,Ie.hasIconTextFit?Xt.x:0,Ie.hasIconTextFit?Xt.y:0),Bt.verticalIconBox&&rc(r.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!yn,Le,ge,Ie.hasIconTextFit?Xt.x:0,Ie.hasIconTextFit?Xt.y:0)}}}if(r.fullyClipped=Te===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=be.invProjMatrix,r.placementViewportMatrix=be.viewportMatrix,r.collisionCircleArray=be.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function rc(f,r,c,p,x,S,E){f.emplaceBack(r?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(r?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(r?1:0,c?1:0,S||0,E||0,p,x?1:0),f.emplaceBack(r?1:0,c?1:0,S||0,E||0,p,x?1:0)}const $r=Math.pow(2,25),Of=Math.pow(2,24),Eh=Math.pow(2,17),Id=Math.pow(2,16),Co=Math.pow(2,9),ds=Math.pow(2,8),Gy=Math.pow(2,1);function Bc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*$r+r*Of+c*Eh+r*Id+c*Co+r*ds+c*Gy+r}const Vc=0;class Md{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,p,x,S,E){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(M,x,r[this._currentTileIndex],this._sortAcrossTiles,E),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<M.length;){const R=M[this._currentPartIndex];if(c.placeLayerBucketPart(R,this._seenCrossTileIDs,p,R.symbolInstanceStart===0,E),this._currentPartIndex++,S())return!0}return!1}}class Lf{constructor(r,c,p,x,S,E,M,R,z){this.placement=new ra(r,S,E,M,R,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p,x,S){const E=i.q.now(),M=()=>{const R=i.q.now()-E;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=c[r[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){const F=R,G=F.layout.get("symbol-z-elevate"),$=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=F.layout.get("symbol-z-order"),ne=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&$),J=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ie=ne&&J,oe=this._inProgressLayer=this._inProgressLayer||new Md(F),ce=i.C(R.source,R.scope);if(oe.continuePlacement(G||ie?x[ce]:p[ce],this.placement,this._showCollisionBoxes,R,M,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ch=512/i.aj/2;class zf{constructor(r,c,p){this.tileID=r,this.bucketInstanceId=p,this.index=new i.bW(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=r.canonical.x*i.aj,S=r.canonical.y*i.aj;for(let E=0;E<c.length;E++){const{key:M,crossTileID:R,tileAnchorX:z,tileAnchorY:F}=c.get(E),G=Math.floor((x+z)*Ch),$=Math.floor((S+F)*Ch);this.index.add(G,$),this.keys.push(M),this.crossTileIDs.push(R)}this.index.finish()}findMatches(r,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),S=Ch/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*i.aj,M=c.canonical.y*i.aj;for(let R=0;R<r.length;R++){const z=r.get(R);if(z.crossTileID)continue;const{key:F,tileAnchorX:G,tileAnchorY:$}=z,q=Math.floor((E+G)*S),ne=Math.floor((M+$)*S),J=this.index.range(q-x,ne-x,q+x,ne+x).sort((ie,oe)=>ie-oe);for(const ie of J){const oe=this.crossTileIDs[ie];if(this.keys[ie]===F&&!p.has(oe)){p.add(oe),z.crossTileID=oe;break}}}}}class Ao{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ic{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],S={};for(const E in x){const M=x[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),S[M.tileID.key]=M}this.indexes[p]=S}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let S=0;S<c.symbolInstances.length;S++)c.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const x=this.usedCrossTileIDs[r.overscaledZ];for(const S in this.indexes){const E=this.indexes[S];if(Number(S)>r.overscaledZ)for(const M in E){const R=E[M];R.tileID.isChildOf(r)&&R.findMatches(c.symbolInstances,r,x)}else{const M=E[r.scaledTo(Number(S)).key];M&&M.findMatches(c.symbolInstances,r,x)}}for(let S=0;S<c.symbolInstances.length;S++){const E=c.symbolInstances.get(S);E.crossTileID||(E.crossTileID=p.generate(),x.add(E.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new zf(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[r].delete(p)}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const S in x)r[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[S]),delete x[S],c=!0)}return c}}class Uo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p,x){let S=this.layerIndexes[r.fqid];S===void 0&&(S=this.layerIndexes[r.fqid]=new ic);let E=!1;const M={};x.name!=="globe"&&S.handleWrapJump(p);for(const R of c){const z=R.getBucket(r);z&&r.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,z,this.crossTileIDs)&&(E=!0),M[z.bucketInstanceId]=!0)}return S.removeStaleBuckets(M)&&(E=!0),E}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Cu=771;class ar{constructor(r,c,p,x){this.blendFunction=r,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}ar.Replace=[1,0,1,0],ar.disabled=new ar(ar.Replace,i.am.transparent,[!1,!1,!1,!1]),ar.unblended=new ar(ar.Replace,i.am.transparent,[!0,!0,!0,!0]),ar.alphaBlended=new ar([1,Cu,1,Cu],i.am.transparent,[!0,!0,!0,!0]),ar.alphaBlendedNonPremultiplied=new ar([770,Cu,770,Cu],i.am.transparent,[!0,!0,!0,!0]),ar.multiply=new ar([774,0,774,0],i.am.transparent,[!0,!0,!0,!0]);class Kt{constructor(r,c,p){this.func=r,this.mask=c,this.range=p}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const ia=7680;class Dn{constructor(r,c,p,x,S,E){this.test=r,this.ref=c,this.mask=p,this.fail=x,this.depthFail=S,this.pass=E}}Dn.disabled=new Dn({func:519,mask:0},0,0,ia,ia,ia);const as=1029,Ah=2305;class In{constructor(r,c,p){this.enable=r,this.mode=c,this.frontFace=p}}function Au(f,r){const c=i.c1(f,3);i.c3(f,r),i.c7(f,3,c)}function Iu(f,r){const c=i.b_([]);return i.b$(c,c,-r),i.c0(c,c,-f),c}function sc(f,r){const c=[f[0],f[1],0],p=[r[0],r[1],0];if(i.ae(c)>=1e-15){const E=i.au([],c);i.bY(p,E,i.bG(p,E)),r[0]=p[0],r[1]=p[1]}const x=i.bF([],r,f);if(i.bZ(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Iu(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),S)}In.disabled=new In(!1,as,Ah),In.backCCW=new In(!0,as,Ah),In.backCW=new In(!0,as,2304),In.frontCW=new In(!0,1028,2304),In.frontCCW=new In(!0,1028,Ah);class Mu{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof i.ac?r:new i.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=i.bX(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(r)):0,S=i.ac.fromLngLat(r,x),E=[S.x-p.x,S.y-p.y,S.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=sc(E,c)}setPitchBearing(r,c){this.orientation=Iu(i.al(r),i.al(-c))}}class Ya{constructor(r,c){this._transform=i.bx([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new i.ac(r[0],r[1],r[2])}get position(){const r=i.c1(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&i.c7(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||i.b_([]),r&&Au(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Iu(r,c),Au(this._transform,this._orientation)}forward(){const r=i.c1(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=i.c1(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=i.c1(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return i.bi(p,this.getWorldToCamera(r,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,c,p){const x=this.position;i.bY(x,x,-r);const S=new Float64Array(16);return i.bn(S,[p,p,p]),i.bo(S,S,x),S[10]*=c,S}getWorldToCamera(r,c){const p=new Float64Array(16),x=new Float64Array(4),S=this.position;return i.c2(x,this._orientation),i.bY(S,S,-r),i.c3(p,x),i.bo(p,p,S),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,x){const S=new Float64Array(16);return i.c4(S,r,c,p,x),S}getCameraToClipOrthographic(r,c,p,x,S,E){const M=new Float64Array(16);return i.c5(M,r,c,p,x,S,E),M}getDistanceToElevation(r,c=!1){const p=r===0?0:i.c6(r,c?i.aY(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Ya([...this.position],[...this.orientation])}}const Io={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class kd{constructor(r=0,c=0,p=0,x=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=x}interpolate(r,c,p){return c.top!=null&&r.top!=null&&(this.top=i.ai(r.top,c.top,p)),c.bottom!=null&&r.bottom!=null&&(this.bottom=i.ai(r.bottom,c.bottom,p)),c.left!=null&&r.left!=null&&(this.left=i.ai(r.left,c.left,p)),c.right!=null&&r.right!=null&&(this.right=i.ai(r.right,c.right,p)),this}getCenter(r,c){const p=i.ay((this.left+r-this.right)/2,0,r),x=i.ay((this.top+c-this.bottom)/2,0,c);return new i.P(p,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new kd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ms=15;class jf{constructor(r,c,p,x,S,E,M){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(E),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ya,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new jf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ms}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(r||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return i.aF(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=i.ce(this.projectionOptions);const p=this.getProjection(),x=!i.bv(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.ce({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bX(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=i.cf(),i.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=i.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=i.al(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,S=0;for(let E=0;E<c.length;E++){const M=new i.P(c[E][0]*this.width,p+c[E][1]*(this.height-p)),R=r.pointCoordinate(M);if(!R)continue;const z=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*z,S+=z}return S===0?NaN:x/S}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(r),S=this._mercatorZfromZoom(this._maxZoom),E=Math.max(x-p,S);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const x=i.ae(i.at([],this._camera.position,p));return i.ay(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!i.ch(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];i.ci(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Mu;return c.position=new i.ac(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!i.cj(r))return!1;i.ck(r,r);const c=i.cl([],[0,0,-1],r),p=i.cl([],[0,-1,0],r);if(p[2]<0)return!1;const x=sc(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=i.ay(r[2],x/p,x/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new i.cm(0,r)];if(this.renderWorldCopies){const p=this.pointCoordinate(new i.P(0,0)),x=this.pointCoordinate(new i.P(this.width,0)),S=this.pointCoordinate(new i.P(this.width,this.height)),E=this.pointCoordinate(new i.P(0,this.height)),M=Math.floor(Math.min(p.x,x.x,S.x,E.x)),R=Math.floor(Math.max(p.x,x.x,S.x,E.x)),z=1;for(let F=M-z;F<=R+z;F++)F!==0&&c.push(new i.cm(F,r))}return c}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,c,p){let x=[];const S=p!=null,E=!S;if(E&&this.zoom<c||S&&p[0]===0&&p[1]===0)return x;const M=new Set,R=(F,G,$,q,ne)=>{const J=i.cK(G,F,$,q,ne);M.has(J)||(x.push(new i.aM(F,G,$,q,ne)),M.add(J))};for(let F=0;F<r.length;F++){const G=r[F];if(E&&G.canonical.z!==c)continue;const $=G.canonical,q=G.overscaledZ,ne=G.wrap,J=1<<$.z,ie=$.x+1<J,oe=$.x>0,ce=$.y+1<J,ge=$.y>0,xe=G.wrap-(oe?0:1),Ce=G.wrap+(ie?0:1),Ae=oe?$.x-1:J-1,Te=ie?$.x+1:0;if(S)p[0]<0?(R(q,Ce,$.z,Te,$.y),p[1]<0&&ce&&(R(q,ne,$.z,$.x,$.y+1),R(q,Ce,$.z,Te,$.y+1)),p[1]>0&&ge&&(R(q,ne,$.z,$.x,$.y-1),R(q,Ce,$.z,Te,$.y-1))):p[0]>0?(R(q,xe,$.z,Ae,$.y),p[1]<0&&ce&&(R(q,ne,$.z,$.x,$.y+1),R(q,xe,$.z,Ae,$.y+1)),p[1]>0&&ge&&(R(q,ne,$.z,$.x,$.y-1),R(q,xe,$.z,Ae,$.y-1))):p[1]<0&&ce?R(q,ne,$.z,$.x,$.y+1):ge&&R(q,ne,$.z,$.x,$.y-1);else{const be=G.visibleQuadrants;1&be&&(R(q,xe,$.z,Ae,$.y),ge&&(R(q,ne,$.z,$.x,$.y-1),R(q,xe,$.z,Ae,$.y-1))),2&be&&(R(q,Ce,$.z,Te,$.y),ge&&(R(q,ne,$.z,$.x,$.y-1),R(q,Ce,$.z,Te,$.y-1))),4&be&&(R(q,xe,$.z,Ae,$.y),ce&&(R(q,ne,$.z,$.x,$.y+1),R(q,xe,$.z,Ae,$.y+1))),8&be&&(R(q,Ce,$.z,Te,$.y),ce&&(R(q,ne,$.z,$.x,$.y+1),R(q,Ce,$.z,Te,$.y+1)))}}const z=[];for(const F of x)x.some(G=>F.isChildOf(G))||z.push(F);if(x=z.filter(F=>!r.some(G=>!!(F.overscaledZ<c&&G.isChildOf(F))||F.equals(G)||F.isChildOf(G))),E){const F=1<<c,G=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[F*G.x,F*G.y],q=4,ne=q*q;x=x.filter(J=>{const ie=J.canonical.x+.5-$[0],oe=J.canonical.y+.5-$[1];return ie*ie+oe*oe<ne})}return x}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,x=this.elevation&&this.elevation.exaggeration(),S=x&&!r.isTerrainDEM,E=this.projection.name==="mercator";if(r.minzoom!==void 0&&c<r.minzoom)return[];r.maxzoom!==void 0&&c>r.maxzoom&&(c=r.maxzoom);const M=this.locationCoordinate(this.center),R=this.center.lat,z=1<<c,F=[z*M.x,z*M.y,0],G=this.projection.name==="globe",$=!G,q=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,$),ne=G?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=z*i.c6(1,this.center.lat),ie=this._camera.position[2]/i.c6(1,this.center.lat),oe=[z*ne.x,z*ne.y,ie*($?1:J)],ce=G||x,ge=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),xe=this.isLODDisabled(!0)?c:0;let Ce;if(this._elevation&&r.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();Ce=Le?Le.max:this._centerAltitude}else Ce=this._centerAltitude;const Ae=r.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?i.co(this):1,be=Le=>{const Ye=new i.ac(Le.x+25e-6,Le.y,Le.z),pt=new i.ac(Le.x,Le.y+25e-6,Le.z),It=Le.toLngLat(),ct=Ye.toLngLat(),wt=pt.toLngLat(),Vt=this.locationCoordinate(It),qt=this.locationCoordinate(ct),Bt=this.locationCoordinate(wt),Xt=Math.hypot(qt.x-Vt.x,qt.y-Vt.y),hn=Math.hypot(Bt.x-Vt.x,Bt.y-Vt.y);return Math.sqrt(Xt*hn)*Te/25e-6},Ie=Le=>{const lt=Ce,Ye=Ae;return{aabb:i.cr(this,z,0,0,0,Le,Ye,lt,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:lt,wrap:Le,fullyVisible:!1}},Re=[];let Be=[];const Ge=c,st=r.reparseOverscaled?p:c,it=(ie-this._centerAltitude)*J,mt=Le=>{if(!this._elevation||!Le.tileID||!E)return;const lt=this._elevation.getMinMaxForTile(Le.tileID),Ye=Le.aabb;lt?(Ye.min[2]=lt.min,Ye.max[2]=lt.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Le.shouldSplit=Je(Le),Le.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ue=(Le,lt)=>{if(.707*lt<Le)return 1;const Ye=lt/Le;return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)},Je=Le=>{if(Le.zoom<xe)return!0;if(Le.zoom===Ge)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const lt=Le.aabb.distanceX(oe),Ye=Le.aabb.distanceY(oe);let pt=it,It=1;if(G){pt=Le.aabb.distanceZ(oe);const hn=Math.pow(2,Le.zoom),yn=i.aY((Le.y+1)/hn),Ln=i.aY(Le.y/hn),Qn=Math.min(Math.max(R,yn),Ln),br=i.cO(Qn)/i.cO(R);if(It=Qn===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,br/this._mercatorScaleRatio),this.zoom<=i.cL&&Le.zoom===Ge-1&&br>=.9)return!0}else if(S&&(pt=Le.aabb.distanceZ(oe)*J),this.projection.isReprojectedInTileSpace&&p<=5){const hn=Math.pow(2,Le.zoom),yn=be(new i.ac((Le.x+.5)/hn,(Le.y+.5)/hn));It=yn>.85?1:yn}if(!E){const hn=Math.sqrt(lt*lt+Ye*Ye+pt*pt);let yn=(1<<Ge-Le.zoom)*ge*It;return yn*=Ue(Math.max(pt,it),hn),hn<yn}let ct=Number.MAX_VALUE,wt=0;const Vt=Le.aabb.getCorners(),qt=[];for(const hn of Vt){i.at(qt,hn,oe),G||(S?qt[2]*=J:qt[2]=it);const yn=i.bG(qt,this._camera.forward());yn<ct&&(ct=yn,wt=Math.abs(qt[2]))}let Bt=(1<<Ge-Le.zoom)*ge*It;if(Bt*=Ue(Math.max(wt,it),ct),ct<Bt)return!0;const Xt=Le.aabb.closestPoint(F);return Xt[0]===F[0]&&Xt[1]===F[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Re.push(Ie(-Le)),Re.push(Ie(Le));for(Re.push(Ie(0));Re.length>0;){const Le=Re.pop(),lt=Le.x,Ye=Le.y;let pt=Le.fullyVisible;const It=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!pt){let ct=ce?Le.aabb.intersects(q):Le.aabb.intersectsFlat(q);if(ct===0&&It()){const wt=new i.cp(Le.zoom,lt,Ye);ct=i.cq(this,z,wt,!0).intersects(q)}if(ct===0)continue;pt=ct===2}if(Le.zoom!==Ge&&Je(Le))for(let ct=0;ct<4;ct++){const wt=(lt<<1)+ct%2,Vt=(Ye<<1)+(ct>>1),qt={aabb:E?Le.aabb.quadrant(ct):i.cr(this,z,Le.zoom+1,wt,Vt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:wt,y:Vt,wrap:Le.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};S&&!G&&(qt.tileID=new i.aM(Le.zoom+1===Ge?st:Le.zoom+1,Le.wrap,Le.zoom+1,wt,Vt),mt(qt)),Re.push(qt)}else{const ct=Le.zoom===Ge?st:Le.zoom;if(r.minzoom&&r.minzoom>ct)continue;let wt=0;if(!pt){let Xt=ce?Le.aabb.intersectsPrecise(q):Le.aabb.intersectsPreciseFlat(q);if(Xt===0&&It()){const hn=new i.cp(Le.zoom,lt,Ye);Xt=i.cq(this,z,hn,!0).intersectsPrecise(q)}if(Xt===0)continue;if(r.calculateQuadrantVisibility)if(q.containsPoint(Le.aabb.center))wt=15;else for(let hn=0;hn<4;hn++)Le.aabb.quadrant(hn).intersects(q)!==0&&(wt|=1<<hn)}const Vt=F[0]-(.5+lt+(Le.wrap<<Le.zoom))*(1<<c-Le.zoom),qt=F[1]-.5-Ye,Bt=Le.tileID?Le.tileID:new i.aM(ct,Le.wrap,Le.zoom,lt,Ye);r.calculateQuadrantVisibility&&(Bt.visibleQuadrants=wt),Be.push({tileID:Bt,distanceSq:Vt*Vt+qt*qt})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,lt=this.horizonLineFromTop();Be=Be.filter(Ye=>{const pt=[0,0,0,1],It=[i.aj,i.aj,0,1],ct=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());i.aA(pt,pt,ct),i.aA(It,It,ct);const wt=i.cs([],pt,It),Vt=i.ct([],pt,It),qt=i.cM(wt,Vt);if(qt===0)return!0;let Bt=!1;const Xt=this._elevation;if(Xt&&qt>Le&&lt!==0){const hn=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let yn;r.isTerrainDEM||(yn=Xt.getMinMaxForTile(Ye.tileID)),yn||(yn={min:Ae,max:Ce});const Ln=i.cu(this.rotation),Qn=[Ln[0]*i.aj,Ln[1]*i.aj,yn.max];i.ad(Qn,Qn,hn),Bt=(1-Qn[1])*this.height*.5<lt}return qt<Le||Bt})}return Be.sort((Le,lt)=>Le.distanceSq-lt.distanceSq).map(Le=>Le.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=i.ay(r.lat,-85.051129,i.cv),p=this.projection.project(r.lng,c);return new i.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let p,x;const S=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;p=(c.x-S.x)/M,x=(c.y-S.y)/M}else{const M=this.pointCoordinate(c),R=this.pointCoordinate(S);p=M.x-R.x,x=M.y-R.y}const E=this.locationCoordinate(r);this.setLocation(new i.ac(E.x-p,E.y-x))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,c){return this.projection.locationPoint(this,r,c)}locationPoint3D(r,c){return this.projection.locationPoint(this,r,c,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,c){return this.coordinateLocation(this.pointCoordinate3D(r,c))}locationCoordinate(r,c){const p=c?i.c6(c,r.lat):void 0,x=this.projection.project(r.lng,r.lat);return new i.ac(x.x,x.y,p)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const p=c??this._centerAltitude,x=[r.x,r.y,0,1],S=[r.x,r.y,1,1];i.aA(x,x,this.pixelMatrixInverse),i.aA(S,S,this.pixelMatrixInverse);const E=S[3];i.cw(x,x,1/x[3]),i.cw(S,S,1/E);const M=x[2],R=S[2];return{p0:x,p1:S,t:M===R?0:(p-M)/(R-M)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return i.aA(c,c,this.pixelMatrixInverse),i.aA(p,p,this.pixelMatrixInverse),i.cw(c,c,1/c[3]),i.cw(p,p,1/p[3]),c[2]=i.c6(c[2],this._center.lat)*this.worldSize,p[2]=i.c6(p[2],this._center.lat)*this.worldSize,i.cw(c,c,1/this.worldSize),i.cw(p,p,1/this.worldSize),new i.av([c[0],c[1],c[2]],i.au([],i.at([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:x}=r,S=i.c6(c[2],this._center.lat),E=i.c6(p[2],this._center.lat);return new i.ac(i.ai(c[0],p[0],x)/this.worldSize,i.ai(c[1],p[1],x)/this.worldSize,i.ai(S,E,x))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r,c){if(!this.elevation)return this.pointCoordinate(r,c);let p=this.projection.pointCoordinate3D(this,r.x,r.y);if(p)return new i.ac(p[0],p[1],p[2]);let x=0,S=this.horizonLineFromTop();if(r.y>S)return this.pointCoordinate(r,c);const E=.02*S,M=r.clone();for(let R=0;R<10&&S-x>E;R++){M.y=i.ai(x,S,.66);const z=this.projection.pointCoordinate3D(this,M.x,M.y);z?(S=M.y,p=z):x=M.y}return p?new i.ac(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=i.cx)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return i.aA(x,x,this.pixelMatrix),x[3]>0?new i.P(x[0]/x[3],x[1]/x[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new i.P(c,r)),E=this.pointLocation3D(new i.P(x,r)),M=this.pointLocation3D(new i.P(x,p)),R=this.pointLocation3D(new i.P(c,p));let z=Math.min(S.lng,E.lng,M.lng,R.lng),F=Math.max(S.lng,E.lng,M.lng,R.lng),G=Math.min(S.lat,E.lat,M.lat,R.lat),$=Math.max(S.lat,E.lat,M.lat,R.lat);const q=Math.pow(2,-this.zoom)/16*270,ne=this.projection.name==="globe"?1:4,J=(ie,oe,ce,ge,xe)=>{const Ce=(ie+ce)/2,Ae=(oe+ge)/2,Te=new i.P(Ce,Ae),{lng:be,lat:Ie}=this.pointLocation3D(Te),Re=Math.max(0,z-be,G-Ie,be-F,Ie-$);z=Math.min(z,be),F=Math.max(F,be),G=Math.min(G,Ie),$=Math.max($,Ie),(xe<ne||Re>q)&&(J(ie,oe,Ce,Ae,xe+1),J(Ce,Ae,ce,ge,xe+1))};if(J(c,r,x,r,1),J(x,r,x,p,1),J(x,p,c,p,1),J(c,p,c,r,1),this.projection.name==="globe"){const[ie,oe]=i.cy(this);ie?($=90,F=180,z=-180):oe&&(G=-90,F=180,z=-180)}return new i.aG(new i.cd(z,G),new i.cd(F,$))}_getBoundsRectangular(r,c){const{top:p,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,M=new i.P(x,p),R=new i.P(E,p),z=new i.P(E,S),F=new i.P(x,S);let G=this.pointCoordinate(M,r),$=this.pointCoordinate(R,r);const q=this.pointCoordinate(z,c),ne=this.pointCoordinate(F,c),J=(ie,oe)=>(oe.y-ie.y)/(oe.x-ie.x);return G.y>1&&$.y>=0?G=new i.ac((1-ne.y)/J(ne,G)+ne.x,1):G.y<0&&$.y<=1&&(G=new i.ac(-ne.y/J(ne,G)+ne.x,0)),$.y>1&&G.y>=0?$=new i.ac((1-q.y)/J(q,$)+q.x,1):$.y<0&&G.y<=1&&($=new i.ac(-q.y/J(q,$)+q.x,0)),new i.aG().extend(this.coordinateLocation(G)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((p,x)=>{if(x.dem){const S=x.dem.tree;p.min=Math.min(p.min,S.minimums[0]),p.max=Math.max(p.max,S.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-85.051129,this.maxLat=i.cv,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aD(this.minLng)*this.tileSize,this.worldMaxX=i.aD(this.maxLng)*this.tileSize,this.worldMinY=i.aH(this.maxLat)*this.tileSize,this.worldMaxY=i.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=r.canonical,S=1/this.height,E=this.cameraWorldSize,M=E/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*r.wrap)*M,z=x.y*M,F=this.point;F.x*=E/this.worldSize,F.y*=E/this.worldSize;const G=this.angle,$=Math.sin(-G),q=-Math.cos(-G);return p[c]={bearing:[$,q],center:[(F.x-R)*S,(F.y-z)*S],scale:M/i.aj*S},p[c]}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return i.az(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(r,c=!1,p=!1){const x=r.key;let S;if(S=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,S[x])return S[x];const E=this.calculatePosMatrix(r,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,i.az(E,M,E),S[x]=new Float32Array(E),S[x]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=i.cz(r,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,c=i.bn([],[r,r,r]);return i.az(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const c=i.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),S=i.c6(1,this._center.lat);p[2]/=S,x[2]/=S,i.au(x,x);const E=r.raycast(p,x,r.exaggeration());if(E){const M=i.bE([],p,x,E),R=new i.ac(M[0],M[1],i.c6(M[2],i.aY(M[1]))),z=(R.z+i.ae([R.x-p[0],R.y-p[1],R.z-p[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,p=i.c6(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),S=c.getAtPointOrZero(new i.ac(...x)),E=this.pixelsPerMeter/this.worldSize*S,M=this._minimumHeightOverTerrain(),R=x[2]-E;if(R<=M)if(R<0||r){const z=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],z.z-x[2]],G=i.ae(F);F[2]-=(M-R)/this._pixelsPerMercatorPixel;const $=i.ae(F);if($===0)return;i.bY(F,F,G/$*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const $=this.center;return $.lat=i.ay($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&($.lng=i.ay($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let S=0,E=p,M=x;const R=this.width/2,z=this.height/2,F=this.worldMinY*this.scale,G=this.worldMaxY*this.scale;if(x-z<F&&(M=F+z),x+z>G&&(M=G-z),G-F<this.height&&(S=Math.max(S,this.height/(G-F)),M=(G+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,ne=this.worldSize/2-($+q)/2;E=(p+ne+this.worldSize)%this.worldSize-ne,E-R<$&&(E=$+R),E+R>q&&(E=q-R),q-$<this.width&&(S=Math.max(S,this.width/(q-$)),E=(q+$)/2)}E===p&&M===x||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(E,M))),S&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.c6(1,this.center.lat)/i.c6(1,i.cP));const x=i.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?p:1,E=this._camera.getWorldToCamera(this.worldSize,S);let M;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-r.x/this.width,R[9]=2*r.y/this.height,this.isOrthographic){let Ie=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ie*this.aspect,Be=-Re,Ge=-Ie;Re-=r.x,Be-=r.x,Ie+=r.y,Ge+=r.y,M=this._camera.getCameraToClipOrthographic(Be,Re,Ge,Ie,this._nearZ,this._farZ),((st,it,mt,Ue)=>{for(let Je=0;Je<16;Je++)st[Je]=i.ai(it[Je],mt[Je],Ue)})(M,M,R,i.cN(this.pitch>=Ms?1:this.pitch/Ms))}else M=R;const z=i.cB([],R,E);let F=i.cB([],M,E);if(this.projection.isReprojectedInTileSpace){const Ie=this.locationCoordinate(this.center),Re=i.bx([]);i.bo(Re,Re,[Ie.x*this.worldSize,Ie.y*this.worldSize,0]),i.az(Re,Re,i.cC(this)),i.bo(Re,Re,[-Ie.x*this.worldSize,-Ie.y*this.worldSize,0]),i.az(F,F,Re),i.az(z,z,Re),this.inverseAdjustmentMatrix=i.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cE([],F,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=F,this.invProjMatrix=i.bi(new Float64Array(16),this.projMatrix),c){const Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ie[8]=2*-r.x/this.width,Ie[9]=2*r.y/this.height,this.expandedFarZProjMatrix=i.cB([],Ie,E)}else this.expandedFarZProjMatrix=this.projMatrix;const G=i.bi([],M);this.frustumCorners=i.cF.fromInvProjectionMatrix(G,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const $=new Float32Array(16);i.bx($),i.cE($,$,[1,-1,1]),i.cG($,$,this._pitch),i.by($,$,this.angle);const q=i.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.bw(q);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-r.x/this.width,q[9]=2*(r.y+ne)/this.height,this.skyboxMatrix=i.az($,q,$);const J=this.point,ie=J.x,oe=J.y,ce=this.width%2/2,ge=this.height%2/2,xe=Math.cos(this.angle),Ce=Math.sin(this.angle),Ae=ie-Math.round(ie)+xe*ce+Ce*ge,Te=oe-Math.round(oe)+xe*ge+Ce*ce,be=new Float64Array(F);if(i.bo(be,be,[Ae>.5?Ae-1:Ae,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=be,F=i.bz(),i.cE(F,F,[this.width/2,-this.height/2,1]),i.bo(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=i.bz(),i.cE(F,F,[1,-1,1]),i.bo(F,F,[-1,-1,0]),i.cE(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=i.az(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},F=i.bi(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cH(this);const Ie=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad(Ie,Ie,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[r,r,c];i.bY(S,S,x),i.bY(p,p,-1),i.cI(p,p,S);const E=i.bz();i.bo(E,E,p),i.cE(E,E,S),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,x)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*S,x.y/this.worldSize-p[1]*S,r/this.worldSize*this._centerAltitude-p[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=r[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((c-p)/x,1)),this._camera.position=i.bE([],this._camera.position,r,S),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),S=i.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.al(this._maxPitch)),M=Math.max((r[2]-S)/Math.cos(p),E),R=this._zoomFromMercatorZ(M);i.bE(r,r,c,M),this._pitch=i.ay(p,i.al(this.minPitch),i.al(this.maxPitch)),this.angle=i.bX(x,-Math.PI,Math.PI),this._setZoom(i.ay(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,p=i.cx,x=0,S=1/0;for(;p-c>1e-6&&p>c;){const E=c+.5*(p-c),M=this.tileSize*Math.pow(2,E),R=this.getCameraToCenterDistance(this.projection,E,M),z=this.scaleZoom(R/(Math.max(0,r)*this.tileSize)),F=Math.abs(E-z);F<S&&(S=F,x=E),E<z?c=E:p=E}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const p=Math.min(r.x,c.x),x=Math.max(r.x,c.x),S=Math.min(r.y,c.y),E=Math.max(r.y,c.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new i.P(p,S),new i.P(x,E),new i.P(p,E),new i.P(x,S)],R=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const F of M){const G=this.pointRayIntersection(F);if(G.t<0)return!0;const $=this.rayIntersectionCoordinate(G);if($.x<R||$.y<0||$.x>z||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(r,c){const p=i.ae(i.at([],this._camera.position,r)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([c,p,x],S){const E=[c,p,x,1];i.aA(E,E,S);const M=E[3]=Math.max(E[3],1e-6);return E[0]/=M,E[1]/=M,E[2]/=M,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,r))}}getCameraToCenterDistance(r,c=this.zoom,p=this.worldSize){const x=i.cA(r,c,this.width,this.height,1024),S=r.pixelSpaceConversion(this.center.lat,p,x);let E=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(E=i.ai(1,E,i.cN(this.pitch>=Ms?1:this.pitch/Ms))),E}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.az(r,r,this.globeMatrix),r}getFrustum(r){return i.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const sa=(f,r)=>{if(r>0&&f.terrain&&i.w("Cutoff is currently disabled on terrain"),r<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=f.transform,p=Math.max(Math.abs(c._zoom-(f.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?i.af(60,45,c.pitch):i.af(30,15,c.pitch),S=c._farZ-c._nearZ,E=r*c.height,M=((1-(R=x))*c.cameraToCenterDistance+R*(c._farZ+E))*p;var R;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(M-c._nearZ)/S,(M-E-c._nearZ)/S]}}},ks={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Pd{constructor(r,c){this.aabb=r,this.lastCascade=c}}class Ff{add(r,c){const p=this.receivers[r.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[r.key]=new Pd(c,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,c,p){const x=i.cW.fromPoints(r.points);let S=0;for(const E in this.receivers){const M=this.receivers[E];if(!M||!x.intersectsAabb(M.aabb))continue;M.aabb.min=x.closestPoint(M.aabb.min),M.aabb.max=x.closestPoint(M.aabb.max);const R=M.aabb.getCorners();for(let z=0;z<p.length;z++){let F=!0;for(const G of R){const $=[G[0]*c,G[1]*c,G[2]];if(i.ad($,$,p[z].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){F=!1;break}}if(M.lastCascade=z,S=Math.max(S,z),F)break}}return S+1}}class qy{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Ff,this._depthMode=new Kt(r.context.gl.LEQUAL,Kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(ks,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(ks,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(ks,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce((ne,J)=>{const ie=p.style._mergedLayers[J];return ne+(ie.hasShadowPass()&&!ie.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const S=p.context,E=ks.shadowMapResolution,M=ks.shadowMapResolution;if(this._cascades.length===0||ks.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<ks.cascadeCount;++ne){const J=p._shadowMapDebug,ie=S.gl,oe=S.createFramebuffer(E,M,J,"texture"),ce=new i.T(S,{width:E,height:M,data:null},ie.DEPTH_COMPONENT16);if(oe.depthAttachment.set(ce.texture),J){const ge=new i.T(S,{width:E,height:M,data:null},ie.RGBA8);oe.colorAttachment.set(ge.texture)}this._cascades.push({framebuffer:oe,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cn,scale:0})}}this.shadowDirection=Uc(c);let R=0;if(r.elevation){const ne=r.elevation,J=[1e4,-1e4];ne.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const oe=ie.dem.tree;J[0]=Math.min(J[0],oe.minimums[0]),J[1]=Math.max(J[1],oe.maximums[0])}),J[0]!==1e4&&(R=(J[1]-J[0])*ne.exaggeration())}const z=1.5*r.cameraToCenterDistance,F=3*z,G=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const J=this._cascades[ne];let ie=r.height/50,oe=1;ks.cascadeCount===1?oe=F:ne===0?oe=z:(ie=z,oe=F);const[ce,ge]=ku(r,this.shadowDirection,ie,oe,ks.shadowMapResolution,R);J.scale=r.scale,J.matrix=ce,J.boundingSphereRadius=ge,i.bi(G,J.matrix),J.frustum=i.cn.fromInvProjectionMatrix(G,1,0,!0),J.far=oe}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ks.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ks.shadowMapResolution,this._uniformValues.u_shadowmap_0=Io.ShadowMap0,this._uniformValues.u_shadowmap_1=Io.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=p.transform.elevation;for(const ne of this._groundShadowTiles){let J={min:0,max:0};if(q){const ie=q.getMinMaxForTile(ne);ie&&(J=ie)}this.addShadowReceiver(ne.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,ks.shadowMapResolution,ks.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){p.currentShadowCascade=S,x.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),x.clear({color:i.am.white,depth:1});for(const E of r.order){const M=r._mergedLayers[E];if(!M.hasShadowPass()||M.isHidden(p.transform.zoom))continue;const R=r.getLayerSourceCache(M),z=R?c[R.id]:void 0;(M.type==="model"||z&&z.length)&&p.renderLayer(p,R,M,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,c=r.style,p=r.context,x=p.gl,S=c.directionalLight,E=c.ambientLight;if(!S||!E)return;const M=[],R=sa(r,r.longestCutoffRange);R.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const z=ac(c,S,E),F=new Kt(x.LEQUAL,Kt.ReadOnly,r.depthRangeFor3D),G=new Dn({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const $ of this._groundShadowTiles){const q=$.toUnwrapped(),ne=r.isTileAffectedByFog($),J=r.getOrCreateProgram("groundShadow",{defines:M,overrideFog:ne});this.setupShadows(q,J),r.uploadCommonUniforms(p,J,q,null,R);const ie={u_matrix:r.transform.calculateProjMatrix(q),u_ground_shadow_factor:z};J.draw(r,x.TRIANGLES,F,G,ar.multiply,In.disabled,ie,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ar.unblended:ar.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const c=this.painter.transform,p=c.calculatePosMatrix(r,c.worldSize);return i.az(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(r){return i.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,c,p,x=0){if(!this.enabled)return;const S=this.painter.transform,E=this.painter.context,M=E.gl,R=this._uniformValues,z=new Float64Array(16),F=S.calculatePosMatrix(r,S.worldSize);for(let G=0;G<this._cascades.length;G++)i.az(z,this._cascades[G].matrix,F),R[G===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),E.activeTexture.set(M.TEXTURE0+Io.ShadowMap0+G),this._cascades[G].texture.bindExtraParam(M.LINEAR,M.LINEAR,M.CLAMP_TO_EDGE,M.CLAMP_TO_EDGE,M.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const G=i.cU(r.canonical),$=2/S.tileSize*i.aj/ks.shadowMapResolution,q=$*this._cascades[0].boundingSphereRadius,ne=$*this._cascades[this._cascades.length-1].boundingSphereRadius,J=(p==="vector-tile"?1:3)/Math.pow(2,x-r.canonical.z-(1-S.zoom+Math.floor(S.zoom)));R.u_shadow_normal_offset=[G,q*J,ne*J],R.u_shadow_bias=[6e-5,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(E,R)}setupShadowsFromMatrix(r,c,p=!1){if(!this.enabled)return;const x=this.painter.context,S=x.gl,E=this._uniformValues,M=new Float64Array(16);for(let R=0;R<ks.cascadeCount;R++)i.az(M,this._cascades[R].matrix,r),E[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),x.activeTexture.set(S.TEXTURE0+Io.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=p,p){const R=ks.normalOffset;E.u_shadow_normal_offset=[1,R,R],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,c,p,x){if(x[2]>=0)return{};const S=function(R,z,F){const G=F/(1<<R.canonical.z);return new i.cW([R.canonical.x*G+R.wrap*F,R.canonical.y*G+R.wrap*F,0],[(R.canonical.x+1)*G+R.wrap*F,(R.canonical.y+1)*G+R.wrap*F,z])}(r,c,p).getCorners(),E=c/-x[2];x[0]<0?(i.cV(S[0],S[0],[x[0]*E,0,0]),i.cV(S[3],S[3],[x[0]*E,0,0])):x[0]>0&&(i.cV(S[1],S[1],[x[0]*E,0,0]),i.cV(S[2],S[2],[x[0]*E,0,0])),x[1]<0?(i.cV(S[0],S[0],[0,x[1]*E,0]),i.cV(S[1],S[1],[0,x[1]*E,0])):x[1]>0&&(i.cV(S[2],S[2],[0,x[1]*E,0]),i.cV(S[3],S[3],[0,x[1]*E,0]));const M={};return M.vertices=S,M.planes=[oc(S[1],S[0],S[4]),oc(S[2],S[1],S[5]),oc(S[3],S[2],S[6]),oc(S[0],S[3],S[7])],M}addShadowReceiver(r,c,p){this._receivers.add(r,i.cW.fromTileIdAndHeight(r,c,p))}getMaxCascadeForTile(r){const c=this._receivers.get(r);return c&&c.lastCascade?c.lastCascade:0}}function oc(f,r,c){const p=i.at([],c,r),x=i.at([],f,r),S=i.bF([],p,x),E=i.ae(S);return E===0?[0,0,1,0]:(i.bY(S,S,1/E),[S[0],S[1],S[2],-i.bG(S,r)])}function Uc(f){const r=f.properties.get("direction"),c=i.cR(r.x,r.y,r.z);c[2]=i.ay(c[2],0,75);const p=i.cT([c[0],c[1],c[2]]);return i.cS(p.x,p.y,p.z)}function ac(f,r,c){const p=r.properties.get("color-use-theme")==="none",x=r.properties.get("color"),S=r.properties.get("intensity"),E=r.properties.get("direction"),M=[E.x,E.y,E.z],R=c.properties.get("color-use-theme")==="none",z=c.properties.get("color"),F=c.properties.get("intensity"),G=Math.max(i.bG([0,0,1],M),0),$=[0,0,0];i.bY($,z.toPremultipliedRenderColor(R?null:f.getLut(r.scope)).toArray01Linear().slice(0,3),F);const q=[0,0,0];return i.bY(q,x.toPremultipliedRenderColor(p?null:f.getLut(c.scope)).toArray01Linear().slice(0,3),G*S),i.cY([$[0]>0?$[0]/($[0]+q[0]):0,$[1]>0?$[1]/($[1]+q[1]):0,$[2]>0?$[2]/($[2]+q[2]):0])}function ku(f,r,c,p,x,S){const E=f.zoom,M=f.scale,R=f.worldSize,z=1/R,F=f.aspect,G=Math.sqrt(1+F*F)*Math.tan(.5*f.fovX),$=G*G,q=p-c,ne=p+c;let J,ie;$>q/ne?(J=p,ie=p*G):(J=.5*ne*(1+$),ie=.5*Math.sqrt(q*q+2*(p*p+c*c)*$+ne*ne*$*$));const oe=f.projection.pixelsPerMeter(f.center.lat,R),ce=f._camera.getCameraToWorldMercator(),ge=[0,0,-J*z];i.ad(ge,ge,ce);let xe=ie*z;const Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const pt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?oe:1),It=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,c,p);It[8]=2*-f.centerOffset.x/f.width,It[9]=2*f.centerOffset.y/f.height;const ct=new Float64Array(16);i.cB(ct,It,pt);const wt=new Float64Array(16);i.bi(wt,ct);const Vt=i.cn.fromInvProjectionMatrix(wt,R,E,!0);for(const qt of Vt.points){const Bt=((Ae=qt)[0]/=M,Ae[1]/=M,Ae[2]=i.c6(Ae[2],f._center.lat),Ae);xe=Math.max(xe,i.bZ(i.cX([],ge,Bt)))}}var Ae;xe*=x/(x-1);const Te=Math.acos(r[2]),be=Math.atan2(-r[0],-r[1]),Ie=new Ya;Ie.position=ge,Ie.setPitchBearing(Te,be);const Re=Ie.getWorldToCamera(R,oe),Be=xe*R,Ge=Math.min(f._mercatorZfromZoom(17)*R*-2,-2*Be),st=Ie.getCameraToClipOrthographic(-Be,Be,-Be,Be,Ge,(Be+S*oe)/r[2]),it=new Float64Array(16);i.az(it,st,Re);const mt=i.cS(Math.floor(1e6*ge[0])/1e6*R,Math.floor(1e6*ge[1])/1e6*R,0),Ue=.5*x,Je=[0,0,0];i.ad(Je,mt,it),i.bY(Je,Je,Ue);const Le=[Math.floor(Je[0]),Math.floor(Je[1]),Math.floor(Je[2])],lt=[0,0,0];i.at(lt,Je,Le),i.bY(lt,lt,-1/Ue);const Ye=new Float64Array(16);return i.bx(Ye),i.bo(Ye,Ye,lt),i.az(it,Ye,it),[it,Be]}class gm extends i.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,c){return i.aS(this.requestManager.transformRequest(c,i.R.Model).url).then(p=>{if(!p)return;const x=i.aT(p),S=new i.aU(r,void 0,void 0,x);return S.computeBoundsAndApplyParent(),S}).catch(p=>{if(p&&p.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${r} from ${c}: ${p.message}`)))})}load(r,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(r),S=[],E=[];for(const M of x){const R=r[M];this.hasURLBeenRequested(R)&&!p.forceReload||(this.modelByURL[R]={modelId:M,scope:c},S.push(this.loadModel(M,R)),E.push(M)),this.models[c][M]||(this.models[c][M]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+E.length,Promise.allSettled(S).then(M=>{for(let R=0;R<M.length;R++){const{status:z}=M[R];if(z==="rejected")continue;const{value:F}=M[R];this.models[c][E[R]]||(this.models[c][E[R]]={model:null,numReferences:1}),this.models[c][E[R]].model=F}this.numModelsLoading[c]-=E.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(M=>{this.fire(new i.z(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(r,c):this.getModelByURL(this.modelUris[c][r]))}getModel(r,c){return this.models[c]||(this.models[c]={}),this.models[c][r]?this.models[c][r].model:void 0}getModelByURL(r){if(!r)return null;const c=this.modelByURL[r];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(r,c){return this.models[c]&&this.models[c][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(r,p,{exactIdMatch:!0})||this.hasModelBeenAdded(r,p))&&this.modelUris[p][r]===x)this.models[p][r].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:S,modelId:E}=this.modelByURL[x];this.models[S][E].numReferences++}else this.modelUris[p][r]=x,this.load({[r]:this.modelUris[p][r]},p)}addModelURLs(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in r)p[x]=this.requestManager.normalizeModelURL(r[x])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of r)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&i.cZ(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,c,p=!1){if(this.models[c]&&this.models[c][r]&&(this.models[c][r].numReferences--,this.models[c][r].numReferences===0)){const x=this.modelUris[c][r];p||delete this.modelUris[c][r],delete this.modelByURL[x];const S=this.models[c][r].model;if(!S)return;delete this.models[c][r],S.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const c of Object.keys(this.models[r])){const p=this.models[r][c].model;delete this.models[r][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(r.context)}}const Rd=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),ym={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function lc(f){return f=f||{},Object.assign(f,ym)}class Wy extends i.E{constructor(r){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},i.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=r,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=r.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=r.stylesheet.indoor.buildingFeaturesetId,this._scope=r.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:r=>(r.feature&&r.feature.properties.floorplan&&this.selectFloorplan(r.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const r=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone"))};if(this._map.transform.zoom<13)return void r();const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=this._map.transform.width,x=this._map.transform.height,S=p*(2/3),E=x*(2/3),M=.5*(p-S),R=.5*(x-E),z=[new i.P(M,R),new i.P(M+S,R+E)],F=this._map.queryRenderedFeatures(z,c);F.length>0?this._selectedFloorplan&&F[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=F[0],this._floorplanSelected()):r()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const r=this._floorplanStates[this._indoorData.id].selectedBuilding,c=r?this._indoorData.buildings.find(M=>M.id===r):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,p=this._floorplanStates[this._indoorData.id].selectedLevel,x=this._indoorData.levels.find(M=>M.id===p),S=this._indoorData.levels.find(M=>!(!c||!c.levels)&&Number(M.levelOrder)===0&&c.levels.includes(M.id)),E=x?x.id:S?S.id:void 0;this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:E})),c&&this._buildingSelected(c,!1),E&&this._levelSelected(E)}_buildingSelected(r,c){if(!r||!r.id)return void console.warn("IndoorManager: Building or building id is undefined");c&&r.extent&&this._map.fitBounds(r.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=r?r.id:void 0;const p=this._indoorData.levels.filter(x=>r.levels.includes(x.id));this.fire(new i.A("buildingselected",{buildingId:r.id,levels:p}))}_levelSelected(r){const c=this._indoorData.levels.find(p=>p.id===r);c?(this._updateLevels(c,!0),this.fire(new i.A("levelselected",{levelId:c.id}))):console.warn(`IndoorManager: Level with ID ${r} not found in the current floorplan.`)}_updateLevels(r,c){if(!r||!r.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function p(z){const F=z.indexOf("/floor/");if(F===-1)return z;const G=F+7,$=z.indexOf("/",G);return $===-1?z.slice(G):z.slice(G,$)}this._floorplanStates[this._indoorData.id].selectedLevel=r.id;const x=[],S={},E={},M={},R={};for(const z of this._indoorData.levels){if(x.push(z.id),S[z.id]=z.levelOrder>=0?3*Math.abs(z.levelOrder+1):3*Math.abs(z.levelOrder),E[z.id]=z.levelOrder>=0?3*z.levelOrder:0,this.mergeFloors){const F=p(r.id),G=p(z.id);M[z.id]=G===F?"true":"false"}else M[z.id]=z.id===r.id?"true":"false";R[z.id]=z.levelOrder<r.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",E]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",R]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",r.levelOrder<0)}selectFloorplan(r){const c={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},p=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],x=this._map.queryRenderedFeatures(p,c);if(x.length>0){for(const S of x)if(JSON.parse(S.properties["indoor-data"]).id===r){this._selectedFloorplan=S,this._floorplanSelected();break}}}selectBuilding(r){const c=this._indoorData.buildings.find(p=>p.id===r);this._buildingSelected(c,!0)}selectLevel(r){this._levelSelected(r)}}function Zy(f){if(!f.metadata||!f.metadata.content_area)return;const r=i.q.devicePixelRatio,{left:c,top:p,width:x,height:S}=f.metadata.content_area,E=c*r,M=p*r;return[E,M,E+x*r,M+S*r]}function Mg(f){if(f)return f.map(([r,c])=>[r*i.q.devicePixelRatio,c*i.q.devicePixelRatio])}class Ja{constructor(r,c,p){this.id=r,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return r;const p=this.sourceCache.getSource();if(!(p instanceof kc))return r;const x=c.map(E=>this.sourceCache.getTile(E)),S=p.getImages(x,Array.from(this.pendingRequests));for(const[E,M]of S)r.set(i.I.from({name:E,iconsetId:this.id}),M),this.pendingRequests.delete(E);for(const E of this.pendingRequests)this.missingRequests.add(E);return this.pendingRequests.clear(),r}}const ul=(f,r)=>Ee(f,r&&r.filter(c=>c.identifier!=="source.canvas")),Bf=i.aF(Ar,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),_m=i.aF(Ar,["setCenter","setZoom","setBearing","setPitch"]),Nd=new Set(["background","sky","slot","custom"]),Vf={version:8,layers:[],sources:{}},Dd={duration:300,delay:0};class xo extends i.E{constructor(r,c={}){super(),this.map=r,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=i.h({},Dd),this._buildingIndex=new xh(this),this.crossTileSymbolIndex=new Uo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Or,this.dispatcher=c.dispatcher?c.dispatcher:new i.D(i.c$(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new $s(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new i.d0(r._requestManager,c.localFontFamily?i.d1.all:c.localIdeographFontFamily?i.d1.ideographs:i.d1.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new gm(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",i.d2());const p=this;this._rtlTextPluginCallback=xo.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,E)=>{if(i.d3(S),E&&E.every(M=>M))for(const M in p._sourceCaches){const R=p._sourceCaches[M],z=R.getSource().type;z!=="vector"&&z!=="geojson"||R.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.getOwnSource(x.sourceId);if(S&&S.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===S.id&&this._validateLayer(M)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(i.j(r))return r;const c=i.d4(r);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${i.d5(JSON.stringify(r))}`}_diffStyle(r,c,p){this.globalId=this._getGlobalId(r);const x=(S,E)=>{try{E(null,this.setState(S,p))}catch(M){E(M,!1)}};if(typeof r=="string"){const S=this.map._requestManager.normalizeStyleURL(r),E=this.map._requestManager.transformRequest(S,i.R.Style);i.n(E,(M,R)=>{M?this.fire(new i.z(M)):R&&x(R,c)})}else typeof r=="object"&&x(r,c)}loadURL(r,c={}){this.fire(new i.A("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!i.j(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,c.accessToken),this.resolvedImports.add(r);const x=this.importsCache.get(r);if(x)return this._load(x,p);const S=this.map._requestManager.transformRequest(r,i.R.Style);this._request=i.n(S,(E,M)=>{if(this._request=null,E)this.fire(new i.z(E));else if(M)return this.importsCache.set(r,M),this._load(M,p)})}loadJSON(r,c={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=i.q.frame(()=>{this._request=null,this._load(r,c.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Vf,!1)}_loadImports(r,c,p){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const S of r){const E=this._createFragmentStyle(S),M=new Promise(F=>{E.once("style.import.load",F),E.once("error",F)}).then(()=>this.mergeAll());if(x.push(M),this.resolvedImports.has(S.url)){E.loadEmpty();continue}const R=S.data||this.importsCache.get(S.url);R?(E.loadJSON(R,{validate:c}),this._isInternalStyle(R)&&(E.globalId=null)):S.url?E.loadURL(S.url,{validate:c}):E.loadEmpty();const z={style:E,id:S.id,config:S.config};if(p){const F=this.fragments.findIndex(({id:G})=>G===p);this.fragments=this.fragments.slice(0,F).concat(z).concat(this.fragments.slice(F))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(r=this,c=new Set){for(const p of r.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(r){const c=this.scope?i.C(r.id,this.scope):r.id;let p;const x=this._initialConfig&&this._initialConfig[c];(r.config||x)&&(p=i.h({},r.config,x));const S=new xo(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,c){const p=r.indoor?lc(r.schema):r.schema;if(this._isInternalStyle(r)){const E=i.h({},Vf,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(E,c)}if(this.updateConfig(this._config,p),c&&ul(this,Vi(r)))return;this._loaded=!0,this.stylesheet=i.d6(r);const x=()=>{for(const z in r.sources)this.addSource(z,r.sources[z],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const z in r.iconsets)this.addIconset(z,r.iconsets[z]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(r.glyphs);const E=Xa(this.stylesheet.layers);if(this._order=E.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new We(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={};for(const z of E){const F=i.db(z,this.scope,this._styleColorTheme.lut,this.options);F.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const G=this.getOwnLayerSourceCache(F),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();G&&F.canCastShadows()&&$&&(G.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const R=this.isRootStyle();r.imports?this._loadImports(r.imports,c).then(()=>{this._reloadImports(),this.fire(new i.A(R?"style.load":"style.import.load"))}).catch(z=>{this.fire(new i.z(new Error("Failed to load imports",z))),this.fire(new i.A(R?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(R?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const S=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(S){const E=this._evaluateColorThemeData(S);this._loadColorTheme(E).then(()=>{x()}).catch(M=>{i.w(`Couldn't load color theme from the stylesheet: ${M}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,c,p,x,S,E,M,R,z,F;const G={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{if($.stylesheet){if($.light!=null&&(r=$.light),$.stylesheet.lights)for(const q of $.stylesheet.lights)q.type==="ambient"&&$.ambientLight!=null&&(c=$.ambientLight),q.type==="directional"&&$.directionalLight!=null&&(p=$.directionalLight);x=this._prioritizeTerrain(x,$.terrain,$.stylesheet.terrain),$.stylesheet.fog&&$.fog!=null&&(S=$.fog),$.stylesheet.snow&&$.snow!=null&&(E=$.snow),$.stylesheet.rain&&$.rain!=null&&(M=$.rain),$.stylesheet.camera!=null&&(F=$.stylesheet.camera),$.stylesheet.projection!=null&&(R=$.stylesheet.projection),$.stylesheet.transition!=null&&(z=$.stylesheet.transition),G[$.scope]=$._styleColorTheme}}),this.light=r,this.ambientLight=c,this.directionalLight=p,this.fog=S,this.snow=E,this.rain=M,this._styleColorThemeForScope=G,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=i.h({},Dd,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const c=p=>{for(const x of p.fragments)c(x.style);r(p)};c(this)}_prioritizeTerrain(r,c,p){const x=r&&r.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?r:null:c!=null&&(!r||x||c&&c.drapeRenderMode===1)?c:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{r=this._prioritizeTerrain(r,c.terrain,c.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(r=c.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},c={},p={};this.forEachFragmentStyle(x=>{for(const S in x._sourceCaches){const E=i.C(S,x.scope);r[E]=x._sourceCaches[S]}for(const S in x._otherSourceCaches){const E=i.C(S,x.scope);c[E]=x._otherSourceCaches[S]}for(const S in x._symbolSourceCaches){const E=i.C(S,x.scope);p[E]=x._symbolSourceCaches[S]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeLayers(){const r={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const E of S._order){const M=S._layers[E];if(M.type==="slot"){const R=i.d7(E);if(r[R])continue;r[R]=[]}M.slot&&r[M.slot]?r[M.slot].push(M):c.push(M)}}),this._mergedOrder=[];const x=(S=[])=>{for(const E of S)if(E.type==="slot"){const M=i.d7(E.id);r[M]&&x(r[M]),this._mergedSlots.push(M)}else{const M=i.C(E.id,E.scope);this._mergedOrder.push(M),p[M]=E,E.is3D(!!this.terrain)&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};x(c),this._mergedOrder.sort((S,E)=>{const M=p[S],R=p[E];return M.hasInitialOcclusionOpacityProperties?R.is3D(!!this.terrain)?1:0:M.is3D(!!this.terrain)&&R.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=i.h({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(c,p,x,S){const E=i.h({},p);for(const R of Object.keys(i.a5.colorTheme))E[R]===void 0&&(E[R]=i.a5.colorTheme[R].default);const M=new i.a6(Rd,c,new Map(x));return M.setTransitionOrValue(E,x),M.untransitioned().possiblyEvaluate(new i.aa(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,x)=>{const S="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let E=r;E.startsWith(S)||(E=S+E);const M=i.I.from("mapbox-reserved-lut"),R=new Image;R.src=E,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:F,data:G}=i.q.getImageData(R);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new i.r({width:z,height:F},G),pixelRatio:1,sdf:!1,usvg:!1,version:0});const $=this.imageManager.getImage(M,this.scope);$?(this._styleColorTheme.lut={image:$.data,data:r},p()):x(new Error("Missing LUT image."))}})}getLut(r){const c=this._styleColorThemeForScope[r];return c?c.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(c,p,x){let S,E,M;const R=i.q.devicePixelRatio>1?"@2x":"";let z=i.n(p.transformRequest(p.normalizeSpriteURL(c,R,".json"),i.R.SpriteJSON),($,q)=>{z=null,M||(M=$,S=q,G())}),F=i.o(p.transformRequest(p.normalizeSpriteURL(c,R,".png"),i.R.SpriteImage),($,q)=>{F=null,M||(M=$,E=q,G())});function G(){if(M)x(M);else if(S&&E){const $=i.q.getImageData(E),q={};for(const ne in S){const{width:J,height:ie,x:oe,y:ce,sdf:ge,pixelRatio:xe,stretchX:Ce,stretchY:Ae,content:Te}=S[ne],be=new i.r({width:J,height:ie});i.r.copy($,be,{x:oe,y:ce},{x:0,y:0},{width:J,height:ie},null),q[ne]={data:be,pixelRatio:xe,sdf:ge,stretchX:Ce,stretchY:Ae,content:Te,usvg:!1}}x(null,q)}}return{cancel(){z&&(z.cancel(),z=null),F&&(F.cancel(),F=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new i.z(c));else if(p){const x=new Map;for(const S in p)x.set(i.I.from(S),p[S]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(r,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${c.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const S=new Ja(r,this.scope,p);this.imageManager.addImageProvider(S,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!i.j(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(S,E)=>{if(this._spriteRequest=null,S)c?this._loadSprite(r):this.fire(new i.z(S));else if(E){const M=new Map;for(const R in E)M.set(i.I.from(R),E[R]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.br((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(r),i.R.Iconset),(S,E)=>{if(S)return void x(S);const M={},R=i.c_(new i.bq(E));for(const z of R.icons){const F={version:1,pixelRatio:i.q.devicePixelRatio,content:Zy(z),stretchX:z.metadata?Mg(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?Mg(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};M[z.name]=F}x(null,M)}))}_validateLayer(r){const c=this.getOwnSource(r.source);if(!c)return;const p=r.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new i.z(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,c)=>{const p=this.fragments[c];return p&&p.style&&(r.data=p.style.serialize()),r})}_serializeSources(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return r}_serializeLayers(r){const c=[];for(const p of r){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const c=this.getOwnLayer(r);if(c)return c;this.fire(new i.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const c=this.getOwnSource(r);if(c)return c;this.fire(new i.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,c){const p=this.map.painter;if(p)for(let x=r.minzoom||0;x<(r.maxzoom||25.5);x++){const S=r.getProgramIds();if(S)for(const E of S){const M=r.getDefaultProgramParams(E,c.zoom,this._styleColorTheme.lut);M&&(p.style=this,this.fog&&(p._fogVisible=!0,M.overrideFog=!0,p.getOrCreateProgram(E,M)),p._fogVisible=!1,M.overrideFog=!1,p.getOrCreateProgram(E,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,p.getOrCreateProgram(E,M)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const c=this.calculateLightsBrightness();r.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const R in M){const{updatedIds:z,removedIds:F}=M[R];(z||F)&&(this._updateWorkerLayers(R,z,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const S={};for(const M in this._mergedSourceCaches){const R=this._mergedSourceCaches[M];S[M]=R.used,R.used=!1,R.tileCoverLift=0}for(const M of this._mergedOrder){const R=this._mergedLayers[M];if(R.recalculate(r,this._availableImages),!R.isHidden(r.zoom)){const z=this.getLayerSourceCache(R);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,r)}):this.precompilePrograms(R,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const E=this.imageManager.getPendingImageProviders();for(const M of E)M.sourceCache.used=!0;for(const M in S){const R=this._mergedSourceCaches[M];S[M]!==R.used&&R.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new i.A("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const c of r){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const r={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;r[p]=r[p]||this._changes.getUpdatedImages(p),r[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r[p])}for(const c in r)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(r,c,p){const x=this.getFragmentStyle(r);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:r,removedIds:p||[],options:x.options})}setState(r,c){if(this._checkLoaded(),ul(this,Vi(r)))return!1;(r=i.d6(r)).layers=Xa(r.layers);const p=function(E,M){if(!E)return[{command:Ar.setStyle,args:[M]}];let R=[];try{if(!i.bv(E.version,M.version))return[{command:Ar.setStyle,args:[M]}];if(i.bv(E.center,M.center)||R.push({command:Ar.setCenter,args:[M.center]}),i.bv(E.zoom,M.zoom)||R.push({command:Ar.setZoom,args:[M.zoom]}),i.bv(E.bearing,M.bearing)||R.push({command:Ar.setBearing,args:[M.bearing]}),i.bv(E.pitch,M.pitch)||R.push({command:Ar.setPitch,args:[M.pitch]}),i.bv(E.sprite,M.sprite)||R.push({command:Ar.setSprite,args:[M.sprite]}),i.bv(E.glyphs,M.glyphs)||R.push({command:Ar.setGlyphs,args:[M.glyphs]}),i.bv(E.imports,M.imports)||function(q=[],ne=[],J){ne=ne||[];const ie=(q=q||[]).map(Lc),oe=ne.map(Lc),ce=q.reduce(zc,{}),ge=ne.reduce(zc,{}),xe=ie.slice();let Ce,Ae,Te,be;for(Ce=0,Ae=0;Ce<ie.length;Ce++)Te=ie[Ce],ge.hasOwnProperty(Te)?Ae++:(J.push({command:Ar.removeImport,args:[Te]}),xe.splice(xe.indexOf(Te,Ae),1));for(Ce=0,Ae=0;Ce<oe.length;Ce++)Te=oe[oe.length-1-Ce],xe[xe.length-1-Ce]!==Te&&(ce.hasOwnProperty(Te)?(J.push({command:Ar.removeImport,args:[Te]}),xe.splice(xe.lastIndexOf(Te,xe.length-Ae),1)):Ae++,be=xe[xe.length-Ce],J.push({command:Ar.addImport,args:[ge[Te],be]}),xe.splice(xe.length-Ce,0,Te));for(const Ie of ne){const Re=ce[Ie.id];Re&&(delete Re.data,i.bv(Re,Ie)||J.push({command:Ar.updateImport,args:[Ie.id,Ie]}))}}(E.imports,M.imports,R),i.bv(E.transition,M.transition)||R.push({command:Ar.setTransition,args:[M.transition]}),i.bv(E.light,M.light)||R.push({command:Ar.setLight,args:[M.light]}),i.bv(E.fog,M.fog)||R.push({command:Ar.setFog,args:[M.fog]}),i.bv(E.snow,M.snow)||R.push({command:Ar.setSnow,args:[M.snow]}),i.bv(E.rain,M.rain)||R.push({command:Ar.setRain,args:[M.rain]}),i.bv(E.projection,M.projection)||R.push({command:Ar.setProjection,args:[M.projection]}),i.bv(E.lights,M.lights)||R.push({command:Ar.setLights,args:[M.lights]}),i.bv(E.camera,M.camera)||R.push({command:Ar.setCamera,args:[M.camera]}),i.bv(E.iconsets,M.iconsets)||function(q,ne,J){let ie;for(ie in ne=ne||{},q=q||{})q.hasOwnProperty(ie)&&(ne.hasOwnProperty(ie)||J.push({command:Ar.removeIconset,args:[ie]}));for(ie in ne){if(!ne.hasOwnProperty(ie))continue;const oe=ne[ie];q.hasOwnProperty(ie)?i.bv(q[ie],oe)||(J.push({command:Ar.removeIconset,args:[ie]}),J.push({command:Ar.addIconset,args:[ie,oe]})):J.push({command:Ar.addIconset,args:[ie,oe]})}}(E.iconsets,M.iconsets,R),!i.bv(E["color-theme"],M["color-theme"]))return[{command:Ar.setStyle,args:[M]}];const z={},F=[];(function(q,ne,J,ie){let oe;for(oe in ne=ne||{},q=q||{})q.hasOwnProperty(oe)&&(ne.hasOwnProperty(oe)||Cl(oe,J,ie));for(oe in ne){if(!ne.hasOwnProperty(oe))continue;const ce=ne[oe];q.hasOwnProperty(oe)?i.bv(q[oe],ce)||(q[oe].type==="geojson"&&ce.type==="geojson"&&Ig(q,ne,oe)?J.push({command:Ar.setGeoJSONSourceData,args:[oe,ce.data]}):Td(oe,ne,J,ie)):Sd(oe,ne,J)}})(E.sources,M.sources,F,z);const G=[];E.layers&&E.layers.forEach(q=>{q.source&&z[q.source]?R.push({command:Ar.removeLayer,args:[q.id]}):G.push(q)});let $=E.terrain;$&&z[$.source]&&(R.push({command:Ar.setTerrain,args:[void 0]}),$=void 0),R=R.concat(F),i.bv($,M.terrain)||R.push({command:Ar.setTerrain,args:[M.terrain]}),function(q,ne,J){ne=ne||[];const ie=(q=q||[]).map(Lc),oe=ne.map(Lc),ce=q.reduce(zc,{}),ge=ne.reduce(zc,{}),xe=ie.slice(),Ce=Object.create(null);let Ae,Te,be,Ie,Re,Be,Ge;for(Ae=0,Te=0;Ae<ie.length;Ae++)be=ie[Ae],ge.hasOwnProperty(be)?Te++:(J.push({command:Ar.removeLayer,args:[be]}),xe.splice(xe.indexOf(be,Te),1));for(Ae=0,Te=0;Ae<oe.length;Ae++)be=oe[oe.length-1-Ae],xe[xe.length-1-Ae]!==be&&(ce.hasOwnProperty(be)?(J.push({command:Ar.removeLayer,args:[be]}),xe.splice(xe.lastIndexOf(be,xe.length-Te),1)):Te++,Be=xe[xe.length-Ae],J.push({command:Ar.addLayer,args:[ge[be],Be]}),xe.splice(xe.length-Ae,0,be),Ce[be]=!0);for(Ae=0;Ae<oe.length;Ae++)if(be=oe[Ae],Ie=ce[be],Re=ge[be],!Ce[be]&&!i.bv(Ie,Re))if(i.bv(Ie.source,Re.source)&&i.bv(Ie["source-layer"],Re["source-layer"])&&i.bv(Ie.type,Re.type)){for(Ge in Oc(Ie.layout,Re.layout,J,be,null,Ar.setLayoutProperty),Oc(Ie.paint,Re.paint,J,be,null,Ar.setPaintProperty),i.bv(Ie.slot,Re.slot)||J.push({command:Ar.setSlot,args:[be,Re.slot]}),i.bv(Ie.filter,Re.filter)||J.push({command:Ar.setFilter,args:[be,Re.filter]}),i.bv(Ie.minzoom,Re.minzoom)&&i.bv(Ie.maxzoom,Re.maxzoom)||J.push({command:Ar.setLayerZoomRange,args:[be,Re.minzoom,Re.maxzoom]}),Ie)Ie.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Oc(Ie[Ge],Re[Ge],J,be,Ge.slice(6),Ar.setPaintProperty):i.bv(Ie[Ge],Re[Ge])||J.push({command:Ar.setLayerProperty,args:[be,Ge,Re[Ge]]}));for(Ge in Re)Re.hasOwnProperty(Ge)&&!Ie.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Oc(Ie[Ge],Re[Ge],J,be,Ge.slice(6),Ar.setPaintProperty):i.bv(Ie[Ge],Re[Ge])||J.push({command:Ar.setLayerProperty,args:[be,Ge,Re[Ge]]}))}else J.push({command:Ar.removeLayer,args:[be]}),Be=xe[xe.lastIndexOf(be)+1],J.push({command:Ar.addLayer,args:[Re,Be]})}(G,M.layers,R)}catch(z){console.warn("Unable to compute style diff:",z),R=[{command:Ar.setStyle,args:[M]}]}return R}(this.serialize(),r).filter(E=>!(E.command in _m));if(p.length===0)return!1;const x=p.filter(E=>!(E.command in Bf));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);const S=[];return p.forEach(E=>{S.push(this[E.command](...E.args))}),c&&Promise.all(S).then(c).catch(c),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){for(const[c,p]of r.entries()){if(this.getImage(c))return this.fire(new i.z(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(r,c){return this.getImage(r)?this.fire(new i.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(r,c,p=!1){this.imageManager.updateImage(r,this.scope,c),p&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new i.A("data",{dataType:"style"})),this}addModel(r,c,p={}){return this._checkLoaded(),this._validate(ve,`models.${r}`,c,null,p)||(this.modelManager.addModel(r,c,this.scope),this.fire(new i.A("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,c,p={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Is,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Pc(r,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const S=E=>{const M=(E?"symbol:":"other:")+x.id,R=i.C(M,this.scope),z=this._sourceCaches[M]=new no(R,x,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};S(!1),c.type!=="vector"&&c.type!=="geojson"||S(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const c=this.getOwnSource(r);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([S,E])=>E.type==="source"&&E.source===r);if(x)return this.fire(new i.z(new Error(`Source "${r}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(r);for(const x of p){const S=i.d7(x.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(x.id),x.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getOwnSource(r).setData(c),this._changes.setDirty()}getOwnSource(r){const c=this.getOwnSourceCache(r);return c&&c.getSource()}getOwnSources(){const r=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&r.push(p.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const c in r){const p=r[c]._tiles;for(const x in p){const S=p[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const S of r){if(this._validate(Ga,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const E=this.ambientLight;E.set(S),E.updateTransitions(c)}else this.ambientLight=new Fr(S,Hn||(Hn=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const E=this.directionalLight;E.set(S),E.updateTransitions(c)}else this.directionalLight=new Fr(S,ri||(ri=new i.a7({direction:new i.an(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new i.aa(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,c=this.ambientLight;if(!r||!c)return;const p=$=>.2126*($[0]<=.03928?$[0]/12.92:Math.pow(($[0]+.055)/1.055,2.4))+.7152*($[1]<=.03928?$[1]/12.92:Math.pow(($[1]+.055)/1.055,2.4))+.0722*($[2]<=.03928?$[2]/12.92:Math.pow(($[2]+.055)/1.055,2.4)),x=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),S=r.properties.get("intensity"),E=r.properties.get("direction"),M=1-i.cR(E.x,E.y,E.z)[2]/90,R=p(x)*S*M,z=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=c.properties.get("intensity"),G=p(z)*F;return Number(((R+G)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(i.d8(r)){const c=i.d9(r),p=this.fragments.find(({id:S})=>S===c);if(!p)return;const x=i.d7(r);return p.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:p})=>p===r);return c?c.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const c={},p=(x,S="")=>`${x}::${S}`;this._featuresetSelectors={};for(const x in r){const S=this._featuresetSelectors[x]=[];for(const E of r[x].selectors){if(E.featureNamespace){const R=this.getOwnLayer(E.layer);if(!R){i.w(`Layer is undefined for selector: ${E.layer}`);continue}const z=p(R.source,R.sourceLayer);if(z in c&&c[z]!==E.featureNamespace){i.w(`"featureNamespace ${E.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[z]=E.featureNamespace}let M;if(E.properties)for(const R in E.properties){const z=i.X(E.properties[R]);z.result==="success"&&(M=M||{},M[R]=z.value)}S.push({layerId:E.layer,namespace:E.featureNamespace,properties:M,uniqueFeatureID:E._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const c=this.getFragmentStyle(r);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(r,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[r])return this.fire(new i.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const E of x[r].selectors){const M=p.getOwnLayer(E.layer);M&&S.push(M)}return S}getConfigProperty(r,c){const p=this.getFragmentStyle(r);if(!p)return null;const x=i.C(c,p.scope),S=p.options.get(x),E=S?S.value||S.default:null;return E?E.serialize():null}setConfigProperty(r,c,p){const x=this.getFragmentStyle(r);if(!x)return;const S=x.stylesheet.indoor?lc(x.stylesheet.schema):x.stylesheet.schema;if(!S||!S[c])return;const E=i.X(p);if(E.result!=="success")return void ul(this,E.value);const M=E.value.expression,R=i.C(c,x.scope),z=x.options.get(R);if(!z)return;let F;const{minValue:G,maxValue:$,stepValue:q,type:ne,values:J}=S[c],ie=i.X(S[c].default);ie.result==="success"&&(F=ie.value.expression),F?(this.options.set(R,Object.assign({},z,{value:M,default:F,minValue:G,maxValue:$,stepValue:q,type:ne,values:J})),this.updateConfigDependencies(c)):this.fire(new i.z(new Error(`No schema defined for the config option "${c}" in the "${r}" fragment.`)))}getConfig(r){const c=this.getFragmentStyle(r);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const S in p){const E=i.C(S,c.scope),M=c.options.get(E),R=M?M.value||M.default:null;x[S]=R?R.serialize():null}return x}setConfig(r,c){const p=this.getFragmentStyle(r);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const c=this.getFragmentStyle(r);return c?c.stylesheet.schema:null}setSchema(r,c){const p=this.getFragmentStyle(r);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(r,c){if(this._config=r,r||c)if(c)for(const p in c){let x,S;const E=i.X(c[p].default);if(E.result==="success"&&(x=E.value.expression),r&&r[p]!==void 0){const $=i.X(r[p]);$.result==="success"&&(S=$.value.expression)}const{minValue:M,maxValue:R,stepValue:z,type:F,values:G}=c[p];if(x){const $=i.C(p,this.scope);this.options.set($,{default:x,value:S,minValue:M,maxValue:R,stepValue:z,type:F,values:G})}else this.fire(new i.z(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const c of this._configDependentLayers){const p=this.getLayer(c);if(p){if(r&&!p.configDependencies.has(r))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}}),this._changes.setDirty()}addLayer(r,c,p={}){this._checkLoaded();const x=r.id;if(this._layers[x])return void this.fire(new i.z(new Error(`Layer with id "${x}" already exists on this map`)));let S;if(r.type==="custom"){if(ul(this,i.da(r)))return;S=i.db(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(x,r.source),r=i.d6(r),r=i.h(r,{source:x})),this._validate(Sr,`layers.${x}`,r,{arrayIndex:-1},p))return;S=i.db(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid);let E=this._order.length;if(c){const F=this._order.indexOf(c);if(F===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));S.slot===this._layers[c].slot?E=F:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,x),this._layerOrderChanged=!0,this._layers[x]=S;const M=this.getOwnLayerSourceCache(S),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&S.canCastShadows()&&R&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(S);if(z&&S.source&&M&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const F=i.C(S.source,S.scope);z.type!==S.type?this._changes.updateSourceCache(F,"clear"):(this._changes.updateSourceCache(F,"reload"),M.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(r,c){this._checkLoaded();const p=this._checkLayer(r);if(!p||r===c)return;const x=this._order.indexOf(r);this._order.splice(x,1);let S=this._order.length;if(c){const E=this._order.indexOf(c);if(E===-1)return void this.fire(new i.z(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?S=E:i.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const c=this._checkLayer(r);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let S=!1;for(const E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){S=!0;break}x.castsShadows=S}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const x=this._checkLayer(r);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,c){this._checkLoaded();const p=this._checkLayer(r);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(r,c,p={}){this._checkLoaded();const x=this._checkLayer(r);if(x&&!i.bv(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(Ke,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=i.d6(c),this._updateLayer(x)))}getFilter(r){const c=this._checkLayer(r);if(c)return i.d6(c.filter)}setLayoutProperty(r,c,p,x={}){this._checkLoaded();const S=this._checkLayer(r);if(S&&!i.bv(S.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&ul(S,ue.call(Vi,{key:`layers.${r}.layout.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(c,p),S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)}}getLayoutProperty(r,c){const p=this._checkLayer(r);if(p)return p.getLayoutProperty(c)}setPaintProperty(r,c,p,x={}){this._checkLoaded();const S=this._checkLayer(r);if(!S||i.bv(S.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&ul(S,le.call(Vi,{key:`layers.${r}.paint.${c}`,layerType:S.type,objectKey:c,value:p,styleSpec:i.a5})))return;const E=S.setPaintProperty(c,p);S.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),E&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(r,c){const p=this._checkLayer(r);if(p)return p.getPaintProperty(c)}setFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:R,importId:z}=r.target,F=this.getFragmentStyle(z),G=F.getFeaturesetLayers(R);for(const{source:$,sourceLayer:q}of G)F.setFeatureState({id:r.id,source:$,sourceLayer:q},c)}else if("layerId"in r.target){const{layerId:R}=r.target,z=this.getLayer(R);this.setFeatureState({id:r.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=r.source,x=r.sourceLayer,S=this._checkSource(p);if(!S)return;const E=S.type;if(E==="geojson"&&x)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(p);for(const R of M)R.setFeatureState(x,r.id,c)}removeFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:R,importId:z}=r.target,F=this.getFragmentStyle(z),G=F.getFeaturesetLayers(R);for(const{source:$,sourceLayer:q}of G)F.removeFeatureState({id:r.id,source:$,sourceLayer:q},c)}else if("layerId"in r.target){const{layerId:R}=r.target,z=this.getLayer(R);this.removeFeatureState({id:r.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=r.source,x=this._checkSource(p);if(!x)return;const S=x.type,E=S==="vector"?r.sourceLayer:void 0;if(S==="vector"&&!E)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(p);for(const R of M)R.removeFeatureState(E,r.id,c)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let S;if("featuresetId"in r.target){const{featuresetId:E,importId:M}=r.target,R=this.getFragmentStyle(M),z=R.getFeaturesetLayers(E);for(const{source:F,sourceLayer:G}of z){const $=R.getFeatureState({id:r.id,source:F,sourceLayer:G});if($&&!S)S=$;else if(!i.bv(S,$))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:E}=r.target,M=this.getLayer(E);S=this.getFeatureState({id:r.id,source:M.source,sourceLayer:M.sourceLayer})}return S}const c=r.source,p=r.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return r.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=i.h({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return i.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),c=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return i.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(r){for(const c of Object.values(this._mergedLayers))r(c)&&this._updateLayer(c)}_updateLayer(r){this._changes.updateLayer(r);const c=this.getLayerSourceCache(r),p=i.C(r.source,r.scope),x=this._changes.getUpdatedSourceCaches();r.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=M=>this._mergedLayers[M].is3D(!!this.terrain),p=this.order,x={},S=[];for(let M=p.length-1;M>=0;M--){const R=p[M];if(c(R)){x[R]=M;for(const z of r){const F=z[R];if(F)for(const G of F)S.push(G)}}}S.sort((M,R)=>R.intersectionZ-M.intersectionZ);const E=[];for(let M=p.length-1;M>=0;M--){const R=p[M];if(c(R))for(let z=S.length-1;z>=0;z--){const F=S[z].feature;if(F.layer&&x[F.layer.id]<M)break;E.push(F),S.pop()}else for(const z of r){const F=z[R];if(F)for(const G of F)E.push(G.feature)}}return E}queryRenderedFeatures(r,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b3(c.filter));const S={},E=F=>{if(Nd.has(F.type))return;const G=this.getOwnLayerSourceCache(F),$=S[G.id]=S[G.id]||{sourceCache:G,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&($.has3DLayers=!0),$.layers[F.fqid]=$.layers[F.fqid]||{styleLayer:F,targets:[]},$.layers[F.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const F of c.layers){const G=this._layers[F];if(!G)return this.fire(new i.z(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];E(G)}}else for(const F in this._layers)E(this._layers[F]);const M=this._queryRenderedFeatures(r,S,p),R=this._flattenAndSortRenderedFeatures(M),z=[];for(const F of R)i.dd(F.layer.id)===this.scope&&z.push(F);return z}queryRenderedFeatureset(r,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",c.filter,null,c),x=i.b3(c.filter));const S="mock",E=[];if(c&&c.target)E.push(Object.assign({},c,{targetId:S,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const G of F)E.push({targetId:S,filter:x,target:G});for(const{style:G}of this.fragments){const $=G.getFeaturesetDescriptors();for(const q of $)E.push({targetId:S,filter:x,target:q})}}const M=this.queryRenderedTargets(r,E,p),R=[],z=new Set;for(const F of M)for(const G of F.variants[S])Nc(G,F,z)||R.push(new i.de(F,G));return R}queryRenderedTargets(r,c,p){const x={},S=(M,R,z,F)=>{const G=x[R.id]=x[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(G.layers[M.fqid]=G.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(G.has3DLayers=!0),!F)return z.uniqueFeatureID=!1,void G.layers[M.fqid].targets.push(z);G.layers[M.fqid].targets.push(Object.assign({},z,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const M of c)if("featuresetId"in M.target){const{featuresetId:R,importId:z}=M.target,F=this.getFragmentStyle(z);if(!F||!F._featuresetSelectors)continue;const G=F._featuresetSelectors[R];if(!G){this.fire(new i.z(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const $ of G){const q=F.getOwnLayer($.layerId);q&&!Nd.has(q.type)&&S(q,F.getOwnLayerSourceCache(q),M,$)}}else if("layerId"in M.target){const{layerId:R}=M.target,z=this.getLayer(R);if(!z||Nd.has(z.type))continue;S(z,this.getLayerSourceCache(z),M)}const E=this._queryRenderedFeatures(r,x,p);return this._flattenAndSortRenderedFeatures(E)}_queryRenderedFeatures(r,c,p){const x=[],S=!!this.map._showQueryGeometry,E=Nr.createFromScreenPoints(r,p);for(const M in c){const R=yu(E,c[M],this._availableImages,p,S);Object.keys(R).length&&x.push(R)}if(this.placement)for(const M in c){if(!c[M].sourceCache._onlySymbols)continue;const R=_u(E.screenGeometry,c[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&x.push(R)}return x}querySourceFeatures(r,c){const p=c&&c.filter;p&&this._validate(Ke,"querySourceFeatures.filter",p,null,c);let x=[];const S=this.getOwnSourceCaches(r);for(const E of S)x=x.concat(bd(E,c));return x}addSourceType(r,c,p){return xo.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(xo.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,c,p={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const M in r)if(!i.bv(r[M],x[M])){S=!0;break}if(!S)return;const E=this._getTransitionParameters();this.light.setLight(r,c,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,c=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=r;const x=r.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const M="terrain-dem-src";this.addSource(M,p.source),p=i.d6(p),p=i.h(p,{source:M})}const S=i.h({},p),E={};if(this.terrain&&x){S.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(E.style=M.serialize())}if(this._validate(Ot,"terrain",S,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new i.A("data",{dataType:"style"}))}else{const S=this.terrain,E=S.get();for(const M of Object.keys(i.a5.terrain))!p.hasOwnProperty(M)&&i.a5.terrain[M].default&&(p[M]=i.a5.terrain[M].default);for(const M in r)if(!i.bv(r[M],E[M])){S.set(r,this.options),this.stylesheet.terrain=r;const R=this._getTransitionParameters({duration:0});S.updateTransitions(R),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new gn(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(r){const c=this.snow=new mr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(r){const c=this.rain=new bi(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!i.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!i.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!i.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void r();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then(()=>{this.fire(new i.A("colorthemeset")),r()}).catch(x=>{i.w(`Couldn't set color theme: ${x}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,c){const p=this.getFragmentStyle(r);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(r){return{now:i.q.now(),transition:i.h(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?r.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const p=this.terrain=new je(r,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="symbol"&&this._updateLayer(c)}}_validate(r,c,p,x,S={}){if(S&&S.validate===!1)return!1;const E=i.h({},this.serialize());return ul(this,r.call(Vi,i.h({key:c,style:E,value:p,styleSpec:i.a5},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const c=this.getSourceCaches(r);for(const p of c)p.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const c=this.getSourceCaches(r);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let c;this.directionalLight&&(c=Uc(this.directionalLight));const p=new Set;for(const x in this._mergedLayers){const S=this._mergedLayers[x];S.hasElevation()&&!p.has(S.source)&&p.add(S.source)}for(const x in this._mergedSourceCaches){const S=this._mergedSourceCaches[x],E=p.has(S._source.id);S.update(r,void 0,void 0,c,E)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,x,S,E,M=!1){let R=!1,z=!1;const F={},G={};for(const $ of this._mergedOrder){const q=this._mergedLayers[$];if(q.type!=="symbol")continue;const ne=i.C(q.source,q.scope);let J=F[ne];if(!J){const oe=this.getLayerSourceCache(q);if(!oe)continue;const ce=oe.getRenderableIds(!0).map(ge=>oe.getTileByID(ge));G[ne]=ce.slice(),J=F[ne]=ce.sort((ge,xe)=>xe.tileID.overscaledZ-ge.tileID.overscaledZ||(ge.tileID.isLessThan(xe.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(q,J,c.center.lng,c.projection);R=R||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),c.zoom))&&(this.pauseablePlacement=new Lf(c,this._mergedOrder,M,p,x,S,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,G,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),z=!0),R&&this.pauseablePlacement.placement.setStale()),z||R){this._buildingIndex.onNewFrame(c.zoom);for(let $=0;$<this._mergedOrder.length;$++){const q=this._mergedLayers[this._mergedOrder[$]];if(q.type!=="symbol")continue;const ne=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,F[i.C(q.source,q.scope)],$,ne?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:S})=>S===r.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!c)return p.push(r),this._loadImports([r],!0);const x=p.findIndex(({id:S})=>S===c);return x===-1&&this.fire(new i.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(r).concat(p.slice(x)),this._loadImports([r],!0,c)}updateImport(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(r);return x===-1?this:typeof c=="string"?(this.setImportUrl(r,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(r,c.url),i.bv(c.config,p[x].config)||this.setImportConfig(r,c.config,c.data.schema),i.bv(c.data,p[x].data)||this.setImportData(r,c.data),this)}moveImport(r,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(r);if(x===-1)return this;const S=this.getImportIndex(c);if(S===-1)return this;const E=p[x],M=this.fragments[x];return p=p.filter(({id:R})=>R!==r),this.fragments=this.fragments.filter(({id:R})=>R!==r),this.stylesheet.imports=p.slice(0,S).concat(E).concat(p.slice(S)),this.fragments=this.fragments.slice(0,S).concat(M).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(r,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(r);if(x===-1)return this;p[x].url=c;const S=this.fragments[x];return S.style=this._createFragmentStyle(p[x]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(c),this}setImportData(r,c){this._checkLoaded();const p=this.getImportIndex(r),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(r,x[p].url))}setImportConfig(r,c,p){this._checkLoaded();const x=this.getImportIndex(r),S=this.stylesheet.imports||[];if(x===-1)return this;c?S[x].config=c:delete S[x].config;const E=this.fragments[x];p&&E.style.stylesheet&&(E.style.stylesheet.schema=p);const M=E.style.stylesheet&&E.style.stylesheet.schema;return E.config=c,E.style.updateConfig(c,M),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(r);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(r){const c=(this.stylesheet.imports||[]).findIndex(p=>p.id===r);return c===-1&&this.fire(new i.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),c}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&r.push(p.getSource())}return r}getSource(r,c){const p=this.getSourceCache(r,c);return p&&p.getSource()}getLayerSource(r){const c=this.getLayerSourceCache(r);return c&&c.getSource()}getSourceCache(r,c){const p=i.C(r,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(r){const c=i.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[r]&&c.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&c.push(this._mergedSymbolSourceCaches[r]),c}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const c in r){const p=r[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(r){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r,this.scope)}getImages(r,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=E=>{if(E){const M=c.images.map(R=>i.I.toString(R));E.setDependencies(c.tileID.key,c.type,M)}},S=i.C(c.source,c.scope);x(this._mergedOtherSourceCaches[S]),x(this._mergedSymbolSourceCaches[S])}rasterizeImages(r,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,c.scope,p)}getResource(r,c,p){return i.dg(c,p)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this.getOwnSourceCaches(r);return c.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${r}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,c){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const p=r.type==="fill-extrusion"&&r.sourceLayer==="building",x=r.type==="building";if(r.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}xo.getSourceType=function(f){return Rf[f]},xo.setSourceType=function(f,r){Rf[f]=r},xo.registerForPluginStateChange=i.dh;var Od=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,$c=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ld=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Il="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Hc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Uf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ro=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Ih=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,jt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Mh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ru=[];Ws(Od,Ru),Ws(Ld,Ru),Ws($c,Ru);const Nu={"_prelude_fog.vertex.glsl":Uf,"_prelude_terrain.vertex.glsl":Hc,"_prelude_shadow.vertex.glsl":jt,"_prelude_fog.fragment.glsl":Pu,"_prelude_shadow.fragment.glsl":Mh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ro,"_prelude_raster_particle.glsl":Ih},kh={};fr("",Hc),fr(Pu,Uf),fr(Mh,jt),fr(ro,""),fr(Ih,"");const Ph=fr($c,Ld),hl=Od;var zd={background:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:fr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:fr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:fr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:fr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:fr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:fr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:fr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:fr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:fr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:fr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:fr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Il),skyboxGradient:fr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Il),skyboxCapture:fr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:fr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:fr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:fr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:fr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:fr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ws(f,r){const c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const S of x)r.includes(S)||r.push(S)}}function fr(f,r){const c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(z=>{const F=z.split(" ");return F[F.length-1]}),x=[...new Set(x)]);const S={},E=[],M=[];if(f=f.replace(c,(z,F)=>(M.push(F),"")),(r=r.replace(c,(z,F)=>(E.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...Ru];Ws(f,R),Ws(r,R);for(const z of[...E,...M])Nu[z]||console.error(`Undefined include: ${z}`),kh[z]||(kh[z]=[],Ws(Nu[z],kh[z])),R=[...R,...kh[z]];return{fragmentSource:f=f.replace(p,(z,F,G,$,q)=>(S[q]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${G} ${$} ${q};
#else
uniform ${G} ${$} u_${q};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${G} ${$} ${q} = u_${q};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${G} ${$} ${q};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(p,(z,F,G,$,q)=>{const ne=$==="float"?"vec2":$,J=q.match(/color/)?"color":ne;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${G} ${$} a_${q};
#endif
`:S[q]?F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${G} ${ne} a_${q};
out ${G} ${$} ${q};
#else
uniform ${G} ${$} u_${q};
#endif
`:F==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${G} ${$} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${G} ${$} ${q} = u_${q};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${G} ${$} a_${q};
    out ${G} ${$} ${q};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${G} ${ne} a_${q};
#else
uniform ${G} ${$} u_${q};
#endif
`:F==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${G} ${$} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${G} ${ne} a_${q};
#else
uniform ${G} ${$} u_${q};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${G} ${$} ${q} = a_${q};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${G} ${$} ${q} = a_${q};
#else
    ${G} ${$} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${G} ${$} ${q} = unpack_mix_${J}(a_${q}, u_${q}_t);
#else
    ${G} ${$} ${q} = u_${q};
#endif
`}),staticAttributes:x,usedDefines:R,vertexIncludes:E,fragmentIncludes:M}}class Gc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,p,x,S,E,M,R){this.context=r;let z=this.boundPaintVertexBuffers.length!==x.length;for(let G=0;!z&&G<x.length;G++)this.boundPaintVertexBuffers[G]!==x[G]&&(z=!0);let F=this.boundDynamicVertexBuffers.length!==M.length;for(let G=0;!F&&G<M.length;G++)this.boundDynamicVertexBuffers[G]!==M[G]&&(F=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||z||F||this.boundIndexBuffer!==S||this.boundVertexOffset!==E)this.freshBind(c,p,x,S,E,M,R);else{r.bindVertexArrayOES.set(this.vao);for(const G of M)G&&(G.bind(),R&&G.instanceCount&&G.setVertexAttribDivisor(r.gl,c,R));S&&S.dynamicDraw&&S.bind()}}freshBind(r,c,p,x,S,E,M){const R=r.numAttributes,z=this.context,F=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=E,c.enableAttributes(F,r),c.bind(),c.setVertexAttribPointers(F,r,S);for(const G of p)G.enableAttributes(F,r),G.bind(),G.setVertexAttribPointers(F,r,S);for(const G of E)G&&(G.enableAttributes(F,r),G.bind(),G.setVertexAttribPointers(F,r,S),M&&G.instanceCount&&G.setVertexAttribDivisor(F,r,M));x&&x.bind(),z.currentNumAttributes=R}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Xy(f,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new i.ac(0,p/c).toLngLat().lat,new i.ac(0,(p+1)/c).toLngLat().lat]}function Ky(f,r,c,p,x,S,E){const M=f.context,R=M.gl,z=c.hillshadeFBO;if(!z)return;f.prepareDrawTile();const F=f.isTileAffectedByFog(r),G=f.getOrCreateProgram("hillshade",{overrideFog:F});M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get());const $=((ie,oe,ce,ge)=>{const xe=ce.paint.get("hillshade-shadow-color"),Ce=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ce.paint.get("hillshade-highlight-color"),Te=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",be=ce.paint.get("hillshade-accent-color"),Ie=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=ce.paint.get("hillshade-emissive-strength");let Be=i.al(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Be-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const st=ie.style.directionalLight.properties.get("direction"),it=i.cR(st.x,st.y,st.z);Be=i.al(it[1])}const Ge=!ie.options.moving;return{u_matrix:ge||ie.transform.calculateProjMatrix(oe.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Xy(0,oe.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Be],u_shadow:xe.toPremultipliedRenderColor(Ce?null:ce.lut),u_highlight:Ae.toPremultipliedRenderColor(Te?null:ce.lut),u_emissive_strength:Re,u_accent:be.toPremultipliedRenderColor(Ie?null:ce.lut)}})(f,c,p,f.terrain?r.projMatrix:null);f.uploadCommonUniforms(M,G,r.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:ne,tileBoundsSegments:J}=f.getTileBoundsBuffers(c);G.draw(f,R.TRIANGLES,x,S,E,In.disabled,$,p.id,q,ne,J)}function qc(f,r,c){if(!r.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const S=c.getPixels();r.demTexture?r.demTexture.update(S,{premultiply:!1}):r.demTexture=new i.T(p,S,x.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Yy(f,r,c){const p=f.context,x=p.gl;if(!r.dem)return;const S=r.dem;if(p.activeTexture.set(x.TEXTURE1),qc(f,r,S),!r.demTexture)return;r.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const E=S.dim;p.activeTexture.set(x.TEXTURE0);let M=r.hillshadeFBO;if(!M){const $=new i.T(p,{width:E,height:E,data:null},x.RGBA8);$.bind(x.LINEAR,x.CLAMP_TO_EDGE),M=r.hillshadeFBO=p.createFramebuffer(E,E,!0,"renderbuffer"),M.colorAttachment.set($.texture)}p.bindFramebuffer.set(M.framebuffer),p.viewport.set([0,0,E,E]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=f.getMercatorTileBoundsBuffers(),G=[];f.linearFloatFilteringSupported()&&G.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:G}).draw(f,x.TRIANGLES,Kt.disabled,Dn.disabled,ar.unblended,In.disabled,(($,q)=>{const ne=q.stride,J=i.bz();return i.c5(J,0,i.aj,-8192,0,0,1),i.bo(J,J,[0,-8192,0]),{u_matrix:J,u_image:1,u_dimension:[ne,ne],u_zoom:$.overscaledZ}})(r.tileID,S),c.id,R,z,F),r.needsHillshadePrepare=!1}class Ni{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xm extends Ni{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class es extends Ni{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class vm extends Ni{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class $f extends Ni{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class jd extends Ni{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class kg extends Ni{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Hf extends Ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Fd extends Ni{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Du extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Rh extends Ni{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class bm extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class wm extends Ni{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Gf extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class qf extends Ni{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ml extends Ni{getDefault(){return i.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class cc extends Ni{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Nh extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class Dh extends Ni{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Wc extends Ni{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Wf=class extends Ni{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Sm extends Ni{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Tm extends Ni{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Oh extends Ni{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Zf extends Ni{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Lh extends Ni{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class kl extends Ni{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Bd extends Ni{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Pl extends Ni{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class dl extends Ni{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class zh extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Rl extends Ni{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Nl extends Ni{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Pg extends Nl{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Rg extends Nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Ou extends Nl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Vd extends Rg{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Zc=(f,r,c)=>({u_matrix:f,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:c}),Lu=(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_frustum_tl:E,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:z,u_globe_pos:F,u_globe_radius:G,u_viewport:$,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:ne});function jh(f,r){return f!=null&&r!=null&&!(!f.hasData()||!r.hasData())&&f.demTexture!=null&&r.demTexture!=null&&f.tileID.key!==r.tileID.key}const ka=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,x){if(f in this.operations){const S=this.operations[f];S.to.tileID.key!==c.tileID.key&&(S.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Dl={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ts(f,r,c){if(r===0)return 0;const p=r<1&&c===514?.25/r:1;return 6*Math.pow(1.5,22-f)*Math.max(r,1)*p}function ns(f,r){const c=1<<f.z;return!r&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}const oa=f=>({u_matrix:f});function bs(f,r,c,p,x){if(x>0){const S=i.q.now(),E=(S-f.timeAdded)/x,M=r?(S-r.timeAdded)/x:-1,R=c.getSource(),z=p.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),F=!r||Math.abs(r.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),G=F&&f.refreshedUponExpiration?1:i.ay(F?E:1-M,0,1);return f.refreshedUponExpiration&&E>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}class $o extends no{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},p=new i.D(i.c$(),null),x=Pc("mock-dem",c,p,r.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class Zs extends no{constructor(r){const c=Pc("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new i.D(i.c$(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,E)=>{if(S[E.key]="",!this._tiles[E.key]){const M=new Dc(E,this._source.tileSize*E.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);M.state="loaded",this._tiles[E.key]=M}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(r){const c=this.proxyCachedFBO[r];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class uc extends i.aM{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class io extends i.dt{constructor(r,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,S]=function(R){const z=new i.ba,F=new i.a_,G=131;z.reserve(17161),F.reserve(33800);const $=i.aj/128,q=i.aj+$/2,ne=q+$;for(let ie=-64;ie<ne;ie+=$)for(let oe=-64;oe<ne;oe+=$){const ce=oe<0||oe>q||ie<0||ie>q?24575:0,ge=i.ay(Math.round(oe),0,i.aj),xe=i.ay(Math.round(ie),0,i.aj);z.emplaceBack(ge+ce,xe)}const J=(ie,oe)=>{const ce=oe*G+ie;F.emplaceBack(ce+1,ce,ce+G),F.emplaceBack(ce+G,ce+G+1,ce+1)};for(let ie=1;ie<129;ie++)for(let oe=1;oe<129;oe++)J(oe,ie);return[0,129].forEach(ie=>{for(let oe=0;oe<130;oe++)J(oe,ie),J(ie,oe)}),[z,F,32768]}(),E=r.context;this.gridBuffer=E.createVertexBuffer(p,i.bc.members),this.gridIndexBuffer=E.createIndexBuffer(x),this.gridSegments=i.bd.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=i.bd.simpleSegment(0,0,p.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Zs(c.map),this.orthoMatrix=i.bz(),i.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.aj,0,i.aj,0,1);const M=E.gl;this._overlapStencilMode=new Dn({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new $o(c.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const x=r.terrain.properties,S=r.terrain.drapeRenderMode===0,E=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const M=r.terrain&&r.terrain.scope,R=x.get("source"),z=S?this._mockSourceCache:r.getSourceCache(R,M);if(!z)return void i.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=z,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=E?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const G=this.getScaledDemTileSize();this.sourceCache.update(c,G,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const c=this._previousCameraAltitude,p=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const S=r.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(S);let M=S-this._previousZoom;const R=this._previousUpdateTimestamp;let z=S;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(S-z)>.5&&(M=.5*(S-z+M)),M*x<0&&(z+=M)),this._evaluationZoom=z;const F=E.getExaggeration(z),G=F===E.getExaggeration(Math.max(0,z-.1));if(G&&Math.abs(F-this._exaggeration)<.01)return F;let $=Math.min(.1,.00375*(this._updateTimestamp-R));return(G||F<.1||Math.abs(M)<1e-4)&&($=Math.min(.2,4*$)),i.ai(this._exaggeration,F,$)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(R=>{const z=c.getTileByID(R).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z});(function(R,z){const F=z.transform.pointCoordinate(z.transform.getCameraPoint()),G=new i.P(F.x,F.y);R.sort(($,q)=>{if(q.overscaledZ-$.overscaledZ)return q.overscaledZ-$.overscaledZ;const ne=new i.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),J=new i.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),ie=G.mult(1<<$.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(J)})})(x,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const R in E){const z=E[R];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,r[R],S),z.usedForTerrain))continue;const F=r[R];z.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[c.id]=x.map(R=>new uc(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const z=this.terrainTileForTile[R.key];if(!z)continue;const F=z.tileID.key;F in M||(this._visibleDemTiles.push(z),M[F]=F)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),qc(this.painter,x,S))}}_prepareDemTileUniforms(r,c,p,x){if(!c||c.demTexture==null)return!1;const S=r.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-S.z),M=x||"";return p[`u_dem_tl${M}`]=[S.x*E%1,S.y*E%1],p[`u_dem_scale${M}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const S=x.dem.tree.minimums[0];return S>0&&r++,p+S},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new i.du({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new i.T(r,x,c.R32F,{premultiply:!1}),S}setupElevationDraw(r,c,p){const x=this.painter.context,S=x.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let M=null,R=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const q=p.morphing.srcDemTile,ne=p.morphing.dstDemTile;z=p.morphing.phase,q&&ne&&(this._prepareDemTileUniforms(r,q,E,"_prev")&&(R=q),this._prepareDemTileUniforms(r,ne,E)&&(M=ne))}const F=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let G=null;var $;if(this.enabled?R&&M?(G=M.demTexture,x.activeTexture.set(S.TEXTURE4),R.demTexture.bind(F(R),S.CLAMP_TO_EDGE),E.u_dem_lerp=z):(M=this.terrainTileForTile[r.tileID.key],G=this._prepareDemTileUniforms(r,M,E)?M.demTexture:this.emptyDEMTexture):G=this.emptyDEMTexture,x.activeTexture.set(S.TEXTURE2),G&&(E.u_dem_size=($=G).size[0]===1?1:$.size[0]-2,G.bind(F(M),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,E),p&&p.useMeterToDem&&M){const q=(1<<M.tileID.canonical.z)*i.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=q}if(p&&p.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,E),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,r.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,q)}}globeUniformValues(r,c,p){const x=r.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,i.aj,0),u_tile_br_up:x.upVector(c,i.aj,i.aj),u_tile_bl_up:x.upVector(c,0,i.aj),u_tile_up_scale:p?i.dv(1):x.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;r.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,S,E,M,R){if(x.transform.projection.name==="globe")(function(z,F,G,$,q){const ne=z.context,J=ne.gl;let ie,oe;const ce=z.transform,ge=i.dl(z,ne,ce),xe=(st,it)=>{if(oe===it)return;const mt=[Dl[it],"PROJECTION_GLOBE_VIEW"];ge&&mt.push("CUSTOM_ANTIALIASING");const Ue=z.isTileAffectedByFog(st);ie=z.getOrCreateProgram("globeRaster",{defines:mt,overrideFog:Ue}),oe=it},Ce=z.colorModeForRenderPass(),Ae=new Kt(J.LEQUAL,Kt.ReadWrite,z.depthRangeFor3D);ka.update(q);const Te=i.dm(ce),be=[i.aD(ce.center.lng),i.aH(ce.center.lat)],Ie=z.globeSharedBuffers,Re=[ce.width*i.q.devicePixelRatio,ce.height*i.q.devicePixelRatio],Be=Float32Array.from(ce.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const st=z.transform,it=ts(st.zoom,F.exaggeration(),F.sourceCache._source.tileSize);oe=-1;const mt=J.TRIANGLES;for(const Ue of $){const Je=G.getTile(Ue),Le=Dn.disabled,lt=F.prevTerrainTileForTile[Ue.key],Ye=F.terrainTileForTile[Ue.key];jh(lt,Ye)&&ka.newMorphing(Ue.key,lt,Ye,q,250),ne.activeTexture.set(J.TEXTURE0),Je.texture&&Je.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const pt=ka.getMorphValuesForProxy(Ue.key),It=pt?1:0;pt&&i.L(Ge,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:i.dk(pt.phase)}});const ct=i.dn(Ue.canonical),wt=i.dp(ct.getCenter().lat),Vt=i.dq(Ue.canonical,ct,wt,st.worldSize/st._pixelsPerMercatorPixel),qt=i.bh(i.dr(Ue.canonical)),Bt=Lu(st.expandedFarZProjMatrix,Be,Te,qt,i.ah(st.zoom),be,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,Re,it,st._farZ,Vt);if(xe(Ue,It),ie&&(F.setupElevationDraw(Je,ie,Ge),z.uploadCommonUniforms(ne,ie,Ue.toUnwrapped()),Ie)){const[Xt,hn,yn]=Ie.getGridBuffers(wt,it!==0);ie.draw(z,mt,Ae,Le,Ce,In.backCCW,Bt,"globe_raster",Xt,hn,yn)}}}if(Ie&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&st.push("CUSTOM_ANTIALIASING"),ie=z.getOrCreateProgram("globeRaster",{defines:st});for(const it of $){const{x:mt,y:Ue,z:Je}=it.canonical,Le=Ue===0,lt=Ue===(1<<Je)-1,[Ye,pt,It,ct]=Ie.getPoleBuffers(Je,!1);if(ct&&(Le||lt)){const wt=G.getTile(it);ne.activeTexture.set(J.TEXTURE0),wt.texture&&wt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let Vt=i.ds(Je,mt,ce);const qt=i.bh(i.dr(it.canonical)),Bt=(Xt,hn)=>Xt.draw(z,J.TRIANGLES,Ae,Dn.disabled,Ce,In.disabled,Lu(ce.expandedFarZProjMatrix,Vt,Vt,qt,0,be,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Re,0,ce._farZ),"globe_pole_raster",hn,It,ct);F.setupElevationDraw(wt,ie,Ge),z.uploadCommonUniforms(ne,ie,it.toUnwrapped()),Le&&z.renderDefaultNorthPole&&Bt(ie,Ye),lt&&z.renderDefaultSouthPole&&(Vt=i.cE(i.bz(),Vt,[1,-1,1]),Bt(ie,pt))}}}})(x,S,E,M,R);else{const z=x.context,F=z.gl;let G,$;const q=x.shadowRenderer,ne=sa(x,x.longestCutoffRange),J=Ce=>{if($===Ce)return;const Ae=[];Ae.push(Dl[Ce]),ne.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),q&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&Ae.push("NORMAL_OFFSET")),G=x.getOrCreateProgram("terrainRaster",{defines:Ae}),$=Ce},ie=x.colorModeForRenderPass(),oe=new Kt(F.LEQUAL,Kt.ReadWrite,x.depthRangeFor3D);ka.update(R);const ce=x.transform,ge=ts(ce.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let xe=[0,0,0];if(q){const Ce=x.style.directionalLight,Ae=x.style.ambientLight;Ce&&Ae&&(xe=ac(x.style,Ce,Ae))}{$=-1;const Ce=F.TRIANGLES,[Ae,Te]=[S.gridIndexBuffer,S.gridSegments];for(const be of M){const Ie=E.getTile(be),Re=Dn.disabled,Be=S.prevTerrainTileForTile[be.key],Ge=S.terrainTileForTile[be.key];jh(Be,Ge)&&ka.newMorphing(be.key,Be,Ge,R,250),z.activeTexture.set(F.TEXTURE0),Ie.texture&&Ie.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const st=ka.getMorphValuesForProxy(be.key),it=st?1:0;let mt;st&&(mt={morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:i.dk(st.phase)}});const Ue=Zc(be.projMatrix,ns(be.canonical,ce.renderWorldCopies)?ge/10:ge,xe);if(J(it),!G)continue;S.setupElevationDraw(Ie,G,mt);const Je=be.toUnwrapped();q&&q.setupShadows(Je,G),x.uploadCommonUniforms(z,G,Je,null,ne),G.draw(x,Ce,oe,Re,ie,In.backCCW,Ue,"terrain_raster",S.gridBuffer,Ae,Te)}}}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],E=this._drapedRenderBatches.shift(),M=c.style.order,R=[];let z=0;for(const F of S){const G=x.getTileByID(F.proxyTileKey),$=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][r]:void 0,q=$!==void 0?x.renderCache[$]:this.pool[z++],ne=$!==void 0;if(G.texture=q.tex,ne&&!q.dirty){R.push(G.tileID);continue}let J;p.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(p.clear({color:i.am.transparent,stencil:0}),q.dirty=!1);for(let ie=E.start;ie<=E.end;++ie){const oe=c.style._mergedLayers[M[ie]];if(oe.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(oe),ge=ce?this.proxyToSource[F.key][ce.id]:[F];if(!ge)continue;const xe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(ce?ce.id:null)&&(this._setupStencil(q,ge,oe,ce),J=ce?ce.id:null),c.renderLayer(c,ce,oe,xe)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const oe=c.style._mergedLayers[M[ie]];if(oe.isHidden(c.transform.zoom))continue;const ce=c.style.getLayerSourceCache(oe),ge=ce?this.proxyToSource[F.key][ce.id]:[F];if(!ge)continue;const xe=ge;p.viewport.set([0,0,q.fb.width,q.fb.height]),J!==(ce?ce.id:null)&&(this._setupStencil(q,ge,oe,ce),J=ce?ce.id:null),c.renderLayer(c,ce,oe,xe)}this.renderedToTile?(q.dirty=!0,R.push(G.tileID)):ne||--z,z===5&&(z=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(r){const c=r.order.length;let p=-1,x=c;for(let S=0;S<c;++S)this._style.isLayerDraped(r._mergedLayers[r.order[S]])?p=Math.max(p,S):x=Math.min(x,S);return x>p}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const E=S.tileID,M=1<<E.overscaledZ,{x:R,y:z}=E.canonical,F=R/M,G=(R+1)/M,$=z/M,q=(z+1)/M;return{minx:F,miny:$,maxx:G,maxy:q,t:S.dem.tree.raycastRoot(F,$,G,q,r,c,p),tile:S}});x.sort((S,E)=>(S.t!==null?S.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const S of x){if(S.t==null)return null;const E=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,r,c,p);if(E!=null)return E}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const x=new i.T(r,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const S=r.createFramebuffer(p[0],p[1],!0,null);return S.colorAttachment.set(x.texture),S.depthAttachment=new Vd(r,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:S,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._mergedLayers[r],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const p of this._style.getSources())if(p instanceof Bo){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(S&&!c[S.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof i.ab){c[S.id]=!0;for(const E of this.proxyCoords){const M=this.proxyToSource[E.key][S.id];if(M)for(const R of M)this._clearRenderCacheForTile(S.id,R)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Gs){r=!0;break}if(!r)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],S=this._style.getLayerSourceCache(x);if(!S||c[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const E=x.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][S.id];if(R)for(const z of R){const F=bs(S.getTile(z),S.findLoadedParent(z,0),S,this.painter.transform,E);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(S.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,c=r.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,S=0,E=this._style._mergedLayers[r[S]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++S<c;)E=this._style._mergedLayers[r[S]];for(;S<c;++S){const M=this._style._mergedLayers[r[S]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?x===void 0&&(x=S):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),x!==void 0&&(p.push({start:x,end:S-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:S-1}),p.length!==0){const M=p[p.length-1];this._pendingGroundEffectLayers.every(R=>R>M.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<E.length;++M){const R=Object.values(E[M]);c.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let E=p.length-1;E>=0;E--){const M=p[E];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){const R=r[M.key],z=this.proxyToSource[M.key];let F=0;for(const G in z){const $=z[G],q=R[G];if(!q||q.length!==$.length||$.some((ne,J)=>ne!==q[J]||x[G]&&x[G].hasOwnProperty(ne.key))){F=-1;break}++F}for(const G in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][G]].dirty=F<0||F!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((E,M)=>M.end-M.start-(E.end-E.start));for(const E of S)for(const M of p){if(c.proxyCachedFBO[M.key])continue;let R=c.renderCachePool.pop();R===void 0&&c.renderCache.length<50&&(R=c.renderCache.length,c.renderCache.push(this._createFBO())),R!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][E.start]=R,c.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,E=S.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(p.isTileClipped())M=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Dn.disabled}_renderTileClippingMasks(r,c){const p=this.painter,x=this.painter.context,S=x.gl;p._tileClippingMaskIDs={},x.setColorMode(ar.disabled),x.setDepthMode(Kt.disabled);const E=p.getOrCreateProgram("clippingMask");for(const M of r){const R=p._tileClippingMaskIDs[M.key]=--c;E.draw(p,S.TRIANGLES,Kt.disabled,new Dn({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),ar.disabled,In.disabled,oa(M.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];i.aA(p,p,c.pixelMatrixInverse),i.cw(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,S=i.c6(1,c.center.lat),E=[x[0],x[1],x[2]/S,0],M=i.cX([],p.slice(0,3),E);i.au(M,M);const R=this.raycast(E,M,this._exaggeration);return R!==null&&R?(i.bE(E,E,M,R),E[3]=E[2],E[2]*=S,E):null}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof i.aP)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],S=this.proxyCoords;for(let R=0;R<S.length;R++){const z=S[R],F=this._findTileCoveringTileID(z,r);if(F){const G=this._createProxiedId(z,F,p[z.key]&&p[z.key][r.id]);x.push(G),this.proxyToSource[z.key][r.id]=[G]}}let E=!1;const M=new Set;for(let R=0;R<c.length;R++){const z=r.getTile(c[R]);if(!z||!z.hasData())continue;const F=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==z.tileID.canonical.z){const G=this.proxyToSource[F.tileID.key][r.id],$=this._createProxiedId(F.tileID,z,p[F.tileID.key]&&p[F.tileID.key][r.id]);G?G.splice(G.length-1,0,$):this.proxyToSource[F.tileID.key][r.id]=[$];const q=this.proxyToSource[F.tileID.key][r.id];M.has(q)||M.add(q),x.push($),E=!0}}if(this._sourceTilesOverlap[r.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const R of M)R.sort((z,F)=>F.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],S=this.proxyCoords,E=r.getSource(),M=E.tileID;if(!M)return;const R=new i.P(M.x,M.y)._div(1<<M.z),z=E.coordinates.map(i.ac.fromLngLat).reduce((G,$)=>(G.min.x=Math.min(G.min.x,$.x-R.x),G.min.y=Math.min(G.min.y,$.y-R.y),G.max.x=Math.max(G.max.x,$.x-R.x),G.max.y=Math.max(G.max.y,$.y-R.y),G),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(G,$)=>{const q=G.wrap+G.canonical.x/(1<<G.canonical.z),ne=G.canonical.y/(1<<G.canonical.z),J=i.aj/(1<<G.canonical.z),ie=$.wrap+$.canonical.x/(1<<$.canonical.z),oe=$.canonical.y/(1<<$.canonical.z);return q+J<ie+z.min.x||q>ie+z.max.x||ne+J<oe+z.min.y||ne>oe+z.max.y};for(let G=0;G<S.length;G++){const $=S[G];for(let q=0;q<c.length;q++){const ne=r.getTile(c[q]);if(!ne||!ne.hasData()||F($,ne.tileID))continue;const J=this._createProxiedId($,ne,p[$.key]&&p[$.key][r.id]),ie=this.proxyToSource[$.key][r.id];ie?ie.push(J):this.proxyToSource[$.key][r.id]=[J],x.push(J)}}}_createProxiedId(r,c,p){let x=this.orthoMatrix;if(p){const S=p.find(E=>E.key===c.tileID.key);if(S)return S}if(c.tileID.key!==r.key){const S=r.canonical.z-c.tileID.canonical.z;let E,M,R;x=i.bz();const z=c.tileID.wrap-r.wrap<<r.overscaledZ;S>0?(E=i.aj>>S,M=E*((c.tileID.canonical.x<<S)-r.canonical.x+z),R=E*((c.tileID.canonical.y<<S)-r.canonical.y)):(E=i.aj<<-S,M=i.aj*(c.tileID.canonical.x-(r.canonical.x+z<<-S)),R=i.aj*(c.tileID.canonical.y-(r.canonical.y<<-S))),i.c5(x,0,E,0,E,0,1),i.bo(x,x,[M,R,0])}return new uc(c.tileID,r.key,x)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],S=x[r.key];if(p=S?c.getTileByID(S):null,p&&p.hasData()||S===null)return p;let E=p?p.tileID:r,M=E.overscaledZ;const R=c.getSource().minzoom,z=[];if(!S){const G=c.getSource().maxzoom;if(r.canonical.z>=G){const $=r.canonical.z-G;c.getSource().reparseOverscaled?(M=Math.max(r.canonical.z+2,c.transform.tileZoom),E=new i.aM(M,r.wrap,G,r.canonical.x>>$,r.canonical.y>>$)):$!==0&&(M=G,E=new i.aM(M,r.wrap,G,r.canonical.x>>$,r.canonical.y>>$))}E.key!==r.key&&(z.push(E.key),p=c.getTile(E))}const F=G=>{z.forEach($=>{x[$]=G}),z.length=0};for(M-=1;M>=R&&(!p||!p.hasData());M--){p&&F(p.tileID.key);const G=E.calculateScaledKey(M);if(p=c.getTileByID(G),p&&p.hasData())break;const $=x[G];if($===null)break;$===void 0?z.push(G):p=c.getTileByID($)}return F(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}}function zu(f,r,c){const p=function(M,R,z){const F=i.bG(R,M),G=i.bG(z,[.2126,.7152,.0722]),$=(ne,J,ie)=>(1-ie)*ne+ie*J,q=$(1-.3*Math.min(G,1),1,Math.min(F+1,1));return $(.92,1,Math.asin(i.ay(R[2],-1,1))/Math.PI+.5)*q}(f,[0,0,1],r),x=[0,0,0];i.bY(x,c.slice(0,3),p);const S=[0,0,0];i.bY(S,r.slice(0,3),f[2]);const E=[0,0,0];return i.cV(E,x,S),i.cY(E)}const Xf=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Kf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ju{static cacheKey(r,c,p,x){let S=`${c}${x?x.cacheKey:""}`;for(const E of p)r.usedDefines.includes(E)&&(S+=`/${E}`);return S}constructor(r,c,p,x,S,E){const M=r.gl;this.program=M.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...E];const R=x?x.getBinderAttributes():[],z=(p.staticAttributes||[]).concat(R);let F=x?x.defines():[];F=F.concat(E.map(ie=>`#define ${ie}`));const G=`#version 300 es
`;let $=G+F.concat("precision mediump float;",hl,Ph.fragmentSource).join(`
`);for(const ie of p.fragmentIncludes)$+=`
${Nu[ie]}`;$+=`
${p.fragmentSource}`;let q=G+F.concat("precision highp float;",hl,Ph.vertexSource).join(`
`);for(const ie of p.vertexIncludes)q+=`
${Nu[ie]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const ne=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(ne,$),M.compileShader(ne),M.attachShader(this.program,ne);const J=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(J,q),M.compileShader(J),M.attachShader(this.program,J),this.attributes={},this.numAttributes=z.length;for(let ie=0;ie<this.numAttributes;ie++)if(z[ie]){const oe=z[ie].startsWith("a_")?z[ie]:`a_${z[ie]}`;M.bindAttribLocation(this.program,ie,oe),this.attributes[oe]=ie}M.linkProgram(this.program),M.deleteShader(J),M.deleteShader(ne),this.fixedUniforms=S(r),this.binderUniforms=x?x.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new i.c8(ie)}))(r)),(E.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(ie=>({u_dem:new i.c8(ie),u_dem_prev:new i.c8(ie),u_dem_tl:new i.cb(ie),u_dem_scale:new i.ca(ie),u_dem_tl_prev:new i.cb(ie),u_dem_scale_prev:new i.ca(ie),u_dem_size:new i.ca(ie),u_dem_lerp:new i.ca(ie),u_exaggeration:new i.ca(ie),u_depth:new i.c8(ie),u_depth_size_inv:new i.cb(ie),u_depth_range_unpack:new i.cb(ie),u_occluder_half_size:new i.ca(ie),u_occlusion_depth_offset:new i.ca(ie),u_meter_to_dem:new i.ca(ie),u_label_plane_matrix_inv:new i.cc(ie)}))(r)),E.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new i.c9(ie),u_tile_tr_up:new i.c9(ie),u_tile_br_up:new i.c9(ie),u_tile_bl_up:new i.c9(ie),u_tile_up_scale:new i.ca(ie)}))(r)),E.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new i.cc(ie),u_fog_range:new i.cb(ie),u_fog_color:new i.cQ(ie),u_fog_horizon_blend:new i.ca(ie),u_fog_vertical_limit:new i.cb(ie),u_fog_temporal_offset:new i.ca(ie),u_frustum_tl:new i.c9(ie),u_frustum_tr:new i.c9(ie),u_frustum_br:new i.c9(ie),u_frustum_bl:new i.c9(ie),u_globe_pos:new i.c9(ie),u_globe_radius:new i.ca(ie),u_globe_transition:new i.ca(ie),u_is_globe:new i.c8(ie),u_viewport:new i.cb(ie)}))(r)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new i.cQ(ie)}))(r)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new i.c9(ie),u_lighting_directional_dir:new i.c9(ie),u_lighting_directional_color:new i.c9(ie),u_ground_radiance:new i.c9(ie)}))(r)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new i.cc(ie),u_light_matrix_1:new i.cc(ie),u_fade_range:new i.cb(ie),u_shadow_normal_offset:new i.c9(ie),u_shadow_intensity:new i.ca(ie),u_shadow_texel_size:new i.ca(ie),u_shadow_map_resolution:new i.ca(ie),u_shadow_direction:new i.c9(ie),u_shadow_bias:new i.c9(ie),u_shadowmap_0:new i.c8(ie),u_shadowmap_1:new i.c8(ie)}))(r))}}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(r,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(r,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(r,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;r.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(r,c,p,x,S,E,M,R,z,F){const G=r.options.wireframe;if(G.terrain===!1&&G.layers2D===!1&&G.layers3D===!1)return;const $=r.context;if(!(!(!G.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!G.layers2D||r._terrain&&r._terrain.renderingToTexture||!Xf.includes(this.name))||!(!G.layers3D||!Kf.includes(this.name))))return;const q=$.gl,ne=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,S,$);if(!ne)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const ie=r.getOrCreateProgram(this.name,{config:this.configuration,defines:J});$.program.set(ie.program);const oe=(xe,Ce,Ae)=>{if(Ce[xe]&&Ae[xe])for(const Te in Ce[xe])Ae[xe][Te]&&Ae[xe][Te].set(Ae.program,Te,Ce[xe][Te].current)};z&&z.setUniforms(ie.program,$,ie.binderUniforms,M,{zoom:R}),oe("fixedUniforms",this,ie),oe("terrainUniforms",this,ie),oe("globeUniforms",this,ie),oe("fogUniforms",this,ie),oe("lightsUniforms",this,ie),oe("shadowUniforms",this,ie),ne.bind(),$.setColorMode(new ar([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],i.am.transparent,[!0,!0,!0,!1])),$.setDepthMode(new Kt(c.func===q.LESS?q.LEQUAL:c.func,Kt.ReadOnly,c.range)),$.setStencilMode(Dn.disabled);const ce=3*E.primitiveLength*2,ge=3*E.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const xe=F||1;for(let Ce=0;Ce<xe;++Ce)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,ge)}else F&&F>1?q.drawElementsInstanced(q.LINES,ce,q.UNSIGNED_SHORT,ge,F):q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,ge);S.bind(),$.program.set(this.program),$.setDepthMode(c),$.setStencilMode(p),$.setColorMode(x)}checkUniforms(r,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${x} not set but required by ${c} being defined`)}}draw(r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie){const oe=r.context,ce=oe.gl;if(this.failedToCreate)return;oe.program.set(this.program),oe.setDepthMode(p),oe.setStencilMode(x),oe.setColorMode(S),oe.setCullFace(E);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,M[Ce]);ne&&ne.setUniforms(this.program,oe,this.binderUniforms,$,{zoom:q});const ge={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[c];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const xe=ie&&ie>0?1:void 0;for(const Ce of G.get()){const Ae=Ce.vaos||(Ce.vaos={});if((Ae[R]||(Ae[R]=new Gc)).bind(oe,this,z,ne?ne.getPaintVertexBuffers():[],F,Ce.vertexOffset,J||[],xe),this.forceManualRenderingForInstanceIDShaders){const Te=ie||1;for(let be=0;be<Te;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),F?ce.drawElements(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2):ce.drawArrays(c,Ce.vertexOffset,Ce.vertexLength)}else ie&&ie>1?ce.drawElementsInstanced(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2,ie):F?ce.drawElements(c,Ce.primitiveLength*ge,ce.UNSIGNED_SHORT,Ce.primitiveOffset*ge*2):ce.drawArrays(c,Ce.vertexOffset,Ce.vertexLength);c===ce.TRIANGLES&&F&&this._drawDebugWireframe(r,p,x,S,F,Ce,$,q,ne,ie)}}}function Fh(f,r,c=0){const p=Math.pow(2,r.tileID.overscaledZ),x=r.tileSize*Math.pow(2,f.transform.tileZoom)/p,S=x*(r.tileID.canonical.x+r.tileID.wrap*p),E=x*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.aw(r,1,f.transform.tileZoom),u_pixel_coord_upper:[S>>16,E>>16],u_pixel_coord_lower:[65535&S,65535&E],u_pattern_transition:c}}const aa={terrain:0,flat:1},Bh=i.bz(),Fu=(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe)=>{const ce=r.style.light,ge=ce.properties.get("position"),xe=[ge.x,ge.y,ge.z],Ce=i.dx();ce.properties.get("anchor")==="viewport"&&(i.dy(Ce,-r.transform.angle),i.dz(xe,xe,Ce));const Ae=ce.properties.get("color").toPremultipliedRenderColor(null),Te=r.transform,be={u_matrix:f,u_lightpos:xe,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:aa[z],u_base_type:aa[F],u_ao:x,u_edge_radius:S,u_width_scale:E,u_flood_light_color:ne,u_vertical_scale:J,u_flood_light_intensity:ie,u_ground_shadow_factor:oe};return Te.projection.name==="globe"&&(be.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],be.u_zoom_transition=G,be.u_inv_rot_matrix=q,be.u_merc_center=$,be.u_up_dir=Te.projection.upVector(new i.cp(0,0,0),$[0]*i.aj,$[1]*i.aj),be.u_height_lift=R),be},Em=(f,r,c,p,x,S)=>({u_matrix:f,u_edge_radius:r,u_width_scale:c,u_vertical_scale:p,u_height_type:aa[x],u_base_type:aa[S]}),Ng=(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe)=>{const ce=Fu(f,r,c,p,x,S,E,M,z,F,G,$,q,ne,J,ie,1,[0,0,0]),ge={u_height_factor:-Math.pow(2,M.overscaledZ)/R.tileSize/8};return i.h(ce,Fh(r,R,oe),ge)},la=(f,r,c)=>({u_matrix:f,u_emissive_strength:r,u_ground_shadow_factor:c}),Bu=(f,r,c,p,x,S=0)=>i.h(la(f,r,x),Fh(c,p,S)),Vh=(f,r,c,p)=>({u_matrix:f,u_world:c,u_emissive_strength:r,u_ground_shadow_factor:p}),Yf=(f,r,c,p,x,S,E=0)=>i.h(Bu(f,r,c,p,S,E),{u_world:x}),Jf=(f,r)=>({u_matrix:f,u_ground_shadow_factor:r}),Ho=(f,r,c,p,x)=>({u_matrix:f,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),Qa=(f,r,c,p)=>{const x=i.aj/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.getCameraToCenterDistance(p),u_extrude_scale:[r.pixelsToGLUnits[0]/x,r.pixelsToGLUnits[1]/x]}},Ol=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),fl=i.bz(),Ll=(f,r,c,p,x,S,E)=>{const M=f.transform,R=M.projection.name==="globe",z=R?i.dA(M.zoom,r.canonical)*M._pixelsPerMercatorPixel:i.aw(c,1,S),F={u_matrix:r.projMatrix,u_extrude_scale:z,u_intensity:E,u_inv_rot_matrix:fl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){F.u_inv_rot_matrix=p,F.u_merc_center=x,F.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],F.u_zoom_transition=i.ah(M.zoom);const G=x[0]*i.aj,$=x[1]*i.aj;F.u_up_dir=M.projection.upVector(new i.cp(0,0,0),G,$)}return F};function Pa(f,[r,c,p,x],[S,E]){if(S===E)return[0,0,0,0];const M=255*(f-1)/(f*(E-S));return[r*M,c*M,p*M,x*M]}function Qf(f,r,[c,p]){return c===p?0:.5/f+(r-c)*(f-1)/(f*(p-c))}const Ud=(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce,ge,xe)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity*G.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:G.paint.get("raster-brightness-min"),u_brightness_high:G.paint.get("raster-brightness-max"),u_saturation_factor:i.dC(G.paint.get("raster-saturation")),u_contrast_factor:i.dB(G.paint.get("raster-contrast")),u_spin_weights:ep(G.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:q,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:R,u_colorization_mix:Pa(i.dD,J,oe),u_colorization_offset:Qf(i.dD,ie,oe),u_color_ramp:ne,u_texture_offset:[ge/(ce+2*ge),ce/(ce+2*ge)],u_texture_res:[ce+2*ge,ce+2*ge],u_emissive_strength:xe});function ep(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const Ls=.05,Xs=(f,r,c,p,x,S,E,M,R,z,F,G)=>({u_matrix:f,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:G,u_zoom_transition:E,u_merc_center:M,u_cutoff_params:R}),ls=(f,r,c,p,x,S,E,M,R,z)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_tile_offset:c,u_velocity:p,u_color_ramp:S,u_velocity_res:x,u_max_speed:E,u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ls,Ls]}),so=(f,r,c,p,x,S,E,M,R,z)=>({u_particle_texture:f,u_particle_texture_side_len:r,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:S,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ls,Ls]}),$d=i.bz(),Uh=(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce,ge,xe,Ce,Ae,Te)=>{const be=x.transform,Ie={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(ce),u_rotate_symbol:+c,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+z,u_elevation_from_sea:R?1:0,u_pitch_with_map:+p,u_texsize:F,u_texsize_icon:G,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$d,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$d,u_up_vector:[0,-1,0],u_color_adj_mat:Ce,u_icon_transition:Ae||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(ce)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:ge,u_inv_matrix:i.bi(i.bz(),E),u_normal_scale:xe};return ce.name==="globe"&&(Ie.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Ie.u_zoom_transition=ne,Ie.u_inv_rot_matrix=ie,Ie.u_merc_center=J,Ie.u_camera_forward=be._camera.forward(),Ie.u_ecef_origin=i.dE(be.globeMatrix,q.toUnwrapped()),Ie.u_tile_matrix=Float32Array.from(be.globeMatrix),Ie.u_up_vector=oe),Ie},Hd=(f,r,c,p)=>({u_matrix:f,u_emissive_strength:r,u_opacity:c,u_color:p}),Gd=(f,r,c,p,x,S,E,M,R)=>i.h(function(z,F,G,$,q,ne){const{width:J,height:ie}=$.imageManager.getPixelSize(F),oe=Math.pow(2,ne.tileID.overscaledZ),ce=ne.tileSize*Math.pow(2,$.transform.tileZoom)/oe,ge=ce*(ne.tileID.canonical.x+ne.tileID.wrap*oe),xe=ce*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl:G.tl,u_pattern_br:G.br,u_texsize:[J,ie],u_pattern_size:G.displaySize,u_pattern_units_to_pixels:q?[$.transform.width,-1*$.transform.height]:[1/i.aw(ne,1,$.transform.tileZoom),1/i.aw(ne,1,$.transform.tileZoom)],u_pixel_coord_upper:[ge>>16,xe>>16],u_pixel_coord_lower:[65535&ge,65535&xe]}}(0,S,E,p,M,R),{u_matrix:f,u_emissive_strength:r,u_opacity:c}),$h=new Float32Array(i.bx([])),Xc=(f,r,c,p,x,S,E,M,R,z,F,G,$,q=[0,0,0],ne)=>{const J=x.style.light,ie=J.properties.get("position"),oe=[-ie.x,-ie.y,ie.z],ce=i.dx();J.properties.get("anchor")==="viewport"&&(i.dy(ce,-x.transform.angle),i.dz(oe,oe,ce));const ge=F.alphaMode==="MASK",xe=J.properties.get("color").toNonPremultipliedRenderColor(null),Ce=$.paint.get("model-ambient-occlusion-intensity"),Ae=$.paint.get("model-color").constantOr(i.am.white).toNonPremultipliedRenderColor(null);return Ae.a=$.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:r,u_normal_matrix:c,u_node_matrix:p||$h,u_lightpos:oe,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_camera_pos:q,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:z,u_baseColorTexture:Io.BaseColor,u_metallicRoughnessTexture:Io.MetallicRoughness,u_normalTexture:Io.Normal,u_occlusionTexture:Io.Occlusion,u_emissionTexture:Io.Emission,u_lutTexture:Io.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Ce,u_emissive_strength:G,u_occlusionTextureTransform:ne||[0,0,0,0]}},Cm=(f,r=$h,c=$h)=>({u_matrix:f,u_instance:r,u_node_matrix:c}),Vu={fillExtrusion:f=>({u_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_vertical_gradient:new i.ca(f),u_opacity:new i.ca(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_ao:new i.cb(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_up_dir:new i.c9(f),u_height_lift:new i.ca(f),u_flood_light_color:new i.c9(f),u_vertical_scale:new i.ca(f),u_flood_light_intensity:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),fillExtrusionDepth:f=>({u_matrix:new i.cc(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_vertical_scale:new i.ca(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f)}),fillExtrusionPattern:f=>({u_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_vertical_gradient:new i.ca(f),u_height_factor:new i.ca(f),u_edge_radius:new i.ca(f),u_width_scale:new i.ca(f),u_ao:new i.cb(f),u_height_type:new i.c8(f),u_base_type:new i.c8(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_up_dir:new i.c9(f),u_height_lift:new i.ca(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_opacity:new i.ca(f),u_pattern_transition:new i.ca(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new i.cc(f),u_opacity:new i.ca(f),u_ao_pass:new i.ca(f),u_meter_to_tile:new i.ca(f),u_ao:new i.cb(f),u_flood_light_intensity:new i.ca(f),u_flood_light_color:new i.c9(f),u_attenuation:new i.ca(f),u_edge_radius:new i.ca(f),u_fb:new i.c8(f),u_fb_size:new i.ca(f),u_dynamic_offset:new i.ca(f)}),fill:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),fillPattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_pattern_transition:new i.ca(f)}),fillOutline:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_world:new i.cb(f),u_ground_shadow_factor:new i.c9(f)}),fillOutlinePattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_world:new i.cb(f),u_image:new i.c8(f),u_texsize:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_tile_units_to_pixels:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_pattern_transition:new i.ca(f)}),building:f=>({u_matrix:new i.cc(f),u_normal_matrix:new i.cc(f),u_opacity:new i.ca(f)}),buildingDepth:f=>({u_matrix:new i.cc(f)}),elevatedStructuresDepth:f=>({u_matrix:new i.cc(f),u_depth_bias:new i.ca(f)}),elevatedStructures:f=>({u_matrix:new i.cc(f),u_ground_shadow_factor:new i.c9(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new i.cc(f),u_camera_pos:new i.c9(f),u_depth_bias:new i.ca(f),u_height_scale:new i.ca(f),u_reset_depth:new i.ca(f)}),circle:i.dH,collisionBox:f=>({u_matrix:new i.cc(f),u_camera_to_center_distance:new i.ca(f),u_extrude_scale:new i.cb(f)}),collisionCircle:f=>({u_matrix:new i.cc(f),u_inv_matrix:new i.cc(f),u_camera_to_center_distance:new i.ca(f),u_viewport_size:new i.cb(f)}),debug:f=>({u_color:new i.di(f),u_matrix:new i.cc(f),u_overlay:new i.c8(f),u_overlay_scale:new i.ca(f)}),clippingMask:f=>({u_matrix:new i.cc(f)}),heatmap:f=>({u_extrude_scale:new i.ca(f),u_intensity:new i.ca(f),u_matrix:new i.cc(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_up_dir:new i.c9(f)}),heatmapTexture:f=>({u_image:new i.c8(f),u_color_ramp:new i.c8(f),u_opacity:new i.ca(f)}),hillshade:f=>({u_matrix:new i.cc(f),u_image:new i.c8(f),u_latrange:new i.cb(f),u_light:new i.cb(f),u_shadow:new i.di(f),u_highlight:new i.di(f),u_emissive_strength:new i.ca(f),u_accent:new i.di(f)}),hillshadePrepare:f=>({u_matrix:new i.cc(f),u_image:new i.c8(f),u_dimension:new i.cb(f),u_zoom:new i.ca(f)}),line:i.dG,linePattern:i.dF,raster:f=>({u_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_grid_matrix:new i.dj(f),u_tl_parent:new i.cb(f),u_scale_parent:new i.ca(f),u_fade_t:new i.ca(f),u_opacity:new i.ca(f),u_image0:new i.c8(f),u_image1:new i.c8(f),u_brightness_low:new i.ca(f),u_brightness_high:new i.ca(f),u_saturation_factor:new i.ca(f),u_contrast_factor:new i.ca(f),u_spin_weights:new i.c9(f),u_perspective_transform:new i.cb(f),u_raster_elevation:new i.ca(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_cutoff_params:new i.cQ(f),u_colorization_mix:new i.cQ(f),u_colorization_offset:new i.ca(f),u_color_ramp:new i.c8(f),u_texture_offset:new i.cb(f),u_texture_res:new i.cb(f),u_emissive_strength:new i.ca(f)}),rasterParticle:f=>({u_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_grid_matrix:new i.dj(f),u_tl_parent:new i.cb(f),u_scale_parent:new i.ca(f),u_fade_t:new i.ca(f),u_opacity:new i.ca(f),u_image0:new i.c8(f),u_image1:new i.c8(f),u_raster_elevation:new i.ca(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_cutoff_params:new i.cQ(f)}),rasterParticleTexture:f=>({u_texture:new i.c8(f),u_opacity:new i.ca(f)}),rasterParticleDraw:f=>({u_particle_texture:new i.c8(f),u_particle_texture_side_len:new i.ca(f),u_tile_offset:new i.cb(f),u_velocity:new i.c8(f),u_color_ramp:new i.c8(f),u_velocity_res:new i.cb(f),u_max_speed:new i.ca(f),u_uv_offset:new i.cb(f),u_data_scale:new i.cb(f),u_data_offset:new i.ca(f),u_particle_pos_scale:new i.ca(f),u_particle_pos_offset:new i.cb(f)}),rasterParticleUpdate:f=>({u_particle_texture:new i.c8(f),u_particle_texture_side_len:new i.ca(f),u_velocity:new i.c8(f),u_velocity_res:new i.cb(f),u_max_speed:new i.ca(f),u_speed_factor:new i.ca(f),u_reset_rate:new i.ca(f),u_rand_seed:new i.ca(f),u_uv_offset:new i.cb(f),u_data_scale:new i.cb(f),u_data_offset:new i.ca(f),u_particle_pos_scale:new i.ca(f),u_particle_pos_offset:new i.cb(f)}),symbol:f=>({u_is_size_zoom_constant:new i.c8(f),u_is_size_feature_constant:new i.c8(f),u_size_t:new i.ca(f),u_size:new i.ca(f),u_camera_to_center_distance:new i.ca(f),u_rotate_symbol:new i.c8(f),u_aspect_ratio:new i.ca(f),u_fade_change:new i.ca(f),u_matrix:new i.cc(f),u_label_plane_matrix:new i.cc(f),u_coord_matrix:new i.cc(f),u_is_text:new i.c8(f),u_elevation_from_sea:new i.c8(f),u_pitch_with_map:new i.c8(f),u_texsize:new i.cb(f),u_texsize_icon:new i.cb(f),u_texture:new i.c8(f),u_texture_icon:new i.c8(f),u_gamma_scale:new i.ca(f),u_device_pixel_ratio:new i.ca(f),u_tile_id:new i.c9(f),u_zoom_transition:new i.ca(f),u_inv_rot_matrix:new i.cc(f),u_merc_center:new i.cb(f),u_camera_forward:new i.c9(f),u_tile_matrix:new i.cc(f),u_up_vector:new i.c9(f),u_ecef_origin:new i.c9(f),u_is_halo:new i.c8(f),u_icon_transition:new i.ca(f),u_color_adj_mat:new i.cc(f),u_scale_factor:new i.ca(f),u_ground_shadow_factor:new i.c9(f),u_inv_matrix:new i.cc(f),u_normal_scale:new i.ca(f)}),background:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_opacity:new i.ca(f),u_color:new i.di(f)}),backgroundPattern:f=>({u_matrix:new i.cc(f),u_emissive_strength:new i.ca(f),u_opacity:new i.ca(f),u_image:new i.c8(f),u_pattern_tl:new i.cb(f),u_pattern_br:new i.cb(f),u_texsize:new i.cb(f),u_pattern_size:new i.cb(f),u_pixel_coord_upper:new i.cb(f),u_pixel_coord_lower:new i.cb(f),u_pattern_units_to_pixels:new i.cb(f)}),terrainRaster:f=>({u_matrix:new i.cc(f),u_image0:new i.c8(f),u_skirt_height:new i.ca(f),u_ground_shadow_factor:new i.c9(f)}),skybox:f=>({u_matrix:new i.cc(f),u_sun_direction:new i.c9(f),u_cubemap:new i.c8(f),u_opacity:new i.ca(f),u_temporal_offset:new i.ca(f)}),skyboxGradient:f=>({u_matrix:new i.cc(f),u_color_ramp:new i.c8(f),u_center_direction:new i.c9(f),u_radius:new i.ca(f),u_opacity:new i.ca(f),u_temporal_offset:new i.ca(f)}),skyboxCapture:f=>({u_matrix_3f:new i.dj(f),u_sun_direction:new i.c9(f),u_sun_intensity:new i.ca(f),u_color_tint_r:new i.cQ(f),u_color_tint_m:new i.cQ(f),u_luminance:new i.ca(f)}),globeRaster:f=>({u_proj_matrix:new i.cc(f),u_globe_matrix:new i.cc(f),u_normalize_matrix:new i.cc(f),u_merc_matrix:new i.cc(f),u_zoom_transition:new i.ca(f),u_merc_center:new i.cb(f),u_image0:new i.c8(f),u_grid_matrix:new i.dj(f),u_skirt_height:new i.ca(f),u_far_z_cutoff:new i.ca(f),u_frustum_tl:new i.c9(f),u_frustum_tr:new i.c9(f),u_frustum_br:new i.c9(f),u_frustum_bl:new i.c9(f),u_globe_pos:new i.c9(f),u_globe_radius:new i.ca(f),u_viewport:new i.cb(f)}),globeAtmosphere:f=>({u_frustum_tl:new i.c9(f),u_frustum_tr:new i.c9(f),u_frustum_br:new i.c9(f),u_frustum_bl:new i.c9(f),u_horizon:new i.ca(f),u_transition:new i.ca(f),u_fadeout_range:new i.ca(f),u_color:new i.cQ(f),u_high_color:new i.cQ(f),u_space_color:new i.cQ(f),u_temporal_offset:new i.ca(f),u_horizon_angle:new i.ca(f)}),model:f=>({u_matrix:new i.cc(f),u_lighting_matrix:new i.cc(f),u_normal_matrix:new i.cc(f),u_node_matrix:new i.cc(f),u_lightpos:new i.c9(f),u_lightintensity:new i.ca(f),u_lightcolor:new i.c9(f),u_camera_pos:new i.c9(f),u_opacity:new i.ca(f),u_baseColorFactor:new i.cQ(f),u_emissiveFactor:new i.cQ(f),u_metallicFactor:new i.ca(f),u_roughnessFactor:new i.ca(f),u_baseTextureIsAlpha:new i.c8(f),u_alphaMask:new i.c8(f),u_alphaCutoff:new i.ca(f),u_baseColorTexture:new i.c8(f),u_metallicRoughnessTexture:new i.c8(f),u_normalTexture:new i.c8(f),u_occlusionTexture:new i.c8(f),u_emissionTexture:new i.c8(f),u_lutTexture:new i.c8(f),u_color_mix:new i.cQ(f),u_aoIntensity:new i.ca(f),u_emissive_strength:new i.ca(f),u_occlusionTextureTransform:new i.cQ(f)}),modelDepth:f=>({u_matrix:new i.cc(f),u_instance:new i.cc(f),u_node_matrix:new i.cc(f)}),groundShadow:f=>({u_matrix:new i.cc(f),u_ground_shadow_factor:new i.c9(f)}),stars:f=>({u_matrix:new i.cc(f),u_up:new i.c9(f),u_right:new i.c9(f),u_intensity_multiplier:new i.ca(f)}),snowParticle:f=>({u_modelview:new i.cc(f),u_projection:new i.cc(f),u_time:new i.ca(f),u_cam_pos:new i.c9(f),u_velocityConeAperture:new i.ca(f),u_velocity:new i.ca(f),u_horizontalOscillationRadius:new i.ca(f),u_horizontalOscillationRate:new i.ca(f),u_boxSize:new i.ca(f),u_billboardSize:new i.ca(f),u_simpleShapeParameters:new i.cb(f),u_screenSize:new i.cb(f),u_thinningCenterPos:new i.cb(f),u_thinningShape:new i.c9(f),u_thinningAffectedRatio:new i.ca(f),u_thinningParticleOffset:new i.ca(f),u_particleColor:new i.cQ(f),u_direction:new i.c9(f)}),rainParticle:f=>({u_modelview:new i.cc(f),u_projection:new i.cc(f),u_time:new i.ca(f),u_cam_pos:new i.c9(f),u_texScreen:new i.c8(f),u_velocityConeAperture:new i.ca(f),u_velocity:new i.ca(f),u_boxSize:new i.ca(f),u_rainDropletSize:new i.cb(f),u_distortionStrength:new i.ca(f),u_rainDirection:new i.c9(f),u_color:new i.cQ(f),u_screenSize:new i.cb(f),u_thinningCenterPos:new i.cb(f),u_thinningShape:new i.c9(f),u_thinningAffectedRatio:new i.ca(f),u_thinningParticleOffset:new i.ca(f),u_shapeDirectionalPower:new i.ca(f),u_shapeNormalPower:new i.ca(f),u_mode:new i.ca(f)}),vignette:f=>({u_vignetteShape:new i.c9(f),u_vignetteColor:new i.cQ(f)}),occlusion:f=>({u_matrix:new i.cc(f),u_anchorPos:new i.c9(f),u_screenSizePx:new i.cb(f),u_occluderSizePx:new i.cb(f),u_color:new i.cQ(f)})};class ca{constructor(r,c,p,x){this.id=ca.uniqueIdxCounter,ca.uniqueIdxCounter++,this.context=r;const S=r.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=ca.uniqueIdxCounter,ca.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}ca.uniqueIdxCounter=0;const Jy={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class qd{constructor(r,c,p,x,S,E){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=E,this.context=r;const M=r.gl;this.buffer=M.createBuffer(),r.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||S||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const x=c.attributes[this.attributes[p].name];x!==void 0&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,c,p){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],E=c.attributes[S.name];E!==void 0&&r.vertexAttribPointer(E,S.components,r[Jy[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(r,c,p){for(let x=0;x<this.attributes.length;x++){const S=c.attributes[this.attributes[x].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(S,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Hh{constructor(r,c,p,x,S){this.context=r,this.width=c,this.height=p;const E=this.framebuffer=r.gl.createFramebuffer();x&&(this.colorAttachment=new Pg(r,E)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new Rg(r,E):new Ou(r,E))}destroy(){const r=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&r.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&r.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&r.deleteTexture(c)}r.deleteFramebuffer(this.framebuffer)}}class Dg{constructor(r,c){this.gl=r,this.clearColor=new xm(this),this.clearDepth=new es(this),this.clearStencil=new vm(this),this.colorMask=new $f(this),this.depthMask=new jd(this),this.stencilMask=new kg(this),this.stencilFunc=new Hf(this),this.stencilOp=new Fd(this),this.stencilTest=new Du(this),this.depthRange=new Rh(this),this.depthTest=new bm(this),this.depthFunc=new wm(this),this.blend=new Gf(this),this.blendFunc=new qf(this),this.blendColor=new Ml(this),this.blendEquation=new cc(this),this.cullFace=new Nh(this),this.cullFaceSide=new Dh(this),this.frontFace=new Wc(this),this.program=new Wf(this),this.activeTexture=new Sm(this),this.viewport=new Tm(this),this.bindFramebuffer=new Oh(this),this.bindRenderbuffer=new Zf(this),this.bindTexture=new Lh(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Bd(this),this.bindVertexArrayOES=new Pl(this),this.pixelStoreUnpack=new dl(this),this.pixelStoreUnpackPremultiplyAlpha=new zh(this),this.pixelStoreUnpackFlipY=new Rl(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c,p){return new ca(this,r,c,p)}createVertexBuffer(r,c,p,x,S){return new qd(this,r,c,p,x,S)}createRenderbuffer(r,c,p){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),S}createFramebuffer(r,c,p,x){return new Hh(this,r,c,p,x)}clear({color:r,depth:c,stencil:p,colorMask:x}){const S=this.gl;let E=0;r&&(E|=S.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(E|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(E|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),S.clear(E)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){i.bv(r.blendFunction,ar.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Uu;function hc(f,r,c,p,x,S,E){const M=f.context,R=M.gl,z=f.transform,F=f.getOrCreateProgram("collisionBox"),G=[];let $=0,q=0;for(let xe=0;xe<p.length;xe++){const Ce=p[xe],Ae=r.getTile(Ce),Te=Ae.getBucket(c);if(!Te)continue;const be=Mn(Ce,Te,z);let Ie=be;x[0]===0&&x[1]===0||(Ie=f.translatePosMatrix(be,Ae,x,S));const Re=E?Te.textCollisionBox:Te.iconCollisionBox,Be=Te.collisionCircleArray;if(Be.length>0){const Ge=i.bz(),st=Ie;i.cB(Ge,Te.placementInvProjMatrix,z.glCoordMatrix),i.cB(Ge,Ge,Te.placementViewportMatrix),G.push({circleArray:Be,circleOffset:q,transform:st,invTransform:Ge,projection:Te.getProjection()}),$+=Be.length/4,q=$}Re&&(f.terrain&&f.terrain.setupElevationDraw(Ae,F),F.draw(f,R.LINES,Kt.disabled,Dn.disabled,f.colorModeForRenderPass(),In.disabled,Qa(Ie,z,Ae,Te.getProjection()),c.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,z.zoom,null,[Re.collisionVertexBuffer,Re.collisionVertexBufferExt]))}if(!E||!G.length)return;const ne=f.getOrCreateProgram("collisionCircle"),J=new i.dI;J.resize(4*$),J._trim();let ie=0;for(const xe of G)for(let Ce=0;Ce<xe.circleArray.length/4;Ce++){const Ae=4*Ce,Te=xe.circleArray[Ae+0],be=xe.circleArray[Ae+1],Ie=xe.circleArray[Ae+2],Re=xe.circleArray[Ae+3];J.emplace(ie++,Te,be,Ie,Re,0),J.emplace(ie++,Te,be,Ie,Re,1),J.emplace(ie++,Te,be,Ie,Re,2),J.emplace(ie++,Te,be,Ie,Re,3)}(!Uu||Uu.length<2*$)&&(Uu=function(xe){const Ce=2*xe,Ae=new i.a_;Ae.resize(Ce),Ae._trim();for(let Te=0;Te<Ce;Te++){const be=6*Te;Ae.uint16[be+0]=4*Te+0,Ae.uint16[be+1]=4*Te+1,Ae.uint16[be+2]=4*Te+2,Ae.uint16[be+3]=4*Te+2,Ae.uint16[be+4]=4*Te+3,Ae.uint16[be+5]=4*Te+0}return Ae}($));const oe=M.createIndexBuffer(Uu,!0),ce=M.createVertexBuffer(J,i.dJ.members,!0);for(const xe of G){const Ce={u_matrix:xe.transform,u_inv_matrix:xe.invTransform,u_camera_to_center_distance:(ge=z).getCameraToCenterDistance(xe.projection),u_viewport_size:[ge.width,ge.height]};ne.draw(f,R.TRIANGLES,Kt.disabled,Dn.disabled,f.colorModeForRenderPass(),In.disabled,Ce,c.id,ce,oe,i.bd.simpleSegment(0,2*xe.circleOffset,xe.circleArray.length,xe.circleArray.length/2),null,z.zoom)}var ge;ce.destroy(),oe.destroy()}const zl=i.bz();function Kc(f){const r=f._camera.getWorldToCamera(f.worldSize,1),c=i.az([],r,f.globeMatrix);i.bi(c,c);const p=[0,0,0],x=[0,1,0,0];return i.aA(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],i.au(p,p),p}function Yc({width:f,height:r,anchor:c,textOffset:p,textScale:x},S){const{horizontalAlign:E,verticalAlign:M}=i.bT(c),R=-(E-.5)*f,z=-(M-.5)*r,F=i.bU(c,p);return new i.P((R/x+F[0])*S,(z/x+F[1])*S)}function $u(f,r,c,p,x,S,E,M,R,z){const F=f.text.placedSymbolArray,G=f.text.dynamicLayoutVertexArray,$=f.icon.dynamicLayoutVertexArray,q={},ne=f.getProjection(),J=Sh(E,ne,x),ie=x.elevation,oe=ne.upVectorScale(E.canonical,x.center.lat,x.worldSize).metersToTile;G.clear();for(let ce=0;ce<F.length;ce++){const ge=F.get(ce),{tileAnchorX:xe,tileAnchorY:Ce,numGlyphs:Ae}=ge,Te=ge.hidden||!ge.crossTileID||f.allowVerticalPlacement&&!ge.placedOrientation?null:p[ge.crossTileID];if(Te){let be=0,Ie=0,Re=0;if(ie){const lt=ie?ie.getAtTileOffset(E,xe,Ce):0,[Ye,pt,It]=ne.upVector(E.canonical,xe,Ce);be=lt*Ye*oe,Ie=lt*pt*oe,Re=lt*It*oe}let[Be,Ge,st,it]=ta(ge.projectedAnchorX+be,ge.projectedAnchorY+Ie,ge.projectedAnchorZ+Re,c?J:S);const mt=Su(x.getCameraToCenterDistance(ne),it);let Ue=i.bJ(f.textSizeData,R,ge)*mt/i.bO;c&&(Ue*=f.tilePixelRatio/M);const Je=Yc(Te,Ue);c?({x:Be,y:Ge,z:st}=ne.projectTilePoint(xe+Je.x,Ce+Je.y,E.canonical),[Be,Ge,st]=ta(Be+be,Ge+Ie,st+Re,S)):(r&&Je._rotate(-x.angle),Be+=Je.x,Ge+=Je.y,st=0);const Le=f.allowVerticalPlacement&&ge.placedOrientation===i.bI.vertical?Math.PI/2:0;for(let lt=0;lt<Ae;lt++)i.bL(G,Be,Ge,st,Le);z&&ge.associatedIconIndex>=0&&(q[ge.associatedIconIndex]={x:Be,y:Ge,z:st,angle:Le})}else qs(Ae,G)}if(z){$.clear();const ce=f.icon.placedSymbolArray;for(let ge=0;ge<ce.length;ge++){const xe=ce.get(ge),{numGlyphs:Ce}=xe,Ae=q[ge];if(xe.hidden||!Ae)qs(Ce,$);else{const{x:Te,y:be,z:Ie,angle:Re}=Ae;for(let Be=0;Be<Ce;Be++)i.bL($,Te,be,Ie,Re)}}f.icon.dynamicLayoutVertexBuffer.updateData($)}f.text.dynamicLayoutVertexBuffer.updateData(G)}function Jc(f,r,c,p,x,S,E={}){const M=c.paint.get("icon-translate"),R=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),F=c.paint.get("text-translate-anchor"),G=c.layout.get("icon-rotation-alignment"),$=c.layout.get("text-rotation-alignment"),q=c.layout.get("icon-pitch-alignment"),ne=c.layout.get("text-pitch-alignment"),J=c.layout.get("icon-keep-upright"),ie=c.layout.get("text-keep-upright"),oe=c.paint.get("icon-color-saturation"),ce=c.paint.get("icon-color-contrast"),ge=c.paint.get("icon-color-brightness-min"),xe=c.paint.get("icon-color-brightness-max"),Ce=c.layout.get("symbol-elevation-reference")==="sea",Ae=f.context,Te=Ae.gl,be=f.transform,Ie=G==="map",Re=$==="map",Be=q==="map",Ge=ne==="map",st=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const mt=f.depthModeForSublayer(0,Kt.ReadOnly),Ue=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),Je=[i.aD(be.center.lng),i.aH(be.center.lat)],Le=c.layout.get("text-variable-anchor"),lt=be.projection.name==="globe",Ye=[],pt=[0,-1,0];for(const It of p){const ct=r.getTile(It),wt=ct.getBucket(c);if(!wt||wt.projection.name==="mercator"&&lt||wt.fullyClipped)continue;const Vt=wt.projection.name==="globe",qt=Vt?i.ah(be.zoom):0,Bt=Sh(It,wt.getProjection(),be),Xt=be.calculatePixelsToTileUnitsMatrix(ct),hn=Le&&wt.hasTextData(),yn=wt.hasIconTextFit()&&hn&&wt.hasIconData(),Ln=wt.getProjection().createInversionMatrix(be,It.canonical),Qn=(1<<ct.tileID.canonical.z)*i.aj/f.transform.worldSize,br=hi=>{let Lr=[0,0,0];if(hi){const Fi=f.style.directionalLight,vr=f.style.ambientLight;Fi&&vr&&(Lr=ac(f.style,Fi,vr))}return Lr},oi=hi=>{be.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||f.terrain)&&(hi.push("DEPTH_D24"),hi.push("DEPTH_OCCLUSION"))},Vr=()=>{const hi=Ie&&c.layout.get("symbol-placement")!=="point",Lr=[];oi(Lr);const Fi=hi||yn,vr=wt.elevationType==="road"&&Be,Bi=f.shadowRenderer,gi=vr&&!!Bi&&Bi.enabled,Gr=br(gi),di=vr?Ue:mt,Xn=c.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Be&&Lr.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(Lr.push("PROJECTION_GLOBE_VIEW"),Fi&&Lr.push("PROJECTED_POS_ON_VIEWPORT")),Xn>0&&Lr.push("ICON_TRANSITION"),wt.icon.zOffsetVertexBuffer&&Lr.push("Z_OFFSET"),oe===0&&ce===0&&ge===0&&xe===1||Lr.push("COLOR_ADJUSTMENT"),wt.sdfIcons&&Lr.push("RENDER_SDF"),gi&&Lr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vr&&wt.icon.orientationVertexBuffer&&Lr.push("ELEVATED_ROADS");const Gi=wt.icon.programConfigurations.get(c.id),Bs=f.getOrCreateProgram("symbol",{config:Gi,defines:Lr}),wi=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Dr=wt.iconSizeData,Zo=i.bH(Dr,be.zoom),Ro=Be||!be.isOrthographic,Oa=tc(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt),ws=bh(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt),da=f.translatePosMatrix(ws,ct,M,z,!0),Xo=f.translatePosMatrix(Bt,ct,M,z),Ko=Fi?zl:Oa,fa=Ie&&!Be&&!hi;let pa=pt;!lt&&!be.mercatorFromTransition||Ie||(pa=Kc(be));const su=Vt?pa:pt,uf=c.getColorAdjustmentMatrix(oe,ce,ge,xe),ou=Uh(Dr.kind,Zo,fa,Be,f,Xo,Ko,da,Ce,!1,wi,[0,0],0,It,qt,Je,Ln,su,wt.getProjection(),Gr,Qn,uf,Xn,null),Bm=ct.imageAtlasTexture?ct.imageAtlasTexture:null,nh=c.layout.get("icon-size").constantOr(0)!==1||wt.iconsNeedLinear,wp=wt.sdfIcons||f.options.rotating||f.options.zooming||nh||Ro?Te.LINEAR:Te.NEAREST,hf=wt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,xl=f.terrain&&Be&&hi?i.bi(i.bz(),Oa):zl;if(hi&&wt.icon){const bc=be.elevation,Wl=bc?bc.getAtTileOffsetFunc(It,be.center.lat,be.worldSize,wt.getProjection()):null,wc=Df(Bt,ct.tileID.canonical,Be,Ie,be,wt.getProjection(),Xt);cl(wt,Bt,f,!1,wc,ws,Be,J,Wl,It)}return{program:Bs,buffers:wt.icon,uniformValues:ou,atlasTexture:Bm,atlasTextureIcon:null,atlasInterpolation:wp,atlasInterpolationIcon:null,isSDF:wt.sdfIcons,hasHalo:hf,depthMode:di,tile:ct,renderWithShadows:gi,labelPlaneMatrixInv:xl}},Pr=()=>{const hi=Re&&c.layout.get("symbol-placement")!=="point",Lr=[],Fi=hi||Le||yn,vr=wt.elevationType==="road"&&Ge,Bi=f.shadowRenderer,gi=vr&&!!Bi&&Bi.enabled,Gr=br(gi),di=vr?Ue:mt;f.terrainRenderModeElevated()&&Ge&&Lr.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(Lr.push("PROJECTION_GLOBE_VIEW"),Fi&&Lr.push("PROJECTED_POS_ON_VIEWPORT")),wt.text.zOffsetVertexBuffer&&Lr.push("Z_OFFSET"),wt.iconsInText&&Lr.push("RENDER_TEXT_AND_SYMBOL"),Lr.push("RENDER_SDF"),gi&&Lr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),vr&&wt.text.orientationVertexBuffer&&Lr.push("ELEVATED_ROADS"),oi(Lr);const Xn=wt.text.programConfigurations.get(c.id),Gi=f.getOrCreateProgram("symbol",{config:Xn,defines:Lr});let Bs,wi=[0,0],Dr=null;const Zo=wt.textSizeData;wt.iconsInText&&(wi=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Dr=ct.imageAtlasTexture?ct.imageAtlasTexture:null,Bs=Ge||!be.isOrthographic||f.options.rotating||f.options.zooming||Zo.kind==="composite"||Zo.kind==="camera"?Te.LINEAR:Te.NEAREST);const Ro=ct.glyphAtlasTexture?ct.glyphAtlasTexture.size:[0,0],Oa=c.layout.get("text-size-scale-range"),ws=i.ay(f.scaleFactor,Oa[0],Oa[1]),da=i.bH(Zo,be.zoom,ws),Xo=tc(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt),Ko=bh(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt),fa=f.translatePosMatrix(Ko,ct,R,F,!0),pa=f.translatePosMatrix(Bt,ct,R,F),su=Fi?zl:Xo,uf=Re&&!Ge&&!hi;let ou=pt;!lt&&!be.mercatorFromTransition||Re||(ou=Kc(be));const Bm=Uh(Zo.kind,da,uf,Ge,f,pa,su,fa,Ce,!0,Ro,wi,0,It,qt,Je,Ln,Vt?ou:pt,wt.getProjection(),Gr,Qn,null,null,ws),nh=ct.glyphAtlasTexture?ct.glyphAtlasTexture:null,wp=Te.LINEAR,hf=c.paint.get("text-halo-width").constantOr(1)!==0,xl=f.terrain&&Ge&&hi?i.bi(i.bz(),Xo):zl;if(hi&&wt.text){const bc=be.elevation,Wl=bc?bc.getAtTileOffsetFunc(It,be.center.lat,be.worldSize,wt.getProjection()):null,wc=Df(Bt,ct.tileID.canonical,Ge,Re,be,wt.getProjection(),Xt);cl(wt,Bt,f,!0,wc,Ko,Ge,ie,Wl,It)}return{program:Gi,buffers:wt.text,uniformValues:Bm,atlasTexture:nh,atlasTextureIcon:Dr,atlasInterpolation:wp,atlasInterpolationIcon:Bs,isSDF:!0,hasHalo:hf,depthMode:di,tile:ct,renderWithShadows:gi,labelPlaneMatrixInv:xl}},$i=wt.icon.segments.get().length,Vn=wt.text.segments.get().length,er=$i&&!E.onlyText?Vr():null,cr=Vn&&!E.onlyIcons?Pr():null,ai=c.paint.get("icon-opacity").constantOr(1),Ji=c.paint.get("text-opacity").constantOr(1);if(st&&wt.canOverlap){it=!0;const hi=ai&&!E.onlyText?wt.icon.segments.get():[],Lr=Ji&&!E.onlyIcons?wt.text.segments.get():[];for(const Fi of hi)Ye.push({segments:new i.bd([Fi]),sortKey:Fi.sortKey,state:er});for(const Fi of Lr)Ye.push({segments:new i.bd([Fi]),sortKey:Fi.sortKey,state:cr})}else E.onlyText||Ye.push({segments:ai?wt.icon.segments:new i.bd([]),sortKey:0,state:er}),E.onlyIcons||Ye.push({segments:Ji?wt.text.segments:new i.bd([]),sortKey:0,state:cr})}it&&Ye.sort((It,ct)=>It.sortKey-ct.sortKey);for(const It of Ye){const ct=It.state;if(ct)if(f.terrain?f.terrain.setupElevationDraw(ct.tile,ct.program,{useDepthForOcclusion:be.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ct.labelPlaneMatrixInv}):f.setupDepthForOcclusion(be.depthOcclusionForSymbolsAndCircles,ct.program),Ae.activeTexture.set(Te.TEXTURE0),ct.atlasTexture&&ct.atlasTexture.bind(ct.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),ct.atlasTextureIcon&&(Ae.activeTexture.set(Te.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),ct.renderWithShadows&&f.shadowRenderer.setupShadows(ct.tile.tileID.toUnwrapped(),ct.program,"vector-tile",ct.tile.tileID.overscaledZ),f.uploadCommonLightUniforms(f.context,ct.program),ct.hasHalo){const wt=ct.uniformValues;wt.u_is_halo=1,Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,wt,2),wt.u_is_halo=0}else{if(ct.isSDF){const wt=ct.uniformValues;ct.hasHalo&&(wt.u_is_halo=1,Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,wt,1)),wt.u_is_halo=0}Qc(ct.buffers,It.segments,c,f,ct.program,ct.depthMode,x,S,ct.uniformValues,1)}}}function Qc(f,r,c,p,x,S,E,M,R,z){const F=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,S,E,M,In.disabled,R,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),F,z)}function Gh(f,r){const c=1<<f.canonical.z,p=(r.x*c-f.canonical.x-f.wrap*c)*i.aj,x=(r.y*c-f.canonical.y)*i.aj,S=i.dS(r.z,r.y);return i.cS(p,x,S)}function Wd(f,r,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const S=f.context.gl,E=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),M=new Kt(f.context.gl.GREATER,Kt.ReadWrite,f.depthRangeFor3D),R=function(q){const ne=i.cJ(q.pitch);let J=.01;return q.isOrthographic&&(J=i.ai(1e-4,J,i.cN(ne>=Ms?1:ne/Ms))),2*J}(f.transform),z=f.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",G=f.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),$=f.getOrCreateProgram(F);for(const q of p){const ne=r.getTile(q),J=ne.getBucket(c);if(!J)continue;const ie=J.elevatedStructures;if(!ie)continue;const oe=J.elevationBufferData.heightRange,ce=Gh(q.toUnwrapped(),z),ge=f.translatePosMatrix(q.projMatrix,ne,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let xe,Ce,Ae,Te;if(x==="initialize"){if(!oe||oe.min>=1||ie.depthSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,R,1,0),Ce=E,Ae=ie.depthSegments,Te=G}else if(x==="reset"){if(!oe||oe.min>=0||ie.maskSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,0,0,1),Ce=M,Ae=ie.maskSegments,Te=G}else if(x==="geometry"){if(ie.depthSegments.segments[0].primitiveLength===0)continue;xe=Ho(ge,ce,R,1,0),Ce=E,Ae=ie.depthSegments,Te=$}Te.draw(f,S.TRIANGLES,Ce,Dn.disabled,ar.disabled,In.disabled,xe,c.id,ie.vertexBuffer,ie.indexBuffer,Ae,c.paint,f.transform.zoom)}}function eu(f,r,c){const{painter:p,sourceCache:x,layer:S,coords:E,colorMode:M,elevationType:R,terrainEnabled:z,pass:F}=f,G=p.context.gl,$=S.paint.get("fill-pattern"),q=S.paint.get("fill-pattern-cross-fade"),ne=$.constantOr(null);let J=R;R!=="road"||r&&!z||(J="none");const ie=J==="road",oe=f.painter.shadowRenderer,ce=ie&&!!oe&&oe.enabled,ge=new Kt(p.context.gl.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D);let xe=[0,0,0];if(ce){const Te=p.style.directionalLight,be=p.style.ambientLight;Te&&be&&(xe=ac(p.style,Te,be))}const Ce=$&&$.constantOr(1),Ae=(Te,be)=>{let Ie,Re,Be,Ge,st;be?(Ie=Ce&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=G.LINES):(Ie=Ce?"fillPattern":"fill",Be=G.TRIANGLES);for(const it of E){const mt=x.getTile(it);if(Ce&&!mt.patternsLoaded())continue;const Ue=mt.getBucket(S);if(!Ue)continue;const Je=r?Ue.elevationBufferData:Ue.bufferData;if(Je.isEmpty())continue;p.prepareDrawTile();const Le=Je.programConfigurations.get(S.id),lt=p.isTileAffectedByFog(it),Ye=[],pt=[];ie&&(Ye.push("ELEVATED_ROADS"),pt.push(Je.elevatedLayoutVertexBuffer)),ce&&Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ce&&(p.context.activeTexture.set(G.TEXTURE0),mt.imageAtlasTexture&&mt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Le.updatePaintBuffers());let It=!1;if(ne&&mt.imageAtlas){const Bt=mt.imageAtlas,Xt=i.dN.from(ne),hn=Xt.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),yn=Xt.getSecondary(),Ln=Bt.patternPositions.get(hn),Qn=yn?Bt.patternPositions.get(yn.scaleSelf(i.q.devicePixelRatio).toString()):null;It=!!Ln&&!!Qn,Ln&&Le.setConstantPatternPositions(Ln,Qn)}q>0&&(It||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&Ye.push("FILL_PATTERN_TRANSITION");const ct=p.getOrCreateProgram(Ie,{config:Le,overrideFog:lt,defines:Ye}),wt=p.translatePosMatrix(it.projMatrix,mt,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));ce&&oe.setupShadows(mt.tileID.toUnwrapped(),ct,"vector-tile",mt.tileID.overscaledZ);const Vt=S.paint.get("fill-emissive-strength");if(be){Ge=Je.lineIndexBuffer,st=Je.lineSegments;const Bt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[G.drawingBufferWidth,G.drawingBufferHeight];Re=Ie==="fillOutlinePattern"&&Ce?Yf(wt,Vt,p,mt,Bt,xe,q):Vh(wt,Vt,Bt,xe)}else Ge=Je.indexBuffer,st=Je.triangleSegments,Re=Ce?Bu(wt,Vt,p,mt,xe,q):la(wt,Vt,xe);p.uploadCommonUniforms(p.context,ct,it.toUnwrapped());let qt=Te;(R==="road"&&!z||R==="offset")&&(qt=ge),ct.draw(p,Be,qt,c||p.stencilModeForClipping(it),M,In.disabled,Re,S.id,Je.layoutVertexBuffer,Ge,st,S.paint,p.transform.zoom,Le,pt)}};p.renderPass===F&&Ae(p.depthModeForSublayer(1,p.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly),!1),J==="none"&&p.renderPass==="translucent"&&S.paint.get("fill-antialias")&&Ae(p.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly),!0)}function zs(f,r,c,p,x,S,E,M){c.resetLayerRenderingStats(f);const R=f.context,z=R.gl,F=f.transform,G=c.paint.get("fill-extrusion-pattern"),$=c.paint.get("fill-extrusion-pattern-cross-fade"),q=G.constantOr(null),ne=G.constantOr(1),J=c.paint.get("fill-extrusion-opacity"),ie=f.style.enable3dLights(),oe=c.paint.get(ie&&!ne?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],ge=c.layout.get("fill-extrusion-edge-radius"),xe=ge>0&&!c.paint.get("fill-extrusion-rounded-roof"),Ce=xe?0:ge,Ae=F.projection.name==="globe"?i.dV():0,Te=F.projection.name==="globe",be=Te?i.ah(F.zoom):0,Ie=[i.aD(F.center.lng),i.aH(F.center.lat)],Re=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Be=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Re?null:c.lut).toArray01().slice(0,3),Ge=c.paint.get("fill-extrusion-flood-light-intensity"),st=c.paint.get("fill-extrusion-vertical-scale"),it=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,mt=c.paint.get("fill-extrusion-height-alignment"),Ue=c.paint.get("fill-extrusion-base-alignment"),Je=sa(f,c.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let lt;Te&&Le.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Le.push("FAUX_AO"),xe&&Le.push("ZERO_ROOF_RADIUS"),M&&Le.push("HAS_CENTROID"),Ge>0&&Le.push("FLOOD_LIGHT"),Je.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),it&&Le.push("RENDER_WALL_MODE");const Ye=f.renderPass==="shadow",pt=f.shadowRenderer,It=Ye&&!!pt,ct=Ye?In.disabled:In.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let wt=[0,0,0];if(pt){const Bt=f.style.directionalLight,Xt=f.style.ambientLight;Bt&&Xt&&(wt=ac(f.style,Bt,Xt)),Ye||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),pt.useNormalOffset&&Le.push("NORMAL_OFFSET")),lt=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Vt=It?"fillExtrusionDepth":ne?"fillExtrusionPattern":"fillExtrusion",qt=c.getLayerRenderingStats();for(const Bt of p){const Xt=r.getTile(Bt),hn=Xt.getBucket(c);if(!hn||hn.projection.name!==F.projection.name)continue;let yn=!1;pt&&(yn=pt.getMaxCascadeForTile(Bt.toUnwrapped())===0);const Ln=f.isTileAffectedByFog(Bt),Qn=hn.programConfigurations.get(c.id);let br=!1;if(q&&Xt.imageAtlas){const cr=Xt.imageAtlas,ai=i.dN.from(q),Ji=ai.getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),hi=ai.getSecondary(),Lr=cr.patternPositions.get(Ji),Fi=hi?cr.patternPositions.get(hi.scaleSelf(i.q.devicePixelRatio).toString()):null;br=!!Lr&&!!Fi,Lr&&Qn.setConstantPatternPositions(Lr,Fi)}$>0&&(br||Qn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Le.push("FILL_EXTRUSION_PATTERN_TRANSITION");const oi=f.getOrCreateProgram(Vt,{config:Qn,defines:yn?lt:Le,overrideFog:Ln});if(f.terrain&&f.terrain.setupElevationDraw(Xt,oi,{useMeterToDem:!0}),!hn.centroidVertexBuffer){const cr=oi.attributes.a_centroid_pos;cr!==void 0&&z.vertexAttrib2f(cr,0,0)}!Ye&&pt&&pt.setupShadows(Xt.tileID.toUnwrapped(),oi,"vector-tile",Xt.tileID.overscaledZ),ne&&(f.context.activeTexture.set(z.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Qn.updatePaintBuffers());const Vr=c.paint.get("fill-extrusion-vertical-gradient"),Pr=1/hn.tileToMeter;let $i;if(Ye&&pt){if(Fl(Xt.tileID,hn,f))continue;const cr=pt.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());$i=Em(cr,Ce,Pr,st,mt,Ue)}else{const cr=f.translatePosMatrix(Bt.expandedProjMatrix,Xt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ai=F.projection.createInversionMatrix(F,Bt.canonical);$i=ne?Ng(cr,f,Vr,J,ce,Ce,Pr,Bt,Xt,Ae,mt,Ue,be,Ie,ai,Be,st,$):Fu(cr,f,Vr,J,ce,Ce,Pr,Bt,Ae,mt,Ue,be,Ie,ai,Be,st,Ge,wt)}f.uploadCommonUniforms(R,oi,Bt.toUnwrapped(),null,Je);let Vn=hn.segments;if(F.projection.name==="mercator"&&!Ye&&(Vn=hn.getVisibleSegments(Xt.tileID,f.terrain,f.transform.getFrustum(0)),!Vn.get().length))continue;if(qt)if(Ye)for(const cr of Vn.get())qt.numRenderedVerticesInShadowPass+=cr.primitiveLength;else for(const cr of Vn.get())qt.numRenderedVerticesInTransparentPass+=cr.primitiveLength;const er=[];(f.terrain||M)&&er.push(hn.centroidVertexBuffer),Te&&er.push(hn.layoutVertexExtBuffer),it&&er.push(hn.wallVertexBuffer),oi.draw(f,R.gl.TRIANGLES,x,S,E,ct,$i,c.id,hn.layoutVertexBuffer,hn.indexBuffer,Vn,c.paint,f.transform.zoom,Qn,er)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Go(f,r,c,p,x,S,E,M,R,z,F,G,$,q,ne,J,ie,oe,ce){const ge=f.context,xe=ge.gl,Ce=f.transform,Ae=f.transform.zoom,Te=[],be=sa(f,c.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(Te.push("CLEAR_SUBPASS"),ce&&(Te.push("CLEAR_FROM_TEXTURE"),ge.activeTexture.set(xe.TEXTURE0),ce.bind(xe.LINEAR,xe.CLAMP_TO_EDGE))):z==="sdf"&&Te.push("SDF_SUBPASS"),ie&&Te.push("HAS_CENTROID"),be.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const Ie=c.layout.get("fill-extrusion-edge-radius"),Re=(Be,Ge,st,it,mt)=>{const Ue=Ge.programConfigurations.get(c.id),Je=f.isTileAffectedByFog(Be),Le=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ue,defines:Te,overrideFog:Je}),lt=((pt,It,ct,wt,Vt,qt,Bt,Xt,hn,yn,Ln)=>({u_matrix:It,u_opacity:ct,u_ao_pass:wt?1:0,u_meter_to_tile:Vt,u_ao:qt,u_flood_light_intensity:Bt,u_flood_light_color:Xt,u_attenuation:hn,u_edge_radius:yn,u_fb:0,u_fb_size:Ln,u_dynamic_offset:1}))(0,it,F,R,mt,[G,$*mt],q,ne,J,Ae>=17?0:Ie*mt,ce?ce.size[0]:0),Ye=[];ie&&Ye.push(Ge.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ge,Le,Be.toUnwrapped(),null,be),Le.draw(f,ge.gl.TRIANGLES,x,S,E,M,lt,c.id,Ge.vertexBuffer,Ge.indexBuffer,st,c.paint,Ae,Ue,Ye)};for(const Be of p){const Ge=r.getTile(Be),st=Ge.getBucket(c);if(!st||st.projection.name!==Ce.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const it=st.groundEffect,mt=1/st.tileToMeter;{const Ue=f.translatePosMatrix(Be.projMatrix,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Je=it.getDefaultSegment();Re(Be,it,Je,Ue,mt)}if(oe)for(let Ue=0;Ue<4;Ue++){const Je=i.dT[Ue](Be),Le=r.getTile(Je);if(!Le)continue;const lt=Le.getBucket(c);if(!lt||lt.projection.name!==Ce.projection.name||!lt.groundEffect||lt.groundEffect&&!lt.groundEffect.hasData())continue;const Ye=lt.groundEffect;let pt,It;Ue===0?(pt=[-8192,0,0],It=1):Ue===1?(pt=[i.aj,0,0],It=0):Ue===2?(pt=[0,-8192,0],It=3):(pt=[0,i.aj,0],It=2);const ct=Ye.regionSegments[It];if(!ct)continue;const wt=new Float32Array(16);i.bo(wt,Be.projMatrix,pt),Re(Be,Ye,ct,f.translatePosMatrix(wt,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),mt)}}}function Zt(f,r,c,p,x,S,E){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const M=S?S.findDEMTileFor(c):null;if(!(M&&M.dem||E))return;S&&M&&M.dem&&p.selfDEMTileTimestamp!==M.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=M.dem._timestamp);const R=oe=>new i.P(Math.ceil((oe+i.dX)*i.dY),0),z=oe=>{const ce=r.getSource().minzoom,ge=Ce=>{const Ae=r.getTileByID(Ce);if(Ae&&Ae.hasData())return Ae.getBucket(x)},xe=[0,-1,1];for(const Ce of xe){if(oe.overscaledZ+Ce<ce)continue;const Ae=ge(oe.calculateScaledKey(oe.overscaledZ+Ce));if(Ae)return Ae}},F=[0,0,0],G=(oe,ce)=>(F[0]=Math.min(oe.min.y,ce.min.y),F[1]=Math.max(oe.max.y,ce.max.y),F[2]=i.aj-ce.min.x>oe.max.x?ce.min.x-i.aj:oe.max.x,F),$=(oe,ce)=>(F[0]=Math.min(oe.min.x,ce.min.x),F[1]=Math.max(oe.max.x,ce.max.x),F[2]=i.aj-ce.min.y>oe.max.y?ce.min.y-i.aj:oe.max.y,F),q=[(oe,ce)=>G(oe,ce),(oe,ce)=>G(ce,oe),(oe,ce)=>$(oe,ce),(oe,ce)=>$(ce,oe)],ne=(oe,ce,ge,xe,Ce,Ae,Te)=>{if(!S)return 0;const be=[[Ae?ge:oe,Ae?oe:ge,0],[Ae?ge:ce,Ae?ce:ge,0]],Ie=Te<0?i.aj+Te:Te,Re=[Ae?Ie:(oe+ce)/2,Ae?(oe+ce)/2:Ie,0];return ge===0&&Te<0||ge!==0&&Te>0?S.getForTilePoints(Ce,[Re],!0,xe):be.push(Re),S.getForTilePoints(c,be,!0,M),Math.max(be[0][2],be[1][2],Re[2])/S.exaggeration()};for(let oe=0;oe<4;oe++){const ce=p.borderFeatureIndices[oe];if(ce.length===0)continue;const ge=i.dT[oe](c),xe=z(ge);if(!(xe&&xe instanceof i.dU))continue;const Ce=S?S.findDEMTileFor(ge):null;if(!(Ce&&Ce.dem||E)||(S&&Ce&&Ce.dem&&p.borderDEMTileTimestamp[oe]!==Ce.dem._timestamp&&(p.borderDoneWithNeighborZ[oe]=-1,p.borderDEMTileTimestamp[oe]=Ce.dem._timestamp),p.borderDoneWithNeighborZ[oe]===xe.canonical.z))continue;xe.centroidVertexArray.length===0&&xe.createCentroidsBuffer();const Ae=(oe<2?1:5)-oe,Te=xe.borderDoneWithNeighborZ[Ae]!==p.canonical.z,be=xe.borderFeatureIndices[Ae];let Ie=0;if(p.canonical.z!==xe.canonical.z){for(const Re of ce)p.showCentroid(p.featuresOnBorder[Re]);if(Te)for(const Re of be)xe.showCentroid(xe.featuresOnBorder[Re]);p.borderDoneWithNeighborZ[oe]=xe.canonical.z,xe.borderDoneWithNeighborZ[Ae]=p.canonical.z}for(const Re of ce){const Be=p.featuresOnBorder[Re],Ge=p.centroidData[Be.centroidDataIndex],st=Be.borders[oe];let it;for(;Ie<be.length;){it=xe.featuresOnBorder[be[Ie]];const mt=it.borders[Ae];if(mt[1]>st[0]+3||mt[0]>st[0]-3)break;xe.showCentroid(it),Ie++}if(it&&Ie<be.length){const mt=Ie;let Ue=0;for(;!(it.borders[Ae][0]>st[1]-3)&&(Ue++,++Ie!==be.length);)it=xe.featuresOnBorder[be[Ie]];it=xe.featuresOnBorder[be[mt]];let Je=!1;if(Ue>=1){const Ye=it.borders[Ae];Math.abs(st[0]-Ye[0])<3&&Math.abs(st[1]-Ye[1])<3&&(Ue=1,Je=!0,Ie=mt+1)}else if(Ue===0){p.showCentroid(Be);continue}const Le=xe.centroidData[it.centroidDataIndex];E&&Je&&(((J=Ge).flags|(ie=Le).flags)&i.dW?(J.flags|=i.dW,ie.flags|=i.dW):(J.flags&=2147483647,ie.flags&=2147483647));const lt=Be.intersectsCount()>1||it.intersectsCount()>1;if(Ue>1)Ie=mt,Ge.centroidXY=Le.centroidXY=new i.P(0,0);else if(Ce&&Ce.dem&&!lt){const Ye=q[oe](Ge,Le),pt=oe%2?i.aj-1:0,It=ne(Ye[0],Math.min(i.aj-1,Ye[1]),pt,Ce,ge,oe<2,Ye[2]);Ge.centroidXY=Le.centroidXY=R(It)}else lt?Ge.centroidXY=Le.centroidXY=new i.P(0,0):(Ge.centroidXY=p.encodeBorderCentroid(Be),Le.centroidXY=xe.encodeBorderCentroid(it));p.writeCentroidToBuffer(Ge),xe.writeCentroidToBuffer(Le)}else p.showCentroid(Be)}p.borderDoneWithNeighborZ[oe]=xe.canonical.z,xe.borderDoneWithNeighborZ[Ae]=p.canonical.z}var J,ie;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Am=[1,0,0],jl=[0,1,0],qo=[0,0,1];function Fl(f,r,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const S=f.toUnwrapped(),E=p.tileSize*x._cascades[c.currentShadowCascade].scale;let M=r.maxHeight;if(p.elevation){const J=p.elevation.getMinMaxForTile(f);J&&(M+=J.max)}const R=[...x.shadowDirection];R[2]=-R[2];const z=x.computeSimplifiedTileShadowVolume(S,M,E,R);if(!z)return!1;const F=[Am,jl,qo,R,[R[0],0,R[2]],[0,R[1],R[2]]],G=p.projection.name==="globe",$=p.scaleZoom(E),q=i.cn.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,$,!G),ne=x.getCurrentCascadeFrustum();return q.intersectsPrecise(z.vertices,z.planes,F)===0||ne.intersectsPrecise(z.vertices,z.planes,F)===0}function vn(f){return[f[0]*i.dZ,f[1]*i.dZ,f[2]*i.dZ,0]}function Ra(f,r,c,p,x,S,E,M,R){const z=p.getSource(),F=c.globeSharedBuffers;if(!F)return;let G,$,q;if(r&&(G=p.getTile(r)),z instanceof i.aP?($=z.texture,q=i.ds(0,0,c.transform)):G&&r&&($=G.texture,q=i.ds(r.canonical.z,r.canonical.x,c.transform)),!$||!q)return;f||(q=i.cE(i.bz(),q,[1,-1,1]));const ne=c.context,J=ne.gl,ie=x.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,oe=c.colorModeForDrapableLayerRenderPass(S),ce=E.defines;ce.push("GLOBE_POLES");const ge=new Kt(J.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D),xe=Float32Array.from(c.transform.expandedFarZProjMatrix),Ce=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ne.activeTexture.set(J.TEXTURE0),$.bind(ie,J.CLAMP_TO_EDGE),ne.activeTexture.set(J.TEXTURE1),$.bind(ie,J.CLAMP_TO_EDGE),"useMipmap"in $&&ne.extTextureFilterAnisotropic&&c.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const[Ae,Te,be,Ie]=r?F.getPoleBuffers(r.canonical.z,!1):F.getPoleBuffers(0,!0),Re=x.paint.get("raster-elevation");let Be;f?(Be=Ae,c.renderDefaultNorthPole=Re!==0):(Be=Te,c.renderDefaultSouthPole=Re!==0);const Ge=vn(E.mix),st=((mt,Ue,Je,Le,lt,Ye,pt,It,ct,wt,Vt,qt,Bt)=>Ud(mt,Ue,Je,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],It,2,wt,Vt,qt,1,0,Bt))(xe,Ce,q,i.ah(c.transform.zoom),0,x,0,Re,0,Ge,E.offset,E.range,S),it=c.getOrCreateProgram("raster",{defines:ce});c.uploadCommonUniforms(ne,it,null),it.draw(c,J.TRIANGLES,ge,R,oe,M,st,x.id,Be,be,Ie)}function tu(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,x=.2*f.height,S=r+x;return[r,c,(S-x-r)/p,(S-r)/p]}function tp(f,r,c,p){if(f)return r instanceof kc&&f instanceof vu?r.getTextureDescriptor(f,c,!0):{texture:f.texture,mix:vn(p.mix),offset:p.offset,buffer:0,tileSize:1}}var np=i.d_([{name:"a_index",type:"Int16",components:1}]);class Zd{constructor(r,c,p,x){const S={width:p[0],height:p[1],data:null},E=r.gl;this.targetColorTexture=new i.T(r,S,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(r,S,E.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(r,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const S=new i.d$;S.reserve(x);for(let E=0;E<x;E++)S.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(S,np.members,!0),this.particleSegment=i.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Og(f,r,c){if(!f)return null;const p=r.getTextureDescriptor(f,c,!0);if(!p)return null;let{texture:x,mix:S,offset:E,tileSize:M,buffer:R,format:z}=p;if(!x||!z)return null;let F=!1;return z==="uint32"&&(F=!0,S[3]=0,S=Pa(i.e0,S,[0,c.paint.get("raster-particle-max-speed")]),E=Qf(i.e0,E,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[R/(M+2*R),M/(M+2*R)],tileSize:M,scalarData:F,scale:S,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function qh(f){const r=f._nearZ,c=f.projection.farthestPixelDistance(f),p=c-r,x=.2*f.height,S=r+x;return[r,c,(S-x-r)/p,(S-r)/p]}const Bl=new i.am(1,0,0,1),Xd=new i.am(0,1,0,1),oo=new i.am(0,0,1,1),dc=new i.am(1,0,1,1),ao=new i.am(0,1,1,1);function ua(f,r,c,p,x,S){for(let E=0;E<c.length;E++)if(x){const z=new i.am(p.r*.8,p.g*.8,p.b*.8,1);nu(f,r,c[E],p,-1,-1,S),nu(f,r,c[E],p,-1,1,S),nu(f,r,c[E],p,1,1,S),nu(f,r,c[E],p,1,-1,S),nu(f,r,c[E],z,0,0,S)}else nu(f,r,c[E],p,0,0,S)}function nu(f,r,c,p,x,S,E){const M=f.context,R=f.transform,z=M.gl,F=R.projection.name==="globe",G=F?["PROJECTION_GLOBE_VIEW"]:[];let $=i.bw(c.projMatrix);if(F&&i.ah(R.zoom)>0){const Ge=i.bg(c.canonical,R),st=i.e1(Ge);$=i.az(new Float32Array(16),R.globeMatrix,st),i.az($,R.projMatrix,$)}const q=i.bz();q[12]+=2*x/(i.q.devicePixelRatio*R.width),q[13]+=2*S/(i.q.devicePixelRatio*R.height),i.az($,q,$);const ne=f.getOrCreateProgram("debug",{defines:G}),J=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(J,ne);const ie=Kt.disabled,oe=Dn.disabled,ce=f.colorModeForRenderPass(),ge="$debug";M.activeTexture.set(z.TEXTURE0),f.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F?J._makeGlobeTileDebugBuffers(f.context,R):J._makeDebugTileBoundsBuffers(f.context,R.projection);const xe=J._tileDebugBuffer||f.debugBuffer,Ce=J._tileDebugIndexBuffer||f.debugIndexBuffer,Ae=J._tileDebugSegments||f.debugSegments;if(ne.draw(f,z.LINE_STRIP,ie,oe,ce,In.disabled,Ol($,p.toPremultipliedRenderColor(null)),ge,xe,Ce,Ae,null,null,null,[J._globeTileDebugBorderBuffer]),E){const Ge=J.latestRawTileData,st=Math.floor((Ge&&Ge.byteLength||0)/1024);let it=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(it+=` => ${c.overscaledZ}`),it+=` ${J.state}`,it+=` ${st}kb`,function(mt,Ue){mt.initDebugOverlayCanvas();const Je=mt.debugOverlayCanvas,Le=mt.context.gl,lt=mt.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,Je.width,Je.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(Ue,5,5),lt.strokeText(Ue,5,5),mt.debugOverlayTexture.update(Je),mt.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(f,it)}const Te=r.getTile(c).tileSize,be=512/Math.min(Te,512)*(c.overscaledZ/R.zoom)*.5,Ie=J._tileDebugTextBuffer||f.debugBuffer,Re=J._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Be=J._tileDebugTextSegments||f.debugSegments;ne.draw(f,z.TRIANGLES,ie,oe,ar.alphaBlended,In.disabled,Ol($,i.am.transparent.toPremultipliedRenderColor(null),be),ge,Ie,Re,Be,null,null,null,[J._globeTileDebugTextBuffer])}function Wh(f,r,c,p){fc(f,0,r+c/2,f.transform.width,c,p)}function rs(f,r,c,p){fc(f,r-c/2,0,c,f.transform.height,p)}function fc(f,r,c,p,x,S){const E=f.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*i.q.devicePixelRatio,c*i.q.devicePixelRatio,p*i.q.devicePixelRatio,x*i.q.devicePixelRatio),E.clear({color:S}),M.disable(M.SCISSOR_TEST)}const rp=i.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pl}=rp;function Hr(f,r,c,p){f.emplaceBack(r,c,p)}class Hu{constructor(r){this.vertexArray=new i.e2,this.indices=new i.a_,Hr(this.vertexArray,-1,-1,1),Hr(this.vertexArray,1,-1,1),Hr(this.vertexArray,-1,1,1),Hr(this.vertexArray,1,1,1),Hr(this.vertexArray,-1,-1,-1),Hr(this.vertexArray,1,-1,-1),Hr(this.vertexArray,-1,1,-1),Hr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,pl),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=i.bd.simpleSegment(0,0,36,12)}}function ha(f,r,c,p,x,S){const E=f.context.gl,M=r.paint.get("sky-atmosphere-color"),R=r.paint.get("sky-atmosphere-halo-color"),z=r.paint.get("sky-atmosphere-sun-intensity"),F=((G,$,q,ne,J)=>({u_matrix_3f:G,u_sun_direction:$,u_sun_intensity:q,u_color_tint_r:[ne.r,ne.g,ne.b,ne.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(i.e4(i.dx(),p),x,z,M.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+S,r.skyboxTexture,0),c.draw(f,E.TRIANGLES,Kt.disabled,Dn.disabled,ar.unblended,In.frontCW,F,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const fs=i.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class js{constructor(r){const c=new i.e5;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new i.a_;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,fs.members),this.indexBuffer=r.createIndexBuffer(p),this.segments=i.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ks=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ip{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Vl{constructor(r){this.colorModeAlphaBlendedWriteRGB=new ar([1,Cu,1,Cu],i.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ar([1,0,1,0],i.am.transparent,[!1,!1,!1,!0]),this.params=new ip,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const c=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new js(c);const p=this.params.sizeRange,x=this.params.intensityRange,S=function(F){const G=i.e7(30),$=[];for(let q=0;q<F;++q){const ne=2*Math.PI*G(),J=Math.acos(1-2*G())-.5*Math.PI;$.push(i.cS(Math.cos(J)*Math.cos(ne),Math.cos(J)*Math.sin(ne),Math.sin(J)))}return $}(this.params.starsCount),E=i.e7(300),M=new i.e6,R=new i.a_;let z=0;for(let F=0;F<S.length;++F){const G=i.bY([],S[F],200),$=Math.max(0,1+.01*p*(1*E()-.5)),q=Math.max(0,1+.01*x*(1*E()-.5));M.emplaceBack(G[0],G[1],G[2],-1,-1,$,q),M.emplaceBack(G[0],G[1],G[2],1,-1,$,q),M.emplaceBack(G[0],G[1],G[2],1,1,$,q),M.emplaceBack(G[0],G[1],G[2],-1,1,$,q),R.emplaceBack(z+0,z+1,z+2),R.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(M,Ks.members),this.starsIdx=c.createIndexBuffer(R),this.starsSegments=i.bd.simpleSegment(0,0,M.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,c){const p=r.context,x=p.gl,S=r.transform,E=new Kt(x.LEQUAL,Kt.ReadOnly,[0,1]),M=i.ah(S.zoom),R=r.style.getLut(c.scope),z=c.properties.get("color-use-theme")==="none",F=c.properties.get("color").toNonPremultipliedRenderColor(z?null:R).toArray01(),G=c.properties.get("high-color-use-theme")==="none",$=c.properties.get("high-color").toNonPremultipliedRenderColor(G?null:R).toArray01(),q=c.properties.get("space-color-use-theme")==="none",ne=c.properties.get("space-color").toNonPremultipliedRenderColor(q?null:R).toArray01(),J=5e-4,ie=i.e8(c.properties.get("horizon-blend"),0,1,J,.25),oe=i.dl(r,p,S)&&ie===J?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,ce=r.frameCounter/1e3%1,ge=i.ae(S.globeCenterInViewSpace),xe=Math.sqrt(Math.pow(ge,2)-Math.pow(oe,2)),Ce=Math.acos(xe/ge),Ae=Te=>{const be=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&be.push("ALPHA_PASS");const Ie=r.getOrCreateProgram("globeAtmosphere",{defines:be}),Re=((Ge,st,it,mt,Ue,Je,Le,lt,Ye,pt,It,ct)=>({u_frustum_tl:Ge,u_frustum_tr:st,u_frustum_br:it,u_frustum_bl:mt,u_horizon:Ue,u_transition:Je,u_fadeout_range:Le,u_color:lt,u_high_color:Ye,u_space_color:pt,u_temporal_offset:It,u_horizon_angle:ct}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,M,ie,F,$,ne,ce,Ce);r.uploadCommonUniforms(p,Ie);const Be=this.atmosphereBuffer;Be&&Ie.draw(r,x.TRIANGLES,E,Dn.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,In.backCW,Re,Te?"atmosphere_glow_alpha":"atmosphere_glow",Be.vertexBuffer,Be.indexBuffer,Be.segments)};Ae(!1),Ae(!0)}drawStars(r,c){const p=i.ay(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=r.context,S=x.gl,E=r.transform,M=r.getOrCreateProgram("stars"),R=i.b_([]);i.c0(R,R,-E._pitch),i.b$(R,R,-E.angle),i.c0(R,R,i.al(E._center.lat)),i.e9(R,R,-i.al(E._center.lng));const z=i.c3(new Float32Array(16),R),F=i.az([],E.starsProjMatrix,z),G=i.e4([],z),$=i.ea([],G),q=[0,1,0];i.dz(q,q,$),i.bY(q,q,this.params.sizeMultiplier);const ne=[1,0,0];i.dz(ne,ne,$),i.bY(ne,ne,this.params.sizeMultiplier);const J=(ie=q,oe=ne,ce=p,{u_matrix:Float32Array.from(F),u_up:ie,u_right:oe,u_intensity_multiplier:ce});var ie,oe,ce;r.uploadCommonUniforms(x,M),this.starsVx&&this.starsIdx&&M.draw(r,S.TRIANGLES,Kt.disabled,Dn.disabled,this.colorModeAlphaBlendedWriteRGB,In.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ml(f,r){const c=[...f],p=r.cameraWorldSizeForFog/r.worldSize,x=i.bx([]);return i.cE(x,x,[p,p,1]),i.az(c,x,c),i.az(c,r.worldToFogMatrix,c),c}function Tt(f,r,c,p,x){const S=c.material,E=p.context,{baseColorTexture:M,metallicRoughnessTexture:R}=S.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:F,emissionTexture:G}=S;function $(ne,J,ie){if(ne&&(f.push(J),E.activeTexture.set(E.gl.TEXTURE0+ie),ne.gfxTexture)){const{minFilter:oe,magFilter:ce,wrapS:ge,wrapT:xe}=ne.sampler;ne.gfxTexture.bindExtraParam(oe,ce,ge,xe)}}$(M,"HAS_TEXTURE_u_baseColorTexture",Io.BaseColor),$(R,"HAS_TEXTURE_u_metallicRoughnessTexture",Io.MetallicRoughness),$(z,"HAS_TEXTURE_u_normalTexture",Io.Normal),$(F,"HAS_TEXTURE_u_occlusionTexture",Io.Occlusion),$(G,"HAS_TEXTURE_u_emissionTexture",Io.Emission),x&&(x.texture||(x.texture=new i.eh(p.context,x.image,[x.image.height,x.image.height,x.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Io.LUT),x.texture&&x.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(c.texcoordBuffer)),c.colorBuffer&&(f.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(c.colorBuffer)),c.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(c.normalBuffer)),c.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(c.pbrBuffer)),S.alphaMode!=="OPAQUE"&&S.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||f.push("DIFFUSE_SHADED");const q=p.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function zt(f,r,c,p,x,S){const E=c.paint.get("model-opacity").constantOr(1),M=r.context,R=new Kt(r.context.gl.LEQUAL,Kt.ReadWrite,r.depthRangeFor3D),z=r.transform,F=f.mesh,G=F.material,$=G.pbrMetallicRoughness,q=r.style.fog;let ne;ne=r.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:i.az([],p.zScaleMatrix,f.nodeModelMatrix),i.az(ne,p.negCameraPosMatrix,ne);const J=i.bi([],ne);i.ee(J,J);const ie=c.paint.get("model-color-use-theme").constantOr("default")==="none",oe=c.paint.get("model-emissive-strength").constantOr(0),ce=Xc(new Float32Array(f.worldViewProjection),new Float32Array(ne),new Float32Array(J),null,r,E,$.baseColorFactor,G.emissiveFactor,$.metallicFactor,$.roughnessFactor,G,oe,c),ge={defines:[]},xe=[],Ce=r.shadowRenderer;Ce&&(Ce.useNormalOffset=!1),Tt(ge.defines,xe,F,r,ie?null:c.lut);let Ae=null;if(q){const Ie=ml(f.nodeModelMatrix,r.transform);if(Ae=new Float32Array(Ie),z.projection.name!=="globe"){const Re=F.aabb.min,Be=F.aabb.max,[Ge,st]=q.getOpacityForBounds(Ie,Re[0],Re[1],Be[0],Be[1]);ge.overrideFog=Ge>=Ze||st>=Ze}}const Te=sa(r,c.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&ge.defines.push("RENDER_CUTOFF");const be=r.getOrCreateProgram("model",ge);r.uploadCommonUniforms(M,be,null,Ae,Te),r.renderPass!=="shadow"&&Ce&&Ce.setupShadowsFromMatrix(f.nodeModelMatrix,be),be.draw(r,M.gl.TRIANGLES,R,x,S,F.material.doubleSided?In.disabled:In.backCCW,ce,c.id,F.vertexBuffer,F.indexBuffer,F.segments,c.paint,r.transform.zoom,void 0,xe)}function pc(f,r,c,p,x,S,E){let M;M=f.projection.name==="globe"?i.ed(c,f):[...c],i.az(M,M,r.matrix);const R=i.az([],p,M);if(r.meshes)for(const z of r.meshes){if(z.material.alphaMode!=="BLEND"){E.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:R,nodeModelMatrix:M});continue}const F=i.ad([],z.centroid,R);!f.isOrthographic&&F[2]<=0||S.push({mesh:z,depth:F[2],modelIndex:x,worldViewProjection:R,nodeModelMatrix:M})}if(r.children)for(const z of r.children)pc(f,z,c,p,x,S,E)}function Di(f,r,c,p){const x=c.shadowRenderer;if(!x)return;const S=x.getShadowPassDepthMode(),E=x.getShadowPassColorMode(),M=x.calculateShadowPassMatrixFromMatrix(r),R=Cm(M);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,S,Dn.disabled,E,In.backCCW,R,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,c.transform.zoom,void 0,void 0)}function $e(f,r,c){const p=r.updateZoomBasedPaintProperties(),x=function(S,E,M){let R,z,F,G=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&G>0){const $=S.terrain,q=$.findDEMTileFor(M);q&&q.dem?R=i.ei.create($,M,q):G=0}if(G===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),G===E.validForExaggeration&&(G===0||R&&R._demTile&&R._demTile.tileID===E.validForDEMTile.id&&R._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const $ in E.instancesPerModel){const q=E.instancesPerModel[$];for(let ne=0;ne<q.instancedDataArray.length;++ne){const J=(R?G*R.getElevationAt(0|q.instancedDataArray.float32[16*ne],0|q.instancedDataArray.float32[16*ne+1],!0,!0):0)+q.instancesEvaluatedElevation[ne];q.instancedDataArray.float32[16*ne+6]=J,z=z?Math.min(E.terrainElevationMin,J):J,F=F?Math.max(E.terrainElevationMax,J):J}}return E.terrainElevationMin=z||0,E.terrainElevationMax=F||0,E.validForExaggeration=G,E.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,r,c);(p||x)&&(r.uploaded=!1,r.upload(f.context))}const Fs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.cW([0,0,0],[i.aj,i.aj,0])};function Wo(f,r){const c=1<<f.canonical.z,p=r.getFreeCameraOptions().position,x=r.elevation,S=f.canonical.x/c,E=(f.canonical.x+1)/c,M=f.canonical.y/c,R=(f.canonical.y+1)/c;let z=r._centerAltitude;if(x){const q=x.getMinMaxForTile(f);q&&q.max>z&&(z=q.max)}const F=i.ay(p.x,S,E)-p.x,G=i.ay(p.y,M,R)-p.y,$=i.c6(z,r.center.lat)-p.z;return r._zoomFromMercatorZ(Math.sqrt(F*F+G*G+$*$))}function ru(f,r,c,p,x,S,E){const M=f.context,R=f.renderPass==="shadow",z=f.shadowRenderer,F=R&&z?z.getShadowPassDepthMode():new Kt(M.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),G=f.isTileAffectedByFog(S);if(c.meshes)for(const $ of c.meshes){const q=["MODEL_POSITION_ON_GPU"],ne=[];let J,ie,oe;p.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ce=sa(f,r.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),R&&z)J=f.getOrCreateProgram("modelDepth",{defines:q}),ie=Cm(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.matrix)),oe=z.getShadowPassColorMode();else{Tt(q,ne,$,f,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),J=f.getOrCreateProgram("model",{defines:q,overrideFog:G});const xe=$.material,Ce=xe.pbrMetallicRoughness,Ae=r.paint.get("model-opacity").constantOr(1),Te=r.paint.get("model-emissive-strength").constantOr(0);ie=Xc(S.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,f,Ae,Ce.baseColorFactor,xe.emissiveFactor,Ce.metallicFactor,Ce.roughnessFactor,xe,Te,r,x),z&&(E.shadowUniformsInitialized?J.setShadowUniformValues(M,z.getShadowUniformValues()):(z.setupShadows(S.toUnwrapped(),J,"model-tile",S.overscaledZ),E.shadowUniformsInitialized=!0)),oe=ce.shouldRenderCutoff||Ae<1||xe.alphaMode!=="OPAQUE"?ar.alphaBlended:ar.unblended}f.uploadCommonUniforms(M,J,S.toUnwrapped(),null,ce);const ge=$.material.doubleSided?In.disabled:In.backCCW;if(p.instancedDataArray.length>20)ne.push(p.instancedDataBuffer),J.draw(f,M.gl.TRIANGLES,F,Dn.disabled,oe,ge,ie,r.id,$.vertexBuffer,$.indexBuffer,$.segments,r.paint,f.transform.zoom,void 0,ne,p.instancedDataArray.length);else{const xe=R?"u_instance":"u_normal_matrix";for(let Ce=0;Ce<p.instancedDataArray.length;++Ce)ie[xe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ce,16),J.draw(f,M.gl.TRIANGLES,F,Dn.disabled,oe,ge,ie,r.id,$.vertexBuffer,$.indexBuffer,$.segments,r.paint,f.transform.zoom,void 0,ne)}}if(c.children)for(const $ of c.children)ru(f,r,$,p,x,S,E)}const Kd=[1,-1,1];function sp(f,r,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const S=c.shadowRenderer,E=r.aabb;let M=!0,R=f.maxHeight;if(R===0){let F=0;for(const G in f.instancesPerModel){const $=x.getModel(G,p);$?F=Math.max(F,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):M=!1}R=f.maxScale*F*1.41+f.maxVerticalOffset,M&&(f.maxHeight=R)}E.max[2]=R,E.min[2]+=f.terrainElevationMin,E.max[2]+=f.terrainElevationMax,i.ad(E.min,E.min,r.tileMatrix),i.ad(E.max,E.max,r.tileMatrix);const z=E.intersects(S.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=z===2),z===0}function Im(f,r){const c=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],x=f.uniformValues.u_cutoff_params[2],S=f.uniformValues.u_cutoff_params[3];return p===c||S===x?1:i.ay(((r-c)/(p-c)-x)/(S-x),0,1)}function Gu(f,r,c,p){if(r.pitch<20)return 1;const x=r.getWorldToCameraMatrix();i.az(x,x,f);const S=i.ej(c.min[0],c.min[1],c.min[2],1);let E=i.aA(i.ek(),S,x),M=E,R=E;S[1]=c.max[1],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R,S[0]=c.max[0],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R,S[1]=c.min[1],E=i.aA(i.ek(),S,x),M=E[1]<M[1]?E:M,R=E[1]>R[1]?E:R;const z=i.ay(p[0],0,1),F=100*r.pixelsPerMeter*i.ay(p[1],0,1),G=i.ay(p[2],0,1),$=i.el(i.ek(),M,R,z),q=Math.tan(.5*r.fovX),ne=-$[2]*q;if(F===0)return $[1]<-Math.abs(ne)?G:1;const J=(-Math.abs(ne)-$[1])/F,ie=(ce,ge,xe)=>(1-xe)*ce+xe*ge,oe=i.ay(ie(1,G,J),G,1);return ie(1,oe,i.ay((r.pitch-20)/20,0,1))}class Lg{}class zg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,c,p){{const G=this._storage.get(c.id);if(G)return G.lastUsedFrameIdx=r,G.buf}const x=p.gl,S=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),E=new ArrayBuffer(S),M=new Int16Array(E);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const R=new i.en;for(let G=0;G<S/2;G+=3){const $=M[G],q=M[G+1],ne=M[G+2];R.emplaceBack($,q),R.emplaceBack(q,ne),R.emplaceBack(ne,$)}const z=p.bindVertexArrayOES.current,F=new Lg;return F.buf=new ca(p,R),F.lastUsedFrameIdx=r,this._storage.set(c.id,F),p.bindVertexArrayOES.set(z),F.buf}update(r){for(const[c,p]of this._storage)r-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[r,c]of this._storage)c.buf.destroy(),this._storage.delete(r)}}class Mm{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Yd=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class op{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ap{constructor(r,c){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Zh=i.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Jd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,c){const p=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const E=new i.eo,M=new i.a_;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(1,1),E.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(E,Zh.members),this.vignetteIdx=r.context.createIndexBuffer(M)}const x=i.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,p);const E={u_vignetteShape:(S={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:S.vignetteColor};p.draw(r,r.context.gl.TRIANGLES,Kt.disabled,Dn.disabled,ar.alphaBlended,In.disabled,E,"vignette",this.vignetteVx,this.vignetteIdx,x)}var S}}class iu{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,c){const p=r.getFreeCameraOptions().position,x=p.toAltitude(),S=p.toLngLat(),E=i.al(S.lng),M=i.al(S.lat),R=r.pixelsPerMeter/c,z=E*i.eq,F=i.eq*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const G=-this._offsetYPrev+F,$=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*R,this._accumulatedOffsetY+=G*R,this._accumulatedElevation+=$*R,this._offsetXPrev=z,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Ul(f,r){return[-(f[0]-Math.floor(f[0]/r)*r),-(f[1]-Math.floor(f[1]/r)*r),-(f[2]-Math.floor(f[2]/r)*r)]}function lp(f){const r=i.e7(1323123451230),c=[];for(let p=0;p<f;++p){const x=2*r()-1,S=2*r()-1,E=2*r()-1;c.push(i.cS(x,S,E))}return c}function $l(f,r,c,p,x){const S=i.ay((x-c)/(p-c),0,1);return(1-S)*f+S*r}class lo{constructor(r){this._movement=new iu,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Jd,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,c){const p=r.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,S=i.b_([]);i.c0(S,S,i.al(90)-p._pitch),i.b$(S,S,-p.angle);const E=i.c3(new Float32Array(16),S),M=i.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=i.ee([],M),z=i.az([],R,E),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*c,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:z}}}class jg extends lo{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ap(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=lp(this.particlesCount),x=new i.er,S=new i.a_;let E=0;const M=i.e7(1323123451230);for(let R=0;R<p.length;++R){const z=p[R],F=[2*M()-1,M(),M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,1,...F),x.emplaceBack(z[0],z[1],z[2],-1,1,...F),S.emplaceBack(E+0,E+1,E+2),S.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,Yd.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=r.transform.zoom;if(c.revealStart>p)return;const x=$l(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const S=structuredClone(this._params);let E=[-S.direction.x,S.direction.y,-100];i.au(E,E);const M=structuredClone(this._vignetteParams);M.strength*=x,S.overrideStyleParameters||(S.intensity=r.style.rain.state.density,S.timeFactor=r.style.rain.state.intensity,S.color=structuredClone(r.style.rain.state.color),E=structuredClone(r.style.rain.state.direction),S.screenThinning.intensity=r.style.rain.state.centerThinning,S.dropletSizeX=r.style.rain.state.dropletSize[0],S.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],S.distortionStrength=100*r.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(r.style.rain.state.vignetteColor));const R=this.updateOnRender(r,S.timeFactor),z=r.context,F=z.gl,G=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new i.T(z,{width:r.width,height:r.height,data:null},F.RGBA8)),S.distortionStrength>0&&(z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const $=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(z,$),z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const q=[S.color.r,S.color.g,S.color.b,S.color.a],ne=(J,ie)=>{const oe=Ul(this._movement.getPosition(),J),ce=S.dropletSizeX,ge=S.dropletSizeX*S.dropletSizeYScale,xe=r.width/2,Ce=r.height/2,Ae=$l(0,S.screenThinning.start,0,1,S.screenThinning.intensity),Te=$l(.001,S.screenThinning.range,0,1,S.screenThinning.intensity),be=$l(0,S.screenThinning.particleOffset,0,1,S.screenThinning.intensity),Ie=(Re={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:oe,velocityConeAperture:S.velocityConeAperture,velocity:S.velocity,boxSize:J,rainDropletSize:[ce,ge],distortionStrength:S.distortionStrength,rainDirection:E,color:q,screenSize:[G.width,G.height],thinningCenterPos:[xe,Ce],thinningShape:[Ae,Te,Math.pow(10,S.screenThinning.fadePower)],thinningAffectedRatio:S.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:S.shapeDirPower,shapeNormalPower:S.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;const Be=Math.round(S.intensity*this.particlesCount),Ge=i.bd.simpleSegment(0,0,4*Be,2*Be);$.draw(r,F.TRIANGLES,Kt.disabled,Dn.disabled,ar.alphaBlended,In.disabled,Ie,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};S.distortionStrength>0&&ne(S.boxSize,!0),ne(S.boxSize,!1),this._vignette.draw(r,M)}}const Xh=i.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class mi extends lo{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ap(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const p=lp(this.particlesCount),x=new i.es,S=new i.a_;let E=0;const M=i.e7(1323123451230);for(let R=0;R<p.length;++R){const z=p[R],F=M(),G=M(),$=M(),q=[R/p.length,F,G,$],ne=[M(),M()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...q,...ne),x.emplaceBack(z[0],z[1],z[2],1,-1,...q,...ne),x.emplaceBack(z[0],z[1],z[2],1,1,...q,...ne),x.emplaceBack(z[0],z[1],z[2],-1,1,...q,...ne),S.emplaceBack(E+0,E+1,E+2),S.emplaceBack(E+0,E+2,E+3),E+=4}this.particlesVx=c.createVertexBuffer(x,Xh.members),this.particlesIdx=c.createIndexBuffer(S)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];i.au(p,p);const x=structuredClone(this._vignetteParams),S=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},E=r.transform.zoom;if(S.revealStart>E)return;const M=$l(0,1,S.revealStart,S.revealStart+S.revealRange,E);x.strength*=M,c.overrideStyleParameters||(c.intensity=r.style.snow.state.density,c.timeFactor=r.style.snow.state.intensity,c.color=structuredClone(r.style.snow.state.color),p=structuredClone(r.style.snow.state.direction),c.screenThinning.intensity=r.style.snow.state.centerThinning,c.billboardSize=2.79*r.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(r.style.snow.state.vignetteColor));const R=this.updateOnRender(r,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=r.context,F=z.gl,G=r.transform,$=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(z,$),((q,ne,J)=>{const ie=Ul(this._movement.getPosition(),q),oe=G.width/2,ce=G.height/2,ge=$l(0,J.screenThinning.start,0,1,J.screenThinning.intensity),xe=$l(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),Ce=$l(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),Ae=(Te={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:q,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[G.width,G.height],thinningCenterPos:[oe,ce],thinningShape:[ge,xe,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:Ce,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:p},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const be=Math.round(J.intensity*this.particlesCount),Ie=i.bd.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&$.draw(r,F.TRIANGLES,Kt.disabled,Dn.disabled,ar.alphaBlended,In.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ie)})(c.boxSize,0,c),this._vignette.draw(r,x)}}const Tr={symbol:function(f,r,c,p,x){if(f.renderPass!=="translucent")return;const S=Dn.disabled,E=f.colorModeForRenderPass(),M=c.layout.get("text-variable-anchor"),R=c.layout.get("text-size-scale-range"),z=i.ay(f.scaleFactor,R[0],R[1]);M&&function($,q,ne,J,ie,oe,ce,ge){const xe=q.transform,Ce=ie==="map",Ae=oe==="map";for(const Te of $){const be=J.getTile(Te),Ie=be.getBucket(ne);if(!Ie||!Ie.text||!Ie.text.segments.get().length)continue;const Re=i.bH(Ie.textSizeData,xe.zoom,ge),Be=Sh(Te,Ie.getProjection(),xe),Ge=xe.calculatePixelsToTileUnitsMatrix(be),st=tc(Be,be.tileID.canonical,Ae,Ce,xe,Ie.getProjection(),Ge),it=Ie.hasIconTextFit()&&Ie.hasIconData();Re&&$u(Ie,Ce,Ae,ce,xe,st,Te,Math.pow(2,xe.zoom-be.tileID.overscaledZ),Re,it)}}(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,z);const F=c.paint.get("icon-opacity").constantOr(1)!==0,G=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||G)?Jc(f,r,c,p,S,E):(F&&Jc(f,r,c,p,S,E,{onlyIcons:!0}),G&&Jc(f,r,c,p,S,E,{onlyText:!0})),r.map.showCollisionBoxes&&(hc(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),hc(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),S=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0,R=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(S.constantOr(1)===0||E.constantOr(1)===0))return;const z=f.context,F=z.gl,G=f.transform,$=!(!f.terrain||!f.terrain.enabled),q=c.layout.get("circle-elevation-reference"),ne=f.depthModeForSublayer(0,Kt.ReadOnly),J=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),ie=q==="none"||$?ne:J,oe=Dn.disabled,ce=f.colorModeForDrapableLayerRenderPass(R),ge=G.projection.name==="globe",xe=[i.aD(G.center.lng),i.aH(G.center.lat)],Ce=[];for(let Te=0;Te<p.length;Te++){const be=p[Te],Ie=r.getTile(be),Re=Ie.getBucket(c);if(!Re||Re.projection.name!==G.projection.name)continue;const Be=Re.programConfigurations.get(c.id),Ge=Re.layoutVertexBuffer,st=Re.globeExtVertexBuffer,it=Re.indexBuffer,mt=i.dK(c),Ue=[st],Je=f.isTileAffectedByFog(be);ge&&mt.push("PROJECTION_GLOBE_VIEW"),mt.push("DEPTH_D24"),f.terrain&&G.depthOcclusionForSymbolsAndCircles&&mt.push("DEPTH_OCCLUSION"),Re.hasElevation&&(mt.push("ELEVATED_ROADS"),Ue.push(Re.elevatedLayoutVertexBuffer));const Le=f.getOrCreateProgram("circle",{config:Be,defines:mt,overrideFog:Je}),lt=G.projection.createInversionMatrix(G,be.canonical),Ye={programConfiguration:Be,program:Le,layoutVertexBuffer:Ge,dynamicBuffers:Ue,indexBuffer:it,uniformValues:i.dL(f,be,Ie,lt,xe,c),tile:Ie};if(M){const pt=Re.segments.get();for(const It of pt)Ce.push({segments:new i.bd([It]),sortKey:It.sortKey,state:Ye})}else Ce.push({segments:Re.segments,sortKey:0,state:Ye})}M&&Ce.sort((Te,be)=>Te.sortKey-be.sortKey);const Ae={useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles};for(const Te of Ce){const{programConfiguration:be,program:Ie,layoutVertexBuffer:Re,dynamicBuffers:Be,indexBuffer:Ge,uniformValues:st,tile:it}=Te.state,mt=Te.segments;f.terrain&&f.terrain.setupElevationDraw(it,Ie,Ae),f.uploadCommonUniforms(z,Ie,it.tileID.toUnwrapped()),Ie.draw(f,F.TRIANGLES,ie,oe,ce,In.disabled,st,c.id,Re,Ge,mt,c.paint,G.zoom,be,Be)}},heatmap:function(f,r,c,p){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,S=x.gl,E=Dn.disabled,M=new ar([S.ONE,S.ONE,S.ONE,S.ONE],i.am.transparent,[!0,!0,!0,!0]);(function(q,ne,J,ie){const oe=q.gl,ce=ne.width*ie,ge=ne.height*ie;q.activeTexture.set(oe.TEXTURE1),q.viewport.set([0,0,ce,ge]);let xe=J.heatmapFbo;if(!xe||xe&&(xe.width!==ce||xe.height!==ge)){xe&&xe.destroy();const Ce=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,Ce),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),xe=J.heatmapFbo=q.createFramebuffer(ce,ge,!0,null),function(Ae,Te,be,Ie,Re,Be){const Ge=Ae.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Re,Be,0,Ge.RGBA,Ae.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Ie.colorAttachment.set(be)}(q,0,Ce,xe,ce,ge)}else oe.bindTexture(oe.TEXTURE_2D,xe.colorAttachment.get()),q.bindFramebuffer.set(xe.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:i.am.transparent});const R=f.transform,z=R.projection.name==="globe",F=z?["PROJECTION_GLOBE_VIEW"]:[],G=z?In.frontCCW:In.disabled,$=[i.aD(R.center.lng),i.aH(R.center.lat)];for(let q=0;q<p.length;q++){const ne=p[q];if(r.hasRenderableParent(ne))continue;const J=r.getTile(ne),ie=J.getBucket(c);if(!ie||ie.projection.name!==R.projection.name)continue;const oe=f.isTileAffectedByFog(ne),ce=ie.programConfigurations.get(c.id),ge=f.getOrCreateProgram("heatmap",{config:ce,defines:F,overrideFog:oe}),{zoom:xe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(J,ge),f.uploadCommonUniforms(x,ge,ne.toUnwrapped());const Ce=R.projection.createInversionMatrix(R,ne.canonical);ge.draw(f,S.TRIANGLES,Kt.disabled,E,M,G,Ll(f,ne,J,Ce,$,xe,c.paint.get("heatmap-intensity")),c.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,c.paint,f.transform.zoom,ce,z?[ie.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,S){const E=x.context,M=E.gl,R=S.heatmapFbo;if(!R)return;E.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment.get()),E.activeTexture.set(M.TEXTURE1);let z=S.colorRampTexture;z||(z=S.colorRampTexture=new i.T(E,S.colorRamp,M.RGBA8)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,M.TRIANGLES,Kt.disabled,Dn.disabled,x.colorModeForRenderPass(),In.disabled,((F,G,$,q)=>({u_image:0,u_color_ramp:1,u_opacity:G.paint.get("heatmap-opacity")}))(0,S),S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(f,c))},line:function(f,r,c,p){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),S=c.paint.get("line-width");if(x.constantOr(1)===0||S.constantOr(1)===0)return;const E=c.paint.get("line-emissive-strength"),M=c.paint.get("line-occlusion-opacity"),R=c.layout.get("line-elevation-reference"),z=c.layout.get("line-width-unit")==="meters",F=R==="sea",G=!(!f.terrain||!f.terrain.enabled),$=f.context,q=$.gl;if(c.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const ne=c.layout.get("line-cross-slope"),J=ne!==void 0,ie=ne<1,oe=f.colorModeForDrapableLayerRenderPass(E),ce=f.terrain&&f.terrain.renderingToTexture,ge=ce?1:i.q.devicePixelRatio,xe=c.paint.get("line-dasharray"),Ce=xe.constantOr(1),Ae=c.layout.get("line-cap"),Te=xe.constantOr(null),be=Ae.constantOr(null),Ie=c.paint.get("line-pattern"),Re=Ie.constantOr(1),Be=c.paint.get("line-pattern-cross-fade"),Ge=Ie.constantOr(null),st=c.paint.get("line-opacity").constantOr(1);let it=!Re&&st!==1||f.depthOcclusion&&M>0&&M<1;const mt=c.paint.get("line-gradient"),Ue=Re?"linePattern":"line",Je=i.dM(c);let Le;if(ce&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(it=!1),M!==0&&f.depthOcclusion){const It=c.paint._values["line-opacity"];It&&It.value&&It.value.kind==="constant"?Le=It.value:i.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}S.value.kind!=="constant"&&S.value.isLineProgressConstant===!1&&Je.push("VARIABLE_LINE_WIDTH");const lt=(It,ct,wt,Vt,qt,Bt)=>{for(const Xt of It){const hn=r.getTile(Xt);if(Re&&!hn.patternsLoaded())continue;const yn=hn.getBucket(c);if(!yn||yn.elevationType!=="none"&&!qt||yn.elevationType==="none"&&qt)continue;f.prepareDrawTile();const Ln=[...ct],Qn=f.shadowRenderer,br=yn.elevationType==="road"&&!!Qn&&Qn.enabled;let oi=[0,0,0];if(br){const vr=f.style.directionalLight,Bi=f.style.ambientLight;vr&&Bi&&(oi=ac(f.style,vr,Bi)),Ln.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Vr=yn.programConfigurations.get(c.id);let Pr=!1;if(Ge&&hn.imageAtlas){const vr=i.dN.from(Ge),Bi=vr.getPrimary().scaleSelf(ge).toString(),gi=hn.imageAtlas.patternPositions.get(Bi),Gr=vr.getSecondary(),di=Gr?hn.imageAtlas.patternPositions.get(Gr.scaleSelf(ge).toString()):null;Pr=!!gi&&!!di,gi&&Vr.setConstantPatternPositions(gi,di)}Be>0&&(Pr||Vr.getPatternTransitionVertexBuffer("line-pattern"))&&Ln.push("LINE_PATTERN_TRANSITION");const $i=f.isTileAffectedByFog(Xt),Vn=f.getOrCreateProgram(Ue,{config:Vr,defines:Ln,overrideFog:$i,overrideRtt:!qt&&void 0});if(!Re&&Te&&be&&hn.lineAtlas){const vr=hn.lineAtlas.getDash(Te,be);vr&&Vr.setConstantPatternPositions(vr)}br&&Qn.setupShadows(hn.tileID.toUnwrapped(),Vn,"vector-tile",hn.tileID.overscaledZ);let[er,cr]=c.paint.get("line-trim-offset");(be==="round"||be==="square")&&er!==cr&&(er===0&&(er-=1),cr===1&&(cr+=1));const ai=ce?Xt.projMatrix:null,Ji=z?1/yn.tileToMeter/i.aw(hn,1,f.transform.zoom):1,hi=z?1/yn.tileToMeter/i.aw(hn,1,Math.floor(f.transform.zoom)):1,Lr=Re?i.dO(f,hn,c,ai,ge,Ji,hi,[er,cr],oi,Be):i.dP(f,hn,c,ai,yn.lineClipsArray.length,ge,Ji,hi,[er,cr],oi);if(mt){const vr=yn.gradients[c.id];let Bi=vr.texture;if(c.gradientVersion!==vr.version){let gi=256;if(c.stepInterpolant){const Gr=r.getSource().maxzoom,di=Xt.canonical.z===Gr?Math.ceil(1<<f.transform.maxZoom-Xt.canonical.z):1;gi=i.ay(i.dQ(yn.maxLineLength/i.aj*1024*di),256,$.maxTextureSize)}vr.gradient=i.dR({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:vr.gradient||void 0,clips:yn.lineClipsArray}),vr.texture?vr.texture.update(vr.gradient):vr.texture=new i.T($,vr.gradient,q.RGBA8),vr.version=c.gradientVersion,Bi=vr.texture}$.activeTexture.set(q.TEXTURE1),Bi.bind(c.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Ce&&($.activeTexture.set(q.TEXTURE0),hn.lineAtlasTexture&&hn.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Vr.updatePaintBuffers()),Re&&($.activeTexture.set(q.TEXTURE0),hn.imageAtlasTexture&&hn.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Vr.updatePaintBuffers()),qt&&!F&&f.terrain.setupElevationDraw(hn,Vn),f.uploadCommonUniforms($,Vn,Xt.toUnwrapped());const Fi=vr=>{Le!=null&&(Le.value=st*M),Vn.draw(f,q.TRIANGLES,wt,vr,oe,In.disabled,Lr,c.id,yn.layoutVertexBuffer,yn.indexBuffer,yn.segments,c.paint,f.transform.zoom,Vr,[yn.layoutVertexBuffer2,yn.patternVertexBuffer,yn.zOffsetVertexBuffer]),Le!=null&&(Le.value=st)};if(it&&!qt){const vr=f.stencilModeForClipping(Xt).ref;vr===0&&ce&&$.clear({stencil:0});const Bi={func:q.EQUAL,mask:255};Lr.u_alpha_discard_threshold=.8,Fi(new Dn(Bi,vr,255,q.KEEP,q.KEEP,q.INVERT)),Lr.u_alpha_discard_threshold=0,Fi(new Dn(Bi,vr,255,q.KEEP,q.KEEP,q.KEEP))}else Lr.u_alpha_discard_threshold=it&&qt&&Bt?.8:0,Fi(qt?Vt:f.stencilModeForClipping(Xt))}};let Ye=f.depthModeForSublayer(0,Kt.ReadOnly);const pt=new Kt(f.depthOcclusion?q.GREATER:q.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);if(c.hasNonElevatedBuckets){const It=!ce&&f.terrain;M!==0&&It?i.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):It?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):lt(p,Je,Ye,Dn.disabled,!1,!0)}if(c.hasElevatedBuckets){R==="hd-road-markup"?G||(Ye=pt,Je.push("ELEVATED_ROADS")):(Je.push("ELEVATED"),Ye=pt,J&&Je.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Je.push("ELEVATION_REFERENCE_SEA"));const It=it?f.stencilModeFor3D():Dn.disabled;f.forceTerrainMode=!0,lt(p,Je,Ye,It,!0,!0),it&&lt(p,Je,Ye,It,!0,!1),f.forceTerrainMode=!1}it&&(f.resetStencilClippingMasks(),ce&&$.clear({stencil:0})),M===0||f.depthOcclusion||ce||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,r,c,p){const x=c.paint.get("fill-color"),S=c.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const E=c.paint.get("fill-emissive-strength"),M=f.colorModeForDrapableLayerRenderPass(E),R=c.paint.get("fill-pattern"),z=f.opaquePassEnabledForLayer()&&!R.constantOr(1)&&x.constantOr(i.am.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";let F="none";c.layout.get("fill-elevation-reference")!=="none"?F="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const G=!(!f.terrain||!f.terrain.enabled),$={painter:f,sourceCache:r,layer:c,coords:p,colorMode:M,elevationType:F,terrainEnabled:G,pass:z};if(f.renderPass!=="shadow")if(F!=="offset"){if(eu($,!1),F==="road"){const q=!G&&f.renderPass==="translucent";q&&Wd(f,r,c,p,"geometry"),eu($,!0,Dn.disabled),q&&function(ne){const{painter:J,sourceCache:ie,layer:oe,coords:ce,colorMode:ge}=ne,xe=J.context.gl,Ce=ne.painter.shadowRenderer,Ae=!!Ce&&Ce.enabled,Te=new Kt(J.context.gl.LEQUAL,Kt.ReadOnly,J.depthRangeFor3D);let be=[0,0,0];if(Ae){const Re=J.style.directionalLight,Be=J.style.ambientLight;Re&&Be&&(be=ac(J.style,Re,Be))}const Ie=Re=>{for(const Be of ce){const Ge=ie.getTile(Be),st=Ge.getBucket(oe);if(!st)continue;const it=st.elevatedStructures;if(!it)continue;let mt,Ue;if(Re?(mt=it.renderableBridgeSegments,Ue=it.bridgeProgramConfigurations.get(oe.id)):(mt=it.renderableTunnelSegments,Ue=it.tunnelProgramConfigurations.get(oe.id)),!mt||mt.segments[0].primitiveLength===0)continue;Ue.updatePaintBuffers(),J.prepareDrawTile();const Je=J.isTileAffectedByFog(Be),Le=[];Ae&&Le.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const lt=J.getOrCreateProgram("elevatedStructures",{config:Ue,overrideFog:Je,defines:Le}),Ye=J.translatePosMatrix(Be.projMatrix,Ge,oe.paint.get("fill-translate"),oe.paint.get("fill-translate-anchor"));Ae&&Ce.setupShadows(Ge.tileID.toUnwrapped(),lt,"vector-tile",Ge.tileID.overscaledZ);const pt=Jf(Ye,be);J.uploadCommonUniforms(J.context,lt,Be.toUnwrapped()),lt.draw(J,xe.TRIANGLES,Te,Dn.disabled,ge,In.backCCW,pt,oe.id,it.vertexBuffer,it.indexBuffer,mt,oe.paint,J.transform.zoom,Ue,[it.vertexBufferNormal])}};Ie(!0),Ie(!1)}($)}}else eu($,!1,f.stencilModeFor3D());else f.shadowRenderer&&F==="road"&&!G&&function(q){const{painter:ne,sourceCache:J,layer:ie,coords:oe}=q,ce=ne.context.gl,ge=q.painter.shadowRenderer;for(const xe of oe){const Ce=J.getTile(xe),Ae=Ce.getBucket(ie);if(!Ae)continue;const Te=Ae.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;ne.prepareDrawTile();const be=Ae.bufferData.programConfigurations.get(ie.id),Ie=ne.isTileAffectedByFog(xe),Re=ne.getOrCreateProgram("elevatedStructuresDepth",{config:be,overrideFog:Ie}),Be=ge.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());ne.uploadCommonUniforms(ne.context,Re,xe.toUnwrapped());const Ge={u_matrix:Be,u_depth_bias:.001};Re.draw(ne,ce.TRIANGLES,ge.getShadowPassDepthMode(),Dn.disabled,ge.getShadowPassColorMode(),In.disabled,Ge,ie.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,ie.paint,ne.transform.zoom,be)}}($)},"fill-extrusion":function(f,r,c,p){const x=c.paint.get("fill-extrusion-opacity"),S=f.context,E=S.gl,M=f.terrain,R=M&&M.renderingToTexture;if(x===0)return;const z=f.conflationActive&&f.style.isLayerClipped(c,r.getSource()),F=f.style.order.indexOf(c.fqid);if(z&&function(G,$,q,ne,J){for(const ie of ne){const oe=$.getTile(ie).getBucket(q);oe&&(oe.updateReplacement(ie,G.replacementSource,J),oe.uploadCentroid(G.context))}}(f,r,c,p,F),M||z)for(const G of p){const $=r.getTile(G).getBucket(c);$&&Zt(f.context,r,G,$,c,M,z)}if(f.renderPass==="shadow"&&f.shadowRenderer){const G=f.shadowRenderer;if(M&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const $=G.getShadowPassDepthMode(),q=G.getShadowPassColorMode();zs(f,r,c,p,$,Dn.disabled,q,z)}else if(f.renderPass==="translucent"){const G=!c.paint.get("fill-extrusion-pattern").constantOr(1),$=c.paint.get("fill-extrusion-color").constantOr(i.am.white);if(!R&&$.a!==0){const q=new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D);x===1&&G?zs(f,r,c,p,q,Dn.disabled,ar.unblended,z):(zs(f,r,c,p,q,Dn.disabled,ar.disabled,z),zs(f,r,c,p,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),z),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&G&&(!M&&f.transform.projection.name!=="globe"||R)){const q=c.paint.get("fill-extrusion-opacity"),ne=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=c.paint.get("fill-extrusion-flood-light-intensity"),oe=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(oe?null:c.lut).toArray01().slice(0,3),ge=ne>0&&J>0,xe=ie>0,Ce=(Te,be,Ie)=>(1-Ie)*Te+Ie*be,Ae=Te=>{const be=f.depthModeForSublayer(1,Kt.ReadOnly,E.LEQUAL,!0),Ie=c.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=Ce(.1,3,Ie),Be=f._showOverdrawInspector;if(!Be){const Ge=new Dn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),st=new ar([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0],E.MIN);Go(f,r,c,p,be,Ge,st,In.disabled,Te,"sdf",q,ne,J,ie,ce,Re,z,!1)}{const Ge=Be?Dn.disabled:new Dn({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),st=Be?f.colorModeForRenderPass():new ar([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],i.am.transparent,[!0,!0,!0,!0]);Go(f,r,c,p,be,Ge,st,In.disabled,Te,"color",q,ne,J,ie,ce,Re,z,!1)}};if(R){const Te=(be,Ie,Re)=>{const Be=f.depthModeForSublayer(1,Kt.ReadOnly,E.LEQUAL,!1),Ge=c.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),st=Ce(.1,3,Ge);{const it=new ar([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0]);Go(f,r,c,p,Be,Dn.disabled,it,In.disabled,be,"clear",q,ne,J,ie,ce,st,z,Ie)}{const it=new Dn({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),mt=new ar([E.ONE,E.ONE,E.ONE,E.ONE],i.am.transparent,[!1,!1,!1,!0],E.MIN);Go(f,r,c,p,Be,it,mt,In.disabled,be,"sdf",q,ne,J,ie,ce,st,z,Ie)}{const it=be?E.ZERO:E.ONE_MINUS_DST_ALPHA,mt=new Dn({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Ue=new ar([it,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],i.am.transparent,[!0,!0,!0,!0]);Go(f,r,c,p,Be,mt,Ue,In.disabled,be,"color",q,ne,J,ie,ce,st,z,Ie)}{const it=new ar([E.ONE,E.ONE,E.ONE,be?E.ZERO:E.ONE],i.am.transparent,[!1,!1,!1,!0],be?E.FUNC_ADD:E.MAX);Go(f,r,c,p,Be,Dn.disabled,it,In.disabled,be,"clear",q,ne,J,ie,ce,st,z,Ie,Re)}};if(ge||xe){let be;if(f.prepareDrawTile(),M){const Ie=M.drapeBufferSize[0],Re=M.drapeBufferSize[1];be=M.framebufferCopyTexture,be&&(!be||be.size[0]===Ie&&be.size[1]===Re)||(be&&be.destroy(),be=M.framebufferCopyTexture=new i.T(S,new i.r({width:Ie,height:Re}),E.RGBA8)),be.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexSubImage2D(E.TEXTURE_2D,0,0,0,0,0,Ie,Re)}ge&&Te(!0,!1,be),xe&&Te(!1,!0,be)}}else ge&&Ae(!0),xe&&Ae(!1),(ge||xe)&&f.resetStencilClippingMasks()}}},building:function(f,r,c,p){},hillshade:function(f,r,c,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const x=f.context,S=f.terrain&&f.terrain.renderingToTexture,[E,M]=f.renderPass!=="translucent"||S?[{},p]:f.stencilConfigForOverlap(p);for(const R of M){const z=r.getTile(R);if(z.needsHillshadePrepare&&f.renderPass==="offscreen")Yy(f,z,c);else if(f.renderPass==="translucent"){const F=f.depthModeForSublayer(0,Kt.ReadOnly),G=c.paint.get("hillshade-emissive-strength"),$=f.colorModeForDrapableLayerRenderPass(G),q=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):E[R.overscaledZ];Ky(f,R,z,c,F,q,$)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,r,c,p,x,S){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const E=f.transform.projection.name==="globe",M=c.paint.get("raster-elevation")!==0,R=M&&E;if(f.renderElevatedRasterBackface&&!R)return;const z=f.context,F=z.gl,G=r.getSource(),$=function(Ae,Te,be,Ie){const Re=Te.paint.get("raster-color"),Be=Ae.type==="raster-array",Ge=[],st=Te.paint.get("raster-resampling"),it=Te.paint.get("raster-color-mix");let mt=Te.paint.get("raster-color-range");const Ue=[it[0],it[1],it[2],0],Je=it[3];let Le=st==="nearest"?Ie.NEAREST:Ie.LINEAR;if(Be&&(Ge.push("RASTER_ARRAY"),Re||Ge.push("RASTER_COLOR"),st==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Le=Ie.NEAREST,!mt&&Ae.rasterLayers)){const lt=Ae.rasterLayers.find(({id:Ye})=>Ye===Te.sourceLayer);lt&&lt.fields&&lt.fields.range&&(mt=lt.fields.range)}if(mt=mt||[0,1],Re){Ge.push("RASTER_COLOR"),be.activeTexture.set(Ie.TEXTURE2),Te.updateColorRamp(mt);let lt=Te.colorRampTexture;lt||(lt=Te.colorRampTexture=new i.T(be,Te.colorRamp,Ie.RGBA8)),lt.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}return{mix:Ue,range:mt,offset:Je,defines:Ge,resampling:Le}}(G,c,z,F);if(G instanceof i.aP&&!p.length&&!E)return;const q=c.paint.get("raster-emissive-strength"),ne=f.colorModeForDrapableLayerRenderPass(q),J=f.terrain&&f.terrain.renderingToTexture,ie=!f.options.moving,oe=c.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(G instanceof i.aP&&!p.length&&(G.onNorthPole||G.onSouthPole)){const Ae=M?f.stencilModeFor3D():Dn.disabled;return void Ra(!!G.onNorthPole,null,f,r,c,q,$,In.disabled,Ae)}if(!p.length)return;const[ce,ge]=G instanceof i.aP||J?[{},p]:f.stencilConfigForOverlap(p),xe=ge[ge.length-1].overscaledZ;R&&$.defines.push("PROJECTION_GLOBE_VIEW"),M&&$.defines.push("RENDER_CUTOFF");const Ce=(Ae,Te,be)=>{for(const Ie of Ae){const Re=Ie.toUnwrapped(),Be=r.getTile(Ie);if(J&&(!Be||!Be.hasData()))continue;z.activeTexture.set(F.TEXTURE0);const Ge=tp(Be,G,c,$);if(!Ge||!Ge.texture)continue;const{texture:st,mix:it,offset:mt,tileSize:Ue,buffer:Je}=Ge;let Le,lt;J?(Le=Kt.disabled,lt=Ie.projMatrix):M?(Le=new Kt(F.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D),lt=E?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Re,ie)):(Le=f.depthModeForSublayer(Ie.overscaledZ-xe,c.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,F.LESS),lt=f.transform.calculateProjMatrix(Re,ie));const Ye=f.terrain&&J?f.terrain.stencilModeForRTTOverlap(Ie):ce[Ie.overscaledZ],pt=S?0:c.paint.get("raster-fade-duration");Be.registerFadeDuration(pt);const It=r.findLoadedParent(Ie,0),ct=bs(Be,It,r,f.transform,pt);let wt,Vt;f.terrain&&f.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),st.bind(oe,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),It?(It.texture&&It.texture.bind(oe,F.CLAMP_TO_EDGE),wt=Math.pow(2,It.tileID.overscaledZ-Be.tileID.overscaledZ),Vt=[Be.tileID.canonical.x*wt%1,Be.tileID.canonical.y*wt%1]):st.bind(oe,F.CLAMP_TO_EDGE),"useMipmap"in st&&z.extTextureFilterAnisotropic&&f.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const qt=f.transform;let Bt;const Xt=M?tu(qt):[0,0,0,0];let hn,yn,Ln,Qn,br,oi=0;if(R&&G instanceof i.aP&&G.coordinates.length>3)hn=Float32Array.from(i.bh(i.dr(new i.cp(0,0,0)))),yn=Float32Array.from(qt.globeMatrix),Ln=Float32Array.from(i.dm(qt)),Qn=[i.aD(qt.center.lng),i.aH(qt.center.lat)],Bt=G.elevatedGlobePerspectiveTransform,br=G.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Vn=i.dn(Ie.canonical);oi=i.dp(Vn.getCenter().lat),hn=Float32Array.from(i.bh(i.dr(Ie.canonical))),yn=Float32Array.from(qt.globeMatrix),Ln=Float32Array.from(i.dm(qt)),Qn=[i.aD(qt.center.lng),i.aH(qt.center.lat)],Bt=[0,0],br=Float32Array.from(i.dq(Ie.canonical,Vn,oi,qt.worldSize/qt._pixelsPerMercatorPixel))}else Bt=G instanceof i.aP?G.perspectiveTransform:[0,0],hn=new Float32Array(16),yn=new Float32Array(9),Ln=new Float32Array(16),Qn=[0,0],br=new Float32Array(9);const Vr=Ud(lt,hn,yn,Ln,br,Vt||[0,0],i.ah(f.transform.zoom),Qn,Xt,wt||1,ct,c,Bt,M?c.paint.get("raster-elevation"):0,2,it,mt,$.range,Ue,Je,q),Pr=f.isTileAffectedByFog(Ie),$i=f.getOrCreateProgram("raster",{defines:$.defines,overrideFog:Pr});if(f.uploadCommonUniforms(z,$i,Re),G instanceof i.aP){const Vn=G.elevatedGlobeVertexBuffer,er=G.elevatedGlobeIndexBuffer;if(J||!E)G.boundsBuffer&&G.boundsSegments&&$i.draw(f,F.TRIANGLES,Le,Dn.disabled,ne,In.disabled,Vr,c.id,G.boundsBuffer,f.quadTriangleIndexBuffer,G.boundsSegments);else if(Vn&&er){const cr=qt.zoom<=i.cL?G.elevatedGlobeSegments:G.getSegmentsForLongitude(qt.center.lng);cr&&$i.draw(f,F.TRIANGLES,Le,Dn.disabled,ne,Te,Vr,c.id,Vn,er,cr)}}else if(R){Le=new Kt(F.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);const Vn=f.globeSharedBuffers;if(Vn){const[er,cr,ai]=Vn.getGridBuffers(oi,!1);$i.draw(f,F.TRIANGLES,Le,be||Ye,f.colorModeForRenderPass(),Te,Vr,c.id,er,cr,ai)}}else{const{tileBoundsBuffer:Vn,tileBoundsIndexBuffer:er,tileBoundsSegments:cr}=f.getTileBoundsBuffers(Be);$i.draw(f,F.TRIANGLES,Le,Ye,ne,In.disabled,Vr,c.id,Vn,er,cr)}}if(!(G instanceof i.aP)&&R)for(const Ie of Ae){const Re=Ie.canonical.y===(1<<Ie.canonical.z)-1;Ie.canonical.y===0&&Ra(!0,Ie,f,r,c,q,$,Te,be||Dn.disabled),Re&&Ra(!1,Ie,f,r,c,q,$,Te===In.frontCW?In.backCW:In.frontCW,be||Dn.disabled)}};R?Ce(ge,f.renderElevatedRasterBackface?In.backCW:In.frontCW,f.stencilModeFor3D()):Ce(ge,In.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,r,c,p,x,S){f.renderPass==="offscreen"&&function(E,M,R,z){if(!z.length)return;const F=E.context,G=F.gl,$=M.getSource();if(!($ instanceof kc))return;const q=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let ne=R.particlePositionRGBAImage;if(!ne||ne.width!==q){const ge=function(xe){const Ce=xe*xe,Ae=new Uint8Array(4*Ce),Te=function(Ie){return Ie|=0,Ie=Math.imul(2747636419^Ie,2654435769),Ie=Math.imul(Ie^Ie>>>16,2654435769),((Ie=Math.imul(Ie^Ie>>>16,2654435769))>>>0)/4294967296},be=1/1.1;for(let Ie=0;Ie<Ce;Ie++){const Re=be*(Te(2*Ie+0)+Ls),Be=be*(Te(2*Ie+1)+Ls),Ge=255*Re%1,st=255*Be%1,it=Ge,mt=Be-st/255,Ue=st;Ae[4*Ie+0]=255*(Re-Ge/255),Ae[4*Ie+1]=255*it,Ae[4*Ie+2]=255*mt,Ae[4*Ie+3]=255*Ue}return Ae}(q);ne=R.particlePositionRGBAImage=new i.r({width:q,height:q},ge)}let J=R.particleFramebuffer;J?J.width!==q&&(J.destroy(),J=R.particleFramebuffer=F.createFramebuffer(q,q,!0,null)):J=R.particleFramebuffer=F.createFramebuffer(q,q,!0,null);const ie=[];for(const ge of z){const xe=M.getTile(ge);if(!(xe instanceof vu))continue;const Ce=Og(xe,$,R);if(!Ce)continue;const Ae=[xe.tileSize,xe.tileSize];let Te=R.tileFramebuffer;Te||(Te=R.tileFramebuffer=F.createFramebuffer(Ae[0],Ae[1],!0,null));let be=xe.rasterParticleState;be||(be=xe.rasterParticleState=new Zd(F,ge,Ae,ne));const Ie=be.update(R.lastInvalidatedAt);be.particleTextureDimension!==q&&be.updateParticleTexture(ge,ne);const Re=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=Re;const Be=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Be,ie.push([ge,Ce,be,Ie])}if(ie.length===0)return;const oe=i.q.now(),ce=R.previousDrawTimestamp?.001*(oe-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=oe,R.hasColorMap()){F.activeTexture.set(G.TEXTURE0+2);let ge=R.colorRampTexture;ge||(ge=R.colorRampTexture=new i.T(F,R.colorRamp,G.RGBA8)),ge.bind(G.LINEAR,G.CLAMP_TO_EDGE)}F.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(ge,xe,Ce){const Ae=ge.context,Te=Ae.gl,be=xe.tileFramebuffer;Ae.activeTexture.set(Te.TEXTURE0);const Ie={u_texture:0,u_opacity:1.05*(Be=xe.paint.get("raster-particle-fade-opacity-factor"))/(Be+.05)},Re=ge.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Be;for(const Ge of Ce){const[,,st,it]=Ge;be.colorAttachment.set(st.targetColorTexture.texture),Ae.viewport.set([0,0,be.width,be.height]),Ae.clear({color:i.am.transparent}),it&&(st.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Re.draw(ge,Te.TRIANGLES,Kt.disabled,Dn.disabled,ar.alphaBlended,In.disabled,Ie,xe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments))}}(E,R,ie),function(ge,xe,Ce,Ae){const Te=ge.context,be=Te.gl,Ie=Ce.tileFramebuffer,Re=ge.transform.projection.name==="globe",Be=Ce.paint.get("raster-particle-max-speed");for(const Ge of Ae){const[st,it,mt]=Ge;Te.activeTexture.set(be.TEXTURE0+0),it.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Ie.colorAttachment.set(mt.targetColorTexture.texture);const Ue=ge.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});Te.activeTexture.set(be.TEXTURE0+1);const Je=it.scalarData?[]:[0,1,2,3].map(Ye=>i.dT[Ye](st));Je.push(st);const Le=st.canonical.x,lt=st.canonical.y;for(const Ye of Je){const pt=xe.getTile(Re?Ye.wrapped():Ye);if(!pt)continue;const It=pt.rasterParticleState;if(!It)continue;const ct=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-st.wrap),wt=Ye.canonical.y;It.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Vt=ls(1,It.particleTexture0.size[0],[ct-Le,wt-lt],0,it.texture.size,2,Be,it.textureOffset,it.scale,it.offset);Ue.draw(ge,be.POINTS,Kt.disabled,Dn.disabled,ar.alphaBlended,In.disabled,Vt,Ce.id,It.particleIndexBuffer,void 0,It.particleSegment)}}}(E,M,R,ie),F.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(ge,xe,Ce,Ae){const Te=ge.context,be=Te.gl,Ie=xe.paint.get("raster-particle-max-speed"),Re=Ae*xe.paint.get("raster-particle-speed-factor")*.15,Be=function(st){return Math.pow(st,6)}(.01+1*xe.paint.get("raster-particle-reset-rate-factor")),Ge=xe.particleFramebuffer;Te.viewport.set([0,0,Ge.width,Ge.height]);for(const st of Ce){const[,it,mt]=st;Te.activeTexture.set(be.TEXTURE0+0),it.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Te.activeTexture.set(be.TEXTURE0+1);const Ue=mt.particleTexture0;Ue.bind(be.NEAREST,be.CLAMP_TO_EDGE);const Je=so(1,Ue.size[0],0,it.texture.size,Ie,Re,Be,it.textureOffset,it.scale,it.offset);Ge.colorAttachment.set(mt.particleTexture1.texture),Te.clear({color:i.am.transparent}),ge.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(ge,be.TRIANGLES,Kt.disabled,Dn.disabled,ar.unblended,In.disabled,Je,xe.id,ge.viewportBuffer,ge.quadTriangleIndexBuffer,ge.viewportSegments)}}(E,R,ie,ce)}(f,r,c,p),f.renderPass==="translucent"&&(function(E,M,R,z,F){const G=E.context,$=G.gl,q=M.getSource().tileSize,ne=5*(1-i.af(i.cx,i.cx+1,E.transform.zoom))*q+R.paint.get("raster-particle-elevation"),J=!E.options.moving,ie=E.transform.projection.name==="globe";if(!z.length)return;const[oe,ce]=E.stencilConfigForOverlap(z),ge=[];ie&&ge.push("PROJECTION_GLOBE_VIEW");const xe=E.stencilModeFor3D();for(const Ce of ce){const Ae=Ce.toUnwrapped(),Te=M.getTile(Ce);if(!Te.rasterParticleState)continue;const be=Te.rasterParticleState,Ie=100;Te.registerFadeDuration(Ie);const Re=M.findLoadedParent(Ce,0),Be=bs(Te,Re,M,E.transform,Ie);let Ge,st;E.terrain&&E.terrain.prepareDrawTile(),G.activeTexture.set($.TEXTURE0),be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),G.activeTexture.set($.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ge=Math.pow(2,Re.tileID.overscaledZ-Te.tileID.overscaledZ),st=[Te.tileID.canonical.x*Ge%1,Te.tileID.canonical.y*Ge%1]):be.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const it=ie?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(Ae,J),mt=E.transform,Ue=qh(mt),Je=i.dn(Ce.canonical),Le=i.dp(Je.getCenter().lat);let lt,Ye,pt,It,ct;ie?(lt=Float32Array.from(i.bh(i.dr(Ce.canonical))),Ye=Float32Array.from(mt.globeMatrix),pt=Float32Array.from(i.dm(mt)),It=[i.aD(mt.center.lng),i.aH(mt.center.lat)],ct=Float32Array.from(i.dq(Ce.canonical,Je,Le,mt.worldSize/mt._pixelsPerMercatorPixel))):(lt=new Float32Array(16),Ye=new Float32Array(9),pt=new Float32Array(16),It=[0,0],ct=new Float32Array(9));const wt=Xs(it,lt,Ye,pt,ct,st||[0,0],i.ah(E.transform.zoom),It,Ue,Ge||1,Be,ne),Vt=E.isTileAffectedByFog(Ce),qt=E.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:Vt});if(E.uploadCommonUniforms(G,qt,Ae),ie){const Bt=new Kt($.LEQUAL,Kt.ReadOnly,E.depthRangeFor3D),Xt=0,hn=E.globeSharedBuffers;if(hn){const[yn,Ln,Qn]=hn.getGridBuffers(Le,Xt!==0);qt.draw(E,$.TRIANGLES,Bt,xe,ar.alphaBlended,E.renderElevatedRasterBackface?In.frontCCW:In.backCCW,wt,R.id,yn,Ln,Qn)}}else{const Bt=E.depthModeForSublayer(0,Kt.ReadOnly),Xt=oe[Ce.overscaledZ],{tileBoundsBuffer:hn,tileBoundsIndexBuffer:yn,tileBoundsSegments:Ln}=E.getTileBoundsBuffers(Te);qt.draw(E,$.TRIANGLES,Bt,Xt,ar.alphaBlended,In.disabled,wt,R.id,hn,yn,Ln)}}E.resetStencilClippingMasks()}(f,r,c,p),f.style.map.triggerRepaint())},background:function(f,r,c,p){const x=c.paint.get("background-color"),S=c.paint.get("background-color-use-theme").constantOr("default")==="none",E=c.paint.get("background-opacity"),M=c.paint.get("background-emissive-strength"),R=c.paint.get("background-pitch-alignment")==="viewport";if(E===0)return;const z=f.context,F=z.gl,G=f.transform,$=G.tileSize,q=c.paint.get("background-pattern");let ne;if(q!==void 0&&(q===null||(ne=f.imageManager.getPattern(i.I.from(q.toString()),c.scope,f.style.getLut(c.scope)),!ne)))return;const J=!q&&x.a===1&&E===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==J)return;const ie=Dn.disabled,oe=f.depthModeForSublayer(0,J==="opaque"?Kt.ReadWrite:Kt.ReadOnly),ce=f.colorModeForDrapableLayerRenderPass(M),ge=q?"backgroundPattern":"background";let xe,Ce=p;if(Ce||(xe=f.getBackgroundTiles(),Ce=Object.values(xe).map(Ae=>Ae.tileID)),q&&(z.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context,c.scope)),R){const Ae=f.getOrCreateProgram(ge,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(i.bx([])),be=new i.aM(0,0,0,0,0),Ie=q?Gd(Te,M,E,f,0,c.scope,ne,R,{tileID:be,tileSize:$}):Hd(Te,M,E,x.toPremultipliedRenderColor(S?null:c.lut));Ae.draw(f,F.TRIANGLES,oe,ie,ce,In.disabled,Ie,c.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Ae of Ce){const Te=f.isTileAffectedByFog(Ae),be=f.getOrCreateProgram(ge,{overrideFog:Te}),Ie=Ae.toUnwrapped(),Re=p?Ae.projMatrix:f.transform.calculateProjMatrix(Ie);f.prepareDrawTile();const Be=r?r.getTile(Ae):xe?xe[Ae.key]:new Dc(Ae,$,G.zoom,f),Ge=q?Gd(Re,M,E,f,0,c.scope,ne,R,{tileID:Ae,tileSize:$}):Hd(Re,M,E,x.toPremultipliedRenderColor(S?null:c.lut));f.uploadCommonUniforms(z,be,Ie);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:it,tileBoundsSegments:mt}=f.getTileBoundsBuffers(Be);be.draw(f,F.TRIANGLES,oe,ie,ce,In.disabled,Ge,c.id,st,it,mt)}},sky:function(f,r,c){const p=f._atmosphere?i.ah(f.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const S=f.context,E=c.paint.get("sky-type"),M=new Kt(S.gl.LEQUAL,Kt.ReadOnly,[0,1]),R=f.frameCounter/1e3%1;E==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(z,F,G,$){const q=z.context,ne=q.gl;let J=F.skyboxFbo;if(!J){J=F.skyboxFbo=q.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Hu(q),F.skyboxTexture=q.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,F.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let ge=0;ge<6;++ge)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(J.framebuffer),q.viewport.set([0,0,32,32]);const ie=F.getCenter(z,!0),oe=z.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);i.bx(ce),i.e3(ce,ce,.5*-Math.PI),ha(z,F,oe,ce,ie,0),i.bx(ce),i.e3(ce,ce,.5*Math.PI),ha(z,F,oe,ce,ie,1),i.bx(ce),i.cG(ce,ce,.5*-Math.PI),ha(z,F,oe,ce,ie,2),i.bx(ce),i.cG(ce,ce,.5*Math.PI),ha(z,F,oe,ce,ie,3),i.bx(ce),ha(z,F,oe,ce,ie,4),i.bx(ce),i.e3(ce,ce,Math.PI),ha(z,F,oe,ce,ie,5),q.viewport.set([0,0,z.width,z.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(z,F,G,$,q){const ne=z.context,J=ne.gl,ie=z.transform,oe=z.getOrCreateProgram("skybox");ne.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,F.skyboxTexture);const ce=((ge,xe,Ce,Ae,Te)=>({u_matrix:ge,u_sun_direction:xe,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Te}))(ie.skyboxMatrix,F.getCenter(z,!1),0,$,q);z.uploadCommonUniforms(ne,oe),oe.draw(z,J.TRIANGLES,G,Dn.disabled,z.colorModeForRenderPass(),In.backCW,ce,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,c,M,x,R):E==="gradient"&&f.renderPass==="sky"&&function(z,F,G,$,q){const ne=z.context,J=ne.gl,ie=z.transform,oe=z.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Hu(ne)),ne.activeTexture.set(J.TEXTURE0);let ce=F.colorRampTexture;ce||(ce=F.colorRampTexture=new i.T(ne,F.colorRamp,J.RGBA8)),ce.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ge=((xe,Ce,Ae,Te,be)=>({u_matrix:xe,u_color_ramp:0,u_center_direction:Ce,u_radius:i.al(Ae),u_opacity:Te,u_temporal_offset:be}))(ie.skyboxMatrix,F.getCenter(z,!1),F.paint.get("sky-gradient-radius"),$,q);z.uploadCommonUniforms(ne,oe),oe.draw(z,J.TRIANGLES,G,Dn.disabled,z.colorModeForRenderPass(),In.backCW,ge,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,c,M,x,R)},custom:function(f,r,c,p){const x=f.context,S=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isDraped(r)){if(f.renderPass==="offscreen"){const E=S.prerender;if(E){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;E.call(S,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.ah(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else E.call(S,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const M=S.renderToTile;if(M){const R=p[0].canonical,z={x:R.x+p[0].wrap*(S.wrapTileId?0:1<<R.z),y:R.y,z:R.z};x.setDepthMode(Kt.disabled),x.setStencilMode(Dn.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),M.call(S,x.gl,z),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(Dn.disabled);const E=S.renderingMode==="3d"?new Kt(f.context.gl.LEQUAL,Kt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Kt.ReadOnly);if(x.setDepthMode(E),f.transform.projection.name==="globe"){const M=f.transform.pointMerc;S.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),i.ah(f.transform.zoom),[M.x,M.y],f.transform.pixelsPerMeterRatio)}else S.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,r,c,p){if(f.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1);if(x===0)return;const S=c.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!S||f.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const E=f.shadowRenderer,M=c.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,M||(E.enabled=!1));const R=()=>{E&&(E.useNormalOffset=!0,M||(E.enabled=!0))},z=r.getSource();if(f.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(oe,ce,ge,xe,Ce){const Ae=oe.transform;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Te=Ae.getFreeCameraOptions().position;if(!oe.modelManager)return;const be=oe.modelManager;ge.modelManager=be;const Ie=oe.shadowRenderer;if(!ge._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Re=ge._unevaluatedLayout._values["model-id"],Be=Object.assign({},ge.layout.get("model-id").parameters),Ge=oe.style.order.indexOf(ge.fqid);for(const st of xe){const it=ce.getTile(st).getBucket(ge);if(!it||it.projection.name!==Ae.projection.name)continue;const mt=it.getModelUris();mt&&!it.modelsRequested&&(be.addModelsFromBucket(mt,Ce),it.modelsRequested=!0);const Ue=Wo(st,Ae);Be.zoom=Ue;const Je=Re.possiblyEvaluate(Be);if($e(oe,it,st),Fs.shadowUniformsInitialized=!1,Fs.useSingleShadowCascade=!!Ie&&Ie.getMaxCascadeForTile(st.toUnwrapped())===0,oe.renderPass==="shadow"&&Ie){if(oe.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const Ye=Ae.calculatePosMatrix(st.toUnwrapped(),Ae.worldSize);if(Fs.tileMatrix.set(Ye),Fs.shadowTileMatrix=Float32Array.from(Ie.calculateShadowPassMatrixFromMatrix(Ye)),Fs.aabb.min.fill(0),Fs.aabb.max[0]=Fs.aabb.max[1]=i.aj,Fs.aabb.max[2]=0,sp(it,Fs,oe,ge.scope))continue}const Le=1<<st.canonical.z,lt=[((Te.x-st.wrap)*Le-st.canonical.x)*i.aj,(Te.y*Le-st.canonical.y)*i.aj,Te.z*Le*i.aj];oe.conflationActive&&Object.keys(it.instancesPerModel).length>0&&oe.style.isLayerClipped(ge,ce.getSource())&&it.updateReplacement(st,oe.replacementSource,Ge,Ce)&&(it.uploaded=!1,it.upload(oe.context));for(let Ye in it.instancesPerModel){const pt=it.instancesPerModel[Ye];pt.features.length>0&&(Ye=Je.evaluate(pt.features[0].feature,{}));const It=be.getModel(Ye,Ce);if(It||be.hasURLBeenRequested(Ye)||it.modelUris.includes(Ye)||(it.modelUris.push(Ye),it.modelsRequested=!1),It&&It.uploaded)for(const ct of It.nodes)ru(oe,ge,ct,pt,lt,st,Fs)}}}(f,r,c,p,z.type==="vector"?c.scope:""),void R();if(!z.loaded())return;if(z.type==="batched-model")return function(oe,ce,ge,xe){ge.resetLayerRenderingStats(oe);const Ce=oe.context,Ae=oe.transform,Te=oe.style.fog,be=oe.shadowRenderer;if(Ae.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Ie=oe.transform.getFreeCameraOptions().position,Re=i.bY([],[Ie.x,Ie.y,Ie.z],oe.transform.worldSize),Be=i.eb([],Re),Ge=i.bx([]),st=i.ec(Ae.center.lat,Ae.zoom),it=i.bn([],[1,1,1/st]);i.bo(Ge,Ge,Be);const mt=ge.paint.get("model-opacity").constantOr(1),Ue=new Kt(Ce.gl.LEQUAL,Kt.ReadWrite,oe.depthRangeFor3D),Je=new Kt(Ce.gl.LEQUAL,Kt.ReadOnly,oe.depthRangeFor3D),Le=new i.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),lt=oe.renderPass==="shadow",Ye=lt&&be?be.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),pt=ge.paint.get("model-front-cutoff"),It=pt[2]<1,ct=sa(oe,ge.paint.get("model-cutoff-fade-range")),wt=ge.getLayerRenderingStats();(function(Vt,qt,Bt,Xt){const hn=Vt.terrain?Vt.terrain.exaggeration():0,yn=Vt.transform.zoom;for(const Ln of Xt){const Qn=qt.getTile(Ln).getBucket(Bt);Qn&&(Qn.setFilter(Bt.filter),Vt.conflationActive&&Qn.updateReplacement(Ln,Vt.replacementSource),Qn.evaluateTransform(Vt,Bt),Vt.terrain&&hn>0&&Qn.elevationUpdate(Vt.terrain,hn,Ln,Bt.source),Qn.needsReEvaluation(Vt,yn,Bt)&&Qn.evaluate(Bt))}})(oe,ce,ge,xe),function(){let Vt,qt,Bt;It?(Vt=xe.length-1,qt=-1,Bt=-1):(Vt=0,qt=xe.length,Bt=1);const Xt=new Float64Array(16),hn=i.ef(),yn=new i.P(0,0);for(let Ln=Vt;Ln!==qt;Ln+=Bt){const Qn=xe[Ln],br=ce.getTile(Qn).getBucket(ge);if(!br||!br.uploaded)continue;let oi=!1;be&&(oi=be.getMaxCascadeForTile(Qn.toUnwrapped())===0);const Vr=Ae.calculatePosMatrix(Qn.toUnwrapped(),Ae.worldSize),Pr=br.modelTraits;!lt&&It&&(i.bi(Xt,Vr),i.ad(hn,Re,Xt),yn.x=hn[0],yn.y=hn[1]);const $i=[];br.setFilter(ge.filter);for(const Vn of br.getNodesInfo()){if(Vn.hiddenByReplacement||!Vn.node.meshes)continue;const er=Vn.node;let cr=0;oe.terrain&&er.elevation&&(cr=er.elevation*oe.terrain.exaggeration());const ai=(()=>{const Gi=Vn.aabb;return Le.min=[...Gi.min],Le.max=[...Gi.max],Le.min[2]+=cr,Le.max[2]+=cr,i.ad(Le.min,Le.min,Vr),i.ad(Le.max,Le.max,Vr),Le})(),Ji=Vn.evaluatedScale;if(Ji[0]<=1&&Ji[1]<=1&&Ji[2]<=1&&ai.intersects(Ye)===0)continue;if(!lt&&It){const Gi=.16666666666666666;Vn.cameraCollisionOpacity=Re[0]>ai.min[0]&&Re[0]<ai.max[0]&&Re[1]>ai.min[1]&&Re[1]<ai.max[1]&&Re[2]*st<ai.max[2]&&er.footprint&&i.bS(yn,er.footprint)?Math.max(Vn.cameraCollisionOpacity-Gi,0):Math.min(1,Vn.cameraCollisionOpacity+Gi)}const hi=[...Vr],Lr=1/i.cU(Qn.canonical),Fi=er.anchor?er.anchor[0]:0,vr=er.anchor?er.anchor[1]:0;i.bo(hi,hi,[Fi*(Ji[0]-1)+Vn.evaluatedTranslation[0]*Lr,vr*(Ji[1]-1)+Vn.evaluatedTranslation[1]*Lr,cr+Vn.evaluatedTranslation[2]]),i.ci(Ji,i.eg)||i.cE(hi,hi,Ji);const Bi=i.az([],hi,er.matrix),gi=i.az([],Ae.expandedFarZProjMatrix,Bi),Gr=i.az([],Ae.expandedFarZProjMatrix,hi),di=i.aA([],[Fi,vr,cr,1],gi)[2];er.hidden=!1;let Xn=mt;lt||(It&&(Xn*=Vn.cameraCollisionOpacity,Xn*=Gu(hi,Ae,Vn.aabb,pt)),Xn*=Im(ct,di)),Xn!==0?$i.push({nodeInfo:Vn,depth:di,opacity:Xn,wvpForNode:gi,wvpForTile:Gr,nodeModelMatrix:Bi,tileModelMatrix:hi}):er.hidden=!0}lt||$i.sort((Vn,er)=>!It||Vn.opacity===1&&er.opacity===1?Vn.depth<er.depth?-1:1:Vn.opacity===1?-1:er.opacity===1?1:Vn.depth>er.depth?-1:1);for(const Vn of $i){const er=Vn.nodeInfo,cr=er.node;let ai=i.az([],it,Vn.tileModelMatrix);i.az(ai,Ge,ai);const Ji=i.bi([],ai);i.ee(Ji,Ji),i.cE(Ji,Ji,Kd),ai=i.az(ai,ai,cr.matrix);const hi=oe.renderPass==="light-beam",Lr=ge.paint.get("model-color-use-theme").constantOr("default")==="none",Fi=Pr&i.em.HasMapboxMeshFeatures,vr=Fi?0:er.evaluatedRMEA[0][2];for(let Bi=0;Bi<cr.meshes.length;++Bi){const gi=cr.meshes[Bi],Gr=Bi===cr.lightMeshIndex;let di=Vn.wvpForNode;if(Gr){if(!hi&&!oe.terrain&&oe.shadowRenderer){oe.currentLayer<oe.firstLightBeamLayer&&(oe.firstLightBeamLayer=oe.currentLayer);continue}di=Vn.wvpForTile}else if(hi)continue;const Xn={defines:[]},Gi=[];if(!lt&&be&&(be.useNormalOffset=!!gi.normalBuffer),Tt(Xn.defines,Gi,gi,oe,Lr?null:ge.lut),Fi||Xn.defines.push("DIFFUSE_SHADED"),oi&&Xn.defines.push("SHADOWS_SINGLE_CASCADE"),wt&&(lt?wt.numRenderedVerticesInShadowPass+=gi.vertexArray.length:wt.numRenderedVerticesInTransparentPass+=gi.vertexArray.length),lt){Di(gi,Vn.nodeModelMatrix,oe,ge);continue}let Bs=null;if(Te){const ws=ml(Vn.nodeModelMatrix,oe.transform);if(Bs=new Float32Array(ws),Ae.projection.name!=="globe"){const da=gi.aabb.min,Xo=gi.aabb.max,[Ko,fa]=Te.getOpacityForBounds(ws,da[0],da[1],Xo[0],Xo[1]);Xn.overrideFog=Ko>=Ze||fa>=Ze}}const wi=gi.material;let Dr;wi.occlusionTexture&&wi.occlusionTexture.offsetScale&&(Dr=wi.occlusionTexture.offsetScale,Xn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Zo=oe.getOrCreateProgram("model",Xn);!lt&&be&&be.setupShadowsFromMatrix(Vn.tileModelMatrix,Zo,be.useNormalOffset),oe.uploadCommonUniforms(Ce,Zo,null,Bs);const Ro=wi.pbrMetallicRoughness;Ro.metallicFactor=.9,Ro.roughnessFactor=.5;const Oa=Xc(new Float32Array(di),new Float32Array(ai),new Float32Array(Ji),new Float32Array(cr.matrix),oe,Vn.opacity,Ro.baseColorFactor,wi.emissiveFactor,Ro.metallicFactor,Ro.roughnessFactor,wi,vr,ge,[0,0,0],Dr);!Gr&&(er.hasTranslucentParts||Vn.opacity<1)&&Zo.draw(oe,Ce.gl.TRIANGLES,Ue,Dn.disabled,ar.disabled,In.backCCW,Oa,ge.id,gi.vertexBuffer,gi.indexBuffer,gi.segments,ge.paint,oe.transform.zoom,void 0,Gi),Zo.draw(oe,Ce.gl.TRIANGLES,Gr?Je:Ue,Dn.disabled,Gr||Vn.opacity<1||er.hasTranslucentParts?ar.alphaBlended:ar.unblended,In.backCCW,Oa,ge.id,gi.vertexBuffer,gi.indexBuffer,gi.segments,ge.paint,oe.transform.zoom,void 0,Gi)}}}}()}(f,r,c,p),void R();if(z.type!=="model")return;const F=z.getModels(),G=[],$=f.transform.getFreeCameraOptions().position,q=i.bY([],[$.x,$.y,$.z],f.transform.worldSize);i.eb(q,q);const ne=[],J=[];let ie=0;for(const oe of F){const ce=c.paint.get("model-rotation").constantOr(null),ge=c.paint.get("model-scale").constantOr(null),xe=c.paint.get("model-translation").constantOr(null);oe.computeModelMatrix(f,ce,ge,xe,!0,!0,!1);const Ce=i.bx([]),Ae=i.ec(oe.position.lat,f.transform.zoom),Te=i.bn([],[1,1,1/Ae]);i.bo(Ce,Ce,q),G.push({zScaleMatrix:Te,negCameraPosMatrix:Ce});for(const be of oe.nodes)pc(f.transform,be,oe.matrix,f.transform.expandedFarZProjMatrix,ie,ne,J);ie++}if(ne.sort((oe,ce)=>ce.depth-oe.depth),f.renderPass!=="shadow"){if(x===1)for(const oe of J)zt(oe,f,c,G[oe.modelIndex],Dn.disabled,f.colorModeForRenderPass());else{for(const oe of J)zt(oe,f,c,G[oe.modelIndex],Dn.disabled,ar.disabled);for(const oe of J)zt(oe,f,c,G[oe.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const oe of ne)zt(oe,f,c,G[oe.modelIndex],Dn.disabled,f.colorModeForRenderPass());R()}else{for(const oe of J)Di(oe.mesh,oe.nodeModelMatrix,f,c);for(const oe of ne)Di(oe.mesh,oe.nodeModelMatrix,f,c);R()}}},cp={line:function(f,r,c){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const p=r.getVisibleCoordinates();for(const x of p){const S=r.getTile(x).getBucket(f);if(S&&(S.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,r,c){const p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,p.type==="vector"?f.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const S of x)S.upload(c.context)},raster:function(f,r,c){const p=r.getSource();if(!(p instanceof kc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-array-band")||p.getInitialBand(x);if(S==null)return;const E=r.getIds().map(M=>r.getTileByID(M));for(const M of E)M.updateNeeded(x,S)&&p.prepareTile(M,x,S)},"raster-particle":function(f,r,c){const p=r.getSource();if(!(p instanceof kc&&p.loaded()))return;const x=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const S=f.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(S==null)return;const E=r.getIds().map(M=>r.getTileByID(M));for(const M of E)M.updateNeeded(x,S)&&p.prepareTile(M,x,S)}},Hl={fill:Wd},Kh={fill:function(f,r,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=f.context.gl,S=new Kt(x.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D),E=new Dn({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),M=f.transform.getFreeCameraOptions().position,R=f.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const z of p){const F=r.getTile(z),G=F.getBucket(c);if(!G)continue;const $=G.elevatedStructures;if(!$||$.maskSegments.segments[0].primitiveLength===0)continue;const q=Gh(z.toUnwrapped(),M),ne=f.translatePosMatrix(z.projMatrix,F,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),J=Ho(ne,q,0,0,0);R.draw(f,x.TRIANGLES,S,E,ar.disabled,In.disabled,J,c.id,$.vertexBuffer,$.indexBuffer,$.maskSegments,c.paint,f.transform.zoom)}}};class Yh{constructor(r,c,p,x,S,E){this.context=new Dg(r,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=S,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const M=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of M)this._debugParams.enabledLayers[z]=!0;S.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),S.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),S.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),S.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),S.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of M)S.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new Mm(S),this.setup(),this.numSublayers=no.maxUnderzooming+no.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new qy(this),this._wireframeDebugCache=new zg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,R,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=E}updateTerrain(r,c){const p=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new io(this,r));const x=this._terrain;this.transform.elevation=p?x:null,x.update(r,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(r){const c=r.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const S=p+.78*(x-p);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new io(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,c){if(this.width=r*i.q.devicePixelRatio,this.height=c*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const r=this.context,c=new i.ba;c.emplaceBack(0,0),c.emplaceBack(i.aj,0),c.emplaceBack(0,i.aj),c.emplaceBack(i.aj,i.aj),this.tileExtentBuffer=r.createVertexBuffer(c,i.bc.members),this.tileExtentSegments=i.bd.simpleSegment(0,0,4,2);const p=new i.ba;p.emplaceBack(0,0),p.emplaceBack(i.aj,0),p.emplaceBack(0,i.aj),p.emplaceBack(i.aj,i.aj),this.debugBuffer=r.createVertexBuffer(p,i.bc.members),this.debugSegments=i.bd.simpleSegment(0,0,4,5);const x=new i.ba;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(x,i.bc.members),this.viewportSegments=i.bd.simpleSegment(0,0,4,2);const S=new i.aZ;S.emplaceBack(0,0,0,0),S.emplaceBack(i.aj,0,i.aj,0),S.emplaceBack(0,i.aj,0,i.aj),S.emplaceBack(i.aj,i.aj,i.aj,i.aj),this.mercatorBoundsBuffer=r.createVertexBuffer(S,i.bf.members),this.mercatorBoundsSegments=i.bd.simpleSegment(0,0,4,2);const E=new i.a_;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(E);const M=new i.bb;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=r.createIndexBuffer(M),this.emptyTexture=new i.T(r,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=i.bz();const R=this.context.gl;this.stencilClearMode=new Dn({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Kt.disabled,this.stencilClearMode,ar.disabled,In.disabled,oa(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,p){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of p)if(this._tileClippingMaskIDs[R.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const x=this.context,S=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(ar.disabled),x.setDepthMode(Kt.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of p){const R=c.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:$}=this.getTileBoundsBuffers(R);E.draw(this,S.TRIANGLES,Kt.disabled,new Dn({func:S.ALWAYS,mask:0},z,255,S.KEEP,S.KEEP,S.REPLACE),ar.disabled,In.disabled,oa(M.projMatrix),"$clipping",F,G,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new Dn({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new Dn({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((E,M)=>M.overscaledZ-E.overscaledZ),x=p[p.length-1].overscaledZ,S=p[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const E={};for(let M=0;M<S;M++)E[M+x]=new Dn({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=S,[E,p]}return[{[x]:Dn.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new ar([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new i.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ar.unblended:ar.alphaBlended}colorModeForDrapableLayerRenderPass(r){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new ar([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new i.am(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,c,p,x=!1){if(this.depthOcclusion)return new Kt(this.context.gl.GREATER,Kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Kt.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Kt(p||this.context.gl.LEQUAL,c,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),S=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Hh(this.context,c,p,!1,"texture"),this.depthTexture=new i.T(this.context,{width:c,height:p,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),r.bindTexture(r.TEXTURE_2D,S),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,c,p,0,0,c,p,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,c)=>r+c/this._fpsHistory.length,0))}render(r,c){const p=i.q.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=c;const x=this.style._mergedLayers,S=!(!this.terrain||!this.terrain.enabled),E=()=>this.style._getOrder(S).filter(Ue=>{const Je=x[Ue];return!(Je.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Je.type]});let M=E(),R=!1,z=!1;for(const Ue of M){const Je=x[Ue];Je.type==="circle"&&(R=!0),Je.type==="symbol"&&(Je.hasInitialOcclusionOpacityProperties?z=!0:R=!0)}let F=M.map(Ue=>x[Ue]);const G=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let $=0,q=!1;for(const Ue in G){const Je=G[Ue];Je.used&&(Je.prepare(this.context),Je.getSource().usedInConflation&&++$)}let ne=!1;for(const Ue of F)Ue.isHidden(this.transform.zoom)||(Ue.type==="clip"&&(ne=!0),this.prepareLayer(Ue));const J={},ie={},oe={},ce={},ge={};for(const Ue in G){const Je=G[Ue];J[Ue]=Je.getVisibleCoordinates(),ie[Ue]=J[Ue].slice().reverse(),oe[Ue]=Je.getVisibleCoordinates(!0).reverse(),ce[Ue]=Je.getShadowCasterCoordinates(),ge[Ue]=Je.sortCoordinatesByDistance(J[Ue])}const xe=Ue=>{const Je=this.style.getLayerSourceCache(Ue);return Je&&Je.used?Je.getSource():null};if($||ne||this._clippingActiveLastFrame){const Ue=[],Je=[];let Le=0;for(const lt of F)this.isSourceForClippingOrConflation(lt,xe(lt))&&(Ue.push(lt),Je.push(Le)),Le++;if(Ue&&(ne||Ue.length>1)||this._clippingActiveLastFrame){ne=!1;const lt=[];for(let Ye=0;Ye<Ue.length;Ye++){const pt=Ue[Ye],It=Je[Ye],ct=this.style.getLayerSourceCache(pt);if(!ct||!ct.used||!ct.getSource().usedInConflation&&pt.type!=="clip")continue;let wt=i.eu,Vt=i.bQ.None;const qt=[];let Bt=!0;if(pt.type==="clip"){wt=It;for(const Xt of pt.layout.get("clip-layer-types"))Vt|=Xt==="model"?i.bQ.Model:Xt==="symbol"?i.bQ.Symbol:i.bQ.FillExtrusion;for(const Xt of pt.layout.get("clip-layer-scope"))qt.push(Xt);pt.isHidden(this.transform.zoom)?Bt=!1:ne=!0}Bt&&lt.push({layer:pt.fqid,cache:ct,order:wt,clipMask:Vt,clipScope:qt})}this.replacementSource.setSources(lt),q=!0}}this._clippingActiveLastFrame=ne,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ue=0;Ue<F.length;Ue++){const Je=F[Ue],Le=Je.cutoffRange();if(this.longestCutoffRange=Math.max(Le,this.longestCutoffRange),Le>0){const lt=xe(Je);lt&&(this.minCutoffZoom=Math.max(lt.minzoom,this.minCutoffZoom)),Je.minzoom&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom))}Je.is3D(S)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ue),this._lastOcclusionLayer=Ue)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0,M=E(),F=M.map(Ue=>x[Ue]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ue in G)for(const Je of J[Ue]){let Le={min:0,max:0};this.terrain&&(Le=this.terrain.getMinMaxForTile(Je)||Le),Ae.addShadowReceiver(Je.toUnwrapped(),Le.min,Le.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Vl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new mi(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),be&&!this._rain&&(this._rain=new jg(this)),!be&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Zr.has(this.context.gl))return;this.renderPass="offscreen";for(const Ue of F){const Je=r.getLayerSourceCache(Ue);if(!Ue.hasOffscreenPass()||Ue.isHidden(this.transform.zoom))continue;const Le=Je?ie[Je.id]:void 0;(Ue.type==="custom"||Ue.type==="raster"||Ue.type==="raster-particle"||Ue.isSky()||Le&&Le.length)&&this.renderLayer(this,Je,Ue,Le)}this.depthRangeFor3D=[0,1-(F.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Re=(()=>{if(c.showOverdrawInspector)return i.am.black;const Ue=this.style.fog;if(Ue&&this.transform.projection.supportsFog){const Je=this.style.getLut(Ue.scope);if(!Ie){const Le=Ue.properties.get("color-use-theme")==="none",lt=Ue.properties.get("color").toNonPremultipliedRenderColor(Le?null:Je).toArray01();return new i.am(...lt)}if(Ie){const Le=Ue.properties.get("space-color-use-theme")==="none",lt=Ue.properties.get("space-color").toNonPremultipliedRenderColor(Le?null:Je).toArray01();return new i.am(...lt)}}return i.am.transparent})();if(this.context.clear({color:Re,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Ue=F[this.currentLayer],Je=r.getLayerSourceCache(Ue);if(Ue.isSky())continue;const Le=Je?(Ue.is3D(S)?ge:ie)[Je.id]:void 0;this._renderTileClippingMasks(Ue,Je,Le),this.renderLayer(this,Je,Ue,Le)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Ue=F[this.currentLayer],Je=r.getLayerSourceCache(Ue);Ue.isSky()&&this.renderLayer(this,Je,Ue,Je?ie[Je.id]:void 0)}function Be(Ue,Je){let Le;return Je&&(Le=(Ue.type==="symbol"?oe:Ue.is3D(S)?ge:ie)[Je.id]),Le}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Ue=F[this.currentLayer];if(Ue.type==="raster"||Ue.type==="raster-particle"){const Je=r.getLayerSourceCache(Ue);this.renderLayer(this,Je,Ue,Be(Ue,Je))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;Ae&&(Ge=Ae.getShadowCastingLayerCount());let st=!1,it=-1;for(let Ue=0;Ue<M.length;++Ue){const Je=F[Ue];Je.isHidden(this.transform.zoom)||Je.is3D(S)&&(it=Ue)}z&&it===-1&&(R=!0);let mt=!1;for(;this.currentLayer<M.length;){const Ue=F[this.currentLayer],Je=r.getLayerSourceCache(Ue);if(Ue.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ue)){if(Ue.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!mt&&Ue.is3D(S)&&!S){const Le=this.currentLayer,lt=Ye=>{for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const pt=F[this.currentLayer];if(Hl[pt.type]){const It=this.style.getLayerSourceCache(pt);Hl[pt.type](this,It,pt,Be(pt,It),Ye)}}};lt("initialize"),lt("reset"),this.currentLayer=Le,mt=!0}if(R&&!st&&this.terrain&&!this.transform.isOrthographic&&(st=!0,this.blitDepth()),z&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ue,Je,Je?J[Je.id]:void 0),this.renderLayer(this,Je,Ue,Be(Ue,Je)),!this.terrain&&Ae&&Ge>0&&Ue.hasShadowPass()&&--Ge==0){{this.clearStencil();const Le=this.currentLayer;for(this.currentLayer=0;this.currentLayer<F.length;this.currentLayer++){const lt=F[this.currentLayer];if(Kh[lt.type]){const Ye=this.style.getLayerSourceCache(lt);Kh[lt.type](this,Ye,lt,Be(lt,Ye))}}this.currentLayer=Le}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Le=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Le;this.currentLayer++){const lt=F[this.currentLayer];if(!lt.hasLightBeamPass())continue;const Ye=r.getLayerSourceCache(lt);this.renderLayer(this,Ye,lt,Ye?ie[Ye.id]:void 0)}this.currentLayer=Le,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Le=this.currentLayer;this.depthOcclusion=!0;for(const lt of this.layersWithOcclusionOpacity){this.currentLayer=lt;const Ye=F[this.currentLayer],pt=r.getLayerSourceCache(Ye),It=pt?ie[pt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ye,pt,pt?J[pt.id]:void 0),this.renderLayer(this,pt,Ye,It)}this.depthOcclusion=!1,this.currentLayer=Le,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ue=null;F.forEach(Je=>{const Le=r.getLayerSourceCache(Je);Le&&!Je.isHidden(this.transform.zoom)&&Le.getVisibleCoordinates().length&&(!Ue||Ue.getSource().maxzoom<Le.getSource().maxzoom)&&(Ue=Le)}),Ue&&this.options.showTileBoundaries&&ua(this,Ue,Ue.getVisibleCoordinates(),i.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ua(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ue){const Je=Ue.transform.padding;Wh(Ue,Ue.transform.height-(Je.top||0),3,Bl),Wh(Ue,Je.bottom||0,3,Xd),rs(Ue,Je.left||0,3,oo),rs(Ue,Ue.transform.width-(Je.right||0),3,dc);const Le=Ue.transform.centerPoint;(function(lt,Ye,pt,It){fc(lt,Ye-1,pt-10,2,20,It),fc(lt,Ye-10,pt-1,20,2,It)})(Ue,Le.x,Ue.transform.height-Le.y,ao)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(r.type);if(cp[r.type]&&(p||this.terrain&&r.type==="custom")){const x=this.style.getLayerSourceCache(r);cp[r.type](r,x,this)}this.gpuTimingEnd()}renderLayer(r,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(p.type)&&(!r.terrain||p.type!=="custom")||p.type==="clip"||Tr[p.type](r,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[r.id];x||(x=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(r.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const p in r){const x=r[p],S=this.context.extTimerQuery,E=S.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(x.query),c[p]=E}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of r)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(r,c,p,x,S){if(!p[0]&&!p[1])return r;const E=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(E){const z=Math.sin(E),F=Math.cos(E);p=[p[0]*F-p[1]*z,p[0]*z+p[1]*F]}const M=[S?p[0]:i.aw(c,p[0],this.transform.zoom),S?p[1]:i.aw(c,p[1],this.transform.zoom),0],R=new Float32Array(16);return i.bo(R,r,M),R}saveTileTexture(r){const c=r.size[0],p=this._tileTextures[c];p?p.push(r):this._tileTextures[c]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,S=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||S.push("FOG","FOG_DITHERING"),x&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(r,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,S=this.currentGlobalDefines(r,c&&c.overrideFog,c&&c.overrideRtt).concat(p),E=ju.cacheKey(zd[r],r,S,x);return this.cache[E]||(this.cache[E]=new ju(this.context,r,zd[r],x,Vu[r],S)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const S=((E,M,R)=>{const z=E.properties.get("direction"),F=E.properties.get("color-use-theme")==="none",G=E.properties.get("color").toNonPremultipliedRenderColor(F?null:R.getLut(E.scope)).toArray01(),$=E.properties.get("intensity"),q=M.properties.get("color-use-theme")==="none",ne=M.properties.get("color").toNonPremultipliedRenderColor(q?null:R.getLut(M.scope)).toArray01(),J=M.properties.get("intensity"),ie=[z.x,z.y,z.z],oe=i.dw(ne,J),ce=i.dw(G,$);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:ie,u_lighting_directional_color:ce,u_ground_radiance:zu(ie,ce,oe)}})(p,x,this.style);c.setLightsUniformValues(r,S)}}}uploadCommonUniforms(r,c,p,x,S){if(this.uploadCommonLightUniforms(r,c),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const M=E.getOpacity(this.transform.pitch),R=((z,F,G,$,q,ne,J,ie,oe,ce,ge,xe)=>{const Ce=z.transform,Ae=F.properties.get("color-use-theme")==="none",Te=F.properties.get("color").toNonPremultipliedRenderColor(Ae?null:z.style.getLut(F.scope)).toArray01();Te[3]=$;const be=z.frameCounter/1e3%1,[Ie,Re]=F.properties.get("vertical-range");return{u_fog_matrix:G?Ce.calculateFogTileMatrix(G):xe||z.identityMat,u_fog_range:F.getFovAdjustedRange(Ce._fov),u_fog_color:Te,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ie,Re),Re],u_fog_temporal_offset:be,u_frustum_tl:q,u_frustum_tr:ne,u_frustum_br:J,u_frustum_bl:ie,u_globe_pos:oe,u_globe_radius:ce,u_viewport:ge,u_globe_transition:i.ah(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,E,p,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],x);c.setFogUniformValues(r,R)}S&&c.setCutoffUniformValues(r,S.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=r[x.key]||new Dc(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,c){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[r.key];return c||(this._cachedTileFogOpacities[r.key]=c=this.style.fog.getOpacityForTile(r)),c[0]>=Ze||c[1]>=Ze}setupDepthForOcclusion(r,c,p){const x=this.context,S=x.gl,E=!!p;var M;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(S.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),x.activeTexture.set(S.TEXTURE0),E||c.setTerrainUniformValues(x,p)}}function mc(f,r){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,r),c=!1)};return()=>(c=!0,p||x(),p)}class km{constructor(r){this._hashName=r&&encodeURIComponent(r),i.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=mc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=up(r);if(this._hashName){const p=this._hashName;let x=!1;const S=location.hash.slice(1).split("&").map(E=>{const M=E.split("=")[0];return M===p?(x=!0,`${M}=${c}`):E}).filter(E=>E);return x||S.push(`${p}=${c}`),`#${S.join("&")}`}return`#${c}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(Number(p)))){const p=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function up(f,r){const c=f.getCenter(),p=Math.round(100*f.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),E=Math.round(c.lng*S)/S,M=Math.round(c.lat*S)/S,R=f.getBearing(),z=f.getPitch();let F=r?`/${E}/${M}/${p}`:`${p}/${M}/${E}`;return(R||z)&&(F+="/"+Math.round(10*R)/10),z&&(F+=`/${Math.round(z)}`),F}const qu={linearity:.3,easing:i.ew(0,0,.3,1)},hp=i.h({deceleration:2500,maxSpeed:1400},qu),gl=i.h({deceleration:20,maxSpeed:1400},qu),yl=i.h({deceleration:1e3,maxSpeed:360},qu),Qd=i.h({deceleration:1e3,maxSpeed:90},qu);class dp{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=i.q.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const S=Mo(c.pan.mag(),p,i.h({},hp,r||{}));x.offset=c.pan.mult(S.amount/c.pan.mag()),x.center=this._map.transform.center,Jh(x,S)}if(c.zoom){const S=Mo(c.zoom,p,gl);x.zoom=this._map.transform.zoom+S.amount,Jh(x,S)}if(c.bearing){const S=Mo(c.bearing,p,yl);x.bearing=this._map.transform.bearing+i.ay(S.amount,-179,179),Jh(x,S)}if(c.pitch){const S=Mo(c.pitch,p,Qd);x.pitch=this._map.transform.pitch+S.amount,Jh(x,S)}if(x.zoom||x.bearing){const S=c.pinchAround===void 0?c.around:c.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Jh(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function Mo(f,r,c){const{maxSpeed:p,linearity:x,deceleration:S}=c,E=i.ay(f*x/(r/1e3),-p,p),M=Math.abs(E)/(S*x);return{easing:c.easing,duration:1e3*M,amount:E*(M/2)}}class Ps extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,x={}){const S=Rt(c.getCanvasContainer(),p),E=c.unproject(S);super(r,i.h({point:S,lngLat:E,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class gc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const x=r==="touchend"?p.changedTouches:p.touches,S=fn(c.getCanvasContainer(),x),E=S.map(R=>c.unproject(R)),M=S.reduce((R,z,F,G)=>R.add(z.div(G.length)),new i.P(0,0));super(r,{points:S,point:M,lngLats:E,lngLat:c.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class yc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class fp{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new yc(this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new Ps(r.type,this._map,r))}mouseup(r){this._map.fire(new Ps(r.type,this._map,r))}preclick(r){const c=i.h({},r);c.type="preclick",this._map.fire(new Ps(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Ps(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Ps(r.type,this._map,r))}mouseover(r){this._map.fire(new Ps(r.type,this._map,r))}mouseout(r){this._map.fire(new Ps(r.type,this._map,r))}touchstart(r){return this._firePreventable(new gc(r.type,this._map,r))}touchmove(r){this._map.fire(new gc(r.type,this._map,r))}touchend(r){this._map.fire(new gc(r.type,this._map,r))}touchcancel(r){this._map.fire(new gc(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ef{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Ps(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ps("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Ps(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tf{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&r.button===0&&(ht(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=W("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const E=Math.min(x.x,p.x),M=Math.max(x.x,p.x),R=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${R}px)`,this._box.style.width=M-E+"px",this._box.style.height=z-R+"px")})}mouseupWindow(r,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&r.button===0){if(this.reset(),kt(),p.x!==x.x||p.y!==x.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:r})),{cameraAnimation:S=>S.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),at(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new i.A(r,{originalEvent:c}))}}function Gl(f,r){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class Rs{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const S=new i.P(0,0);for(const E of x)S._add(E);return S.div(x.length)}(c),this.touches=Gl(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const x=Gl(p,c);for(const S in this.touches){const E=x[S];(!E||E.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Wu{constructor(r){this.singleTap=new Rs(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const x=this.singleTap.touchend(r,c,p);if(x){const S=r.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(x)<30;if(S&&E||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Pm{constructor(){this._zoomIn=new Wu({numTouches:1,numTaps:2}),this._zoomOut=new Wu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const x=this._zoomIn.touchend(r,c,p),S=this._zoomOut.touchend(r,c,p);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:r})}):S?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(S)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pp={0:1,2:2},_c={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Qh{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=En(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p){if(r.preventDefault(),this._eventButton!=null&&function(x,S){const E=pp[S];return x.buttons===void 0||(x.buttons&E)!==E}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(r){this._lastPoint&&En(r)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mp extends Qh{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return c===0&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class nf extends Qh{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?_c[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Zu extends Qh{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?_c[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class ko{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),i.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!i.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,p)}}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const x=Gl(p,c),S=new i.P(0,0),E=new i.P(0,0);let M=0;for(const z in x){const F=x[z],G=this._touches[z];G&&(S._add(F),E._add(F.sub(G)),M++,x[z]=F)}if(this._touches=x,M<this._minTouches||!E.mag())return;const R=E.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ys{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){const x=this._firstTwoTouches;if(!x)return;r.preventDefault();const[S,E]=x,M=Xu(p,c,S),R=Xu(p,c,E);if(!M||!R)return;const z=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],z,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,E=Xu(p,c,x),M=Xu(p,c,S);E&&M||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xu(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function ed(f,r){return Math.log(f/r)/Math.LN2}class gp extends Ys{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ed(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ed(this._distance,p),pinchAround:c}}}function rf(f,r){return 180*f.angleWith(r)/Math.PI}class Rm extends Ys{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:rf(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=rf(r,p);return Math.abs(x)<c}}function td(f){return Math.abs(f.y)>Math.abs(f.x)}class Nm extends Ys{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,td(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const x=this._lastPoints;if(!x)return;const S=r[0].sub(x[0]),E=r[1].sub(x[1]);return this._map._cooperativeGestures&&!i.ex()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(S,E,p.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(S.y+E.y)/2*-.5})}gestureBeginsVertically(r,c,p){if(this._valid!==void 0)return this._valid;const x=r.mag()>=2,S=c.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=r.y>0==c.y>0;return td(r)&&td(c)&&E}}const yp={panStep:100,bearingStep:15,pitchStep:10};class Dm{constructor(){const r=yp;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,x=0,S=0,E=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),S=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),S=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),E=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Om,zoom:c?Math.round(R)+c*(r.shiftKey?2:1):R,bearing:M.getBearing()+p*this._bearingStep,pitch:M.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-E*this._panStep],center:M.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Om(f){return f*(2-f)}const sf=4.000244140625,_p=1/450;class Lm{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=_p,i.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||i.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=i.q.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%sf==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Rt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>sf?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&F!==0&&(F=1/F);const G=c(),$=Math.pow(2,G),q=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(q*F))),this._type==="wheel"&&(this._startZoom=G,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,S=this._easing;let E,M=!1;if(this._type==="wheel"&&x&&S){const z=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),F=S(z);E=i.ai(x,p,F),z<1?this._frameId||(this._frameId=!0):M=!0}else E=p,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=E-c();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=i.ey;if(this._prevEase){const p=this._prevEase,x=(i.q.now()-p.start)/p.duration,S=p.easing(x+.01)-p.easing(x),E=.27/Math.sqrt(S*S+1e-4)*.01,M=Math.sqrt(.0729-E*E);c=i.ew(E,M,.25,1)}return this._prevEase={start:i.q.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=W("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class xp{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class of{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fg{constructor(){this._tap=new Wu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zm{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jm{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bg{constructor(r,c,p,x){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ku=f=>f.zoom||f.drag||f.pitch||f.rotate;class si extends i.A{}class Vg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=i.at([],c,r);this.radius=i.ae(p[2]<0?i.eA([],p,this.constants):[p[0],p[1],0])}projectRay(r){i.eA(r,r,this.constants),i.au(r,r),i.eB(r,r,this.constants);const c=i.bY([],r,this.radius);if(c[2]>0){const p=i.bY([],[0,0,1],i.bG(c,[0,0,1])),x=i.bY([],i.au([],[c[0],c[1],0]),this.radius),S=i.cV([],c,i.bY([],i.at([],i.cV([],x,p),c),2));c[0]=S[0],c[1]=S[1]}return c}}function af(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class lf{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dp(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),i.aV(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,E]of this._listeners){const M=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(S,M,E)}}destroy(){for(const[r,c,p]of this._listeners){const x=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(c,x,p)}}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new fp(c,r));const x=c.boxZoom=new tf(c,r);this._add("boxZoom",x);const S=new Pm,E=new of;c.doubleClickZoom=new xp(E,S),this._add("tapZoom",S),this._add("clickZoom",E);const M=new Fg;this._add("tapDragZoom",M);const R=c.touchPitch=new Nm(c);this._add("touchPitch",R);const z=new nf(r),F=new Zu(r);c.dragRotate=new jm(r,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const G=new mp(r),$=new ko(c,r);c.dragPan=new zm(p,G,$),this._add("mousePan",G),this._add("touchPan",$,["touchZoom","touchRotate"]);const q=new Rm,ne=new gp;c.touchZoomRotate=new Bg(p,ne,q,M),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ef(c));const J=c.scrollZoom=new Lm(c,this);this._add("scrollZoom",J,["mousePan"]);const ie=c.keyboard=new Dm;this._add("keyboard",ie);for(const oe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[oe]&&c[oe].enable(r[oe])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ku(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,p){for(const x in r)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p=r.type==="renderFrame",x=p?void 0:r,S={needsRenderFrame:!1},E={},M={},R=r.touches?this._getMapTouches(r.touches):void 0,z=R?fn(this._el,R):p?void 0:Rt(this._el,r);for(const{handlerName:$,handler:q,allowed:ne}of this._handlers){if(!q.isEnabled())continue;let J;this._blockedByActive(M,ne,$)?q.reset():q[c||r.type]&&(J=q[c||r.type](r,z,R),this.mergeHandlerResult(S,E,J,$,x),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||q.isActive())&&(M[$]=q)}const F={};for(const $ in this._previousActiveHandlers)M[$]||(F[$]=x);this._previousActiveHandlers=M,(Object.keys(F).length||af(S))&&(this._changes.push([S,E,F]),this._triggerRenderFrame()),(Object.keys(M).length||af(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=S;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))}mergeHandlerResult(r,c,p,x,S){if(!p)return;i.h(r,p);const E={handlerName:x,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(c.zoom=E),p.panDelta!==void 0&&(c.drag=E),p.pitchDelta!==void 0&&(c.pitch=E),p.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const r={},c={},p={};for(const[x,S,E]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new i.P(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(r.around=x.around),x.aroundCoord!==void 0&&(r.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),i.h(c,S),i.h(p,E);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const x=this._map,S=x.transform,E=ce=>[ce.x,ce.y,ce.z];if((ce=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!af(r)){const ce=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ce!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!af(r))return void this._fireEvents(c,p,!0);let{panDelta:M,zoomDelta:R,bearingDelta:z,pitchDelta:F,around:G,aroundCoord:$,pinchAround:q}=r;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),q!==void 0&&(G=q),(R||(ce=>c[ce]&&!this._eventsInProgress[ce])("drag"))&&G&&(this._dragOrigin=E(S.pointCoordinate3D(G)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),G=G||x.transform.centerPoint,z&&(S.bearing+=z),F&&(S.pitch+=F),S._updateCameraState();const ne=[0,0,0];if(M)if(S.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(G).dir),ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(G.sub(M)).dir);ne[0]=ge[0]-ce[0],ne[1]=ge[1]-ce[1]}else{const ce=S.pointCoordinate(G);if(S.projection.name==="globe"){M=M.rotate(-S.angle);const ge=S._pixelsPerMercatorPixel/S.worldSize;ne[0]=-M.x*i.ez(i.aY(ce.y))*ge,ne[1]=-M.y*i.ez(S.center.lat)*ge}else{const ge=S.pointCoordinate(G.sub(M));ce&&ge&&(ne[0]=ge.x-ce.x,ne[1]=ge.y-ce.y)}}const J=S.zoom,ie=[0,0,0];if(R){const ce=E($||S.pointCoordinate3D(G)),ge={dir:i.au([],i.at([],ce,S._camera.position))};if(ge.dir[2]<0){const xe=S.zoomDeltaToMovement(ce,R);i.bY(ie,ge.dir,xe)}}const oe=i.cV(ne,ne,ie);S._translateCameraConstrained(oe),R&&Math.abs(S.zoom-J)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const x=Ku(this._eventsInProgress),S=Ku(r),E={};for(const F in r){const{originalEvent:G}=r[F];this._eventsInProgress[F]||(E[`${F}start`]=G),this._eventsInProgress[F]=r[F]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const F in E)this._fireEvent(F,E[F]);S&&this._fireEvent("move",S.originalEvent);for(const F in r){const{originalEvent:G}=r[F];this._fireEvent(F,G)}const M={};let R;for(const F in this._eventsInProgress){const{handlerName:G,originalEvent:$}=this._eventsInProgress[F];this._handlersById[G].isActive()||(delete this._eventsInProgress[F],R=c[G]||$,M[`${F}end`]=R)}for(const F in M)this._fireEvent(F,M[F]);const z=Ku(this._eventsInProgress);if(p&&(x||S)&&!z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),G=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;F?(G(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:R})):(this._map.fire(new i.A("moveend",{originalEvent:R})),G(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new i.A(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new si("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Fm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class nd extends i.E{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,i.aV(["_renderFrameCallback"],this)}getCenter(){return new i.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=i.P.convert(r).mult(-1),this.panTo(this.transform.center,i.h({offset:r},c),p)}panTo(r,c,p){return this.easeTo(i.h({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(i.h({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(i.h({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,i.h({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(i.h({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=i.aG.convert(r);const p=c&&c.bearing||0,x=c&&c.pitch||0,S=r.getNorthWest(),E=r.getSouthEast();return this._cameraForBounds(this.transform,S,E,p,x,c)}_extendPadding(r){const c={top:0,right:0,bottom:0,left:0};return r==null?i.h({},c,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:i.h({},c,r)}_extendCameraOptions(r){return(r=i.h({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>r.aspect?p/(2*Math.tan(.5*r.fovX)*r.aspect):x/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,p,x,S,E){const M=r.clone(),R=this._extendCameraOptions(E);M.bearing=x,M.pitch=S;const z=i.cd.convert(c),F=i.cd.convert(p),G=.5*(z.lat+F.lat),$=.5*(z.lng+F.lng),q=i.eC(G,$),ne=i.au([],q),J=i.au([],i.bF([],ne,[0,1,0])),ie=i.bF([],J,ne),oe=[J[0],J[1],J[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],ce=[q,i.eC(z.lat,z.lng),i.eC(F.lat,z.lng),i.eC(F.lat,F.lng),i.eC(z.lat,F.lng),i.eC(G,z.lng),i.eC(G,F.lng),i.eC(z.lat,$),i.eC(F.lat,$)];let ge=i.cW.fromPoints(ce.map(Ye=>[i.bG(J,Ye),i.bG(ie,Ye),i.bG(ne,Ye)]));const xe=i.ad([],ge.center,oe);i.eD(xe)===0&&i.eE(xe,0,0,1),i.au(xe,xe),i.bY(xe,xe,i.aB),M.center=i.eF(xe);const Ce=M.getWorldToCameraMatrix(),Ae=i.bi(new Float64Array(16),Ce);ge=i.cW.applyTransform(ge,i.az([],Ce,oe));const Te=this._extendAABB(ge,M,R,x);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ge=Te,i.ad(xe,xe,Ce);const be=.5*(ge.max[2]-ge.min[2]),Ie=this._minimumAABBFrustumDistance(M,ge),Re=i.bY([],[0,0,1],be),Be=i.cV(Re,xe,Re),Ge=Ie+(M.pitch===0?0:i.bD(xe,Be)),st=M.globeCenterInViewSpace,it=i.at([],xe,[st[0],st[1],st[2]]);i.au(it,it),i.bY(it,it,Ge);const mt=i.cV([],xe,it);i.ad(mt,mt,Ae);const Ue=i.eq/i.aB,Je=i.ae(mt),Le=i.c6(Math.max(Je*Ue-i.eq,Number.EPSILON),0),lt=Math.min(M.zoomFromMercatorZAdjusted(Le),R.maxZoom);return lt>.5*(i.cL+i.cx)?(M.setProjection({name:"mercator"}),M.zoom=lt,this._cameraForBounds(M,c,p,x,S,E)):{center:M.center,zoom:lt,bearing:x,pitch:S}}_extendAABB(r,c,p,x){const S=.5*((p.padding.left||0)+(p.padding.right||0)),E=.5*((p.padding.top||0)+(p.padding.bottom||0)),M=E,R=S,z=S,F=E,G=c.width-(R+z),$=c.height-(M+F),q=i.at([],r.max,r.min),ne=Math.min(G/q[0],$/q[1]),J=Math.min(c.scaleZoom(c.scale*ne),p.maxZoom);if(isNaN(J))return null;const ie=c.scale/c.zoomScale(J),oe=new i.cW([r.min[0]-R*ie,r.min[1]-F*ie,r.min[2]],[r.max[0]+z*ie,r.max[1]+M*ie,r.max[2]]),ce=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new i.P(p.offset.x,p.offset.y):i.P.convert(p.offset)).rotate(-i.al(x));return oe.center[0]-=ce.x*ie,oe.center[1]+=ce.y*ie,oe}queryTerrainElevation(r,c){const p=this.transform.elevation;return p?(c=i.h({},{exaggerated:!0},c),p.getAtPoint(i.ac.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,p,x,S,E){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,c,p,x,S,E);const M=r.clone(),R=this._extendCameraOptions(E);M.bearing=x,M.pitch=S;const z=i.cd.convert(c),F=i.cd.convert(p),G=new i.cd(z.lng,F.lat),$=new i.cd(F.lng,z.lat),q=M.project(z),ne=M.project(F),J=this.queryTerrainElevation(z),ie=this.queryTerrainElevation(F),oe=this.queryTerrainElevation(G),ce=this.queryTerrainElevation($),ge=[[q.x,q.y,Math.min(J||0,ie||0,oe||0,ce||0)],[ne.x,ne.y,Math.max(J||0,ie||0,oe||0,ce||0)]];let xe=i.cW.fromPoints(ge);const Ce=M.getWorldToCameraMatrix(),Ae=i.bi(new Float64Array(16),Ce);xe=i.cW.applyTransform(xe,Ce);const Te=this._extendAABB(xe,M,R,x);if(!Te)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");xe=Te;const be=.5*i.at([],xe.max,xe.min)[2],Ie=this._minimumAABBFrustumDistance(M,xe),Re=[0,0,1,0];i.aA(Re,Re,Ce),i.eG(Re,Re);const Be=i.bY([],Re,Ie+be),Ge=i.cV([],xe.center,Be);i.ad(xe.center,xe.center,Ae),i.ad(Ge,Ge,Ae);const st=M.unproject(new i.P(xe.center[0],xe.center[1])),it=i.eH(M.projection,st),mt=Math.pow(2,it),Ue=Math.min(M._zoomFromMercatorZ(Ge[2]*M.pixelsPerMeter*mt/M.worldSize),R.maxZoom);return M.mercatorFromTransition&&Ue<.5*(i.cL+i.cx)?(M.setProjection({name:"globe"}),M.zoom=Ue,this._cameraForBounds(M,c,p,x,S,E)):{center:st,zoom:Ue,bearing:x,pitch:S}}fitBounds(r,c,p){const x=this.cameraForBounds(r,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(r,c,p,x,S){const E=i.P.convert(r),M=i.P.convert(c),R=new i.P(Math.min(E.x,M.x),Math.min(E.y,M.y)),z=new i.P(Math.max(E.x,M.x),Math.max(E.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,M))return this;const F=this.transform.pointLocation3D(R),G=this.transform.pointLocation3D(z),$=this.transform.pointLocation3D(new i.P(R.x,z.y)),q=this.transform.pointLocation3D(new i.P(z.x,R.y)),ne=[Math.min(F.lng,G.lng,$.lng,q.lng),Math.min(F.lat,G.lat,$.lat,q.lat)],J=[Math.max(F.lng,G.lng,$.lng,q.lng),Math.max(F.lat,G.lat,$.lat,q.lat)],ie=x&&x.pitch?x.pitch:this.getPitch(),oe=this._cameraForBounds(this.transform,ne,J,p,ie,x);return this._fitInternal(oe,x,S)}_fitInternal(r,c,p){return r?(c=i.h(r,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(r,c){this.stop();const p=r.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,E=!1;"zoom"in r&&p.zoom!==+r.zoom&&(x=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=i.cd.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(S=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(E=!0,p.pitch=+r.pitch);const M=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!p.isPaddingEqual(M))if(r.retainPadding===!1){const R=p.clone();R.padding=M,p.setLocationAtPoint(p.center,R.centerPoint)}else p.padding=M;return r.preloadOnly?(this._preloadTiles(p),this):(this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),x&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),S&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),E&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Fm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return i.w(Fm),this;this.stop();const x=p.zoom,S=p.pitch,E=p.bearing;p.setFreeCameraOptions(r);const M=x!==p.zoom,R=S!==p.pitch,z=E!==p.bearing;return this.fire(new i.A("movestart",c)).fire(new i.A("move",c)),M&&this.fire(new i.A("zoomstart",c)).fire(new i.A("zoom",c)).fire(new i.A("zoomend",c)),z&&this.fire(new i.A("rotatestart",c)).fire(new i.A("rotate",c)).fire(new i.A("rotateend",c)),R&&this.fire(new i.A("pitchstart",c)).fire(new i.A("pitch",c)).fire(new i.A("pitchend",c)),this.fire(new i.A("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),((r=i.h({offset:[0,0],duration:500,easing:i.ey},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const p=this.transform,x=this.getZoom(),S=this.getBearing(),E=this.getPitch(),M=this.getPadding(),R="zoom"in r?+r.zoom:x,z="bearing"in r?this._normalizeBearing(r.bearing,S):S,F="pitch"in r?+r.pitch:E,G=this._extendPadding(r.padding),$=i.P.convert(r.offset);let q,ne,J;if(p.projection.name==="globe"){const Re=i.ac.fromLngLat(p.center),Be=$.rotate(-p.angle);Re.x+=Be.x/p.worldSize,Re.y+=Be.y/p.worldSize;const Ge=Re.toLngLat(),st=i.cd.convert(r.center||Ge);this._normalizeCenter(st),q=p.centerPoint.add(Be),ne=new i.P(Re.x,Re.y).mult(p.worldSize),J=new i.P(i.aD(st.lng),i.aH(st.lat)).mult(p.worldSize).sub(ne)}else{q=p.centerPoint.add($);const Re=p.pointLocation(q),Be=i.cd.convert(r.center||Re);this._normalizeCenter(Be),ne=p.project(Re),J=p.project(Be).sub(ne)}const ie=p.zoomScale(R-x);let oe,ce;r.around&&(oe=i.cd.convert(r.around),ce=p.locationPoint(oe));const ge=this._zooming||R!==x,xe=this._rotating||S!==z,Ce=this._pitching||F!==E,Ae=!p.isPaddingEqual(G),Te=r.retainPadding===!1?p.clone():p,be=Re=>Be=>{if(ge&&(Re.zoom=i.ai(x,R,Be)),xe&&(Re.bearing=i.ai(S,z,Be)),Ce&&(Re.pitch=i.ai(E,F,Be)),Ae&&(Te.interpolatePadding(M,G,Be),q=Te.centerPoint.add($)),oe)Re.setLocationAtPoint(oe,ce);else{const Ge=Re.zoomScale(Re.zoom-x),st=R>x?Math.min(2,ie):Math.max(.5,ie),it=Math.pow(st,1-Be),mt=Re.unproject(ne.add(J.mult(Be*it)).mult(Ge));Re.setLocationAtPoint(Re.renderWorldCopies?mt.wrap():mt,q)}return r.preloadOnly||this._fireMoveEvents(c),Re};if(r.preloadOnly){const Re=this._emulate(be,r.duration,p);return this._preloadTiles(Re),this}const Ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ge,this._rotating=xe,this._pitching=Ce,this._padding=Ae,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,Ie),this._ease(be(p),Re=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Re)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new i.A("movestart",r)),this._zooming&&!p.zooming&&this.fire(new i.A("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new i.A("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new i.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new i.A("move",r)),this._zooming&&this.fire(new i.A("zoom",r)),this._rotating&&this.fire(new i.A("rotate",r)),this._pitching&&this.fire(new i.A("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new i.A("zoomend",r)),x&&this.fire(new i.A("rotateend",r)),S&&this.fire(new i.A("pitchend",r)),this.fire(new i.A("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const Ye=i.aF(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ye,c)}this.stop(),r=i.h({offset:[0,0],speed:1.2,curve:1.42,easing:i.ey},r);const p=this.transform,x=this.getZoom(),S=this.getBearing(),E=this.getPitch(),M=this.getPadding(),R="zoom"in r?i.ay(+r.zoom,p.minZoom,p.maxZoom):x,z="bearing"in r?this._normalizeBearing(r.bearing,S):S,F="pitch"in r?+r.pitch:E,G=this._extendPadding(r.padding),$=p.zoomScale(R-x),q=i.P.convert(r.offset);let ne=p.centerPoint.add(q);const J=p.pointLocation(ne),ie=i.cd.convert(r.center||J);this._normalizeCenter(ie);const oe=p.project(J),ce=p.project(ie).sub(oe);let ge=r.curve;const xe=Math.max(p.width,p.height),Ce=xe/$,Ae=ce.mag();if("minZoom"in r){const Ye=i.ay(Math.min(r.minZoom,x,R),p.minZoom,p.maxZoom),pt=xe/p.zoomScale(Ye-x);ge=Math.sqrt(pt/Ae*2)}const Te=ge*ge;function be(Ye){const pt=(Ce*Ce-xe*xe+(Ye?-1:1)*Te*Te*Ae*Ae)/(2*(Ye?Ce:xe)*Te*Ae);return Math.log(Math.sqrt(pt*pt+1)-pt)}function Ie(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Re(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Be=be(0);let Ge=function(Ye){return Re(Be)/Re(Be+ge*Ye)},st=function(Ye){return xe*((Re(Be)*(Ie(pt=Be+ge*Ye)/Re(pt))-Ie(Be))/Te)/Ae;var pt},it=(be(1)-Be)/ge;if(Math.abs(Ae)<1e-6||!isFinite(it)){if(Math.abs(xe-Ce)<1e-6)return this.easeTo(r,c);const Ye=Ce<xe?-1:1;it=Math.abs(Math.log(Ce/xe))/ge,st=function(){return 0},Ge=function(pt){return Math.exp(Ye*ge*pt)}}r.duration="duration"in r?+r.duration:1e3*it/("screenSpeed"in r?+r.screenSpeed/ge:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const mt=S!==z,Ue=F!==E,Je=!p.isPaddingEqual(G),Le=r.retainPadding===!1?p.clone():p,lt=Ye=>pt=>{const It=pt*it,ct=1/Ge(It);Ye.zoom=pt===1?R:x+Ye.scaleZoom(ct),mt&&(Ye.bearing=i.ai(S,z,pt)),Ue&&(Ye.pitch=i.ai(E,F,pt)),Je&&(Le.interpolatePadding(M,G,pt),ne=Le.centerPoint.add(q));const wt=pt===1?ie:Ye.unproject(oe.add(ce.mult(st(It))).mult(ct));return Ye.setLocationAtPoint(Ye.renderWorldCopies?wt.wrap():wt,ne),Ye._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ye};if(r.preloadOnly){const Ye=this._emulate(lt,r.duration,p);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=mt,this._pitching=Ue,this._padding=Je,this._prepareEase(c,!1),this._ease(lt(p),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){p.animate===!1||p.duration===0?(r(1),c()):(this._easeStart=i.q.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=i.bX(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,p){const x=Math.ceil(15*c/1e3),S=[],E=r(p.clone());for(let M=0;M<=x;M++){const R=E(M/x);S.push(R.clone())}return S}_preloadTiles(r,c){}}class Yu{constructor(r={}){this.options=r,i.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact,p=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=W("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=W("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(r){const p=c.reduce((x,S,E)=>(S.value&&(x+=`${S.key}=${S.value}${E<c.length-1?"&":""}`),x),"?");r.href=`${i.e.FEEDBACK_URL}/${p}#${up(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const S=c[x];if(S.used){const E=S.getSource();E.attribution&&r.indexOf(E.attribution)<0&&r.push(E.attribution)}}r.sort((x,S)=>x.length-S.length),r=r.filter((x,S)=>{for(let E=S+1;E<r.length;E++)if(r[E].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Js{constructor(){i.aV(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=W("div","mapboxgl-ctrl");const c=W("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class cf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class xc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=i.dk((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const Ju={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Xr extends i.A{constructor(r,c,p,x){const{point:S,lngLat:E,originalEvent:M,target:R}=r;super(r.type,{point:S,lngLat:E,originalEvent:M,target:R}),this.preventDefault=()=>{r.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class ql{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,c){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(r,i.b3(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const S=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,c)):S.size===0&&this.map.on(x,this.handleType),S.size===0&&this.interactionsByType.set(x,S),S.set(r,c),this.typeById.set(r,x)}get(r){const c=this.typeById.get(r);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(r):void 0}remove(r){const c=this.typeById.get(r);if(!c)return;this.typeById.delete(r),this.filters.delete(r);const p=this.interactionsByType.get(c);p&&(p.delete(r),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(r,c){const p=[];for(const[x,S]of c)S.target&&p.push({targetId:x,target:S.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(r,p,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());c.length&&(r.type="mouseenter",this.handleType(r,c));const p=new Map;for(const[x,{feature:S}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(S.id,S);p.size&&(r.type="mouseleave",this.handleType(r,Array.from(p.values())))}handleOut(r){const c=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);c.length&&(r.type="mouseleave",this.handleType(r,c)),this.hoveredFeatures.clear()}handleType(r,c){const p=r.type==="mouseenter";if(p&&!this.interactionsByType.has(r.type))return void i.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(r.type)).reverse(),S=!!c;c=c||this.queryTargets(r.point,x);let E=!1;const M=new Set;for(const R of c){for(const[z,F]of x){if(!F.target)continue;const G=R.variants?R.variants[z]:null;if(G){for(const $ of G){if(Nc($,R,M,z))continue;const q=new i.de(R,$),ne=Rc($,R,z);S&&(q.state=this.map.getFeatureState(q));const J=p?this.prevHoveredFeatures.get(ne):null,ie=new Xr(r,z,F,q),oe=J?J.stop:F.handler(ie);if(p&&this.hoveredFeatures.set(ne,{feature:R,stop:oe}),oe!==!1){E=!0;break}}if(E)break}}if(E)break}if(!E)for(const[R,z]of x){const{handler:F,target:G}=z;if(!G&&F(new Xr(r,R,z,null))!==!1)break}}}function qn(f,r){if(Array.isArray(f)&&Array.isArray(r)){const c=new Set(f),p=new Set(r);return c.size===p.size&&f.every(x=>p.has(x))}return i.bv(f,r)}const vc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},vp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ug{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new nf({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Zu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),i.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),ht()}move(r,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(r,c),S=x&&x.bearingDelta;if(S&&p.setBearing(p.getBearing()+S),this.mousePitch){const E=this.mousePitch.mousemoveWindow(r,c),M=E&&E.pitchDelta;M&&p.setPitch(p.getPitch()+M)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){at(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(i.h({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Rt(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Rt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=fn(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=fn(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function rd(f,r,c){if(f=new i.cd(f.lng,f.lat),r){const p=new i.cd(f.lng-360,f.lat),x=new i.cd(f.lng+360,f.lat),S=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),E=c.locationPoint3D(f).distSqr(r),M=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint3D(p).distSqr(r)<E&&(M||Math.abs(p.lng-c.center.lng)<S)?f=p:c.locationPoint3D(x).distSqr(r)<E&&(M||Math.abs(x.lng-c.center.lng)<S)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const Qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Na={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class eh extends i.E{constructor(r,c){super(),(r instanceof HTMLElement||c)&&(r=i.h({element:r},c)),i.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:S=1,draggable:E=!1,clickTolerance:M=0,rotation:R=Na.rotation,rotationAlignment:z=Na.rotationAlignment,pitchAlignment:F=Na.pitchAlignment,occludedOpacity:G=Na.occludedOpacity,altitude:$=Na.altitude}=r||{};this._anchor=p,this._color=x,this._scale=S,this._draggable=E,this._clickTolerance=M,this._rotation=R,this._rotationAlignment=z,this._pitchAlignment=F,this._occludedOpacity=G,this._altitude=$,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=i.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",J=>{J.preventDefault()}),this._element.addEventListener("mousedown",J=>{J.preventDefault()});const q=this._element.classList;for(const J in Qu)q.remove(`mapboxgl-marker-anchor-${J}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ne=r&&r.className?r.className.trim().split(/\s+/):[];q.add(...ne),this._popup=null}_createDefaultMarker(){const r=W("div"),c=re("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const p=re("radialGradient",{id:"shadowGradient"},re("defs",{},c));re("stop",{offset:"10%","stop-opacity":.4},p),re("stop",{offset:"100%","stop-opacity":.05},p),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=i.cd.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Na.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const p=r.unproject(c,this._altitude),x=r.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(p)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const p=r.unproject(c,this._altitude);let x;r._showingGlobe()&&i.eK(r.transform,this._lngLat)?x=0:(x=1-r._queryFogOpacity(p),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Qu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const r=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!r||p!=="map")return"";if(!c._showingGlobe()){const R=c.getPitch();return R?`rotateX(${R}deg)`:""}const x=i.cJ(i.eL(c.transform,this._lngLat)),S=r.sub(i.eM(c.transform)),E=Math.abs(S.x)+Math.abs(S.y);if(E===0)return"";const M=x/E;return`rotateX(${-S.y*M}deg) rotateY(${S.x*M}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const S=c.project(new i.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),E=c.project(new i.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(S);p=i.cJ(Math.atan2(E.y,E.x))-90}else p=-c.getBearing();else if(x==="horizon"){const S=i.af(4,6,c.getZoom()),E=i.eM(c.transform);E.y+=S*c.transform.height;const M=r.sub(E),R=i.cJ(Math.atan2(M.y,M.x));p=(R>90?R-270:R+90)*(1-S)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=rd(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=i.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const S=this._clickTolerance||c._clickTolerance;if(r.point.dist(p)<S)return;this._isDragging=!0}this._pos=r.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,p=this._pos;c&&p&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(p),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Na.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Na.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Na.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Na.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const bp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},id={maxWidth:100,unit:"metric"},th={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_l={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Da=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yi(f=new i.P(0,0),r="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(r){case"top":return new i.P(0,f);case"top-left":return new i.P(c,c);case"top-right":return new i.P(-c,c);case"bottom":return new i.P(0,-f);case"bottom-left":return new i.P(c,-c);case"bottom-right":return new i.P(-c,-c);case"left":return new i.P(f,0);case"right":return new i.P(-f,0)}return new i.P(0,0)}return f instanceof i.P||Array.isArray(f)?i.P.convert(f):i.P.convert(f[r]||[0,0])}return{version:A,supported:Y.supported,setRTLTextPlugin:i.eQ,getRTLTextPluginStatus:i.eP,Map:class extends nd{constructor(f){D.mark(P.create);const r=f;if((f=i.h({},vc,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&i.eI(window)&&(f.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new jf(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new cf,this._domRenderTaskQueue=new cf,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.a$(),this._locale=i.h({},Ju,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Ft(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const c=document.getElementById(f.container);if(!c)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=c}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,i.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new op),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new lf(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||i.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Wy(this),f.hash&&(this._hash=new km(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const c=f.bounds;c&&(this.resize(),this.fitBounds(c,i.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Yu({customAttribution:f.customAttribution})),this._logoControl=new Js,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new i.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new i.A(`${c.dataType}dataloading`,c))}),this._interactions=new ql(this)}_getMapId(){return this._mapId}addControl(f,r){if(r===void 0&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new i.A("movestart",f)).fire(new i.A("move",f)),this.fire(new i.A("resize",f)),r&&this.fire(new i.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(i.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(r=>r==="auto"?navigator.language:r):f}setLanguage(f){const r=this._parseLanguage(f);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,r=f.projection.name;let c;r==="globe"&&f.zoom>=i.cx?(f.setMercatorFromTransition(),c=!0):r==="mercator"&&f.zoom<i.cx&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,r){return this._updateProjection(f||r||{name:"mercator"})}_updateProjection(f){let r;return r=f.name==="globe"&&this.transform.zoom>=i.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,r){return this.transform.locationPoint3D(i.cd.convert(f),r)}unproject(f,r){return this.transform.pointLocation3D(i.P.convert(f),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,r,c){const p=x=>{let S=[];if(Array.isArray(r)){const E=r.filter(M=>this.getLayer(M));S=E.length?this.queryRenderedFeatures(x,{layers:E}):[]}else S=this.queryRenderedFeatures(x,{target:r});return S};if(f==="mouseenter"||f==="mouseover"){let x=!1;return{listener:c,targets:r,delegates:{mousemove:E=>{const M=p(E.point);M.length?x||(x=!0,c.call(this,new Ps(f,this,E.originalEvent,{features:M}))):x=!1},mouseout:()=>{x=!1}}}}if(f==="mouseleave"||f==="mouseout"){let x=!1;return{listener:c,targets:r,delegates:{mousemove:M=>{p(M.point).length?x=!0:x&&(x=!1,c.call(this,new Ps(f,this,M.originalEvent)))},mouseout:M=>{x&&(x=!1,c.call(this,new Ps(f,this,M.originalEvent)))}}}}{const x=S=>{const E=p(S.point);E.length&&(S.features=E,c.call(this,S),delete S.features)};return{listener:c,targets:r,delegates:{[f]:x}}}}on(f,r,c){if(typeof r=="function"||c===void 0)return super.on(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,r,c){if(typeof r=="function"||c===void 0)return super.once(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._createDelegatedListener(f,r,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,r,c){if(typeof r=="function"||c===void 0)return super.off(f,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(x=>{for(let S=0;S<x.length;S++){const E=x[S];if(E.listener===c&&qn(E.targets,r)){for(const M in E.delegates)this.off(M,E.delegates[M]);return x.splice(S,1),this}}})(p),this}queryRenderedFeatures(f,r){if(!this.style)return[];if(f===void 0||f instanceof i.P||Array.isArray(f)||r!==void 0||(r=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!r){const S=this.style.queryRenderedFeatures(f,void 0,this.transform),E=this.style.queryRenderedFeatureset(f,void 0,this.transform);return S.concat(E)}let c=!0;if(r.target&&(c=this._isTargetValid(r.target),c&&!r.layers))return this.style.queryRenderedFeatureset(f,r,this.transform);let p=!0;if(r.layers&&Array.isArray(r.layers)){for(const S of r.layers)if(!this._isValidId(S)){p=!1;break}if(p&&!r.target)return this.style.queryRenderedFeatures(f,r,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(f,r,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(f,r,this.transform))),x}querySourceFeatures(f,r){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,r)}isPointOnSurface(f){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&i.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(f))}addInteraction(f,r){return this._interactions.add(f,r),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,r){return r=i.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&f&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(f,(c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;i.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(f,r)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(r==null)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const c=i.h({},r);r&&r.config&&(c.initialConfig=r.config,delete c.config),this.style=new xo(this,c).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.d8(f)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const r of f)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(f)}addSource(f,r){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:S,content:E}={}){this._lazyInitEmptyStyle();const M=i.I.from(f);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:R,height:z,data:F}=i.q.getImageData(r);this.style.addImage(M,{data:new i.r({width:R,height:z},F),pixelRatio:c,stretchX:x,stretchY:S,content:E,sdf:p,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:z}=r,F=r;this.style.addImage(M,{data:new i.r({width:R,height:z},new Uint8Array(F.data)),pixelRatio:c,stretchX:x,stretchY:S,content:E,sdf:p,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}updateImage(f,r){this._lazyInitEmptyStyle();const c=i.I.from(f),p=this.style.getImage(c);if(!p)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?i.q.getImageData(r):r,{width:S,height:E,data:M}=x;if(S===void 0||E===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||E!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${S}, ${E})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const R=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new i.r({width:S,height:E},new Uint8Array(M)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(M,R),this.style.updateImage(c,p,z)}hasImage(f){return f?!!this.style&&!!this.style.getImage(i.I.from(f)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(i.I.from(f))}loadImage(f,r){i.o(this._requestManager.transformRequest(f,i.R.Image),(c,p)=>{r(c,p instanceof HTMLImageElement?i.q.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,r){this._lazyInitEmptyStyle(),this.style.addModel(f,r)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,r){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)):this}getSlot(f){const r=this.getLayer(f);return r&&r.slot||null}setSlot(f,r){return this.style.setSlot(f,r),this.style.mergeLayers(),this._update(!0)}addImport(f,r){return this.style.addImport(f,r).catch(c=>this.fire(new i.z(new Error("Failed to add import",c)))),this}updateImport(f,r){return typeof r!="string"&&r.id!==f?(this.removeImport(f),this.addImport(r)):(this.style.updateImport(f,r),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,r){return this.style.moveImport(f,r),this._update(!0)}moveLayer(f,r){return this._isValidId(f)?(this.style.moveLayer(f,r),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const r=this.style.getOwnLayer(f);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,r,c){return this._isValidId(f)?(this.style.setLayerZoomRange(f,r,c),this._update(!0)):this}setFilter(f,r,c={}){return this._isValidId(f)?(this.style.setFilter(f,r,c),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,r,c,p),this._update(!0)):this}getPaintProperty(f,r){return this._isValidId(f)?this.style.getPaintProperty(f,r):null}setLayoutProperty(f,r,c,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,r,c,p),this._update(!0)):this}getLayoutProperty(f,r){return this._isValidId(f)?this.style.getLayoutProperty(f,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,r){return this.style.setSchema(f,r),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,r){return this.style.setConfig(f,r),this._update(!0)}getConfigProperty(f,r){return this.style.getConfigProperty(f,r)}setConfigProperty(f,r,c){return this.style.setConfigProperty(f,r,c),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const r=f[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,r),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.cd.convert(f),this.transform):0}setFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,r),this._update())}removeFeatureState(f,r){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,r),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,p,x,S=this._container;for(;S&&(!p||!x);){const E=window.getComputedStyle(S).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),S=S.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=x?Math.abs(r/x):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=W("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=W("div","mapboxgl-canvas-container",f);this._canvas=W("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=W("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{p[x]=W("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=i.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);r!==-1&&this._markers.splice(r,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const r=this._popups.indexOf(f);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const f=i.h({},Y.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",f);r?(ni(r,!0),this.painter=new Yh(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.l.testSupport(r)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;this.fire(new i.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=i.q.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,F=this.transform.pitch,G=i.q.now(),$=new i.aa(z,{now:G,fadeDuration:S,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update($)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(p);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,D.mark(P.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const z=i.q.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const F=x.getQueryParameter(r,x.QUERY_RESULT)/1e6;x.deleteQuery(r),this.fire(new i.A("gpu-timing-frame",{cpuTime:z,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(z);this.fire(new i.A("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:F}))},50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(R||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(E=this._updateAverageElevation(p,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,D.mark(P.fullLoad),this._performanceMetricsCollection&&$n(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const r of this._markers)f&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!f||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(f,r=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=f;const E=Math.abs(x-S);if(E>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(S),c(S);this._averageElevation.easeTo(S,f,300)}else if(E>1e-4)return this._averageElevation.jumpTo(S),c(S)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){Fn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Bn||f.status===401)){const r=this.painter.context.gl;ni(r,!1),this._logoControl instanceof Js&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Zn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&cn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(S){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,S,0);const E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0];const x=f.length/4;for(let S=0;S<r.length;S++){const E=r[S];let M=0;for(let R=0;R<E.length;R+=4)E[R]===f[R]&&E[R+1]===f[R+1]&&E[R+2]===f[R+2]&&E[R+3]===f[R+3]&&(M+=1);p+=(c[S+2]-c[S+1])*(1-M/x)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Zr.delete(this.painter.context.gl),An.remove(),Pn.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=i.q.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(f){const r=this.style?this.style.getSourceCaches():[];return i.bt(r,(c,p)=>c._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,r){i.eJ(f,r)}get version(){return A}},NavigationControl:class{constructor(f={}){this.options=i.h({},vp,f),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(i.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),W("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),W("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=W("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const r=f.getZoom(),c=r===f.getMaxZoom(),p=r===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ug(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,r){const c=W("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends i.E{constructor(f={}){super();const r=navigator.geolocation;this.options=i.h({geolocation:r},bp,f),i.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=mc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>r(c.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",f)),this._finish()}}_updateCamera(f){const r=new i.cd(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=i.h({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new i.cd(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,r=i.c6(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=W("button","mapboxgl-ctrl-geolocate",this._container),W("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W("div","mapboxgl-user-location"),this._dotElement.appendChild(W("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(W("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new eh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=W("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new eh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Yu,ScaleControl:class{constructor(f={}){this.options=i.h({},id,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,p=r._containerWidth/2-f/2,x=r.unproject([p,c]),S=r.unproject([p+f,c]),E=x.distanceTo(S);if(this.options.unit==="imperial"){const M=3.2808*E;M>5280?this._setScale(f,M/5280,"mile"):this._setScale(f,M,"foot")}else this.options.unit==="nautical"?this._setScale(f,E/1852,"nautical-mile"):E>=1e3?this._setScale(f,E/1e3,"kilometer"):this._setScale(f,E,"meter")}_setScale(f,r,c){this._map._requestDomTask(()=>{const p=function(S){const E=Math.pow(10,`${Math.floor(S)}`.length-1);let M=S/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(R){const z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(M),E*M}(r),x=p/r;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${th[c]}`,this._container.style.width=f*x+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=W("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:i.w("Full screen control 'container' must be a DOM element.")),i.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=W("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=W("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(f){super(),this.options=i.h(Object.create(_l),f),this._altitude=this.options.altitude,i.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=i.cd.convert(f),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const r=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=W("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(f),this.options.closeButton){const c=this._closeButton=W("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._updateClassList(),r}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,p=this._pos;if(!r||!c||!p)return"bottom";const x=c.offsetWidth,S=c.offsetHeight,E=p.x<x/2,M=p.x>r.transform.width-x/2;if(p.y+f<S)return E?"top-left":M?"top-right":"top";if(p.y>r.transform.height-S){if(E)return"bottom-left";if(M)return"bottom-right"}return E?"left":M?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),f.className=r.join(" ")}_update(f){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=W("div","mapboxgl-popup",r.getContainer()),this._tip=W("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=rd(this._lngLat,this._pos,r.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f instanceof i.P?f:r.project(this._lngLat,this._altitude),S=Yi(this.options.offset),E=this._anchor=this._getAnchor(S.y),M=Yi(this.options.offset,E),R=x.add(M).round();r._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Qu[E]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&r._showingGlobe()){const x=i.eK(r.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Da);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:eh,Style:xo,LngLat:i.cd,LngLatBounds:i.aG,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Mu,Evented:i.E,config:i.e,prewarm:i.eO,clearPrewarmedResources:i.eN,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(f){i.e.ACCESS_TOKEN=f},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(f){i.e.API_URL=f},get workerCount(){return i.eX.workerCount},set workerCount(f){i.eX.workerCount=f},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){i.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){i.eW(f)},get workerUrl(){return i.eV.workerUrl},set workerUrl(f){i.eV.workerUrl=f},get workerClass(){return i.eV.workerClass},set workerClass(f){i.eV.workerClass=f},get workerParams(){return i.eV.workerParams},set workerParams(f){i.eV.workerParams=f},get dracoUrl(){return i.eU()},set dracoUrl(f){i.eT(f)},get meshoptUrl(){return i.eS()},set meshoptUrl(f){i.eR(f)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var b=h;return b})}(qv)),qv.exports}var x$=_$();const tg=Y0(x$),v$=()=>{const n=ee.useRef(null),t=ee.useRef(null),[s,l]=ee.useState(""),[h,m]=ee.useState(""),[b,i]=ee.useState(!1),A=[{name:"Saudi Arabia",coordinates:[45.0792,23.8859]},{name:"UAE",coordinates:[54.3773,24.4539]},{name:"Jordan",coordinates:[36.2384,30.5852]},{name:"Egypt",coordinates:[30.8025,26.8206]},{name:"Tunisia",coordinates:[9.5375,33.8869]},{name:"Morocco",coordinates:[-7.0926,31.7917]},{name:"Algeria",coordinates:[1.6596,28.0339]},{name:"Pakistan",coordinates:[69.3451,30.3753]}],P=[{name:"Nigeria",coordinates:[8.6753,9.082]},{name:"Cameroon",coordinates:[12.3547,7.3697]}],D=()=>{!n.current||!s||(tg.accessToken=s,t.current=new tg.Map({container:n.current,style:"mapbox://styles/mapbox/dark-v11",center:[25,25],zoom:2.5,pitch:0}),t.current.addControl(new tg.NavigationControl({visualizePitch:!0}),"top-right"),t.current.on("load",()=>{A.forEach(j=>{const U=document.createElement("div");U.className="primary-marker",U.style.cssText=`
          background-color: #3b82f6;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          border: 3px solid white;
          box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
          cursor: pointer;
        `,new tg.Marker(U).setLngLat(j.coordinates).setPopup(new tg.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${j.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Primary Focus</p>
                </div>
              `)).addTo(t.current)}),P.forEach(j=>{const U=document.createElement("div");U.className="secondary-marker",U.style.cssText=`
          background-color: #10b981;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          border: 2px solid white;
          box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
          cursor: pointer;
        `,new tg.Marker(U).setLngLat(j.coordinates).setPopup(new tg.Popup({offset:25}).setHTML(`
                <div style="padding: 8px; font-family: sans-serif;">
                  <h4 style="margin: 0 0 4px 0; color: #1f2937;">${j.name}</h4>
                  <p style="margin: 0; color: #6b7280; font-size: 12px;">Secondary Focus</p>
                </div>
              `)).addTo(t.current)}),t.current.addSource("africa-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-20,40],[55,40],[55,-35],[-20,-35],[-20,40]]]},properties:{}}]}}),t.current.addLayer({id:"africa-highlight",type:"fill",source:"africa-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}}),t.current.addSource("middle-east-highlight",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[25,45],[75,45],[75,10],[25,10],[25,45]]]},properties:{}}]}}),t.current.addLayer({id:"middle-east-highlight",type:"fill",source:"middle-east-highlight",paint:{"fill-color":"#f59e0b","fill-opacity":.1}})}),i(!0))};return ee.useEffect(()=>{s&&!b&&D()},[s,b]),ee.useEffect(()=>()=>{t.current&&t.current.remove()},[]),s?v.jsx("div",{className:"py-20 bg-gray-900 text-white",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),v.jsx("p",{className:"text-xl text-gray-300 mb-8",children:"Strategic investment regions across Africa and the Middle East"})]}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[v.jsx("div",{className:"lg:col-span-3",children:v.jsx("div",{className:"relative rounded-lg overflow-hidden shadow-2xl",children:v.jsx("div",{ref:n,className:"w-full h-96 lg:h-[500px]"})})}),v.jsxs("div",{className:"space-y-6",children:[v.jsxs(Rr,{className:"bg-gray-800 border-gray-700",children:[v.jsxs(Yr,{children:[v.jsx(Jr,{className:"text-white text-lg",children:"Primary Focus"}),v.jsx(_s,{className:"text-gray-300",children:"Core investment markets"})]}),v.jsx(Qr,{children:v.jsx("div",{className:"space-y-2",children:A.map((j,U)=>v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),v.jsx("span",{className:"text-gray-300 text-sm",children:j.name})]},U))})})]}),v.jsxs(Rr,{className:"bg-gray-800 border-gray-700",children:[v.jsxs(Yr,{children:[v.jsx(Jr,{className:"text-white text-lg",children:"Secondary Focus"}),v.jsx(_s,{className:"text-gray-300",children:"Selective opportunities"})]}),v.jsx(Qr,{children:v.jsx("div",{className:"space-y-2",children:P.map((j,U)=>v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),v.jsx("span",{className:"text-gray-300 text-sm",children:j.name})]},U))})})]}),v.jsxs(Rr,{className:"bg-gray-800 border-gray-700",children:[v.jsxs(Yr,{children:[v.jsx(Jr,{className:"text-white text-lg",children:"Opportunistic"}),v.jsx(_s,{className:"text-gray-300",children:"Broader regional approach"})]}),v.jsx(Qr,{children:v.jsxs("div",{className:"space-y-2",children:[v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),v.jsx("span",{className:"text-gray-300 text-sm",children:"African Markets"})]}),v.jsxs("div",{className:"flex items-center space-x-3",children:[v.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded-full"}),v.jsx("span",{className:"text-gray-300 text-sm",children:"Middle East"})]})]})})]})]})]})]})}):v.jsx("div",{className:"py-20 bg-gray-900 text-white",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Our Geographic Focus"}),v.jsx("p",{className:"text-xl text-gray-300",children:"Strategic investment regions across Africa and the Middle East"})]}),v.jsx("div",{className:"max-w-3xl mx-auto px-4",children:v.jsx(Rr,{className:"bg-gray-800 border-gray-700 overflow-hidden rounded-xl",children:v.jsx("img",{src:"/lovable-uploads/map.jpg",alt:"Map",className:"w-full h-auto object-contain"})})})]})})},b$=()=>{const n=[{name:"Agritech and Food Security",icon:fI,description:"Supporting innovative solutions for sustainable agriculture, precision farming, and food security across Africa"},{name:"Waste Management",icon:FB,description:"Investing in circular economy solutions, waste-to-energy technologies, and sustainable waste processing systems"},{name:"E-Mobility",icon:Yw,description:"Accelerating electric vehicle adoption, charging infrastructure, and sustainable transportation solutions"},{name:"RE Optimization",icon:CB,description:"Enhancing renewable energy efficiency through smart grid technologies and energy storage solutions"},{name:"Clean Industries",icon:cg,description:"Transforming industrial processes through clean technologies and sustainable manufacturing practices"},{name:"Sustainable Supply Chain",icon:GB,description:"Building transparent, efficient, and environmentally responsible supply chain solutions"}],t=[{title:"$40M Fund Size",description:"Targeting sustainability and climate tech startups from ideation to series A",icon:mP},{title:"Regional Focus",description:"Actively sourcing from Saudi Arabia, UAE, Jordan, Egypt, Tunisia, Morocco, Algeria, and Pakistan",icon:LB},{title:"Beyond Capital",description:"Venture building, expert guidance, and globalnetworkaccess",icon:cg}];return v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:["Powering the Future of Sustainability",v.jsxs("span",{className:"block",children:["and Climate Tech Across ",v.jsx("span",{className:"gradient-text",children:"MENA+"})]})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-4",children:"BetaVentures, the investment arm of Betawaves, invests in early-stage startups using technology to tackle climate and environmental challenges."}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"We support bold founders building real-world solutions that drive sustainability, resilience, and green growth across the MENA+ region."})]})})}),v.jsx("section",{className:"py-20",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Fund Highlights"}),v.jsx("p",{className:"text-xl text-gray-600",children:"Strategic investment focused on maximum impact"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:t.map((s,l)=>{const h=s.icon;return v.jsx(Rr,{className:"text-center hover:shadow-lg transition-shadow",children:v.jsxs(Yr,{children:[v.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(h,{className:"h-8 w-8 text-primary"})}),v.jsx(Jr,{className:"text-xl",children:s.title}),v.jsx(_s,{className:"text-base",children:s.description})]})},l)})})]})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Investment Focus"}),v.jsx("p",{className:"text-xl text-gray-600",children:"Six key sectors driving climate innovation across Africa"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:n.map((s,l)=>{const h=s.icon;return v.jsx(Rr,{className:"text-center hover:shadow-lg transition-shadow",children:v.jsxs(Yr,{children:[v.jsx("div",{className:"w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(h,{className:"h-8 w-8 text-primary"})}),v.jsx(Jr,{className:"text-lg",children:s.name}),v.jsx(_s,{className:"text-sm text-gray-600 mt-2",children:s.description})]})},l)})})]})}),v.jsx(v$,{}),v.jsx("section",{className:"py-20 bg-white",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Impact and Sustainability"}),v.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our commitment to responsible investing drives positive environmental and social outcomes"})]}),v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto",children:[v.jsxs(Rr,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[v.jsxs(Yr,{children:[v.jsx("div",{className:"w-16 h-16  bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(fI,{className:"h-8 w-8 text-primary"})}),v.jsx(Jr,{className:"text-xl text-center",children:"ESG Considerations"})]}),v.jsx(Qr,{children:v.jsxs(_s,{className:"text-base text-gray-600 space-y-4",children:[v.jsx("p",{children:"Investing with Purpose and Responsibility At Betaventures, ESG (Environmental, Social, and Governance) principles are embedded into every investment decision we make."}),v.jsxs("ul",{className:"space-y-2",children:[v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"Rigorous impact assessments for every portfolio company"})]}),v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"Tailored ESG action plans to improve performance over time"})]}),v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"Clear reporting on local and regional impact"})]}),v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:" Active advocacy for responsible innovation and sustainablegrowth"})]})]})]})})]}),v.jsxs(Rr,{className:"hover:shadow-lg transition-shadow animate-fade-in",children:[v.jsxs(Yr,{children:[v.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:v.jsx(cg,{className:"h-8 w-8 text-primary"})}),v.jsx(Jr,{className:"text-xl text-center",children:"Gender Lens Investing"})]}),v.jsx(Qr,{children:v.jsxs(_s,{className:"text-base text-gray-600 space-y-4",children:[v.jsx("p",{children:"We are committed to building a more inclusive and equitable startup ecosystem. Betaventures aims for at least 40% of its portfolio to be made up of startups founded or co-founded by women."}),v.jsxs("ul",{className:"space-y-2",children:[v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"To further support this mission, we are committing 1% of the funds carry to programs that empower girls and women in tech across theMENA+region."})]}),v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"Promoting workplace diversity and inclusion"})]}),v.jsxs("li",{className:"flex items-start",children:[v.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{children:"Creating products and services that benefit women"})]})]})]})})]})]})]})}),v.jsx("section",{className:"py-20 bg-gradient-to-r from-blue-600 via-primary to-cyan-500 text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-6",children:"Ready to Transform Climate Tech?"}),v.jsx("p",{className:"text-xl mb-12 opacity-90 max-w-2xl mx-auto",children:"Join us in building the future of climate technology across Africa"}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center",children:[v.jsxs(Rr,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[v.jsxs(Yr,{className:"text-center pb-4",children:[v.jsx(Jr,{className:"text-white text-xl mb-2",children:"For Startups"}),v.jsx(_s,{className:"text-white/80",children:"Apply for funding and join our ecosystem"})]}),v.jsx(Qr,{className:"text-center",children:v.jsx(on,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/submit_your_company",target:"_blank",rel:"noopener noreferrer",children:"Apply Now"})})})]}),v.jsxs(Rr,{className:"p-8 bg-white/10 backdrop-blur border-white/20",children:[v.jsxs(Yr,{className:"text-center pb-4",children:[v.jsx(Jr,{className:"text-white text-xl mb-2",children:"For Investors"}),v.jsx(_s,{className:"text-white/80",children:"Partner with us to drive climate impact"})]}),v.jsx(Qr,{className:"text-center",children:v.jsx(on,{size:"lg",variant:"secondary",className:"w-full",asChild:!0,children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/pacts?pid=9nGqvjKm&dgrid=08c2c772-f426-4763-a30a-6ad9d7279dd3",target:"_blank",rel:"noopener noreferrer",children:"Invest With Us"})})})]})]}),v.jsx("div",{className:"text-center mt-12",children:v.jsx(on,{asChild:!0,variant:"secondary",size:"lg",className:"bg-white/20 backdrop-blur border-white/30 text-white hover:bg-white hover:text-primary font-semibold rounded-xl",children:v.jsx("a",{href:"https://betaventuresfund1.decilehub.com/",target:"_blank",rel:"noopener noreferrer",children:"Learn More About Betaventures"})})})]})})]})},w$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all");ee.useEffect(()=>{(async()=>{try{const P=await rl.getCaseStudies();t(P)}catch(P){console.error("Error fetching case studies:",P)}finally{l(!1)}})()},[]);const b=["all",...Array.from(new Set(n.map(A=>A.industry)))],i=h==="all"?n:n.filter(A=>A.industry===h);return s?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:[v.jsx("span",{className:"gradient-text",children:"Our"})," Portfolio"]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Discover how we've helped startups overcome challenges, secure funding, and achieve remarkable growth. These are the stories of innovation, perseverance, and success."})]})})}),v.jsx("section",{className:"py-8 border-b",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:b.map(A=>v.jsx("button",{onClick:()=>m(A),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${h===A?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:A==="all"?"All Industries":A},A))})})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"grid grid-cols-1 gap-12",children:i.map((A,P)=>v.jsx(Rr,{className:`overflow-hidden  hover:shadow-xl transition-all duration-300 ${P%2===1?"lg:flex-row-reverse":""}`,children:v.jsxs("div",{className:"lg:flex",children:[v.jsx("div",{className:"lg:w-1/2",children:v.jsx("div",{className:"aspect-video lg:aspect-square",children:v.jsx("img",{src:A.image,alt:A.companyName,className:"w-full h-full object-cover"})})}),v.jsxs("div",{className:"lg:w-1/2 p-8",children:[v.jsxs(Yr,{className:"p-0 mb-6",children:[v.jsxs("div",{className:"flex items-center justify-between mb-4",children:[v.jsx(Jr,{className:"text-2xl",children:A.companyName}),v.jsx(_a,{variant:"secondary",children:A.industry})]}),v.jsx(_s,{className:"text-base",children:A.description})]}),v.jsxs(Qr,{className:"p-0 space-y-6",children:[v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"The Challenge"}),v.jsx("p",{className:"text-gray-600 text-sm",children:A.challenge})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Our Solution"}),v.jsx("p",{className:"text-gray-600 text-sm",children:A.solution})]})]}),v.jsxs("div",{children:[v.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Key Results"}),v.jsx("ul",{className:"space-y-2",children:A.results.map((D,j)=>v.jsxs("li",{className:"flex items-start text-sm",children:[v.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"}),v.jsx("span",{className:"text-gray-600",children:D})]},j))})]}),A.testimonial?.quote?.trim()&&v.jsxs("div",{className:"bg-primary/5 p-6 rounded-lg",children:[v.jsxs("blockquote",{className:"text-gray-700 italic mb-4",children:['"',A.testimonial.quote,'"']}),v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-4",children:v.jsx("span",{className:"text-primary font-semibold text-lg",children:A.testimonial.author?.charAt(0)||""})}),v.jsxs("div",{children:[v.jsx("div",{className:"font-semibold text-gray-900",children:A.testimonial.author}),v.jsx("div",{className:"text-sm text-gray-600",children:A.testimonial.position})]})]})]}),v.jsx("div",{className:"flex flex-wrap gap-2",children:A.tags.map((D,j)=>v.jsx(_a,{variant:"outline",className:"text-xs",children:D},j))})]})]})]})},A.id))})})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-12",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Our Impact"}),v.jsx("p",{className:"text-xl text-gray-600",children:"Numbers that showcase our commitment to startup success"})]}),v.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-8",children:[{value:"250+",label:"Startups Supported"},{value:"10+",label:"Innovation Programs"},{value:"12",label:"Startups from scratch"}].map((A,P)=>v.jsxs("div",{className:"text-center",children:[v.jsx("div",{className:"text-3xl md:text-4xl font-bold text-primary mb-2",children:A.value}),v.jsx("div",{className:"text-gray-600 text-sm",children:A.label})]},P))})]})})]})},S$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all"),[b,i]=ee.useState(""),[A,P]=ee.useState(!1),[D,j]=ee.useState(!1);ee.useEffect(()=>{(async()=>{try{const de=await rl.getBlogPosts();t(de)}catch(de){console.error("Error fetching blog posts:",de)}finally{l(!1)}})()},[]);const U=["all",...Array.from(new Set(n.map(re=>re.category)))],X=h==="all"?n:n.filter(re=>re.category===h),Y=re=>new Date(re).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),W=async re=>{if(re.preventDefault(),!!b){P(!0);try{(await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"",email:b,subject:"Newsletter",message:"",status:"unread"})})).ok&&(j(!0),i(""),setTimeout(()=>j(!1),3e3))}catch(de){console.error("Newsletter subscription error:",de)}finally{P(!1)}}};return s?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[v.jsx(on,{variant:"outline",size:"sm",className:"mb-6",asChild:!0,children:v.jsxs(Pi,{to:"/",className:"flex items-center space-x-2",children:[v.jsx(pd,{size:16}),v.jsx("span",{children:"Back to Home"})]})}),v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Startup ",v.jsx("span",{className:"gradient-text",children:"Insights"})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Stay updated with the latest trends, tips, and insights from the startup world. Our experts share knowledge to help you navigate your entrepreneurial journey."})]})})}),v.jsx("section",{className:"py-8 border-b",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:U.map(re=>v.jsx("button",{onClick:()=>m(re),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors ${h===re?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:re==="all"?"All Categories":re},re))})})}),X.length>0&&v.jsx("section",{className:"py-16",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"mb-8",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Featured Article"}),v.jsx("p",{className:"text-gray-600",children:"Our latest insights on startup growth and innovation"})]}),v.jsx(Rr,{className:"overflow-hidden hover:shadow-xl transition-shadow",children:v.jsxs("div",{className:"md:flex",children:[v.jsx("div",{className:"md:w-1/2",children:v.jsx("img",{src:X[0].image,alt:X[0].title,className:"w-full h-64 md:h-full object-cover"})}),v.jsxs("div",{className:"md:w-1/2 p-8",children:[v.jsxs(Yr,{className:"p-0 mb-4",children:[v.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[v.jsx(_a,{children:X[0].category}),v.jsx("span",{className:"text-sm text-gray-500",children:Y(X[0].publishDate)})]}),v.jsx(Jr,{className:"text-2xl md:text-3xl mb-4",children:X[0].title}),v.jsx(_s,{className:"text-base",children:X[0].excerpt})]}),v.jsx(Qr,{className:"p-0",children:v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:v.jsx("span",{className:"text-primary font-semibold",children:X[0].author.charAt(0)})}),v.jsxs("div",{children:[v.jsx("div",{className:"font-medium text-gray-900",children:X[0].author}),v.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),v.jsx(Pi,{to:`/blog/${X[0].id}`,className:"text-primary hover:text-primary/80 font-medium text-sm",children:"Read More "})]})})]})]})})]})}),v.jsx("section",{className:"py-16",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:X.slice(1).map(re=>v.jsxs(Rr,{className:"overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1",children:[v.jsx("div",{className:"aspect-video",children:v.jsx("img",{src:re.image,alt:re.title,className:"w-full h-full object-cover"})}),v.jsxs(Yr,{className:"pb-4",children:[v.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[v.jsx(_a,{variant:"secondary",className:"text-xs",children:re.category}),v.jsx("span",{className:"text-xs text-gray-500",children:Y(re.publishDate)})]}),v.jsx(Jr,{className:"text-lg leading-tight mb-2",children:re.title}),v.jsx(_s,{className:"text-sm line-clamp-3",children:re.excerpt})]}),v.jsxs(Qr,{className:"pt-0",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-8 h-8 bg-primary/20 rounded-full flex items-center justify-center mr-2",children:v.jsx("span",{className:"text-primary font-semibold text-sm",children:re.author.charAt(0)})}),v.jsx("span",{className:"text-sm text-gray-600",children:re.author})]}),v.jsx(Pi,{to:`/blog/${re.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read "})]}),v.jsx("div",{className:"flex flex-wrap gap-1 mt-4",children:re.tags.slice(0,3).map((de,Me)=>v.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:de},Me))})]})]},re.id))})})}),v.jsx("section",{className:"py-20 bg-primary text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Stay Updated"}),v.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Subscribe to our newsletter and get the latest startup insights delivered to your inbox."}),v.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[v.jsxs("form",{onSubmit:W,className:"flex flex-col sm:flex-row gap-4 max-w-md mx-auto",children:[v.jsx("input",{type:"email",placeholder:"Enter your email",className:"flex-1 px-4 py-3 rounded-lg text-gray-900 focus:outline-none focus:ring-2 focus:ring-white",value:b,onChange:re=>i(re.target.value),required:!0}),v.jsx("button",{type:"submit",disabled:A,className:"bg-white text-primary px-6 py-3 rounded-lg font-medium hover:bg-gray-100 transition-colors",children:A?"Subscribing...":"Subscribe"})]}),D&&v.jsx("p",{className:"text-green-400 mt-2",children:"Subscribed successfully!"})]})]})})]})},T$=()=>{const{id:n}=B6(),[t,s]=ee.useState(null),[l,h]=ee.useState(!0),[m,b]=ee.useState([]),{toast:i}=Dy();ee.useEffect(()=>{(async()=>{try{const X=await rl.getBlogPosts(),Y=X.find(W=>W.id===n);if(s(Y||null),Y){const W=X.filter(re=>re.category===Y.category&&re.id!==Y.id).slice(0,3);b(W)}}catch(X){console.error("Error fetching blog post:",X)}finally{h(!1)}})()},[n]);const A=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),P=U=>{const Y=U.split(" ").length;return`${Math.ceil(Y/200)} min read`},D=async()=>{const U=window.location.href,X={title:t?.title||"Blog Post",text:t?.excerpt||"",url:U};if(navigator.share&&/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))try{await navigator.share(X),i({title:"Shared successfully",description:"The blog post has been shared!"})}catch{j(U)}else j(U)},j=async U=>{try{await navigator.clipboard.writeText(U),i({title:"Link copied!",description:"Blog post link has been copied to clipboard."})}catch{const Y=document.createElement("textarea");Y.value=U,document.body.appendChild(Y),Y.focus(),Y.select();try{document.execCommand("copy"),i({title:"Link copied!",description:"Blog post link has been copied to clipboard."})}catch{i({title:"Share failed",description:"Unable to copy link. Please copy the URL manually.",variant:"destructive"})}document.body.removeChild(Y)}};return l?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):t?v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto",children:[v.jsxs(Pi,{to:"/blog",className:"inline-flex items-center text-primary hover:text-primary/80 mb-6",children:[v.jsx(pd,{className:"mr-2 h-4 w-4"}),"Back to Blog"]}),v.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[v.jsx(_a,{children:t.category}),v.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(Xw,{className:"h-4 w-4"}),A(t.publishDate)]}),v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(XB,{className:"h-4 w-4"}),t.author]}),v.jsxs("div",{className:"flex items-center gap-1",children:[v.jsx(EB,{className:"h-4 w-4"}),P(t.content)]})]})]}),v.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:t.title}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-8",children:t.excerpt}),v.jsxs("div",{className:"flex items-center gap-4",children:[v.jsxs("div",{className:"flex items-center",children:[v.jsx("div",{className:"w-12 h-12 bg-primary/20 rounded-full flex items-center justify-center mr-3",children:v.jsx("span",{className:"text-primary font-semibold text-lg",children:t.author.charAt(0)})}),v.jsxs("div",{children:[v.jsx("div",{className:"font-medium text-gray-900",children:t.author}),v.jsx("div",{className:"text-sm text-gray-500",children:"Author"})]})]}),v.jsxs(on,{variant:"outline",size:"sm",className:"ml-auto",onClick:D,children:[v.jsx(BB,{className:"h-4 w-4 mr-2"}),"Share"]})]})]})})}),v.jsx("section",{className:"py-8",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"max-w-4xl mx-auto",children:v.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:v.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover"})})})})}),v.jsx("section",{className:"py-8",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto",children:[v.jsx("div",{className:"prose prose-lg max-w-none",children:v.jsx("div",{className:"text-gray-700 leading-relaxed space-y-6",dangerouslySetInnerHTML:{__html:t.content}})}),v.jsx("div",{className:"flex flex-wrap gap-2 mt-12 pt-8 border-t",children:t.tags.map((U,X)=>v.jsx(_a,{variant:"secondary",className:"text-sm",children:U},X))})]})})}),m.length>0&&v.jsx("section",{className:"py-16 bg-gray-50",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto",children:[v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-8",children:"Related Articles"}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:m.map(U=>v.jsxs(Rr,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[v.jsx("div",{className:"aspect-video",children:v.jsx("img",{src:U.image,alt:U.title,className:"w-full h-full object-cover"})}),v.jsxs(Qr,{className:"p-6",children:[v.jsx(_a,{variant:"secondary",className:"mb-3 text-xs",children:U.category}),v.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:U.title}),v.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:U.excerpt}),v.jsx(Pi,{to:`/blog/${U.id}`,className:"text-primary hover:text-primary/80 text-sm font-medium",children:"Read More "})]})]},U.id))})]})})})]}):v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Blog Post Not Found"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"The blog post you're looking for doesn't exist."}),v.jsx(Pi,{to:"/blog",children:v.jsxs(on,{children:[v.jsx(pd,{className:"mr-2 h-4 w-4"}),"Back to Blog"]})})]})})},E$=()=>{const[n,t]=ee.useState([]),[s,l]=ee.useState(!0),[h,m]=ee.useState("all");ee.useEffect(()=>{(async()=>{try{const j=await rl.getEvents();t(j)}catch(j){console.error("Error fetching events:",j)}finally{l(!1)}})()},[]);const b=["all","workshop","webinar","networking","pitch"],i=h==="all"?n:n.filter(D=>D.type===h),A=D=>new Date(D).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),P=D=>({workshop:"bg-blue-100 text-blue-800",webinar:"bg-green-100 text-green-800",networking:"bg-purple-100 text-purple-800",pitch:"bg-orange-100 text-orange-800"})[D]||"bg-gray-100 text-gray-800";return s?v.jsx("div",{className:"min-h-screen flex items-center justify-center",children:v.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 to-blue-50 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"text-center max-w-3xl mx-auto",children:[v.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:["Upcoming ",v.jsx("span",{className:"gradient-text",children:"Events"})]}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Join our community events, workshops, and networking sessions designed to accelerate your startup journey. Connect with fellow entrepreneurs, investors, and industry experts."})]})})}),v.jsx("section",{className:"py-8 border-b",children:v.jsx("div",{className:"container-width section-padding",children:v.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:b.map(D=>v.jsx("button",{onClick:()=>m(D),className:`px-4 py-2 rounded-full text-sm font-medium transition-colors capitalize ${h===D?"bg-primary text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:D==="all"?"All Events":D},D))})})}),v.jsx("section",{className:"py-20",children:v.jsx("div",{className:"container-width section-padding",children:i.length===0?v.jsxs("div",{className:"text-center py-20",children:[v.jsx(Xw,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),v.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No events found"}),v.jsx("p",{className:"text-gray-600",children:"Check back soon for upcoming events!"})]}):v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:i.map((D,j)=>v.jsx(Rr,{className:`overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1 ${j===0?"md:col-span-2 lg:col-span-2":""}`,children:v.jsxs("div",{className:`${j===0?"md:flex":""}`,children:[v.jsx("div",{className:`${j===0?"md:w-1/2":""} aspect-video`,children:v.jsx("img",{src:D.image,alt:D.title,className:"w-full h-full object-cover"})}),v.jsxs("div",{className:`${j===0?"md:w-1/2":""} p-6`,children:[v.jsxs(Yr,{className:"p-0 mb-4",children:[v.jsxs("div",{className:"flex items-center justify-between mb-3",children:[v.jsx(_a,{className:`capitalize ${P(D.type)}`,children:D.type}),v.jsxs("div",{className:"text-sm text-gray-500 flex items-center",children:[v.jsx(Xw,{className:"h-4 w-4 mr-1"}),D.time]})]}),v.jsx(Jr,{className:`${j===0?"text-2xl":"text-lg"} mb-2`,children:D.title}),v.jsx(_s,{className:"text-sm",children:D.description})]}),v.jsxs(Qr,{className:"p-0 space-y-4",children:[v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex items-start",children:[v.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Date:"}),v.jsx("span",{className:"text-gray-600",children:A(D.date)})]}),v.jsxs("div",{className:"flex items-start",children:[v.jsx("span",{className:"font-medium text-gray-900 mr-2",children:"Location:"}),v.jsx("span",{className:"text-gray-600",children:D.location})]})]}),v.jsx(on,{className:"w-full",size:j===0?"lg":"default",children:v.jsx("a",{href:D.registrationUrl,target:"_blank",rel:"noopener noreferrer",children:v.jsx(on,{className:"w-full",size:j===0?"lg":"default",children:"Register Now"})})})]})]})]})},D.id))})})}),v.jsx("section",{className:"py-20 bg-gray-50",children:v.jsxs("div",{className:"container-width section-padding",children:[v.jsxs("div",{className:"text-center mb-16",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-4",children:"Types of Events"}),v.jsx("p",{className:"text-xl text-gray-600",children:"We host various types of events to support your entrepreneurial journey"})]}),v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{type:"Workshops",description:"Hands-on learning sessions covering essential startup skills and technologies",icon:""},{type:"Webinars",description:"Online sessions with industry experts sharing insights and best practices",icon:""},{type:"Networking",description:"Connect with fellow entrepreneurs, mentors, and potential partners",icon:""},{type:"Pitch Events",description:"Opportunities to present your startup to investors and get feedback",icon:""}].map((D,j)=>v.jsxs(Rr,{className:"text-center p-6",children:[v.jsx("div",{className:"text-4xl mb-4",children:D.icon}),v.jsx("h3",{className:"text-lg font-semibold mb-2",children:D.type}),v.jsx("p",{className:"text-gray-600 text-sm",children:D.description})]},j))})]})}),v.jsx("section",{className:"py-20 bg-primary text-white",children:v.jsxs("div",{className:"container-width section-padding text-center",children:[v.jsx("h2",{className:"text-3xl md:text-4xl font-bold mb-4",children:"Want to Host an Event?"}),v.jsx("p",{className:"text-xl mb-8 opacity-90 max-w-2xl mx-auto",children:"Partner with us to organize workshops, networking events, or speaking sessions for our startup community."}),v.jsx(on,{size:"lg",variant:"secondary",children:"Partner With Us"})]})})]})},C$=()=>{const[n,t]=ee.useState({name:"",email:"",company:"",program:"",message:""}),[s,l]=ee.useState(!1),{toast:h}=Dy(),m=i=>{const{name:A,value:P}=i.target;t(D=>({...D,[A]:P}))},b=async i=>{if(i.preventDefault(),l(!0),!/^[a-zA-Z0-9._%+-]+@(?!gmail\.com$|yahoo\.com$|hotmail\.com$|outlook\.com$|icloud\.com$)[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(n.email)){h({title:"Invalid Email",description:"Please use your company email address (no Gmail, Yahoo, Outlook, etc.)",variant:"destructive"}),l(!1);return}try{const P=await fetch("https://betawaves-back.4bzwio.easypanel.host/api/contact-messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n.name,email:n.email,subject:n.program||n.company||"General Inquiry",message:n.message,timestamp:new Date,status:"unread"})});if(!P.ok){const D=await P.json();throw new Error(D.error||"Failed to send message")}h({title:"Message sent successfully!",description:"We'll get back to you within 48 hours."}),t({name:"",email:"",company:"",program:"",message:""})}catch(P){console.error("Submission error:",P),h({title:"Submission failed",description:P.message||"There was a problem sending your message. Please use your company email address (no Gmail, Yahoo, Outlook, etc.",variant:"destructive"})}finally{l(!1)}};return v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[v.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 mb-6",children:v.jsxs("span",{className:"block",children:["Get In ",v.jsx("span",{className:"gradient-text",children:"Touch"})]})}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed mb-4",children:"Ready to transform your ideas into reality?"}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed max-w-3xl mx-auto",children:"Let's discuss how Betawaves can support you in your journey."})]})})}),v.jsx("section",{className:"py-20",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16",children:[v.jsx("div",{className:"space-y-8",children:v.jsxs("div",{className:"space-y-6",children:[v.jsxs(Rr,{className:"p-6",children:[v.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Our Locations"}),v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx("h4",{className:"font-medium",children:"UAE, Dubai"}),v.jsx("p",{className:"text-gray-600 text-sm",children:"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"})]}),v.jsx("div",{})]})]}),v.jsxs(Rr,{className:"p-6",children:[v.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quick Contact"}),v.jsxs("div",{className:"space-y-3",children:[v.jsxs("div",{children:[v.jsx("span",{className:"font-medium",children:"General Inquiries:"}),v.jsx("br",{}),v.jsx("a",{href:"mailto:hello@betawaves.io",className:"text-primary hover:underline",children:"hello@betawaves.io"})]}),v.jsxs("div",{children:[v.jsx("span",{className:"font-medium",children:"Phone:"}),v.jsx("br",{}),v.jsx("a",{className:"text-primary hover:underline",children:"+971 58 829 0773"})]})]})]})]})}),v.jsx("div",{children:v.jsxs(Rr,{children:[v.jsxs(Yr,{children:[v.jsx(Jr,{className:"text-2xl",children:"Send us a message"}),v.jsx(_s,{children:"Fill out the form below and we'll get back to you within 48 hours."})]}),v.jsx(Qr,{children:v.jsxs("form",{onSubmit:b,className:"space-y-6",children:[v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"name",children:"Full Name *"}),v.jsx(Jn,{id:"name",name:"name",value:n.name,onChange:m,required:!0,className:"mt-1"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"email",children:"Company Email Address *"}),v.jsx(Jn,{id:"email",name:"email",type:"email",value:n.email,onChange:m,required:!0,className:"mt-1",pattern:"^[a-zA-Z0-9._%+-]+@(?!gmail\\.com$|yahoo\\.com$|hotmail\\.com$|outlook\\.com$|icloud\\.com$)[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$",title:"Please use your company email address (e.g., no Gmail, Yahoo, or Hotmail)"})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"company",children:"Company Name *"}),v.jsx(Jn,{id:"company",name:"company",required:!0,value:n.company,onChange:m,className:"mt-1"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"program",children:"Interest *"}),v.jsxs("select",{id:"program",name:"program",required:!0,value:n.program,onChange:m,className:"mt-1 w-full px-3 py-2 border border-input rounded-md focus:outline-none focus:ring-2 focus:ring-ring",children:[v.jsx("option",{value:"",children:"Select a program"}),v.jsx("option",{value:"Products",children:"Products"}),v.jsx("option",{value:"Innovation Consulting",children:"Innovation Consulting"}),v.jsx("option",{value:"Investment",children:"Investment"}),v.jsx("option",{value:"Other",children:"Other"})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"message",children:"Message *"}),v.jsx(fo,{id:"message",name:"message",value:n.message,onChange:m,required:!0,rows:5,className:"mt-1",placeholder:"Tell us about your startup, your goals, and how we can help..."})]}),v.jsx(on,{type:"submit",className:"w-full",size:"lg",disabled:s,children:s?"Sending...":"Send Message"})]})})]})})]})})})]})};function A$(n,t=[]){let s=[];function l(m,b){const i=ee.createContext(b),A=s.length;s=[...s,b];function P(j){const{scope:U,children:X,...Y}=j,W=U?.[n][A]||i,re=ee.useMemo(()=>Y,Object.values(Y));return v.jsx(W.Provider,{value:re,children:X})}function D(j,U){const X=U?.[n][A]||i,Y=ee.useContext(X);if(Y)return Y;if(b!==void 0)return b;throw new Error(`\`${j}\` must be used within \`${m}\``)}return P.displayName=m+"Provider",[P,D]}const h=()=>{const m=s.map(b=>ee.createContext(b));return function(i){const A=i?.[n]||m;return ee.useMemo(()=>({[`__scope${n}`]:{...i,[n]:A}}),[i,A])}};return h.scopeName=n,[l,I$(h,...t)]}function I$(...n){const t=n[0];if(n.length===1)return t;const s=()=>{const l=n.map(h=>({useScope:h(),scopeName:h.scopeName}));return function(m){const b=l.reduce((i,{useScope:A,scopeName:P})=>{const j=A(m)[`__scope${P}`];return{...i,...j}},{});return ee.useMemo(()=>({[`__scope${t.scopeName}`]:b}),[b])}};return s.scopeName=t.scopeName,s}var uw="rovingFocusGroup.onEntryFocus",M$={bubbles:!1,cancelable:!0},g1="RovingFocusGroup",[xS,UN,k$]=YS(g1),[P$,$N]=A$(g1,[k$]),[R$,N$]=P$(g1),HN=ee.forwardRef((n,t)=>v.jsx(xS.Provider,{scope:n.__scopeRovingFocusGroup,children:v.jsx(xS.Slot,{scope:n.__scopeRovingFocusGroup,children:v.jsx(D$,{...n,ref:t})})}));HN.displayName=g1;var D$=ee.forwardRef((n,t)=>{const{__scopeRovingFocusGroup:s,orientation:l,loop:h=!1,dir:m,currentTabStopId:b,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:A,onEntryFocus:P,preventScrollOnEntryFocus:D=!1,...j}=n,U=ee.useRef(null),X=us(t,U),Y=PT(m),[W=null,re]=Qp({prop:b,defaultProp:i,onChange:A}),[de,Me]=ee.useState(!1),Fe=Jl(P),ht=UN(s),at=ee.useRef(!1),[Dt,kt]=ee.useState(0);return ee.useEffect(()=>{const Rt=U.current;if(Rt)return Rt.addEventListener(uw,Fe),()=>Rt.removeEventListener(uw,Fe)},[Fe]),v.jsx(R$,{scope:s,orientation:l,dir:Y,loop:h,currentTabStopId:W,onItemFocus:ee.useCallback(Rt=>re(Rt),[re]),onItemShiftTab:ee.useCallback(()=>Me(!0),[]),onFocusableItemAdd:ee.useCallback(()=>kt(Rt=>Rt+1),[]),onFocusableItemRemove:ee.useCallback(()=>kt(Rt=>Rt-1),[]),children:v.jsx(ci.div,{tabIndex:de||Dt===0?-1:0,"data-orientation":l,...j,ref:X,style:{outline:"none",...n.style},onMouseDown:wr(n.onMouseDown,()=>{at.current=!0}),onFocus:wr(n.onFocus,Rt=>{const fn=!at.current;if(Rt.target===Rt.currentTarget&&fn&&!de){const En=new CustomEvent(uw,M$);if(Rt.currentTarget.dispatchEvent(En),!En.defaultPrevented){const xn=ht().filter(Yt=>Yt.focusable),Tn=xn.find(Yt=>Yt.active),Bn=xn.find(Yt=>Yt.id===W),wn=[Tn,Bn,...xn].filter(Boolean).map(Yt=>Yt.ref.current);WN(wn,D)}}at.current=!1}),onBlur:wr(n.onBlur,()=>Me(!1))})})}),GN="RovingFocusGroupItem",qN=ee.forwardRef((n,t)=>{const{__scopeRovingFocusGroup:s,focusable:l=!0,active:h=!1,tabStopId:m,...b}=n,i=wf(),A=m||i,P=N$(GN,s),D=P.currentTabStopId===A,j=UN(s),{onFocusableItemAdd:U,onFocusableItemRemove:X}=P;return ee.useEffect(()=>{if(l)return U(),()=>X()},[l,U,X]),v.jsx(xS.ItemSlot,{scope:s,id:A,focusable:l,active:h,children:v.jsx(ci.span,{tabIndex:D?0:-1,"data-orientation":P.orientation,...b,ref:t,onMouseDown:wr(n.onMouseDown,Y=>{l?P.onItemFocus(A):Y.preventDefault()}),onFocus:wr(n.onFocus,()=>P.onItemFocus(A)),onKeyDown:wr(n.onKeyDown,Y=>{if(Y.key==="Tab"&&Y.shiftKey){P.onItemShiftTab();return}if(Y.target!==Y.currentTarget)return;const W=z$(Y,P.orientation,P.dir);if(W!==void 0){if(Y.metaKey||Y.ctrlKey||Y.altKey||Y.shiftKey)return;Y.preventDefault();let de=j().filter(Me=>Me.focusable).map(Me=>Me.ref.current);if(W==="last")de.reverse();else if(W==="prev"||W==="next"){W==="prev"&&de.reverse();const Me=de.indexOf(Y.currentTarget);de=P.loop?j$(de,Me+1):de.slice(Me+1)}setTimeout(()=>WN(de))}})})})});qN.displayName=GN;var O$={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function L$(n,t){return t!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function z$(n,t,s){const l=L$(n.key,s);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(l))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(l)))return O$[l]}function WN(n,t=!1){const s=document.activeElement;for(const l of n)if(l===s||(l.focus({preventScroll:t}),document.activeElement!==s))return}function j$(n,t){return n.map((s,l)=>n[(t+l)%n.length])}var F$=HN,B$=qN,NT="Tabs",[V$,tK]=Eg(NT,[$N]),ZN=$N(),[U$,DT]=V$(NT),XN=ee.forwardRef((n,t)=>{const{__scopeTabs:s,value:l,onValueChange:h,defaultValue:m,orientation:b="horizontal",dir:i,activationMode:A="automatic",...P}=n,D=PT(i),[j,U]=Qp({prop:l,onChange:h,defaultProp:m});return v.jsx(U$,{scope:s,baseId:wf(),value:j,onValueChange:U,orientation:b,dir:D,activationMode:A,children:v.jsx(ci.div,{dir:D,"data-orientation":b,...P,ref:t})})});XN.displayName=NT;var KN="TabsList",YN=ee.forwardRef((n,t)=>{const{__scopeTabs:s,loop:l=!0,...h}=n,m=DT(KN,s),b=ZN(s);return v.jsx(F$,{asChild:!0,...b,orientation:m.orientation,dir:m.dir,loop:l,children:v.jsx(ci.div,{role:"tablist","aria-orientation":m.orientation,...h,ref:t})})});YN.displayName=KN;var JN="TabsTrigger",QN=ee.forwardRef((n,t)=>{const{__scopeTabs:s,value:l,disabled:h=!1,...m}=n,b=DT(JN,s),i=ZN(s),A=nD(b.baseId,l),P=rD(b.baseId,l),D=l===b.value;return v.jsx(B$,{asChild:!0,...i,focusable:!h,active:D,children:v.jsx(ci.button,{type:"button",role:"tab","aria-selected":D,"aria-controls":P,"data-state":D?"active":"inactive","data-disabled":h?"":void 0,disabled:h,id:A,...m,ref:t,onMouseDown:wr(n.onMouseDown,j=>{!h&&j.button===0&&j.ctrlKey===!1?b.onValueChange(l):j.preventDefault()}),onKeyDown:wr(n.onKeyDown,j=>{[" ","Enter"].includes(j.key)&&b.onValueChange(l)}),onFocus:wr(n.onFocus,()=>{const j=b.activationMode!=="manual";!D&&!h&&j&&b.onValueChange(l)})})})});QN.displayName=JN;var eD="TabsContent",tD=ee.forwardRef((n,t)=>{const{__scopeTabs:s,value:l,forceMount:h,children:m,...b}=n,i=DT(eD,s),A=nD(i.baseId,l),P=rD(i.baseId,l),D=l===i.value,j=ee.useRef(D);return ee.useEffect(()=>{const U=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(U)},[]),v.jsx(Mf,{present:h||D,children:({present:U})=>v.jsx(ci.div,{"data-state":D?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":A,hidden:!U,id:P,tabIndex:0,...b,ref:t,style:{...n.style,animationDuration:j.current?"0s":void 0},children:U&&m})})});tD.displayName=eD;function nD(n,t){return`${n}-trigger-${t}`}function rD(n,t){return`${n}-content-${t}`}var $$=XN,iD=YN,sD=QN,oD=tD;const H$=$$,aD=ee.forwardRef(({className:n,...t},s)=>v.jsx(iD,{ref:s,className:Ai("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...t}));aD.displayName=iD.displayName;const cd=ee.forwardRef(({className:n,...t},s)=>v.jsx(sD,{ref:s,className:Ai("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...t}));cd.displayName=sD.displayName;const hu=ee.forwardRef(({className:n,...t},s)=>v.jsx(oD,{ref:s,className:Ai("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...t}));hu.displayName=oD.displayName;const G$=({onLogout:n,onStyleSettingsOpen:t,onPopupManagementOpen:s})=>v.jsx("div",{className:"bg-white shadow-sm border-b",children:v.jsx("div",{className:"container-width section-padding",children:v.jsxs("div",{className:"py-6 flex justify-between items-center",children:[v.jsxs("div",{children:[v.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Content Management Dashboard"}),v.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your website content from this dashboard"})]}),v.jsxs("div",{className:"flex gap-2",children:[v.jsxs(on,{variant:"outline",onClick:s,className:"flex items-center gap-2",children:[v.jsx(zB,{size:16}),"Popup"]}),v.jsxs(on,{variant:"outline",onClick:t,className:"flex items-center gap-2",children:[v.jsx(jB,{size:16}),"Style Settings"]}),v.jsxs(on,{variant:"outline",onClick:n,className:"flex items-center gap-2",children:[v.jsx(OB,{size:16}),"Logout"]})]})]})})}),q$=({services:n,teamMembers:t,products:s,funds:l,messages:h,caseStudies:m,blogPosts:b,consulting:i})=>v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-7 gap-6 mb-7",children:[v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Consultings"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:i.length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Active Consultings"})]})]}),v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Team"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:t.length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Team members"})]})]}),v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Products"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:s.length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Active products"})]})]}),v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Messages"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:h.filter(A=>A.status==="unread").length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Unread messages"})]})]}),v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Portfolio"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:m.length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Published studies"})]})]}),v.jsxs(Rr,{children:[v.jsx(Yr,{className:"pb-2",children:v.jsx(Jr,{className:"text-sm text-gray-600",children:"Blog Posts"})}),v.jsxs(Qr,{children:[v.jsx("div",{className:"text-2xl font-bold text-primary",children:b.length}),v.jsx("p",{className:"text-sm text-gray-600",children:"Published posts"})]})]})]}),W$=({isOpen:n,onClose:t,onSubmit:s,service:l})=>{const[h,m]=ee.useState({title:l?.title||"",description:l?.description||"",duration:l?.duration||"",eligibility:l?.eligibility||"",features:l?.features.join(`
`)||"",icon:l?.icon||"home",category:l?.category||"incubation",presentationUrl:l?.presentationUrl||""});ee.useEffect(()=>{m(l?{title:l.title||"",description:l.description||"",duration:l.duration||"",eligibility:l.eligibility||"",features:Array.isArray(l.features)?l.features.join(`
`):"",icon:l.icon||"home",category:l.category||"incubation",presentationUrl:l.presentationUrl||""}:{title:"",description:"",duration:"",eligibility:"",features:"",icon:"home",category:"incubation",presentationUrl:""})},[l,n]);const b=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim()!=="")}),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Program":"Add New Program"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"title",children:"Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"category",children:"Category"}),v.jsxs("select",{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[v.jsx("option",{value:"incubation",children:"Incubation"}),v.jsx("option",{value:"acceleration",children:"Acceleration"}),v.jsx("option",{value:"mentorship",children:"Mentorship"}),v.jsx("option",{value:"funding",children:"Funding"})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"duration",children:"Duration"}),v.jsx(Jn,{id:"duration",value:h.duration,onChange:i=>m(A=>({...A,duration:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"eligibility",children:"Eligibility"}),v.jsx(Jn,{id:"eligibility",value:h.eligibility,onChange:i=>m(A=>({...A,eligibility:i.target.value})),required:!0})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"presentationUrl",children:"Link Redirection URL"}),v.jsx(Jn,{id:"presentationUrl",value:h.presentationUrl,onChange:i=>m(A=>({...A,presentationUrl:i.target.value})),placeholder:"https://www.hubspot.fr"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"features",children:"Features (one per line)"}),v.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),placeholder:"Enter each feature on a new line",rows:4})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"icon",children:"Icon"}),v.jsxs("select",{id:"icon",value:h.icon,onChange:i=>m(A=>({...A,icon:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[v.jsx("option",{value:"home",children:"Home"}),v.jsx("option",{value:"arrow-up",children:"Arrow Up"}),v.jsx("option",{value:"book",children:"Book"}),v.jsx("option",{value:"users",children:"Users"})]})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:l?"Update Program":"Add Program"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},Z$=({isOpen:n,onClose:t,onSubmit:s,consulting:l})=>{const[h,m]=ee.useState({title:l?.title||"",description:l?.description||"",eligibility:l?.eligibility||"",features:l?.features.join(`
`)||"",icon:l?.icon||"home",category:l?.category||"strategy",directUrl:l?.directUrl||""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,eligibility:l.eligibility,features:l.features.join(`
`),icon:l.icon,category:l.category,directUrl:l.directUrl||""}:{title:"",description:"",eligibility:"",features:"",icon:"home",category:"strategy",directUrl:""})},[l,n]);const b=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim()!=="")}),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Consulting":"Add New Consulting"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"title",children:"Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"category",children:"Category"}),v.jsxs("select",{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",required:!0,children:[v.jsx("option",{value:"strategy",children:"Strategy"}),v.jsx("option",{value:"product",children:"Product"}),v.jsx("option",{value:"marketing",children:"Marketing"}),v.jsx("option",{value:"funding",children:"Funding"})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"eligibility",children:"Duration"}),v.jsx(Jn,{id:"eligibility",value:h.eligibility,onChange:i=>m(A=>({...A,eligibility:i.target.value}))})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"directUrl",children:"Link Redirection URL"}),v.jsx(Jn,{id:"directUrl",value:h.directUrl,onChange:i=>m(A=>({...A,directUrl:i.target.value})),placeholder:"https://yourconsultinglink.com"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"features",children:"Features (one per line)"}),v.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),rows:4})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"icon",children:"Icon"}),v.jsxs("select",{id:"icon",value:h.icon,onChange:i=>m(A=>({...A,icon:i.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[v.jsx("option",{value:"home",children:"Home"}),v.jsx("option",{value:"target",children:"Target"}),v.jsx("option",{value:"lightbulb",children:"Lightbulb"}),v.jsx("option",{value:"users",children:"Users"})]})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:l?"Update Consulting":"Add Consulting"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},X$=({isOpen:n,onClose:t,onSubmit:s,product:l})=>{const[h,m]=ee.useState({name:l?.name||"",description:l?.description||"",category:l?.category||"",price:l?.price||"",features:l?.features?.join(`
`)||"",image:l?.image||"",status:l?.status||"active"});ee.useEffect(()=>{m(l?{name:l?.name||"",description:l?.description||"",category:l?.category||"",price:l?.price||"",features:l?.features?.join(`
`)||"",image:l?.image||"",status:l?.status||"active"}:{name:"",description:"",category:"",price:"",features:"",image:"",status:"active"})},[l,n]);const b=i=>{i.preventDefault(),s({...h,features:h.features.split(`
`).filter(A=>A.trim())}),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Product":"Add New Product"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"name",children:"Product Name"}),v.jsx(Jn,{id:"name",value:h.name,onChange:i=>m(A=>({...A,name:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"category",children:"Category"}),v.jsx(Jn,{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),required:!0})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"price",children:"Price"}),v.jsx(Jn,{id:"price",value:h.price,onChange:i=>m(A=>({...A,price:i.target.value})),placeholder:"$99/month"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"status",children:"Status"}),v.jsxs(Af,{value:h.status,onValueChange:i=>m(A=>({...A,status:i})),children:[v.jsx(gd,{children:v.jsx(If,{})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"active",children:"Active"}),v.jsx(ms,{value:"inactive",children:"Inactive"}),v.jsx(ms,{value:"coming-soon",children:"Coming Soon"})]})]})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"features",children:"Features (one per line)"}),v.jsx(fo,{id:"features",value:h.features,onChange:i=>m(A=>({...A,features:i.target.value})),placeholder:`Feature 1
Feature 2
Feature 3`,required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"image",children:"Link Redirection URL"}),v.jsx(Jn,{id:"image",type:"url",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:l?"Update Product":"Add Product"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},K$=({isOpen:n,onClose:t,onSubmit:s,fund:l})=>{const[h,m]=ee.useState({name:l?.name||"",description:l?.description||"",totalSize:l?.totalSize||"",currentRaise:l?.currentRaise||"",targetCompanies:l?.targetCompanies||"",stage:l?.stage||"",sectors:l?.sectors?.join(", ")||"",status:l?.status||"fundraising"});ee.useEffect(()=>{m(l?{name:l?.name||"",description:l?.description||"",totalSize:l?.totalSize||"",currentRaise:l?.currentRaise||"",targetCompanies:l?.targetCompanies||"",stage:l?.stage||"",sectors:l?.sectors?.join(", ")||"",status:l?.status||"fundraising"}:{name:"",description:"",totalSize:"",currentRaise:"",targetCompanies:"",stage:"",sectors:"",status:"fundraising"})},[l,n]);const b=i=>{i.preventDefault(),s({...h,sectors:h.sectors.split(",").map(A=>A.trim()).filter(A=>A)}),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Fund":"Add New Fund"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"name",children:"Fund Name"}),v.jsx(Jn,{id:"name",value:h.name,onChange:i=>m(A=>({...A,name:i.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"totalSize",children:"Total Fund Size"}),v.jsx(Jn,{id:"totalSize",value:h.totalSize,onChange:i=>m(A=>({...A,totalSize:i.target.value})),placeholder:"$50M",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"currentRaise",children:"Current Raise"}),v.jsx(Jn,{id:"currentRaise",value:h.currentRaise,onChange:i=>m(A=>({...A,currentRaise:i.target.value})),placeholder:"$35M",required:!0})]})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"targetCompanies",children:"Target Companies"}),v.jsx(Jn,{id:"targetCompanies",value:h.targetCompanies,onChange:i=>m(A=>({...A,targetCompanies:i.target.value})),placeholder:"25-30",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"stage",children:"Investment Stage"}),v.jsx(Jn,{id:"stage",value:h.stage,onChange:i=>m(A=>({...A,stage:i.target.value})),placeholder:"Pre-seed to Seed",required:!0})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"sectors",children:"Sectors (comma-separated)"}),v.jsx(Jn,{id:"sectors",value:h.sectors,onChange:i=>m(A=>({...A,sectors:i.target.value})),placeholder:"FinTech, HealthTech, AI/ML, SaaS",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"status",children:"Status"}),v.jsxs(Af,{value:h.status,onValueChange:i=>m(A=>({...A,status:i})),children:[v.jsx(gd,{children:v.jsx(If,{})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"fundraising",children:"Fundraising"}),v.jsx(ms,{value:"deployed",children:"Deployed"}),v.jsx(ms,{value:"closed",children:"Closed"})]})]})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:l?"Update Fund":"Add Fund"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},Y$=({isOpen:n,onClose:t,onSubmit:s,caseStudy:l})=>{const[h,m]=ee.useState({companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}});ee.useEffect(()=>{m(l?{companyName:l.companyName,industry:l.industry,description:l.description,challenge:l.challenge,solution:l.solution,results:l.results.join(`
`),tags:l.tags.join(", "),image:l.image,testimonial:l.testimonial}:{companyName:"",industry:"",description:"",challenge:"",solution:"",results:"",tags:"",image:"",testimonial:{quote:"",author:"",position:""}})},[l,n]);const b=async P=>{P.preventDefault();const D=h.results.split(`
`).map(U=>U.trim()).filter(U=>U),j=h.tags.split(",").map(U=>U.trim()).filter(U=>U);s({...h,results:D,tags:j}),t()},[i,A]=ee.useState(h.image);return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Case Study":"Add New Case Study"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"companyName",children:"Company Name"}),v.jsx(Jn,{id:"companyName",value:h.companyName,onChange:P=>m(D=>({...D,companyName:P.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"industry",children:"Industry"}),v.jsx(Jn,{id:"industry",value:h.industry,onChange:P=>m(D=>({...D,industry:P.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:P=>m(D=>({...D,description:P.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"challenge",children:"Challenge"}),v.jsx(fo,{id:"challenge",value:h.challenge,onChange:P=>m(D=>({...D,challenge:P.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"solution",children:"Solution"}),v.jsx(fo,{id:"solution",value:h.solution,onChange:P=>m(D=>({...D,solution:P.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"results",children:"Results (one per line)"}),v.jsx(fo,{id:"results",value:h.results,onChange:P=>m(D=>({...D,results:P.target.value})),placeholder:"Enter each result on a new line",rows:4,required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"tags",children:"Tags (comma-separated)"}),v.jsx(Jn,{id:"tags",value:h.tags,onChange:P=>m(D=>({...D,tags:P.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"image",children:"Image URL"}),v.jsx(Jn,{id:"image",type:"url",value:h.image,onChange:P=>{m(D=>({...D,image:P.target.value})),A(P.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),i&&v.jsx("img",{src:i,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{children:"Testimonial"}),v.jsxs("div",{className:"space-y-2 border p-4 rounded",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"testimonialQuote",children:"Quote"}),v.jsx(fo,{id:"testimonialQuote",value:h.testimonial.quote,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,quote:P.target.value}})),placeholder:"Enter testimonial quote"})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"testimonialAuthor",children:"Author"}),v.jsx(Jn,{id:"testimonialAuthor",value:h.testimonial.author,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,author:P.target.value}})),placeholder:"Author name"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"testimonialPosition",children:"Position"}),v.jsx(Jn,{id:"testimonialPosition",value:h.testimonial.position,onChange:P=>m(D=>({...D,testimonial:{...D.testimonial,position:P.target.value}})),placeholder:"Author position"})]})]})]})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsxs(on,{type:"submit",children:[l?"Update":"Add"," Case Study"]}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})};var hw={exports:{}},dw={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rM;function J$(){if(rM)return dw;rM=1;var n=yx();function t(j,U){return j===U&&(j!==0||1/j===1/U)||j!==j&&U!==U}var s=typeof Object.is=="function"?Object.is:t,l=n.useState,h=n.useEffect,m=n.useLayoutEffect,b=n.useDebugValue;function i(j,U){var X=U(),Y=l({inst:{value:X,getSnapshot:U}}),W=Y[0].inst,re=Y[1];return m(function(){W.value=X,W.getSnapshot=U,A(W)&&re({inst:W})},[j,X,U]),h(function(){return A(W)&&re({inst:W}),j(function(){A(W)&&re({inst:W})})},[j]),b(X),X}function A(j){var U=j.getSnapshot;j=j.value;try{var X=U();return!s(j,X)}catch{return!0}}function P(j,U){return U()}var D=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?P:i;return dw.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:D,dw}var iM;function lD(){return iM||(iM=1,hw.exports=J$()),hw.exports}var cD=lD();function La(n){this.content=n}La.prototype={constructor:La,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,s){var l=s&&s!=n?this.remove(s):this,h=l.find(n),m=l.content.slice();return h==-1?m.push(s||n,t):(m[h+1]=t,s&&(m[h]=s)),new La(m)},remove:function(n){var t=this.find(n);if(t==-1)return this;var s=this.content.slice();return s.splice(t,2),new La(s)},addToStart:function(n,t){return new La([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var s=this.remove(n).content.slice();return s.push(n,t),new La(s)},addBefore:function(n,t,s){var l=this.remove(t),h=l.content.slice(),m=l.find(n);return h.splice(m==-1?h.length:m,0,t,s),new La(h)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=La.from(n),n.size?new La(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=La.from(n),n.size?new La(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=La.from(n);for(var s=0;s<n.content.length;s+=2)t=t.remove(n.content[s]);return t},toObject:function(){var n={};return this.forEach(function(t,s){n[t]=s}),n},get size(){return this.content.length>>1}};La.from=function(n){if(n instanceof La)return n;var t=[];if(n)for(var s in n)t.push(s,n[s]);return new La(t)};function uD(n,t,s){for(let l=0;;l++){if(l==n.childCount||l==t.childCount)return n.childCount==t.childCount?null:s;let h=n.child(l),m=t.child(l);if(h==m){s+=h.nodeSize;continue}if(!h.sameMarkup(m))return s;if(h.isText&&h.text!=m.text){for(let b=0;h.text[b]==m.text[b];b++)s++;return s}if(h.content.size||m.content.size){let b=uD(h.content,m.content,s+1);if(b!=null)return b}s+=h.nodeSize}}function hD(n,t,s,l){for(let h=n.childCount,m=t.childCount;;){if(h==0||m==0)return h==m?null:{a:s,b:l};let b=n.child(--h),i=t.child(--m),A=b.nodeSize;if(b==i){s-=A,l-=A;continue}if(!b.sameMarkup(i))return{a:s,b:l};if(b.isText&&b.text!=i.text){let P=0,D=Math.min(b.text.length,i.text.length);for(;P<D&&b.text[b.text.length-P-1]==i.text[i.text.length-P-1];)P++,s--,l--;return{a:s,b:l}}if(b.content.size||i.content.size){let P=hD(b.content,i.content,s-1,l-1);if(P)return P}s-=A,l-=A}}class pn{constructor(t,s){if(this.content=t,this.size=s||0,s==null)for(let l=0;l<t.length;l++)this.size+=t[l].nodeSize}nodesBetween(t,s,l,h=0,m){for(let b=0,i=0;i<s;b++){let A=this.content[b],P=i+A.nodeSize;if(P>t&&l(A,h+i,m||null,b)!==!1&&A.content.size){let D=i+1;A.nodesBetween(Math.max(0,t-D),Math.min(A.content.size,s-D),l,h+D)}i=P}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,s,l,h){let m="",b=!0;return this.nodesBetween(t,s,(i,A)=>{let P=i.isText?i.text.slice(Math.max(t,A)-A,s-A):i.isLeaf?h?typeof h=="function"?h(i):h:i.type.spec.leafText?i.type.spec.leafText(i):"":"";i.isBlock&&(i.isLeaf&&P||i.isTextblock)&&l&&(b?b=!1:m+=l),m+=P},0),m}append(t){if(!t.size)return this;if(!this.size)return t;let s=this.lastChild,l=t.firstChild,h=this.content.slice(),m=0;for(s.isText&&s.sameMarkup(l)&&(h[h.length-1]=s.withText(s.text+l.text),m=1);m<t.content.length;m++)h.push(t.content[m]);return new pn(h,this.size+t.size)}cut(t,s=this.size){if(t==0&&s==this.size)return this;let l=[],h=0;if(s>t)for(let m=0,b=0;b<s;m++){let i=this.content[m],A=b+i.nodeSize;A>t&&((b<t||A>s)&&(i.isText?i=i.cut(Math.max(0,t-b),Math.min(i.text.length,s-b)):i=i.cut(Math.max(0,t-b-1),Math.min(i.content.size,s-b-1))),l.push(i),h+=i.nodeSize),b=A}return new pn(l,h)}cutByIndex(t,s){return t==s?pn.empty:t==0&&s==this.content.length?this:new pn(this.content.slice(t,s))}replaceChild(t,s){let l=this.content[t];if(l==s)return this;let h=this.content.slice(),m=this.size+s.nodeSize-l.nodeSize;return h[t]=s,new pn(h,m)}addToStart(t){return new pn([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new pn(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let s=0;s<this.content.length;s++)if(!this.content[s].eq(t.content[s]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let s=this.content[t];if(!s)throw new RangeError("Index "+t+" out of range for "+this);return s}maybeChild(t){return this.content[t]||null}forEach(t){for(let s=0,l=0;s<this.content.length;s++){let h=this.content[s];t(h,l,s),l+=h.nodeSize}}findDiffStart(t,s=0){return uD(this,t,s)}findDiffEnd(t,s=this.size,l=t.size){return hD(this,t,s,l)}findIndex(t){if(t==0)return Mv(0,t);if(t==this.size)return Mv(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let s=0,l=0;;s++){let h=this.child(s),m=l+h.nodeSize;if(m>=t)return m==t?Mv(s+1,m):Mv(s,l);l=m}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,s){if(!s)return pn.empty;if(!Array.isArray(s))throw new RangeError("Invalid input for Fragment.fromJSON");return new pn(s.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return pn.empty;let s,l=0;for(let h=0;h<t.length;h++){let m=t[h];l+=m.nodeSize,h&&m.isText&&t[h-1].sameMarkup(m)?(s||(s=t.slice(0,h)),s[s.length-1]=m.withText(s[s.length-1].text+m.text)):s&&s.push(m)}return new pn(s||t,l)}static from(t){if(!t)return pn.empty;if(t instanceof pn)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new pn([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}pn.empty=new pn([],0);const fw={index:0,offset:0};function Mv(n,t){return fw.index=n,fw.offset=t,fw}function c0(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let s=Array.isArray(n);if(Array.isArray(t)!=s)return!1;if(s){if(n.length!=t.length)return!1;for(let l=0;l<n.length;l++)if(!c0(n[l],t[l]))return!1}else{for(let l in n)if(!(l in t)||!c0(n[l],t[l]))return!1;for(let l in t)if(!(l in n))return!1}return!0}let xs=class vS{constructor(t,s){this.type=t,this.attrs=s}addToSet(t){let s,l=!1;for(let h=0;h<t.length;h++){let m=t[h];if(this.eq(m))return t;if(this.type.excludes(m.type))s||(s=t.slice(0,h));else{if(m.type.excludes(this.type))return t;!l&&m.type.rank>this.type.rank&&(s||(s=t.slice(0,h)),s.push(this),l=!0),s&&s.push(m)}}return s||(s=t.slice()),l||s.push(this),s}removeFromSet(t){for(let s=0;s<t.length;s++)if(this.eq(t[s]))return t.slice(0,s).concat(t.slice(s+1));return t}isInSet(t){for(let s=0;s<t.length;s++)if(this.eq(t[s]))return!0;return!1}eq(t){return this==t||this.type==t.type&&c0(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let s in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,s){if(!s)throw new RangeError("Invalid input for Mark.fromJSON");let l=t.marks[s.type];if(!l)throw new RangeError(`There is no mark type ${s.type} in this schema`);let h=l.create(s.attrs);return l.checkAttrs(h.attrs),h}static sameSet(t,s){if(t==s)return!0;if(t.length!=s.length)return!1;for(let l=0;l<t.length;l++)if(!t[l].eq(s[l]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return vS.none;if(t instanceof vS)return[t];let s=t.slice();return s.sort((l,h)=>l.type.rank-h.type.rank),s}};xs.none=[];class u0 extends Error{}class Yn{constructor(t,s,l){this.content=t,this.openStart=s,this.openEnd=l}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,s){let l=fD(this.content,t+this.openStart,s);return l&&new Yn(l,this.openStart,this.openEnd)}removeBetween(t,s){return new Yn(dD(this.content,t+this.openStart,s+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,s){if(!s)return Yn.empty;let l=s.openStart||0,h=s.openEnd||0;if(typeof l!="number"||typeof h!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new Yn(pn.fromJSON(t,s.content),l,h)}static maxOpen(t,s=!0){let l=0,h=0;for(let m=t.firstChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.firstChild)l++;for(let m=t.lastChild;m&&!m.isLeaf&&(s||!m.type.spec.isolating);m=m.lastChild)h++;return new Yn(t,l,h)}}Yn.empty=new Yn(pn.empty,0,0);function dD(n,t,s){let{index:l,offset:h}=n.findIndex(t),m=n.maybeChild(l),{index:b,offset:i}=n.findIndex(s);if(h==t||m.isText){if(i!=s&&!n.child(b).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(s))}if(l!=b)throw new RangeError("Removing non-flat range");return n.replaceChild(l,m.copy(dD(m.content,t-h-1,s-h-1)))}function fD(n,t,s,l){let{index:h,offset:m}=n.findIndex(t),b=n.maybeChild(h);if(m==t||b.isText)return n.cut(0,t).append(s).append(n.cut(t));let i=fD(b.content,t-m-1,s);return i&&n.replaceChild(h,b.copy(i))}function Q$(n,t,s){if(s.openStart>n.depth)throw new u0("Inserted content deeper than insertion position");if(n.depth-s.openStart!=t.depth-s.openEnd)throw new u0("Inconsistent open depths");return pD(n,t,s,0)}function pD(n,t,s,l){let h=n.index(l),m=n.node(l);if(h==t.index(l)&&l<n.depth-s.openStart){let b=pD(n,t,s,l+1);return m.copy(m.content.replaceChild(h,b))}else if(s.content.size)if(!s.openStart&&!s.openEnd&&n.depth==l&&t.depth==l){let b=n.parent,i=b.content;return hg(b,i.cut(0,n.parentOffset).append(s.content).append(i.cut(t.parentOffset)))}else{let{start:b,end:i}=eH(s,n);return hg(m,gD(n,b,i,t,l))}else return hg(m,h0(n,t,l))}function mD(n,t){if(!t.type.compatibleContent(n.type))throw new u0("Cannot join "+t.type.name+" onto "+n.type.name)}function bS(n,t,s){let l=n.node(s);return mD(l,t.node(s)),l}function ug(n,t){let s=t.length-1;s>=0&&n.isText&&n.sameMarkup(t[s])?t[s]=n.withText(t[s].text+n.text):t.push(n)}function G_(n,t,s,l){let h=(t||n).node(s),m=0,b=t?t.index(s):h.childCount;n&&(m=n.index(s),n.depth>s?m++:n.textOffset&&(ug(n.nodeAfter,l),m++));for(let i=m;i<b;i++)ug(h.child(i),l);t&&t.depth==s&&t.textOffset&&ug(t.nodeBefore,l)}function hg(n,t){return n.type.checkContent(t),n.copy(t)}function gD(n,t,s,l,h){let m=n.depth>h&&bS(n,t,h+1),b=l.depth>h&&bS(s,l,h+1),i=[];return G_(null,n,h,i),m&&b&&t.index(h)==s.index(h)?(mD(m,b),ug(hg(m,gD(n,t,s,l,h+1)),i)):(m&&ug(hg(m,h0(n,t,h+1)),i),G_(t,s,h,i),b&&ug(hg(b,h0(s,l,h+1)),i)),G_(l,null,h,i),new pn(i)}function h0(n,t,s){let l=[];if(G_(null,n,s,l),n.depth>s){let h=bS(n,t,s+1);ug(hg(h,h0(n,t,s+1)),l)}return G_(t,null,s,l),new pn(l)}function eH(n,t){let s=t.depth-n.openStart,h=t.node(s).copy(n.content);for(let m=s-1;m>=0;m--)h=t.node(m).copy(pn.from(h));return{start:h.resolveNoCache(n.openStart+s),end:h.resolveNoCache(h.content.size-n.openEnd-s)}}class ox{constructor(t,s,l){this.pos=t,this.path=s,this.parentOffset=l,this.depth=s.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,s=this.index(this.depth);if(s==t.childCount)return null;let l=this.pos-this.path[this.path.length-1],h=t.child(s);return l?t.child(s).cut(l):h}get nodeBefore(){let t=this.index(this.depth),s=this.pos-this.path[this.path.length-1];return s?this.parent.child(t).cut(0,s):t==0?null:this.parent.child(t-1)}posAtIndex(t,s){s=this.resolveDepth(s);let l=this.path[s*3],h=s==0?0:this.path[s*3-1]+1;for(let m=0;m<t;m++)h+=l.child(m).nodeSize;return h}marks(){let t=this.parent,s=this.index();if(t.content.size==0)return xs.none;if(this.textOffset)return t.child(s).marks;let l=t.maybeChild(s-1),h=t.maybeChild(s);if(!l){let i=l;l=h,h=i}let m=l.marks;for(var b=0;b<m.length;b++)m[b].type.spec.inclusive===!1&&(!h||!m[b].isInSet(h.marks))&&(m=m[b--].removeFromSet(m));return m}marksAcross(t){let s=this.parent.maybeChild(this.index());if(!s||!s.isInline)return null;let l=s.marks,h=t.parent.maybeChild(t.index());for(var m=0;m<l.length;m++)l[m].type.spec.inclusive===!1&&(!h||!l[m].isInSet(h.marks))&&(l=l[m--].removeFromSet(l));return l}sharedDepth(t){for(let s=this.depth;s>0;s--)if(this.start(s)<=t&&this.end(s)>=t)return s;return 0}blockRange(t=this,s){if(t.pos<this.pos)return t.blockRange(this);for(let l=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);l>=0;l--)if(t.pos<=this.end(l)&&(!s||s(this.node(l))))return new d0(this,t,l);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let s=1;s<=this.depth;s++)t+=(t?"/":"")+this.node(s).type.name+"_"+this.index(s-1);return t+":"+this.parentOffset}static resolve(t,s){if(!(s>=0&&s<=t.content.size))throw new RangeError("Position "+s+" out of range");let l=[],h=0,m=s;for(let b=t;;){let{index:i,offset:A}=b.content.findIndex(m),P=m-A;if(l.push(b,i,h+A),!P||(b=b.child(i),b.isText))break;m=P-1,h+=A+1}return new ox(s,l,m)}static resolveCached(t,s){let l=sM.get(t);if(l)for(let m=0;m<l.elts.length;m++){let b=l.elts[m];if(b.pos==s)return b}else sM.set(t,l=new tH);let h=l.elts[l.i]=ox.resolve(t,s);return l.i=(l.i+1)%nH,h}}class tH{constructor(){this.elts=[],this.i=0}}const nH=12,sM=new WeakMap;class d0{constructor(t,s,l){this.$from=t,this.$to=s,this.depth=l}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const rH=Object.create(null);let Wp=class wS{constructor(t,s,l,h=xs.none){this.type=t,this.attrs=s,this.marks=h,this.content=l||pn.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,s,l,h=0){this.content.nodesBetween(t,s,l,h,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,s,l,h){return this.content.textBetween(t,s,l,h)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,s,l){return this.type==t&&c0(this.attrs,s||t.defaultAttrs||rH)&&xs.sameSet(this.marks,l||xs.none)}copy(t=null){return t==this.content?this:new wS(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new wS(this.type,this.attrs,this.content,t)}cut(t,s=this.content.size){return t==0&&s==this.content.size?this:this.copy(this.content.cut(t,s))}slice(t,s=this.content.size,l=!1){if(t==s)return Yn.empty;let h=this.resolve(t),m=this.resolve(s),b=l?0:h.sharedDepth(s),i=h.start(b),P=h.node(b).content.cut(h.pos-i,m.pos-i);return new Yn(P,h.depth-b,m.depth-b)}replace(t,s,l){return Q$(this.resolve(t),this.resolve(s),l)}nodeAt(t){for(let s=this;;){let{index:l,offset:h}=s.content.findIndex(t);if(s=s.maybeChild(l),!s)return null;if(h==t||s.isText)return s;t-=h+1}}childAfter(t){let{index:s,offset:l}=this.content.findIndex(t);return{node:this.content.maybeChild(s),index:s,offset:l}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:s,offset:l}=this.content.findIndex(t);if(l<t)return{node:this.content.child(s),index:s,offset:l};let h=this.content.child(s-1);return{node:h,index:s-1,offset:l-h.nodeSize}}resolve(t){return ox.resolveCached(this,t)}resolveNoCache(t){return ox.resolve(this,t)}rangeHasMark(t,s,l){let h=!1;return s>t&&this.nodesBetween(t,s,m=>(l.isInSet(m.marks)&&(h=!0),!h)),h}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),yD(this.marks,t)}contentMatchAt(t){let s=this.type.contentMatch.matchFragment(this.content,0,t);if(!s)throw new Error("Called contentMatchAt on a node with invalid content");return s}canReplace(t,s,l=pn.empty,h=0,m=l.childCount){let b=this.contentMatchAt(t).matchFragment(l,h,m),i=b&&b.matchFragment(this.content,s);if(!i||!i.validEnd)return!1;for(let A=h;A<m;A++)if(!this.type.allowsMarks(l.child(A).marks))return!1;return!0}canReplaceWith(t,s,l,h){if(h&&!this.type.allowsMarks(h))return!1;let m=this.contentMatchAt(t).matchType(l),b=m&&m.matchFragment(this.content,s);return b?b.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=xs.none;for(let s=0;s<this.marks.length;s++){let l=this.marks[s];l.type.checkAttrs(l.attrs),t=l.addToSet(t)}if(!xs.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(s=>s.type.name)}`);this.content.forEach(s=>s.check())}toJSON(){let t={type:this.type.name};for(let s in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(s=>s.toJSON())),t}static fromJSON(t,s){if(!s)throw new RangeError("Invalid input for Node.fromJSON");let l;if(s.marks){if(!Array.isArray(s.marks))throw new RangeError("Invalid mark data for Node.fromJSON");l=s.marks.map(t.markFromJSON)}if(s.type=="text"){if(typeof s.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(s.text,l)}let h=pn.fromJSON(t,s.content),m=t.nodeType(s.type).create(s.attrs,h,l);return m.type.checkAttrs(m.attrs),m}};Wp.prototype.text=void 0;class f0 extends Wp{constructor(t,s,l,h){if(super(t,s,null,h),!l)throw new RangeError("Empty text nodes are not allowed");this.text=l}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):yD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,s){return this.text.slice(t,s)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new f0(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new f0(this.type,this.attrs,t,this.marks)}cut(t=0,s=this.text.length){return t==0&&s==this.text.length?this:this.withText(this.text.slice(t,s))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function yD(n,t){for(let s=n.length-1;s>=0;s--)t=n[s].type.name+"("+t+")";return t}class vg{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,s){let l=new iH(t,s);if(l.next==null)return vg.empty;let h=_D(l);l.next&&l.err("Unexpected trailing text");let m=hH(uH(h));return dH(m,l),m}matchType(t){for(let s=0;s<this.next.length;s++)if(this.next[s].type==t)return this.next[s].next;return null}matchFragment(t,s=0,l=t.childCount){let h=this;for(let m=s;h&&m<l;m++)h=h.matchType(t.child(m).type);return h}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:s}=this.next[t];if(!(s.isText||s.hasRequiredAttrs()))return s}return null}compatible(t){for(let s=0;s<this.next.length;s++)for(let l=0;l<t.next.length;l++)if(this.next[s].type==t.next[l].type)return!0;return!1}fillBefore(t,s=!1,l=0){let h=[this];function m(b,i){let A=b.matchFragment(t,l);if(A&&(!s||A.validEnd))return pn.from(i.map(P=>P.createAndFill()));for(let P=0;P<b.next.length;P++){let{type:D,next:j}=b.next[P];if(!(D.isText||D.hasRequiredAttrs())&&h.indexOf(j)==-1){h.push(j);let U=m(j,i.concat(D));if(U)return U}}return null}return m(this,[])}findWrapping(t){for(let l=0;l<this.wrapCache.length;l+=2)if(this.wrapCache[l]==t)return this.wrapCache[l+1];let s=this.computeWrapping(t);return this.wrapCache.push(t,s),s}computeWrapping(t){let s=Object.create(null),l=[{match:this,type:null,via:null}];for(;l.length;){let h=l.shift(),m=h.match;if(m.matchType(t)){let b=[];for(let i=h;i.type;i=i.via)b.push(i.type);return b.reverse()}for(let b=0;b<m.next.length;b++){let{type:i,next:A}=m.next[b];!i.isLeaf&&!i.hasRequiredAttrs()&&!(i.name in s)&&(!h.type||A.validEnd)&&(l.push({match:i.contentMatch,type:i,via:h}),s[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function s(l){t.push(l);for(let h=0;h<l.next.length;h++)t.indexOf(l.next[h].next)==-1&&s(l.next[h].next)}return s(this),t.map((l,h)=>{let m=h+(l.validEnd?"*":" ")+" ";for(let b=0;b<l.next.length;b++)m+=(b?", ":"")+l.next[b].type.name+"->"+t.indexOf(l.next[b].next);return m}).join(`
`)}}vg.empty=new vg(!0);class iH{constructor(t,s){this.string=t,this.nodeTypes=s,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function _D(n){let t=[];do t.push(sH(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function sH(n){let t=[];do t.push(oH(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function oH(n){let t=cH(n);for(;;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=aH(n,t);else break;return t}function oM(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let t=Number(n.next);return n.pos++,t}function aH(n,t){let s=oM(n),l=s;return n.eat(",")&&(n.next!="}"?l=oM(n):l=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:s,max:l,expr:t}}function lH(n,t){let s=n.nodeTypes,l=s[t];if(l)return[l];let h=[];for(let m in s){let b=s[m];b.isInGroup(t)&&h.push(b)}return h.length==0&&n.err("No node type or group '"+t+"' found"),h}function cH(n){if(n.eat("(")){let t=_D(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let t=lH(n,n.next).map(s=>(n.inline==null?n.inline=s.isInline:n.inline!=s.isInline&&n.err("Mixing inline and block content"),{type:"name",value:s}));return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function uH(n){let t=[[]];return h(m(n,0),s()),t;function s(){return t.push([])-1}function l(b,i,A){let P={term:A,to:i};return t[b].push(P),P}function h(b,i){b.forEach(A=>A.to=i)}function m(b,i){if(b.type=="choice")return b.exprs.reduce((A,P)=>A.concat(m(P,i)),[]);if(b.type=="seq")for(let A=0;;A++){let P=m(b.exprs[A],i);if(A==b.exprs.length-1)return P;h(P,i=s())}else if(b.type=="star"){let A=s();return l(i,A),h(m(b.expr,A),A),[l(A)]}else if(b.type=="plus"){let A=s();return h(m(b.expr,i),A),h(m(b.expr,A),A),[l(A)]}else{if(b.type=="opt")return[l(i)].concat(m(b.expr,i));if(b.type=="range"){let A=i;for(let P=0;P<b.min;P++){let D=s();h(m(b.expr,A),D),A=D}if(b.max==-1)h(m(b.expr,A),A);else for(let P=b.min;P<b.max;P++){let D=s();l(A,D),h(m(b.expr,A),D),A=D}return[l(A)]}else{if(b.type=="name")return[l(i,void 0,b.value)];throw new Error("Unknown expr type")}}}}function xD(n,t){return t-n}function aM(n,t){let s=[];return l(t),s.sort(xD);function l(h){let m=n[h];if(m.length==1&&!m[0].term)return l(m[0].to);s.push(h);for(let b=0;b<m.length;b++){let{term:i,to:A}=m[b];!i&&s.indexOf(A)==-1&&l(A)}}}function hH(n){let t=Object.create(null);return s(aM(n,0));function s(l){let h=[];l.forEach(b=>{n[b].forEach(({term:i,to:A})=>{if(!i)return;let P;for(let D=0;D<h.length;D++)h[D][0]==i&&(P=h[D][1]);aM(n,A).forEach(D=>{P||h.push([i,P=[]]),P.indexOf(D)==-1&&P.push(D)})})});let m=t[l.join(",")]=new vg(l.indexOf(n.length-1)>-1);for(let b=0;b<h.length;b++){let i=h[b][1].sort(xD);m.next.push({type:h[b][0],next:t[i.join(",")]||s(i)})}return m}}function dH(n,t){for(let s=0,l=[n];s<l.length;s++){let h=l[s],m=!h.validEnd,b=[];for(let i=0;i<h.next.length;i++){let{type:A,next:P}=h.next[i];b.push(A.name),m&&!(A.isText||A.hasRequiredAttrs())&&(m=!1),l.indexOf(P)==-1&&l.push(P)}m&&t.err("Only non-generatable nodes ("+b.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function vD(n){let t=Object.create(null);for(let s in n){let l=n[s];if(!l.hasDefault)return null;t[s]=l.default}return t}function bD(n,t){let s=Object.create(null);for(let l in n){let h=t&&t[l];if(h===void 0){let m=n[l];if(m.hasDefault)h=m.default;else throw new RangeError("No value supplied for attribute "+l)}s[l]=h}return s}function wD(n,t,s,l){for(let h in t)if(!(h in n))throw new RangeError(`Unsupported attribute ${h} for ${s} of type ${h}`);for(let h in n){let m=n[h];m.validate&&m.validate(t[h])}}function SD(n,t){let s=Object.create(null);if(t)for(let l in t)s[l]=new pH(n,l,t[l]);return s}let lM=class TD{constructor(t,s,l){this.name=t,this.schema=s,this.spec=l,this.markSet=null,this.groups=l.group?l.group.split(" "):[],this.attrs=SD(t,l.attrs),this.defaultAttrs=vD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(l.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==vg.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:bD(this.attrs,t)}create(t=null,s,l){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Wp(this,this.computeAttrs(t),pn.from(s),xs.setFrom(l))}createChecked(t=null,s,l){return s=pn.from(s),this.checkContent(s),new Wp(this,this.computeAttrs(t),s,xs.setFrom(l))}createAndFill(t=null,s,l){if(t=this.computeAttrs(t),s=pn.from(s),s.size){let b=this.contentMatch.fillBefore(s);if(!b)return null;s=b.append(s)}let h=this.contentMatch.matchFragment(s),m=h&&h.fillBefore(pn.empty,!0);return m?new Wp(this,t,s.append(m),xs.setFrom(l)):null}validContent(t){let s=this.contentMatch.matchFragment(t);if(!s||!s.validEnd)return!1;for(let l=0;l<t.childCount;l++)if(!this.allowsMarks(t.child(l).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){wD(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let s=0;s<t.length;s++)if(!this.allowsMarkType(t[s].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let s;for(let l=0;l<t.length;l++)this.allowsMarkType(t[l].type)?s&&s.push(t[l]):s||(s=t.slice(0,l));return s?s.length?s:xs.none:t}static compile(t,s){let l=Object.create(null);t.forEach((m,b)=>l[m]=new TD(m,s,b));let h=s.spec.topNode||"doc";if(!l[h])throw new RangeError("Schema is missing its top node type ('"+h+"')");if(!l.text)throw new RangeError("Every schema needs a 'text' type");for(let m in l.text.attrs)throw new RangeError("The text node type should not have attributes");return l}};function fH(n,t,s){let l=s.split("|");return h=>{let m=h===null?"null":typeof h;if(l.indexOf(m)<0)throw new RangeError(`Expected value of type ${l} for attribute ${t} on type ${n}, got ${m}`)}}class pH{constructor(t,s,l){this.hasDefault=Object.prototype.hasOwnProperty.call(l,"default"),this.default=l.default,this.validate=typeof l.validate=="string"?fH(t,s,l.validate):l.validate}get isRequired(){return!this.hasDefault}}class y1{constructor(t,s,l,h){this.name=t,this.rank=s,this.schema=l,this.spec=h,this.attrs=SD(t,h.attrs),this.excluded=null;let m=vD(this.attrs);this.instance=m?new xs(this,m):null}create(t=null){return!t&&this.instance?this.instance:new xs(this,bD(this.attrs,t))}static compile(t,s){let l=Object.create(null),h=0;return t.forEach((m,b)=>l[m]=new y1(m,h++,s,b)),l}removeFromSet(t){for(var s=0;s<t.length;s++)t[s].type==this&&(t=t.slice(0,s).concat(t.slice(s+1)),s--);return t}isInSet(t){for(let s=0;s<t.length;s++)if(t[s].type==this)return t[s]}checkAttrs(t){wD(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class ED{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let s=this.spec={};for(let h in t)s[h]=t[h];s.nodes=La.from(t.nodes),s.marks=La.from(t.marks||{}),this.nodes=lM.compile(this.spec.nodes,this),this.marks=y1.compile(this.spec.marks,this);let l=Object.create(null);for(let h in this.nodes){if(h in this.marks)throw new RangeError(h+" can not be both a node and a mark");let m=this.nodes[h],b=m.spec.content||"",i=m.spec.marks;if(m.contentMatch=l[b]||(l[b]=vg.parse(b,this.nodes)),m.inlineContent=m.contentMatch.inlineContent,m.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!m.isInline||!m.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=m}m.markSet=i=="_"?null:i?cM(this,i.split(" ")):i==""||!m.inlineContent?[]:null}for(let h in this.marks){let m=this.marks[h],b=m.spec.excludes;m.excluded=b==null?[m]:b==""?[]:cM(this,b.split(" "))}this.nodeFromJSON=h=>Wp.fromJSON(this,h),this.markFromJSON=h=>xs.fromJSON(this,h),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,s=null,l,h){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof lM){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(s,l,h)}text(t,s){let l=this.nodes.text;return new f0(l,l.defaultAttrs,t,xs.setFrom(s))}mark(t,s){return typeof t=="string"&&(t=this.marks[t]),t.create(s)}nodeType(t){let s=this.nodes[t];if(!s)throw new RangeError("Unknown node type: "+t);return s}}function cM(n,t){let s=[];for(let l=0;l<t.length;l++){let h=t[l],m=n.marks[h],b=m;if(m)s.push(m);else for(let i in n.marks){let A=n.marks[i];(h=="_"||A.spec.group&&A.spec.group.split(" ").indexOf(h)>-1)&&s.push(b=A)}if(!b)throw new SyntaxError("Unknown mark type: '"+t[l]+"'")}return s}function mH(n){return n.tag!=null}function gH(n){return n.style!=null}class Zp{constructor(t,s){this.schema=t,this.rules=s,this.tags=[],this.styles=[];let l=this.matchedStyles=[];s.forEach(h=>{if(mH(h))this.tags.push(h);else if(gH(h)){let m=/[^=]*/.exec(h.style)[0];l.indexOf(m)<0&&l.push(m),this.styles.push(h)}}),this.normalizeLists=!this.tags.some(h=>{if(!/^(ul|ol)\b/.test(h.tag)||!h.node)return!1;let m=t.nodes[h.node];return m.contentMatch.matchType(m)})}parse(t,s={}){let l=new hM(this,s,!1);return l.addAll(t,xs.none,s.from,s.to),l.finish()}parseSlice(t,s={}){let l=new hM(this,s,!0);return l.addAll(t,xs.none,s.from,s.to),Yn.maxOpen(l.finish())}matchTag(t,s,l){for(let h=l?this.tags.indexOf(l)+1:0;h<this.tags.length;h++){let m=this.tags[h];if(xH(t,m.tag)&&(m.namespace===void 0||t.namespaceURI==m.namespace)&&(!m.context||s.matchesContext(m.context))){if(m.getAttrs){let b=m.getAttrs(t);if(b===!1)continue;m.attrs=b||void 0}return m}}}matchStyle(t,s,l,h){for(let m=h?this.styles.indexOf(h)+1:0;m<this.styles.length;m++){let b=this.styles[m],i=b.style;if(!(i.indexOf(t)!=0||b.context&&!l.matchesContext(b.context)||i.length>t.length&&(i.charCodeAt(t.length)!=61||i.slice(t.length+1)!=s))){if(b.getAttrs){let A=b.getAttrs(s);if(A===!1)continue;b.attrs=A||void 0}return b}}}static schemaRules(t){let s=[];function l(h){let m=h.priority==null?50:h.priority,b=0;for(;b<s.length;b++){let i=s[b];if((i.priority==null?50:i.priority)<m)break}s.splice(b,0,h)}for(let h in t.marks){let m=t.marks[h].spec.parseDOM;m&&m.forEach(b=>{l(b=dM(b)),b.mark||b.ignore||b.clearMark||(b.mark=h)})}for(let h in t.nodes){let m=t.nodes[h].spec.parseDOM;m&&m.forEach(b=>{l(b=dM(b)),b.node||b.ignore||b.mark||(b.node=h)})}return s}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Zp(t,Zp.schemaRules(t)))}}const CD={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},yH={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},AD={ol:!0,ul:!0},ax=1,SS=2,q_=4;function uM(n,t,s){return t!=null?(t?ax:0)|(t==="full"?SS:0):n&&n.whitespace=="pre"?ax|SS:s&~q_}class kv{constructor(t,s,l,h,m,b){this.type=t,this.attrs=s,this.marks=l,this.solid=h,this.options=b,this.content=[],this.activeMarks=xs.none,this.match=m||(b&q_?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let s=this.type.contentMatch.fillBefore(pn.from(t));if(s)this.match=this.type.contentMatch.matchFragment(s);else{let l=this.type.contentMatch,h;return(h=l.findWrapping(t.type))?(this.match=l,h):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&ax)){let l=this.content[this.content.length-1],h;if(l&&l.isText&&(h=/[ \t\r\n\u000c]+$/.exec(l.text))){let m=l;l.text.length==h[0].length?this.content.pop():this.content[this.content.length-1]=m.withText(m.text.slice(0,m.text.length-h[0].length))}}let s=pn.from(this.content);return!t&&this.match&&(s=s.append(this.match.fillBefore(pn.empty,!0))),this.type?this.type.create(this.attrs,s,this.marks):s}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!CD.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class hM{constructor(t,s,l){this.parser=t,this.options=s,this.isOpen=l,this.open=0,this.localPreserveWS=!1;let h=s.topNode,m,b=uM(null,s.preserveWhitespace,0)|(l?q_:0);h?m=new kv(h.type,h.attrs,xs.none,!0,s.topMatch||h.type.contentMatch,b):l?m=new kv(null,null,xs.none,!0,null,b):m=new kv(t.schema.topNodeType,null,xs.none,!0,null,b),this.nodes=[m],this.find=s.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,s){t.nodeType==3?this.addTextNode(t,s):t.nodeType==1&&this.addElement(t,s)}addTextNode(t,s){let l=t.nodeValue,h=this.top,m=h.options&SS?"full":this.localPreserveWS||(h.options&ax)>0;if(m==="full"||h.inlineContext(t)||/[^ \t\r\n\u000c]/.test(l)){if(m)m!=="full"?l=l.replace(/\r?\n|\r/g," "):l=l.replace(/\r\n?/g,`
`);else if(l=l.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(l)&&this.open==this.nodes.length-1){let b=h.content[h.content.length-1],i=t.previousSibling;(!b||i&&i.nodeName=="BR"||b.isText&&/[ \t\r\n\u000c]$/.test(b.text))&&(l=l.slice(1))}l&&this.insertNode(this.parser.schema.text(l),s,!/\S/.test(l)),this.findInText(t)}else this.findInside(t)}addElement(t,s,l){let h=this.localPreserveWS,m=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let b=t.nodeName.toLowerCase(),i;AD.hasOwnProperty(b)&&this.parser.normalizeLists&&_H(t);let A=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,l));e:if(A?A.ignore:yH.hasOwnProperty(b))this.findInside(t),this.ignoreFallback(t,s);else if(!A||A.skip||A.closeParent){A&&A.closeParent?this.open=Math.max(0,this.open-1):A&&A.skip.nodeType&&(t=A.skip);let P,D=this.needsBlock;if(CD.hasOwnProperty(b))m.content.length&&m.content[0].isInline&&this.open&&(this.open--,m=this.top),P=!0,m.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,s);break e}let j=A&&A.skip?s:this.readStyles(t,s);j&&this.addAll(t,j),P&&this.sync(m),this.needsBlock=D}else{let P=this.readStyles(t,s);P&&this.addElementByRule(t,A,P,A.consuming===!1?i:void 0)}this.localPreserveWS=h}leafFallback(t,s){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),s)}ignoreFallback(t,s){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),s,!0)}readStyles(t,s){let l=t.style;if(l&&l.length)for(let h=0;h<this.parser.matchedStyles.length;h++){let m=this.parser.matchedStyles[h],b=l.getPropertyValue(m);if(b)for(let i=void 0;;){let A=this.parser.matchStyle(m,b,this,i);if(!A)break;if(A.ignore)return null;if(A.clearMark?s=s.filter(P=>!A.clearMark(P)):s=s.concat(this.parser.schema.marks[A.mark].create(A.attrs)),A.consuming===!1)i=A;else break}}return s}addElementByRule(t,s,l,h){let m,b;if(s.node)if(b=this.parser.schema.nodes[s.node],b.isLeaf)this.insertNode(b.create(s.attrs),l,t.nodeName=="BR")||this.leafFallback(t,l);else{let A=this.enter(b,s.attrs||null,l,s.preserveWhitespace);A&&(m=!0,l=A)}else{let A=this.parser.schema.marks[s.mark];l=l.concat(A.create(s.attrs))}let i=this.top;if(b&&b.isLeaf)this.findInside(t);else if(h)this.addElement(t,l,h);else if(s.getContent)this.findInside(t),s.getContent(t,this.parser.schema).forEach(A=>this.insertNode(A,l,!1));else{let A=t;typeof s.contentElement=="string"?A=t.querySelector(s.contentElement):typeof s.contentElement=="function"?A=s.contentElement(t):s.contentElement&&(A=s.contentElement),this.findAround(t,A,!0),this.addAll(A,l),this.findAround(t,A,!1)}m&&this.sync(i)&&this.open--}addAll(t,s,l,h){let m=l||0;for(let b=l?t.childNodes[l]:t.firstChild,i=h==null?null:t.childNodes[h];b!=i;b=b.nextSibling,++m)this.findAtPoint(t,m),this.addDOM(b,s);this.findAtPoint(t,m)}findPlace(t,s,l){let h,m;for(let b=this.open,i=0;b>=0;b--){let A=this.nodes[b],P=A.findWrapping(t);if(P&&(!h||h.length>P.length+i)&&(h=P,m=A,!P.length))break;if(A.solid){if(l)break;i+=2}}if(!h)return null;this.sync(m);for(let b=0;b<h.length;b++)s=this.enterInner(h[b],null,s,!1);return s}insertNode(t,s,l){if(t.isInline&&this.needsBlock&&!this.top.type){let m=this.textblockFromContext();m&&(s=this.enterInner(m,null,s))}let h=this.findPlace(t,s,l);if(h){this.closeExtra();let m=this.top;m.match&&(m.match=m.match.matchType(t.type));let b=xs.none;for(let i of h.concat(t.marks))(m.type?m.type.allowsMarkType(i.type):fM(i.type,t.type))&&(b=i.addToSet(b));return m.content.push(t.mark(b)),!0}return!1}enter(t,s,l,h){let m=this.findPlace(t.create(s),l,!1);return m&&(m=this.enterInner(t,s,l,!0,h)),m}enterInner(t,s,l,h=!1,m){this.closeExtra();let b=this.top;b.match=b.match&&b.match.matchType(t);let i=uM(t,m,b.options);b.options&q_&&b.content.length==0&&(i|=q_);let A=xs.none;return l=l.filter(P=>(b.type?b.type.allowsMarkType(P.type):fM(P.type,t))?(A=P.addToSet(A),!1):!0),this.nodes.push(new kv(t,s,A,h,null,i)),this.open++,l}closeExtra(t=!1){let s=this.nodes.length-1;if(s>this.open){for(;s>this.open;s--)this.nodes[s-1].content.push(this.nodes[s].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let s=this.open;s>=0;s--){if(this.nodes[s]==t)return this.open=s,!0;this.localPreserveWS&&(this.nodes[s].options|=ax)}return!1}get currentPos(){this.closeExtra();let t=0;for(let s=this.open;s>=0;s--){let l=this.nodes[s].content;for(let h=l.length-1;h>=0;h--)t+=l[h].nodeSize;s&&t++}return t}findAtPoint(t,s){if(this.find)for(let l=0;l<this.find.length;l++)this.find[l].node==t&&this.find[l].offset==s&&(this.find[l].pos=this.currentPos)}findInside(t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&(this.find[s].pos=this.currentPos)}findAround(t,s,l){if(t!=s&&this.find)for(let h=0;h<this.find.length;h++)this.find[h].pos==null&&t.nodeType==1&&t.contains(this.find[h].node)&&s.compareDocumentPosition(this.find[h].node)&(l?2:4)&&(this.find[h].pos=this.currentPos)}findInText(t){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==t&&(this.find[s].pos=this.currentPos-(t.nodeValue.length-this.find[s].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let s=t.split("/"),l=this.options.context,h=!this.isOpen&&(!l||l.parent.type==this.nodes[0].type),m=-(l?l.depth+1:0)+(h?0:1),b=(i,A)=>{for(;i>=0;i--){let P=s[i];if(P==""){if(i==s.length-1||i==0)continue;for(;A>=m;A--)if(b(i-1,A))return!0;return!1}else{let D=A>0||A==0&&h?this.nodes[A].type:l&&A>=m?l.node(A-m).type:null;if(!D||D.name!=P&&!D.isInGroup(P))return!1;A--}}return!0};return b(s.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let s=t.depth;s>=0;s--){let l=t.node(s).contentMatchAt(t.indexAfter(s)).defaultType;if(l&&l.isTextblock&&l.defaultAttrs)return l}for(let s in this.parser.schema.nodes){let l=this.parser.schema.nodes[s];if(l.isTextblock&&l.defaultAttrs)return l}}}function _H(n){for(let t=n.firstChild,s=null;t;t=t.nextSibling){let l=t.nodeType==1?t.nodeName.toLowerCase():null;l&&AD.hasOwnProperty(l)&&s?(s.appendChild(t),t=s):l=="li"?s=t:l&&(s=null)}}function xH(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function dM(n){let t={};for(let s in n)t[s]=n[s];return t}function fM(n,t){let s=t.schema.nodes;for(let l in s){let h=s[l];if(!h.allowsMarkType(n))continue;let m=[],b=i=>{m.push(i);for(let A=0;A<i.edgeCount;A++){let{type:P,next:D}=i.edge(A);if(P==t||m.indexOf(D)<0&&b(D))return!0}};if(b(h.contentMatch))return!0}}class Ag{constructor(t,s){this.nodes=t,this.marks=s}serializeFragment(t,s={},l){l||(l=pw(s).createDocumentFragment());let h=l,m=[];return t.forEach(b=>{if(m.length||b.marks.length){let i=0,A=0;for(;i<m.length&&A<b.marks.length;){let P=b.marks[A];if(!this.marks[P.type.name]){A++;continue}if(!P.eq(m[i][0])||P.type.spec.spanning===!1)break;i++,A++}for(;i<m.length;)h=m.pop()[1];for(;A<b.marks.length;){let P=b.marks[A++],D=this.serializeMark(P,b.isInline,s);D&&(m.push([P,h]),h.appendChild(D.dom),h=D.contentDOM||D.dom)}}h.appendChild(this.serializeNodeInner(b,s))}),l}serializeNodeInner(t,s){let{dom:l,contentDOM:h}=Wv(pw(s),this.nodes[t.type.name](t),null,t.attrs);if(h){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,s,h)}return l}serializeNode(t,s={}){let l=this.serializeNodeInner(t,s);for(let h=t.marks.length-1;h>=0;h--){let m=this.serializeMark(t.marks[h],t.isInline,s);m&&((m.contentDOM||m.dom).appendChild(l),l=m.dom)}return l}serializeMark(t,s,l={}){let h=this.marks[t.type.name];return h&&Wv(pw(l),h(t,s),null,t.attrs)}static renderSpec(t,s,l=null,h){return Wv(t,s,l,h)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Ag(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let s=pM(t.nodes);return s.text||(s.text=l=>l.text),s}static marksFromSchema(t){return pM(t.marks)}}function pM(n){let t={};for(let s in n){let l=n[s].spec.toDOM;l&&(t[s]=l)}return t}function pw(n){return n.document||window.document}const mM=new WeakMap;function vH(n){let t=mM.get(n);return t===void 0&&mM.set(n,t=bH(n)),t}function bH(n){let t=null;function s(l){if(l&&typeof l=="object")if(Array.isArray(l))if(typeof l[0]=="string")t||(t=[]),t.push(l);else for(let h=0;h<l.length;h++)s(l[h]);else for(let h in l)s(l[h])}return s(n),t}function Wv(n,t,s,l){if(typeof t=="string")return{dom:n.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let h=t[0],m;if(typeof h!="string")throw new RangeError("Invalid array passed to renderSpec");if(l&&(m=vH(l))&&m.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let b=h.indexOf(" ");b>0&&(s=h.slice(0,b),h=h.slice(b+1));let i,A=s?n.createElementNS(s,h):n.createElement(h),P=t[1],D=1;if(P&&typeof P=="object"&&P.nodeType==null&&!Array.isArray(P)){D=2;for(let j in P)if(P[j]!=null){let U=j.indexOf(" ");U>0?A.setAttributeNS(j.slice(0,U),j.slice(U+1),P[j]):j=="style"&&A.style?A.style.cssText=P[j]:A.setAttribute(j,P[j])}}for(let j=D;j<t.length;j++){let U=t[j];if(U===0){if(j<t.length-1||j>D)throw new RangeError("Content hole must be the only child of its parent node");return{dom:A,contentDOM:A}}else{let{dom:X,contentDOM:Y}=Wv(n,U,s,l);if(A.appendChild(X),Y){if(i)throw new RangeError("Multiple content holes");i=Y}}}return{dom:A,contentDOM:i}}const ID=65535,MD=Math.pow(2,16);function wH(n,t){return n+t*MD}function gM(n){return n&ID}function SH(n){return(n-(n&ID))/MD}const kD=1,PD=2,Zv=4,RD=8;class TS{constructor(t,s,l){this.pos=t,this.delInfo=s,this.recover=l}get deleted(){return(this.delInfo&RD)>0}get deletedBefore(){return(this.delInfo&(kD|Zv))>0}get deletedAfter(){return(this.delInfo&(PD|Zv))>0}get deletedAcross(){return(this.delInfo&Zv)>0}}class Cc{constructor(t,s=!1){if(this.ranges=t,this.inverted=s,!t.length&&Cc.empty)return Cc.empty}recover(t){let s=0,l=gM(t);if(!this.inverted)for(let h=0;h<l;h++)s+=this.ranges[h*3+2]-this.ranges[h*3+1];return this.ranges[l*3]+s+SH(t)}mapResult(t,s=1){return this._map(t,s,!1)}map(t,s=1){return this._map(t,s,!0)}_map(t,s,l){let h=0,m=this.inverted?2:1,b=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let A=this.ranges[i]-(this.inverted?h:0);if(A>t)break;let P=this.ranges[i+m],D=this.ranges[i+b],j=A+P;if(t<=j){let U=P?t==A?-1:t==j?1:s:s,X=A+h+(U<0?0:D);if(l)return X;let Y=t==(s<0?A:j)?null:wH(i/3,t-A),W=t==A?PD:t==j?kD:Zv;return(s<0?t!=A:t!=j)&&(W|=RD),new TS(X,W,Y)}h+=D-P}return l?t+h:new TS(t+h,0,null)}touches(t,s){let l=0,h=gM(s),m=this.inverted?2:1,b=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let A=this.ranges[i]-(this.inverted?l:0);if(A>t)break;let P=this.ranges[i+m],D=A+P;if(t<=D&&i==h*3)return!0;l+=this.ranges[i+b]-P}return!1}forEach(t){let s=this.inverted?2:1,l=this.inverted?1:2;for(let h=0,m=0;h<this.ranges.length;h+=3){let b=this.ranges[h],i=b-(this.inverted?m:0),A=b+(this.inverted?0:m),P=this.ranges[h+s],D=this.ranges[h+l];t(i,i+P,A,A+D),m+=D-P}}invert(){return new Cc(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?Cc.empty:new Cc(t<0?[0,-t,0]:[0,0,t])}}Cc.empty=new Cc([]);class lx{constructor(t,s,l=0,h=t?t.length:0){this.mirror=s,this.from=l,this.to=h,this._maps=t||[],this.ownData=!(t||s)}get maps(){return this._maps}slice(t=0,s=this.maps.length){return new lx(this._maps,this.mirror,t,s)}appendMap(t,s){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),s!=null&&this.setMirror(this._maps.length-1,s)}appendMapping(t){for(let s=0,l=this._maps.length;s<t._maps.length;s++){let h=t.getMirror(s);this.appendMap(t._maps[s],h!=null&&h<s?l+h:void 0)}}getMirror(t){if(this.mirror){for(let s=0;s<this.mirror.length;s++)if(this.mirror[s]==t)return this.mirror[s+(s%2?-1:1)]}}setMirror(t,s){this.mirror||(this.mirror=[]),this.mirror.push(t,s)}appendMappingInverted(t){for(let s=t.maps.length-1,l=this._maps.length+t._maps.length;s>=0;s--){let h=t.getMirror(s);this.appendMap(t._maps[s].invert(),h!=null&&h>s?l-h-1:void 0)}}invert(){let t=new lx;return t.appendMappingInverted(this),t}map(t,s=1){if(this.mirror)return this._map(t,s,!0);for(let l=this.from;l<this.to;l++)t=this._maps[l].map(t,s);return t}mapResult(t,s=1){return this._map(t,s,!1)}_map(t,s,l){let h=0;for(let m=this.from;m<this.to;m++){let b=this._maps[m],i=b.mapResult(t,s);if(i.recover!=null){let A=this.getMirror(m);if(A!=null&&A>m&&A<this.to){m=A,t=this._maps[A].recover(i.recover);continue}}h|=i.delInfo,t=i.pos}return l?t:new TS(t,h,null)}}const mw=Object.create(null);class al{getMap(){return Cc.empty}merge(t){return null}static fromJSON(t,s){if(!s||!s.stepType)throw new RangeError("Invalid input for Step.fromJSON");let l=mw[s.stepType];if(!l)throw new RangeError(`No step type ${s.stepType} defined`);return l.fromJSON(t,s)}static jsonID(t,s){if(t in mw)throw new RangeError("Duplicate use of step JSON ID "+t);return mw[t]=s,s.prototype.jsonID=t,s}}class zo{constructor(t,s){this.doc=t,this.failed=s}static ok(t){return new zo(t,null)}static fail(t){return new zo(null,t)}static fromReplace(t,s,l,h){try{return zo.ok(t.replace(s,l,h))}catch(m){if(m instanceof u0)return zo.fail(m.message);throw m}}}function OT(n,t,s){let l=[];for(let h=0;h<n.childCount;h++){let m=n.child(h);m.content.size&&(m=m.copy(OT(m.content,t,m))),m.isInline&&(m=t(m,s,h)),l.push(m)}return pn.fromArray(l)}class $p extends al{constructor(t,s,l){super(),this.from=t,this.to=s,this.mark=l}apply(t){let s=t.slice(this.from,this.to),l=t.resolve(this.from),h=l.node(l.sharedDepth(this.to)),m=new Yn(OT(s.content,(b,i)=>!b.isAtom||!i.type.allowsMarkType(this.mark.type)?b:b.mark(this.mark.addToSet(b.marks)),h),s.openStart,s.openEnd);return zo.fromReplace(t,this.from,this.to,m)}invert(){return new hh(this.from,this.to,this.mark)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deleted&&l.deleted||s.pos>=l.pos?null:new $p(s.pos,l.pos,this.mark)}merge(t){return t instanceof $p&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new $p(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new $p(s.from,s.to,t.markFromJSON(s.mark))}}al.jsonID("addMark",$p);class hh extends al{constructor(t,s,l){super(),this.from=t,this.to=s,this.mark=l}apply(t){let s=t.slice(this.from,this.to),l=new Yn(OT(s.content,h=>h.mark(this.mark.removeFromSet(h.marks)),t),s.openStart,s.openEnd);return zo.fromReplace(t,this.from,this.to,l)}invert(){return new $p(this.from,this.to,this.mark)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deleted&&l.deleted||s.pos>=l.pos?null:new hh(s.pos,l.pos,this.mark)}merge(t){return t instanceof hh&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new hh(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new hh(s.from,s.to,t.markFromJSON(s.mark))}}al.jsonID("removeMark",hh);class Hp extends al{constructor(t,s){super(),this.pos=t,this.mark=s}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at mark step's position");let l=s.type.create(s.attrs,null,this.mark.addToSet(s.marks));return zo.fromReplace(t,this.pos,this.pos+1,new Yn(pn.from(l),0,s.isLeaf?0:1))}invert(t){let s=t.nodeAt(this.pos);if(s){let l=this.mark.addToSet(s.marks);if(l.length==s.marks.length){for(let h=0;h<s.marks.length;h++)if(!s.marks[h].isInSet(l))return new Hp(this.pos,s.marks[h]);return new Hp(this.pos,this.mark)}}return new bg(this.pos,this.mark)}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new Hp(s.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Hp(s.pos,t.markFromJSON(s.mark))}}al.jsonID("addNodeMark",Hp);class bg extends al{constructor(t,s){super(),this.pos=t,this.mark=s}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at mark step's position");let l=s.type.create(s.attrs,null,this.mark.removeFromSet(s.marks));return zo.fromReplace(t,this.pos,this.pos+1,new Yn(pn.from(l),0,s.isLeaf?0:1))}invert(t){let s=t.nodeAt(this.pos);return!s||!this.mark.isInSet(s.marks)?this:new Hp(this.pos,this.mark)}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new bg(s.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new bg(s.pos,t.markFromJSON(s.mark))}}al.jsonID("removeNodeMark",bg);class ya extends al{constructor(t,s,l,h=!1){super(),this.from=t,this.to=s,this.slice=l,this.structure=h}apply(t){return this.structure&&ES(t,this.from,this.to)?zo.fail("Structure replace would overwrite content"):zo.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new Cc([this.from,this.to-this.from,this.slice.size])}invert(t){return new ya(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1);return s.deletedAcross&&l.deletedAcross?null:new ya(s.pos,Math.max(s.pos,l.pos),this.slice,this.structure)}merge(t){if(!(t instanceof ya)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let s=this.slice.size+t.slice.size==0?Yn.empty:new Yn(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new ya(this.from,this.to+(t.to-t.from),s,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let s=this.slice.size+t.slice.size==0?Yn.empty:new Yn(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new ya(t.from,this.to,s,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ya(s.from,s.to,Yn.fromJSON(t,s.slice),!!s.structure)}}al.jsonID("replace",ya);class xa extends al{constructor(t,s,l,h,m,b,i=!1){super(),this.from=t,this.to=s,this.gapFrom=l,this.gapTo=h,this.slice=m,this.insert=b,this.structure=i}apply(t){if(this.structure&&(ES(t,this.from,this.gapFrom)||ES(t,this.gapTo,this.to)))return zo.fail("Structure gap-replace would overwrite content");let s=t.slice(this.gapFrom,this.gapTo);if(s.openStart||s.openEnd)return zo.fail("Gap is not a flat range");let l=this.slice.insertAt(this.insert,s.content);return l?zo.fromReplace(t,this.from,this.to,l):zo.fail("Content does not fit in gap")}getMap(){return new Cc([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let s=this.gapTo-this.gapFrom;return new xa(this.from,this.from+this.slice.size+s,this.from+this.insert,this.from+this.insert+s,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let s=t.mapResult(this.from,1),l=t.mapResult(this.to,-1),h=this.from==this.gapFrom?s.pos:t.map(this.gapFrom,-1),m=this.to==this.gapTo?l.pos:t.map(this.gapTo,1);return s.deletedAcross&&l.deletedAcross||h<s.pos||m>l.pos?null:new xa(s.pos,l.pos,h,m,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,s){if(typeof s.from!="number"||typeof s.to!="number"||typeof s.gapFrom!="number"||typeof s.gapTo!="number"||typeof s.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new xa(s.from,s.to,s.gapFrom,s.gapTo,Yn.fromJSON(t,s.slice),s.insert,!!s.structure)}}al.jsonID("replaceAround",xa);function ES(n,t,s){let l=n.resolve(t),h=s-t,m=l.depth;for(;h>0&&m>0&&l.indexAfter(m)==l.node(m).childCount;)m--,h--;if(h>0){let b=l.node(m).maybeChild(l.indexAfter(m));for(;h>0;){if(!b||b.isLeaf)return!0;b=b.firstChild,h--}}return!1}function TH(n,t,s,l){let h=[],m=[],b,i;n.doc.nodesBetween(t,s,(A,P,D)=>{if(!A.isInline)return;let j=A.marks;if(!l.isInSet(j)&&D.type.allowsMarkType(l.type)){let U=Math.max(P,t),X=Math.min(P+A.nodeSize,s),Y=l.addToSet(j);for(let W=0;W<j.length;W++)j[W].isInSet(Y)||(b&&b.to==U&&b.mark.eq(j[W])?b.to=X:h.push(b=new hh(U,X,j[W])));i&&i.to==U?i.to=X:m.push(i=new $p(U,X,l))}}),h.forEach(A=>n.step(A)),m.forEach(A=>n.step(A))}function EH(n,t,s,l){let h=[],m=0;n.doc.nodesBetween(t,s,(b,i)=>{if(!b.isInline)return;m++;let A=null;if(l instanceof y1){let P=b.marks,D;for(;D=l.isInSet(P);)(A||(A=[])).push(D),P=D.removeFromSet(P)}else l?l.isInSet(b.marks)&&(A=[l]):A=b.marks;if(A&&A.length){let P=Math.min(i+b.nodeSize,s);for(let D=0;D<A.length;D++){let j=A[D],U;for(let X=0;X<h.length;X++){let Y=h[X];Y.step==m-1&&j.eq(h[X].style)&&(U=Y)}U?(U.to=P,U.step=m):h.push({style:j,from:Math.max(i,t),to:P,step:m})}}}),h.forEach(b=>n.step(new hh(b.from,b.to,b.style)))}function LT(n,t,s,l=s.contentMatch,h=!0){let m=n.doc.nodeAt(t),b=[],i=t+1;for(let A=0;A<m.childCount;A++){let P=m.child(A),D=i+P.nodeSize,j=l.matchType(P.type);if(!j)b.push(new ya(i,D,Yn.empty));else{l=j;for(let U=0;U<P.marks.length;U++)s.allowsMarkType(P.marks[U].type)||n.step(new hh(i,D,P.marks[U]));if(h&&P.isText&&s.whitespace!="pre"){let U,X=/\r?\n|\r/g,Y;for(;U=X.exec(P.text);)Y||(Y=new Yn(pn.from(s.schema.text(" ",s.allowedMarks(P.marks))),0,0)),b.push(new ya(i+U.index,i+U.index+U[0].length,Y))}}i=D}if(!l.validEnd){let A=l.fillBefore(pn.empty,!0);n.replace(i,i,new Yn(A,0,0))}for(let A=b.length-1;A>=0;A--)n.step(b[A])}function CH(n,t,s){return(t==0||n.canReplace(t,n.childCount))&&(s==n.childCount||n.canReplace(0,s))}function Hy(n){let s=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let l=n.depth;;--l){let h=n.$from.node(l),m=n.$from.index(l),b=n.$to.indexAfter(l);if(l<n.depth&&h.canReplace(m,b,s))return l;if(l==0||h.type.spec.isolating||!CH(h,m,b))break}return null}function AH(n,t,s){let{$from:l,$to:h,depth:m}=t,b=l.before(m+1),i=h.after(m+1),A=b,P=i,D=pn.empty,j=0;for(let Y=m,W=!1;Y>s;Y--)W||l.index(Y)>0?(W=!0,D=pn.from(l.node(Y).copy(D)),j++):A--;let U=pn.empty,X=0;for(let Y=m,W=!1;Y>s;Y--)W||h.after(Y+1)<h.end(Y)?(W=!0,U=pn.from(h.node(Y).copy(U)),X++):P++;n.step(new xa(A,P,b,i,new Yn(D.append(U),j,X),D.size-j,!0))}function zT(n,t,s=null,l=n){let h=IH(n,t),m=h&&MH(l,t);return m?h.map(yM).concat({type:t,attrs:s}).concat(m.map(yM)):null}function yM(n){return{type:n,attrs:null}}function IH(n,t){let{parent:s,startIndex:l,endIndex:h}=n,m=s.contentMatchAt(l).findWrapping(t);if(!m)return null;let b=m.length?m[0]:t;return s.canReplaceWith(l,h,b)?m:null}function MH(n,t){let{parent:s,startIndex:l,endIndex:h}=n,m=s.child(l),b=t.contentMatch.findWrapping(m.type);if(!b)return null;let A=(b.length?b[b.length-1]:t).contentMatch;for(let P=l;A&&P<h;P++)A=A.matchType(s.child(P).type);return!A||!A.validEnd?null:b}function kH(n,t,s){let l=pn.empty;for(let b=s.length-1;b>=0;b--){if(l.size){let i=s[b].type.contentMatch.matchFragment(l);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}l=pn.from(s[b].type.create(s[b].attrs,l))}let h=t.start,m=t.end;n.step(new xa(h,m,h,m,new Yn(l,0,0),s.length,!0))}function PH(n,t,s,l,h){if(!l.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let m=n.steps.length;n.doc.nodesBetween(t,s,(b,i)=>{let A=typeof h=="function"?h(b):h;if(b.isTextblock&&!b.hasMarkup(l,A)&&RH(n.doc,n.mapping.slice(m).map(i),l)){let P=null;if(l.schema.linebreakReplacement){let X=l.whitespace=="pre",Y=!!l.contentMatch.matchType(l.schema.linebreakReplacement);X&&!Y?P=!1:!X&&Y&&(P=!0)}P===!1&&DD(n,b,i,m),LT(n,n.mapping.slice(m).map(i,1),l,void 0,P===null);let D=n.mapping.slice(m),j=D.map(i,1),U=D.map(i+b.nodeSize,1);return n.step(new xa(j,U,j+1,U-1,new Yn(pn.from(l.create(A,null,b.marks)),0,0),1,!0)),P===!0&&ND(n,b,i,m),!1}})}function ND(n,t,s,l){t.forEach((h,m)=>{if(h.isText){let b,i=/\r?\n|\r/g;for(;b=i.exec(h.text);){let A=n.mapping.slice(l).map(s+1+m+b.index);n.replaceWith(A,A+1,t.type.schema.linebreakReplacement.create())}}})}function DD(n,t,s,l){t.forEach((h,m)=>{if(h.type==h.type.schema.linebreakReplacement){let b=n.mapping.slice(l).map(s+1+m);n.replaceWith(b,b+1,t.type.schema.text(`
`))}})}function RH(n,t,s){let l=n.resolve(t),h=l.index();return l.parent.canReplaceWith(h,h+1,s)}function NH(n,t,s,l,h){let m=n.doc.nodeAt(t);if(!m)throw new RangeError("No node at given position");s||(s=m.type);let b=s.create(l,null,h||m.marks);if(m.isLeaf)return n.replaceWith(t,t+m.nodeSize,b);if(!s.validContent(m.content))throw new RangeError("Invalid content for node type "+s.name);n.step(new xa(t,t+m.nodeSize,t+1,t+m.nodeSize-1,new Yn(pn.from(b),0,0),1,!0))}function Sf(n,t,s=1,l){let h=n.resolve(t),m=h.depth-s,b=l&&l[l.length-1]||h.parent;if(m<0||h.parent.type.spec.isolating||!h.parent.canReplace(h.index(),h.parent.childCount)||!b.type.validContent(h.parent.content.cutByIndex(h.index(),h.parent.childCount)))return!1;for(let P=h.depth-1,D=s-2;P>m;P--,D--){let j=h.node(P),U=h.index(P);if(j.type.spec.isolating)return!1;let X=j.content.cutByIndex(U,j.childCount),Y=l&&l[D+1];Y&&(X=X.replaceChild(0,Y.type.create(Y.attrs)));let W=l&&l[D]||j;if(!j.canReplace(U+1,j.childCount)||!W.type.validContent(X))return!1}let i=h.indexAfter(m),A=l&&l[0];return h.node(m).canReplaceWith(i,i,A?A.type:h.node(m+1).type)}function DH(n,t,s=1,l){let h=n.doc.resolve(t),m=pn.empty,b=pn.empty;for(let i=h.depth,A=h.depth-s,P=s-1;i>A;i--,P--){m=pn.from(h.node(i).copy(m));let D=l&&l[P];b=pn.from(D?D.type.create(D.attrs,b):h.node(i).copy(b))}n.step(new ya(t,t,new Yn(m.append(b),s,s),!0))}function um(n,t){let s=n.resolve(t),l=s.index();return OD(s.nodeBefore,s.nodeAfter)&&s.parent.canReplace(l,l+1)}function OH(n,t){t.content.size||n.type.compatibleContent(t.type);let s=n.contentMatchAt(n.childCount),{linebreakReplacement:l}=n.type.schema;for(let h=0;h<t.childCount;h++){let m=t.child(h),b=m.type==l?n.type.schema.nodes.text:m.type;if(s=s.matchType(b),!s||!n.type.allowsMarks(m.marks))return!1}return s.validEnd}function OD(n,t){return!!(n&&t&&!n.isLeaf&&OH(n,t))}function _1(n,t,s=-1){let l=n.resolve(t);for(let h=l.depth;;h--){let m,b,i=l.index(h);if(h==l.depth?(m=l.nodeBefore,b=l.nodeAfter):s>0?(m=l.node(h+1),i++,b=l.node(h).maybeChild(i)):(m=l.node(h).maybeChild(i-1),b=l.node(h+1)),m&&!m.isTextblock&&OD(m,b)&&l.node(h).canReplace(i,i+1))return t;if(h==0)break;t=s<0?l.before(h):l.after(h)}}function LH(n,t,s){let l=null,{linebreakReplacement:h}=n.doc.type.schema,m=n.doc.resolve(t-s),b=m.node().type;if(h&&b.inlineContent){let D=b.whitespace=="pre",j=!!b.contentMatch.matchType(h);D&&!j?l=!1:!D&&j&&(l=!0)}let i=n.steps.length;if(l===!1){let D=n.doc.resolve(t+s);DD(n,D.node(),D.before(),i)}b.inlineContent&&LT(n,t+s-1,b,m.node().contentMatchAt(m.index()),l==null);let A=n.mapping.slice(i),P=A.map(t-s);if(n.step(new ya(P,A.map(t+s,-1),Yn.empty,!0)),l===!0){let D=n.doc.resolve(P);ND(n,D.node(),D.before(),n.steps.length)}return n}function zH(n,t,s){let l=n.resolve(t);if(l.parent.canReplaceWith(l.index(),l.index(),s))return t;if(l.parentOffset==0)for(let h=l.depth-1;h>=0;h--){let m=l.index(h);if(l.node(h).canReplaceWith(m,m,s))return l.before(h+1);if(m>0)return null}if(l.parentOffset==l.parent.content.size)for(let h=l.depth-1;h>=0;h--){let m=l.indexAfter(h);if(l.node(h).canReplaceWith(m,m,s))return l.after(h+1);if(m<l.node(h).childCount)return null}return null}function LD(n,t,s){let l=n.resolve(t);if(!s.content.size)return t;let h=s.content;for(let m=0;m<s.openStart;m++)h=h.firstChild.content;for(let m=1;m<=(s.openStart==0&&s.size?2:1);m++)for(let b=l.depth;b>=0;b--){let i=b==l.depth?0:l.pos<=(l.start(b+1)+l.end(b+1))/2?-1:1,A=l.index(b)+(i>0?1:0),P=l.node(b),D=!1;if(m==1)D=P.canReplace(A,A,h);else{let j=P.contentMatchAt(A).findWrapping(h.firstChild.type);D=j&&P.canReplaceWith(A,A,j[0])}if(D)return i==0?l.pos:i<0?l.before(b+1):l.after(b+1)}return null}function x1(n,t,s=t,l=Yn.empty){if(t==s&&!l.size)return null;let h=n.resolve(t),m=n.resolve(s);return zD(h,m,l)?new ya(t,s,l):new jH(h,m,l).fit()}function zD(n,t,s){return!s.openStart&&!s.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),s.content)}class jH{constructor(t,s,l){this.$from=t,this.$to=s,this.unplaced=l,this.frontier=[],this.placed=pn.empty;for(let h=0;h<=t.depth;h++){let m=t.node(h);this.frontier.push({type:m.type,match:m.contentMatchAt(t.indexAfter(h))})}for(let h=t.depth;h>0;h--)this.placed=pn.from(t.node(h).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let P=this.findFittable();P?this.placeNodes(P):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),s=this.placed.size-this.depth-this.$from.depth,l=this.$from,h=this.close(t<0?this.$to:l.doc.resolve(t));if(!h)return null;let m=this.placed,b=l.depth,i=h.depth;for(;b&&i&&m.childCount==1;)m=m.firstChild.content,b--,i--;let A=new Yn(m,b,i);return t>-1?new xa(l.pos,t,this.$to.pos,this.$to.end(),A,s):A.size||l.pos!=this.$to.pos?new ya(l.pos,h.pos,A):null}findFittable(){let t=this.unplaced.openStart;for(let s=this.unplaced.content,l=0,h=this.unplaced.openEnd;l<t;l++){let m=s.firstChild;if(s.childCount>1&&(h=0),m.type.spec.isolating&&h<=l){t=l;break}s=m.content}for(let s=1;s<=2;s++)for(let l=s==1?t:this.unplaced.openStart;l>=0;l--){let h,m=null;l?(m=gw(this.unplaced.content,l-1).firstChild,h=m.content):h=this.unplaced.content;let b=h.firstChild;for(let i=this.depth;i>=0;i--){let{type:A,match:P}=this.frontier[i],D,j=null;if(s==1&&(b?P.matchType(b.type)||(j=P.fillBefore(pn.from(b),!1)):m&&A.compatibleContent(m.type)))return{sliceDepth:l,frontierDepth:i,parent:m,inject:j};if(s==2&&b&&(D=P.findWrapping(b.type)))return{sliceDepth:l,frontierDepth:i,parent:m,wrap:D};if(m&&P.matchType(m.type))break}}}openMore(){let{content:t,openStart:s,openEnd:l}=this.unplaced,h=gw(t,s);return!h.childCount||h.firstChild.isLeaf?!1:(this.unplaced=new Yn(t,s+1,Math.max(l,h.size+s>=t.size-l?s+1:0)),!0)}dropNode(){let{content:t,openStart:s,openEnd:l}=this.unplaced,h=gw(t,s);if(h.childCount<=1&&s>0){let m=t.size-s<=s+h.size;this.unplaced=new Yn(B_(t,s-1,1),s-1,m?s-1:l)}else this.unplaced=new Yn(B_(t,s,1),s,l)}placeNodes({sliceDepth:t,frontierDepth:s,parent:l,inject:h,wrap:m}){for(;this.depth>s;)this.closeFrontierNode();if(m)for(let W=0;W<m.length;W++)this.openFrontierNode(m[W]);let b=this.unplaced,i=l?l.content:b.content,A=b.openStart-t,P=0,D=[],{match:j,type:U}=this.frontier[s];if(h){for(let W=0;W<h.childCount;W++)D.push(h.child(W));j=j.matchFragment(h)}let X=i.size+t-(b.content.size-b.openEnd);for(;P<i.childCount;){let W=i.child(P),re=j.matchType(W.type);if(!re)break;P++,(P>1||A==0||W.content.size)&&(j=re,D.push(jD(W.mark(U.allowedMarks(W.marks)),P==1?A:0,P==i.childCount?X:-1)))}let Y=P==i.childCount;Y||(X=-1),this.placed=V_(this.placed,s,pn.from(D)),this.frontier[s].match=j,Y&&X<0&&l&&l.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let W=0,re=i;W<X;W++){let de=re.lastChild;this.frontier.push({type:de.type,match:de.contentMatchAt(de.childCount)}),re=de.content}this.unplaced=Y?t==0?Yn.empty:new Yn(B_(b.content,t-1,1),t-1,X<0?b.openEnd:t-1):new Yn(B_(b.content,t,P),b.openStart,b.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],s;if(!t.type.isTextblock||!yw(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(s=this.findCloseLevel(this.$to))&&s.depth==this.depth)return-1;let{depth:l}=this.$to,h=this.$to.after(l);for(;l>1&&h==this.$to.end(--l);)++h;return h}findCloseLevel(t){e:for(let s=Math.min(this.depth,t.depth);s>=0;s--){let{match:l,type:h}=this.frontier[s],m=s<t.depth&&t.end(s+1)==t.pos+(t.depth-(s+1)),b=yw(t,s,h,l,m);if(b){for(let i=s-1;i>=0;i--){let{match:A,type:P}=this.frontier[i],D=yw(t,i,P,A,!0);if(!D||D.childCount)continue e}return{depth:s,fit:b,move:m?t.doc.resolve(t.after(s+1)):t}}}}close(t){let s=this.findCloseLevel(t);if(!s)return null;for(;this.depth>s.depth;)this.closeFrontierNode();s.fit.childCount&&(this.placed=V_(this.placed,s.depth,s.fit)),t=s.move;for(let l=s.depth+1;l<=t.depth;l++){let h=t.node(l),m=h.type.contentMatch.fillBefore(h.content,!0,t.index(l));this.openFrontierNode(h.type,h.attrs,m)}return t}openFrontierNode(t,s=null,l){let h=this.frontier[this.depth];h.match=h.match.matchType(t),this.placed=V_(this.placed,this.depth,pn.from(t.create(s,l))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let s=this.frontier.pop().match.fillBefore(pn.empty,!0);s.childCount&&(this.placed=V_(this.placed,this.frontier.length,s))}}function B_(n,t,s){return t==0?n.cutByIndex(s,n.childCount):n.replaceChild(0,n.firstChild.copy(B_(n.firstChild.content,t-1,s)))}function V_(n,t,s){return t==0?n.append(s):n.replaceChild(n.childCount-1,n.lastChild.copy(V_(n.lastChild.content,t-1,s)))}function gw(n,t){for(let s=0;s<t;s++)n=n.firstChild.content;return n}function jD(n,t,s){if(t<=0)return n;let l=n.content;return t>1&&(l=l.replaceChild(0,jD(l.firstChild,t-1,l.childCount==1?s-1:0))),t>0&&(l=n.type.contentMatch.fillBefore(l).append(l),s<=0&&(l=l.append(n.type.contentMatch.matchFragment(l).fillBefore(pn.empty,!0)))),n.copy(l)}function yw(n,t,s,l,h){let m=n.node(t),b=h?n.indexAfter(t):n.index(t);if(b==m.childCount&&!s.compatibleContent(m.type))return null;let i=l.fillBefore(m.content,!0,b);return i&&!FH(s,m.content,b)?i:null}function FH(n,t,s){for(let l=s;l<t.childCount;l++)if(!n.allowsMarks(t.child(l).marks))return!0;return!1}function BH(n){return n.spec.defining||n.spec.definingForContent}function VH(n,t,s,l){if(!l.size)return n.deleteRange(t,s);let h=n.doc.resolve(t),m=n.doc.resolve(s);if(zD(h,m,l))return n.step(new ya(t,s,l));let b=BD(h,n.doc.resolve(s));b[b.length-1]==0&&b.pop();let i=-(h.depth+1);b.unshift(i);for(let U=h.depth,X=h.pos-1;U>0;U--,X--){let Y=h.node(U).type.spec;if(Y.defining||Y.definingAsContext||Y.isolating)break;b.indexOf(U)>-1?i=U:h.before(U)==X&&b.splice(1,0,-U)}let A=b.indexOf(i),P=[],D=l.openStart;for(let U=l.content,X=0;;X++){let Y=U.firstChild;if(P.push(Y),X==l.openStart)break;U=Y.content}for(let U=D-1;U>=0;U--){let X=P[U],Y=BH(X.type);if(Y&&!X.sameMarkup(h.node(Math.abs(i)-1)))D=U;else if(Y||!X.type.isTextblock)break}for(let U=l.openStart;U>=0;U--){let X=(U+D+1)%(l.openStart+1),Y=P[X];if(Y)for(let W=0;W<b.length;W++){let re=b[(W+A)%b.length],de=!0;re<0&&(de=!1,re=-re);let Me=h.node(re-1),Fe=h.index(re-1);if(Me.canReplaceWith(Fe,Fe,Y.type,Y.marks))return n.replace(h.before(re),de?m.after(re):s,new Yn(FD(l.content,0,l.openStart,X),X,l.openEnd))}}let j=n.steps.length;for(let U=b.length-1;U>=0&&(n.replace(t,s,l),!(n.steps.length>j));U--){let X=b[U];X<0||(t=h.before(X),s=m.after(X))}}function FD(n,t,s,l,h){if(t<s){let m=n.firstChild;n=n.replaceChild(0,m.copy(FD(m.content,t+1,s,l,m)))}if(t>l){let m=h.contentMatchAt(0),b=m.fillBefore(n).append(n);n=b.append(m.matchFragment(b).fillBefore(pn.empty,!0))}return n}function UH(n,t,s,l){if(!l.isInline&&t==s&&n.doc.resolve(t).parent.content.size){let h=zH(n.doc,t,l.type);h!=null&&(t=s=h)}n.replaceRange(t,s,new Yn(pn.from(l),0,0))}function $H(n,t,s){let l=n.doc.resolve(t),h=n.doc.resolve(s),m=BD(l,h);for(let b=0;b<m.length;b++){let i=m[b],A=b==m.length-1;if(A&&i==0||l.node(i).type.contentMatch.validEnd)return n.delete(l.start(i),h.end(i));if(i>0&&(A||l.node(i-1).canReplace(l.index(i-1),h.indexAfter(i-1))))return n.delete(l.before(i),h.after(i))}for(let b=1;b<=l.depth&&b<=h.depth;b++)if(t-l.start(b)==l.depth-b&&s>l.end(b)&&h.end(b)-s!=h.depth-b&&l.start(b-1)==h.start(b-1)&&l.node(b-1).canReplace(l.index(b-1),h.index(b-1)))return n.delete(l.before(b),s);n.delete(t,s)}function BD(n,t){let s=[],l=Math.min(n.depth,t.depth);for(let h=l;h>=0;h--){let m=n.start(h);if(m<n.pos-(n.depth-h)||t.end(h)>t.pos+(t.depth-h)||n.node(h).type.spec.isolating||t.node(h).type.spec.isolating)break;(m==t.start(h)||h==n.depth&&h==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&h&&t.start(h-1)==m-1)&&s.push(h)}return s}class by extends al{constructor(t,s,l){super(),this.pos=t,this.attr=s,this.value=l}apply(t){let s=t.nodeAt(this.pos);if(!s)return zo.fail("No node at attribute step's position");let l=Object.create(null);for(let m in s.attrs)l[m]=s.attrs[m];l[this.attr]=this.value;let h=s.type.create(l,null,s.marks);return zo.fromReplace(t,this.pos,this.pos+1,new Yn(pn.from(h),0,s.isLeaf?0:1))}getMap(){return Cc.empty}invert(t){return new by(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let s=t.mapResult(this.pos,1);return s.deletedAfter?null:new by(s.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,s){if(typeof s.pos!="number"||typeof s.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new by(s.pos,s.attr,s.value)}}al.jsonID("attr",by);class cx extends al{constructor(t,s){super(),this.attr=t,this.value=s}apply(t){let s=Object.create(null);for(let h in t.attrs)s[h]=t.attrs[h];s[this.attr]=this.value;let l=t.type.create(s,t.content,t.marks);return zo.ok(l)}getMap(){return Cc.empty}invert(t){return new cx(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,s){if(typeof s.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new cx(s.attr,s.value)}}al.jsonID("docAttr",cx);let Cy=class extends Error{};Cy=function n(t){let s=Error.call(this,t);return s.__proto__=n.prototype,s};Cy.prototype=Object.create(Error.prototype);Cy.prototype.constructor=Cy;Cy.prototype.name="TransformError";class VD{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new lx}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let s=this.maybeStep(t);if(s.failed)throw new Cy(s.failed);return this}maybeStep(t){let s=t.apply(this.doc);return s.failed||this.addStep(t,s.doc),s}get docChanged(){return this.steps.length>0}addStep(t,s){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=s}replace(t,s=t,l=Yn.empty){let h=x1(this.doc,t,s,l);return h&&this.step(h),this}replaceWith(t,s,l){return this.replace(t,s,new Yn(pn.from(l),0,0))}delete(t,s){return this.replace(t,s,Yn.empty)}insert(t,s){return this.replaceWith(t,t,s)}replaceRange(t,s,l){return VH(this,t,s,l),this}replaceRangeWith(t,s,l){return UH(this,t,s,l),this}deleteRange(t,s){return $H(this,t,s),this}lift(t,s){return AH(this,t,s),this}join(t,s=1){return LH(this,t,s),this}wrap(t,s){return kH(this,t,s),this}setBlockType(t,s=t,l,h=null){return PH(this,t,s,l,h),this}setNodeMarkup(t,s,l=null,h){return NH(this,t,s,l,h),this}setNodeAttribute(t,s,l){return this.step(new by(t,s,l)),this}setDocAttribute(t,s){return this.step(new cx(t,s)),this}addNodeMark(t,s){return this.step(new Hp(t,s)),this}removeNodeMark(t,s){let l=this.doc.nodeAt(t);if(!l)throw new RangeError("No node at position "+t);if(s instanceof xs)s.isInSet(l.marks)&&this.step(new bg(t,s));else{let h=l.marks,m,b=[];for(;m=s.isInSet(h);)b.push(new bg(t,m)),h=m.removeFromSet(h);for(let i=b.length-1;i>=0;i--)this.step(b[i])}return this}split(t,s=1,l){return DH(this,t,s,l),this}addMark(t,s,l){return TH(this,t,s,l),this}removeMark(t,s,l){return EH(this,t,s,l),this}clearIncompatible(t,s,l){return LT(this,t,s,l),this}}const _w=Object.create(null);class vi{constructor(t,s,l){this.$anchor=t,this.$head=s,this.ranges=l||[new HH(t.min(s),t.max(s))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let s=0;s<t.length;s++)if(t[s].$from.pos!=t[s].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,s=Yn.empty){let l=s.content.lastChild,h=null;for(let i=0;i<s.openEnd;i++)h=l,l=l.lastChild;let m=t.steps.length,b=this.ranges;for(let i=0;i<b.length;i++){let{$from:A,$to:P}=b[i],D=t.mapping.slice(m);t.replaceRange(D.map(A.pos),D.map(P.pos),i?Yn.empty:s),i==0&&vM(t,m,(l?l.isInline:h&&h.isTextblock)?-1:1)}}replaceWith(t,s){let l=t.steps.length,h=this.ranges;for(let m=0;m<h.length;m++){let{$from:b,$to:i}=h[m],A=t.mapping.slice(l),P=A.map(b.pos),D=A.map(i.pos);m?t.deleteRange(P,D):(t.replaceRangeWith(P,D,s),vM(t,l,s.isInline?-1:1))}}static findFrom(t,s,l=!1){let h=t.parent.inlineContent?new ti(t):dy(t.node(0),t.parent,t.pos,t.index(),s,l);if(h)return h;for(let m=t.depth-1;m>=0;m--){let b=s<0?dy(t.node(0),t.node(m),t.before(m+1),t.index(m),s,l):dy(t.node(0),t.node(m),t.after(m+1),t.index(m)+1,s,l);if(b)return b}return null}static near(t,s=1){return this.findFrom(t,s)||this.findFrom(t,-s)||new Ic(t.node(0))}static atStart(t){return dy(t,t,0,0,1)||new Ic(t)}static atEnd(t){return dy(t,t,t.content.size,t.childCount,-1)||new Ic(t)}static fromJSON(t,s){if(!s||!s.type)throw new RangeError("Invalid input for Selection.fromJSON");let l=_w[s.type];if(!l)throw new RangeError(`No selection type ${s.type} defined`);return l.fromJSON(t,s)}static jsonID(t,s){if(t in _w)throw new RangeError("Duplicate use of selection JSON ID "+t);return _w[t]=s,s.prototype.jsonID=t,s}getBookmark(){return ti.between(this.$anchor,this.$head).getBookmark()}}vi.prototype.visible=!0;class HH{constructor(t,s){this.$from=t,this.$to=s}}let _M=!1;function xM(n){!_M&&!n.parent.inlineContent&&(_M=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class ti extends vi{constructor(t,s=t){xM(t),xM(s),super(t,s)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,s){let l=t.resolve(s.map(this.head));if(!l.parent.inlineContent)return vi.near(l);let h=t.resolve(s.map(this.anchor));return new ti(h.parent.inlineContent?h:l,l)}replace(t,s=Yn.empty){if(super.replace(t,s),s==Yn.empty){let l=this.$from.marksAcross(this.$to);l&&t.ensureMarks(l)}}eq(t){return t instanceof ti&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new v1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,s){if(typeof s.anchor!="number"||typeof s.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ti(t.resolve(s.anchor),t.resolve(s.head))}static create(t,s,l=s){let h=t.resolve(s);return new this(h,l==s?h:t.resolve(l))}static between(t,s,l){let h=t.pos-s.pos;if((!l||h)&&(l=h>=0?1:-1),!s.parent.inlineContent){let m=vi.findFrom(s,l,!0)||vi.findFrom(s,-l,!0);if(m)s=m.$head;else return vi.near(s,l)}return t.parent.inlineContent||(h==0?t=s:(t=(vi.findFrom(t,-l,!0)||vi.findFrom(t,l,!0)).$anchor,t.pos<s.pos!=h<0&&(t=s))),new ti(t,s)}}vi.jsonID("text",ti);class v1{constructor(t,s){this.anchor=t,this.head=s}map(t){return new v1(t.map(this.anchor),t.map(this.head))}resolve(t){return ti.between(t.resolve(this.anchor),t.resolve(this.head))}}class kr extends vi{constructor(t){let s=t.nodeAfter,l=t.node(0).resolve(t.pos+s.nodeSize);super(t,l),this.node=s}map(t,s){let{deleted:l,pos:h}=s.mapResult(this.anchor),m=t.resolve(h);return l?vi.near(m):new kr(m)}content(){return new Yn(pn.from(this.node),0,0)}eq(t){return t instanceof kr&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new jT(this.anchor)}static fromJSON(t,s){if(typeof s.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new kr(t.resolve(s.anchor))}static create(t,s){return new kr(t.resolve(s))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}kr.prototype.visible=!1;vi.jsonID("node",kr);class jT{constructor(t){this.anchor=t}map(t){let{deleted:s,pos:l}=t.mapResult(this.anchor);return s?new v1(l,l):new jT(l)}resolve(t){let s=t.resolve(this.anchor),l=s.nodeAfter;return l&&kr.isSelectable(l)?new kr(s):vi.near(s)}}class Ic extends vi{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,s=Yn.empty){if(s==Yn.empty){t.delete(0,t.doc.content.size);let l=vi.atStart(t.doc);l.eq(t.selection)||t.setSelection(l)}else super.replace(t,s)}toJSON(){return{type:"all"}}static fromJSON(t){return new Ic(t)}map(t){return new Ic(t)}eq(t){return t instanceof Ic}getBookmark(){return GH}}vi.jsonID("all",Ic);const GH={map(){return this},resolve(n){return new Ic(n)}};function dy(n,t,s,l,h,m=!1){if(t.inlineContent)return ti.create(n,s);for(let b=l-(h>0?0:1);h>0?b<t.childCount:b>=0;b+=h){let i=t.child(b);if(i.isAtom){if(!m&&kr.isSelectable(i))return kr.create(n,s-(h<0?i.nodeSize:0))}else{let A=dy(n,i,s+h,h<0?i.childCount:0,h,m);if(A)return A}s+=i.nodeSize*h}return null}function vM(n,t,s){let l=n.steps.length-1;if(l<t)return;let h=n.steps[l];if(!(h instanceof ya||h instanceof xa))return;let m=n.mapping.maps[l],b;m.forEach((i,A,P,D)=>{b==null&&(b=D)}),n.setSelection(vi.near(n.doc.resolve(b),s))}const bM=1,Pv=2,wM=4;class qH extends VD{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|bM)&~Pv,this.storedMarks=null,this}get selectionSet(){return(this.updated&bM)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Pv,this}ensureMarks(t){return xs.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Pv)>0}addStep(t,s){super.addStep(t,s),this.updated=this.updated&~Pv,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,s=!0){let l=this.selection;return s&&(t=t.mark(this.storedMarks||(l.empty?l.$from.marks():l.$from.marksAcross(l.$to)||xs.none))),l.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,s,l){let h=this.doc.type.schema;if(s==null)return t?this.replaceSelectionWith(h.text(t),!0):this.deleteSelection();{if(l==null&&(l=s),l=l??s,!t)return this.deleteRange(s,l);let m=this.storedMarks;if(!m){let b=this.doc.resolve(s);m=l==s?b.marks():b.marksAcross(this.doc.resolve(l))}return this.replaceRangeWith(s,l,h.text(t,m)),this.selection.empty||this.setSelection(vi.near(this.selection.$to)),this}}setMeta(t,s){return this.meta[typeof t=="string"?t:t.key]=s,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=wM,this}get scrolledIntoView(){return(this.updated&wM)>0}}function SM(n,t){return!t||!n?n:n.bind(t)}class U_{constructor(t,s,l){this.name=t,this.init=SM(s.init,l),this.apply=SM(s.apply,l)}}const WH=[new U_("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new U_("selection",{init(n,t){return n.selection||vi.atStart(t.doc)},apply(n){return n.selection}}),new U_("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,s,l){return l.selection.$cursor?n.storedMarks:null}}),new U_("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}})];class xw{constructor(t,s){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=WH.slice(),s&&s.forEach(l=>{if(this.pluginsByKey[l.key])throw new RangeError("Adding different instances of a keyed plugin ("+l.key+")");this.plugins.push(l),this.pluginsByKey[l.key]=l,l.spec.state&&this.fields.push(new U_(l.key,l.spec.state,l))})}}class gy{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,s=-1){for(let l=0;l<this.config.plugins.length;l++)if(l!=s){let h=this.config.plugins[l];if(h.spec.filterTransaction&&!h.spec.filterTransaction.call(h,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let s=[t],l=this.applyInner(t),h=null;for(;;){let m=!1;for(let b=0;b<this.config.plugins.length;b++){let i=this.config.plugins[b];if(i.spec.appendTransaction){let A=h?h[b].n:0,P=h?h[b].state:this,D=A<s.length&&i.spec.appendTransaction.call(i,A?s.slice(A):s,P,l);if(D&&l.filterTransaction(D,b)){if(D.setMeta("appendedTransaction",t),!h){h=[];for(let j=0;j<this.config.plugins.length;j++)h.push(j<b?{state:l,n:s.length}:{state:this,n:0})}s.push(D),l=l.applyInner(D),m=!0}h&&(h[b]={state:l,n:s.length})}}if(!m)return{state:l,transactions:s}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let s=new gy(this.config),l=this.config.fields;for(let h=0;h<l.length;h++){let m=l[h];s[m.name]=m.apply(t,this[m.name],this,s)}return s}get tr(){return new qH(this)}static create(t){let s=new xw(t.doc?t.doc.type.schema:t.schema,t.plugins),l=new gy(s);for(let h=0;h<s.fields.length;h++)l[s.fields[h].name]=s.fields[h].init(t,l);return l}reconfigure(t){let s=new xw(this.schema,t.plugins),l=s.fields,h=new gy(s);for(let m=0;m<l.length;m++){let b=l[m].name;h[b]=this.hasOwnProperty(b)?this[b]:l[m].init(t,h)}return h}toJSON(t){let s={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(s.storedMarks=this.storedMarks.map(l=>l.toJSON())),t&&typeof t=="object")for(let l in t){if(l=="doc"||l=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let h=t[l],m=h.spec.state;m&&m.toJSON&&(s[l]=m.toJSON.call(h,this[h.key]))}return s}static fromJSON(t,s,l){if(!s)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let h=new xw(t.schema,t.plugins),m=new gy(h);return h.fields.forEach(b=>{if(b.name=="doc")m.doc=Wp.fromJSON(t.schema,s.doc);else if(b.name=="selection")m.selection=vi.fromJSON(m.doc,s.selection);else if(b.name=="storedMarks")s.storedMarks&&(m.storedMarks=s.storedMarks.map(t.schema.markFromJSON));else{if(l)for(let i in l){let A=l[i],P=A.spec.state;if(A.key==b.name&&P&&P.fromJSON&&Object.prototype.hasOwnProperty.call(s,i)){m[b.name]=P.fromJSON.call(A,t,s[i],m);return}}m[b.name]=b.init(t,m)}}),m}}function UD(n,t,s){for(let l in n){let h=n[l];h instanceof Function?h=h.bind(t):l=="handleDOMEvents"&&(h=UD(h,t,{})),s[l]=h}return s}class po{constructor(t){this.spec=t,this.props={},t.props&&UD(t.props,this,this.props),this.key=t.key?t.key.key:$D("plugin")}getState(t){return t[this.key]}}const vw=Object.create(null);function $D(n){return n in vw?n+"$"+ ++vw[n]:(vw[n]=0,n+"$")}class ba{constructor(t="key"){this.key=$D(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const za=function(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t},Ay=function(n){let t=n.assignedSlot||n.parentNode;return t&&t.nodeType==11?t.host:t};let CS=null;const vf=function(n,t,s){let l=CS||(CS=document.createRange());return l.setEnd(n,s??n.nodeValue.length),l.setStart(n,t||0),l},ZH=function(){CS=null},wg=function(n,t,s,l){return s&&(TM(n,t,s,l,-1)||TM(n,t,s,l,1))},XH=/^(img|br|input|textarea|hr)$/i;function TM(n,t,s,l,h){for(var m;;){if(n==s&&t==l)return!0;if(t==(h<0?0:mu(n))){let b=n.parentNode;if(!b||b.nodeType!=1||Tx(n)||XH.test(n.nodeName)||n.contentEditable=="false")return!1;t=za(n)+(h<0?0:1),n=b}else if(n.nodeType==1){let b=n.childNodes[t+(h<0?-1:0)];if(b.nodeType==1&&b.contentEditable=="false")if(!((m=b.pmViewDesc)===null||m===void 0)&&m.ignoreForSelection)t+=h;else return!1;else n=b,t=h<0?mu(n):0}else return!1}}function mu(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function KH(n,t){for(;;){if(n.nodeType==3&&t)return n;if(n.nodeType==1&&t>0){if(n.contentEditable=="false")return null;n=n.childNodes[t-1],t=mu(n)}else if(n.parentNode&&!Tx(n))t=za(n),n=n.parentNode;else return null}}function YH(n,t){for(;;){if(n.nodeType==3&&t<n.nodeValue.length)return n;if(n.nodeType==1&&t<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[t],t=0}else if(n.parentNode&&!Tx(n))t=za(n)+1,n=n.parentNode;else return null}}function JH(n,t,s){for(let l=t==0,h=t==mu(n);l||h;){if(n==s)return!0;let m=za(n);if(n=n.parentNode,!n)return!1;l=l&&m==0,h=h&&m==mu(n)}}function Tx(n){let t;for(let s=n;s&&!(t=s.pmViewDesc);s=s.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}const b1=function(n){return n.focusNode&&wg(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function rg(n,t){let s=document.createEvent("Event");return s.initEvent("keydown",!0,!0),s.keyCode=n,s.key=s.code=t,s}function QH(n){let t=n.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function eG(n,t,s){if(n.caretPositionFromPoint)try{let l=n.caretPositionFromPoint(t,s);if(l)return{node:l.offsetNode,offset:Math.min(mu(l.offsetNode),l.offset)}}catch{}if(n.caretRangeFromPoint){let l=n.caretRangeFromPoint(t,s);if(l)return{node:l.startContainer,offset:Math.min(mu(l.startContainer),l.startOffset)}}}const _d=typeof navigator<"u"?navigator:null,EM=typeof document<"u"?document:null,hm=_d&&_d.userAgent||"",AS=/Edge\/(\d+)/.exec(hm),HD=/MSIE \d/.exec(hm),IS=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(hm),Yl=!!(HD||IS||AS),Xp=HD?document.documentMode:IS?+IS[1]:AS?+AS[1]:0,ph=!Yl&&/gecko\/(\d+)/i.test(hm);ph&&+(/Firefox\/(\d+)/.exec(hm)||[0,0])[1];const MS=!Yl&&/Chrome\/(\d+)/.exec(hm),il=!!MS,GD=MS?+MS[1]:0,wl=!Yl&&!!_d&&/Apple Computer/.test(_d.vendor),Iy=wl&&(/Mobile\/\w+/.test(hm)||!!_d&&_d.maxTouchPoints>2),pu=Iy||(_d?/Mac/.test(_d.platform):!1),tG=_d?/Win/.test(_d.platform):!1,bf=/Android \d/.test(hm),Ex=!!EM&&"webkitFontSmoothing"in EM.documentElement.style,nG=Ex?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function rG(n){let t=n.defaultView&&n.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function gf(n,t){return typeof n=="number"?n:n[t]}function iG(n){let t=n.getBoundingClientRect(),s=t.width/n.offsetWidth||1,l=t.height/n.offsetHeight||1;return{left:t.left,right:t.left+n.clientWidth*s,top:t.top,bottom:t.top+n.clientHeight*l}}function CM(n,t,s){let l=n.someProp("scrollThreshold")||0,h=n.someProp("scrollMargin")||5,m=n.dom.ownerDocument;for(let b=s||n.dom;b;){if(b.nodeType!=1){b=Ay(b);continue}let i=b,A=i==m.body,P=A?rG(m):iG(i),D=0,j=0;if(t.top<P.top+gf(l,"top")?j=-(P.top-t.top+gf(h,"top")):t.bottom>P.bottom-gf(l,"bottom")&&(j=t.bottom-t.top>P.bottom-P.top?t.top+gf(h,"top")-P.top:t.bottom-P.bottom+gf(h,"bottom")),t.left<P.left+gf(l,"left")?D=-(P.left-t.left+gf(h,"left")):t.right>P.right-gf(l,"right")&&(D=t.right-P.right+gf(h,"right")),D||j)if(A)m.defaultView.scrollBy(D,j);else{let X=i.scrollLeft,Y=i.scrollTop;j&&(i.scrollTop+=j),D&&(i.scrollLeft+=D);let W=i.scrollLeft-X,re=i.scrollTop-Y;t={left:t.left-W,top:t.top-re,right:t.right-W,bottom:t.bottom-re}}let U=A?"fixed":getComputedStyle(b).position;if(/^(fixed|sticky)$/.test(U))break;b=U=="absolute"?b.offsetParent:Ay(b)}}function sG(n){let t=n.dom.getBoundingClientRect(),s=Math.max(0,t.top),l,h;for(let m=(t.left+t.right)/2,b=s+1;b<Math.min(innerHeight,t.bottom);b+=5){let i=n.root.elementFromPoint(m,b);if(!i||i==n.dom||!n.dom.contains(i))continue;let A=i.getBoundingClientRect();if(A.top>=s-20){l=i,h=A.top;break}}return{refDOM:l,refTop:h,stack:qD(n.dom)}}function qD(n){let t=[],s=n.ownerDocument;for(let l=n;l&&(t.push({dom:l,top:l.scrollTop,left:l.scrollLeft}),n!=s);l=Ay(l));return t}function oG({refDOM:n,refTop:t,stack:s}){let l=n?n.getBoundingClientRect().top:0;WD(s,l==0?0:l-t)}function WD(n,t){for(let s=0;s<n.length;s++){let{dom:l,top:h,left:m}=n[s];l.scrollTop!=h+t&&(l.scrollTop=h+t),l.scrollLeft!=m&&(l.scrollLeft=m)}}let uy=null;function aG(n){if(n.setActive)return n.setActive();if(uy)return n.focus(uy);let t=qD(n);n.focus(uy==null?{get preventScroll(){return uy={preventScroll:!0},!0}}:void 0),uy||(uy=!1,WD(t,0))}function ZD(n,t){let s,l=2e8,h,m=0,b=t.top,i=t.top,A,P;for(let D=n.firstChild,j=0;D;D=D.nextSibling,j++){let U;if(D.nodeType==1)U=D.getClientRects();else if(D.nodeType==3)U=vf(D).getClientRects();else continue;for(let X=0;X<U.length;X++){let Y=U[X];if(Y.top<=b&&Y.bottom>=i){b=Math.max(Y.bottom,b),i=Math.min(Y.top,i);let W=Y.left>t.left?Y.left-t.left:Y.right<t.left?t.left-Y.right:0;if(W<l){s=D,l=W,h=W&&s.nodeType==3?{left:Y.right<t.left?Y.right:Y.left,top:t.top}:t,D.nodeType==1&&W&&(m=j+(t.left>=(Y.left+Y.right)/2?1:0));continue}}else Y.top>t.top&&!A&&Y.left<=t.left&&Y.right>=t.left&&(A=D,P={left:Math.max(Y.left,Math.min(Y.right,t.left)),top:Y.top});!s&&(t.left>=Y.right&&t.top>=Y.top||t.left>=Y.left&&t.top>=Y.bottom)&&(m=j+1)}}return!s&&A&&(s=A,h=P,l=0),s&&s.nodeType==3?lG(s,h):!s||l&&s.nodeType==1?{node:n,offset:m}:ZD(s,h)}function lG(n,t){let s=n.nodeValue.length,l=document.createRange();for(let h=0;h<s;h++){l.setEnd(n,h+1),l.setStart(n,h);let m=Lp(l,1);if(m.top!=m.bottom&&FT(t,m))return{node:n,offset:h+(t.left>=(m.left+m.right)/2?1:0)}}return{node:n,offset:0}}function FT(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function cG(n,t){let s=n.parentNode;return s&&/^li$/i.test(s.nodeName)&&t.left<n.getBoundingClientRect().left?s:n}function uG(n,t,s){let{node:l,offset:h}=ZD(t,s),m=-1;if(l.nodeType==1&&!l.firstChild){let b=l.getBoundingClientRect();m=b.left!=b.right&&s.left>(b.left+b.right)/2?1:-1}return n.docView.posFromDOM(l,h,m)}function hG(n,t,s,l){let h=-1;for(let m=t,b=!1;m!=n.dom;){let i=n.docView.nearestDesc(m,!0),A;if(!i)return null;if(i.dom.nodeType==1&&(i.node.isBlock&&i.parent||!i.contentDOM)&&((A=i.dom.getBoundingClientRect()).width||A.height)&&(i.node.isBlock&&i.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(i.dom.nodeName)&&(!b&&A.left>l.left||A.top>l.top?h=i.posBefore:(!b&&A.right<l.left||A.bottom<l.top)&&(h=i.posAfter),b=!0),!i.contentDOM&&h<0&&!i.node.isText))return(i.node.isBlock?l.top<(A.top+A.bottom)/2:l.left<(A.left+A.right)/2)?i.posBefore:i.posAfter;m=i.dom.parentNode}return h>-1?h:n.docView.posFromDOM(t,s,-1)}function XD(n,t,s){let l=n.childNodes.length;if(l&&s.top<s.bottom)for(let h=Math.max(0,Math.min(l-1,Math.floor(l*(t.top-s.top)/(s.bottom-s.top))-2)),m=h;;){let b=n.childNodes[m];if(b.nodeType==1){let i=b.getClientRects();for(let A=0;A<i.length;A++){let P=i[A];if(FT(t,P))return XD(b,t,P)}}if((m=(m+1)%l)==h)break}return n}function dG(n,t){let s=n.dom.ownerDocument,l,h=0,m=eG(s,t.left,t.top);m&&({node:l,offset:h}=m);let b=(n.root.elementFromPoint?n.root:s).elementFromPoint(t.left,t.top),i;if(!b||!n.dom.contains(b.nodeType!=1?b.parentNode:b)){let P=n.dom.getBoundingClientRect();if(!FT(t,P)||(b=XD(n.dom,t,P),!b))return null}if(wl)for(let P=b;l&&P;P=Ay(P))P.draggable&&(l=void 0);if(b=cG(b,t),l){if(ph&&l.nodeType==1&&(h=Math.min(h,l.childNodes.length),h<l.childNodes.length)){let D=l.childNodes[h],j;D.nodeName=="IMG"&&(j=D.getBoundingClientRect()).right<=t.left&&j.bottom>t.top&&h++}let P;Ex&&h&&l.nodeType==1&&(P=l.childNodes[h-1]).nodeType==1&&P.contentEditable=="false"&&P.getBoundingClientRect().top>=t.top&&h--,l==n.dom&&h==l.childNodes.length-1&&l.lastChild.nodeType==1&&t.top>l.lastChild.getBoundingClientRect().bottom?i=n.state.doc.content.size:(h==0||l.nodeType!=1||l.childNodes[h-1].nodeName!="BR")&&(i=hG(n,l,h,t))}i==null&&(i=uG(n,b,t));let A=n.docView.nearestDesc(b,!0);return{pos:i,inside:A?A.posAtStart-A.border:-1}}function AM(n){return n.top<n.bottom||n.left<n.right}function Lp(n,t){let s=n.getClientRects();if(s.length){let l=s[t<0?0:s.length-1];if(AM(l))return l}return Array.prototype.find.call(s,AM)||n.getBoundingClientRect()}const fG=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function KD(n,t,s){let{node:l,offset:h,atom:m}=n.docView.domFromPos(t,s<0?-1:1),b=Ex||ph;if(l.nodeType==3)if(b&&(fG.test(l.nodeValue)||(s<0?!h:h==l.nodeValue.length))){let A=Lp(vf(l,h,h),s);if(ph&&h&&/\s/.test(l.nodeValue[h-1])&&h<l.nodeValue.length){let P=Lp(vf(l,h-1,h-1),-1);if(P.top==A.top){let D=Lp(vf(l,h,h+1),-1);if(D.top!=A.top)return z_(D,D.left<P.left)}}return A}else{let A=h,P=h,D=s<0?1:-1;return s<0&&!h?(P++,D=-1):s>=0&&h==l.nodeValue.length?(A--,D=1):s<0?A--:P++,z_(Lp(vf(l,A,P),D),D<0)}if(!n.state.doc.resolve(t-(m||0)).parent.inlineContent){if(m==null&&h&&(s<0||h==mu(l))){let A=l.childNodes[h-1];if(A.nodeType==1)return bw(A.getBoundingClientRect(),!1)}if(m==null&&h<mu(l)){let A=l.childNodes[h];if(A.nodeType==1)return bw(A.getBoundingClientRect(),!0)}return bw(l.getBoundingClientRect(),s>=0)}if(m==null&&h&&(s<0||h==mu(l))){let A=l.childNodes[h-1],P=A.nodeType==3?vf(A,mu(A)-(b?0:1)):A.nodeType==1&&(A.nodeName!="BR"||!A.nextSibling)?A:null;if(P)return z_(Lp(P,1),!1)}if(m==null&&h<mu(l)){let A=l.childNodes[h];for(;A.pmViewDesc&&A.pmViewDesc.ignoreForCoords;)A=A.nextSibling;let P=A?A.nodeType==3?vf(A,0,b?0:1):A.nodeType==1?A:null:null;if(P)return z_(Lp(P,-1),!0)}return z_(Lp(l.nodeType==3?vf(l):l,-s),s>=0)}function z_(n,t){if(n.width==0)return n;let s=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:s,right:s}}function bw(n,t){if(n.height==0)return n;let s=t?n.top:n.bottom;return{top:s,bottom:s,left:n.left,right:n.right}}function YD(n,t,s){let l=n.state,h=n.root.activeElement;l!=t&&n.updateState(t),h!=n.dom&&n.focus();try{return s()}finally{l!=t&&n.updateState(l),h!=n.dom&&h&&h.focus()}}function pG(n,t,s){let l=t.selection,h=s=="up"?l.$from:l.$to;return YD(n,t,()=>{let{node:m}=n.docView.domFromPos(h.pos,s=="up"?-1:1);for(;;){let i=n.docView.nearestDesc(m,!0);if(!i)break;if(i.node.isBlock){m=i.contentDOM||i.dom;break}m=i.dom.parentNode}let b=KD(n,h.pos,1);for(let i=m.firstChild;i;i=i.nextSibling){let A;if(i.nodeType==1)A=i.getClientRects();else if(i.nodeType==3)A=vf(i,0,i.nodeValue.length).getClientRects();else continue;for(let P=0;P<A.length;P++){let D=A[P];if(D.bottom>D.top+1&&(s=="up"?b.top-D.top>(D.bottom-b.top)*2:D.bottom-b.bottom>(b.bottom-D.top)*2))return!1}}return!0})}const mG=/[\u0590-\u08ac]/;function gG(n,t,s){let{$head:l}=t.selection;if(!l.parent.isTextblock)return!1;let h=l.parentOffset,m=!h,b=h==l.parent.content.size,i=n.domSelection();return i?!mG.test(l.parent.textContent)||!i.modify?s=="left"||s=="backward"?m:b:YD(n,t,()=>{let{focusNode:A,focusOffset:P,anchorNode:D,anchorOffset:j}=n.domSelectionRange(),U=i.caretBidiLevel;i.modify("move",s,"character");let X=l.depth?n.docView.domAfterPos(l.before()):n.dom,{focusNode:Y,focusOffset:W}=n.domSelectionRange(),re=Y&&!X.contains(Y.nodeType==1?Y:Y.parentNode)||A==Y&&P==W;try{i.collapse(D,j),A&&(A!=D||P!=j)&&i.extend&&i.extend(A,P)}catch{}return U!=null&&(i.caretBidiLevel=U),re}):l.pos==l.start()||l.pos==l.end()}let IM=null,MM=null,kM=!1;function yG(n,t,s){return IM==t&&MM==s?kM:(IM=t,MM=s,kM=s=="up"||s=="down"?pG(n,t,s):gG(n,t,s))}const gu=0,PM=1,ig=2,xd=3;class Cx{constructor(t,s,l,h){this.parent=t,this.children=s,this.dom=l,this.contentDOM=h,this.dirty=gu,l.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,s,l){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let s=0;s<this.children.length;s++)t+=this.children[s].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let s=0,l=this.posAtStart;;s++){let h=this.children[s];if(h==t)return l;l+=h.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,s,l){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(l<0){let m,b;if(t==this.contentDOM)m=t.childNodes[s-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;m=t.previousSibling}for(;m&&!((b=m.pmViewDesc)&&b.parent==this);)m=m.previousSibling;return m?this.posBeforeChild(b)+b.size:this.posAtStart}else{let m,b;if(t==this.contentDOM)m=t.childNodes[s];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;m=t.nextSibling}for(;m&&!((b=m.pmViewDesc)&&b.parent==this);)m=m.nextSibling;return m?this.posBeforeChild(b):this.posAtEnd}let h;if(t==this.dom&&this.contentDOM)h=s>za(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))h=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(s==0)for(let m=t;;m=m.parentNode){if(m==this.dom){h=!1;break}if(m.previousSibling)break}if(h==null&&s==t.childNodes.length)for(let m=t;;m=m.parentNode){if(m==this.dom){h=!0;break}if(m.nextSibling)break}}return h??l>0?this.posAtEnd:this.posAtStart}nearestDesc(t,s=!1){for(let l=!0,h=t;h;h=h.parentNode){let m=this.getDesc(h),b;if(m&&(!s||m.node))if(l&&(b=m.nodeDOM)&&!(b.nodeType==1?b.contains(t.nodeType==1?t:t.parentNode):b==t))l=!1;else return m}}getDesc(t){let s=t.pmViewDesc;for(let l=s;l;l=l.parent)if(l==this)return s}posFromDOM(t,s,l){for(let h=t;h;h=h.parentNode){let m=this.getDesc(h);if(m)return m.localPosFromDOM(t,s,l)}return-1}descAt(t){for(let s=0,l=0;s<this.children.length;s++){let h=this.children[s],m=l+h.size;if(l==t&&m!=l){for(;!h.border&&h.children.length;)for(let b=0;b<h.children.length;b++){let i=h.children[b];if(i.size){h=i;break}}return h}if(t<m)return h.descAt(t-l-h.border);l=m}}domFromPos(t,s){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let l=0,h=0;for(let m=0;l<this.children.length;l++){let b=this.children[l],i=m+b.size;if(i>t||b instanceof QD){h=t-m;break}m=i}if(h)return this.children[l].domFromPos(h-this.children[l].border,s);for(let m;l&&!(m=this.children[l-1]).size&&m instanceof JD&&m.side>=0;l--);if(s<=0){let m,b=!0;for(;m=l?this.children[l-1]:null,!(!m||m.dom.parentNode==this.contentDOM);l--,b=!1);return m&&s&&b&&!m.border&&!m.domAtom?m.domFromPos(m.size,s):{node:this.contentDOM,offset:m?za(m.dom)+1:0}}else{let m,b=!0;for(;m=l<this.children.length?this.children[l]:null,!(!m||m.dom.parentNode==this.contentDOM);l++,b=!1);return m&&b&&!m.border&&!m.domAtom?m.domFromPos(0,s):{node:this.contentDOM,offset:m?za(m.dom):this.contentDOM.childNodes.length}}}parseRange(t,s,l=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:s,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let h=-1,m=-1;for(let b=l,i=0;;i++){let A=this.children[i],P=b+A.size;if(h==-1&&t<=P){let D=b+A.border;if(t>=D&&s<=P-A.border&&A.node&&A.contentDOM&&this.contentDOM.contains(A.contentDOM))return A.parseRange(t,s,D);t=b;for(let j=i;j>0;j--){let U=this.children[j-1];if(U.size&&U.dom.parentNode==this.contentDOM&&!U.emptyChildAt(1)){h=za(U.dom)+1;break}t-=U.size}h==-1&&(h=0)}if(h>-1&&(P>s||i==this.children.length-1)){s=P;for(let D=i+1;D<this.children.length;D++){let j=this.children[D];if(j.size&&j.dom.parentNode==this.contentDOM&&!j.emptyChildAt(-1)){m=za(j.dom);break}s+=j.size}m==-1&&(m=this.contentDOM.childNodes.length);break}b=P}return{node:this.contentDOM,from:t,to:s,fromOffset:h,toOffset:m}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let s=this.children[t<0?0:this.children.length-1];return s.size==0||s.emptyChildAt(t)}domAfterPos(t){let{node:s,offset:l}=this.domFromPos(t,0);if(s.nodeType!=1||l==s.childNodes.length)throw new RangeError("No node after pos "+t);return s.childNodes[l]}setSelection(t,s,l,h=!1){let m=Math.min(t,s),b=Math.max(t,s);for(let X=0,Y=0;X<this.children.length;X++){let W=this.children[X],re=Y+W.size;if(m>Y&&b<re)return W.setSelection(t-Y-W.border,s-Y-W.border,l,h);Y=re}let i=this.domFromPos(t,t?-1:1),A=s==t?i:this.domFromPos(s,s?-1:1),P=l.root.getSelection(),D=l.domSelectionRange(),j=!1;if((ph||wl)&&t==s){let{node:X,offset:Y}=i;if(X.nodeType==3){if(j=!!(Y&&X.nodeValue[Y-1]==`
`),j&&Y==X.nodeValue.length)for(let W=X,re;W;W=W.parentNode){if(re=W.nextSibling){re.nodeName=="BR"&&(i=A={node:re.parentNode,offset:za(re)+1});break}let de=W.pmViewDesc;if(de&&de.node&&de.node.isBlock)break}}else{let W=X.childNodes[Y-1];j=W&&(W.nodeName=="BR"||W.contentEditable=="false")}}if(ph&&D.focusNode&&D.focusNode!=A.node&&D.focusNode.nodeType==1){let X=D.focusNode.childNodes[D.focusOffset];X&&X.contentEditable=="false"&&(h=!0)}if(!(h||j&&wl)&&wg(i.node,i.offset,D.anchorNode,D.anchorOffset)&&wg(A.node,A.offset,D.focusNode,D.focusOffset))return;let U=!1;if((P.extend||t==s)&&!j){P.collapse(i.node,i.offset);try{t!=s&&P.extend(A.node,A.offset),U=!0}catch{}}if(!U){if(t>s){let Y=i;i=A,A=Y}let X=document.createRange();X.setEnd(A.node,A.offset),X.setStart(i.node,i.offset),P.removeAllRanges(),P.addRange(X)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,s){for(let l=0,h=0;h<this.children.length;h++){let m=this.children[h],b=l+m.size;if(l==b?t<=b&&s>=l:t<b&&s>l){let i=l+m.border,A=b-m.border;if(t>=i&&s<=A){this.dirty=t==l||s==b?ig:PM,t==i&&s==A&&(m.contentLost||m.dom.parentNode!=this.contentDOM)?m.dirty=xd:m.markDirty(t-i,s-i);return}else m.dirty=m.dom==m.contentDOM&&m.dom.parentNode==this.contentDOM&&!m.children.length?ig:xd}l=b}this.dirty=ig}markParentsDirty(){let t=1;for(let s=this.parent;s;s=s.parent,t++){let l=t==1?ig:PM;s.dirty<l&&(s.dirty=l)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}}class JD extends Cx{constructor(t,s,l,h){let m,b=s.type.toDOM;if(typeof b=="function"&&(b=b(l,()=>{if(!m)return h;if(m.parent)return m.parent.posBeforeChild(m)})),!s.type.spec.raw){if(b.nodeType!=1){let i=document.createElement("span");i.appendChild(b),b=i}b.contentEditable="false",b.classList.add("ProseMirror-widget")}super(t,[],b,null),this.widget=s,this.widget=s,m=this}matchesWidget(t){return this.dirty==gu&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let s=this.widget.spec.stopEvent;return s?s(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class _G extends Cx{constructor(t,s,l,h){super(t,[],s,null),this.textDOM=l,this.text=h}get size(){return this.text.length}localPosFromDOM(t,s){return t!=this.textDOM?this.posAtStart+(s?this.size:0):this.posAtStart+s}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class Sg extends Cx{constructor(t,s,l,h,m){super(t,[],l,h),this.mark=s,this.spec=m}static create(t,s,l,h){let m=h.nodeViews[s.type.name],b=m&&m(s,h,l);return(!b||!b.dom)&&(b=Ag.renderSpec(document,s.type.spec.toDOM(s,l),null,s.attrs)),new Sg(t,s,b.dom,b.contentDOM||b.dom,b)}parseRule(){return this.dirty&xd||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=xd&&this.mark.eq(t)}markDirty(t,s){if(super.markDirty(t,s),this.dirty!=gu){let l=this.parent;for(;!l.node;)l=l.parent;l.dirty<this.dirty&&(l.dirty=this.dirty),this.dirty=gu}}slice(t,s,l){let h=Sg.create(this.parent,this.mark,!0,l),m=this.children,b=this.size;s<b&&(m=PS(m,s,b,l)),t>0&&(m=PS(m,0,t,l));for(let i=0;i<m.length;i++)m[i].parent=h;return h.children=m,h}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Kp extends Cx{constructor(t,s,l,h,m,b,i,A,P){super(t,[],m,b),this.node=s,this.outerDeco=l,this.innerDeco=h,this.nodeDOM=i}static create(t,s,l,h,m,b){let i=m.nodeViews[s.type.name],A,P=i&&i(s,m,()=>{if(!A)return b;if(A.parent)return A.parent.posBeforeChild(A)},l,h),D=P&&P.dom,j=P&&P.contentDOM;if(s.isText){if(!D)D=document.createTextNode(s.text);else if(D.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else D||({dom:D,contentDOM:j}=Ag.renderSpec(document,s.type.spec.toDOM(s),null,s.attrs));!j&&!s.isText&&D.nodeName!="BR"&&(D.hasAttribute("contenteditable")||(D.contentEditable="false"),s.type.spec.draggable&&(D.draggable=!0));let U=D;return D=nO(D,l,s),P?A=new xG(t,s,l,h,D,j||null,U,P,m,b+1):s.isText?new w1(t,s,l,h,D,U,m):new Kp(t,s,l,h,D,j||null,U,m,b+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let s=this.children.length-1;s>=0;s--){let l=this.children[s];if(this.dom.contains(l.dom.parentNode)){t.contentElement=l.dom.parentNode;break}}t.contentElement||(t.getContent=()=>pn.empty)}return t}matchesNode(t,s,l){return this.dirty==gu&&t.eq(this.node)&&p0(s,this.outerDeco)&&l.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,s){let l=this.node.inlineContent,h=s,m=t.composing?this.localCompositionInfo(t,s):null,b=m&&m.pos>-1?m:null,i=m&&m.pos<0,A=new bG(this,b&&b.node,t);TG(this.node,this.innerDeco,(P,D,j)=>{P.spec.marks?A.syncToMarks(P.spec.marks,l,t):P.type.side>=0&&!j&&A.syncToMarks(D==this.node.childCount?xs.none:this.node.child(D).marks,l,t),A.placeWidget(P,t,h)},(P,D,j,U)=>{A.syncToMarks(P.marks,l,t);let X;A.findNodeMatch(P,D,j,U)||i&&t.state.selection.from>h&&t.state.selection.to<h+P.nodeSize&&(X=A.findIndexWithChild(m.node))>-1&&A.updateNodeAt(P,D,j,X,t)||A.updateNextNode(P,D,j,t,U,h)||A.addNode(P,D,j,t,h),h+=P.nodeSize}),A.syncToMarks([],l,t),this.node.isTextblock&&A.addTextblockHacks(),A.destroyRest(),(A.changed||this.dirty==ig)&&(b&&this.protectLocalComposition(t,b),eO(this.contentDOM,this.children,t),Iy&&EG(this.dom))}localCompositionInfo(t,s){let{from:l,to:h}=t.state.selection;if(!(t.state.selection instanceof ti)||l<s||h>s+this.node.content.size)return null;let m=t.input.compositionNode;if(!m||!this.dom.contains(m.parentNode))return null;if(this.node.inlineContent){let b=m.nodeValue,i=CG(this.node.content,b,l-s,h-s);return i<0?null:{node:m,pos:i,text:b}}else return{node:m,pos:-1,text:""}}protectLocalComposition(t,{node:s,pos:l,text:h}){if(this.getDesc(s))return;let m=s;for(;m.parentNode!=this.contentDOM;m=m.parentNode){for(;m.previousSibling;)m.parentNode.removeChild(m.previousSibling);for(;m.nextSibling;)m.parentNode.removeChild(m.nextSibling);m.pmViewDesc&&(m.pmViewDesc=void 0)}let b=new _G(this,m,s,h);t.input.compositionNodes.push(b),this.children=PS(this.children,l,l+h.length,t,b)}update(t,s,l,h){return this.dirty==xd||!t.sameMarkup(this.node)?!1:(this.updateInner(t,s,l,h),!0)}updateInner(t,s,l,h){this.updateOuterDeco(s),this.node=t,this.innerDeco=l,this.contentDOM&&this.updateChildren(h,this.posAtStart),this.dirty=gu}updateOuterDeco(t){if(p0(t,this.outerDeco))return;let s=this.nodeDOM.nodeType!=1,l=this.dom;this.dom=tO(this.dom,this.nodeDOM,kS(this.outerDeco,this.node,s),kS(t,this.node,s)),this.dom!=l&&(l.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function RM(n,t,s,l,h){nO(l,t,n);let m=new Kp(void 0,n,t,s,l,l,l,h,0);return m.contentDOM&&m.updateChildren(h,0),m}class w1 extends Kp{constructor(t,s,l,h,m,b,i){super(t,s,l,h,m,null,b,i,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,s,l,h){return this.dirty==xd||this.dirty!=gu&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(s),(this.dirty!=gu||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,h.trackWrites==this.nodeDOM&&(h.trackWrites=null)),this.node=t,this.dirty=gu,!0)}inParent(){let t=this.parent.contentDOM;for(let s=this.nodeDOM;s;s=s.parentNode)if(s==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,s,l){return t==this.nodeDOM?this.posAtStart+Math.min(s,this.node.text.length):super.localPosFromDOM(t,s,l)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,s,l){let h=this.node.cut(t,s),m=document.createTextNode(h.text);return new w1(this.parent,h,this.outerDeco,this.innerDeco,m,m,l)}markDirty(t,s){super.markDirty(t,s),this.dom!=this.nodeDOM&&(t==0||s==this.nodeDOM.nodeValue.length)&&(this.dirty=xd)}get domAtom(){return!1}isText(t){return this.node.text==t}}class QD extends Cx{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==gu&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class xG extends Kp{constructor(t,s,l,h,m,b,i,A,P,D){super(t,s,l,h,m,b,i,P,D),this.spec=A}update(t,s,l,h){if(this.dirty==xd)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let m=this.spec.update(t,s,l);return m&&this.updateInner(t,s,l,h),m}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,s,l,h)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,s,l,h){this.spec.setSelection?this.spec.setSelection(t,s,l.root):super.setSelection(t,s,l,h)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function eO(n,t,s){let l=n.firstChild,h=!1;for(let m=0;m<t.length;m++){let b=t[m],i=b.dom;if(i.parentNode==n){for(;i!=l;)l=NM(l),h=!0;l=l.nextSibling}else h=!0,n.insertBefore(i,l);if(b instanceof Sg){let A=l?l.previousSibling:n.lastChild;eO(b.contentDOM,b.children,s),l=A?A.nextSibling:n.firstChild}}for(;l;)l=NM(l),h=!0;h&&s.trackWrites==n&&(s.trackWrites=null)}const W_=function(n){n&&(this.nodeName=n)};W_.prototype=Object.create(null);const sg=[new W_];function kS(n,t,s){if(n.length==0)return sg;let l=s?sg[0]:new W_,h=[l];for(let m=0;m<n.length;m++){let b=n[m].type.attrs;if(b){b.nodeName&&h.push(l=new W_(b.nodeName));for(let i in b){let A=b[i];A!=null&&(s&&h.length==1&&h.push(l=new W_(t.isInline?"span":"div")),i=="class"?l.class=(l.class?l.class+" ":"")+A:i=="style"?l.style=(l.style?l.style+";":"")+A:i!="nodeName"&&(l[i]=A))}}}return h}function tO(n,t,s,l){if(s==sg&&l==sg)return t;let h=t;for(let m=0;m<l.length;m++){let b=l[m],i=s[m];if(m){let A;i&&i.nodeName==b.nodeName&&h!=n&&(A=h.parentNode)&&A.nodeName.toLowerCase()==b.nodeName||(A=document.createElement(b.nodeName),A.pmIsDeco=!0,A.appendChild(h),i=sg[0]),h=A}vG(h,i||sg[0],b)}return h}function vG(n,t,s){for(let l in t)l!="class"&&l!="style"&&l!="nodeName"&&!(l in s)&&n.removeAttribute(l);for(let l in s)l!="class"&&l!="style"&&l!="nodeName"&&s[l]!=t[l]&&n.setAttribute(l,s[l]);if(t.class!=s.class){let l=t.class?t.class.split(" ").filter(Boolean):[],h=s.class?s.class.split(" ").filter(Boolean):[];for(let m=0;m<l.length;m++)h.indexOf(l[m])==-1&&n.classList.remove(l[m]);for(let m=0;m<h.length;m++)l.indexOf(h[m])==-1&&n.classList.add(h[m]);n.classList.length==0&&n.removeAttribute("class")}if(t.style!=s.style){if(t.style){let l=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,h;for(;h=l.exec(t.style);)n.style.removeProperty(h[1])}s.style&&(n.style.cssText+=s.style)}}function nO(n,t,s){return tO(n,n,sg,kS(t,s,n.nodeType!=1))}function p0(n,t){if(n.length!=t.length)return!1;for(let s=0;s<n.length;s++)if(!n[s].type.eq(t[s].type))return!1;return!0}function NM(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}class bG{constructor(t,s,l){this.lock=s,this.view=l,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=wG(t.node.content,t)}destroyBetween(t,s){if(t!=s){for(let l=t;l<s;l++)this.top.children[l].destroy();this.top.children.splice(t,s-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,s,l){let h=0,m=this.stack.length>>1,b=Math.min(m,t.length);for(;h<b&&(h==m-1?this.top:this.stack[h+1<<1]).matchesMark(t[h])&&t[h].type.spec.spanning!==!1;)h++;for(;h<m;)this.destroyRest(),this.top.dirty=gu,this.index=this.stack.pop(),this.top=this.stack.pop(),m--;for(;m<t.length;){this.stack.push(this.top,this.index+1);let i=-1;for(let A=this.index;A<Math.min(this.index+3,this.top.children.length);A++){let P=this.top.children[A];if(P.matchesMark(t[m])&&!this.isLocked(P.dom)){i=A;break}}if(i>-1)i>this.index&&(this.changed=!0,this.destroyBetween(this.index,i)),this.top=this.top.children[this.index];else{let A=Sg.create(this.top,t[m],s,l);this.top.children.splice(this.index,0,A),this.top=A,this.changed=!0}this.index=0,m++}}findNodeMatch(t,s,l,h){let m=-1,b;if(h>=this.preMatch.index&&(b=this.preMatch.matches[h-this.preMatch.index]).parent==this.top&&b.matchesNode(t,s,l))m=this.top.children.indexOf(b,this.index);else for(let i=this.index,A=Math.min(this.top.children.length,i+5);i<A;i++){let P=this.top.children[i];if(P.matchesNode(t,s,l)&&!this.preMatch.matched.has(P)){m=i;break}}return m<0?!1:(this.destroyBetween(this.index,m),this.index++,!0)}updateNodeAt(t,s,l,h,m){let b=this.top.children[h];return b.dirty==xd&&b.dom==b.contentDOM&&(b.dirty=ig),b.update(t,s,l,m)?(this.destroyBetween(this.index,h),this.index++,!0):!1}findIndexWithChild(t){for(;;){let s=t.parentNode;if(!s)return-1;if(s==this.top.contentDOM){let l=t.pmViewDesc;if(l){for(let h=this.index;h<this.top.children.length;h++)if(this.top.children[h]==l)return h}return-1}t=s}}updateNextNode(t,s,l,h,m,b){for(let i=this.index;i<this.top.children.length;i++){let A=this.top.children[i];if(A instanceof Kp){let P=this.preMatch.matched.get(A);if(P!=null&&P!=m)return!1;let D=A.dom,j,U=this.isLocked(D)&&!(t.isText&&A.node&&A.node.isText&&A.nodeDOM.nodeValue==t.text&&A.dirty!=xd&&p0(s,A.outerDeco));if(!U&&A.update(t,s,l,h))return this.destroyBetween(this.index,i),A.dom!=D&&(this.changed=!0),this.index++,!0;if(!U&&(j=this.recreateWrapper(A,t,s,l,h,b)))return this.destroyBetween(this.index,i),this.top.children[this.index]=j,j.contentDOM&&(j.dirty=ig,j.updateChildren(h,b+1),j.dirty=gu),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,s,l,h,m,b){if(t.dirty||s.isAtom||!t.children.length||!t.node.content.eq(s.content)||!p0(l,t.outerDeco)||!h.eq(t.innerDeco))return null;let i=Kp.create(this.top,s,l,h,m,b);if(i.contentDOM){i.children=t.children,t.children=[];for(let A of i.children)A.parent=i}return t.destroy(),i}addNode(t,s,l,h,m){let b=Kp.create(this.top,t,s,l,h,m);b.contentDOM&&b.updateChildren(h,m+1),this.top.children.splice(this.index++,0,b),this.changed=!0}placeWidget(t,s,l){let h=this.index<this.top.children.length?this.top.children[this.index]:null;if(h&&h.matchesWidget(t)&&(t==h.widget||!h.widget.type.toDOM.parentNode))this.index++;else{let m=new JD(this.top,t,s,l);this.top.children.splice(this.index++,0,m),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],s=this.top;for(;t instanceof Sg;)s=t,t=s.children[s.children.length-1];(!t||!(t instanceof w1)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((wl||il)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",s),this.addHackNode("BR",this.top))}addHackNode(t,s){if(s==this.top&&this.index<s.children.length&&s.children[this.index].matchesHack(t))this.index++;else{let l=document.createElement(t);t=="IMG"&&(l.className="ProseMirror-separator",l.alt=""),t=="BR"&&(l.className="ProseMirror-trailingBreak");let h=new QD(this.top,[],l,null);s!=this.top?s.children.push(h):s.children.splice(this.index++,0,h),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function wG(n,t){let s=t,l=s.children.length,h=n.childCount,m=new Map,b=[];e:for(;h>0;){let i;for(;;)if(l){let P=s.children[l-1];if(P instanceof Sg)s=P,l=P.children.length;else{i=P,l--;break}}else{if(s==t)break e;l=s.parent.children.indexOf(s),s=s.parent}let A=i.node;if(A){if(A!=n.child(h-1))break;--h,m.set(i,h),b.push(i)}}return{index:h,matched:m,matches:b.reverse()}}function SG(n,t){return n.type.side-t.type.side}function TG(n,t,s,l){let h=t.locals(n),m=0;if(h.length==0){for(let P=0;P<n.childCount;P++){let D=n.child(P);l(D,h,t.forChild(m,D),P),m+=D.nodeSize}return}let b=0,i=[],A=null;for(let P=0;;){let D,j;for(;b<h.length&&h[b].to==m;){let re=h[b++];re.widget&&(D?(j||(j=[D])).push(re):D=re)}if(D)if(j){j.sort(SG);for(let re=0;re<j.length;re++)s(j[re],P,!!A)}else s(D,P,!!A);let U,X;if(A)X=-1,U=A,A=null;else if(P<n.childCount)X=P,U=n.child(P++);else break;for(let re=0;re<i.length;re++)i[re].to<=m&&i.splice(re--,1);for(;b<h.length&&h[b].from<=m&&h[b].to>m;)i.push(h[b++]);let Y=m+U.nodeSize;if(U.isText){let re=Y;b<h.length&&h[b].from<re&&(re=h[b].from);for(let de=0;de<i.length;de++)i[de].to<re&&(re=i[de].to);re<Y&&(A=U.cut(re-m),U=U.cut(0,re-m),Y=re,X=-1)}else for(;b<h.length&&h[b].to<Y;)b++;let W=U.isInline&&!U.isLeaf?i.filter(re=>!re.inline):i.slice();l(U,W,t.forChild(m,U),X),m=Y}}function EG(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=t}}function CG(n,t,s,l){for(let h=0,m=0;h<n.childCount&&m<=l;){let b=n.child(h++),i=m;if(m+=b.nodeSize,!b.isText)continue;let A=b.text;for(;h<n.childCount;){let P=n.child(h++);if(m+=P.nodeSize,!P.isText)break;A+=P.text}if(m>=s){if(m>=l&&A.slice(l-t.length-i,l-i)==t)return l-t.length;let P=i<l?A.lastIndexOf(t,l-i-1):-1;if(P>=0&&P+t.length+i>=s)return i+P;if(s==l&&A.length>=l+t.length-i&&A.slice(l-i,l-i+t.length)==t)return l}}return-1}function PS(n,t,s,l,h){let m=[];for(let b=0,i=0;b<n.length;b++){let A=n[b],P=i,D=i+=A.size;P>=s||D<=t?m.push(A):(P<t&&m.push(A.slice(0,t-P,l)),h&&(m.push(h),h=void 0),D>s&&m.push(A.slice(s-P,A.size,l)))}return m}function BT(n,t=null){let s=n.domSelectionRange(),l=n.state.doc;if(!s.focusNode)return null;let h=n.docView.nearestDesc(s.focusNode),m=h&&h.size==0,b=n.docView.posFromDOM(s.focusNode,s.focusOffset,1);if(b<0)return null;let i=l.resolve(b),A,P;if(b1(s)){for(A=b;h&&!h.node;)h=h.parent;let j=h.node;if(h&&j.isAtom&&kr.isSelectable(j)&&h.parent&&!(j.isInline&&JH(s.focusNode,s.focusOffset,h.dom))){let U=h.posBefore;P=new kr(b==U?i:l.resolve(U))}}else{if(s instanceof n.dom.ownerDocument.defaultView.Selection&&s.rangeCount>1){let j=b,U=b;for(let X=0;X<s.rangeCount;X++){let Y=s.getRangeAt(X);j=Math.min(j,n.docView.posFromDOM(Y.startContainer,Y.startOffset,1)),U=Math.max(U,n.docView.posFromDOM(Y.endContainer,Y.endOffset,-1))}if(j<0)return null;[A,b]=U==n.state.selection.anchor?[U,j]:[j,U],i=l.resolve(b)}else A=n.docView.posFromDOM(s.anchorNode,s.anchorOffset,1);if(A<0)return null}let D=l.resolve(A);if(!P){let j=t=="pointer"||n.state.selection.head<i.pos&&!m?1:-1;P=VT(n,D,i,j)}return P}function rO(n){return n.editable?n.hasFocus():sO(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Tf(n,t=!1){let s=n.state.selection;if(iO(n,s),!!rO(n)){if(!t&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&il){let l=n.domSelectionRange(),h=n.domObserver.currentSelection;if(l.anchorNode&&h.anchorNode&&wg(l.anchorNode,l.anchorOffset,h.anchorNode,h.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)IG(n);else{let{anchor:l,head:h}=s,m,b;DM&&!(s instanceof ti)&&(s.$from.parent.inlineContent||(m=OM(n,s.from)),!s.empty&&!s.$from.parent.inlineContent&&(b=OM(n,s.to))),n.docView.setSelection(l,h,n,t),DM&&(m&&LM(m),b&&LM(b)),s.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&AG(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const DM=wl||il&&GD<63;function OM(n,t){let{node:s,offset:l}=n.docView.domFromPos(t,0),h=l<s.childNodes.length?s.childNodes[l]:null,m=l?s.childNodes[l-1]:null;if(wl&&h&&h.contentEditable=="false")return ww(h);if((!h||h.contentEditable=="false")&&(!m||m.contentEditable=="false")){if(h)return ww(h);if(m)return ww(m)}}function ww(n){return n.contentEditable="true",wl&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function LM(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function AG(n){let t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.input.hideSelectionGuard);let s=n.domSelectionRange(),l=s.anchorNode,h=s.anchorOffset;t.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(s.anchorNode!=l||s.anchorOffset!=h)&&(t.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!rO(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function IG(n){let t=n.domSelection(),s=document.createRange();if(!t)return;let l=n.cursorWrapper.dom,h=l.nodeName=="IMG";h?s.setStart(l.parentNode,za(l)+1):s.setStart(l,0),s.collapse(!0),t.removeAllRanges(),t.addRange(s),!h&&!n.state.selection.visible&&Yl&&Xp<=11&&(l.disabled=!0,l.disabled=!1)}function iO(n,t){if(t instanceof kr){let s=n.docView.descAt(t.from);s!=n.lastSelectedViewDesc&&(zM(n),s&&s.selectNode(),n.lastSelectedViewDesc=s)}else zM(n)}function zM(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function VT(n,t,s,l){return n.someProp("createSelectionBetween",h=>h(n,t,s))||ti.between(t,s,l)}function jM(n){return n.editable&&!n.hasFocus()?!1:sO(n)}function sO(n){let t=n.domSelectionRange();if(!t.anchorNode)return!1;try{return n.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function MG(n){let t=n.docView.domFromPos(n.state.selection.anchor,0),s=n.domSelectionRange();return wg(t.node,t.offset,s.anchorNode,s.anchorOffset)}function RS(n,t){let{$anchor:s,$head:l}=n.selection,h=t>0?s.max(l):s.min(l),m=h.parent.inlineContent?h.depth?n.doc.resolve(t>0?h.after():h.before()):null:h;return m&&vi.findFrom(m,t)}function zp(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function FM(n,t,s){let l=n.state.selection;if(l instanceof ti)if(s.indexOf("s")>-1){let{$head:h}=l,m=h.textOffset?null:t<0?h.nodeBefore:h.nodeAfter;if(!m||m.isText||!m.isLeaf)return!1;let b=n.state.doc.resolve(h.pos+m.nodeSize*(t<0?-1:1));return zp(n,new ti(l.$anchor,b))}else if(l.empty){if(n.endOfTextblock(t>0?"forward":"backward")){let h=RS(n.state,t);return h&&h instanceof kr?zp(n,h):!1}else if(!(pu&&s.indexOf("m")>-1)){let h=l.$head,m=h.textOffset?null:t<0?h.nodeBefore:h.nodeAfter,b;if(!m||m.isText)return!1;let i=t<0?h.pos-m.nodeSize:h.pos;return m.isAtom||(b=n.docView.descAt(i))&&!b.contentDOM?kr.isSelectable(m)?zp(n,new kr(t<0?n.state.doc.resolve(h.pos-m.nodeSize):h)):Ex?zp(n,new ti(n.state.doc.resolve(t<0?i:i+m.nodeSize))):!1:!1}}else return!1;else{if(l instanceof kr&&l.node.isInline)return zp(n,new ti(t>0?l.$to:l.$from));{let h=RS(n.state,t);return h?zp(n,h):!1}}}function m0(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Z_(n,t){let s=n.pmViewDesc;return s&&s.size==0&&(t<0||n.nextSibling||n.nodeName!="BR")}function hy(n,t){return t<0?kG(n):PG(n)}function kG(n){let t=n.domSelectionRange(),s=t.focusNode,l=t.focusOffset;if(!s)return;let h,m,b=!1;for(ph&&s.nodeType==1&&l<m0(s)&&Z_(s.childNodes[l],-1)&&(b=!0);;)if(l>0){if(s.nodeType!=1)break;{let i=s.childNodes[l-1];if(Z_(i,-1))h=s,m=--l;else if(i.nodeType==3)s=i,l=s.nodeValue.length;else break}}else{if(oO(s))break;{let i=s.previousSibling;for(;i&&Z_(i,-1);)h=s.parentNode,m=za(i),i=i.previousSibling;if(i)s=i,l=m0(s);else{if(s=s.parentNode,s==n.dom)break;l=0}}}b?NS(n,s,l):h&&NS(n,h,m)}function PG(n){let t=n.domSelectionRange(),s=t.focusNode,l=t.focusOffset;if(!s)return;let h=m0(s),m,b;for(;;)if(l<h){if(s.nodeType!=1)break;let i=s.childNodes[l];if(Z_(i,1))m=s,b=++l;else break}else{if(oO(s))break;{let i=s.nextSibling;for(;i&&Z_(i,1);)m=i.parentNode,b=za(i)+1,i=i.nextSibling;if(i)s=i,l=0,h=m0(s);else{if(s=s.parentNode,s==n.dom)break;l=h=0}}}m&&NS(n,m,b)}function oO(n){let t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function RG(n,t){for(;n&&t==n.childNodes.length&&!Tx(n);)t=za(n)+1,n=n.parentNode;for(;n&&t<n.childNodes.length;){let s=n.childNodes[t];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;n=s,t=0}}function NG(n,t){for(;n&&!t&&!Tx(n);)t=za(n),n=n.parentNode;for(;n&&t;){let s=n.childNodes[t-1];if(s.nodeType==3)return s;if(s.nodeType==1&&s.contentEditable=="false")break;n=s,t=n.childNodes.length}}function NS(n,t,s){if(t.nodeType!=3){let m,b;(b=RG(t,s))?(t=b,s=0):(m=NG(t,s))&&(t=m,s=m.nodeValue.length)}let l=n.domSelection();if(!l)return;if(b1(l)){let m=document.createRange();m.setEnd(t,s),m.setStart(t,s),l.removeAllRanges(),l.addRange(m)}else l.extend&&l.extend(t,s);n.domObserver.setCurSelection();let{state:h}=n;setTimeout(()=>{n.state==h&&Tf(n)},50)}function BM(n,t){let s=n.state.doc.resolve(t);if(!(il||tG)&&s.parent.inlineContent){let h=n.coordsAtPos(t);if(t>s.start()){let m=n.coordsAtPos(t-1),b=(m.top+m.bottom)/2;if(b>h.top&&b<h.bottom&&Math.abs(m.left-h.left)>1)return m.left<h.left?"ltr":"rtl"}if(t<s.end()){let m=n.coordsAtPos(t+1),b=(m.top+m.bottom)/2;if(b>h.top&&b<h.bottom&&Math.abs(m.left-h.left)>1)return m.left>h.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function VM(n,t,s){let l=n.state.selection;if(l instanceof ti&&!l.empty||s.indexOf("s")>-1||pu&&s.indexOf("m")>-1)return!1;let{$from:h,$to:m}=l;if(!h.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){let b=RS(n.state,t);if(b&&b instanceof kr)return zp(n,b)}if(!h.parent.inlineContent){let b=t<0?h:m,i=l instanceof Ic?vi.near(b,t):vi.findFrom(b,t);return i?zp(n,i):!1}return!1}function UM(n,t){if(!(n.state.selection instanceof ti))return!0;let{$head:s,$anchor:l,empty:h}=n.state.selection;if(!s.sameParent(l))return!0;if(!h)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;let m=!s.textOffset&&(t<0?s.nodeBefore:s.nodeAfter);if(m&&!m.isText){let b=n.state.tr;return t<0?b.delete(s.pos-m.nodeSize,s.pos):b.delete(s.pos,s.pos+m.nodeSize),n.dispatch(b),!0}return!1}function $M(n,t,s){n.domObserver.stop(),t.contentEditable=s,n.domObserver.start()}function DG(n){if(!wl||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:s}=n.domSelectionRange();if(t&&t.nodeType==1&&s==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let l=t.firstChild;$M(n,l,"true"),setTimeout(()=>$M(n,l,"false"),20)}return!1}function OG(n){let t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}function LG(n,t){let s=t.keyCode,l=OG(t);if(s==8||pu&&s==72&&l=="c")return UM(n,-1)||hy(n,-1);if(s==46&&!t.shiftKey||pu&&s==68&&l=="c")return UM(n,1)||hy(n,1);if(s==13||s==27)return!0;if(s==37||pu&&s==66&&l=="c"){let h=s==37?BM(n,n.state.selection.from)=="ltr"?-1:1:-1;return FM(n,h,l)||hy(n,h)}else if(s==39||pu&&s==70&&l=="c"){let h=s==39?BM(n,n.state.selection.from)=="ltr"?1:-1:1;return FM(n,h,l)||hy(n,h)}else{if(s==38||pu&&s==80&&l=="c")return VM(n,-1,l)||hy(n,-1);if(s==40||pu&&s==78&&l=="c")return DG(n)||VM(n,1,l)||hy(n,1);if(l==(pu?"m":"c")&&(s==66||s==73||s==89||s==90))return!0}return!1}function UT(n,t){n.someProp("transformCopied",X=>{t=X(t,n)});let s=[],{content:l,openStart:h,openEnd:m}=t;for(;h>1&&m>1&&l.childCount==1&&l.firstChild.childCount==1;){h--,m--;let X=l.firstChild;s.push(X.type.name,X.attrs!=X.type.defaultAttrs?X.attrs:null),l=X.content}let b=n.someProp("clipboardSerializer")||Ag.fromSchema(n.state.schema),i=dO(),A=i.createElement("div");A.appendChild(b.serializeFragment(l,{document:i}));let P=A.firstChild,D,j=0;for(;P&&P.nodeType==1&&(D=hO[P.nodeName.toLowerCase()]);){for(let X=D.length-1;X>=0;X--){let Y=i.createElement(D[X]);for(;A.firstChild;)Y.appendChild(A.firstChild);A.appendChild(Y),j++}P=A.firstChild}P&&P.nodeType==1&&P.setAttribute("data-pm-slice",`${h} ${m}${j?` -${j}`:""} ${JSON.stringify(s)}`);let U=n.someProp("clipboardTextSerializer",X=>X(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:A,text:U,slice:t}}function aO(n,t,s,l,h){let m=h.parent.type.spec.code,b,i;if(!s&&!t)return null;let A=t&&(l||m||!s);if(A){if(n.someProp("transformPastedText",U=>{t=U(t,m||l,n)}),m)return t?new Yn(pn.from(n.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):Yn.empty;let j=n.someProp("clipboardTextParser",U=>U(t,h,l,n));if(j)i=j;else{let U=h.marks(),{schema:X}=n.state,Y=Ag.fromSchema(X);b=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(W=>{let re=b.appendChild(document.createElement("p"));W&&re.appendChild(Y.serializeNode(X.text(W,U)))})}}else n.someProp("transformPastedHTML",j=>{s=j(s,n)}),b=BG(s),Ex&&VG(b);let P=b&&b.querySelector("[data-pm-slice]"),D=P&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(P.getAttribute("data-pm-slice")||"");if(D&&D[3])for(let j=+D[3];j>0;j--){let U=b.firstChild;for(;U&&U.nodeType!=1;)U=U.nextSibling;if(!U)break;b=U}if(i||(i=(n.someProp("clipboardParser")||n.someProp("domParser")||Zp.fromSchema(n.state.schema)).parseSlice(b,{preserveWhitespace:!!(A||D),context:h,ruleFromNode(U){return U.nodeName=="BR"&&!U.nextSibling&&U.parentNode&&!zG.test(U.parentNode.nodeName)?{ignore:!0}:null}})),D)i=UG(HM(i,+D[1],+D[2]),D[4]);else if(i=Yn.maxOpen(jG(i.content,h),!0),i.openStart||i.openEnd){let j=0,U=0;for(let X=i.content.firstChild;j<i.openStart&&!X.type.spec.isolating;j++,X=X.firstChild);for(let X=i.content.lastChild;U<i.openEnd&&!X.type.spec.isolating;U++,X=X.lastChild);i=HM(i,j,U)}return n.someProp("transformPasted",j=>{i=j(i,n)}),i}const zG=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function jG(n,t){if(n.childCount<2)return n;for(let s=t.depth;s>=0;s--){let h=t.node(s).contentMatchAt(t.index(s)),m,b=[];if(n.forEach(i=>{if(!b)return;let A=h.findWrapping(i.type),P;if(!A)return b=null;if(P=b.length&&m.length&&cO(A,m,i,b[b.length-1],0))b[b.length-1]=P;else{b.length&&(b[b.length-1]=uO(b[b.length-1],m.length));let D=lO(i,A);b.push(D),h=h.matchType(D.type),m=A}}),b)return pn.from(b)}return n}function lO(n,t,s=0){for(let l=t.length-1;l>=s;l--)n=t[l].create(null,pn.from(n));return n}function cO(n,t,s,l,h){if(h<n.length&&h<t.length&&n[h]==t[h]){let m=cO(n,t,s,l.lastChild,h+1);if(m)return l.copy(l.content.replaceChild(l.childCount-1,m));if(l.contentMatchAt(l.childCount).matchType(h==n.length-1?s.type:n[h+1]))return l.copy(l.content.append(pn.from(lO(s,n,h+1))))}}function uO(n,t){if(t==0)return n;let s=n.content.replaceChild(n.childCount-1,uO(n.lastChild,t-1)),l=n.contentMatchAt(n.childCount).fillBefore(pn.empty,!0);return n.copy(s.append(l))}function DS(n,t,s,l,h,m){let b=t<0?n.firstChild:n.lastChild,i=b.content;return n.childCount>1&&(m=0),h<l-1&&(i=DS(i,t,s,l,h+1,m)),h>=s&&(i=t<0?b.contentMatchAt(0).fillBefore(i,m<=h).append(i):i.append(b.contentMatchAt(b.childCount).fillBefore(pn.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,b.copy(i))}function HM(n,t,s){return t<n.openStart&&(n=new Yn(DS(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),s<n.openEnd&&(n=new Yn(DS(n.content,1,s,n.openEnd,0,0),n.openStart,s)),n}const hO={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let GM=null;function dO(){return GM||(GM=document.implementation.createHTMLDocument("title"))}let Sw=null;function FG(n){let t=window.trustedTypes;return t?(Sw||(Sw=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:s=>s})),Sw.createHTML(n)):n}function BG(n){let t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));let s=dO().createElement("div"),l=/<([a-z][^>\s]+)/i.exec(n),h;if((h=l&&hO[l[1].toLowerCase()])&&(n=h.map(m=>"<"+m+">").join("")+n+h.map(m=>"</"+m+">").reverse().join("")),s.innerHTML=FG(n),h)for(let m=0;m<h.length;m++)s=s.querySelector(h[m])||s;return s}function VG(n){let t=n.querySelectorAll(il?"span:not([class]):not([style])":"span.Apple-converted-space");for(let s=0;s<t.length;s++){let l=t[s];l.childNodes.length==1&&l.textContent==""&&l.parentNode&&l.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),l)}}function UG(n,t){if(!n.size)return n;let s=n.content.firstChild.type.schema,l;try{l=JSON.parse(t)}catch{return n}let{content:h,openStart:m,openEnd:b}=n;for(let i=l.length-2;i>=0;i-=2){let A=s.nodes[l[i]];if(!A||A.hasRequiredAttrs())break;h=pn.from(A.create(l[i+1],h)),m++,b++}return new Yn(h,m,b)}const Sl={},Tl={},$G={touchstart:!0,touchmove:!0};class HG{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function GG(n){for(let t in Sl){let s=Sl[t];n.dom.addEventListener(t,n.input.eventHandlers[t]=l=>{WG(n,l)&&!$T(n,l)&&(n.editable||!(l.type in Tl))&&s(n,l)},$G[t]?{passive:!0}:void 0)}wl&&n.dom.addEventListener("input",()=>null),OS(n)}function Gp(n,t){n.input.lastSelectionOrigin=t,n.input.lastSelectionTime=Date.now()}function qG(n){n.domObserver.stop();for(let t in n.input.eventHandlers)n.dom.removeEventListener(t,n.input.eventHandlers[t]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function OS(n){n.someProp("handleDOMEvents",t=>{for(let s in t)n.input.eventHandlers[s]||n.dom.addEventListener(s,n.input.eventHandlers[s]=l=>$T(n,l))})}function $T(n,t){return n.someProp("handleDOMEvents",s=>{let l=s[t.type];return l?l(n,t)||t.defaultPrevented:!1})}function WG(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let s=t.target;s!=n.dom;s=s.parentNode)if(!s||s.nodeType==11||s.pmViewDesc&&s.pmViewDesc.stopEvent(t))return!1;return!0}function ZG(n,t){!$T(n,t)&&Sl[t.type]&&(n.editable||!(t.type in Tl))&&Sl[t.type](n,t)}Tl.keydown=(n,t)=>{let s=t;if(n.input.shiftKey=s.keyCode==16||s.shiftKey,!pO(n,s)&&(n.input.lastKeyCode=s.keyCode,n.input.lastKeyCodeTime=Date.now(),!(bf&&il&&s.keyCode==13)))if(s.keyCode!=229&&n.domObserver.forceFlush(),Iy&&s.keyCode==13&&!s.ctrlKey&&!s.altKey&&!s.metaKey){let l=Date.now();n.input.lastIOSEnter=l,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==l&&(n.someProp("handleKeyDown",h=>h(n,rg(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",l=>l(n,s))||LG(n,s)?s.preventDefault():Gp(n,"key")};Tl.keyup=(n,t)=>{t.keyCode==16&&(n.input.shiftKey=!1)};Tl.keypress=(n,t)=>{let s=t;if(pO(n,s)||!s.charCode||s.ctrlKey&&!s.altKey||pu&&s.metaKey)return;if(n.someProp("handleKeyPress",h=>h(n,s))){s.preventDefault();return}let l=n.state.selection;if(!(l instanceof ti)||!l.$from.sameParent(l.$to)){let h=String.fromCharCode(s.charCode),m=()=>n.state.tr.insertText(h).scrollIntoView();!/[\r\n]/.test(h)&&!n.someProp("handleTextInput",b=>b(n,l.$from.pos,l.$to.pos,h,m))&&n.dispatch(m()),s.preventDefault()}};function S1(n){return{left:n.clientX,top:n.clientY}}function XG(n,t){let s=t.x-n.clientX,l=t.y-n.clientY;return s*s+l*l<100}function HT(n,t,s,l,h){if(l==-1)return!1;let m=n.state.doc.resolve(l);for(let b=m.depth+1;b>0;b--)if(n.someProp(t,i=>b>m.depth?i(n,s,m.nodeAfter,m.before(b),h,!0):i(n,s,m.node(b),m.before(b),h,!1)))return!0;return!1}function wy(n,t,s){if(n.focused||n.focus(),n.state.selection.eq(t))return;let l=n.state.tr.setSelection(t);l.setMeta("pointer",!0),n.dispatch(l)}function KG(n,t){if(t==-1)return!1;let s=n.state.doc.resolve(t),l=s.nodeAfter;return l&&l.isAtom&&kr.isSelectable(l)?(wy(n,new kr(s)),!0):!1}function YG(n,t){if(t==-1)return!1;let s=n.state.selection,l,h;s instanceof kr&&(l=s.node);let m=n.state.doc.resolve(t);for(let b=m.depth+1;b>0;b--){let i=b>m.depth?m.nodeAfter:m.node(b);if(kr.isSelectable(i)){l&&s.$from.depth>0&&b>=s.$from.depth&&m.before(s.$from.depth+1)==s.$from.pos?h=m.before(s.$from.depth):h=m.before(b);break}}return h!=null?(wy(n,kr.create(n.state.doc,h)),!0):!1}function JG(n,t,s,l,h){return HT(n,"handleClickOn",t,s,l)||n.someProp("handleClick",m=>m(n,t,l))||(h?YG(n,s):KG(n,s))}function QG(n,t,s,l){return HT(n,"handleDoubleClickOn",t,s,l)||n.someProp("handleDoubleClick",h=>h(n,t,l))}function eq(n,t,s,l){return HT(n,"handleTripleClickOn",t,s,l)||n.someProp("handleTripleClick",h=>h(n,t,l))||tq(n,s,l)}function tq(n,t,s){if(s.button!=0)return!1;let l=n.state.doc;if(t==-1)return l.inlineContent?(wy(n,ti.create(l,0,l.content.size)),!0):!1;let h=l.resolve(t);for(let m=h.depth+1;m>0;m--){let b=m>h.depth?h.nodeAfter:h.node(m),i=h.before(m);if(b.inlineContent)wy(n,ti.create(l,i+1,i+1+b.content.size));else if(kr.isSelectable(b))wy(n,kr.create(l,i));else continue;return!0}}function GT(n){return g0(n)}const fO=pu?"metaKey":"ctrlKey";Sl.mousedown=(n,t)=>{let s=t;n.input.shiftKey=s.shiftKey;let l=GT(n),h=Date.now(),m="singleClick";h-n.input.lastClick.time<500&&XG(s,n.input.lastClick)&&!s[fO]&&n.input.lastClick.button==s.button&&(n.input.lastClick.type=="singleClick"?m="doubleClick":n.input.lastClick.type=="doubleClick"&&(m="tripleClick")),n.input.lastClick={time:h,x:s.clientX,y:s.clientY,type:m,button:s.button};let b=n.posAtCoords(S1(s));b&&(m=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new nq(n,b,s,!!l)):(m=="doubleClick"?QG:eq)(n,b.pos,b.inside,s)?s.preventDefault():Gp(n,"pointer"))};class nq{constructor(t,s,l,h){this.view=t,this.pos=s,this.event=l,this.flushed=h,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!l[fO],this.allowDefault=l.shiftKey;let m,b;if(s.inside>-1)m=t.state.doc.nodeAt(s.inside),b=s.inside;else{let D=t.state.doc.resolve(s.pos);m=D.parent,b=D.depth?D.before():0}const i=h?null:l.target,A=i?t.docView.nearestDesc(i,!0):null;this.target=A&&A.dom.nodeType==1?A.dom:null;let{selection:P}=t.state;(l.button==0&&m.type.spec.draggable&&m.type.spec.selectable!==!1||P instanceof kr&&P.from<=b&&P.to>b)&&(this.mightDrag={node:m,pos:b,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ph&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),Gp(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Tf(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let s=this.pos;this.view.state.doc!=this.startDoc&&(s=this.view.posAtCoords(S1(t))),this.updateAllowDefault(t),this.allowDefault||!s?Gp(this.view,"pointer"):JG(this.view,s.pos,s.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||wl&&this.mightDrag&&!this.mightDrag.node.isAtom||il&&!this.view.state.selection.visible&&Math.min(Math.abs(s.pos-this.view.state.selection.from),Math.abs(s.pos-this.view.state.selection.to))<=2)?(wy(this.view,vi.near(this.view.state.doc.resolve(s.pos))),t.preventDefault()):Gp(this.view,"pointer")}move(t){this.updateAllowDefault(t),Gp(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}Sl.touchstart=n=>{n.input.lastTouch=Date.now(),GT(n),Gp(n,"pointer")};Sl.touchmove=n=>{n.input.lastTouch=Date.now(),Gp(n,"pointer")};Sl.contextmenu=n=>GT(n);function pO(n,t){return n.composing?!0:wl&&Math.abs(t.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const rq=bf?5e3:-1;Tl.compositionstart=Tl.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:t}=n,s=t.selection.$to;if(t.selection instanceof ti&&(t.storedMarks||!s.textOffset&&s.parentOffset&&s.nodeBefore.marks.some(l=>l.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||s.marks(),g0(n,!0),n.markCursor=null;else if(g0(n,!t.selection.empty),ph&&t.selection.empty&&s.parentOffset&&!s.textOffset&&s.nodeBefore.marks.length){let l=n.domSelectionRange();for(let h=l.focusNode,m=l.focusOffset;h&&h.nodeType==1&&m!=0;){let b=m<0?h.lastChild:h.childNodes[m-1];if(!b)break;if(b.nodeType==3){let i=n.domSelection();i&&i.collapse(b,b.nodeValue.length);break}else h=b,m=-1}}n.input.composing=!0}mO(n,rq)};Tl.compositionend=(n,t)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=t.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,mO(n,20))};function mO(n,t){clearTimeout(n.input.composingTimeout),t>-1&&(n.input.composingTimeout=setTimeout(()=>g0(n),t))}function gO(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=sq());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function iq(n){let t=n.domSelectionRange();if(!t.focusNode)return null;let s=KH(t.focusNode,t.focusOffset),l=YH(t.focusNode,t.focusOffset);if(s&&l&&s!=l){let h=l.pmViewDesc,m=n.domObserver.lastChangedTextNode;if(s==m||l==m)return m;if(!h||!h.isText(l.nodeValue))return l;if(n.input.compositionNode==l){let b=s.pmViewDesc;if(!(!b||!b.isText(s.nodeValue)))return l}}return s||l}function sq(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function g0(n,t=!1){if(!(bf&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),gO(n),t||n.docView&&n.docView.dirty){let s=BT(n),l=n.state.selection;return s&&!s.eq(l)?n.dispatch(n.state.tr.setSelection(s)):(n.markCursor||t)&&!l.$from.node(l.$from.sharedDepth(l.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function oq(n,t){if(!n.dom.parentNode)return;let s=n.dom.parentNode.appendChild(document.createElement("div"));s.appendChild(t),s.style.cssText="position: fixed; left: -10000px; top: 10px";let l=getSelection(),h=document.createRange();h.selectNodeContents(t),n.dom.blur(),l.removeAllRanges(),l.addRange(h),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s),n.focus()},50)}const ux=Yl&&Xp<15||Iy&&nG<604;Sl.copy=Tl.cut=(n,t)=>{let s=t,l=n.state.selection,h=s.type=="cut";if(l.empty)return;let m=ux?null:s.clipboardData,b=l.content(),{dom:i,text:A}=UT(n,b);m?(s.preventDefault(),m.clearData(),m.setData("text/html",i.innerHTML),m.setData("text/plain",A)):oq(n,i),h&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function aq(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function lq(n,t){if(!n.dom.parentNode)return;let s=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,l=n.dom.parentNode.appendChild(document.createElement(s?"textarea":"div"));s||(l.contentEditable="true"),l.style.cssText="position: fixed; left: -10000px; top: 10px",l.focus();let h=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),l.parentNode&&l.parentNode.removeChild(l),s?hx(n,l.value,null,h,t):hx(n,l.textContent,l.innerHTML,h,t)},50)}function hx(n,t,s,l,h){let m=aO(n,t,s,l,n.state.selection.$from);if(n.someProp("handlePaste",A=>A(n,h,m||Yn.empty)))return!0;if(!m)return!1;let b=aq(m),i=b?n.state.tr.replaceSelectionWith(b,l):n.state.tr.replaceSelection(m);return n.dispatch(i.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function yO(n){let t=n.getData("text/plain")||n.getData("Text");if(t)return t;let s=n.getData("text/uri-list");return s?s.replace(/\r?\n/g," "):""}Tl.paste=(n,t)=>{let s=t;if(n.composing&&!bf)return;let l=ux?null:s.clipboardData,h=n.input.shiftKey&&n.input.lastKeyCode!=45;l&&hx(n,yO(l),l.getData("text/html"),h,s)?s.preventDefault():lq(n,s)};class _O{constructor(t,s,l){this.slice=t,this.move=s,this.node=l}}const cq=pu?"altKey":"ctrlKey";function xO(n,t){let s=n.someProp("dragCopies",l=>!l(t));return s??!t[cq]}Sl.dragstart=(n,t)=>{let s=t,l=n.input.mouseDown;if(l&&l.done(),!s.dataTransfer)return;let h=n.state.selection,m=h.empty?null:n.posAtCoords(S1(s)),b;if(!(m&&m.pos>=h.from&&m.pos<=(h instanceof kr?h.to-1:h.to))){if(l&&l.mightDrag)b=kr.create(n.state.doc,l.mightDrag.pos);else if(s.target&&s.target.nodeType==1){let j=n.docView.nearestDesc(s.target,!0);j&&j.node.type.spec.draggable&&j!=n.docView&&(b=kr.create(n.state.doc,j.posBefore))}}let i=(b||n.state.selection).content(),{dom:A,text:P,slice:D}=UT(n,i);(!s.dataTransfer.files.length||!il||GD>120)&&s.dataTransfer.clearData(),s.dataTransfer.setData(ux?"Text":"text/html",A.innerHTML),s.dataTransfer.effectAllowed="copyMove",ux||s.dataTransfer.setData("text/plain",P),n.dragging=new _O(D,xO(n,s),b)};Sl.dragend=n=>{let t=n.dragging;window.setTimeout(()=>{n.dragging==t&&(n.dragging=null)},50)};Tl.dragover=Tl.dragenter=(n,t)=>t.preventDefault();Tl.drop=(n,t)=>{let s=t,l=n.dragging;if(n.dragging=null,!s.dataTransfer)return;let h=n.posAtCoords(S1(s));if(!h)return;let m=n.state.doc.resolve(h.pos),b=l&&l.slice;b?n.someProp("transformPasted",Y=>{b=Y(b,n)}):b=aO(n,yO(s.dataTransfer),ux?null:s.dataTransfer.getData("text/html"),!1,m);let i=!!(l&&xO(n,s));if(n.someProp("handleDrop",Y=>Y(n,s,b||Yn.empty,i))){s.preventDefault();return}if(!b)return;s.preventDefault();let A=b?LD(n.state.doc,m.pos,b):m.pos;A==null&&(A=m.pos);let P=n.state.tr;if(i){let{node:Y}=l;Y?Y.replace(P):P.deleteSelection()}let D=P.mapping.map(A),j=b.openStart==0&&b.openEnd==0&&b.content.childCount==1,U=P.doc;if(j?P.replaceRangeWith(D,D,b.content.firstChild):P.replaceRange(D,D,b),P.doc.eq(U))return;let X=P.doc.resolve(D);if(j&&kr.isSelectable(b.content.firstChild)&&X.nodeAfter&&X.nodeAfter.sameMarkup(b.content.firstChild))P.setSelection(new kr(X));else{let Y=P.mapping.map(A);P.mapping.maps[P.mapping.maps.length-1].forEach((W,re,de,Me)=>Y=Me),P.setSelection(VT(n,X,P.doc.resolve(Y)))}n.focus(),n.dispatch(P.setMeta("uiEvent","drop"))};Sl.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Tf(n)},20))};Sl.blur=(n,t)=>{let s=t;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),s.relatedTarget&&n.dom.contains(s.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};Sl.beforeinput=(n,t)=>{if(il&&bf&&t.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:l}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=l||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",m=>m(n,rg(8,"Backspace")))))return;let{$cursor:h}=n.state.selection;h&&h.pos>0&&n.dispatch(n.state.tr.delete(h.pos-1,h.pos).scrollIntoView())},50)}};for(let n in Tl)Sl[n]=Tl[n];function dx(n,t){if(n==t)return!0;for(let s in n)if(n[s]!==t[s])return!1;for(let s in t)if(!(s in n))return!1;return!0}class y0{constructor(t,s){this.toDOM=t,this.spec=s||dg,this.side=this.spec.side||0}map(t,s,l,h){let{pos:m,deleted:b}=t.mapResult(s.from+h,this.side<0?-1:1);return b?null:new bl(m-l,m-l,this)}valid(){return!0}eq(t){return this==t||t instanceof y0&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&dx(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class Yp{constructor(t,s){this.attrs=t,this.spec=s||dg}map(t,s,l,h){let m=t.map(s.from+h,this.spec.inclusiveStart?-1:1)-l,b=t.map(s.to+h,this.spec.inclusiveEnd?1:-1)-l;return m>=b?null:new bl(m,b,this)}valid(t,s){return s.from<s.to}eq(t){return this==t||t instanceof Yp&&dx(this.attrs,t.attrs)&&dx(this.spec,t.spec)}static is(t){return t.type instanceof Yp}destroy(){}}class qT{constructor(t,s){this.attrs=t,this.spec=s||dg}map(t,s,l,h){let m=t.mapResult(s.from+h,1);if(m.deleted)return null;let b=t.mapResult(s.to+h,-1);return b.deleted||b.pos<=m.pos?null:new bl(m.pos-l,b.pos-l,this)}valid(t,s){let{index:l,offset:h}=t.content.findIndex(s.from),m;return h==s.from&&!(m=t.child(l)).isText&&h+m.nodeSize==s.to}eq(t){return this==t||t instanceof qT&&dx(this.attrs,t.attrs)&&dx(this.spec,t.spec)}destroy(){}}class bl{constructor(t,s,l){this.from=t,this.to=s,this.type=l}copy(t,s){return new bl(t,s,this.type)}eq(t,s=0){return this.type.eq(t.type)&&this.from+s==t.from&&this.to+s==t.to}map(t,s,l){return this.type.map(t,this,s,l)}static widget(t,s,l){return new bl(t,t,new y0(s,l))}static inline(t,s,l,h){return new bl(t,s,new Yp(l,h))}static node(t,s,l,h){return new bl(t,s,new qT(l,h))}get spec(){return this.type.spec}get inline(){return this.type instanceof Yp}get widget(){return this.type instanceof y0}}const fy=[],dg={};class eo{constructor(t,s){this.local=t.length?t:fy,this.children=s.length?s:fy}static create(t,s){return s.length?_0(s,t,0,dg):nl}find(t,s,l){let h=[];return this.findInner(t??0,s??1e9,h,0,l),h}findInner(t,s,l,h,m){for(let b=0;b<this.local.length;b++){let i=this.local[b];i.from<=s&&i.to>=t&&(!m||m(i.spec))&&l.push(i.copy(i.from+h,i.to+h))}for(let b=0;b<this.children.length;b+=3)if(this.children[b]<s&&this.children[b+1]>t){let i=this.children[b]+1;this.children[b+2].findInner(t-i,s-i,l,h+i,m)}}map(t,s,l){return this==nl||t.maps.length==0?this:this.mapInner(t,s,0,0,l||dg)}mapInner(t,s,l,h,m){let b;for(let i=0;i<this.local.length;i++){let A=this.local[i].map(t,l,h);A&&A.type.valid(s,A)?(b||(b=[])).push(A):m.onRemove&&m.onRemove(this.local[i].spec)}return this.children.length?uq(this.children,b||[],t,s,l,h,m):b?new eo(b.sort(fg),fy):nl}add(t,s){return s.length?this==nl?eo.create(t,s):this.addInner(t,s,0):this}addInner(t,s,l){let h,m=0;t.forEach((i,A)=>{let P=A+l,D;if(D=bO(s,i,P)){for(h||(h=this.children.slice());m<h.length&&h[m]<A;)m+=3;h[m]==A?h[m+2]=h[m+2].addInner(i,D,P+1):h.splice(m,0,A,A+i.nodeSize,_0(D,i,P+1,dg)),m+=3}});let b=vO(m?wO(s):s,-l);for(let i=0;i<b.length;i++)b[i].type.valid(t,b[i])||b.splice(i--,1);return new eo(b.length?this.local.concat(b).sort(fg):this.local,h||this.children)}remove(t){return t.length==0||this==nl?this:this.removeInner(t,0)}removeInner(t,s){let l=this.children,h=this.local;for(let m=0;m<l.length;m+=3){let b,i=l[m]+s,A=l[m+1]+s;for(let D=0,j;D<t.length;D++)(j=t[D])&&j.from>i&&j.to<A&&(t[D]=null,(b||(b=[])).push(j));if(!b)continue;l==this.children&&(l=this.children.slice());let P=l[m+2].removeInner(b,i+1);P!=nl?l[m+2]=P:(l.splice(m,3),m-=3)}if(h.length){for(let m=0,b;m<t.length;m++)if(b=t[m])for(let i=0;i<h.length;i++)h[i].eq(b,s)&&(h==this.local&&(h=this.local.slice()),h.splice(i--,1))}return l==this.children&&h==this.local?this:h.length||l.length?new eo(h,l):nl}forChild(t,s){if(this==nl)return this;if(s.isLeaf)return eo.empty;let l,h;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=t){this.children[i]==t&&(l=this.children[i+2]);break}let m=t+1,b=m+s.content.size;for(let i=0;i<this.local.length;i++){let A=this.local[i];if(A.from<b&&A.to>m&&A.type instanceof Yp){let P=Math.max(m,A.from)-m,D=Math.min(b,A.to)-m;P<D&&(h||(h=[])).push(A.copy(P,D))}}if(h){let i=new eo(h.sort(fg),fy);return l?new Bp([i,l]):i}return l||nl}eq(t){if(this==t)return!0;if(!(t instanceof eo)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let s=0;s<this.local.length;s++)if(!this.local[s].eq(t.local[s]))return!1;for(let s=0;s<this.children.length;s+=3)if(this.children[s]!=t.children[s]||this.children[s+1]!=t.children[s+1]||!this.children[s+2].eq(t.children[s+2]))return!1;return!0}locals(t){return WT(this.localsInner(t))}localsInner(t){if(this==nl)return fy;if(t.inlineContent||!this.local.some(Yp.is))return this.local;let s=[];for(let l=0;l<this.local.length;l++)this.local[l].type instanceof Yp||s.push(this.local[l]);return s}forEachSet(t){t(this)}}eo.empty=new eo([],[]);eo.removeOverlap=WT;const nl=eo.empty;class Bp{constructor(t){this.members=t}map(t,s){const l=this.members.map(h=>h.map(t,s,dg));return Bp.from(l)}forChild(t,s){if(s.isLeaf)return eo.empty;let l=[];for(let h=0;h<this.members.length;h++){let m=this.members[h].forChild(t,s);m!=nl&&(m instanceof Bp?l=l.concat(m.members):l.push(m))}return Bp.from(l)}eq(t){if(!(t instanceof Bp)||t.members.length!=this.members.length)return!1;for(let s=0;s<this.members.length;s++)if(!this.members[s].eq(t.members[s]))return!1;return!0}locals(t){let s,l=!0;for(let h=0;h<this.members.length;h++){let m=this.members[h].localsInner(t);if(m.length)if(!s)s=m;else{l&&(s=s.slice(),l=!1);for(let b=0;b<m.length;b++)s.push(m[b])}}return s?WT(l?s:s.sort(fg)):fy}static from(t){switch(t.length){case 0:return nl;case 1:return t[0];default:return new Bp(t.every(s=>s instanceof eo)?t:t.reduce((s,l)=>s.concat(l instanceof eo?l:l.members),[]))}}forEachSet(t){for(let s=0;s<this.members.length;s++)this.members[s].forEachSet(t)}}function uq(n,t,s,l,h,m,b){let i=n.slice();for(let P=0,D=m;P<s.maps.length;P++){let j=0;s.maps[P].forEach((U,X,Y,W)=>{let re=W-Y-(X-U);for(let de=0;de<i.length;de+=3){let Me=i[de+1];if(Me<0||U>Me+D-j)continue;let Fe=i[de]+D-j;X>=Fe?i[de+1]=U<=Fe?-2:-1:U>=D&&re&&(i[de]+=re,i[de+1]+=re)}j+=re}),D=s.maps[P].map(D,-1)}let A=!1;for(let P=0;P<i.length;P+=3)if(i[P+1]<0){if(i[P+1]==-2){A=!0,i[P+1]=-1;continue}let D=s.map(n[P]+m),j=D-h;if(j<0||j>=l.content.size){A=!0;continue}let U=s.map(n[P+1]+m,-1),X=U-h,{index:Y,offset:W}=l.content.findIndex(j),re=l.maybeChild(Y);if(re&&W==j&&W+re.nodeSize==X){let de=i[P+2].mapInner(s,re,D+1,n[P]+m+1,b);de!=nl?(i[P]=j,i[P+1]=X,i[P+2]=de):(i[P+1]=-2,A=!0)}else A=!0}if(A){let P=hq(i,n,t,s,h,m,b),D=_0(P,l,0,b);t=D.local;for(let j=0;j<i.length;j+=3)i[j+1]<0&&(i.splice(j,3),j-=3);for(let j=0,U=0;j<D.children.length;j+=3){let X=D.children[j];for(;U<i.length&&i[U]<X;)U+=3;i.splice(U,0,D.children[j],D.children[j+1],D.children[j+2])}}return new eo(t.sort(fg),i)}function vO(n,t){if(!t||!n.length)return n;let s=[];for(let l=0;l<n.length;l++){let h=n[l];s.push(new bl(h.from+t,h.to+t,h.type))}return s}function hq(n,t,s,l,h,m,b){function i(A,P){for(let D=0;D<A.local.length;D++){let j=A.local[D].map(l,h,P);j?s.push(j):b.onRemove&&b.onRemove(A.local[D].spec)}for(let D=0;D<A.children.length;D+=3)i(A.children[D+2],A.children[D]+P+1)}for(let A=0;A<n.length;A+=3)n[A+1]==-1&&i(n[A+2],t[A]+m+1);return s}function bO(n,t,s){if(t.isLeaf)return null;let l=s+t.nodeSize,h=null;for(let m=0,b;m<n.length;m++)(b=n[m])&&b.from>s&&b.to<l&&((h||(h=[])).push(b),n[m]=null);return h}function wO(n){let t=[];for(let s=0;s<n.length;s++)n[s]!=null&&t.push(n[s]);return t}function _0(n,t,s,l){let h=[],m=!1;t.forEach((i,A)=>{let P=bO(n,i,A+s);if(P){m=!0;let D=_0(P,i,s+A+1,l);D!=nl&&h.push(A,A+i.nodeSize,D)}});let b=vO(m?wO(n):n,-s).sort(fg);for(let i=0;i<b.length;i++)b[i].type.valid(t,b[i])||(l.onRemove&&l.onRemove(b[i].spec),b.splice(i--,1));return b.length||h.length?new eo(b,h):nl}function fg(n,t){return n.from-t.from||n.to-t.to}function WT(n){let t=n;for(let s=0;s<t.length-1;s++){let l=t[s];if(l.from!=l.to)for(let h=s+1;h<t.length;h++){let m=t[h];if(m.from==l.from){m.to!=l.to&&(t==n&&(t=n.slice()),t[h]=m.copy(m.from,l.to),qM(t,h+1,m.copy(l.to,m.to)));continue}else{m.from<l.to&&(t==n&&(t=n.slice()),t[s]=l.copy(l.from,m.from),qM(t,h,l.copy(m.from,l.to)));break}}}return t}function qM(n,t,s){for(;t<n.length&&fg(s,n[t])>0;)t++;n.splice(t,0,s)}function Tw(n){let t=[];return n.someProp("decorations",s=>{let l=s(n.state);l&&l!=nl&&t.push(l)}),n.cursorWrapper&&t.push(eo.create(n.state.doc,[n.cursorWrapper.deco])),Bp.from(t)}const dq={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},fq=Yl&&Xp<=11;class pq{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class mq{constructor(t,s){this.view=t,this.handleDOMChange=s,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new pq,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(l=>{for(let h=0;h<l.length;h++)this.queue.push(l[h]);Yl&&Xp<=11&&l.some(h=>h.type=="childList"&&h.removedNodes.length||h.type=="characterData"&&h.oldValue.length>h.target.nodeValue.length)?this.flushSoon():this.flush()}),fq&&(this.onCharData=l=>{this.queue.push({target:l.target,type:"characterData",oldValue:l.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,dq)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let s=0;s<t.length;s++)this.queue.push(t[s]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(jM(this.view)){if(this.suppressingSelectionUpdates)return Tf(this.view);if(Yl&&Xp<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&wg(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let s=new Set,l;for(let m=t.focusNode;m;m=Ay(m))s.add(m);for(let m=t.anchorNode;m;m=Ay(m))if(s.has(m)){l=m;break}let h=l&&this.view.docView.nearestDesc(l);if(h&&h.ignoreMutation({type:"selection",target:l.nodeType==3?l.parentNode:l}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let s=this.pendingRecords();s.length&&(this.queue=[]);let l=t.domSelectionRange(),h=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(l)&&jM(t)&&!this.ignoreSelectionChange(l),m=-1,b=-1,i=!1,A=[];if(t.editable)for(let D=0;D<s.length;D++){let j=this.registerMutation(s[D],A);j&&(m=m<0?j.from:Math.min(j.from,m),b=b<0?j.to:Math.max(j.to,b),j.typeOver&&(i=!0))}if(ph&&A.length){let D=A.filter(j=>j.nodeName=="BR");if(D.length==2){let[j,U]=D;j.parentNode&&j.parentNode.parentNode==U.parentNode?U.remove():j.remove()}else{let{focusNode:j}=this.currentSelection;for(let U of D){let X=U.parentNode;X&&X.nodeName=="LI"&&(!j||_q(t,j)!=X)&&U.remove()}}}let P=null;m<0&&h&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&b1(l)&&(P=BT(t))&&P.eq(vi.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Tf(t),this.currentSelection.set(l),t.scrollToSelection()):(m>-1||h)&&(m>-1&&(t.docView.markDirty(m,b),gq(t)),this.handleDOMChange(m,b,i,A),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(l)||Tf(t),this.currentSelection.set(l))}registerMutation(t,s){if(s.indexOf(t.target)>-1)return null;let l=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(l==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!l||l.ignoreMutation(t))return null;if(t.type=="childList"){for(let D=0;D<t.addedNodes.length;D++){let j=t.addedNodes[D];s.push(j),j.nodeType==3&&(this.lastChangedTextNode=j)}if(l.contentDOM&&l.contentDOM!=l.dom&&!l.contentDOM.contains(t.target))return{from:l.posBefore,to:l.posAfter};let h=t.previousSibling,m=t.nextSibling;if(Yl&&Xp<=11&&t.addedNodes.length)for(let D=0;D<t.addedNodes.length;D++){let{previousSibling:j,nextSibling:U}=t.addedNodes[D];(!j||Array.prototype.indexOf.call(t.addedNodes,j)<0)&&(h=j),(!U||Array.prototype.indexOf.call(t.addedNodes,U)<0)&&(m=U)}let b=h&&h.parentNode==t.target?za(h)+1:0,i=l.localPosFromDOM(t.target,b,-1),A=m&&m.parentNode==t.target?za(m):t.target.childNodes.length,P=l.localPosFromDOM(t.target,A,1);return{from:i,to:P}}else return t.type=="attributes"?{from:l.posAtStart-l.border,to:l.posAtEnd+l.border}:(this.lastChangedTextNode=t.target,{from:l.posAtStart,to:l.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let WM=new WeakMap,ZM=!1;function gq(n){if(!WM.has(n)&&(WM.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=ph,ZM)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),ZM=!0}}function XM(n,t){let s=t.startContainer,l=t.startOffset,h=t.endContainer,m=t.endOffset,b=n.domAtPos(n.state.selection.anchor);return wg(b.node,b.offset,h,m)&&([s,l,h,m]=[h,m,s,l]),{anchorNode:s,anchorOffset:l,focusNode:h,focusOffset:m}}function yq(n,t){if(t.getComposedRanges){let h=t.getComposedRanges(n.root)[0];if(h)return XM(n,h)}let s;function l(h){h.preventDefault(),h.stopImmediatePropagation(),s=h.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",l,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",l,!0),s?XM(n,s):null}function _q(n,t){for(let s=t.parentNode;s&&s!=n.dom;s=s.parentNode){let l=n.docView.nearestDesc(s,!0);if(l&&l.node.isBlock)return s}return null}function xq(n,t,s){let{node:l,fromOffset:h,toOffset:m,from:b,to:i}=n.docView.parseRange(t,s),A=n.domSelectionRange(),P,D=A.anchorNode;if(D&&n.dom.contains(D.nodeType==1?D:D.parentNode)&&(P=[{node:D,offset:A.anchorOffset}],b1(A)||P.push({node:A.focusNode,offset:A.focusOffset})),il&&n.input.lastKeyCode===8)for(let re=m;re>h;re--){let de=l.childNodes[re-1],Me=de.pmViewDesc;if(de.nodeName=="BR"&&!Me){m=re;break}if(!Me||Me.size)break}let j=n.state.doc,U=n.someProp("domParser")||Zp.fromSchema(n.state.schema),X=j.resolve(b),Y=null,W=U.parse(l,{topNode:X.parent,topMatch:X.parent.contentMatchAt(X.index()),topOpen:!0,from:h,to:m,preserveWhitespace:X.parent.type.whitespace=="pre"?"full":!0,findPositions:P,ruleFromNode:vq,context:X});if(P&&P[0].pos!=null){let re=P[0].pos,de=P[1]&&P[1].pos;de==null&&(de=re),Y={anchor:re+b,head:de+b}}return{doc:W,sel:Y,from:b,to:i}}function vq(n){let t=n.pmViewDesc;if(t)return t.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(wl&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let s=document.createElement("div");return s.appendChild(document.createElement("li")),{skip:s}}else if(n.parentNode.lastChild==n||wl&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const bq=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function wq(n,t,s,l,h){let m=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,t<0){let Rt=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,fn=BT(n,Rt);if(fn&&!n.state.selection.eq(fn)){if(il&&bf&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",xn=>xn(n,rg(13,"Enter"))))return;let En=n.state.tr.setSelection(fn);Rt=="pointer"?En.setMeta("pointer",!0):Rt=="key"&&En.scrollIntoView(),m&&En.setMeta("composition",m),n.dispatch(En)}return}let b=n.state.doc.resolve(t),i=b.sharedDepth(s);t=b.before(i+1),s=n.state.doc.resolve(s).after(i+1);let A=n.state.selection,P=xq(n,t,s),D=n.state.doc,j=D.slice(P.from,P.to),U,X;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(U=n.state.selection.to,X="end"):(U=n.state.selection.from,X="start"),n.input.lastKeyCode=null;let Y=Eq(j.content,P.doc.content,P.from,U,X);if(Y&&n.input.domChangeCount++,(Iy&&n.input.lastIOSEnter>Date.now()-225||bf)&&h.some(Rt=>Rt.nodeType==1&&!bq.test(Rt.nodeName))&&(!Y||Y.endA>=Y.endB)&&n.someProp("handleKeyDown",Rt=>Rt(n,rg(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!Y)if(l&&A instanceof ti&&!A.empty&&A.$head.sameParent(A.$anchor)&&!n.composing&&!(P.sel&&P.sel.anchor!=P.sel.head))Y={start:A.from,endA:A.to,endB:A.to};else{if(P.sel){let Rt=KM(n,n.state.doc,P.sel);if(Rt&&!Rt.eq(n.state.selection)){let fn=n.state.tr.setSelection(Rt);m&&fn.setMeta("composition",m),n.dispatch(fn)}}return}n.state.selection.from<n.state.selection.to&&Y.start==Y.endB&&n.state.selection instanceof ti&&(Y.start>n.state.selection.from&&Y.start<=n.state.selection.from+2&&n.state.selection.from>=P.from?Y.start=n.state.selection.from:Y.endA<n.state.selection.to&&Y.endA>=n.state.selection.to-2&&n.state.selection.to<=P.to&&(Y.endB+=n.state.selection.to-Y.endA,Y.endA=n.state.selection.to)),Yl&&Xp<=11&&Y.endB==Y.start+1&&Y.endA==Y.start&&Y.start>P.from&&P.doc.textBetween(Y.start-P.from-1,Y.start-P.from+1)==" "&&(Y.start--,Y.endA--,Y.endB--);let W=P.doc.resolveNoCache(Y.start-P.from),re=P.doc.resolveNoCache(Y.endB-P.from),de=D.resolve(Y.start),Me=W.sameParent(re)&&W.parent.inlineContent&&de.end()>=Y.endA,Fe;if((Iy&&n.input.lastIOSEnter>Date.now()-225&&(!Me||h.some(Rt=>Rt.nodeName=="DIV"||Rt.nodeName=="P"))||!Me&&W.pos<P.doc.content.size&&(!W.sameParent(re)||!W.parent.inlineContent)&&!/\S/.test(P.doc.textBetween(W.pos,re.pos,"",""))&&(Fe=vi.findFrom(P.doc.resolve(W.pos+1),1,!0))&&Fe.head>W.pos)&&n.someProp("handleKeyDown",Rt=>Rt(n,rg(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>Y.start&&Tq(D,Y.start,Y.endA,W,re)&&n.someProp("handleKeyDown",Rt=>Rt(n,rg(8,"Backspace")))){bf&&il&&n.domObserver.suppressSelectionUpdates();return}il&&Y.endB==Y.start&&(n.input.lastChromeDelete=Date.now()),bf&&!Me&&W.start()!=re.start()&&re.parentOffset==0&&W.depth==re.depth&&P.sel&&P.sel.anchor==P.sel.head&&P.sel.head==Y.endA&&(Y.endB-=2,re=P.doc.resolveNoCache(Y.endB-P.from),setTimeout(()=>{n.someProp("handleKeyDown",function(Rt){return Rt(n,rg(13,"Enter"))})},20));let ht=Y.start,at=Y.endA,Dt=Rt=>{let fn=Rt||n.state.tr.replace(ht,at,P.doc.slice(Y.start-P.from,Y.endB-P.from));if(P.sel){let En=KM(n,fn.doc,P.sel);En&&!(il&&n.composing&&En.empty&&(Y.start!=Y.endB||n.input.lastChromeDelete<Date.now()-100)&&(En.head==ht||En.head==fn.mapping.map(at)-1)||Yl&&En.empty&&En.head==ht)&&fn.setSelection(En)}return m&&fn.setMeta("composition",m),fn.scrollIntoView()},kt;if(Me){if(W.pos==re.pos){Yl&&Xp<=11&&W.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>Tf(n),20));let Rt=Dt(n.state.tr.delete(ht,at)),fn=D.resolve(Y.start).marksAcross(D.resolve(Y.endA));fn&&Rt.ensureMarks(fn),n.dispatch(Rt)}else if(Y.endA==Y.endB&&(kt=Sq(W.parent.content.cut(W.parentOffset,re.parentOffset),de.parent.content.cut(de.parentOffset,Y.endA-de.start())))){let Rt=Dt(n.state.tr);kt.type=="add"?Rt.addMark(ht,at,kt.mark):Rt.removeMark(ht,at,kt.mark),n.dispatch(Rt)}else if(W.parent.child(W.index()).isText&&W.index()==re.index()-(re.textOffset?0:1)){let Rt=W.parent.textBetween(W.parentOffset,re.parentOffset),fn=()=>Dt(n.state.tr.insertText(Rt,ht,at));n.someProp("handleTextInput",En=>En(n,ht,at,Rt,fn))||n.dispatch(fn())}}else n.dispatch(Dt())}function KM(n,t,s){return Math.max(s.anchor,s.head)>t.content.size?null:VT(n,t.resolve(s.anchor),t.resolve(s.head))}function Sq(n,t){let s=n.firstChild.marks,l=t.firstChild.marks,h=s,m=l,b,i,A;for(let D=0;D<l.length;D++)h=l[D].removeFromSet(h);for(let D=0;D<s.length;D++)m=s[D].removeFromSet(m);if(h.length==1&&m.length==0)i=h[0],b="add",A=D=>D.mark(i.addToSet(D.marks));else if(h.length==0&&m.length==1)i=m[0],b="remove",A=D=>D.mark(i.removeFromSet(D.marks));else return null;let P=[];for(let D=0;D<t.childCount;D++)P.push(A(t.child(D)));if(pn.from(P).eq(n))return{mark:i,type:b}}function Tq(n,t,s,l,h){if(s-t<=h.pos-l.pos||Ew(l,!0,!1)<h.pos)return!1;let m=n.resolve(t);if(!l.parent.isTextblock){let i=m.nodeAfter;return i!=null&&s==t+i.nodeSize}if(m.parentOffset<m.parent.content.size||!m.parent.isTextblock)return!1;let b=n.resolve(Ew(m,!0,!0));return!b.parent.isTextblock||b.pos>s||Ew(b,!0,!1)<s?!1:l.parent.content.cut(l.parentOffset).eq(b.parent.content)}function Ew(n,t,s){let l=n.depth,h=t?n.end():n.pos;for(;l>0&&(t||n.indexAfter(l)==n.node(l).childCount);)l--,h++,t=!1;if(s){let m=n.node(l).maybeChild(n.indexAfter(l));for(;m&&!m.isLeaf;)m=m.firstChild,h++}return h}function Eq(n,t,s,l,h){let m=n.findDiffStart(t,s);if(m==null)return null;let{a:b,b:i}=n.findDiffEnd(t,s+n.size,s+t.size);if(h=="end"){let A=Math.max(0,m-Math.min(b,i));l-=b+A-m}if(b<m&&n.size<t.size){let A=l<=m&&l>=b?m-l:0;m-=A,m&&m<t.size&&YM(t.textBetween(m-1,m+1))&&(m+=A?1:-1),i=m+(i-b),b=m}else if(i<m){let A=l<=m&&l>=i?m-l:0;m-=A,m&&m<n.size&&YM(n.textBetween(m-1,m+1))&&(m+=A?1:-1),b=m+(b-i),i=m}return{start:m,endA:b,endB:i}}function YM(n){if(n.length!=2)return!1;let t=n.charCodeAt(0),s=n.charCodeAt(1);return t>=56320&&t<=57343&&s>=55296&&s<=56319}class SO{constructor(t,s){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new HG,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=s,this.state=s.state,this.directPlugins=s.plugins||[],this.directPlugins.forEach(nk),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=ek(this),QM(this),this.nodeViews=tk(this),this.docView=RM(this.state.doc,JM(this),Tw(this),this.dom,this),this.domObserver=new mq(this,(l,h,m,b)=>wq(this,l,h,m,b)),this.domObserver.start(),GG(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let s in t)this._props[s]=t[s];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&OS(this);let s=this._props;this._props=t,t.plugins&&(t.plugins.forEach(nk),this.directPlugins=t.plugins),this.updateStateInner(t.state,s)}setProps(t){let s={};for(let l in this._props)s[l]=this._props[l];s.state=this.state;for(let l in t)s[l]=t[l];this.update(s)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,s){var l;let h=this.state,m=!1,b=!1;t.storedMarks&&this.composing&&(gO(this),b=!0),this.state=t;let i=h.plugins!=t.plugins||this._props.plugins!=s.plugins;if(i||this._props.plugins!=s.plugins||this._props.nodeViews!=s.nodeViews){let X=tk(this);Aq(X,this.nodeViews)&&(this.nodeViews=X,m=!0)}(i||s.handleDOMEvents!=this._props.handleDOMEvents)&&OS(this),this.editable=ek(this),QM(this);let A=Tw(this),P=JM(this),D=h.plugins!=t.plugins&&!h.doc.eq(t.doc)?"reset":t.scrollToSelection>h.scrollToSelection?"to selection":"preserve",j=m||!this.docView.matchesNode(t.doc,P,A);(j||!t.selection.eq(h.selection))&&(b=!0);let U=D=="preserve"&&b&&this.dom.style.overflowAnchor==null&&sG(this);if(b){this.domObserver.stop();let X=j&&(Yl||il)&&!this.composing&&!h.selection.empty&&!t.selection.empty&&Cq(h.selection,t.selection);if(j){let Y=il?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=iq(this)),(m||!this.docView.update(t.doc,P,A,this))&&(this.docView.updateOuterDeco(P),this.docView.destroy(),this.docView=RM(t.doc,P,A,this.dom,this)),Y&&!this.trackWrites&&(X=!0)}X||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&MG(this))?Tf(this,X):(iO(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(h),!((l=this.dragging)===null||l===void 0)&&l.node&&!h.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,h),D=="reset"?this.dom.scrollTop=0:D=="to selection"?this.scrollToSelection():U&&oG(U)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",s=>s(this)))if(this.state.selection instanceof kr){let s=this.docView.domAfterPos(this.state.selection.from);s.nodeType==1&&CM(this,s.getBoundingClientRect(),t)}else CM(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let s=0;s<this.directPlugins.length;s++){let l=this.directPlugins[s];l.spec.view&&this.pluginViews.push(l.spec.view(this))}for(let s=0;s<this.state.plugins.length;s++){let l=this.state.plugins[s];l.spec.view&&this.pluginViews.push(l.spec.view(this))}}else for(let s=0;s<this.pluginViews.length;s++){let l=this.pluginViews[s];l.update&&l.update(this,t)}}updateDraggedNode(t,s){let l=t.node,h=-1;if(this.state.doc.nodeAt(l.from)==l.node)h=l.from;else{let m=l.from+(this.state.doc.content.size-s.doc.content.size);(m>0&&this.state.doc.nodeAt(m))==l.node&&(h=m)}this.dragging=new _O(t.slice,t.move,h<0?void 0:kr.create(this.state.doc,h))}someProp(t,s){let l=this._props&&this._props[t],h;if(l!=null&&(h=s?s(l):l))return h;for(let b=0;b<this.directPlugins.length;b++){let i=this.directPlugins[b].props[t];if(i!=null&&(h=s?s(i):i))return h}let m=this.state.plugins;if(m)for(let b=0;b<m.length;b++){let i=m[b].props[t];if(i!=null&&(h=s?s(i):i))return h}}hasFocus(){if(Yl){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&aG(this.dom),Tf(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let s=this.dom.parentNode;s;s=s.parentNode)if(s.nodeType==9||s.nodeType==11&&s.host)return s.getSelection||(Object.getPrototypeOf(s).getSelection=()=>s.ownerDocument.getSelection()),this._root=s}return t||document}updateRoot(){this._root=null}posAtCoords(t){return dG(this,t)}coordsAtPos(t,s=1){return KD(this,t,s)}domAtPos(t,s=0){return this.docView.domFromPos(t,s)}nodeDOM(t){let s=this.docView.descAt(t);return s?s.nodeDOM:null}posAtDOM(t,s,l=-1){let h=this.docView.posFromDOM(t,s,l);if(h==null)throw new RangeError("DOM position not inside the editor");return h}endOfTextblock(t,s){return yG(this,s||this.state,t)}pasteHTML(t,s){return hx(this,"",t,!1,s||new ClipboardEvent("paste"))}pasteText(t,s){return hx(this,t,null,!0,s||new ClipboardEvent("paste"))}serializeForClipboard(t){return UT(this,t)}destroy(){this.docView&&(qG(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Tw(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,ZH())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return ZG(this,t)}domSelectionRange(){let t=this.domSelection();return t?wl&&this.root.nodeType===11&&QH(this.dom.ownerDocument)==this.dom&&yq(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}SO.prototype.dispatch=function(n){let t=this._props.dispatchTransaction;t?t.call(this,n):this.updateState(this.state.apply(n))};function JM(n){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),n.someProp("attributes",s=>{if(typeof s=="function"&&(s=s(n.state)),s)for(let l in s)l=="class"?t.class+=" "+s[l]:l=="style"?t.style=(t.style?t.style+";":"")+s[l]:!t[l]&&l!="contenteditable"&&l!="nodeName"&&(t[l]=String(s[l]))}),t.translate||(t.translate="no"),[bl.node(0,n.state.doc.content.size,t)]}function QM(n){if(n.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),n.cursorWrapper={dom:t,deco:bl.widget(n.state.selection.from,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function ek(n){return!n.someProp("editable",t=>t(n.state)===!1)}function Cq(n,t){let s=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(s)!=t.$anchor.start(s)}function tk(n){let t=Object.create(null);function s(l){for(let h in l)Object.prototype.hasOwnProperty.call(t,h)||(t[h]=l[h])}return n.someProp("nodeViews",s),n.someProp("markViews",s),t}function Aq(n,t){let s=0,l=0;for(let h in n){if(n[h]!=t[h])return!0;s++}for(let h in t)l++;return s!=l}function nk(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var im={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},x0={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Iq=typeof navigator<"u"&&/Mac/.test(navigator.platform),Mq=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var ja=0;ja<10;ja++)im[48+ja]=im[96+ja]=String(ja);for(var ja=1;ja<=24;ja++)im[ja+111]="F"+ja;for(var ja=65;ja<=90;ja++)im[ja]=String.fromCharCode(ja+32),x0[ja]=String.fromCharCode(ja);for(var Cw in im)x0.hasOwnProperty(Cw)||(x0[Cw]=im[Cw]);function kq(n){var t=Iq&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||Mq&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",s=!t&&n.key||(n.shiftKey?x0:im)[n.keyCode]||n.key||"Unidentified";return s=="Esc"&&(s="Escape"),s=="Del"&&(s="Delete"),s=="Left"&&(s="ArrowLeft"),s=="Up"&&(s="ArrowUp"),s=="Right"&&(s="ArrowRight"),s=="Down"&&(s="ArrowDown"),s}const Pq=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Rq=typeof navigator<"u"&&/Win/.test(navigator.platform);function Nq(n){let t=n.split(/-(?!$)/),s=t[t.length-1];s=="Space"&&(s=" ");let l,h,m,b;for(let i=0;i<t.length-1;i++){let A=t[i];if(/^(cmd|meta|m)$/i.test(A))b=!0;else if(/^a(lt)?$/i.test(A))l=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else if(/^mod$/i.test(A))Pq?b=!0:h=!0;else throw new Error("Unrecognized modifier name: "+A)}return l&&(s="Alt-"+s),h&&(s="Ctrl-"+s),b&&(s="Meta-"+s),m&&(s="Shift-"+s),s}function Dq(n){let t=Object.create(null);for(let s in n)t[Nq(s)]=n[s];return t}function Aw(n,t,s=!0){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),s&&t.shiftKey&&(n="Shift-"+n),n}function Oq(n){return new po({props:{handleKeyDown:TO(n)}})}function TO(n){let t=Dq(n);return function(s,l){let h=kq(l),m,b=t[Aw(h,l)];if(b&&b(s.state,s.dispatch,s))return!0;if(h.length==1&&h!=" "){if(l.shiftKey){let i=t[Aw(h,l,!1)];if(i&&i(s.state,s.dispatch,s))return!0}if((l.altKey||l.metaKey||l.ctrlKey)&&!(Rq&&l.ctrlKey&&l.altKey)&&(m=im[l.keyCode])&&m!=h){let i=t[Aw(m,l)];if(i&&i(s.state,s.dispatch,s))return!0}}return!1}}const ZT=(n,t)=>n.selection.empty?!1:(t&&t(n.tr.deleteSelection().scrollIntoView()),!0);function EO(n,t){let{$cursor:s}=n.selection;return!s||(t?!t.endOfTextblock("backward",n):s.parentOffset>0)?null:s}const CO=(n,t,s)=>{let l=EO(n,s);if(!l)return!1;let h=XT(l);if(!h){let b=l.blockRange(),i=b&&Hy(b);return i==null?!1:(t&&t(n.tr.lift(b,i).scrollIntoView()),!0)}let m=h.nodeBefore;if(OO(n,h,t,-1))return!0;if(l.parent.content.size==0&&(My(m,"end")||kr.isSelectable(m)))for(let b=l.depth;;b--){let i=x1(n.doc,l.before(b),l.after(b),Yn.empty);if(i&&i.slice.size<i.to-i.from){if(t){let A=n.tr.step(i);A.setSelection(My(m,"end")?vi.findFrom(A.doc.resolve(A.mapping.map(h.pos,-1)),-1):kr.create(A.doc,h.pos-m.nodeSize)),t(A.scrollIntoView())}return!0}if(b==1||l.node(b-1).childCount>1)break}return m.isAtom&&h.depth==l.depth-1?(t&&t(n.tr.delete(h.pos-m.nodeSize,h.pos).scrollIntoView()),!0):!1},Lq=(n,t,s)=>{let l=EO(n,s);if(!l)return!1;let h=XT(l);return h?AO(n,h,t):!1},zq=(n,t,s)=>{let l=MO(n,s);if(!l)return!1;let h=KT(l);return h?AO(n,h,t):!1};function AO(n,t,s){let l=t.nodeBefore,h=l,m=t.pos-1;for(;!h.isTextblock;m--){if(h.type.spec.isolating)return!1;let D=h.lastChild;if(!D)return!1;h=D}let b=t.nodeAfter,i=b,A=t.pos+1;for(;!i.isTextblock;A++){if(i.type.spec.isolating)return!1;let D=i.firstChild;if(!D)return!1;i=D}let P=x1(n.doc,m,A,Yn.empty);if(!P||P.from!=m||P instanceof ya&&P.slice.size>=A-m)return!1;if(s){let D=n.tr.step(P);D.setSelection(ti.create(D.doc,m)),s(D.scrollIntoView())}return!0}function My(n,t,s=!1){for(let l=n;l;l=t=="start"?l.firstChild:l.lastChild){if(l.isTextblock)return!0;if(s&&l.childCount!=1)return!1}return!1}const IO=(n,t,s)=>{let{$head:l,empty:h}=n.selection,m=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("backward",n):l.parentOffset>0)return!1;m=XT(l)}let b=m&&m.nodeBefore;return!b||!kr.isSelectable(b)?!1:(t&&t(n.tr.setSelection(kr.create(n.doc,m.pos-b.nodeSize)).scrollIntoView()),!0)};function XT(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function MO(n,t){let{$cursor:s}=n.selection;return!s||(t?!t.endOfTextblock("forward",n):s.parentOffset<s.parent.content.size)?null:s}const kO=(n,t,s)=>{let l=MO(n,s);if(!l)return!1;let h=KT(l);if(!h)return!1;let m=h.nodeAfter;if(OO(n,h,t,1))return!0;if(l.parent.content.size==0&&(My(m,"start")||kr.isSelectable(m))){let b=x1(n.doc,l.before(),l.after(),Yn.empty);if(b&&b.slice.size<b.to-b.from){if(t){let i=n.tr.step(b);i.setSelection(My(m,"start")?vi.findFrom(i.doc.resolve(i.mapping.map(h.pos)),1):kr.create(i.doc,i.mapping.map(h.pos))),t(i.scrollIntoView())}return!0}}return m.isAtom&&h.depth==l.depth-1?(t&&t(n.tr.delete(h.pos,h.pos+m.nodeSize).scrollIntoView()),!0):!1},PO=(n,t,s)=>{let{$head:l,empty:h}=n.selection,m=l;if(!h)return!1;if(l.parent.isTextblock){if(s?!s.endOfTextblock("forward",n):l.parentOffset<l.parent.content.size)return!1;m=KT(l)}let b=m&&m.nodeAfter;return!b||!kr.isSelectable(b)?!1:(t&&t(n.tr.setSelection(kr.create(n.doc,m.pos)).scrollIntoView()),!0)};function KT(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){let s=n.node(t);if(n.index(t)+1<s.childCount)return n.doc.resolve(n.after(t+1));if(s.type.spec.isolating)break}return null}const jq=(n,t)=>{let s=n.selection,l=s instanceof kr,h;if(l){if(s.node.isTextblock||!um(n.doc,s.from))return!1;h=s.from}else if(h=_1(n.doc,s.from,-1),h==null)return!1;if(t){let m=n.tr.join(h);l&&m.setSelection(kr.create(m.doc,h-n.doc.resolve(h).nodeBefore.nodeSize)),t(m.scrollIntoView())}return!0},Fq=(n,t)=>{let s=n.selection,l;if(s instanceof kr){if(s.node.isTextblock||!um(n.doc,s.to))return!1;l=s.to}else if(l=_1(n.doc,s.to,1),l==null)return!1;return t&&t(n.tr.join(l).scrollIntoView()),!0},Bq=(n,t)=>{let{$from:s,$to:l}=n.selection,h=s.blockRange(l),m=h&&Hy(h);return m==null?!1:(t&&t(n.tr.lift(h,m).scrollIntoView()),!0)},RO=(n,t)=>{let{$head:s,$anchor:l}=n.selection;return!s.parent.type.spec.code||!s.sameParent(l)?!1:(t&&t(n.tr.insertText(`
`).scrollIntoView()),!0)};function YT(n){for(let t=0;t<n.edgeCount;t++){let{type:s}=n.edge(t);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}const Vq=(n,t)=>{let{$head:s,$anchor:l}=n.selection;if(!s.parent.type.spec.code||!s.sameParent(l))return!1;let h=s.node(-1),m=s.indexAfter(-1),b=YT(h.contentMatchAt(m));if(!b||!h.canReplaceWith(m,m,b))return!1;if(t){let i=s.after(),A=n.tr.replaceWith(i,i,b.createAndFill());A.setSelection(vi.near(A.doc.resolve(i),1)),t(A.scrollIntoView())}return!0},NO=(n,t)=>{let s=n.selection,{$from:l,$to:h}=s;if(s instanceof Ic||l.parent.inlineContent||h.parent.inlineContent)return!1;let m=YT(h.parent.contentMatchAt(h.indexAfter()));if(!m||!m.isTextblock)return!1;if(t){let b=(!l.parentOffset&&h.index()<h.parent.childCount?l:h).pos,i=n.tr.insert(b,m.createAndFill());i.setSelection(ti.create(i.doc,b+1)),t(i.scrollIntoView())}return!0},DO=(n,t)=>{let{$cursor:s}=n.selection;if(!s||s.parent.content.size)return!1;if(s.depth>1&&s.after()!=s.end(-1)){let m=s.before();if(Sf(n.doc,m))return t&&t(n.tr.split(m).scrollIntoView()),!0}let l=s.blockRange(),h=l&&Hy(l);return h==null?!1:(t&&t(n.tr.lift(l,h).scrollIntoView()),!0)};function Uq(n){return(t,s)=>{let{$from:l,$to:h}=t.selection;if(t.selection instanceof kr&&t.selection.node.isBlock)return!l.parentOffset||!Sf(t.doc,l.pos)?!1:(s&&s(t.tr.split(l.pos).scrollIntoView()),!0);if(!l.depth)return!1;let m=[],b,i,A=!1,P=!1;for(let X=l.depth;;X--)if(l.node(X).isBlock){A=l.end(X)==l.pos+(l.depth-X),P=l.start(X)==l.pos-(l.depth-X),i=YT(l.node(X-1).contentMatchAt(l.indexAfter(X-1))),m.unshift(A&&i?{type:i}:null),b=X;break}else{if(X==1)return!1;m.unshift(null)}let D=t.tr;(t.selection instanceof ti||t.selection instanceof Ic)&&D.deleteSelection();let j=D.mapping.map(l.pos),U=Sf(D.doc,j,m.length,m);if(U||(m[0]=i?{type:i}:null,U=Sf(D.doc,j,m.length,m)),!U)return!1;if(D.split(j,m.length,m),!A&&P&&l.node(b).type!=i){let X=D.mapping.map(l.before(b)),Y=D.doc.resolve(X);i&&l.node(b-1).canReplaceWith(Y.index(),Y.index()+1,i)&&D.setNodeMarkup(D.mapping.map(l.before(b)),i)}return s&&s(D.scrollIntoView()),!0}}const $q=Uq(),Hq=(n,t)=>{let{$from:s,to:l}=n.selection,h,m=s.sharedDepth(l);return m==0?!1:(h=s.before(m),t&&t(n.tr.setSelection(kr.create(n.doc,h))),!0)};function Gq(n,t,s){let l=t.nodeBefore,h=t.nodeAfter,m=t.index();return!l||!h||!l.type.compatibleContent(h.type)?!1:!l.content.size&&t.parent.canReplace(m-1,m)?(s&&s(n.tr.delete(t.pos-l.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(m,m+1)||!(h.isTextblock||um(n.doc,t.pos))?!1:(s&&s(n.tr.join(t.pos).scrollIntoView()),!0)}function OO(n,t,s,l){let h=t.nodeBefore,m=t.nodeAfter,b,i,A=h.type.spec.isolating||m.type.spec.isolating;if(!A&&Gq(n,t,s))return!0;let P=!A&&t.parent.canReplace(t.index(),t.index()+1);if(P&&(b=(i=h.contentMatchAt(h.childCount)).findWrapping(m.type))&&i.matchType(b[0]||m.type).validEnd){if(s){let X=t.pos+m.nodeSize,Y=pn.empty;for(let de=b.length-1;de>=0;de--)Y=pn.from(b[de].create(null,Y));Y=pn.from(h.copy(Y));let W=n.tr.step(new xa(t.pos-1,X,t.pos,X,new Yn(Y,1,0),b.length,!0)),re=W.doc.resolve(X+2*b.length);re.nodeAfter&&re.nodeAfter.type==h.type&&um(W.doc,re.pos)&&W.join(re.pos),s(W.scrollIntoView())}return!0}let D=m.type.spec.isolating||l>0&&A?null:vi.findFrom(t,1),j=D&&D.$from.blockRange(D.$to),U=j&&Hy(j);if(U!=null&&U>=t.depth)return s&&s(n.tr.lift(j,U).scrollIntoView()),!0;if(P&&My(m,"start",!0)&&My(h,"end")){let X=h,Y=[];for(;Y.push(X),!X.isTextblock;)X=X.lastChild;let W=m,re=1;for(;!W.isTextblock;W=W.firstChild)re++;if(X.canReplace(X.childCount,X.childCount,W.content)){if(s){let de=pn.empty;for(let Fe=Y.length-1;Fe>=0;Fe--)de=pn.from(Y[Fe].copy(de));let Me=n.tr.step(new xa(t.pos-Y.length,t.pos+m.nodeSize,t.pos+re,t.pos+m.nodeSize-re,new Yn(de,Y.length,0),0,!0));s(Me.scrollIntoView())}return!0}}return!1}function LO(n){return function(t,s){let l=t.selection,h=n<0?l.$from:l.$to,m=h.depth;for(;h.node(m).isInline;){if(!m)return!1;m--}return h.node(m).isTextblock?(s&&s(t.tr.setSelection(ti.create(t.doc,n<0?h.start(m):h.end(m)))),!0):!1}}const qq=LO(-1),Wq=LO(1);function Zq(n,t=null){return function(s,l){let{$from:h,$to:m}=s.selection,b=h.blockRange(m),i=b&&zT(b,n,t);return i?(l&&l(s.tr.wrap(b,i).scrollIntoView()),!0):!1}}function rk(n,t=null){return function(s,l){let h=!1;for(let m=0;m<s.selection.ranges.length&&!h;m++){let{$from:{pos:b},$to:{pos:i}}=s.selection.ranges[m];s.doc.nodesBetween(b,i,(A,P)=>{if(h)return!1;if(!(!A.isTextblock||A.hasMarkup(n,t)))if(A.type==n)h=!0;else{let D=s.doc.resolve(P),j=D.index();h=D.parent.canReplaceWith(j,j+1,n)}})}if(!h)return!1;if(l){let m=s.tr;for(let b=0;b<s.selection.ranges.length;b++){let{$from:{pos:i},$to:{pos:A}}=s.selection.ranges[b];m.setBlockType(i,A,n,t)}l(m.scrollIntoView())}return!0}}function JT(...n){return function(t,s,l){for(let h=0;h<n.length;h++)if(n[h](t,s,l))return!0;return!1}}JT(ZT,CO,IO);JT(ZT,kO,PO);JT(RO,NO,DO,$q);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Xq(n,t=null){return function(s,l){let{$from:h,$to:m}=s.selection,b=h.blockRange(m);if(!b)return!1;let i=l?s.tr:null;return Kq(i,b,n,t)?(l&&l(i.scrollIntoView()),!0):!1}}function Kq(n,t,s,l=null){let h=!1,m=t,b=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(s)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let A=b.resolve(t.start-2);m=new d0(A,A,t.depth),t.endIndex<t.parent.childCount&&(t=new d0(t.$from,b.resolve(t.$to.end(t.depth)),t.depth)),h=!0}let i=zT(m,s,l,t);return i?(n&&Yq(n,t,i,h,s),!0):!1}function Yq(n,t,s,l,h){let m=pn.empty;for(let D=s.length-1;D>=0;D--)m=pn.from(s[D].type.create(s[D].attrs,m));n.step(new xa(t.start-(l?2:0),t.end,t.start,t.end,new Yn(m,0,0),s.length,!0));let b=0;for(let D=0;D<s.length;D++)s[D].type==h&&(b=D+1);let i=s.length-b,A=t.start+s.length-(l?2:0),P=t.parent;for(let D=t.startIndex,j=t.endIndex,U=!0;D<j;D++,U=!1)!U&&Sf(n.doc,A,i)&&(n.split(A,i),A+=2*i),A+=P.child(D).nodeSize;return n}function Jq(n){return function(t,s){let{$from:l,$to:h}=t.selection,m=l.blockRange(h,b=>b.childCount>0&&b.firstChild.type==n);return m?s?l.node(m.depth-1).type==n?Qq(t,s,n,m):e9(t,s,m):!0:!1}}function Qq(n,t,s,l){let h=n.tr,m=l.end,b=l.$to.end(l.depth);m<b&&(h.step(new xa(m-1,b,m,b,new Yn(pn.from(s.create(null,l.parent.copy())),1,0),1,!0)),l=new d0(h.doc.resolve(l.$from.pos),h.doc.resolve(b),l.depth));const i=Hy(l);if(i==null)return!1;h.lift(l,i);let A=h.doc.resolve(h.mapping.map(m,-1)-1);return um(h.doc,A.pos)&&A.nodeBefore.type==A.nodeAfter.type&&h.join(A.pos),t(h.scrollIntoView()),!0}function e9(n,t,s){let l=n.tr,h=s.parent;for(let X=s.end,Y=s.endIndex-1,W=s.startIndex;Y>W;Y--)X-=h.child(Y).nodeSize,l.delete(X-1,X+1);let m=l.doc.resolve(s.start),b=m.nodeAfter;if(l.mapping.map(s.end)!=s.start+m.nodeAfter.nodeSize)return!1;let i=s.startIndex==0,A=s.endIndex==h.childCount,P=m.node(-1),D=m.index(-1);if(!P.canReplace(D+(i?0:1),D+1,b.content.append(A?pn.empty:pn.from(h))))return!1;let j=m.pos,U=j+b.nodeSize;return l.step(new xa(j-(i?1:0),U+(A?1:0),j+1,U-1,new Yn((i?pn.empty:pn.from(h.copy(pn.empty))).append(A?pn.empty:pn.from(h.copy(pn.empty))),i?0:1,A?0:1),i?0:1)),t(l.scrollIntoView()),!0}function t9(n){return function(t,s){let{$from:l,$to:h}=t.selection,m=l.blockRange(h,P=>P.childCount>0&&P.firstChild.type==n);if(!m)return!1;let b=m.startIndex;if(b==0)return!1;let i=m.parent,A=i.child(b-1);if(A.type!=n)return!1;if(s){let P=A.lastChild&&A.lastChild.type==i.type,D=pn.from(P?n.create():null),j=new Yn(pn.from(n.create(null,pn.from(i.type.create(null,D)))),P?3:1,0),U=m.start,X=m.end;s(t.tr.step(new xa(U-(P?3:1),X,U,X,j,1,!0)).scrollIntoView())}return!0}}var n9=Object.defineProperty,zO=(n,t)=>{for(var s in t)n9(n,s,{get:t[s],enumerable:!0})};function T1(n){const{state:t,transaction:s}=n;let{selection:l}=s,{doc:h}=s,{storedMarks:m}=s;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return m},get selection(){return l},get doc(){return h},get tr(){return l=s.selection,h=s.doc,m=s.storedMarks,s}}}var E1=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:n,editor:t,state:s}=this,{view:l}=t,{tr:h}=s,m=this.buildProps(h);return Object.fromEntries(Object.entries(n).map(([b,i])=>[b,(...P)=>{const D=i(...P)(m);return!h.getMeta("preventDispatch")&&!this.hasCustomState&&l.dispatch(h),D}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,t=!0){const{rawCommands:s,editor:l,state:h}=this,{view:m}=l,b=[],i=!!n,A=n||h.tr,P=()=>(!i&&t&&!A.getMeta("preventDispatch")&&!this.hasCustomState&&m.dispatch(A),b.every(j=>j===!0)),D={...Object.fromEntries(Object.entries(s).map(([j,U])=>[j,(...Y)=>{const W=this.buildProps(A,t),re=U(...Y)(W);return b.push(re),D}])),run:P};return D}createCan(n){const{rawCommands:t,state:s}=this,l=!1,h=n||s.tr,m=this.buildProps(h,l);return{...Object.fromEntries(Object.entries(t).map(([i,A])=>[i,(...P)=>A(...P)({...m,dispatch:void 0})])),chain:()=>this.createChain(h,l)}}buildProps(n,t=!0){const{rawCommands:s,editor:l,state:h}=this,{view:m}=l,b={tr:n,editor:l,view:m,state:T1({state:h,transaction:n}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(n,t),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(s).map(([i,A])=>[i,(...P)=>A(...P)(b)]))}};return b}},r9=class{constructor(){this.callbacks={}}on(n,t){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(t),this}emit(n,...t){const s=this.callbacks[n];return s&&s.forEach(l=>l.apply(this,t)),this}off(n,t){const s=this.callbacks[n];return s&&(t?this.callbacks[n]=s.filter(l=>l!==t):delete this.callbacks[n]),this}once(n,t){const s=(...l)=>{this.off(n,s),t.apply(this,l)};return this.on(n,s)}removeAllListeners(){this.callbacks={}}};function jO(n,t){const s=new VD(n);return t.forEach(l=>{l.steps.forEach(h=>{s.step(h)})}),s}var FO=n=>{const t=n.childNodes;for(let s=t.length-1;s>=0;s-=1){const l=t[s];l.nodeType===3&&l.nodeValue&&/^(\n\s\s|\n)$/.test(l.nodeValue)?n.removeChild(l):l.nodeType===1&&FO(l)}return n};function Rv(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${n}</body>`,s=new window.DOMParser().parseFromString(t,"text/html").body;return FO(s)}function fx(n,t,s){if(n instanceof Wp||n instanceof pn)return n;s={slice:!0,parseOptions:{},...s};const l=typeof n=="object"&&n!==null,h=typeof n=="string";if(l)try{if(Array.isArray(n)&&n.length>0)return pn.fromArray(n.map(i=>t.nodeFromJSON(i)));const b=t.nodeFromJSON(n);return s.errorOnInvalidContent&&b.check(),b}catch(m){if(s.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:m});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",m),fx("",t,s)}if(h){if(s.errorOnInvalidContent){let b=!1,i="";const A=new ED({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:P=>(b=!0,i=typeof P=="string"?P:P.outerHTML,null)}]}})});if(s.slice?Zp.fromSchema(A).parseSlice(Rv(n),s.parseOptions):Zp.fromSchema(A).parse(Rv(n),s.parseOptions),s.errorOnInvalidContent&&b)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${i}`)})}const m=Zp.fromSchema(t);return s.slice?m.parseSlice(Rv(n),s.parseOptions).content:m.parse(Rv(n),s.parseOptions)}return fx("",t,s)}function LS(n,t,s={},l={}){return fx(n,t,{slice:!1,parseOptions:s,errorOnInvalidContent:l.errorOnInvalidContent})}function i9(n){for(let t=0;t<n.edgeCount;t+=1){const{type:s}=n.edge(t);if(s.isTextblock&&!s.hasRequiredAttrs())return s}return null}function s9(n,t,s){const l=[];return n.nodesBetween(t.from,t.to,(h,m)=>{s(h)&&l.push({node:h,pos:m})}),l}function o9(n,t){for(let s=n.depth;s>0;s-=1){const l=n.node(s);if(t(l))return{pos:s>0?n.before(s):0,start:n.start(s),depth:s,node:l}}}function C1(n){return t=>o9(t.$from,n)}function Cr(n,t,s){return n.config[t]===void 0&&n.parent?Cr(n.parent,t,s):typeof n.config[t]=="function"?n.config[t].bind({...s,parent:n.parent?Cr(n.parent,t,s):null}):n.config[t]}function QT(n){return n.map(t=>{const s={name:t.name,options:t.options,storage:t.storage},l=Cr(t,"addExtensions",s);return l?[t,...QT(l())]:t}).flat(10)}function e2(n,t){const s=Ag.fromSchema(t).serializeFragment(n),h=document.implementation.createHTMLDocument().createElement("div");return h.appendChild(s),h.innerHTML}function BO(n){return typeof n=="function"}function cs(n,t=void 0,...s){return BO(n)?t?n.bind(t)(...s):n(...s):n}function a9(n={}){return Object.keys(n).length===0&&n.constructor===Object}function px(n){const t=n.filter(h=>h.type==="extension"),s=n.filter(h=>h.type==="node"),l=n.filter(h=>h.type==="mark");return{baseExtensions:t,nodeExtensions:s,markExtensions:l}}function VO(n){const t=[],{nodeExtensions:s,markExtensions:l}=px(n),h=[...s,...l],m={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(b=>{const i={name:b.name,options:b.options,storage:b.storage,extensions:h},A=Cr(b,"addGlobalAttributes",i);if(!A)return;A().forEach(D=>{D.types.forEach(j=>{Object.entries(D.attributes).forEach(([U,X])=>{t.push({type:j,name:U,attribute:{...m,...X}})})})})}),h.forEach(b=>{const i={name:b.name,options:b.options,storage:b.storage},A=Cr(b,"addAttributes",i);if(!A)return;const P=A();Object.entries(P).forEach(([D,j])=>{const U={...m,...j};typeof U?.default=="function"&&(U.default=U.default()),U?.isRequired&&U?.default===void 0&&delete U.default,t.push({type:b.name,name:D,attribute:U})})}),t}function So(...n){return n.filter(t=>!!t).reduce((t,s)=>{const l={...t};return Object.entries(s).forEach(([h,m])=>{if(!l[h]){l[h]=m;return}if(h==="class"){const i=m?String(m).split(" "):[],A=l[h]?l[h].split(" "):[],P=i.filter(D=>!A.includes(D));l[h]=[...A,...P].join(" ")}else if(h==="style"){const i=m?m.split(";").map(D=>D.trim()).filter(Boolean):[],A=l[h]?l[h].split(";").map(D=>D.trim()).filter(Boolean):[],P=new Map;A.forEach(D=>{const[j,U]=D.split(":").map(X=>X.trim());P.set(j,U)}),i.forEach(D=>{const[j,U]=D.split(":").map(X=>X.trim());P.set(j,U)}),l[h]=Array.from(P.entries()).map(([D,j])=>`${D}: ${j}`).join("; ")}else l[h]=m}),l},{})}function v0(n,t){return t.filter(s=>s.type===n.type.name).filter(s=>s.attribute.rendered).map(s=>s.attribute.renderHTML?s.attribute.renderHTML(n.attrs)||{}:{[s.name]:n.attrs[s.name]}).reduce((s,l)=>So(s,l),{})}function l9(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function ik(n,t){return"style"in n?n:{...n,getAttrs:s=>{const l=n.getAttrs?n.getAttrs(s):n.attrs;if(l===!1)return!1;const h=t.reduce((m,b)=>{const i=b.attribute.parseHTML?b.attribute.parseHTML(s):l9(s.getAttribute(b.name));return i==null?m:{...m,[b.name]:i}},{});return{...l,...h}}}}function sk(n){return Object.fromEntries(Object.entries(n).filter(([t,s])=>t==="attrs"&&a9(s)?!1:s!=null))}function c9(n,t){var s;const l=VO(n),{nodeExtensions:h,markExtensions:m}=px(n),b=(s=h.find(P=>Cr(P,"topNode")))==null?void 0:s.name,i=Object.fromEntries(h.map(P=>{const D=l.filter(de=>de.type===P.name),j={name:P.name,options:P.options,storage:P.storage,editor:t},U=n.reduce((de,Me)=>{const Fe=Cr(Me,"extendNodeSchema",j);return{...de,...Fe?Fe(P):{}}},{}),X=sk({...U,content:cs(Cr(P,"content",j)),marks:cs(Cr(P,"marks",j)),group:cs(Cr(P,"group",j)),inline:cs(Cr(P,"inline",j)),atom:cs(Cr(P,"atom",j)),selectable:cs(Cr(P,"selectable",j)),draggable:cs(Cr(P,"draggable",j)),code:cs(Cr(P,"code",j)),whitespace:cs(Cr(P,"whitespace",j)),linebreakReplacement:cs(Cr(P,"linebreakReplacement",j)),defining:cs(Cr(P,"defining",j)),isolating:cs(Cr(P,"isolating",j)),attrs:Object.fromEntries(D.map(de=>{var Me,Fe;return[de.name,{default:(Me=de?.attribute)==null?void 0:Me.default,validate:(Fe=de?.attribute)==null?void 0:Fe.validate}]}))}),Y=cs(Cr(P,"parseHTML",j));Y&&(X.parseDOM=Y.map(de=>ik(de,D)));const W=Cr(P,"renderHTML",j);W&&(X.toDOM=de=>W({node:de,HTMLAttributes:v0(de,D)}));const re=Cr(P,"renderText",j);return re&&(X.toText=re),[P.name,X]})),A=Object.fromEntries(m.map(P=>{const D=l.filter(re=>re.type===P.name),j={name:P.name,options:P.options,storage:P.storage,editor:t},U=n.reduce((re,de)=>{const Me=Cr(de,"extendMarkSchema",j);return{...re,...Me?Me(P):{}}},{}),X=sk({...U,inclusive:cs(Cr(P,"inclusive",j)),excludes:cs(Cr(P,"excludes",j)),group:cs(Cr(P,"group",j)),spanning:cs(Cr(P,"spanning",j)),code:cs(Cr(P,"code",j)),attrs:Object.fromEntries(D.map(re=>{var de,Me;return[re.name,{default:(de=re?.attribute)==null?void 0:de.default,validate:(Me=re?.attribute)==null?void 0:Me.validate}]}))}),Y=cs(Cr(P,"parseHTML",j));Y&&(X.parseDOM=Y.map(re=>ik(re,D)));const W=Cr(P,"renderHTML",j);return W&&(X.toDOM=re=>W({mark:re,HTMLAttributes:v0(re,D)})),[P.name,X]}));return new ED({topNode:b,nodes:i,marks:A})}function u9(n){const t=n.filter((s,l)=>n.indexOf(s)!==l);return Array.from(new Set(t))}function t2(n){return n.sort((s,l)=>{const h=Cr(s,"priority")||100,m=Cr(l,"priority")||100;return h>m?-1:h<m?1:0})}function UO(n){const t=t2(QT(n)),s=u9(t.map(l=>l.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(l=>`'${l}'`).join(", ")}]. This can lead to issues.`),t}function $O(n,t,s){const{from:l,to:h}=t,{blockSeparator:m=`

`,textSerializers:b={}}=s||{};let i="";return n.nodesBetween(l,h,(A,P,D,j)=>{var U;A.isBlock&&P>l&&(i+=m);const X=b?.[A.type.name];if(X)return D&&(i+=X({node:A,pos:P,parent:D,index:j,range:t})),!1;A.isText&&(i+=(U=A?.text)==null?void 0:U.slice(Math.max(l,P)-P,h-P))}),i}function h9(n,t){const s={from:0,to:n.content.size};return $O(n,s,t)}function HO(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,s])=>[t,s.spec.toText]))}function Pf(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}function GO(n,t){const s=Pf(t,n.schema),{from:l,to:h,empty:m}=n.selection,b=[];m?(n.storedMarks&&b.push(...n.storedMarks),b.push(...n.selection.$head.marks())):n.doc.nodesBetween(l,h,A=>{b.push(...A.marks)});const i=b.find(A=>A.type.name===s.name);return i?{...i.attrs}:{}}function jo(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function d9(n,t){const s=jo(t,n.schema),{from:l,to:h}=n.selection,m=[];n.doc.nodesBetween(l,h,i=>{m.push(i)});const b=m.reverse().find(i=>i.type.name===s.name);return b?{...b.attrs}:{}}function A1(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function qO(n,t){const s=A1(typeof t=="string"?t:t.name,n.schema);return s==="node"?d9(n,t):s==="mark"?GO(n,t):{}}function f9(n,t=JSON.stringify){const s={};return n.filter(l=>{const h=t(l);return Object.prototype.hasOwnProperty.call(s,h)?!1:s[h]=!0})}function p9(n){const t=f9(n);return t.length===1?t:t.filter((s,l)=>!t.filter((m,b)=>b!==l).some(m=>s.oldRange.from>=m.oldRange.from&&s.oldRange.to<=m.oldRange.to&&s.newRange.from>=m.newRange.from&&s.newRange.to<=m.newRange.to))}function WO(n){const{mapping:t,steps:s}=n,l=[];return t.maps.forEach((h,m)=>{const b=[];if(h.ranges.length)h.forEach((i,A)=>{b.push({from:i,to:A})});else{const{from:i,to:A}=s[m];if(i===void 0||A===void 0)return;b.push({from:i,to:A})}b.forEach(({from:i,to:A})=>{const P=t.slice(m).map(i,-1),D=t.slice(m).map(A),j=t.invert().map(P,-1),U=t.invert().map(D);l.push({oldRange:{from:j,to:U},newRange:{from:P,to:D}})})}),p9(l)}function n2(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function b0(n,t,s={strict:!0}){const l=Object.keys(t);return l.length?l.every(h=>s.strict?t[h]===n[h]:n2(t[h])?t[h].test(n[h]):t[h]===n[h]):!0}function ZO(n,t,s={}){return n.find(l=>l.type===t&&b0(Object.fromEntries(Object.keys(s).map(h=>[h,l.attrs[h]])),s))}function ok(n,t,s={}){return!!ZO(n,t,s)}function r2(n,t,s){var l;if(!n||!t)return;let h=n.parent.childAfter(n.parentOffset);if((!h.node||!h.node.marks.some(D=>D.type===t))&&(h=n.parent.childBefore(n.parentOffset)),!h.node||!h.node.marks.some(D=>D.type===t)||(s=s||((l=h.node.marks[0])==null?void 0:l.attrs),!ZO([...h.node.marks],t,s)))return;let b=h.index,i=n.start()+h.offset,A=b+1,P=i+h.node.nodeSize;for(;b>0&&ok([...n.parent.child(b-1).marks],t,s);)b-=1,i-=n.parent.child(b).nodeSize;for(;A<n.parent.childCount&&ok([...n.parent.child(A).marks],t,s);)P+=n.parent.child(A).nodeSize,A+=1;return{from:i,to:P}}function i2(n,t,s){const l=[];return n===t?s.resolve(n).marks().forEach(h=>{const m=s.resolve(n),b=r2(m,h.type);b&&l.push({mark:h,...b})}):s.nodesBetween(n,t,(h,m)=>{!h||h?.nodeSize===void 0||l.push(...h.marks.map(b=>({from:m,to:m+h.nodeSize,mark:b})))}),l}var m9=(n,t,s,l=20)=>{const h=n.doc.resolve(s);let m=l,b=null;for(;m>0&&b===null;){const i=h.node(m);i?.type.name===t?b=i:m-=1}return[b,m]};function Iw(n,t){return t.nodes[n]||t.marks[n]||null}function Xv(n,t,s){return Object.fromEntries(Object.entries(s).filter(([l])=>{const h=n.find(m=>m.type===t&&m.name===l);return h?h.attribute.keepOnSplit:!1}))}var g9=(n,t=500)=>{let s="";const l=n.parentOffset;return n.parent.nodesBetween(Math.max(0,l-t),l,(h,m,b,i)=>{var A,P;const D=((P=(A=h.type.spec).toText)==null?void 0:P.call(A,{node:h,pos:m,parent:b,index:i}))||h.textContent||"%leaf%";s+=h.isAtom&&!h.isText?D:D.slice(0,Math.max(0,l-m))}),s};function zS(n,t,s={}){const{empty:l,ranges:h}=n.selection,m=t?Pf(t,n.schema):null;if(l)return!!(n.storedMarks||n.selection.$from.marks()).filter(j=>m?m.name===j.type.name:!0).find(j=>b0(j.attrs,s,{strict:!1}));let b=0;const i=[];if(h.forEach(({$from:j,$to:U})=>{const X=j.pos,Y=U.pos;n.doc.nodesBetween(X,Y,(W,re)=>{if(!W.isText&&!W.marks.length)return;const de=Math.max(X,re),Me=Math.min(Y,re+W.nodeSize),Fe=Me-de;b+=Fe,i.push(...W.marks.map(ht=>({mark:ht,from:de,to:Me})))})}),b===0)return!1;const A=i.filter(j=>m?m.name===j.mark.type.name:!0).filter(j=>b0(j.mark.attrs,s,{strict:!1})).reduce((j,U)=>j+U.to-U.from,0),P=i.filter(j=>m?j.mark.type!==m&&j.mark.type.excludes(m):!0).reduce((j,U)=>j+U.to-U.from,0);return(A>0?A+P:A)>=b}function sm(n,t,s={}){const{from:l,to:h,empty:m}=n.selection,b=t?jo(t,n.schema):null,i=[];n.doc.nodesBetween(l,h,(j,U)=>{if(j.isText)return;const X=Math.max(l,U),Y=Math.min(h,U+j.nodeSize);i.push({node:j,from:X,to:Y})});const A=h-l,P=i.filter(j=>b?b.name===j.node.type.name:!0).filter(j=>b0(j.node.attrs,s,{strict:!1}));return m?!!P.length:P.reduce((j,U)=>j+U.to-U.from,0)>=A}function y9(n,t,s={}){if(!t)return sm(n,null,s)||zS(n,null,s);const l=A1(t,n.schema);return l==="node"?sm(n,t,s):l==="mark"?zS(n,t,s):!1}var _9=(n,t)=>{const{$from:s,$to:l,$anchor:h}=n.selection;if(t){const m=C1(i=>i.type.name===t)(n.selection);if(!m)return!1;const b=n.doc.resolve(m.pos+1);return h.pos+1===b.end()}return!(l.parentOffset<l.parent.nodeSize-2||s.pos!==l.pos)},x9=n=>{const{$from:t,$to:s}=n.selection;return!(t.parentOffset>0||t.pos!==s.pos)};function ak(n,t){return Array.isArray(t)?t.some(s=>(typeof s=="string"?s:s.name)===n.name):t}function lk(n,t){const{nodeExtensions:s}=px(t),l=s.find(b=>b.name===n);if(!l)return!1;const h={name:l.name,options:l.options,storage:l.storage},m=cs(Cr(l,"group",h));return typeof m!="string"?!1:m.split(" ").includes("list")}function I1(n,{checkChildren:t=!0,ignoreWhitespace:s=!1}={}){var l;if(s){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((l=n.text)!=null?l:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let h=!0;return n.content.forEach(m=>{h!==!1&&(I1(m,{ignoreWhitespace:s,checkChildren:t})||(h=!1))}),h}return!1}function XO(n){return n instanceof kr}function KO(n){return n instanceof ti}function og(n=0,t=0,s=0){return Math.min(Math.max(n,t),s)}function YO(n,t=null){if(!t)return null;const s=vi.atStart(n),l=vi.atEnd(n);if(t==="start"||t===!0)return s;if(t==="end")return l;const h=s.from,m=l.to;return t==="all"?ti.create(n,og(0,h,m),og(n.content.size,h,m)):ti.create(n,og(t,h,m),og(t,h,m))}function v9(n,t,s){const l=n.steps.length-1;if(l<t)return;const h=n.steps[l];if(!(h instanceof ya||h instanceof xa))return;const m=n.mapping.maps[l];let b=0;m.forEach((i,A,P,D)=>{b===0&&(b=D)}),n.setSelection(vi.near(n.doc.resolve(b),s))}var M1=class{constructor(n){this.find=n.find,this.handler=n.handler}},b9=(n,t)=>{if(n2(t))return t.exec(n);const s=t(n);if(!s)return null;const l=[s.text];return l.index=s.index,l.input=n,l.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),l.push(s.replaceWith)),l};function Nv(n){var t;const{editor:s,from:l,to:h,text:m,rules:b,plugin:i}=n,{view:A}=s;if(A.composing)return!1;const P=A.state.doc.resolve(l);if(P.parent.type.spec.code||(t=P.nodeBefore||P.nodeAfter)!=null&&t.marks.find(U=>U.type.spec.code))return!1;let D=!1;const j=g9(P)+m;return b.forEach(U=>{if(D)return;const X=b9(j,U.find);if(!X)return;const Y=A.state.tr,W=T1({state:A.state,transaction:Y}),re={from:l-(X[0].length-m.length),to:h},{commands:de,chain:Me,can:Fe}=new E1({editor:s,state:W});U.handler({state:W,range:re,match:X,commands:de,chain:Me,can:Fe})===null||!Y.steps.length||(Y.setMeta(i,{transform:Y,from:l,to:h,text:m}),A.dispatch(Y),D=!0)}),D}function w9(n){const{editor:t,rules:s}=n,l=new po({state:{init(){return null},apply(h,m,b){const i=h.getMeta(l);if(i)return i;const A=h.getMeta("applyInputRules");return!!A&&setTimeout(()=>{let{text:D}=A;typeof D=="string"?D=D:D=e2(pn.from(D),b.schema);const{from:j}=A,U=j+D.length;Nv({editor:t,from:j,to:U,text:D,rules:s,plugin:l})}),h.selectionSet||h.docChanged?null:m}},props:{handleTextInput(h,m,b,i){return Nv({editor:t,from:m,to:b,text:i,rules:s,plugin:l})},handleDOMEvents:{compositionend:h=>(setTimeout(()=>{const{$cursor:m}=h.state.selection;m&&Nv({editor:t,from:m.pos,to:m.pos,text:"",rules:s,plugin:l})}),!1)},handleKeyDown(h,m){if(m.key!=="Enter")return!1;const{$cursor:b}=h.state.selection;return b?Nv({editor:t,from:b.pos,to:b.pos,text:`
`,rules:s,plugin:l}):!1}},isInputRules:!0});return l}function S9(n){return Object.prototype.toString.call(n).slice(8,-1)}function Dv(n){return S9(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function JO(n,t){const s={...n};return Dv(n)&&Dv(t)&&Object.keys(t).forEach(l=>{Dv(t[l])&&Dv(n[l])?s[l]=JO(n[l],t[l]):s[l]=t[l]}),s}var s2=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...cs(Cr(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...cs(Cr(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){const t=this.extend({...this.config,addOptions:()=>JO(this.options,n)});return t.name=this.name,t.parent=this.parent,t}extend(n={}){const t=new this.constructor({...this.config,...n});return t.parent=this,this.child=t,t.name="name"in n?n.name:t.parent.name,t}},dm=class QO extends s2{constructor(){super(...arguments),this.type="mark"}static create(t={}){const s=typeof t=="function"?t():t;return new QO(s)}static handleExit({editor:t,mark:s}){const{tr:l}=t.state,h=t.state.selection.$from;if(h.pos===h.end()){const b=h.marks();if(!!!b.find(P=>P?.type.name===s.name))return!1;const A=b.find(P=>P?.type.name===s.name);return A&&l.removeStoredMark(A),l.insertText(" ",h.pos),t.view.dispatch(l),!0}return!1}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}};function T9(n){return typeof n=="number"}var E9=class{constructor(n){this.find=n.find,this.handler=n.handler}},C9=(n,t,s)=>{if(n2(t))return[...n.matchAll(t)];const l=t(n,s);return l?l.map(h=>{const m=[h.text];return m.index=h.index,m.input=n,m.data=h.data,h.replaceWith&&(h.text.includes(h.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),m.push(h.replaceWith)),m}):[]};function A9(n){const{editor:t,state:s,from:l,to:h,rule:m,pasteEvent:b,dropEvent:i}=n,{commands:A,chain:P,can:D}=new E1({editor:t,state:s}),j=[];return s.doc.nodesBetween(l,h,(X,Y)=>{if(!X.isTextblock||X.type.spec.code)return;const W=Math.max(l,Y),re=Math.min(h,Y+X.content.size),de=X.textBetween(W-Y,re-Y,void 0,"");C9(de,m.find,b).forEach(Fe=>{if(Fe.index===void 0)return;const ht=W+Fe.index+1,at=ht+Fe[0].length,Dt={from:s.tr.mapping.map(ht),to:s.tr.mapping.map(at)},kt=m.handler({state:s,range:Dt,match:Fe,commands:A,chain:P,can:D,pasteEvent:b,dropEvent:i});j.push(kt)})}),j.every(X=>X!==null)}var Ov=null,I9=n=>{var t;const s=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=s.clipboardData)==null||t.setData("text/html",n),s};function M9(n){const{editor:t,rules:s}=n;let l=null,h=!1,m=!1,b=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,i;try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}const A=({state:D,from:j,to:U,rule:X,pasteEvt:Y})=>{const W=D.tr,re=T1({state:D,transaction:W});if(!(!A9({editor:t,state:re,from:Math.max(j-1,0),to:U.b-1,rule:X,pasteEvent:Y,dropEvent:i})||!W.steps.length)){try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}return b=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,W}};return s.map(D=>new po({view(j){const U=Y=>{var W;l=(W=j.dom.parentElement)!=null&&W.contains(Y.target)?j.dom.parentElement:null,l&&(Ov=t)},X=()=>{Ov&&(Ov=null)};return window.addEventListener("dragstart",U),window.addEventListener("dragend",X),{destroy(){window.removeEventListener("dragstart",U),window.removeEventListener("dragend",X)}}},props:{handleDOMEvents:{drop:(j,U)=>{if(m=l===j.dom.parentElement,i=U,!m){const X=Ov;X?.isEditable&&setTimeout(()=>{const Y=X.state.selection;Y&&X.commands.deleteRange({from:Y.from,to:Y.to})},10)}return!1},paste:(j,U)=>{var X;const Y=(X=U.clipboardData)==null?void 0:X.getData("text/html");return b=U,h=!!Y?.includes("data-pm-slice"),!1}}},appendTransaction:(j,U,X)=>{const Y=j[0],W=Y.getMeta("uiEvent")==="paste"&&!h,re=Y.getMeta("uiEvent")==="drop"&&!m,de=Y.getMeta("applyPasteRules"),Me=!!de;if(!W&&!re&&!Me)return;if(Me){let{text:at}=de;typeof at=="string"?at=at:at=e2(pn.from(at),X.schema);const{from:Dt}=de,kt=Dt+at.length,Rt=I9(at);return A({rule:D,state:X,from:Dt,to:{b:kt},pasteEvt:Rt})}const Fe=U.doc.content.findDiffStart(X.doc.content),ht=U.doc.content.findDiffEnd(X.doc.content);if(!(!T9(Fe)||!ht||Fe===ht.b))return A({rule:D,state:X,from:Fe,to:ht,pasteEvt:b})}}))}var k1=class{constructor(n,t){this.splittableMarks=[],this.editor=t,this.extensions=UO(n),this.schema=c9(this.extensions,t),this.setupExtensions()}get commands(){return this.extensions.reduce((n,t)=>{const s={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:Iw(t.name,this.schema)},l=Cr(t,"addCommands",s);return l?{...n,...l()}:n},{})}get plugins(){const{editor:n}=this,t=t2([...this.extensions].reverse()),s=[],l=[],h=t.map(m=>{const b={name:m.name,options:m.options,storage:this.editor.extensionStorage[m.name],editor:n,type:Iw(m.name,this.schema)},i=[],A=Cr(m,"addKeyboardShortcuts",b);let P={};if(m.type==="mark"&&Cr(m,"exitable",b)&&(P.ArrowRight=()=>dm.handleExit({editor:n,mark:m})),A){const Y=Object.fromEntries(Object.entries(A()).map(([W,re])=>[W,()=>re({editor:n})]));P={...P,...Y}}const D=Oq(P);i.push(D);const j=Cr(m,"addInputRules",b);ak(m,n.options.enableInputRules)&&j&&s.push(...j());const U=Cr(m,"addPasteRules",b);ak(m,n.options.enablePasteRules)&&U&&l.push(...U());const X=Cr(m,"addProseMirrorPlugins",b);if(X){const Y=X();i.push(...Y)}return i}).flat();return[w9({editor:n,rules:s}),...M9({editor:n,rules:l}),...h]}get attributes(){return VO(this.extensions)}get nodeViews(){const{editor:n}=this,{nodeExtensions:t}=px(this.extensions);return Object.fromEntries(t.filter(s=>!!Cr(s,"addNodeView")).map(s=>{const l=this.attributes.filter(i=>i.type===s.name),h={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:n,type:jo(s.name,this.schema)},m=Cr(s,"addNodeView",h);if(!m)return[];const b=(i,A,P,D,j)=>{const U=v0(i,l);return m()({node:i,view:A,getPos:P,decorations:D,innerDecorations:j,editor:n,extension:s,HTMLAttributes:U})};return[s.name,b]}))}get markViews(){const{editor:n}=this,{markExtensions:t}=px(this.extensions);return Object.fromEntries(t.filter(s=>!!Cr(s,"addMarkView")).map(s=>{const l=this.attributes.filter(i=>i.type===s.name),h={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:n,type:Pf(s.name,this.schema)},m=Cr(s,"addMarkView",h);if(!m)return[];const b=(i,A,P)=>{const D=v0(i,l);return m()({mark:i,view:A,inline:P,editor:n,extension:s,HTMLAttributes:D,updateAttributes:j=>{GW(i,n,j)}})};return[s.name,b]}))}setupExtensions(){const n=this.extensions;this.editor.extensionStorage=Object.fromEntries(n.map(t=>[t.name,t.storage])),n.forEach(t=>{var s;const l={name:t.name,options:t.options,storage:this.editor.extensionStorage[t.name],editor:this.editor,type:Iw(t.name,this.schema)};t.type==="mark"&&((s=cs(Cr(t,"keepOnSplit",l)))==null||s)&&this.splittableMarks.push(t.name);const h=Cr(t,"onBeforeCreate",l),m=Cr(t,"onCreate",l),b=Cr(t,"onUpdate",l),i=Cr(t,"onSelectionUpdate",l),A=Cr(t,"onTransaction",l),P=Cr(t,"onFocus",l),D=Cr(t,"onBlur",l),j=Cr(t,"onDestroy",l);h&&this.editor.on("beforeCreate",h),m&&this.editor.on("create",m),b&&this.editor.on("update",b),i&&this.editor.on("selectionUpdate",i),A&&this.editor.on("transaction",A),P&&this.editor.on("focus",P),D&&this.editor.on("blur",D),j&&this.editor.on("destroy",j)})}};k1.resolve=UO;k1.sort=t2;k1.flatten=QT;var k9={};zO(k9,{ClipboardTextSerializer:()=>tL,Commands:()=>iL,Delete:()=>sL,Drop:()=>oL,Editable:()=>aL,FocusEvents:()=>cL,Keymap:()=>uL,Paste:()=>hL,Tabindex:()=>dL,focusEventsPluginKey:()=>lL});var Es=class eL extends s2{constructor(){super(...arguments),this.type="extension"}static create(t={}){const s=typeof t=="function"?t():t;return new eL(s)}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}},tL=Es.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new po({key:new ba("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:s}=n,{doc:l,selection:h}=t,{ranges:m}=h,b=Math.min(...m.map(D=>D.$from.pos)),i=Math.max(...m.map(D=>D.$to.pos)),A=HO(s);return $O(l,{from:b,to:i},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:A})}}})]}}),nL={};zO(nL,{blur:()=>P9,clearContent:()=>R9,clearNodes:()=>N9,command:()=>D9,createParagraphNear:()=>O9,cut:()=>L9,deleteCurrentNode:()=>z9,deleteNode:()=>j9,deleteRange:()=>F9,deleteSelection:()=>B9,enter:()=>V9,exitCode:()=>U9,extendMarkRange:()=>$9,first:()=>H9,focus:()=>q9,forEach:()=>W9,insertContent:()=>Z9,insertContentAt:()=>K9,joinBackward:()=>Q9,joinDown:()=>J9,joinForward:()=>eW,joinItemBackward:()=>tW,joinItemForward:()=>nW,joinTextblockBackward:()=>rW,joinTextblockForward:()=>iW,joinUp:()=>Y9,keyboardShortcut:()=>oW,lift:()=>aW,liftEmptyBlock:()=>lW,liftListItem:()=>cW,newlineInCode:()=>uW,resetAttributes:()=>hW,scrollIntoView:()=>dW,selectAll:()=>fW,selectNodeBackward:()=>pW,selectNodeForward:()=>mW,selectParentNode:()=>gW,selectTextblockEnd:()=>yW,selectTextblockStart:()=>_W,setContent:()=>xW,setMark:()=>bW,setMeta:()=>wW,setNode:()=>SW,setNodeSelection:()=>TW,setTextSelection:()=>EW,sinkListItem:()=>CW,splitBlock:()=>AW,splitListItem:()=>IW,toggleList:()=>MW,toggleMark:()=>kW,toggleNode:()=>PW,toggleWrap:()=>RW,undoInputRule:()=>NW,unsetAllMarks:()=>DW,unsetMark:()=>OW,updateAttributes:()=>LW,wrapIn:()=>zW,wrapInList:()=>jW});var P9=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var s;n.isDestroyed||(t.dom.blur(),(s=window?.getSelection())==null||s.removeAllRanges())}),!0),R9=(n=!0)=>({commands:t})=>t.setContent("",{emitUpdate:n}),N9=()=>({state:n,tr:t,dispatch:s})=>{const{selection:l}=t,{ranges:h}=l;return s&&h.forEach(({$from:m,$to:b})=>{n.doc.nodesBetween(m.pos,b.pos,(i,A)=>{if(i.type.isText)return;const{doc:P,mapping:D}=t,j=P.resolve(D.map(A)),U=P.resolve(D.map(A+i.nodeSize)),X=j.blockRange(U);if(!X)return;const Y=Hy(X);if(i.type.isTextblock){const{defaultType:W}=j.parent.contentMatchAt(j.index());t.setNodeMarkup(X.start,W)}(Y||Y===0)&&t.lift(X,Y)})}),!0},D9=n=>t=>n(t),O9=()=>({state:n,dispatch:t})=>NO(n,t),L9=(n,t)=>({editor:s,tr:l})=>{const{state:h}=s,m=h.doc.slice(n.from,n.to);l.deleteRange(n.from,n.to);const b=l.mapping.map(t);return l.insert(b,m.content),l.setSelection(new ti(l.doc.resolve(Math.max(b-1,0)))),!0},z9=()=>({tr:n,dispatch:t})=>{const{selection:s}=n,l=s.$anchor.node();if(l.content.size>0)return!1;const h=n.selection.$anchor;for(let m=h.depth;m>0;m-=1)if(h.node(m).type===l.type){if(t){const i=h.before(m),A=h.after(m);n.delete(i,A).scrollIntoView()}return!0}return!1},j9=n=>({tr:t,state:s,dispatch:l})=>{const h=jo(n,s.schema),m=t.selection.$anchor;for(let b=m.depth;b>0;b-=1)if(m.node(b).type===h){if(l){const A=m.before(b),P=m.after(b);t.delete(A,P).scrollIntoView()}return!0}return!1},F9=n=>({tr:t,dispatch:s})=>{const{from:l,to:h}=n;return s&&t.delete(l,h),!0},B9=()=>({state:n,dispatch:t})=>ZT(n,t),V9=()=>({commands:n})=>n.keyboardShortcut("Enter"),U9=()=>({state:n,dispatch:t})=>Vq(n,t),$9=(n,t={})=>({tr:s,state:l,dispatch:h})=>{const m=Pf(n,l.schema),{doc:b,selection:i}=s,{$from:A,from:P,to:D}=i;if(h){const j=r2(A,m,t);if(j&&j.from<=P&&j.to>=D){const U=ti.create(b,j.from,j.to);s.setSelection(U)}}return!0},H9=n=>t=>{const s=typeof n=="function"?n(t):n;for(let l=0;l<s.length;l+=1)if(s[l](t))return!0;return!1};function G9(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function o2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var q9=(n=null,t={})=>({editor:s,view:l,tr:h,dispatch:m})=>{t={scrollIntoView:!0,...t};const b=()=>{(o2()||G9())&&l.dom.focus(),requestAnimationFrame(()=>{s.isDestroyed||(l.focus(),t?.scrollIntoView&&s.commands.scrollIntoView())})};if(l.hasFocus()&&n===null||n===!1)return!0;if(m&&n===null&&!KO(s.state.selection))return b(),!0;const i=YO(h.doc,n)||s.state.selection,A=s.state.selection.eq(i);return m&&(A||h.setSelection(i),A&&h.storedMarks&&h.setStoredMarks(h.storedMarks),b()),!0},W9=(n,t)=>s=>n.every((l,h)=>t(l,{...s,index:h})),Z9=(n,t)=>({tr:s,commands:l})=>l.insertContentAt({from:s.selection.from,to:s.selection.to},n,t),X9=n=>!("type"in n),K9=(n,t,s)=>({tr:l,dispatch:h,editor:m})=>{var b;if(h){s={parseOptions:m.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...s};let i;const{selection:A}=m.state,P=de=>{m.emit("contentError",{editor:m,error:de,disableCollaboration:()=>{"collaboration"in m.storage&&typeof m.storage.collaboration=="object"&&m.storage.collaboration&&(m.storage.collaboration.isDisabled=!0)}})},D={preserveWhitespace:"full",...s.parseOptions};if(!s.errorOnInvalidContent&&!m.options.enableContentCheck&&m.options.emitContentError)try{fx(t,m.schema,{parseOptions:D,errorOnInvalidContent:!0})}catch(de){P(de)}try{i=fx(t,m.schema,{parseOptions:D,errorOnInvalidContent:(b=s.errorOnInvalidContent)!=null?b:m.options.enableContentCheck})}catch(de){return P(de),!1}let{from:j,to:U}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},X=!0,Y=!0;if((X9(i)?i:[i]).forEach(de=>{de.check(),X=X?de.isText&&de.marks.length===0:!1,Y=Y?de.isBlock:!1}),j===U&&Y){const{parent:de}=l.doc.resolve(j);de.isTextblock&&!de.type.spec.code&&!de.childCount&&(j-=1,U+=1)}let re;if(X){if(Array.isArray(t))re=t.map(de=>de.text||"").join("");else if(t instanceof pn){let de="";t.forEach(Me=>{Me.text&&(de+=Me.text)}),re=de}else typeof t=="object"&&t&&t.text?re=t.text:re=t;l.insertText(re,j,U)}else{re=i;const de=A.$from.parentOffset===0,Me=A.$from.node().isText||A.$from.node().isTextblock,Fe=A.$from.node().content.size>0;de&&Me&&Fe&&(j=Math.max(0,j-1)),l.replaceWith(j,U,re)}s.updateSelection&&v9(l,l.steps.length-1,-1),s.applyInputRules&&l.setMeta("applyInputRules",{from:j,text:re}),s.applyPasteRules&&l.setMeta("applyPasteRules",{from:j,text:re})}return!0},Y9=()=>({state:n,dispatch:t})=>jq(n,t),J9=()=>({state:n,dispatch:t})=>Fq(n,t),Q9=()=>({state:n,dispatch:t})=>CO(n,t),eW=()=>({state:n,dispatch:t})=>kO(n,t),tW=()=>({state:n,dispatch:t,tr:s})=>{try{const l=_1(n.doc,n.selection.$from.pos,-1);return l==null?!1:(s.join(l,2),t&&t(s),!0)}catch{return!1}},nW=()=>({state:n,dispatch:t,tr:s})=>{try{const l=_1(n.doc,n.selection.$from.pos,1);return l==null?!1:(s.join(l,2),t&&t(s),!0)}catch{return!1}},rW=()=>({state:n,dispatch:t})=>Lq(n,t),iW=()=>({state:n,dispatch:t})=>zq(n,t);function rL(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function sW(n){const t=n.split(/-(?!$)/);let s=t[t.length-1];s==="Space"&&(s=" ");let l,h,m,b;for(let i=0;i<t.length-1;i+=1){const A=t[i];if(/^(cmd|meta|m)$/i.test(A))b=!0;else if(/^a(lt)?$/i.test(A))l=!0;else if(/^(c|ctrl|control)$/i.test(A))h=!0;else if(/^s(hift)?$/i.test(A))m=!0;else if(/^mod$/i.test(A))o2()||rL()?b=!0:h=!0;else throw new Error(`Unrecognized modifier name: ${A}`)}return l&&(s=`Alt-${s}`),h&&(s=`Ctrl-${s}`),b&&(s=`Meta-${s}`),m&&(s=`Shift-${s}`),s}var oW=n=>({editor:t,view:s,tr:l,dispatch:h})=>{const m=sW(n).split(/-(?!$)/),b=m.find(P=>!["Alt","Ctrl","Meta","Shift"].includes(P)),i=new KeyboardEvent("keydown",{key:b==="Space"?" ":b,altKey:m.includes("Alt"),ctrlKey:m.includes("Ctrl"),metaKey:m.includes("Meta"),shiftKey:m.includes("Shift"),bubbles:!0,cancelable:!0}),A=t.captureTransaction(()=>{s.someProp("handleKeyDown",P=>P(s,i))});return A?.steps.forEach(P=>{const D=P.map(l.mapping);D&&h&&l.maybeStep(D)}),!0},aW=(n,t={})=>({state:s,dispatch:l})=>{const h=jo(n,s.schema);return sm(s,h,t)?Bq(s,l):!1},lW=()=>({state:n,dispatch:t})=>DO(n,t),cW=n=>({state:t,dispatch:s})=>{const l=jo(n,t.schema);return Jq(l)(t,s)},uW=()=>({state:n,dispatch:t})=>RO(n,t);function ck(n,t){const s=typeof t=="string"?[t]:t;return Object.keys(n).reduce((l,h)=>(s.includes(h)||(l[h]=n[h]),l),{})}var hW=(n,t)=>({tr:s,state:l,dispatch:h})=>{let m=null,b=null;const i=A1(typeof n=="string"?n:n.name,l.schema);return i?(i==="node"&&(m=jo(n,l.schema)),i==="mark"&&(b=Pf(n,l.schema)),h&&s.selection.ranges.forEach(A=>{l.doc.nodesBetween(A.$from.pos,A.$to.pos,(P,D)=>{m&&m===P.type&&s.setNodeMarkup(D,void 0,ck(P.attrs,t)),b&&P.marks.length&&P.marks.forEach(j=>{b===j.type&&s.addMark(D,D+P.nodeSize,b.create(ck(j.attrs,t)))})})}),!0):!1},dW=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),fW=()=>({tr:n,dispatch:t})=>{if(t){const s=new Ic(n.doc);n.setSelection(s)}return!0},pW=()=>({state:n,dispatch:t})=>IO(n,t),mW=()=>({state:n,dispatch:t})=>PO(n,t),gW=()=>({state:n,dispatch:t})=>Hq(n,t),yW=()=>({state:n,dispatch:t})=>Wq(n,t),_W=()=>({state:n,dispatch:t})=>qq(n,t),xW=(n,{errorOnInvalidContent:t,emitUpdate:s=!0,parseOptions:l={}}={})=>({editor:h,tr:m,dispatch:b,commands:i})=>{const{doc:A}=m;if(l.preserveWhitespace!=="full"){const P=LS(n,h.schema,l,{errorOnInvalidContent:t??h.options.enableContentCheck});return b&&m.replaceWith(0,A.content.size,P).setMeta("preventUpdate",!s),!0}return b&&m.setMeta("preventUpdate",!s),i.insertContentAt({from:0,to:A.content.size},n,{parseOptions:l,errorOnInvalidContent:t??h.options.enableContentCheck})};function vW(n,t,s){var l;const{selection:h}=t;let m=null;if(KO(h)&&(m=h.$cursor),m){const i=(l=n.storedMarks)!=null?l:m.marks();return!!s.isInSet(i)||!i.some(A=>A.type.excludes(s))}const{ranges:b}=h;return b.some(({$from:i,$to:A})=>{let P=i.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(s):!1;return n.doc.nodesBetween(i.pos,A.pos,(D,j,U)=>{if(P)return!1;if(D.isInline){const X=!U||U.type.allowsMarkType(s),Y=!!s.isInSet(D.marks)||!D.marks.some(W=>W.type.excludes(s));P=X&&Y}return!P}),P})}var bW=(n,t={})=>({tr:s,state:l,dispatch:h})=>{const{selection:m}=s,{empty:b,ranges:i}=m,A=Pf(n,l.schema);if(h)if(b){const P=GO(l,A);s.addStoredMark(A.create({...P,...t}))}else i.forEach(P=>{const D=P.$from.pos,j=P.$to.pos;l.doc.nodesBetween(D,j,(U,X)=>{const Y=Math.max(X,D),W=Math.min(X+U.nodeSize,j);U.marks.find(de=>de.type===A)?U.marks.forEach(de=>{A===de.type&&s.addMark(Y,W,A.create({...de.attrs,...t}))}):s.addMark(Y,W,A.create(t))})});return vW(l,s,A)},wW=(n,t)=>({tr:s})=>(s.setMeta(n,t),!0),SW=(n,t={})=>({state:s,dispatch:l,chain:h})=>{const m=jo(n,s.schema);let b;return s.selection.$anchor.sameParent(s.selection.$head)&&(b=s.selection.$anchor.parent.attrs),m.isTextblock?h().command(({commands:i})=>rk(m,{...b,...t})(s)?!0:i.clearNodes()).command(({state:i})=>rk(m,{...b,...t})(i,l)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},TW=n=>({tr:t,dispatch:s})=>{if(s){const{doc:l}=t,h=og(n,0,l.content.size),m=kr.create(l,h);t.setSelection(m)}return!0},EW=n=>({tr:t,dispatch:s})=>{if(s){const{doc:l}=t,{from:h,to:m}=typeof n=="number"?{from:n,to:n}:n,b=ti.atStart(l).from,i=ti.atEnd(l).to,A=og(h,b,i),P=og(m,b,i),D=ti.create(l,A,P);t.setSelection(D)}return!0},CW=n=>({state:t,dispatch:s})=>{const l=jo(n,t.schema);return t9(l)(t,s)};function uk(n,t){const s=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(s){const l=s.filter(h=>t?.includes(h.type.name));n.tr.ensureMarks(l)}}var AW=({keepMarks:n=!0}={})=>({tr:t,state:s,dispatch:l,editor:h})=>{const{selection:m,doc:b}=t,{$from:i,$to:A}=m,P=h.extensionManager.attributes,D=Xv(P,i.node().type.name,i.node().attrs);if(m instanceof kr&&m.node.isBlock)return!i.parentOffset||!Sf(b,i.pos)?!1:(l&&(n&&uk(s,h.extensionManager.splittableMarks),t.split(i.pos).scrollIntoView()),!0);if(!i.parent.isBlock)return!1;const j=A.parentOffset===A.parent.content.size,U=i.depth===0?void 0:i9(i.node(-1).contentMatchAt(i.indexAfter(-1)));let X=j&&U?[{type:U,attrs:D}]:void 0,Y=Sf(t.doc,t.mapping.map(i.pos),1,X);if(!X&&!Y&&Sf(t.doc,t.mapping.map(i.pos),1,U?[{type:U}]:void 0)&&(Y=!0,X=U?[{type:U,attrs:D}]:void 0),l){if(Y&&(m instanceof ti&&t.deleteSelection(),t.split(t.mapping.map(i.pos),1,X),U&&!j&&!i.parentOffset&&i.parent.type!==U)){const W=t.mapping.map(i.before()),re=t.doc.resolve(W);i.node(-1).canReplaceWith(re.index(),re.index()+1,U)&&t.setNodeMarkup(t.mapping.map(i.before()),U)}n&&uk(s,h.extensionManager.splittableMarks),t.scrollIntoView()}return Y},IW=(n,t={})=>({tr:s,state:l,dispatch:h,editor:m})=>{var b;const i=jo(n,l.schema),{$from:A,$to:P}=l.selection,D=l.selection.node;if(D&&D.isBlock||A.depth<2||!A.sameParent(P))return!1;const j=A.node(-1);if(j.type!==i)return!1;const U=m.extensionManager.attributes;if(A.parent.content.size===0&&A.node(-1).childCount===A.indexAfter(-1)){if(A.depth===2||A.node(-3).type!==i||A.index(-2)!==A.node(-2).childCount-1)return!1;if(h){let de=pn.empty;const Me=A.index(-1)?1:A.index(-2)?2:3;for(let Rt=A.depth-Me;Rt>=A.depth-3;Rt-=1)de=pn.from(A.node(Rt).copy(de));const Fe=A.indexAfter(-1)<A.node(-2).childCount?1:A.indexAfter(-2)<A.node(-3).childCount?2:3,ht={...Xv(U,A.node().type.name,A.node().attrs),...t},at=((b=i.contentMatch.defaultType)==null?void 0:b.createAndFill(ht))||void 0;de=de.append(pn.from(i.createAndFill(null,at)||void 0));const Dt=A.before(A.depth-(Me-1));s.replace(Dt,A.after(-Fe),new Yn(de,4-Me,0));let kt=-1;s.doc.nodesBetween(Dt,s.doc.content.size,(Rt,fn)=>{if(kt>-1)return!1;Rt.isTextblock&&Rt.content.size===0&&(kt=fn+1)}),kt>-1&&s.setSelection(ti.near(s.doc.resolve(kt))),s.scrollIntoView()}return!0}const X=P.pos===A.end()?j.contentMatchAt(0).defaultType:null,Y={...Xv(U,j.type.name,j.attrs),...t},W={...Xv(U,A.node().type.name,A.node().attrs),...t};s.delete(A.pos,P.pos);const re=X?[{type:i,attrs:Y},{type:X,attrs:W}]:[{type:i,attrs:Y}];if(!Sf(s.doc,A.pos,2))return!1;if(h){const{selection:de,storedMarks:Me}=l,{splittableMarks:Fe}=m.extensionManager,ht=Me||de.$to.parentOffset&&de.$from.marks();if(s.split(A.pos,2,re).scrollIntoView(),!ht||!h)return!0;const at=ht.filter(Dt=>Fe.includes(Dt.type.name));s.ensureMarks(at)}return!0},Mw=(n,t)=>{const s=C1(b=>b.type===t)(n.selection);if(!s)return!0;const l=n.doc.resolve(Math.max(0,s.pos-1)).before(s.depth);if(l===void 0)return!0;const h=n.doc.nodeAt(l);return s.node.type===h?.type&&um(n.doc,s.pos)&&n.join(s.pos),!0},kw=(n,t)=>{const s=C1(b=>b.type===t)(n.selection);if(!s)return!0;const l=n.doc.resolve(s.start).after(s.depth);if(l===void 0)return!0;const h=n.doc.nodeAt(l);return s.node.type===h?.type&&um(n.doc,l)&&n.join(l),!0},MW=(n,t,s,l={})=>({editor:h,tr:m,state:b,dispatch:i,chain:A,commands:P,can:D})=>{const{extensions:j,splittableMarks:U}=h.extensionManager,X=jo(n,b.schema),Y=jo(t,b.schema),{selection:W,storedMarks:re}=b,{$from:de,$to:Me}=W,Fe=de.blockRange(Me),ht=re||W.$to.parentOffset&&W.$from.marks();if(!Fe)return!1;const at=C1(Dt=>lk(Dt.type.name,j))(W);if(Fe.depth>=1&&at&&Fe.depth-at.depth<=1){if(at.node.type===X)return P.liftListItem(Y);if(lk(at.node.type.name,j)&&X.validContent(at.node.content)&&i)return A().command(()=>(m.setNodeMarkup(at.pos,X),!0)).command(()=>Mw(m,X)).command(()=>kw(m,X)).run()}return!s||!ht||!i?A().command(()=>D().wrapInList(X,l)?!0:P.clearNodes()).wrapInList(X,l).command(()=>Mw(m,X)).command(()=>kw(m,X)).run():A().command(()=>{const Dt=D().wrapInList(X,l),kt=ht.filter(Rt=>U.includes(Rt.type.name));return m.ensureMarks(kt),Dt?!0:P.clearNodes()}).wrapInList(X,l).command(()=>Mw(m,X)).command(()=>kw(m,X)).run()},kW=(n,t={},s={})=>({state:l,commands:h})=>{const{extendEmptyMarkRange:m=!1}=s,b=Pf(n,l.schema);return zS(l,b,t)?h.unsetMark(b,{extendEmptyMarkRange:m}):h.setMark(b,t)},PW=(n,t,s={})=>({state:l,commands:h})=>{const m=jo(n,l.schema),b=jo(t,l.schema),i=sm(l,m,s);let A;return l.selection.$anchor.sameParent(l.selection.$head)&&(A=l.selection.$anchor.parent.attrs),i?h.setNode(b,A):h.setNode(m,{...A,...s})},RW=(n,t={})=>({state:s,commands:l})=>{const h=jo(n,s.schema);return sm(s,h,t)?l.lift(h):l.wrapIn(h,t)},NW=()=>({state:n,dispatch:t})=>{const s=n.plugins;for(let l=0;l<s.length;l+=1){const h=s[l];let m;if(h.spec.isInputRules&&(m=h.getState(n))){if(t){const b=n.tr,i=m.transform;for(let A=i.steps.length-1;A>=0;A-=1)b.step(i.steps[A].invert(i.docs[A]));if(m.text){const A=b.doc.resolve(m.from).marks();b.replaceWith(m.from,m.to,n.schema.text(m.text,A))}else b.delete(m.from,m.to)}return!0}}return!1},DW=()=>({tr:n,dispatch:t})=>{const{selection:s}=n,{empty:l,ranges:h}=s;return l||t&&h.forEach(m=>{n.removeMark(m.$from.pos,m.$to.pos)}),!0},OW=(n,t={})=>({tr:s,state:l,dispatch:h})=>{var m;const{extendEmptyMarkRange:b=!1}=t,{selection:i}=s,A=Pf(n,l.schema),{$from:P,empty:D,ranges:j}=i;if(!h)return!0;if(D&&b){let{from:U,to:X}=i;const Y=(m=P.marks().find(re=>re.type===A))==null?void 0:m.attrs,W=r2(P,A,Y);W&&(U=W.from,X=W.to),s.removeMark(U,X,A)}else j.forEach(U=>{s.removeMark(U.$from.pos,U.$to.pos,A)});return s.removeStoredMark(A),!0},LW=(n,t={})=>({tr:s,state:l,dispatch:h})=>{let m=null,b=null;const i=A1(typeof n=="string"?n:n.name,l.schema);return i?(i==="node"&&(m=jo(n,l.schema)),i==="mark"&&(b=Pf(n,l.schema)),h&&s.selection.ranges.forEach(A=>{const P=A.$from.pos,D=A.$to.pos;let j,U,X,Y;s.selection.empty?l.doc.nodesBetween(P,D,(W,re)=>{m&&m===W.type&&(X=Math.max(re,P),Y=Math.min(re+W.nodeSize,D),j=re,U=W)}):l.doc.nodesBetween(P,D,(W,re)=>{re<P&&m&&m===W.type&&(X=Math.max(re,P),Y=Math.min(re+W.nodeSize,D),j=re,U=W),re>=P&&re<=D&&(m&&m===W.type&&s.setNodeMarkup(re,void 0,{...W.attrs,...t}),b&&W.marks.length&&W.marks.forEach(de=>{if(b===de.type){const Me=Math.max(re,P),Fe=Math.min(re+W.nodeSize,D);s.addMark(Me,Fe,b.create({...de.attrs,...t}))}}))}),U&&(j!==void 0&&s.setNodeMarkup(j,void 0,{...U.attrs,...t}),b&&U.marks.length&&U.marks.forEach(W=>{b===W.type&&s.addMark(X,Y,b.create({...W.attrs,...t}))}))}),!0):!1},zW=(n,t={})=>({state:s,dispatch:l})=>{const h=jo(n,s.schema);return Zq(h,t)(s,l)},jW=(n,t={})=>({state:s,dispatch:l})=>{const h=jo(n,s.schema);return Xq(h,t)(s,l)},iL=Es.create({name:"commands",addCommands(){return{...nL}}}),sL=Es.create({name:"delete",onUpdate({transaction:n,appendedTransactions:t}){var s,l,h;const m=()=>{var b,i,A,P;if((P=(A=(i=(b=this.editor.options.coreExtensionOptions)==null?void 0:b.delete)==null?void 0:i.filterTransaction)==null?void 0:A.call(i,n))!=null?P:n.getMeta("y-sync$"))return;const D=jO(n.before,[n,...t]);WO(D).forEach(X=>{D.mapping.mapResult(X.oldRange.from).deletedAfter&&D.mapping.mapResult(X.oldRange.to).deletedBefore&&D.before.nodesBetween(X.oldRange.from,X.oldRange.to,(Y,W)=>{const re=W+Y.nodeSize-2,de=X.oldRange.from<=W&&re<=X.oldRange.to;this.editor.emit("delete",{type:"node",node:Y,from:W,to:re,newFrom:D.mapping.map(W),newTo:D.mapping.map(re),deletedRange:X.oldRange,newRange:X.newRange,partial:!de,editor:this.editor,transaction:n,combinedTransform:D})})});const U=D.mapping;D.steps.forEach((X,Y)=>{var W,re;if(X instanceof hh){const de=U.slice(Y).map(X.from,-1),Me=U.slice(Y).map(X.to),Fe=U.invert().map(de,-1),ht=U.invert().map(Me),at=(W=D.doc.nodeAt(de-1))==null?void 0:W.marks.some(kt=>kt.eq(X.mark)),Dt=(re=D.doc.nodeAt(Me))==null?void 0:re.marks.some(kt=>kt.eq(X.mark));this.editor.emit("delete",{type:"mark",mark:X.mark,from:X.from,to:X.to,deletedRange:{from:Fe,to:ht},newRange:{from:de,to:Me},partial:!!(Dt||at),editor:this.editor,transaction:n,combinedTransform:D})}})};(h=(l=(s=this.editor.options.coreExtensionOptions)==null?void 0:s.delete)==null?void 0:l.async)==null||h?setTimeout(m,0):m()}}),oL=Es.create({name:"drop",addProseMirrorPlugins(){return[new po({key:new ba("tiptapDrop"),props:{handleDrop:(n,t,s,l)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:s,moved:l})}}})]}}),aL=Es.create({name:"editable",addProseMirrorPlugins(){return[new po({key:new ba("editable"),props:{editable:()=>this.editor.options.editable}})]}}),lL=new ba("focusEvents"),cL=Es.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new po({key:lL,props:{handleDOMEvents:{focus:(t,s)=>{n.isFocused=!0;const l=n.state.tr.setMeta("focus",{event:s}).setMeta("addToHistory",!1);return t.dispatch(l),!1},blur:(t,s)=>{n.isFocused=!1;const l=n.state.tr.setMeta("blur",{event:s}).setMeta("addToHistory",!1);return t.dispatch(l),!1}}}})]}}),uL=Es.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:b})=>[()=>b.undoInputRule(),()=>b.command(({tr:i})=>{const{selection:A,doc:P}=i,{empty:D,$anchor:j}=A,{pos:U,parent:X}=j,Y=j.parent.isTextblock&&U>0?i.doc.resolve(U-1):j,W=Y.parent.type.spec.isolating,re=j.pos-j.parentOffset,de=W&&Y.parent.childCount===1?re===j.pos:vi.atStart(P).from===U;return!D||!X.type.isTextblock||X.textContent.length||!de||de&&j.parent.type.name==="paragraph"?!1:b.clearNodes()}),()=>b.deleteSelection(),()=>b.joinBackward(),()=>b.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:b})=>[()=>b.deleteSelection(),()=>b.deleteCurrentNode(),()=>b.joinForward(),()=>b.selectNodeForward()]),l={Enter:()=>this.editor.commands.first(({commands:b})=>[()=>b.newlineInCode(),()=>b.createParagraphNear(),()=>b.liftEmptyBlock(),()=>b.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},h={...l},m={...l,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return o2()||rL()?m:h},addProseMirrorPlugins(){return[new po({key:new ba("clearDocument"),appendTransaction:(n,t,s)=>{if(n.some(W=>W.getMeta("composition")))return;const l=n.some(W=>W.docChanged)&&!t.doc.eq(s.doc),h=n.some(W=>W.getMeta("preventClearDocument"));if(!l||h)return;const{empty:m,from:b,to:i}=t.selection,A=vi.atStart(t.doc).from,P=vi.atEnd(t.doc).to;if(m||!(b===A&&i===P)||!I1(s.doc))return;const U=s.tr,X=T1({state:s,transaction:U}),{commands:Y}=new E1({editor:this.editor,state:X});if(Y.clearNodes(),!!U.steps.length)return U}})]}}),hL=Es.create({name:"paste",addProseMirrorPlugins(){return[new po({key:new ba("tiptapPaste"),props:{handlePaste:(n,t,s)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:s})}}})]}}),dL=Es.create({name:"tabindex",addProseMirrorPlugins(){return[new po({key:new ba("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),FW=class py{constructor(t,s,l=!1,h=null){this.currentNode=null,this.actualDepth=null,this.isBlock=l,this.resolvedPos=t,this.editor=s,this.currentNode=h}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!=null?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let s=this.from,l=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}s=this.from+1,l=this.to-1}this.editor.commands.insertContentAt({from:s,to:l},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),s=this.resolvedPos.doc.resolve(t);return new py(s,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new py(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new py(t,this.editor)}get children(){const t=[];return this.node.content.forEach((s,l)=>{const h=s.isBlock&&!s.isTextblock,m=s.isAtom&&!s.isText,b=this.pos+l+(m?0:1);if(b<0||b>this.resolvedPos.doc.nodeSize-2)return;const i=this.resolvedPos.doc.resolve(b);if(!h&&i.depth<=this.depth)return;const A=new py(i,this.editor,h,h?s:null);h&&(A.actualDepth=this.depth+1),t.push(new py(i,this.editor,h,h?s:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,s={}){let l=null,h=this.parent;for(;h&&!l;){if(h.node.type.name===t)if(Object.keys(s).length>0){const m=h.node.attrs,b=Object.keys(s);for(let i=0;i<b.length;i+=1){const A=b[i];if(m[A]!==s[A])break}}else l=h;h=h.parent}return l}querySelector(t,s={}){return this.querySelectorAll(t,s,!0)[0]||null}querySelectorAll(t,s={},l=!1){let h=[];if(!this.children||this.children.length===0)return h;const m=Object.keys(s);return this.children.forEach(b=>{l&&h.length>0||(b.node.type.name===t&&m.every(A=>s[A]===b.node.attrs[A])&&h.push(b),!(l&&h.length>0)&&(h=h.concat(b.querySelectorAll(t,s,l))))}),h}setAttribute(t){const{tr:s}=this.editor.state;s.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(s)}},BW=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function VW(n,t,s){const l=document.querySelector("style[data-tiptap-style]");if(l!==null)return l;const h=document.createElement("style");return t&&h.setAttribute("nonce",t),h.setAttribute("data-tiptap-style",""),h.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(h),h}var UW=class extends r9{constructor(n={}){super(),this.css=null,this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:l})=>{throw l},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(n),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:l,slice:h,moved:m})=>this.options.onDrop(l,h,m)),this.on("paste",({event:l,slice:h})=>this.options.onPaste(l,h)),this.on("delete",this.options.onDelete);const t=this.createDoc(),s=YO(t,this.options.autofocus);this.editorState=gy.create({doc:t,schema:this.schema,selection:s||void 0}),this.options.element&&this.mount(this.options.element)}mount(n){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(n),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){var n;if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}this.editorView=null,this.isInitialized=!1,(n=this.css)==null||n.remove(),this.css=null}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=VW(BW,this.options.injectNonce))}setOptions(n={}){this.options={...this.options,...n},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(n,t=!0){this.setOptions({editable:n}),t&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:n=>{this.editorState=n},dispatch:n=>{this.editorState=this.state.apply(n)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(n,t)=>{if(t==="state")return this.editorState;if(t in n)return Reflect.get(n,t);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${t}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(n,t){const s=BO(t)?t(n,[...this.state.plugins]):[...this.state.plugins,n],l=this.state.reconfigure({plugins:s});return this.view.updateState(l),l}unregisterPlugin(n){if(this.isDestroyed)return;const t=this.state.plugins;let s=t;if([].concat(n).forEach(h=>{const m=typeof h=="string"?`${h}$`:h.key;s=s.filter(b=>!b.key.startsWith(m))}),t.length===s.length)return;const l=this.state.reconfigure({plugins:s});return this.view.updateState(l),l}createExtensionManager(){var n,t;const l=[...this.options.enableCoreExtensions?[aL,tL.configure({blockSeparator:(t=(n=this.options.coreExtensionOptions)==null?void 0:n.clipboardTextSerializer)==null?void 0:t.blockSeparator}),iL,cL,uL,dL,oL,hL,sL].filter(h=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[h.name]!==!1:!0):[],...this.options.extensions].filter(h=>["extension","node","mark"].includes(h?.type));this.extensionManager=new k1(l,this)}createCommandManager(){this.commandManager=new E1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let n;try{n=LS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(t){if(!(t instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(t.message))throw t;this.emit("contentError",{editor:this,error:t,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(s=>s.name!=="collaboration"),this.createExtensionManager()}}),n=LS(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return n}createView(n){var t;this.editorView=new SO(n,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)==null?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass(),this.injectCSS();const l=this.view.dom;l.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(n){this.isCapturingTransaction=!0,n(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(n){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=n;return}n.steps.forEach(P=>{var D;return(D=this.capturedTransaction)==null?void 0:D.step(P)});return}const{state:t,transactions:s}=this.state.applyTransaction(n),l=!this.state.selection.eq(t.selection),h=s.includes(n),m=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:n,nextState:t}),!h)return;this.view.updateState(t),this.emit("transaction",{editor:this,transaction:n,appendedTransactions:s.slice(1)}),l&&this.emit("selectionUpdate",{editor:this,transaction:n});const b=s.findLast(P=>P.getMeta("focus")||P.getMeta("blur")),i=b?.getMeta("focus"),A=b?.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:b}),A&&this.emit("blur",{editor:this,event:A.event,transaction:b}),!(n.getMeta("preventUpdate")||!s.some(P=>P.docChanged)||m.doc.eq(t.doc))&&this.emit("update",{editor:this,transaction:n,appendedTransactions:s.slice(1)})}getAttributes(n){return qO(this.state,n)}isActive(n,t){const s=typeof n=="string"?n:null,l=typeof n=="string"?t:n;return y9(this.state,s,l)}getJSON(){return this.state.doc.toJSON()}getHTML(){return e2(this.state.doc.content,this.schema)}getText(n){const{blockSeparator:t=`

`,textSerializers:s={}}=n||{};return h9(this.state.doc,{blockSeparator:t,textSerializers:{...HO(this.schema),...s}})}get isEmpty(){return I1(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var n,t;return(t=(n=this.editorView)==null?void 0:n.isDestroyed)!=null?t:!0}$node(n,t){var s;return((s=this.$doc)==null?void 0:s.querySelector(n,t))||null}$nodes(n,t){var s;return((s=this.$doc)==null?void 0:s.querySelectorAll(n,t))||null}$pos(n){const t=this.state.doc.resolve(n);return new FW(t,this)}get $doc(){return this.$pos(0)}};function ky(n){return new M1({find:n.find,handler:({state:t,range:s,match:l})=>{const h=cs(n.getAttributes,void 0,l);if(h===!1||h===null)return null;const{tr:m}=t,b=l[l.length-1],i=l[0];if(b){const A=i.search(/\S/),P=s.from+i.indexOf(b),D=P+b.length;if(i2(s.from,s.to,t.doc).filter(X=>X.mark.type.excluded.find(W=>W===n.type&&W!==X.mark.type)).filter(X=>X.to>P).length)return null;D<s.to&&m.delete(D,s.to),P>s.from&&m.delete(s.from+A,P);const U=s.from+A+b.length;m.addMark(s.from+A,U,n.type.create(h||{})),m.removeStoredMark(n.type)}}})}function $W(n){return new M1({find:n.find,handler:({state:t,range:s,match:l})=>{const h=cs(n.getAttributes,void 0,l)||{},{tr:m}=t,b=s.from;let i=s.to;const A=n.type.create(h);if(l[1]){const P=l[0].lastIndexOf(l[1]);let D=b+P;D>i?D=i:i=D+l[1].length;const j=l[0][l[0].length-1];m.insertText(j,b+l[0].length-1),m.replaceWith(D,i,A)}else if(l[0]){const P=n.type.isInline?b:b-1;m.insert(P,n.type.create(h)).delete(m.mapping.map(b),m.mapping.map(i))}m.scrollIntoView()}})}function jS(n){return new M1({find:n.find,handler:({state:t,range:s,match:l})=>{const h=t.doc.resolve(s.from),m=cs(n.getAttributes,void 0,l)||{};if(!h.node(-1).canReplaceWith(h.index(-1),h.indexAfter(-1),n.type))return null;t.tr.delete(s.from,s.to).setBlockType(s.from,s.from,n.type,m)}})}function Py(n){return new M1({find:n.find,handler:({state:t,range:s,match:l,chain:h})=>{const m=cs(n.getAttributes,void 0,l)||{},b=t.tr.delete(s.from,s.to),A=b.doc.resolve(s.from).blockRange(),P=A&&zT(A,n.type,m);if(!P)return null;if(b.wrap(A,P),n.keepMarks&&n.editor){const{selection:j,storedMarks:U}=t,{splittableMarks:X}=n.editor.extensionManager,Y=U||j.$to.parentOffset&&j.$from.marks();if(Y){const W=Y.filter(re=>X.includes(re.type.name));b.ensureMarks(W)}}if(n.keepAttributes){const j=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";h().updateAttributes(j,m).run()}const D=b.doc.resolve(s.from-1).nodeBefore;D&&D.type===n.type&&um(b.doc,s.from-1)&&(!n.joinPredicate||n.joinPredicate(l,D))&&b.join(s.from-1)}})}function HW(n,t){const{selection:s}=n,{$from:l}=s;if(s instanceof kr){const m=l.index();return l.parent.canReplaceWith(m,m+1,t)}let h=l.depth;for(;h>=0;){const m=l.index(h);if(l.node(h).contentMatchAt(m).matchType(t))return!0;h-=1}return!1}function GW(n,t,s={}){const{state:l}=t,{doc:h,tr:m}=l,b=n;h.descendants((i,A)=>{const P=m.mapping.map(A),D=m.mapping.map(A)+i.nodeSize;let j=null;if(i.marks.forEach(X=>{if(X!==b)return!1;j=X}),!j)return;let U=!1;if(Object.keys(s).forEach(X=>{s[X]!==j.attrs[X]&&(U=!0)}),U){const X=n.type.create({...n.attrs,...s});m.removeMark(P,D,n.type),m.addMark(P,D,X)}}),m.docChanged&&t.view.dispatch(m)}var Mc=class fL extends s2{constructor(){super(...arguments),this.type="node"}static create(t={}){const s=typeof t=="function"?t():t;return new fL(s)}configure(t){return super.configure(t)}extend(t){const s=typeof t=="function"?t():t;return super.extend(s)}};function Tg(n){return new E9({find:n.find,handler:({state:t,range:s,match:l,pasteEvent:h})=>{const m=cs(n.getAttributes,void 0,l,h);if(m===!1||m===null)return null;const{tr:b}=t,i=l[l.length-1],A=l[0];let P=s.to;if(i){const D=A.search(/\S/),j=s.from+A.indexOf(i),U=j+i.length;if(i2(s.from,s.to,t.doc).filter(Y=>Y.mark.type.excluded.find(re=>re===n.type&&re!==Y.mark.type)).filter(Y=>Y.to>j).length)return null;U<s.to&&b.delete(U,s.to),j>s.from&&b.delete(s.from+D,j),P=s.from+D+i.length,b.addMark(s.from+D,P,n.type.create(m||{})),b.removeStoredMark(n.type)}}})}var Pw,hk;function qW(){return hk||(hk=1,Pw=function n(t,s){if(t===s)return!0;if(t&&s&&typeof t=="object"&&typeof s=="object"){if(t.constructor!==s.constructor)return!1;var l,h,m;if(Array.isArray(t)){if(l=t.length,l!=s.length)return!1;for(h=l;h--!==0;)if(!n(t[h],s[h]))return!1;return!0}if(t instanceof Map&&s instanceof Map){if(t.size!==s.size)return!1;for(h of t.entries())if(!s.has(h[0]))return!1;for(h of t.entries())if(!n(h[1],s.get(h[0])))return!1;return!0}if(t instanceof Set&&s instanceof Set){if(t.size!==s.size)return!1;for(h of t.entries())if(!s.has(h[0]))return!1;return!0}if(ArrayBuffer.isView(t)&&ArrayBuffer.isView(s)){if(l=t.length,l!=s.length)return!1;for(h=l;h--!==0;)if(t[h]!==s[h])return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if(m=Object.keys(t),l=m.length,l!==Object.keys(s).length)return!1;for(h=l;h--!==0;)if(!Object.prototype.hasOwnProperty.call(s,m[h]))return!1;for(h=l;h--!==0;){var b=m[h];if(!(b==="_owner"&&t.$$typeof)&&!n(t[b],s[b]))return!1}return!0}return t!==t&&s!==s}),Pw}var WW=qW();const ZW=Y0(WW);var Rw={exports:{}},Nw={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dk;function XW(){if(dk)return Nw;dk=1;var n=yx(),t=lD();function s(P,D){return P===D&&(P!==0||1/P===1/D)||P!==P&&D!==D}var l=typeof Object.is=="function"?Object.is:s,h=t.useSyncExternalStore,m=n.useRef,b=n.useEffect,i=n.useMemo,A=n.useDebugValue;return Nw.useSyncExternalStoreWithSelector=function(P,D,j,U,X){var Y=m(null);if(Y.current===null){var W={hasValue:!1,value:null};Y.current=W}else W=Y.current;Y=i(function(){function de(Dt){if(!Me){if(Me=!0,Fe=Dt,Dt=U(Dt),X!==void 0&&W.hasValue){var kt=W.value;if(X(kt,Dt))return ht=kt}return ht=Dt}if(kt=ht,l(Fe,Dt))return kt;var Rt=U(Dt);return X!==void 0&&X(kt,Rt)?(Fe=Dt,kt):(Fe=Dt,ht=Rt)}var Me=!1,Fe,ht,at=j===void 0?null:j;return[function(){return de(D())},at===null?void 0:function(){return de(at())}]},[D,j,U,X]);var re=h(P,Y[0],Y[1]);return b(function(){W.hasValue=!0,W.value=re},[re]),A(re),re},Nw}var fk;function KW(){return fk||(fk=1,Rw.exports=XW()),Rw.exports}var YW=KW(),JW=(...n)=>t=>{n.forEach(s=>{typeof s=="function"?s(t):s&&(s.current=t)})},QW=({contentComponent:n})=>{const t=cD.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return v.jsx(v.Fragment,{children:Object.values(t)})};function e7(){const n=new Set;let t={};return{subscribe(s){return n.add(s),()=>{n.delete(s)}},getSnapshot(){return t},getServerSnapshot(){return t},setRenderer(s,l){t={...t,[s]:KS.createPortal(l.reactElement,l.element,s)},n.forEach(h=>h())},removeRenderer(s){const l={...t};delete l[s],t=l,n.forEach(h=>h())}}}var t7=class extends kn.Component{constructor(n){var t;super(n),this.editorContentRef=kn.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((t=n.editor)!=null&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const n=this.props.editor;if(n&&!n.isDestroyed&&n.options.element){if(n.contentComponent)return;const t=this.editorContentRef.current;t.append(...n.options.element.childNodes),n.setOptions({element:t}),n.contentComponent=e7(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=n.contentComponent.subscribe(()=>{this.setState(s=>s.hasContentComponentInitialized?s:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),n.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var n;const t=this.props.editor;if(!t||(this.initialized=!1,t.isDestroyed||t.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),t.contentComponent=null,!((n=t.options.element)!=null&&n.firstChild)))return;const s=document.createElement("div");s.append(...t.options.element.childNodes),t.setOptions({element:s})}render(){const{editor:n,innerRef:t,...s}=this.props;return v.jsxs(v.Fragment,{children:[v.jsx("div",{ref:JW(t,this.editorContentRef),...s}),n?.contentComponent&&v.jsx(QW,{contentComponent:n.contentComponent})]})}},n7=ee.forwardRef((n,t)=>{const s=kn.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return kn.createElement(t7,{key:s,innerRef:t,...n})}),r7=kn.memo(n7),i7=typeof window<"u"?ee.useLayoutEffect:ee.useEffect,s7=class{constructor(n){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=n,this.lastSnapshot={editor:n,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(n){return this.subscribers.add(n),()=>{this.subscribers.delete(n)}}watch(n){if(this.editor=n,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(l=>l())},s=this.editor;return s.on("transaction",t),()=>{s.off("transaction",t)}}}};function o7(n){var t;const[s]=ee.useState(()=>new s7(n.editor)),l=YW.useSyncExternalStoreWithSelector(s.subscribe,s.getSnapshot,s.getServerSnapshot,n.selector,(t=n.equalityFn)!=null?t:ZW);return i7(()=>s.watch(n.editor),[n.editor,s]),ee.useDebugValue(l),l}var a7=!1,FS=typeof window>"u",l7=FS||!!(typeof window<"u"&&window.next),c7=class pL{constructor(t){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=t,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(t){this.editor=t,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(s=>s())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?FS||l7?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const t={...this.options.current,onBeforeCreate:(...l)=>{var h,m;return(m=(h=this.options.current).onBeforeCreate)==null?void 0:m.call(h,...l)},onBlur:(...l)=>{var h,m;return(m=(h=this.options.current).onBlur)==null?void 0:m.call(h,...l)},onCreate:(...l)=>{var h,m;return(m=(h=this.options.current).onCreate)==null?void 0:m.call(h,...l)},onDestroy:(...l)=>{var h,m;return(m=(h=this.options.current).onDestroy)==null?void 0:m.call(h,...l)},onFocus:(...l)=>{var h,m;return(m=(h=this.options.current).onFocus)==null?void 0:m.call(h,...l)},onSelectionUpdate:(...l)=>{var h,m;return(m=(h=this.options.current).onSelectionUpdate)==null?void 0:m.call(h,...l)},onTransaction:(...l)=>{var h,m;return(m=(h=this.options.current).onTransaction)==null?void 0:m.call(h,...l)},onUpdate:(...l)=>{var h,m;return(m=(h=this.options.current).onUpdate)==null?void 0:m.call(h,...l)},onContentError:(...l)=>{var h,m;return(m=(h=this.options.current).onContentError)==null?void 0:m.call(h,...l)},onDrop:(...l)=>{var h,m;return(m=(h=this.options.current).onDrop)==null?void 0:m.call(h,...l)},onPaste:(...l)=>{var h,m;return(m=(h=this.options.current).onPaste)==null?void 0:m.call(h,...l)},onDelete:(...l)=>{var h,m;return(m=(h=this.options.current).onDelete)==null?void 0:m.call(h,...l)}};return new UW(t)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(t){return this.subscriptions.add(t),()=>{this.subscriptions.delete(t)}}static compareOptions(t,s){return Object.keys(t).every(l=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(l)?!0:l==="extensions"&&t.extensions&&s.extensions?t.extensions.length!==s.extensions.length?!1:t.extensions.every((h,m)=>{var b;return h===((b=s.extensions)==null?void 0:b[m])}):t[l]===s[l])}onRender(t){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&t.length===0?pL.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(t),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(t){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=t;return}if(this.previousDeps.length===t.length&&this.previousDeps.every((l,h)=>l===t[h]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=t}scheduleDestroy(){const t=this.instanceId,s=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===t){s&&s.setOptions(this.options.current);return}s&&!s.isDestroyed&&(s.destroy(),this.instanceId===t&&this.setEditor(null))},1)}};function u7(n={},t=[]){const s=ee.useRef(n);s.current=n;const[l]=ee.useState(()=>new c7(s)),h=cD.useSyncExternalStore(l.subscribe,l.getEditor,l.getServerSnapshot);return ee.useDebugValue(h),ee.useEffect(l.onRender(t)),o7({editor:h,selector:({transactionNumber:m})=>n.shouldRerenderOnTransaction===!1||n.shouldRerenderOnTransaction===void 0?null:n.immediatelyRender&&m===0?0:m+1}),h}var h7=ee.createContext({editor:null});h7.Consumer;var d7=ee.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),f7=()=>ee.useContext(d7);kn.forwardRef((n,t)=>{const{onDragStart:s}=f7(),l=n.as||"div";return v.jsx(l,{...n,ref:t,"data-node-view-wrapper":"",onDragStart:s,style:{whiteSpace:"normal",...n.style}})});kn.createContext({markViewContentRef:()=>{}});var w0=(n,t)=>{if(n==="slot")return 0;if(n instanceof Function)return n(t);const{children:s,...l}=t??{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,l,s]},p7=/^\s*>\s$/,m7=Mc.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return w0("blockquote",{...So(this.options.HTMLAttributes,n),children:w0("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Py({find:p7,type:this.type})]}}),g7=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,y7=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,_7=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,x7=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,v7=dm.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return w0("strong",{...So(this.options.HTMLAttributes,n),children:w0("slot",{})})},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ky({find:g7,type:this.type}),ky({find:_7,type:this.type})]},addPasteRules(){return[Tg({find:y7,type:this.type}),Tg({find:x7,type:this.type})]}}),b7=/(^|[^`])`([^`]+)`(?!`)/,w7=/(^|[^`])`([^`]+)`(?!`)/g,S7=dm.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:n}){return["code",So(this.options.HTMLAttributes,n),0]},addCommands(){return{setCode:()=>({commands:n})=>n.setMark(this.name),toggleCode:()=>({commands:n})=>n.toggleMark(this.name),unsetCode:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ky({find:b7,type:this.type})]},addPasteRules(){return[Tg({find:w7,type:this.type})]}}),T7=/^```([a-z]+)?[\s\n]$/,E7=/^~~~([a-z]+)?[\s\n]$/,C7=Mc.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:n=>{var t;const{languageClassPrefix:s}=this.options,m=[...((t=n.firstElementChild)==null?void 0:t.classList)||[]].filter(b=>b.startsWith(s)).map(b=>b.replace(s,""))[0];return m||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:n,HTMLAttributes:t}){return["pre",So(this.options.HTMLAttributes,t),["code",{class:n.attrs.language?this.options.languageClassPrefix+n.attrs.language:null},0]]},addCommands(){return{setCodeBlock:n=>({commands:t})=>t.setNode(this.name,n),toggleCodeBlock:n=>({commands:t})=>t.toggleNode(this.name,"paragraph",n)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:n,$anchor:t}=this.editor.state.selection,s=t.pos===1;return!n||t.parent.type.name!==this.name?!1:s||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:n})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=n,{selection:s}=t,{$from:l,empty:h}=s;if(!h||l.parent.type!==this.type)return!1;const m=l.parentOffset===l.parent.nodeSize-2,b=l.parent.textContent.endsWith(`

`);return!m||!b?!1:n.chain().command(({tr:i})=>(i.delete(l.pos-2,l.pos),!0)).exitCode().run()},ArrowDown:({editor:n})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=n,{selection:s,doc:l}=t,{$from:h,empty:m}=s;if(!m||h.parent.type!==this.type||!(h.parentOffset===h.parent.nodeSize-2))return!1;const i=h.after();return i===void 0?!1:l.nodeAt(i)?n.commands.command(({tr:P})=>(P.setSelection(vi.near(l.resolve(i))),!0)):n.commands.exitCode()}}},addInputRules(){return[jS({find:T7,type:this.type,getAttributes:n=>({language:n[1]})}),jS({find:E7,type:this.type,getAttributes:n=>({language:n[1]})})]},addProseMirrorPlugins(){return[new po({key:new ba("codeBlockVSCodeHandler"),props:{handlePaste:(n,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const s=t.clipboardData.getData("text/plain"),l=t.clipboardData.getData("vscode-editor-data"),h=l?JSON.parse(l):void 0,m=h?.mode;if(!s||!m)return!1;const{tr:b,schema:i}=n.state,A=i.text(s.replace(/\r\n?/g,`
`));return b.replaceSelectionWith(this.type.create({language:m},A)),b.selection.$from.parent.type!==this.type&&b.setSelection(ti.near(b.doc.resolve(Math.max(0,b.selection.from-2)))),b.setMeta("paste",!0),n.dispatch(b),!0}}})]}}),A7=Mc.create({name:"doc",topNode:!0,content:"block+"}),I7=Mc.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:n}){return["br",So(this.options.HTMLAttributes,n)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:n,chain:t,state:s,editor:l})=>n.first([()=>n.exitCode(),()=>n.command(()=>{const{selection:h,storedMarks:m}=s;if(h.$from.parent.type.spec.isolating)return!1;const{keepMarks:b}=this.options,{splittableMarks:i}=l.extensionManager,A=m||h.$to.parentOffset&&h.$from.marks();return t().insertContent({type:this.name}).command(({tr:P,dispatch:D})=>{if(D&&A&&b){const j=A.filter(U=>i.includes(U.type.name));P.ensureMarks(j)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),M7=Mc.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:t}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,So(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.setNode(this.name,n):!1,toggleHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,t)=>({...n,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(n=>jS({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}}),k7=Mc.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",So(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:t})=>{if(!HW(t,t.schema.nodes[this.name]))return!1;const{selection:s}=t,{$to:l}=s,h=n();return XO(s)?h.insertContentAt(l.pos,{type:this.name}):h.insertContent({type:this.name}),h.command(({tr:m,dispatch:b})=>{var i;if(b){const{$to:A}=m.selection,P=A.end();if(A.nodeAfter)A.nodeAfter.isTextblock?m.setSelection(ti.create(m.doc,A.pos+1)):A.nodeAfter.isBlock?m.setSelection(kr.create(m.doc,A.pos)):m.setSelection(ti.create(m.doc,A.pos));else{const D=(i=A.parent.type.contentMatch.defaultType)==null?void 0:i.create();D&&(m.insert(P,D),m.setSelection(ti.create(m.doc,P+1)))}m.scrollIntoView()}return!0}).run()}}},addInputRules(){return[$W({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),P7=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,R7=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,N7=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,D7=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,O7=dm.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",So(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ky({find:P7,type:this.type}),ky({find:N7,type:this.type})]},addPasteRules(){return[Tg({find:R7,type:this.type}),Tg({find:D7,type:this.type})]}});const L7="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",z7="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Ry=(n,t)=>{for(const s in t)n[s]=t[s];return n},BS="numeric",VS="ascii",US="alpha",X_="asciinumeric",$_="alphanumeric",$S="domain",mL="emoji",j7="scheme",F7="slashscheme",Dw="whitespace";function B7(n,t){return n in t||(t[n]=[]),t[n]}function ag(n,t,s){t[BS]&&(t[X_]=!0,t[$_]=!0),t[VS]&&(t[X_]=!0,t[US]=!0),t[X_]&&(t[$_]=!0),t[US]&&(t[$_]=!0),t[$_]&&(t[$S]=!0),t[mL]&&(t[$S]=!0);for(const l in t){const h=B7(l,s);h.indexOf(n)<0&&h.push(n)}}function V7(n,t){const s={};for(const l in t)t[l].indexOf(n)>=0&&(s[l]=!0);return s}function Kl(n=null){this.j={},this.jr=[],this.jd=null,this.t=n}Kl.groups={};Kl.prototype={accepts(){return!!this.t},go(n){const t=this,s=t.j[n];if(s)return s;for(let l=0;l<t.jr.length;l++){const h=t.jr[l][0],m=t.jr[l][1];if(m&&h.test(n))return m}return t.jd},has(n,t=!1){return t?n in this.j:!!this.go(n)},ta(n,t,s,l){for(let h=0;h<n.length;h++)this.tt(n[h],t,s,l)},tr(n,t,s,l){l=l||Kl.groups;let h;return t&&t.j?h=t:(h=new Kl(t),s&&l&&ag(t,s,l)),this.jr.push([n,h]),h},ts(n,t,s,l){let h=this;const m=n.length;if(!m)return h;for(let b=0;b<m-1;b++)h=h.tt(n[b]);return h.tt(n[m-1],t,s,l)},tt(n,t,s,l){l=l||Kl.groups;const h=this;if(t&&t.j)return h.j[n]=t,t;const m=t;let b,i=h.go(n);if(i?(b=new Kl,Ry(b.j,i.j),b.jr.push.apply(b.jr,i.jr),b.jd=i.jd,b.t=i.t):b=new Kl,m){if(l)if(b.t&&typeof b.t=="string"){const A=Ry(V7(b.t,l),s);ag(m,A,l)}else s&&ag(m,s,l);b.t=m}return h.j[n]=b,b}};const Ci=(n,t,s,l,h)=>n.ta(t,s,l,h),uo=(n,t,s,l,h)=>n.tr(t,s,l,h),pk=(n,t,s,l,h)=>n.ts(t,s,l,h),bn=(n,t,s,l,h)=>n.tt(t,s,l,h),xf="WORD",HS="UWORD",gL="ASCIINUMERICAL",yL="ALPHANUMERICAL",mx="LOCALHOST",GS="TLD",qS="UTLD",Kv="SCHEME",my="SLASH_SCHEME",a2="NUM",WS="WS",l2="NL",K_="OPENBRACE",Y_="CLOSEBRACE",S0="OPENBRACKET",T0="CLOSEBRACKET",E0="OPENPAREN",C0="CLOSEPAREN",A0="OPENANGLEBRACKET",I0="CLOSEANGLEBRACKET",M0="FULLWIDTHLEFTPAREN",k0="FULLWIDTHRIGHTPAREN",P0="LEFTCORNERBRACKET",R0="RIGHTCORNERBRACKET",N0="LEFTWHITECORNERBRACKET",D0="RIGHTWHITECORNERBRACKET",O0="FULLWIDTHLESSTHAN",L0="FULLWIDTHGREATERTHAN",z0="AMPERSAND",j0="APOSTROPHE",F0="ASTERISK",jp="AT",B0="BACKSLASH",V0="BACKTICK",U0="CARET",Vp="COLON",c2="COMMA",$0="DOLLAR",ud="DOT",H0="EQUALS",u2="EXCLAMATION",du="HYPHEN",J_="PERCENT",G0="PIPE",q0="PLUS",W0="POUND",Q_="QUERY",h2="QUOTE",_L="FULLWIDTHMIDDLEDOT",d2="SEMI",hd="SLASH",ex="TILDE",Z0="UNDERSCORE",xL="EMOJI",X0="SYM";var vL=Object.freeze({__proto__:null,ALPHANUMERICAL:yL,AMPERSAND:z0,APOSTROPHE:j0,ASCIINUMERICAL:gL,ASTERISK:F0,AT:jp,BACKSLASH:B0,BACKTICK:V0,CARET:U0,CLOSEANGLEBRACKET:I0,CLOSEBRACE:Y_,CLOSEBRACKET:T0,CLOSEPAREN:C0,COLON:Vp,COMMA:c2,DOLLAR:$0,DOT:ud,EMOJI:xL,EQUALS:H0,EXCLAMATION:u2,FULLWIDTHGREATERTHAN:L0,FULLWIDTHLEFTPAREN:M0,FULLWIDTHLESSTHAN:O0,FULLWIDTHMIDDLEDOT:_L,FULLWIDTHRIGHTPAREN:k0,HYPHEN:du,LEFTCORNERBRACKET:P0,LEFTWHITECORNERBRACKET:N0,LOCALHOST:mx,NL:l2,NUM:a2,OPENANGLEBRACKET:A0,OPENBRACE:K_,OPENBRACKET:S0,OPENPAREN:E0,PERCENT:J_,PIPE:G0,PLUS:q0,POUND:W0,QUERY:Q_,QUOTE:h2,RIGHTCORNERBRACKET:R0,RIGHTWHITECORNERBRACKET:D0,SCHEME:Kv,SEMI:d2,SLASH:hd,SLASH_SCHEME:my,SYM:X0,TILDE:ex,TLD:GS,UNDERSCORE:Z0,UTLD:qS,UWORD:HS,WORD:xf,WS});const yf=/[a-z]/,j_=new RegExp("\\p{L}","u"),Ow=new RegExp("\\p{Emoji}","u"),_f=/\d/,Lw=/\s/,mk="\r",zw=`
`,U7="",$7="",jw="";let Lv=null,zv=null;function H7(n=[]){const t={};Kl.groups=t;const s=new Kl;Lv==null&&(Lv=gk(L7)),zv==null&&(zv=gk(z7)),bn(s,"'",j0),bn(s,"{",K_),bn(s,"}",Y_),bn(s,"[",S0),bn(s,"]",T0),bn(s,"(",E0),bn(s,")",C0),bn(s,"<",A0),bn(s,">",I0),bn(s,"",M0),bn(s,"",k0),bn(s,"",P0),bn(s,"",R0),bn(s,"",N0),bn(s,"",D0),bn(s,"",O0),bn(s,"",L0),bn(s,"&",z0),bn(s,"*",F0),bn(s,"@",jp),bn(s,"`",V0),bn(s,"^",U0),bn(s,":",Vp),bn(s,",",c2),bn(s,"$",$0),bn(s,".",ud),bn(s,"=",H0),bn(s,"!",u2),bn(s,"-",du),bn(s,"%",J_),bn(s,"|",G0),bn(s,"+",q0),bn(s,"#",W0),bn(s,"?",Q_),bn(s,'"',h2),bn(s,"/",hd),bn(s,";",d2),bn(s,"~",ex),bn(s,"_",Z0),bn(s,"\\",B0),bn(s,"",_L);const l=uo(s,_f,a2,{[BS]:!0});uo(l,_f,l);const h=uo(l,yf,gL,{[X_]:!0}),m=uo(l,j_,yL,{[$_]:!0}),b=uo(s,yf,xf,{[VS]:!0});uo(b,_f,h),uo(b,yf,b),uo(h,_f,h),uo(h,yf,h);const i=uo(s,j_,HS,{[US]:!0});uo(i,yf),uo(i,_f,m),uo(i,j_,i),uo(m,_f,m),uo(m,yf),uo(m,j_,m);const A=bn(s,zw,l2,{[Dw]:!0}),P=bn(s,mk,WS,{[Dw]:!0}),D=uo(s,Lw,WS,{[Dw]:!0});bn(s,jw,D),bn(P,zw,A),bn(P,jw,D),uo(P,Lw,D),bn(D,mk),bn(D,zw),uo(D,Lw,D),bn(D,jw,D);const j=uo(s,Ow,xL,{[mL]:!0});bn(j,"#"),uo(j,Ow,j),bn(j,U7,j);const U=bn(j,$7);bn(U,"#"),uo(U,Ow,j);const X=[[yf,b],[_f,h]],Y=[[yf,null],[j_,i],[_f,m]];for(let W=0;W<Lv.length;W++)Dp(s,Lv[W],GS,xf,X);for(let W=0;W<zv.length;W++)Dp(s,zv[W],qS,HS,Y);ag(GS,{tld:!0,ascii:!0},t),ag(qS,{utld:!0,alpha:!0},t),Dp(s,"file",Kv,xf,X),Dp(s,"mailto",Kv,xf,X),Dp(s,"http",my,xf,X),Dp(s,"https",my,xf,X),Dp(s,"ftp",my,xf,X),Dp(s,"ftps",my,xf,X),ag(Kv,{scheme:!0,ascii:!0},t),ag(my,{slashscheme:!0,ascii:!0},t),n=n.sort((W,re)=>W[0]>re[0]?1:-1);for(let W=0;W<n.length;W++){const re=n[W][0],Me=n[W][1]?{[j7]:!0}:{[F7]:!0};re.indexOf("-")>=0?Me[$S]=!0:yf.test(re)?_f.test(re)?Me[X_]=!0:Me[VS]=!0:Me[BS]=!0,pk(s,re,re,Me)}return pk(s,"localhost",mx,{ascii:!0}),s.jd=new Kl(X0),{start:s,tokens:Ry({groups:t},vL)}}function bL(n,t){const s=G7(t.replace(/[A-Z]/g,i=>i.toLowerCase())),l=s.length,h=[];let m=0,b=0;for(;b<l;){let i=n,A=null,P=0,D=null,j=-1,U=-1;for(;b<l&&(A=i.go(s[b]));)i=A,i.accepts()?(j=0,U=0,D=i):j>=0&&(j+=s[b].length,U++),P+=s[b].length,m+=s[b].length,b++;m-=j,b-=U,P-=j,h.push({t:D.t,v:t.slice(m-P,m),s:m-P,e:m})}return h}function G7(n){const t=[],s=n.length;let l=0;for(;l<s;){let h=n.charCodeAt(l),m,b=h<55296||h>56319||l+1===s||(m=n.charCodeAt(l+1))<56320||m>57343?n[l]:n.slice(l,l+2);t.push(b),l+=b.length}return t}function Dp(n,t,s,l,h){let m;const b=t.length;for(let i=0;i<b-1;i++){const A=t[i];n.j[A]?m=n.j[A]:(m=new Kl(l),m.jr=h.slice(),n.j[A]=m),n=m}return m=new Kl(s),m.jr=h.slice(),n.j[t[b-1]]=m,m}function gk(n){const t=[],s=[];let l=0,h="0123456789";for(;l<n.length;){let m=0;for(;h.indexOf(n[l+m])>=0;)m++;if(m>0){t.push(s.join(""));for(let b=parseInt(n.substring(l,l+m),10);b>0;b--)s.pop();l+=m}else s.push(n[l]),l++}return t}const gx={defaultProtocol:"http",events:null,format:yk,formatHref:yk,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function f2(n,t=null){let s=Ry({},gx);n&&(s=Ry(s,n instanceof f2?n.o:n));const l=s.ignoreTags,h=[];for(let m=0;m<l.length;m++)h.push(l[m].toUpperCase());this.o=s,t&&(this.defaultRender=t),this.ignoreTags=h}f2.prototype={o:gx,ignoreTags:[],defaultRender(n){return n},check(n){return this.get("validate",n.toString(),n)},get(n,t,s){const l=t!=null;let h=this.o[n];return h&&(typeof h=="object"?(h=s.t in h?h[s.t]:gx[n],typeof h=="function"&&l&&(h=h(t,s))):typeof h=="function"&&l&&(h=h(t,s.t,s)),h)},getObj(n,t,s){let l=this.o[n];return typeof l=="function"&&t!=null&&(l=l(t,s.t,s)),l},render(n){const t=n.render(this);return(this.get("render",null,n)||this.defaultRender)(t,n.t,n)}};function yk(n){return n}function wL(n,t){this.t="token",this.v=n,this.tk=t}wL.prototype={isLink:!1,toString(){return this.v},toHref(n){return this.toString()},toFormattedString(n){const t=this.toString(),s=n.get("truncate",t,this),l=n.get("format",t,this);return s&&l.length>s?l.substring(0,s)+"":l},toFormattedHref(n){return n.get("formatHref",this.toHref(n.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(n=gx.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(n),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(n){return{type:this.t,value:this.toFormattedString(n),isLink:this.isLink,href:this.toFormattedHref(n),start:this.startIndex(),end:this.endIndex()}},validate(n){return n.get("validate",this.toString(),this)},render(n){const t=this,s=this.toHref(n.get("defaultProtocol")),l=n.get("formatHref",s,this),h=n.get("tagName",s,t),m=this.toFormattedString(n),b={},i=n.get("className",s,t),A=n.get("target",s,t),P=n.get("rel",s,t),D=n.getObj("attributes",s,t),j=n.getObj("events",s,t);return b.href=l,i&&(b.class=i),A&&(b.target=A),P&&(b.rel=P),D&&Ry(b,D),{tagName:h,attributes:b,content:m,eventListeners:j}}};function P1(n,t){class s extends wL{constructor(h,m){super(h,m),this.t=n}}for(const l in t)s.prototype[l]=t[l];return s.t=n,s}const _k=P1("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),xk=P1("text"),q7=P1("nl"),jv=P1("url",{isLink:!0,toHref(n=gx.defaultProtocol){return this.hasProtocol()?this.v:`${n}://${this.v}`},hasProtocol(){const n=this.tk;return n.length>=2&&n[0].t!==mx&&n[1].t===Vp}}),cu=n=>new Kl(n);function W7({groups:n}){const t=n.domain.concat([z0,F0,jp,B0,V0,U0,$0,H0,du,a2,J_,G0,q0,W0,hd,X0,ex,Z0]),s=[j0,Vp,c2,ud,u2,J_,Q_,h2,d2,A0,I0,K_,Y_,T0,S0,E0,C0,M0,k0,P0,R0,N0,D0,O0,L0],l=[z0,j0,F0,B0,V0,U0,$0,H0,du,K_,Y_,J_,G0,q0,W0,Q_,hd,X0,ex,Z0],h=cu(),m=bn(h,ex);Ci(m,l,m),Ci(m,n.domain,m);const b=cu(),i=cu(),A=cu();Ci(h,n.domain,b),Ci(h,n.scheme,i),Ci(h,n.slashscheme,A),Ci(b,l,m),Ci(b,n.domain,b);const P=bn(b,jp);bn(m,jp,P),bn(i,jp,P),bn(A,jp,P);const D=bn(m,ud);Ci(D,l,m),Ci(D,n.domain,m);const j=cu();Ci(P,n.domain,j),Ci(j,n.domain,j);const U=bn(j,ud);Ci(U,n.domain,j);const X=cu(_k);Ci(U,n.tld,X),Ci(U,n.utld,X),bn(P,mx,X);const Y=bn(j,du);bn(Y,du,Y),Ci(Y,n.domain,j),Ci(X,n.domain,j),bn(X,ud,U),bn(X,du,Y);const W=bn(X,Vp);Ci(W,n.numeric,_k);const re=bn(b,du),de=bn(b,ud);bn(re,du,re),Ci(re,n.domain,b),Ci(de,l,m),Ci(de,n.domain,b);const Me=cu(jv);Ci(de,n.tld,Me),Ci(de,n.utld,Me),Ci(Me,n.domain,b),Ci(Me,l,m),bn(Me,ud,de),bn(Me,du,re),bn(Me,jp,P);const Fe=bn(Me,Vp),ht=cu(jv);Ci(Fe,n.numeric,ht);const at=cu(jv),Dt=cu();Ci(at,t,at),Ci(at,s,Dt),Ci(Dt,t,at),Ci(Dt,s,Dt),bn(Me,hd,at),bn(ht,hd,at);const kt=bn(i,Vp),Rt=bn(A,Vp),fn=bn(Rt,hd),En=bn(fn,hd);Ci(i,n.domain,b),bn(i,ud,de),bn(i,du,re),Ci(A,n.domain,b),bn(A,ud,de),bn(A,du,re),Ci(kt,n.domain,at),bn(kt,hd,at),bn(kt,Q_,at),Ci(En,n.domain,at),Ci(En,t,at),bn(En,hd,at);const xn=[[K_,Y_],[S0,T0],[E0,C0],[A0,I0],[M0,k0],[P0,R0],[N0,D0],[O0,L0]];for(let Tn=0;Tn<xn.length;Tn++){const[Bn,Ft]=xn[Tn],wn=bn(at,Bn);bn(Dt,Bn,wn),bn(wn,Ft,at);const Yt=cu(jv);Ci(wn,t,Yt);const Cn=cu();Ci(wn,s),Ci(Yt,t,Yt),Ci(Yt,s,Cn),Ci(Cn,t,Yt),Ci(Cn,s,Cn),bn(Yt,Ft,at),bn(Cn,Ft,at)}return bn(h,mx,Me),bn(h,l2,q7),{start:h,tokens:vL}}function Z7(n,t,s){let l=s.length,h=0,m=[],b=[];for(;h<l;){let i=n,A=null,P=null,D=0,j=null,U=-1;for(;h<l&&!(A=i.go(s[h].t));)b.push(s[h++]);for(;h<l&&(P=A||i.go(s[h].t));)A=null,i=P,i.accepts()?(U=0,j=i):U>=0&&U++,h++,D++;if(U<0)h-=D,h<l&&(b.push(s[h]),h++);else{b.length>0&&(m.push(Fw(xk,t,b)),b=[]),h-=U,D-=U;const X=j.t,Y=s.slice(h-D,h);m.push(Fw(X,t,Y))}}return b.length>0&&m.push(Fw(xk,t,b)),m}function Fw(n,t,s){const l=s[0].s,h=s[s.length-1].e,m=t.slice(l,h);return new n(m,s)}const X7=typeof console<"u"&&console&&console.warn||(()=>{}),K7="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Os={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Y7(){return Kl.groups={},Os.scanner=null,Os.parser=null,Os.tokenQueue=[],Os.pluginQueue=[],Os.customSchemes=[],Os.initialized=!1,Os}function vk(n,t=!1){if(Os.initialized&&X7(`linkifyjs: already initialized - will not register custom scheme "${n}" ${K7}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(n))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Os.customSchemes.push([n,t])}function J7(){Os.scanner=H7(Os.customSchemes);for(let n=0;n<Os.tokenQueue.length;n++)Os.tokenQueue[n][1]({scanner:Os.scanner});Os.parser=W7(Os.scanner.tokens);for(let n=0;n<Os.pluginQueue.length;n++)Os.pluginQueue[n][1]({scanner:Os.scanner,parser:Os.parser});return Os.initialized=!0,Os}function p2(n){return Os.initialized||J7(),Z7(Os.parser.start,n,bL(Os.scanner.start,n))}p2.scan=bL;function SL(n,t=null,s=null){if(t&&typeof t=="object"){if(s)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);s=t,t=null}const l=new f2(s),h=p2(n),m=[];for(let b=0;b<h.length;b++){const i=h[b];i.isLink&&(!t||i.t===t)&&l.check(i)&&m.push(i.toFormattedObject(l))}return m}var m2="[\0- -\u2029]",Q7=new RegExp(m2),eZ=new RegExp(`${m2}$`),tZ=new RegExp(m2,"g");function nZ(n){return n.length===1?n[0].isLink:n.length===3&&n[1].isLink?["()","[]"].includes(n[0].value+n[2].value):!1}function rZ(n){return new po({key:new ba("autolink"),appendTransaction:(t,s,l)=>{const h=t.some(P=>P.docChanged)&&!s.doc.eq(l.doc),m=t.some(P=>P.getMeta("preventAutolink"));if(!h||m)return;const{tr:b}=l,i=jO(s.doc,[...t]);if(WO(i).forEach(({newRange:P})=>{const D=s9(l.doc,P,X=>X.isTextblock);let j,U;if(D.length>1)j=D[0],U=l.doc.textBetween(j.pos,j.pos+j.node.nodeSize,void 0," ");else if(D.length){const X=l.doc.textBetween(P.from,P.to," "," ");if(!eZ.test(X))return;j=D[0],U=l.doc.textBetween(j.pos,P.to,void 0," ")}if(j&&U){const X=U.split(Q7).filter(Boolean);if(X.length<=0)return!1;const Y=X[X.length-1],W=j.pos+U.lastIndexOf(Y);if(!Y)return!1;const re=p2(Y).map(de=>de.toObject(n.defaultProtocol));if(!nZ(re))return!1;re.filter(de=>de.isLink).map(de=>({...de,from:W+de.start+1,to:W+de.end+1})).filter(de=>l.schema.marks.code?!l.doc.rangeHasMark(de.from,de.to,l.schema.marks.code):!0).filter(de=>n.validate(de.value)).filter(de=>n.shouldAutoLink(de.value)).forEach(de=>{i2(de.from,de.to,l.doc).some(Me=>Me.mark.type===n.type)||b.addMark(de.from,de.to,n.type.create({href:de.href}))})}}),!!b.steps.length)return b}})}function iZ(n){return new po({key:new ba("handleClickLink"),props:{handleClick:(t,s,l)=>{var h,m;if(l.button!==0||!t.editable)return!1;let b=null;if(l.target instanceof HTMLAnchorElement)b=l.target;else{let D=l.target;const j=[];for(;D.nodeName!=="DIV";)j.push(D),D=D.parentNode;b=j.find(U=>U.nodeName==="A")}if(!b)return!1;const i=qO(t.state,n.type.name),A=(h=b?.href)!=null?h:i.href,P=(m=b?.target)!=null?m:i.target;return n.enableClickSelection&&n.editor.commands.extendMarkRange(n.type.name),b&&A?(window.open(A,P),!0):!1}}})}function sZ(n){return new po({key:new ba("handlePasteLink"),props:{handlePaste:(t,s,l)=>{const{state:h}=t,{selection:m}=h,{empty:b}=m;if(b)return!1;let i="";l.content.forEach(P=>{i+=P.textContent});const A=SL(i,{defaultProtocol:n.defaultProtocol}).find(P=>P.isLink&&P.value===i);return!i||!A?!1:n.editor.commands.setMark(n.type,{href:A.href})}}})}function ng(n,t){const s=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(l=>{const h=typeof l=="string"?l:l.scheme;h&&s.push(h)}),!n||n.replace(tZ,"").match(new RegExp(`^(?:(?:${s.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var oZ=dm.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(n=>{if(typeof n=="string"){vk(n);return}vk(n.scheme,n.optionalSlashes)})},onDestroy(){Y7()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(n,t)=>!!ng(n,t.protocols),validate:n=>!!n,shouldAutoLink:n=>!!n}},addAttributes(){return{href:{default:null,parseHTML(n){return n.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:n=>{const t=n.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:s=>!!ng(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:n}){return this.options.isAllowedUri(n.href,{defaultValidate:t=>!!ng(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",So(this.options.HTMLAttributes,n),0]:["a",So(this.options.HTMLAttributes,{...n,href:""}),0]},addCommands(){return{setLink:n=>({chain:t})=>{const{href:s}=n;return this.options.isAllowedUri(s,{defaultValidate:l=>!!ng(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,n).setMeta("preventAutolink",!0).run():!1},toggleLink:n=>({chain:t})=>{const{href:s}=n||{};return s&&!this.options.isAllowedUri(s,{defaultValidate:l=>!!ng(l,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:t().toggleMark(this.name,n,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:n})=>n().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Tg({find:n=>{const t=[];if(n){const{protocols:s,defaultProtocol:l}=this.options,h=SL(n).filter(m=>m.isLink&&this.options.isAllowedUri(m.value,{defaultValidate:b=>!!ng(b,s),protocols:s,defaultProtocol:l}));h.length&&h.forEach(m=>t.push({text:m.value,data:{href:m.href},index:m.start}))}return t},type:this.type,getAttributes:n=>{var t;return{href:(t=n.data)==null?void 0:t.href}}})]},addProseMirrorPlugins(){const n=[],{protocols:t,defaultProtocol:s}=this.options;return this.options.autolink&&n.push(rZ({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:l=>this.options.isAllowedUri(l,{defaultValidate:h=>!!ng(h,t),protocols:t,defaultProtocol:s}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&n.push(iZ({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&n.push(sZ({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),n}}),aZ=Object.defineProperty,lZ=(n,t)=>{for(var s in t)aZ(n,s,{get:t[s],enumerable:!0})},cZ="listItem",bk="textStyle",wk=/^\s*([-+*])\s$/,TL=Mc.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",So(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(cZ,this.editor.getAttributes(bk)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=Py({find:wk,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Py({find:wk,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(bk),editor:this.editor})),[n]}}),EL=Mc.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",So(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),uZ={};lZ(uZ,{findListItemPos:()=>Ax,getNextListDepth:()=>g2,handleBackspace:()=>ZS,handleDelete:()=>XS,hasListBefore:()=>CL,hasListItemAfter:()=>hZ,hasListItemBefore:()=>AL,listItemHasSubList:()=>IL,nextListIsDeeper:()=>ML,nextListIsHigher:()=>kL});var Ax=(n,t)=>{const{$from:s}=t.selection,l=jo(n,t.schema);let h=null,m=s.depth,b=s.pos,i=null;for(;m>0&&i===null;)h=s.node(m),h.type===l?i=m:(m-=1,b-=1);return i===null?null:{$pos:t.doc.resolve(b),depth:i}},g2=(n,t)=>{const s=Ax(n,t);if(!s)return!1;const[,l]=m9(t,n,s.$pos.pos+4);return l},CL=(n,t,s)=>{const{$anchor:l}=n.selection,h=Math.max(0,l.pos-2),m=n.doc.resolve(h).node();return!(!m||!s.includes(m.type.name))},AL=(n,t)=>{var s;const{$anchor:l}=t.selection,h=t.doc.resolve(l.pos-2);return!(h.index()===0||((s=h.nodeBefore)==null?void 0:s.type.name)!==n)},IL=(n,t,s)=>{if(!s)return!1;const l=jo(n,t.schema);let h=!1;return s.descendants(m=>{m.type===l&&(h=!0)}),h},ZS=(n,t,s)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!sm(n.state,t)&&CL(n.state,t,s)){const{$anchor:i}=n.state.selection,A=n.state.doc.resolve(i.before()-1),P=[];A.node().descendants((U,X)=>{U.type.name===t&&P.push({node:U,pos:X})});const D=P.at(-1);if(!D)return!1;const j=n.state.doc.resolve(A.start()+D.pos+1);return n.chain().cut({from:i.start()-1,to:i.end()+1},j.end()).joinForward().run()}if(!sm(n.state,t)||!x9(n.state))return!1;const l=Ax(t,n.state);if(!l)return!1;const m=n.state.doc.resolve(l.$pos.pos-2).node(l.depth),b=IL(t,n.state,m);return AL(t,n.state)&&!b?n.commands.joinItemBackward():n.chain().liftListItem(t).run()},ML=(n,t)=>{const s=g2(n,t),l=Ax(n,t);return!l||!s?!1:s>l.depth},kL=(n,t)=>{const s=g2(n,t),l=Ax(n,t);return!l||!s?!1:s<l.depth},XS=(n,t)=>{if(!sm(n.state,t)||!_9(n.state,t))return!1;const{selection:s}=n.state,{$from:l,$to:h}=s;return!s.empty&&l.sameParent(h)?!1:ML(t,n.state)?n.chain().focus(n.state.selection.from+4).lift(t).joinBackward().run():kL(t,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},hZ=(n,t)=>{var s;const{$anchor:l}=t.selection,h=t.doc.resolve(l.pos-l.parentOffset-2);return!(h.index()===h.parent.childCount-1||((s=h.nodeAfter)==null?void 0:s.type.name)!==n)},PL=Es.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s})=>{n.state.schema.nodes[s]!==void 0&&XS(n,s)&&(t=!0)}),t},"Mod-Delete":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s})=>{n.state.schema.nodes[s]!==void 0&&XS(n,s)&&(t=!0)}),t},Backspace:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:l})=>{n.state.schema.nodes[s]!==void 0&&ZS(n,s,l)&&(t=!0)}),t},"Mod-Backspace":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:s,wrapperNames:l})=>{n.state.schema.nodes[s]!==void 0&&ZS(n,s,l)&&(t=!0)}),t}}}}),dZ="listItem",Sk="textStyle",Tk=/^(\d+)\.\s$/,RL=Mc.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:t,...s}=n;return t===1?["ol",So(this.options.HTMLAttributes,s),0]:["ol",So(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(dZ,this.editor.getAttributes(Sk)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=Py({find:Tk,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,s)=>s.childCount+s.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=Py({find:Tk,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Sk)}),joinPredicate:(t,s)=>s.childCount+s.attrs.start===+t[1],editor:this.editor})),[n]}}),fZ=/^\s*(\[([( |x])?\])\s$/,pZ=Mc.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const t=n.getAttribute("data-checked");return t===""||t==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:t}){return["li",So(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:t,getPos:s,editor:l})=>{const h=document.createElement("li"),m=document.createElement("label"),b=document.createElement("span"),i=document.createElement("input"),A=document.createElement("div"),P=()=>{var D,j;i.ariaLabel=((j=(D=this.options.a11y)==null?void 0:D.checkboxLabel)==null?void 0:j.call(D,n,i.checked))||`Task item checkbox for ${n.textContent||"empty task item"}`};return P(),m.contentEditable="false",i.type="checkbox",i.addEventListener("mousedown",D=>D.preventDefault()),i.addEventListener("change",D=>{if(!l.isEditable&&!this.options.onReadOnlyChecked){i.checked=!i.checked;return}const{checked:j}=D.target;l.isEditable&&typeof s=="function"&&l.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:U})=>{const X=s();if(typeof X!="number")return!1;const Y=U.doc.nodeAt(X);return U.setNodeMarkup(X,void 0,{...Y?.attrs,checked:j}),!0}).run(),!l.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,j)||(i.checked=!i.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([D,j])=>{h.setAttribute(D,j)}),h.dataset.checked=n.attrs.checked,i.checked=n.attrs.checked,m.append(i,b),h.append(m,A),Object.entries(t).forEach(([D,j])=>{h.setAttribute(D,j)}),{dom:h,contentDOM:A,update:D=>D.type!==this.type?!1:(h.dataset.checked=D.attrs.checked,i.checked=D.attrs.checked,P(),!0)}}},addInputRules(){return[Py({find:fZ,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),mZ=Mc.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",So(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Es.create({name:"listKit",addExtensions(){const n=[];return this.options.bulletList!==!1&&n.push(TL.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(EL.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(PL.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(RL.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(pZ.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(mZ.configure(this.options.taskList)),n}});var gZ=Mc.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",So(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),yZ=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,_Z=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,xZ=dm.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",So(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ky({find:yZ,type:this.type})]},addPasteRules(){return[Tg({find:_Z,type:this.type})]}}),vZ=Mc.create({name:"text",group:"inline"}),bZ=dm.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",So(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function wZ(n={}){return new po({view(t){return new SZ(t,n)}})}class SZ{constructor(t,s){var l;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(l=s.width)!==null&&l!==void 0?l:1,this.color=s.color===!1?void 0:s.color||"black",this.class=s.class,this.handlers=["dragover","dragend","drop","dragleave"].map(h=>{let m=b=>{this[h](b)};return t.dom.addEventListener(h,m),{name:h,handler:m}})}destroy(){this.handlers.forEach(({name:t,handler:s})=>this.editorView.dom.removeEventListener(t,s))}update(t,s){this.cursorPos!=null&&s.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),s=!t.parent.inlineContent,l,h=this.editorView.dom,m=h.getBoundingClientRect(),b=m.width/h.offsetWidth,i=m.height/h.offsetHeight;if(s){let j=t.nodeBefore,U=t.nodeAfter;if(j||U){let X=this.editorView.nodeDOM(this.cursorPos-(j?j.nodeSize:0));if(X){let Y=X.getBoundingClientRect(),W=j?Y.bottom:Y.top;j&&U&&(W=(W+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let re=this.width/2*i;l={left:Y.left,right:Y.right,top:W-re,bottom:W+re}}}}if(!l){let j=this.editorView.coordsAtPos(this.cursorPos),U=this.width/2*b;l={left:j.left-U,right:j.left+U,top:j.top,bottom:j.bottom}}let A=this.editorView.dom.offsetParent;this.element||(this.element=A.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",s),this.element.classList.toggle("prosemirror-dropcursor-inline",!s);let P,D;if(!A||A==document.body&&getComputedStyle(A).position=="static")P=-pageXOffset,D=-pageYOffset;else{let j=A.getBoundingClientRect(),U=j.width/A.offsetWidth,X=j.height/A.offsetHeight;P=j.left-A.scrollLeft*U,D=j.top-A.scrollTop*X}this.element.style.left=(l.left-P)/b+"px",this.element.style.top=(l.top-D)/i+"px",this.element.style.width=(l.right-l.left)/b+"px",this.element.style.height=(l.bottom-l.top)/i+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let s=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),l=s&&s.inside>=0&&this.editorView.state.doc.nodeAt(s.inside),h=l&&l.type.spec.disableDropCursor,m=typeof h=="function"?h(this.editorView,s,t):h;if(s&&!m){let b=s.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let i=LD(this.editorView.state.doc,b,this.editorView.dragging.slice);i!=null&&(b=i)}this.setCursor(b),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class ho extends vi{constructor(t){super(t,t)}map(t,s){let l=t.resolve(s.map(this.head));return ho.valid(l)?new ho(l):vi.near(l)}content(){return Yn.empty}eq(t){return t instanceof ho&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,s){if(typeof s.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new ho(t.resolve(s.pos))}getBookmark(){return new y2(this.anchor)}static valid(t){let s=t.parent;if(s.isTextblock||!TZ(t)||!EZ(t))return!1;let l=s.type.spec.allowGapCursor;if(l!=null)return l;let h=s.contentMatchAt(t.index()).defaultType;return h&&h.isTextblock}static findGapCursorFrom(t,s,l=!1){e:for(;;){if(!l&&ho.valid(t))return t;let h=t.pos,m=null;for(let b=t.depth;;b--){let i=t.node(b);if(s>0?t.indexAfter(b)<i.childCount:t.index(b)>0){m=i.child(s>0?t.indexAfter(b):t.index(b)-1);break}else if(b==0)return null;h+=s;let A=t.doc.resolve(h);if(ho.valid(A))return A}for(;;){let b=s>0?m.firstChild:m.lastChild;if(!b){if(m.isAtom&&!m.isText&&!kr.isSelectable(m)){t=t.doc.resolve(h+m.nodeSize*s),l=!1;continue e}break}m=b,h+=s;let i=t.doc.resolve(h);if(ho.valid(i))return i}return null}}}ho.prototype.visible=!1;ho.findFrom=ho.findGapCursorFrom;vi.jsonID("gapcursor",ho);class y2{constructor(t){this.pos=t}map(t){return new y2(t.map(this.pos))}resolve(t){let s=t.resolve(this.pos);return ho.valid(s)?new ho(s):vi.near(s)}}function TZ(n){for(let t=n.depth;t>=0;t--){let s=n.index(t),l=n.node(t);if(s==0){if(l.type.spec.isolating)return!0;continue}for(let h=l.child(s-1);;h=h.lastChild){if(h.childCount==0&&!h.inlineContent||h.isAtom||h.type.spec.isolating)return!0;if(h.inlineContent)return!1}}return!0}function EZ(n){for(let t=n.depth;t>=0;t--){let s=n.indexAfter(t),l=n.node(t);if(s==l.childCount){if(l.type.spec.isolating)return!0;continue}for(let h=l.child(s);;h=h.firstChild){if(h.childCount==0&&!h.inlineContent||h.isAtom||h.type.spec.isolating)return!0;if(h.inlineContent)return!1}}return!0}function CZ(){return new po({props:{decorations:kZ,createSelectionBetween(n,t,s){return t.pos==s.pos&&ho.valid(s)?new ho(s):null},handleClick:IZ,handleKeyDown:AZ,handleDOMEvents:{beforeinput:MZ}}})}const AZ=TO({ArrowLeft:Fv("horiz",-1),ArrowRight:Fv("horiz",1),ArrowUp:Fv("vert",-1),ArrowDown:Fv("vert",1)});function Fv(n,t){const s=n=="vert"?t>0?"down":"up":t>0?"right":"left";return function(l,h,m){let b=l.selection,i=t>0?b.$to:b.$from,A=b.empty;if(b instanceof ti){if(!m.endOfTextblock(s)||i.depth==0)return!1;A=!1,i=l.doc.resolve(t>0?i.after():i.before())}let P=ho.findGapCursorFrom(i,t,A);return P?(h&&h(l.tr.setSelection(new ho(P))),!0):!1}}function IZ(n,t,s){if(!n||!n.editable)return!1;let l=n.state.doc.resolve(t);if(!ho.valid(l))return!1;let h=n.posAtCoords({left:s.clientX,top:s.clientY});return h&&h.inside>-1&&kr.isSelectable(n.state.doc.nodeAt(h.inside))?!1:(n.dispatch(n.state.tr.setSelection(new ho(l))),!0)}function MZ(n,t){if(t.inputType!="insertCompositionText"||!(n.state.selection instanceof ho))return!1;let{$from:s}=n.state.selection,l=s.parent.contentMatchAt(s.index()).findWrapping(n.state.schema.nodes.text);if(!l)return!1;let h=pn.empty;for(let b=l.length-1;b>=0;b--)h=pn.from(l[b].createAndFill(null,h));let m=n.state.tr.replace(s.pos,s.pos,new Yn(h,0,0));return m.setSelection(ti.near(m.doc.resolve(s.pos+1))),n.dispatch(m),!1}function kZ(n){if(!(n.selection instanceof ho))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",eo.create(n.doc,[bl.widget(n.selection.head,t,{key:"gapcursor"})])}var K0=200,va=function(){};va.prototype.append=function(t){return t.length?(t=va.from(t),!this.length&&t||t.length<K0&&this.leafAppend(t)||this.length<K0&&t.leafPrepend(this)||this.appendInner(t)):this};va.prototype.prepend=function(t){return t.length?va.from(t).append(this):this};va.prototype.appendInner=function(t){return new PZ(this,t)};va.prototype.slice=function(t,s){return t===void 0&&(t=0),s===void 0&&(s=this.length),t>=s?va.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,s))};va.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};va.prototype.forEach=function(t,s,l){s===void 0&&(s=0),l===void 0&&(l=this.length),s<=l?this.forEachInner(t,s,l,0):this.forEachInvertedInner(t,s,l,0)};va.prototype.map=function(t,s,l){s===void 0&&(s=0),l===void 0&&(l=this.length);var h=[];return this.forEach(function(m,b){return h.push(t(m,b))},s,l),h};va.from=function(t){return t instanceof va?t:t&&t.length?new NL(t):va.empty};var NL=function(n){function t(l){n.call(this),this.values=l}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var s={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(h,m){return h==0&&m==this.length?this:new t(this.values.slice(h,m))},t.prototype.getInner=function(h){return this.values[h]},t.prototype.forEachInner=function(h,m,b,i){for(var A=m;A<b;A++)if(h(this.values[A],i+A)===!1)return!1},t.prototype.forEachInvertedInner=function(h,m,b,i){for(var A=m-1;A>=b;A--)if(h(this.values[A],i+A)===!1)return!1},t.prototype.leafAppend=function(h){if(this.length+h.length<=K0)return new t(this.values.concat(h.flatten()))},t.prototype.leafPrepend=function(h){if(this.length+h.length<=K0)return new t(h.flatten().concat(this.values))},s.length.get=function(){return this.values.length},s.depth.get=function(){return 0},Object.defineProperties(t.prototype,s),t}(va);va.empty=new NL([]);var PZ=function(n){function t(s,l){n.call(this),this.left=s,this.right=l,this.length=s.length+l.length,this.depth=Math.max(s.depth,l.depth)+1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(l){return l<this.left.length?this.left.get(l):this.right.get(l-this.left.length)},t.prototype.forEachInner=function(l,h,m,b){var i=this.left.length;if(h<i&&this.left.forEachInner(l,h,Math.min(m,i),b)===!1||m>i&&this.right.forEachInner(l,Math.max(h-i,0),Math.min(this.length,m)-i,b+i)===!1)return!1},t.prototype.forEachInvertedInner=function(l,h,m,b){var i=this.left.length;if(h>i&&this.right.forEachInvertedInner(l,h-i,Math.max(m,i)-i,b+i)===!1||m<i&&this.left.forEachInvertedInner(l,Math.min(h,i),m,b)===!1)return!1},t.prototype.sliceInner=function(l,h){if(l==0&&h==this.length)return this;var m=this.left.length;return h<=m?this.left.slice(l,h):l>=m?this.right.slice(l-m,h-m):this.left.slice(l,m).append(this.right.slice(0,h-m))},t.prototype.leafAppend=function(l){var h=this.right.leafAppend(l);if(h)return new t(this.left,h)},t.prototype.leafPrepend=function(l){var h=this.left.leafPrepend(l);if(h)return new t(h,this.right)},t.prototype.appendInner=function(l){return this.left.depth>=Math.max(this.right.depth,l.depth)+1?new t(this.left,new t(this.right,l)):new t(this,l)},t}(va);const RZ=500;class uh{constructor(t,s){this.items=t,this.eventCount=s}popEvent(t,s){if(this.eventCount==0)return null;let l=this.items.length;for(;;l--)if(this.items.get(l-1).selection){--l;break}let h,m;s&&(h=this.remapping(l,this.items.length),m=h.maps.length);let b=t.tr,i,A,P=[],D=[];return this.items.forEach((j,U)=>{if(!j.step){h||(h=this.remapping(l,U+1),m=h.maps.length),m--,D.push(j);return}if(h){D.push(new dd(j.map));let X=j.step.map(h.slice(m)),Y;X&&b.maybeStep(X).doc&&(Y=b.mapping.maps[b.mapping.maps.length-1],P.push(new dd(Y,void 0,void 0,P.length+D.length))),m--,Y&&h.appendMap(Y,m)}else b.maybeStep(j.step);if(j.selection)return i=h?j.selection.map(h.slice(m)):j.selection,A=new uh(this.items.slice(0,l).append(D.reverse().concat(P)),this.eventCount-1),!1},this.items.length,0),{remaining:A,transform:b,selection:i}}addTransform(t,s,l,h){let m=[],b=this.eventCount,i=this.items,A=!h&&i.length?i.get(i.length-1):null;for(let D=0;D<t.steps.length;D++){let j=t.steps[D].invert(t.docs[D]),U=new dd(t.mapping.maps[D],j,s),X;(X=A&&A.merge(U))&&(U=X,D?m.pop():i=i.slice(0,i.length-1)),m.push(U),s&&(b++,s=void 0),h||(A=U)}let P=b-l.depth;return P>DZ&&(i=NZ(i,P),b-=P),new uh(i.append(m),b)}remapping(t,s){let l=new lx;return this.items.forEach((h,m)=>{let b=h.mirrorOffset!=null&&m-h.mirrorOffset>=t?l.maps.length-h.mirrorOffset:void 0;l.appendMap(h.map,b)},t,s),l}addMaps(t){return this.eventCount==0?this:new uh(this.items.append(t.map(s=>new dd(s))),this.eventCount)}rebased(t,s){if(!this.eventCount)return this;let l=[],h=Math.max(0,this.items.length-s),m=t.mapping,b=t.steps.length,i=this.eventCount;this.items.forEach(U=>{U.selection&&i--},h);let A=s;this.items.forEach(U=>{let X=m.getMirror(--A);if(X==null)return;b=Math.min(b,X);let Y=m.maps[X];if(U.step){let W=t.steps[X].invert(t.docs[X]),re=U.selection&&U.selection.map(m.slice(A+1,X));re&&i++,l.push(new dd(Y,W,re))}else l.push(new dd(Y))},h);let P=[];for(let U=s;U<b;U++)P.push(new dd(m.maps[U]));let D=this.items.slice(0,h).append(P).append(l),j=new uh(D,i);return j.emptyItemCount()>RZ&&(j=j.compress(this.items.length-l.length)),j}emptyItemCount(){let t=0;return this.items.forEach(s=>{s.step||t++}),t}compress(t=this.items.length){let s=this.remapping(0,t),l=s.maps.length,h=[],m=0;return this.items.forEach((b,i)=>{if(i>=t)h.push(b),b.selection&&m++;else if(b.step){let A=b.step.map(s.slice(l)),P=A&&A.getMap();if(l--,P&&s.appendMap(P,l),A){let D=b.selection&&b.selection.map(s.slice(l));D&&m++;let j=new dd(P.invert(),A,D),U,X=h.length-1;(U=h.length&&h[X].merge(j))?h[X]=U:h.push(j)}}else b.map&&l--},this.items.length,0),new uh(va.from(h.reverse()),m)}}uh.empty=new uh(va.empty,0);function NZ(n,t){let s;return n.forEach((l,h)=>{if(l.selection&&t--==0)return s=h,!1}),n.slice(s)}class dd{constructor(t,s,l,h){this.map=t,this.step=s,this.selection=l,this.mirrorOffset=h}merge(t){if(this.step&&t.step&&!t.selection){let s=t.step.merge(this.step);if(s)return new dd(s.getMap().invert(),s,this.selection)}}}class Fp{constructor(t,s,l,h,m){this.done=t,this.undone=s,this.prevRanges=l,this.prevTime=h,this.prevComposition=m}}const DZ=20;function OZ(n,t,s,l){let h=s.getMeta(pg),m;if(h)return h.historyState;s.getMeta(jZ)&&(n=new Fp(n.done,n.undone,null,0,-1));let b=s.getMeta("appendedTransaction");if(s.steps.length==0)return n;if(b&&b.getMeta(pg))return b.getMeta(pg).redo?new Fp(n.done.addTransform(s,void 0,l,Yv(t)),n.undone,Ek(s.mapping.maps),n.prevTime,n.prevComposition):new Fp(n.done,n.undone.addTransform(s,void 0,l,Yv(t)),null,n.prevTime,n.prevComposition);if(s.getMeta("addToHistory")!==!1&&!(b&&b.getMeta("addToHistory")===!1)){let i=s.getMeta("composition"),A=n.prevTime==0||!b&&n.prevComposition!=i&&(n.prevTime<(s.time||0)-l.newGroupDelay||!LZ(s,n.prevRanges)),P=b?Bw(n.prevRanges,s.mapping):Ek(s.mapping.maps);return new Fp(n.done.addTransform(s,A?t.selection.getBookmark():void 0,l,Yv(t)),uh.empty,P,s.time,i??n.prevComposition)}else return(m=s.getMeta("rebased"))?new Fp(n.done.rebased(s,m),n.undone.rebased(s,m),Bw(n.prevRanges,s.mapping),n.prevTime,n.prevComposition):new Fp(n.done.addMaps(s.mapping.maps),n.undone.addMaps(s.mapping.maps),Bw(n.prevRanges,s.mapping),n.prevTime,n.prevComposition)}function LZ(n,t){if(!t)return!1;if(!n.docChanged)return!0;let s=!1;return n.mapping.maps[0].forEach((l,h)=>{for(let m=0;m<t.length;m+=2)l<=t[m+1]&&h>=t[m]&&(s=!0)}),s}function Ek(n){let t=[];for(let s=n.length-1;s>=0&&t.length==0;s--)n[s].forEach((l,h,m,b)=>t.push(m,b));return t}function Bw(n,t){if(!n)return null;let s=[];for(let l=0;l<n.length;l+=2){let h=t.map(n[l],1),m=t.map(n[l+1],-1);h<=m&&s.push(h,m)}return s}function zZ(n,t,s){let l=Yv(t),h=pg.get(t).spec.config,m=(s?n.undone:n.done).popEvent(t,l);if(!m)return null;let b=m.selection.resolve(m.transform.doc),i=(s?n.done:n.undone).addTransform(m.transform,t.selection.getBookmark(),h,l),A=new Fp(s?i:m.remaining,s?m.remaining:i,null,0,-1);return m.transform.setSelection(b).setMeta(pg,{redo:s,historyState:A})}let Vw=!1,Ck=null;function Yv(n){let t=n.plugins;if(Ck!=t){Vw=!1,Ck=t;for(let s=0;s<t.length;s++)if(t[s].spec.historyPreserveItems){Vw=!0;break}}return Vw}const pg=new ba("history"),jZ=new ba("closeHistory");function FZ(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new po({key:pg,state:{init(){return new Fp(uh.empty,uh.empty,null,0,-1)},apply(t,s,l){return OZ(s,l,t,n)}},config:n,props:{handleDOMEvents:{beforeinput(t,s){let l=s.inputType,h=l=="historyUndo"?OL:l=="historyRedo"?LL:null;return h?(s.preventDefault(),h(t.state,t.dispatch)):!1}}}})}function DL(n,t){return(s,l)=>{let h=pg.getState(s);if(!h||(n?h.undone:h.done).eventCount==0)return!1;if(l){let m=zZ(h,s,n);m&&l(t?m.scrollIntoView():m)}return!0}}const OL=DL(!1,!0),LL=DL(!0,!0);Es.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const t=n?.node||this.editor.state.doc;if((n?.mode||this.options.mode)==="textSize"){const l=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(l)}return t.nodeSize},this.storage.words=n=>{const t=n?.node||this.editor.state.doc,s=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(s)}},addProseMirrorPlugins(){let n=!1;return[new po({key:new ba("characterCount"),appendTransaction:(t,s,l)=>{if(n)return;const h=this.options.limit;if(h==null||h===0){n=!0;return}const m=this.storage.characters({node:l.doc});if(m>h){const b=m-h,i=0,A=b;console.warn(`[CharacterCount] Initial content exceeded limit of ${h} characters. Content was automatically trimmed.`);const P=l.tr.deleteRange(i,A);return n=!0,P}n=!0},filterTransaction:(t,s)=>{const l=this.options.limit;if(!t.docChanged||l===0||l===null||l===void 0)return!0;const h=this.storage.characters({node:s.doc}),m=this.storage.characters({node:t.doc});if(m<=l||h>l&&m>l&&m<=h)return!0;if(h>l&&m>l&&m>h||!t.getMeta("paste"))return!1;const i=t.selection.$head.pos,A=m-l,P=i-A,D=i;return t.deleteRange(P,D),!(this.storage.characters({node:t.doc})>l)}})]}});var BZ=Es.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[wZ(this.options)]}});Es.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new po({key:new ba("focus"),props:{decorations:({doc:n,selection:t})=>{const{isEditable:s,isFocused:l}=this.editor,{anchor:h}=t,m=[];if(!s||!l)return eo.create(n,[]);let b=0;this.options.mode==="deepest"&&n.descendants((A,P)=>{if(A.isText)return;if(!(h>=P&&h<=P+A.nodeSize-1))return!1;b+=1});let i=0;return n.descendants((A,P)=>{if(A.isText||!(h>=P&&h<=P+A.nodeSize-1))return!1;if(i+=1,this.options.mode==="deepest"&&b-i>0||this.options.mode==="shallowest"&&i>1)return this.options.mode==="deepest";m.push(bl.node(P,P+A.nodeSize,{class:this.options.className}))}),eo.create(n,m)}}})]}});var VZ=Es.create({name:"gapCursor",addProseMirrorPlugins(){return[CZ()]},extendNodeSchema(n){var t;const s={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(t=cs(Cr(n,"allowGapCursor",s)))!=null?t:null}}});Es.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new po({key:new ba("placeholder"),props:{decorations:({doc:n,selection:t})=>{const s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:l}=t,h=[];if(!s)return null;const m=this.editor.isEmpty;return n.descendants((b,i)=>{const A=l>=i&&l<=i+b.nodeSize,P=!b.isLeaf&&I1(b);if((A||!this.options.showOnlyCurrent)&&P){const D=[this.options.emptyNodeClass];m&&D.push(this.options.emptyEditorClass);const j=bl.node(i,i+b.nodeSize,{class:D.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:b,pos:i,hasAnchor:A}):this.options.placeholder});h.push(j)}return this.options.includeChildren}),eo.create(n,h)}}})]}});Es.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:t}=this;return[new po({key:new ba("selection"),props:{decorations(s){return s.selection.empty||n.isFocused||!n.isEditable||XO(s.selection)||n.view.dragging?null:eo.create(s.doc,[bl.inline(s.selection.from,s.selection.to,{class:t.className})])}}})]}});function Ak({types:n,node:t}){return t&&Array.isArray(n)&&n.includes(t.type)||t?.type===n}var UZ=Es.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const n=new ba(this.name),t=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(this.options.node).includes(s.name));return[new po({key:n,appendTransaction:(s,l,h)=>{const{doc:m,tr:b,schema:i}=h,A=n.getState(h),P=m.content.size,D=i.nodes[this.options.node];if(A)return b.insert(P,D.create())},state:{init:(s,l)=>{const h=l.tr.doc.lastChild;return!Ak({node:h,types:t})},apply:(s,l)=>{if(!s.docChanged)return l;const h=s.doc.lastChild;return!Ak({node:h,types:t})}}})]}}),$Z=Es.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:t})=>OL(n,t),redo:()=>({state:n,dispatch:t})=>LL(n,t)}},addProseMirrorPlugins(){return[FZ(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),HZ=Es.create({name:"starterKit",addExtensions(){var n,t,s,l;const h=[];return this.options.bold!==!1&&h.push(v7.configure(this.options.bold)),this.options.blockquote!==!1&&h.push(m7.configure(this.options.blockquote)),this.options.bulletList!==!1&&h.push(TL.configure(this.options.bulletList)),this.options.code!==!1&&h.push(S7.configure(this.options.code)),this.options.codeBlock!==!1&&h.push(C7.configure(this.options.codeBlock)),this.options.document!==!1&&h.push(A7.configure(this.options.document)),this.options.dropcursor!==!1&&h.push(BZ.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&h.push(VZ.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&h.push(I7.configure(this.options.hardBreak)),this.options.heading!==!1&&h.push(M7.configure(this.options.heading)),this.options.undoRedo!==!1&&h.push($Z.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&h.push(k7.configure(this.options.horizontalRule)),this.options.italic!==!1&&h.push(O7.configure(this.options.italic)),this.options.listItem!==!1&&h.push(EL.configure(this.options.listItem)),this.options.listKeymap!==!1&&h.push(PL.configure((n=this.options)==null?void 0:n.listKeymap)),this.options.link!==!1&&h.push(oZ.configure((t=this.options)==null?void 0:t.link)),this.options.orderedList!==!1&&h.push(RL.configure(this.options.orderedList)),this.options.paragraph!==!1&&h.push(gZ.configure(this.options.paragraph)),this.options.strike!==!1&&h.push(xZ.configure(this.options.strike)),this.options.text!==!1&&h.push(vZ.configure(this.options.text)),this.options.underline!==!1&&h.push(bZ.configure((s=this.options)==null?void 0:s.underline)),this.options.trailingNode!==!1&&h.push(UZ.configure((l=this.options)==null?void 0:l.trailingNode)),h}}),GZ=HZ,qZ=n=>{if(!n.children.length)return;const t=n.querySelectorAll("span");t&&t.forEach(s=>{var l,h;const m=s.getAttribute("style"),b=(h=(l=s.parentElement)==null?void 0:l.closest("span"))==null?void 0:h.getAttribute("style");s.setAttribute("style",`${b};${m}`)})},zL=dm.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:n=>n.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&qZ(n),{}):!1}]},renderHTML({HTMLAttributes:n}){return["span",So(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleTextStyle:n=>({commands:t})=>t.toggleMark(this.name,n),removeEmptyTextStyle:()=>({tr:n})=>{const{selection:t}=n;return n.doc.nodesBetween(t.from,t.to,(s,l)=>{if(s.isTextblock)return!0;s.marks.filter(h=>h.type===this.type).some(h=>Object.values(h.attrs).some(m=>!!m))||n.removeMark(l,l+s.nodeSize,this.type)}),!0}}}}),WZ=Es.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:n=>{var t;return(t=n.style.backgroundColor)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:n=>n.backgroundColor?{style:`background-color: ${n.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:n=>({chain:t})=>t().setMark("textStyle",{backgroundColor:n}).run(),unsetBackgroundColor:()=>({chain:n})=>n().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),jL=Es.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:n=>{var t;return(t=n.style.color)==null?void 0:t.replace(/['"]+/g,"")},renderHTML:n=>n.color?{style:`color: ${n.color}`}:{}}}}]},addCommands(){return{setColor:n=>({chain:t})=>t().setMark("textStyle",{color:n}).run(),unsetColor:()=>({chain:n})=>n().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),ZZ=Es.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:n=>n.style.fontFamily,renderHTML:n=>n.fontFamily?{style:`font-family: ${n.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:n=>({chain:t})=>t().setMark("textStyle",{fontFamily:n}).run(),unsetFontFamily:()=>({chain:n})=>n().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),XZ=Es.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:n=>n.style.fontSize,renderHTML:n=>n.fontSize?{style:`font-size: ${n.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:n=>({chain:t})=>t().setMark("textStyle",{fontSize:n}).run(),unsetFontSize:()=>({chain:n})=>n().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),KZ=Es.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:n=>n.style.lineHeight,renderHTML:n=>n.lineHeight?{style:`line-height: ${n.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:n=>({chain:t})=>t().setMark("textStyle",{lineHeight:n}).run(),unsetLineHeight:()=>({chain:n})=>n().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});Es.create({name:"textStyleKit",addExtensions(){const n=[];return this.options.backgroundColor!==!1&&n.push(WZ.configure(this.options.backgroundColor)),this.options.color!==!1&&n.push(jL.configure(this.options.color)),this.options.fontFamily!==!1&&n.push(ZZ.configure(this.options.fontFamily)),this.options.fontSize!==!1&&n.push(XZ.configure(this.options.fontSize)),this.options.lineHeight!==!1&&n.push(KZ.configure(this.options.lineHeight)),this.options.textStyle!==!1&&n.push(zL.configure(this.options.textStyle)),n}});var YZ=jL,_2="Popover",[FL,nK]=Eg(_2,[By]),Ix=By(),[JZ,fm]=FL(_2),BL=n=>{const{__scopePopover:t,children:s,open:l,defaultOpen:h,onOpenChange:m,modal:b=!1}=n,i=Ix(t),A=ee.useRef(null),[P,D]=ee.useState(!1),[j=!1,U]=Qp({prop:l,defaultProp:h,onChange:m});return v.jsx(WP,{...i,children:v.jsx(JZ,{scope:t,contentId:wf(),triggerRef:A,open:j,onOpenChange:U,onOpenToggle:ee.useCallback(()=>U(X=>!X),[U]),hasCustomAnchor:P,onCustomAnchorAdd:ee.useCallback(()=>D(!0),[]),onCustomAnchorRemove:ee.useCallback(()=>D(!1),[]),modal:b,children:s})})};BL.displayName=_2;var VL="PopoverAnchor",QZ=ee.forwardRef((n,t)=>{const{__scopePopover:s,...l}=n,h=fm(VL,s),m=Ix(s),{onCustomAnchorAdd:b,onCustomAnchorRemove:i}=h;return ee.useEffect(()=>(b(),()=>i()),[b,i]),v.jsx(s1,{...m,...l,ref:t})});QZ.displayName=VL;var UL="PopoverTrigger",$L=ee.forwardRef((n,t)=>{const{__scopePopover:s,...l}=n,h=fm(UL,s),m=Ix(s),b=us(t,h.triggerRef),i=v.jsx(ci.button,{type:"button","aria-haspopup":"dialog","aria-expanded":h.open,"aria-controls":h.contentId,"data-state":ZL(h.open),...l,ref:b,onClick:wr(n.onClick,h.onOpenToggle)});return h.hasCustomAnchor?i:v.jsx(s1,{asChild:!0,...m,children:i})});$L.displayName=UL;var x2="PopoverPortal",[eX,tX]=FL(x2,{forceMount:void 0}),HL=n=>{const{__scopePopover:t,forceMount:s,children:l,container:h}=n,m=fm(x2,t);return v.jsx(eX,{scope:t,forceMount:s,children:v.jsx(Mf,{present:s||m.open,children:v.jsx(_x,{asChild:!0,container:h,children:l})})})};HL.displayName=x2;var Ny="PopoverContent",GL=ee.forwardRef((n,t)=>{const s=tX(Ny,n.__scopePopover),{forceMount:l=s.forceMount,...h}=n,m=fm(Ny,n.__scopePopover);return v.jsx(Mf,{present:l||m.open,children:m.modal?v.jsx(nX,{...h,ref:t}):v.jsx(rX,{...h,ref:t})})});GL.displayName=Ny;var nX=ee.forwardRef((n,t)=>{const s=fm(Ny,n.__scopePopover),l=ee.useRef(null),h=us(t,l),m=ee.useRef(!1);return ee.useEffect(()=>{const b=l.current;if(b)return TT(b)},[]),v.jsx(d1,{as:Jp,allowPinchZoom:!0,children:v.jsx(qL,{...n,ref:h,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:wr(n.onCloseAutoFocus,b=>{b.preventDefault(),m.current||s.triggerRef.current?.focus()}),onPointerDownOutside:wr(n.onPointerDownOutside,b=>{const i=b.detail.originalEvent,A=i.button===0&&i.ctrlKey===!0,P=i.button===2||A;m.current=P},{checkForDefaultPrevented:!1}),onFocusOutside:wr(n.onFocusOutside,b=>b.preventDefault(),{checkForDefaultPrevented:!1})})})}),rX=ee.forwardRef((n,t)=>{const s=fm(Ny,n.__scopePopover),l=ee.useRef(!1),h=ee.useRef(!1);return v.jsx(qL,{...n,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:m=>{n.onCloseAutoFocus?.(m),m.defaultPrevented||(l.current||s.triggerRef.current?.focus(),m.preventDefault()),l.current=!1,h.current=!1},onInteractOutside:m=>{n.onInteractOutside?.(m),m.defaultPrevented||(l.current=!0,m.detail.originalEvent.type==="pointerdown"&&(h.current=!0));const b=m.target;s.triggerRef.current?.contains(b)&&m.preventDefault(),m.detail.originalEvent.type==="focusin"&&h.current&&m.preventDefault()}})}),qL=ee.forwardRef((n,t)=>{const{__scopePopover:s,trapFocus:l,onOpenAutoFocus:h,onCloseAutoFocus:m,disableOutsidePointerEvents:b,onEscapeKeyDown:i,onPointerDownOutside:A,onFocusOutside:P,onInteractOutside:D,...j}=n,U=fm(Ny,s),X=Ix(s);return ST(),v.jsx(u1,{asChild:!0,loop:!0,trapped:l,onMountAutoFocus:h,onUnmountAutoFocus:m,children:v.jsx(Ly,{asChild:!0,disableOutsidePointerEvents:b,onInteractOutside:D,onEscapeKeyDown:i,onPointerDownOutside:A,onFocusOutside:P,onDismiss:()=>U.onOpenChange(!1),children:v.jsx(uT,{"data-state":ZL(U.open),role:"dialog",id:U.contentId,...X,...j,ref:t,style:{...j.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),WL="PopoverClose",iX=ee.forwardRef((n,t)=>{const{__scopePopover:s,...l}=n,h=fm(WL,s);return v.jsx(ci.button,{type:"button",...l,ref:t,onClick:wr(n.onClick,()=>h.onOpenChange(!1))})});iX.displayName=WL;var sX="PopoverArrow",oX=ee.forwardRef((n,t)=>{const{__scopePopover:s,...l}=n,h=Ix(s);return v.jsx(hT,{...h,...l,ref:t})});oX.displayName=sX;function ZL(n){return n?"open":"closed"}var aX=BL,lX=$L,cX=HL,XL=GL;const Uw=aX,$w=lX,Jv=ee.forwardRef(({className:n,align:t="center",sideOffset:s=4,...l},h)=>v.jsx(cX,{children:v.jsx(XL,{ref:h,align:t,sideOffset:s,className:Ai("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...l})}));Jv.displayName=XL.displayName;const uX=({value:n,onChange:t,placeholder:s="Write your message here...",minHeight:l="200px"})=>{const h=ee.useRef(null),m=(j,U="")=>{if(!h.current)return;h.current.focus();const X=window.getSelection();if(!X||X.rangeCount===0)return;const Y=X.getRangeAt(0);if(j==="fontSize"){const W=document.createElement("span");if(W.style.fontSize=b(U),Y.collapsed)W.innerHTML="",Y.insertNode(W),Y.setStart(W,0),Y.setEnd(W,1);else try{Y.surroundContents(W)}catch{const de=Y.extractContents();W.appendChild(de),Y.insertNode(W)}}else if(j==="foreColor"){const W=document.createElement("span");if(W.style.color=U,Y.collapsed)W.innerHTML="",Y.insertNode(W),Y.setStart(W,0),Y.setEnd(W,1);else try{Y.surroundContents(W)}catch{const de=Y.extractContents();W.appendChild(de),Y.insertNode(W)}}else document.execCommand(j,!1,U);X.removeAllRanges(),X.addRange(Y),setTimeout(()=>{h.current&&t(h.current.innerHTML)},10)},b=j=>({1:"10px",2:"13px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"})[j]||"16px",i=()=>{if(h.current){const j=window.getSelection(),U=j?.rangeCount?j.getRangeAt(0):null,X=U?.startOffset,Y=U?.endOffset,W=U?.startContainer,re=U?.endContainer;if(t(h.current.innerHTML),j&&U&&W&&re)try{const de=document.createRange();de.setStart(W,X||0),de.setEnd(re,Y||0),j.removeAllRanges(),j.addRange(de)}catch{const Me=document.createRange();Me.selectNodeContents(h.current),Me.collapse(!1),j.removeAllRanges(),j.addRange(Me)}}},A=[{label:"Black",value:"#000000"},{label:"Dark Gray",value:"#444444"},{label:"Gray",value:"#888888"},{label:"Red",value:"#ff0000"},{label:"Orange",value:"#ff9900"},{label:"Yellow",value:"#ffff00"},{label:"Green",value:"#00ff00"},{label:"Cyan",value:"#00ffff"},{label:"Blue",value:"#0000ff"},{label:"Purple",value:"#9900ff"},{label:"White",value:"#ffffff"}],P=[{label:"Small",value:"1"},{label:"Normal",value:"3"},{label:"Large",value:"5"},{label:"Extra Large",value:"7"}],D=["","","","","","","","","","","","",""];return v.jsxs("div",{className:"border rounded-lg shadow-sm overflow-hidden bg-card",children:[v.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 p-2.5 border-b bg-muted/50",children:[v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("bold"),title:"Bold",children:v.jsx(xB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("italic"),title:"Italic",children:v.jsx(PB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("underline"),title:"Underline",children:v.jsx(WB,{className:"h-4 w-4"})}),v.jsx("span",{className:"mx-1.5 text-muted-foreground/30",children:"|"}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("justifyLeft"),title:"Align Left",children:v.jsx(yB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("justifyCenter"),title:"Align Center",children:v.jsx(gB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("justifyRight"),title:"Align Right",children:v.jsx(_B,{className:"h-4 w-4"})}),v.jsx("span",{className:"mx-1.5 text-muted-foreground/30",children:"|"}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("insertUnorderedList"),title:"Bullet List",children:v.jsx(DB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("insertOrderedList"),title:"Numbered List",children:v.jsx(NB,{className:"h-4 w-4"})}),v.jsx("span",{className:"mx-1.5 text-muted-foreground/30",children:"|"}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const j=prompt("Enter link URL:");j&&m("createLink",j)},title:"Insert Link",children:v.jsx(RB,{className:"h-4 w-4"})}),v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{const j=prompt("Enter image URL:");j&&m("insertImage",j)},title:"Insert Image",children:v.jsx(MB,{className:"h-4 w-4"})}),v.jsx("span",{className:"mx-1.5 text-muted-foreground/30",children:"|"}),v.jsxs(Uw,{children:[v.jsx($w,{asChild:!0,children:v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"Font Size",children:v.jsx(qB,{className:"h-4 w-4"})})}),v.jsx(Jv,{className:"w-auto p-2 bg-background border shadow-md z-50",children:v.jsx("div",{className:"flex flex-col gap-1",children:P.map(j=>v.jsx(on,{variant:"ghost",size:"sm",className:"justify-start hover:bg-accent",onClick:()=>{m("fontSize",j.value)},children:v.jsx("span",{style:{fontSize:`${parseInt(j.value)*.25}rem`},children:j.label})},j.value))})})]}),v.jsxs(Uw,{children:[v.jsx($w,{asChild:!0,children:v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"Text Color",children:v.jsx("div",{className:"h-4 w-4 rounded-full border border-border",style:{background:"linear-gradient(45deg, #ff0000, #00ff00, #0000ff)"}})})}),v.jsx(Jv,{className:"w-auto p-2 bg-background border shadow-md z-50",children:v.jsx("div",{className:"grid grid-cols-6 gap-1",children:A.map(j=>v.jsx(on,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 rounded-md hover:scale-110 transition-transform",style:{backgroundColor:j.value,border:j.value==="#ffffff"?"1px solid #e5e7eb":"none"},onClick:()=>{m("foreColor",j.value)},title:j.label},j.value))})})]}),v.jsxs(Uw,{children:[v.jsx($w,{asChild:!0,children:v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",title:"Emoji",children:v.jsx(UB,{className:"h-4 w-4"})})}),v.jsx(Jv,{className:"w-auto p-2 bg-background border shadow-md z-50",children:v.jsx("div",{className:"grid grid-cols-5 gap-1",children:D.map(j=>v.jsx(on,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 hover:bg-accent text-lg",onClick:()=>{if(h.current){h.current.focus();const U=window.getSelection();if(U&&U.rangeCount>0){const X=U.getRangeAt(0),Y=document.createTextNode(j);X.insertNode(Y),X.setStartAfter(Y),X.collapse(!0),U.removeAllRanges(),U.addRange(X)}else h.current.appendChild(document.createTextNode(j));t(h.current.innerHTML)}},children:j},j))})})]})]}),v.jsx("div",{ref:h,contentEditable:!0,className:"p-6 focus:outline-none prose prose-sm max-w-none",style:{minHeight:l,fontSize:"15px",lineHeight:"1.6"},onInput:j=>{h.current&&t(h.current.innerHTML)},onBlur:i,onFocus:j=>{if(!j.currentTarget.innerHTML||j.currentTarget.innerHTML===`<p>${s}</p>`){j.currentTarget.innerHTML="<p><br></p>";const U=window.getSelection(),X=document.createRange();X.setStart(j.currentTarget.firstChild?.firstChild||j.currentTarget,0),X.collapse(!0),U?.removeAllRanges(),U?.addRange(X)}},onKeyDown:j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),document.execCommand("insertHTML",!1,"<br><br>"))},suppressContentEditableWarning:!0,dangerouslySetInnerHTML:{__html:n}})]})},hX=({isOpen:n,onClose:t,onSubmit:s,blogPost:l})=>{const[h,m]=ee.useState({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""});ee.useEffect(()=>{l?(m({title:l.title,excerpt:l.excerpt,content:l.content,author:l.author,category:l.category,publishDate:l.publishDate,tags:l.tags.join(", "),image:l.image}),P(l.image)):m({title:"",excerpt:"",content:"",author:"",category:"",publishDate:"",tags:"",image:""})},[l,n]);const b=u7({extensions:[GZ,zL,YZ],content:h.content,onUpdate:({editor:D})=>{m(j=>({...j,content:D.getHTML()}))}}),i=async D=>{D.preventDefault();const j=h.tags.split(",").map(U=>U.trim()).filter(U=>U);s({title:h.title,excerpt:h.excerpt,content:h.content,author:h.author,category:h.category,publishDate:h.publishDate,tags:j,image:h.image}),t()},[A,P]=ee.useState("");return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Blog Post":"Add New Blog Post"})}),v.jsxs("form",{onSubmit:i,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"title",children:"Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:D=>m(j=>({...j,title:D.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"excerpt",children:"Excerpt"}),v.jsx(fo,{id:"excerpt",value:h.excerpt,onChange:D=>m(j=>({...j,excerpt:D.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"content",children:"Content"}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"content",children:"Content *"}),v.jsx(uX,{value:h.content,onChange:D=>m(j=>({...j,content:D})),minHeight:"250px"})]}),v.jsx("div",{className:"border rounded min-h-[120px] p-2 bg-white",children:v.jsx(r7,{editor:b})})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"author",children:"Author"}),v.jsx(Jn,{id:"author",value:h.author,onChange:D=>m(j=>({...j,author:D.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"category",children:"Category"}),v.jsx(Jn,{id:"category",value:h.category,onChange:D=>m(j=>({...j,category:D.target.value})),required:!0})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"publishDate",children:"Publish Date"}),v.jsx(Jn,{id:"publishDate",type:"date",value:h.publishDate,onChange:D=>m(j=>({...j,publishDate:D.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"tags",children:"Tags (comma-separated)"}),v.jsx(Jn,{id:"tags",value:h.tags,onChange:D=>m(j=>({...j,tags:D.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"image",children:"Image URL"}),v.jsx(Jn,{id:"image",type:"url",value:h.image,onChange:D=>{m(j=>({...j,image:D.target.value})),P(D.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),A&&v.jsx("img",{src:A,alt:"Preview",className:"w-24 h-24 object-cover rounded border mt-2"})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsxs(on,{type:"submit",children:[l?"Update":"Add"," Blog Post"]}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},dX=({isOpen:n,onClose:t,onSubmit:s,event:l})=>{const[h,m]=ee.useState({title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,date:l.date,time:l.time,location:l.location,type:l.type,image:l.image,registrationUrl:l.registrationUrl}:{title:"",description:"",date:"",time:"",location:"",type:"workshop",image:"",registrationUrl:""})},[l,n]);const b=i=>{i.preventDefault(),s(h),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Event":"Add New Event"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"title",children:"Event Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"date",children:"Date"}),v.jsx(Jn,{id:"date",type:"date",value:h.date,onChange:i=>m(A=>({...A,date:i.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"time",children:"Time"}),v.jsx(Jn,{id:"time",type:"time",value:h.time,onChange:i=>m(A=>({...A,time:i.target.value})),required:!0})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"location",children:"Location"}),v.jsx(Jn,{id:"location",value:h.location,onChange:i=>m(A=>({...A,location:i.target.value})),placeholder:"Physical address or virtual link",required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"type",children:"Event Type"}),v.jsxs(Af,{value:h.type,onValueChange:i=>m(A=>({...A,type:i})),children:[v.jsx(gd,{children:v.jsx(If,{})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"workshop",children:"Workshop"}),v.jsx(ms,{value:"webinar",children:"Webinar"}),v.jsx(ms,{value:"networking",children:"Networking"}),v.jsx(ms,{value:"pitch",children:"Pitch Event"})]})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"image",children:"Image URL"}),v.jsx(Jn,{id:"image",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://example.com/image.jpg"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"registrationUrl",children:"Registration URL"}),v.jsx(Jn,{id:"registrationUrl",value:h.registrationUrl,onChange:i=>m(A=>({...A,registrationUrl:i.target.value})),placeholder:"https://eventbrite.com/your-event",required:!0})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsxs(on,{type:"submit",children:[l?"Update":"Add"," Event"]}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},fX=({isOpen:n,onClose:t,onSubmit:s,resource:l})=>{const[h,m]=ee.useState({title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""});ee.useEffect(()=>{m(l?{title:l.title,description:l.description,type:l.type,category:l.category,downloadUrl:l.downloadUrl,image:l.image,tags:l.tags.join(", ")}:{title:"",description:"",type:"guide",category:"",downloadUrl:"",image:"",tags:""})},[l,n]);const b=i=>{i.preventDefault();const A=h.tags.split(",").map(P=>P.trim()).filter(P=>P);s({title:h.title,description:h.description,type:h.type,category:h.category,downloadUrl:h.downloadUrl,image:h.image,tags:A}),t()};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Resource":"Add New Resource"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"title",children:"Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:i=>m(A=>({...A,title:i.target.value})),required:!0})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"category",children:"Category"}),v.jsx(Jn,{id:"category",value:h.category,onChange:i=>m(A=>({...A,category:i.target.value})),required:!0})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:i=>m(A=>({...A,description:i.target.value})),required:!0})]}),v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"type",children:"Type"}),v.jsxs(Af,{value:h.type,onValueChange:i=>m(A=>({...A,type:i})),children:[v.jsx(gd,{children:v.jsx(If,{})}),v.jsxs(yd,{children:[v.jsx(ms,{value:"pitch-deck",children:"Pitch Deck"}),v.jsx(ms,{value:"financial-model",children:"Financial Model"}),v.jsx(ms,{value:"presentation",children:"Presentation"}),v.jsx(ms,{value:"guide",children:"Guide"})]})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"downloadUrl",children:"Link Redirection URL"}),v.jsx(Jn,{id:"downloadUrl",value:h.downloadUrl,onChange:i=>m(A=>({...A,downloadUrl:i.target.value})),placeholder:"https://www.hubspot.fr/",required:!0})]})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"image",children:"Image URL"}),v.jsx(Jn,{id:"image",value:h.image,onChange:i=>m(A=>({...A,image:i.target.value})),placeholder:"https://example.com/image.jpg"})]}),v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"tags",children:"Tags (comma-separated)"}),v.jsx(Jn,{id:"tags",value:h.tags,onChange:i=>m(A=>({...A,tags:i.target.value})),placeholder:"e.g., startup, tech, innovation"})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsxs(on,{type:"submit",children:[l?"Update":"Add"," Resource"]}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},pX=({isOpen:n,onClose:t,onSubmit:s,member:l})=>{const[h,m]=ee.useState({name:l?.name||"",position:l?.position||"",bio:l?.bio||"",image:l?.image||"",linkedin_url:l?.linkedin_url||""});ee.useEffect(()=>{l?(m({name:l.name||"",position:l.position||"",bio:l.bio||"",image:l.image||"",linkedin_url:l.linkedin_url||""}),A(l.image||"")):(m({name:"",position:"",bio:"",image:"",linkedin_url:""}),A(""))},[l,n]),ee.useEffect(()=>{A(h.image)},[h.image]);const b=async P=>{P.preventDefault();let D=h.image;s({name:h.name,position:h.position,bio:h.bio,image:D,linkedin_url:h.linkedin_url||null}),t()},[i,A]=ee.useState(h.image);return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl",children:[v.jsx(Ba,{children:v.jsx(Va,{children:l?"Edit Team Member":"Add New Team Member"})}),v.jsxs("form",{onSubmit:b,className:"space-y-4",children:[v.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"name",children:"Name"}),v.jsx(Jn,{id:"name",value:h.name,onChange:P=>m(D=>({...D,name:P.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"position",children:"Position"}),v.jsx(Jn,{id:"position",value:h.position,onChange:P=>m(D=>({...D,position:P.target.value}))})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"bio",children:"Bio"}),v.jsx(fo,{id:"bio",value:h.bio,onChange:P=>m(D=>({...D,bio:P.target.value}))})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"image",children:"Profile Image URL"}),v.jsx(Jn,{id:"image",type:"url",value:h.image,onChange:P=>{m(D=>({...D,image:P.target.value})),A(P.target.value)},placeholder:"https://example.com/image.jpg",required:!l}),i&&v.jsx("img",{src:i,alt:"Preview",className:"w-24 h-24 object-cover rounded-full border mt-2"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"linkedIn",children:"LinkedIn URL (optional)"}),v.jsx(Jn,{id:"linkedIn",type:"url",value:h.linkedin_url,onChange:P=>m(D=>({...D,linkedin_url:P.target.value})),placeholder:"https://linkedin.com/in/username"})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:l?"Update Member":"Add Member"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})},mX=({isOpen:n,onClose:t,onSubmit:s,currentSettings:l})=>{const[h,m]=ee.useState({heroType:l.heroType??"image",heroImage:l.heroImage??"",heroVideoUrl:l.heroVideoUrl??"",companiesText:l.runningTextCompanies.join(`
`),collaborators:[]});ee.useEffect(()=>{n&&(fetch("http://localhost:3000/api/collaborators").then(Y=>Y.json()).then(Y=>{m(W=>({...W,collaborators:Y}))}).catch(Y=>{console.error("Failed to load collaborators:",Y)}),fetch("http://localhost:3000/api/running-text").then(Y=>Y.json()).then(Y=>{m(W=>({...W,companiesText:Y.join(`
`)}))}),fetch("http://localhost:3000/api/style-settings").then(Y=>Y.json()).then(Y=>{m(W=>({...W,heroType:Y.hero_type,heroImage:Y.hero_image,heroVideoUrl:Y.hero_video_url,imagePreview:Y.hero_image})),D(Y.hero_image)}))},[n]);const b=async Y=>{Y.preventDefault();let W=h.heroImage;try{await fetch("http://localhost:3000/api/style-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({heroType:h.heroType,heroImage:W,heroVideoUrl:h.heroVideoUrl})})}catch(re){console.error("Failed to update hero section settings:",re)}try{await fetch("http://localhost:3000/api/running-text",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({companies:h.companiesText.split(`
`).map(re=>re.trim()).filter(re=>re!=="")})})}catch(re){console.error("Failed to update running text companies:",re)}for(const re of h.collaborators)try{const de=`http://localhost:3000/api/collaborators${re.id?`/${re.id}`:""}`,Me=re.id?"PUT":"POST";if(!(await fetch(de,{method:Me,headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})).ok)throw new Error(`Failed to ${Me==="POST"?"create":"update"} collaborator`)}catch(de){console.error("Collaborator save error:",de)}s({heroType:h.heroType,heroImage:W,heroVideoUrl:h.heroVideoUrl,runningTextCompanies:h.companiesText.split(`
`).map(re=>re.trim()).filter(re=>re!==""),collaborators:h.collaborators}),t()},[i,A]=ee.useState(null),[P,D]=ee.useState(l.heroImage),j=(Y,W,re)=>{m(de=>{const Me=[...de.collaborators];return Me[Y]={...Me[Y],[W]:re},{...de,collaborators:Me}})},U=()=>{m(Y=>({...Y,collaborators:[...Y.collaborators,{name:"",logo:"",website:""}]}))},X=async Y=>{const W=h.collaborators[Y];if(W.id)try{await fetch(`http://localhost:3000/api/collaborators/${W.id}`,{method:"DELETE"})}catch(re){console.error("Failed to delete collaborator:",re)}m(re=>{const de=[...re.collaborators];return de.splice(Y,1),{...re,collaborators:de}})};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:"Style Management"})}),v.jsxs("form",{onSubmit:b,className:"space-y-6",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsxs("div",{children:[v.jsx(rn,{children:"Hero Section Type"}),v.jsxs("select",{value:h.heroType,onChange:Y=>m(W=>({...W,heroType:Y.target.value})),className:"w-full mt-1 border border-input rounded px-3 py-2",children:[v.jsx("option",{value:"image",children:"Image"}),v.jsx("option",{value:"video",children:"YouTube Video"})]})]}),h.heroType==="image"&&v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"heroImage",children:"Hero Section Image URL"}),v.jsx(Jn,{id:"heroImage",type:"url",value:h.heroImage,onChange:Y=>{m(W=>({...W,heroImage:Y.target.value})),D(Y.target.value)},placeholder:"https://example.com/hero.jpg"}),P&&v.jsx("img",{src:P,alt:"Preview",className:"w-full h-32 object-cover rounded-lg border mt-2"})]}),h.heroType==="video"&&v.jsxs("div",{children:[v.jsx(rn,{htmlFor:"heroVideoUrl",children:"YouTube Video URL"}),v.jsx(Jn,{id:"heroVideoUrl",type:"url",value:h.heroVideoUrl,onChange:Y=>m(W=>({...W,heroVideoUrl:Y.target.value})),placeholder:"https://www.youtube.com/watch?v=...",required:!0})]})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"companies",children:"Running Text Companies (one per line)"}),v.jsx(fo,{id:"companies",value:h.companiesText,onChange:Y=>m(W=>({...W,companiesText:Y.target.value})),placeholder:`Company Name 1
Company Name 2
Company Name 3`,rows:4,required:!0}),v.jsx("p",{className:"text-sm text-gray-500",children:"Enter each company/investor name on a new line. These will appear in the running text above the mission section."})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{children:"Collaborators"}),h.collaborators.map((Y,W)=>v.jsxs("div",{className:"flex flex-col md:flex-row gap-2 mb-4 border p-3 rounded-md",children:[v.jsx(Jn,{placeholder:"Name",value:Y.name,onChange:re=>j(W,"name",re.target.value)}),v.jsx(Jn,{placeholder:"Logo URL",value:Y.logo,onChange:re=>j(W,"logo",re.target.value)}),v.jsx(Jn,{placeholder:"Website URL",value:Y.website,onChange:re=>j(W,"website",re.target.value)}),v.jsx(on,{type:"button",variant:"destructive",onClick:()=>X(W),children:"Remove"})]},W)),v.jsx(on,{type:"button",variant:"outline",onClick:U,children:"Add Collaborator"})]}),v.jsxs("div",{className:"flex gap-2 pt-4",children:[v.jsx(on,{type:"submit",className:"flex-1",children:"Update Style Settings"}),v.jsx(on,{type:"button",variant:"outline",onClick:t,children:"Cancel"})]})]})]})})};var v2="Switch",[gX,rK]=Eg(v2),[yX,_X]=gX(v2),KL=ee.forwardRef((n,t)=>{const{__scopeSwitch:s,name:l,checked:h,defaultChecked:m,required:b,disabled:i,value:A="on",onCheckedChange:P,form:D,...j}=n,[U,X]=ee.useState(null),Y=us(t,Fe=>X(Fe)),W=ee.useRef(!1),re=U?D||!!U.closest("form"):!0,[de=!1,Me]=Qp({prop:h,defaultProp:m,onChange:P});return v.jsxs(yX,{scope:s,checked:de,disabled:i,children:[v.jsx(ci.button,{type:"button",role:"switch","aria-checked":de,"aria-required":b,"data-state":QL(de),"data-disabled":i?"":void 0,disabled:i,value:A,...j,ref:Y,onClick:wr(n.onClick,Fe=>{Me(ht=>!ht),re&&(W.current=Fe.isPropagationStopped(),W.current||Fe.stopPropagation())})}),re&&v.jsx(xX,{control:U,bubbles:!W.current,name:l,value:A,checked:de,required:b,disabled:i,form:D,style:{transform:"translateX(-100%)"}})]})});KL.displayName=v2;var YL="SwitchThumb",JL=ee.forwardRef((n,t)=>{const{__scopeSwitch:s,...l}=n,h=_X(YL,s);return v.jsx(ci.span,{"data-state":QL(h.checked),"data-disabled":h.disabled?"":void 0,...l,ref:t})});JL.displayName=YL;var xX=n=>{const{control:t,checked:s,bubbles:l=!0,...h}=n,m=ee.useRef(null),b=rN(s),i=zP(t);return ee.useEffect(()=>{const A=m.current,P=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(P,"checked").set;if(b!==s&&j){const U=new Event("click",{bubbles:l});j.call(A,s),A.dispatchEvent(U)}},[b,s,l]),v.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...h,tabIndex:-1,ref:m,style:{...n.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function QL(n){return n?"checked":"unchecked"}var ez=KL,vX=JL;const Sy=ee.forwardRef(({className:n,...t},s)=>v.jsx(ez,{className:Ai("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...t,ref:s,children:v.jsx(vX,{className:Ai("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Sy.displayName=ez.displayName;const bX=({open:n,onOpenChange:t})=>{const[s,l]=ee.useState(null),[h,m]=ee.useState({title:"",subject:"",description:"",image:"",link:"",isActive:!0}),[b,i]=ee.useState(!1);ee.useEffect(()=>{n&&A()},[n]);const A=async()=>{try{const j=await rl.getPopup();j&&(l(j),m({title:j.title,subject:j.subject,description:j.description,image:j.image,link:j.link,isActive:j.isActive}))}catch(j){console.error("Error fetching popup:",j)}},P=(j,U)=>{m(X=>({...X,[j]:U}))},D=async j=>{j.preventDefault(),i(!0);try{await fetch("https://betawaves-back.4bzwio.easypanel.host/api/popup/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:h.title,subject:h.subject,description:h.description,link:h.link,isActive:h.isActive,existingImage:h.image})}),t(!1)}catch(U){console.error("Popup update failed",U)}finally{i(!1)}};return v.jsx(ol,{open:n,onOpenChange:t,children:v.jsxs(Fa,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[v.jsx(Ba,{children:v.jsx(Va,{children:"Manage Welcome Popup"})}),v.jsxs("form",{onSubmit:D,className:"space-y-6",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"title",children:"Title"}),v.jsx(Jn,{id:"title",value:h.title,onChange:j=>P("title",j.target.value),placeholder:"Enter popup title",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"subject",children:"Subject"}),v.jsx(Jn,{id:"subject",value:h.subject,onChange:j=>P("subject",j.target.value),placeholder:"Enter popup subject",required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"description",children:"Description"}),v.jsx(fo,{id:"description",value:h.description,onChange:j=>P("description",j.target.value),placeholder:"Enter popup description",rows:4,required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"image",children:"Image URL"}),v.jsx(Jn,{id:"image",type:"url",value:h.image,onChange:j=>P("image",j.target.value),placeholder:"https://example.com/image.jpg",required:!0}),h.image&&v.jsx("img",{src:h.image,alt:"Popup preview",className:"w-full h-40 object-cover rounded-md"})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"link",children:"Link (Get Started Button)"}),v.jsx(Jn,{id:"link",value:h.link,onChange:j=>P("link",j.target.value),placeholder:"Enter destination URL",required:!0})]}),v.jsxs("div",{className:"flex items-center space-x-2",children:[v.jsx(Sy,{id:"isActive",checked:h.isActive,onCheckedChange:j=>P("isActive",!!j)}),v.jsx(rn,{htmlFor:"isActive",children:"Active"})]}),v.jsxs("div",{className:"flex gap-4 pt-4",children:[v.jsx(on,{type:"submit",disabled:b,className:"flex-1",children:b?"Saving...":"Save Popup"}),v.jsx(on,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"})]})]})]})})},wX=()=>{const{admins:n,currentAdmin:t,createAdmin:s,deleteAdmin:l}=wx(),[h,m]=ee.useState(!1),[b,i]=ee.useState({username:"",email:"",password:"",confirmPassword:""}),[A,P]=ee.useState(""),D=U=>{if(U.preventDefault(),P(""),b.password!==b.confirmPassword){P("Passwords do not match");return}if(b.password.length<6){P("Password must be at least 6 characters");return}s(b.username,b.email,b.password)?(i({username:"",email:"",password:"",confirmPassword:""}),m(!1)):P("Username already exists")},j=U=>{window.confirm("Are you sure you want to delete this admin account?")&&(l(U)||alert("Cannot delete currently logged in admin"))};return v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Admin Accounts"}),v.jsxs(ol,{open:h,onOpenChange:m,children:[v.jsx(MT,{asChild:!0,children:v.jsxs(on,{children:[v.jsx(ZB,{className:"mr-2 h-4 w-4"}),"Create Admin"]})}),v.jsxs(Fa,{children:[v.jsx(Ba,{children:v.jsx(Va,{children:"Create New Admin Account"})}),v.jsxs("form",{onSubmit:D,className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"username",children:"Username"}),v.jsx(Jn,{id:"username",value:b.username,onChange:U=>i(X=>({...X,username:U.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"email",children:"Email"}),v.jsx(Jn,{id:"email",type:"email",value:b.email,onChange:U=>i(X=>({...X,email:U.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"password",children:"Password"}),v.jsx(Jn,{id:"password",type:"password",value:b.password,onChange:U=>i(X=>({...X,password:U.target.value})),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"confirmPassword",children:"Confirm Password"}),v.jsx(Jn,{id:"confirmPassword",type:"password",value:b.confirmPassword,onChange:U=>i(X=>({...X,confirmPassword:U.target.value})),required:!0})]}),A&&v.jsx("p",{className:"text-red-500 text-sm",children:A}),v.jsxs("div",{className:"flex gap-2",children:[v.jsx(on,{type:"submit",className:"flex-1",children:"Create Admin"}),v.jsx(on,{type:"button",variant:"outline",onClick:()=>m(!1),children:"Cancel"})]})]})]})]})]})}),v.jsx(Qr,{children:v.jsx("div",{className:"space-y-4",children:n.map(U=>v.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[v.jsx("div",{className:"flex items-center gap-4",children:v.jsxs("div",{children:[v.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[U.username,t?.id===U.id&&v.jsx(_a,{variant:"default",children:"Current User"})]}),v.jsx("p",{className:"text-sm text-gray-600",children:U.email}),v.jsxs("p",{className:"text-xs text-gray-500",children:["Created: ",new Date(U.createdAt).toLocaleDateString()]})]})}),t?.id!==U.id&&v.jsx(on,{variant:"destructive",size:"sm",onClick:()=>j(U.id),children:v.jsx(Kw,{className:"h-4 w-4"})})]},U.id))})})]})},Bv="https://betawaves-back.4bzwio.easypanel.host/api";class uu extends Error{constructor(t,s){super(t),this.status=s,this.name="APIError"}}const ki={async get(n){try{const t=await fetch(`${Bv}${n}`);if(!t.ok)throw new uu(`HTTP error! status: ${t.status}`,t.status);return await t.json()}catch(t){throw t instanceof uu?t:new uu("Network error occurred")}},async post(n,t){try{const s=await fetch(`${Bv}${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new uu(`HTTP error! status: ${s.status}`,s.status);return await s.json()}catch(s){throw s instanceof uu?s:new uu("Network error occurred")}},async put(n,t){try{const s=await fetch(`${Bv}${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new uu(`HTTP error! status: ${s.status}`,s.status);return await s.json()}catch(s){throw s instanceof uu?s:new uu("Network error occurred")}},async delete(n){try{const t=await fetch(`${Bv}${n}`,{method:"DELETE"});if(!t.ok)throw new uu(`HTTP error! status: ${t.status}`,t.status);return await t.json()}catch(t){throw t instanceof uu?t:new uu("Network error occurred")}}},SX=n=>({id:n.id.toString(),title:n.title,description:n.description,features:typeof n.features=="string"?JSON.parse(n.features):n.features,icon:n.icon,eligibility:n.eligibility,category:n.category,directUrl:n.direct_url||void 0}),Ik=n=>({title:n.title,description:n.description,features:JSON.stringify(n.features),icon:n.icon,eligibility:n.eligibility,category:n.category,directUrl:n.directUrl??null}),TX=n=>({id:n.id.toString(),title:n.title,description:n.description,features:typeof n.features=="string"?JSON.parse(n.features):n.features,icon:n.icon,duration:n.duration,eligibility:n.eligibility,category:n.category,presentationUrl:n.presentation_url||void 0}),Mk=n=>({title:n.title,description:n.description,features:JSON.stringify(n.features),icon:n.icon,duration:n.duration,eligibility:n.eligibility,category:n.category,presentation_url:n.presentationUrl||null}),EX=n=>({id:n.id.toString(),name:n.name,description:n.description,category:n.category,price:n.price,features:typeof n.features=="string"?JSON.parse(n.features):n.features,image:n.image,status:n.status}),kk=n=>({name:n.name,description:n.description,category:n.category,price:n.price,features:JSON.stringify(n.features),image:n.image,status:n.status}),CX=n=>({id:n.id.toString(),name:n.name,description:n.description,totalSize:n.total_size,currentRaise:n.current_raise,targetCompanies:n.target_companies,stage:n.stage,sectors:typeof n.sectors=="string"?JSON.parse(n.sectors):n.sectors,status:n.status}),Pk=n=>({name:n.name,description:n.description,total_size:n.totalSize,current_raise:n.currentRaise,target_companies:n.targetCompanies,stage:n.stage,sectors:JSON.stringify(n.sectors),status:n.status}),AX=n=>({id:n.id.toString(),companyName:n.company_name,industry:n.industry,description:n.description,challenge:n.challenge,solution:n.solution,results:typeof n.results=="string"?JSON.parse(n.results):n.results,image:n.image,testimonial:typeof n.testimonial=="string"?JSON.parse(n.testimonial):n.testimonial,tags:typeof n.tags=="string"?JSON.parse(n.tags):n.tags}),Rk=n=>({company_name:n.companyName,industry:n.industry,description:n.description,challenge:n.challenge,solution:n.solution,results:JSON.stringify(n.results),image:n.image,testimonial:JSON.stringify(n.testimonial),tags:JSON.stringify(n.tags)}),IX=n=>({id:n.id.toString(),title:n.title,excerpt:n.excerpt,content:n.content,author:n.author,publishDate:n.publish_date,image:n.image,category:n.category,tags:typeof n.tags=="string"?JSON.parse(n.tags):n.tags}),Nk=n=>({title:n.title,excerpt:n.excerpt,content:n.content,author:n.author,publish_date:n.publishDate,image:n.image,category:n.category,tags:JSON.stringify(n.tags)}),MX=n=>({id:n.id.toString(),title:n.title,description:n.description,type:n.type,category:n.category,downloadUrl:n.download_url,image:n.image,tags:typeof n.tags=="string"?JSON.parse(n.tags):n.tags}),Dk=n=>({title:n.title,description:n.description,type:n.type,category:n.category,download_url:n.downloadUrl,image:n.image,tags:JSON.stringify(n.tags)}),kX=n=>({id:n.id.toString(),title:n.title,description:n.description,date:n.date,time:n.time,location:n.location,type:n.type,image:n.image,registrationUrl:n.registration_url}),Ok=n=>({title:n.title,description:n.description,date:n.date,time:n.time,location:n.location,type:n.type,image:n.image,registration_url:n.registrationUrl}),PX=n=>({id:n.id.toString(),name:n.name,email:n.email,subject:n.subject,message:n.message,timestamp:n.timestamp,status:n.status}),RX=n=>({id:n.id.toString(),name:n.name,position:n.position,bio:n.bio,image:n.image,linkedin_url:n.linkedin_url||void 0}),Lk=n=>({name:n.name,position:n.position,bio:n.bio,image:n.image,linkedin_url:n.linkedin_url||null}),NX=()=>{const[n,t]=ee.useState(!1),[s,l]=ee.useState(!1),[h,m]=ee.useState(!1),[b,i]=ee.useState(!1),[A,P]=ee.useState(!1),[D,j]=ee.useState(!1),[U,X]=ee.useState(!1),[Y,W]=ee.useState(!1),[re,de]=ee.useState(!1),[Me,Fe]=ee.useState(!1),[ht,at]=ee.useState(!1),[Dt,kt]=ee.useState(!1),[Rt,fn]=ee.useState(),[En,xn]=ee.useState(),[Tn,Bn]=ee.useState(),[Ft,wn]=ee.useState(),[Yt,Cn]=ee.useState(),[gt,Jt]=ee.useState(),[Ht,qe]=ee.useState(),[Ct,Pn]=ee.useState(),[Zn,Nn]=ee.useState(),{isAdminLoggedIn:cn,logout:un,loading:$n}=wx(),An=c1(),Fn=yT(),{data:Zr=[]}=ah({queryKey:["services"],queryFn:async()=>(await ki.get("/services")).map(TX),enabled:cn}),{data:ni=[]}=ah({queryKey:["consulting"],queryFn:async()=>(await ki.get("/consulting")).map(SX),enabled:cn}),{data:Or=[]}=ah({queryKey:["products"],queryFn:async()=>(await ki.get("/products")).map(EX),enabled:cn}),{data:vs=[]}=ah({queryKey:["funds"],queryFn:async()=>(await ki.get("/funds")).map(CX),enabled:cn}),{data:$s=[]}=ah({queryKey:["case-studies"],queryFn:async()=>(await ki.get("/case-studies")).map(AX),enabled:cn}),{data:Hi=[]}=ah({queryKey:["blog-posts"],queryFn:async()=>(await ki.get("/blog-posts")).map(IX),enabled:cn}),{data:mo=[]}=ah({queryKey:["events"],queryFn:async()=>(await ki.get("/events")).map(kX),enabled:cn}),{data:El=[]}=ah({queryKey:["program-applications"],queryFn:async()=>await ki.get("/program-applications"),enabled:cn}),{data:zi=[]}=ah({queryKey:["resources"],queryFn:async()=>(await ki.get("/resources")).map(MX),enabled:cn}),{data:Ki=[]}=ah({queryKey:["team-members"],queryFn:async()=>(await ki.get("/team-members")).map(RX),enabled:cn}),{data:to=[]}=ah({queryKey:["contact-messages"],queryFn:async()=>(await ki.get("/contact-messages")).map(PX),enabled:cn}),Qo=ps({mutationFn:ke=>ki.post("/services",Mk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["services"]}),xr({title:"Service created successfully"})},onError:()=>{xr({title:"Failed to create service",variant:"destructive"})}}),To=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/services/${ke}`,Mk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["services"]}),xr({title:"Service updated successfully"})},onError:()=>{xr({title:"Failed to update service",variant:"destructive"})}}),Cs=ps({mutationFn:ke=>ki.delete(`/services/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["services"]}),xr({title:"Service deleted successfully"})},onError:()=>{xr({title:"Failed to delete service",variant:"destructive"})}}),Ua=ps({mutationFn:ke=>ki.post("/consulting",Ik(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["consulting"]}),xr({title:"Consulting created successfully"})},onError:()=>{xr({title:"Failed to create consulting",variant:"destructive"})}}),wa=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/consulting/${ke}`,Ik(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["consulting"]}),xr({title:"Consulting updated successfully"})},onError:()=>{xr({title:"Failed to update consulting",variant:"destructive"})}}),is=ps({mutationFn:ke=>ki.delete(`/consulting/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["consulting"]}),xr({title:"Consulting deleted successfully"})},onError:()=>{xr({title:"Failed to delete consulting",variant:"destructive"})}}),Sa=ps({mutationFn:ke=>ki.post("/products",kk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["products"]}),xr({title:"Product created successfully"})},onError:()=>{xr({title:"Failed to create product",variant:"destructive"})}}),Hs=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/products/${ke}`,kk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["products"]}),xr({title:"Product updated successfully"})},onError:()=>{xr({title:"Failed to update product",variant:"destructive"})}}),Fo=ps({mutationFn:ke=>ki.delete(`/products/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["products"]}),xr({title:"Product deleted successfully"})},onError:()=>{xr({title:"Failed to delete product",variant:"destructive"})}}),ss=ps({mutationFn:ke=>ki.post("/funds",Pk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["funds"]}),xr({title:"Fund created successfully"})},onError:()=>{xr({title:"Failed to create fund",variant:"destructive"})}}),go=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/funds/${ke}`,Pk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["funds"]}),xr({title:"Fund updated successfully"})},onError:()=>{xr({title:"Failed to update fund",variant:"destructive"})}}),Ta=ps({mutationFn:ke=>ki.delete(`/funds/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["funds"]}),xr({title:"Fund deleted successfully"})},onError:()=>{xr({title:"Failed to delete fund",variant:"destructive"})}}),Ea=ps({mutationFn:ke=>ki.post("/case-studies",Rk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["case-studies"]}),xr({title:"Case study created successfully"})},onError:()=>{xr({title:"Failed to create case study",variant:"destructive"})}}),Ca=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/case-studies/${ke}`,Rk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["case-studies"]}),xr({title:"Case study updated successfully"})},onError:()=>{xr({title:"Failed to update case study",variant:"destructive"})}}),As=ps({mutationFn:ke=>ki.delete(`/case-studies/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["case-studies"]}),xr({title:"Case study deleted successfully"})},onError:()=>{xr({title:"Failed to delete case study",variant:"destructive"})}}),$a=ps({mutationFn:ke=>ki.post("/blog-posts",Nk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["blog-posts"]}),xr({title:"Blog post created successfully"})},onError:()=>{xr({title:"Failed to create blog post",variant:"destructive"})}}),On=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/blog-posts/${ke}`,Nk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["blog-posts"]}),xr({title:"Blog post updated successfully"})},onError:()=>{xr({title:"Failed to update blog post",variant:"destructive"})}}),ui=ps({mutationFn:ke=>ki.delete(`/blog-posts/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["blog-posts"]}),xr({title:"Blog post deleted successfully"})},onError:()=>{xr({title:"Failed to delete blog post",variant:"destructive"})}}),fi=ps({mutationFn:ke=>ki.post("/events",Ok(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["events"]}),xr({title:"Event created successfully"})},onError:()=>{xr({title:"Failed to create event",variant:"destructive"})}}),Vi=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/events/${ke}`,Ok(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["events"]}),xr({title:"Event updated successfully"})},onError:()=>{xr({title:"Failed to update event",variant:"destructive"})}}),Is=ps({mutationFn:ke=>ki.delete(`/events/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["events"]}),xr({title:"Event deleted successfully"})},onError:()=>{xr({title:"Failed to delete event",variant:"destructive"})}}),Ha=ps({mutationFn:ke=>ki.post("/resources",Dk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["resources"]}),xr({title:"Resource created successfully"})},onError:()=>{xr({title:"Failed to create resource",variant:"destructive"})}}),Ga=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/resources/${ke}`,Dk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["resources"]}),xr({title:"Resource updated successfully"})},onError:()=>{xr({title:"Failed to update resource",variant:"destructive"})}}),Ot=ps({mutationFn:ke=>ki.delete(`/resources/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["resources"]}),xr({title:"Resource deleted successfully"})},onError:()=>{xr({title:"Failed to delete resource",variant:"destructive"})}}),qa=ps({mutationFn:ke=>ki.post("/team-members",Lk(ke)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["team-members"]}),xr({title:"Team member created successfully"})},onError:()=>{xr({title:"Failed to create team member",variant:"destructive"})}}),gh=ps({mutationFn:({id:ke,data:Wt})=>ki.put(`/team-members/${ke}`,Lk(Wt)),onSuccess:()=>{Fn.invalidateQueries({queryKey:["team-members"]}),xr({title:"Team member updated successfully"})},onError:()=>{xr({title:"Failed to update team member",variant:"destructive"})}}),Ql=ps({mutationFn:ke=>ki.delete(`/team-members/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["team-members"]}),xr({title:"Team member deleted successfully"})},onError:()=>{xr({title:"Failed to delete team member",variant:"destructive"})}}),Sr=ps({mutationFn:ke=>ki.delete(`/contact-messages/${ke}`),onSuccess:()=>{Fn.invalidateQueries({queryKey:["contact-messages"]}),xr({title:"Message deleted successfully"})},onError:()=>{xr({title:"Failed to delete message",variant:"destructive"})}}),Ke=ke=>{Rt?(To.mutate({id:Rt.id,data:ke}),fn(void 0)):Qo.mutate(ke)},le=ke=>{Tn?(Hs.mutate({id:Tn.id,data:ke}),Bn(void 0)):Sa.mutate(ke)},ue=ke=>{Ft?(go.mutate({id:Ft.id,data:ke}),wn(void 0)):ss.mutate(ke)},ve=ke=>{Yt?(Ca.mutate({id:Yt.id,data:ke}),Cn(void 0)):Ea.mutate(ke)},Ne=ke=>{gt?(On.mutate({id:gt.id,data:ke}),Jt(void 0)):$a.mutate(ke)},Ee=ke=>{Ht?(Vi.mutate({id:Ht.id,data:ke}),qe(void 0)):fi.mutate(ke)},ze=ke=>{Ct?(Ga.mutate({id:Ct.id,data:ke}),Pn(void 0)):Ha.mutate(ke)},We=ke=>{const Wt={...ke};Zn?(gh.mutate({id:Zn.id,data:Wt}),Nn(void 0)):qa.mutate(Wt)},je=ke=>{En?(wa.mutate({id:En.id,data:ke}),xn(void 0)):Ua.mutate(ke)},Xe=()=>{de(!0)},dt=()=>{kt(!0)},Ze=(ke,Wt,gn,Un="title",rr)=>v.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:ke.map(Hn=>v.jsxs(Rr,{className:"h-fit",children:[v.jsx(Yr,{children:v.jsx(Jr,{className:"text-lg",children:String(Hn[Un])})}),v.jsxs(Qr,{className:"space-y-4",children:[rr&&rr(Hn),v.jsxs("div",{className:"flex gap-2 pt-2",children:[v.jsxs(on,{variant:"outline",size:"sm",onClick:()=>Wt(Hn),children:[v.jsx($B,{className:"w-4 h-4 mr-1"}),"Edit"]}),v.jsxs(on,{variant:"outline",size:"sm",onClick:()=>gn(Hn.id),className:"text-red-600 hover:text-red-700",children:[v.jsx(Kw,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},Hn.id))}),Nt=()=>v.jsx("div",{className:"grid grid-cols-1 gap-4",children:to.map(ke=>v.jsxs(Rr,{children:[v.jsxs(Yr,{children:[v.jsx(Jr,{className:"text-lg",children:ke.subject}),v.jsxs("p",{className:"text-sm text-gray-600",children:["From: ",ke.name," (",ke.email,")"]})]}),v.jsxs(Qr,{children:[v.jsx("p",{className:"text-sm text-gray-700 mb-2",children:ke.message}),v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx("span",{className:`px-2 py-1 rounded text-xs ${ke.status==="unread"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:ke.status}),v.jsx("span",{className:"text-xs text-gray-500",children:new Date(ke.timestamp).toLocaleDateString()}),v.jsxs(on,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 ml-2",onClick:()=>{window.confirm("Are you sure you want to delete this message?")&&Sr.mutate(ke.id)},children:[v.jsx(Kw,{className:"w-4 h-4 mr-1"}),"Delete"]})]})]})]},ke.id))});if(ee.useEffect(()=>{!$n&&!cn&&An("/admin")},[$n,cn,An]),$n)return v.jsx("div",{className:"p-10 text-center text-gray-400",children:"Checking admin session..."});if(!cn)return null;const Qt=()=>{un(),An("/admin")};return v.jsxs("div",{className:"min-h-screen bg-gray-50",children:[v.jsx(G$,{onLogout:Qt,onStyleSettingsOpen:Xe,onPopupManagementOpen:dt}),v.jsxs("div",{className:"container mx-auto px-4 py-8",children:[v.jsx(q$,{services:Zr,consulting:ni,teamMembers:Ki,products:Or,funds:vs,messages:to,caseStudies:$s,blogPosts:Hi,programsApplications:El}),v.jsxs(H$,{defaultValue:"services",className:"mt-9",children:[v.jsxs(aD,{className:"grid w-full grid-cols-5 lg:grid-cols-9",children:[v.jsx(cd,{value:"services",children:"Programs"}),v.jsx(cd,{value:"consulting",children:"Consultings"}),v.jsx(cd,{value:"products",children:"Products"}),v.jsx(cd,{value:"case-studies",children:"Portfolio"}),v.jsx(cd,{value:"blog-posts",children:"Blog Posts"}),v.jsx(cd,{value:"resources",children:"Resources"}),v.jsx(cd,{value:"team",children:"Team"}),v.jsx(cd,{value:"messages",children:"Messages"}),v.jsx(cd,{value:"admins",children:"Admins"})]}),v.jsx(hu,{value:"services",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Programs Management"}),v.jsxs(on,{onClick:()=>t(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Program"]})]})}),v.jsx(Qr,{children:Ze(Zr,ke=>{fn(ke),t(!0)},ke=>Cs.mutate(ke),"title",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsxs("div",{className:"flex gap-2 flex-wrap",children:[v.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:ke.category}),v.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded text-xs",children:ke.duration})]}),v.jsxs("div",{className:"text-xs text-gray-600",children:[v.jsx("strong",{children:"Eligibility:"})," ",ke.eligibility]}),ke.features.length>0&&v.jsxs("div",{className:"text-xs",children:[v.jsx("strong",{children:"Features:"}),v.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ke.features.slice(0,3).map((Wt,gn)=>v.jsx("li",{children:Wt},gn)),ke.features.length>3&&v.jsxs("li",{children:["... and ",ke.features.length-3," more"]})]})]})]}))})]})}),v.jsx(hu,{value:"consulting",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Consultings Management"}),v.jsxs(on,{onClick:()=>at(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add a Consult"]})]})}),v.jsx(Qr,{children:Ze(ni,ke=>{xn(ke),at(!0)},ke=>is.mutate(ke),"title",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsx("div",{className:"flex gap-2 flex-wrap",children:v.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:ke.category})}),v.jsxs("div",{className:"text-xs text-gray-600",children:[v.jsx("strong",{children:"Eligibility:"})," ",ke.eligibility]}),ke.features.length>0&&v.jsxs("div",{className:"text-xs",children:[v.jsx("strong",{children:"Features:"}),v.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ke.features.slice(0,3).map((Wt,gn)=>v.jsx("li",{children:Wt},gn)),ke.features.length>3&&v.jsxs("li",{children:["... and ",ke.features.length-3," more"]})]})]})]}))})]})}),v.jsx(hu,{value:"products",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Products Management"}),v.jsxs(on,{onClick:()=>l(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})}),v.jsx(Qr,{children:Ze(Or,ke=>{Bn(ke),l(!0)},ke=>Fo.mutate(ke),"name",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsxs("div",{className:"flex gap-2 flex-wrap",children:[v.jsx("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:ke.category}),v.jsx("span",{className:"bg-orange-100 text-orange-800 px-2 py-1 rounded text-xs",children:ke.price}),v.jsx("span",{className:`px-2 py-1 rounded text-xs ${ke.status==="active"?"bg-green-100 text-green-800":ke.status==="inactive"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:ke.status})]}),ke.features.length>0&&v.jsxs("div",{className:"text-xs",children:[v.jsx("strong",{children:"Features:"}),v.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ke.features.slice(0,2).map((Wt,gn)=>v.jsx("li",{children:Wt},gn)),ke.features.length>2&&v.jsxs("li",{children:["... and ",ke.features.length-2," more"]})]})]})]}))})]})}),v.jsx(hu,{value:"funds",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Funds Management"}),v.jsxs(on,{onClick:()=>m(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Fund"]})]})}),v.jsx(Qr,{children:Ze(vs,ke=>{wn(ke),m(!0)},ke=>Ta.mutate(ke),"name",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[v.jsxs("div",{children:[v.jsx("strong",{children:"Size:"})," ",ke.totalSize]}),v.jsxs("div",{children:[v.jsx("strong",{children:"Raised:"})," ",ke.currentRaise]}),v.jsxs("div",{children:[v.jsx("strong",{children:"Stage:"})," ",ke.stage]}),v.jsxs("div",{children:[v.jsx("strong",{children:"Companies:"})," ",ke.targetCompanies]})]}),v.jsxs("div",{className:"flex gap-1 flex-wrap",children:[ke.sectors.slice(0,3).map((Wt,gn)=>v.jsx("span",{className:"bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs",children:Wt},gn)),ke.sectors.length>3&&v.jsxs("span",{className:"text-xs text-gray-500",children:["+",ke.sectors.length-3," more"]})]}),v.jsx("span",{className:`inline-block px-2 py-1 rounded text-xs ${ke.status==="fundraising"?"bg-blue-100 text-blue-800":ke.status==="deployed"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:ke.status})]}))})]})}),v.jsx(hu,{value:"case-studies",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Portfolio Management"}),v.jsxs(on,{onClick:()=>i(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Portfolio"]})]})}),v.jsx(Qr,{children:Ze($s,ke=>{Cn(ke),i(!0)},ke=>As.mutate(ke),"companyName",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsx("span",{className:"bg-teal-100 text-teal-800 px-2 py-1 rounded text-xs",children:ke.industry}),v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsxs("div",{className:"text-xs",children:[v.jsxs("div",{className:"mb-1",children:[v.jsx("strong",{children:"Challenge:"})," ",ke.challenge.substring(0,100),"..."]}),v.jsxs("div",{children:[v.jsx("strong",{children:"Solution:"})," ",ke.solution.substring(0,100),"..."]})]}),ke.results.length>0&&v.jsxs("div",{className:"text-xs",children:[v.jsx("strong",{children:"Results:"}),v.jsxs("ul",{className:"list-disc list-inside mt-1 text-gray-600",children:[ke.results.slice(0,2).map((Wt,gn)=>v.jsx("li",{children:Wt},gn)),ke.results.length>2&&v.jsxs("li",{children:["... and ",ke.results.length-2," more"]})]})]}),v.jsx("div",{className:"flex gap-1 flex-wrap",children:ke.tags.slice(0,3).map((Wt,gn)=>v.jsx("span",{className:"bg-pink-100 text-pink-800 px-2 py-1 rounded text-xs",children:Wt},gn))})]}))})]})}),v.jsx(hu,{value:"blog-posts",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Blog Posts Management"}),v.jsxs(on,{onClick:()=>P(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Blog Post"]})]})}),v.jsx(Qr,{children:Ze(Hi,ke=>{Jt(ke),P(!0)},ke=>ui.mutate(ke),"title",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex gap-2 flex-wrap",children:[v.jsx("span",{className:"bg-cyan-100 text-cyan-800 px-2 py-1 rounded text-xs",children:ke.category}),v.jsxs("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded text-xs",children:["By ",ke.author]})]}),v.jsx("p",{className:"text-gray-700",children:ke.excerpt}),v.jsxs("div",{className:"text-xs text-gray-600",children:["Published: ",new Date(ke.publishDate).toLocaleDateString()]}),v.jsx("div",{className:"flex gap-1 flex-wrap",children:ke.tags.slice(0,3).map((Wt,gn)=>v.jsx("span",{className:"bg-emerald-100 text-emerald-800 px-2 py-1 rounded text-xs",children:Wt},gn))})]}))})]})}),v.jsx(hu,{value:"events",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Events Management"}),v.jsxs(on,{onClick:()=>j(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Event"]})]})}),v.jsx(Qr,{children:Ze(mo,ke=>{qe(ke),j(!0)},ke=>Is.mutate(ke),"title",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex gap-2 flex-wrap",children:[v.jsx("span",{className:"bg-violet-100 text-violet-800 px-2 py-1 rounded text-xs",children:ke.type}),v.jsx("span",{className:"bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs",children:new Date(ke.date).toLocaleDateString()})]}),v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsxs("div",{className:"text-xs",children:[v.jsxs("div",{children:[v.jsx("strong",{children:"Time:"})," ",ke.time]}),v.jsxs("div",{children:[v.jsx("strong",{children:"Location:"})," ",ke.location]})]})]}))})]})}),v.jsx(hu,{value:"resources",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Resources Management"}),v.jsxs(on,{onClick:()=>X(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Resource"]})]})}),v.jsx(Qr,{children:Ze(zi,ke=>{Pn(ke),X(!0)},ke=>Ot.mutate(ke),"title",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex gap-2 flex-wrap",children:[v.jsx("span",{className:"bg-rose-100 text-rose-800 px-2 py-1 rounded text-xs",children:ke.type}),v.jsx("span",{className:"bg-slate-100 text-slate-800 px-2 py-1 rounded text-xs",children:ke.category})]}),v.jsx("p",{className:"text-gray-700",children:ke.description}),v.jsx("div",{className:"flex gap-1 flex-wrap",children:ke.tags.slice(0,3).map((Wt,gn)=>v.jsx("span",{className:"bg-lime-100 text-lime-800 px-2 py-1 rounded text-xs",children:Wt},gn))})]}))})]})}),v.jsx(hu,{value:"team",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsxs("div",{className:"flex justify-between items-center",children:[v.jsx(Jr,{children:"Team Members Management"}),v.jsxs(on,{onClick:()=>W(!0),children:[v.jsx(pf,{className:"w-4 h-4 mr-2"}),"Add Team Member"]})]})}),v.jsx(Qr,{children:Ze(Ki,ke=>{Nn(ke),W(!0)},ke=>Ql.mutate(ke),"name",ke=>v.jsxs("div",{className:"space-y-2 text-sm",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx("img",{src:ke.image,alt:ke.name,className:"w-12 h-12 rounded-full object-cover"}),v.jsxs("div",{children:[v.jsx("div",{className:"font-medium",children:ke.position}),ke.linkedin_url&&v.jsx("a",{href:ke.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 text-xs hover:underline",children:"LinkedIn Profile"})]})]}),v.jsx("p",{className:"text-gray-700",children:ke.bio})]}))})]})}),v.jsx(hu,{value:"messages",className:"mt-6",children:v.jsxs(Rr,{children:[v.jsx(Yr,{children:v.jsx(Jr,{children:"Contact Messages"})}),v.jsx(Qr,{children:Nt()})]})}),v.jsx(hu,{value:"admins",children:v.jsx(wX,{})})]})]}),v.jsx(W$,{isOpen:n,onClose:()=>{t(!1),fn(void 0)},onSubmit:Ke,service:Rt}),v.jsx(Z$,{isOpen:ht,onClose:()=>{at(!1),xn(void 0)},onSubmit:je,consulting:En}),v.jsx(X$,{isOpen:s,onClose:()=>{l(!1),Bn(void 0)},onSubmit:le,product:Tn}),v.jsx(K$,{isOpen:h,onClose:()=>{m(!1),wn(void 0)},onSubmit:ue,fund:Ft}),v.jsx(Y$,{isOpen:b,onClose:()=>{i(!1),Cn(void 0)},onSubmit:ve,caseStudy:Yt}),v.jsx(hX,{isOpen:A,onClose:()=>{P(!1),Jt(void 0)},onSubmit:Ne,blogPost:gt}),v.jsx(dX,{isOpen:D,onClose:()=>{j(!1),qe(void 0)},onSubmit:Ee,event:Ht}),v.jsx(fX,{isOpen:U,onClose:()=>{X(!1),Pn(void 0)},onSubmit:ze,resource:Ct}),v.jsx(pX,{isOpen:Y,onClose:()=>{W(!1),Nn(void 0)},onSubmit:We,member:Zn}),v.jsx(mX,{isOpen:re,onClose:()=>de(!1),onSubmit:ke=>{localStorage.setItem("styleSettings",JSON.stringify(ke)),xr({title:"Style updated!",description:"The site style settings were successfully updated."})},currentSettings:JSON.parse(localStorage.getItem("styleSettings")||JSON.stringify({heroImage:"",runningTextCompanies:[],collaborators:[]}))}),v.jsx(bX,{open:Dt,onOpenChange:kt})]})},DX=()=>{const n=am();return ee.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",n.pathname)},[n.pathname]),v.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:v.jsxs("div",{className:"text-center",children:[v.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),v.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),v.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},OX=()=>{const[n,t]=ee.useState(""),[s,l]=ee.useState(""),{login:h}=wx(),{toast:m}=Dy(),b=c1(),i=async A=>{A.preventDefault();try{await h(n,s)?(m({title:"Login successful",description:"Welcome to the admin dashboard"}),b("/admin/dashboard")):m({title:"Login failed",description:"Invalid username or password",variant:"destructive"})}catch{m({title:"Error",description:"Something went wrong during login",variant:"destructive"})}};return v.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:v.jsxs(Rr,{className:"w-full max-w-md",children:[v.jsxs(Yr,{className:"text-center",children:[v.jsx(Jr,{className:"text-2xl font-bold",children:"Admin Login"}),v.jsx(_s,{children:"Enter your credentials to access the admin dashboard"})]}),v.jsx(Qr,{children:v.jsxs("form",{onSubmit:i,className:"space-y-4",children:[v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"username",children:"Username"}),v.jsx(Jn,{id:"username",type:"text",value:n,onChange:A=>t(A.target.value),required:!0})]}),v.jsxs("div",{className:"space-y-2",children:[v.jsx(rn,{htmlFor:"password",children:"Password"}),v.jsx(Jn,{id:"password",type:"password",value:s,onChange:A=>l(A.target.value),required:!0})]}),v.jsx(on,{type:"submit",className:"w-full",children:"Login"})]})})]})})},LX=()=>{const{pathname:n}=am();return ee.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[n]),null},zX=({children:n})=>{const{isAdminLoggedIn:t}=wx();return t?n:v.jsx(tU,{to:"/admin",replace:!0})},jX=()=>{const[n,t]=ee.useState(!1),[s,l]=ee.useState({necessary:!0,analytics:!1,marketing:!1});ee.useEffect(()=>{const D=localStorage.getItem("cookie-consent");if(!D)t(!0);else{const j=JSON.parse(D);l(j),j.analytics&&(h(),m())}},[]);const h=()=>{const D="G-XXXXXXXXXX",j=document.createElement("script");j.async=!0,j.src=`https://www.googletagmanager.com/gtag/js?id=${D}`,document.head.appendChild(j),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",D)},m=()=>{const D=document.createElement("script");D.src="https://js.hs-scripts.com/your-hubspot-id.js",D.async=!0,document.body.appendChild(D)},b=()=>{const D={necessary:!0,analytics:!0,marketing:!0};l(D),localStorage.setItem("cookie-consent",JSON.stringify(D)),t(!1),h(),m()},i=()=>{const D={necessary:!0,analytics:!1,marketing:!1};l(D),localStorage.setItem("cookie-consent",JSON.stringify(D)),t(!1)},A=()=>{localStorage.setItem("cookie-consent",JSON.stringify(s)),t(!1),s.analytics&&(h(),m())},P=(D,j)=>{l(U=>({...U,[D]:j}))};return n?v.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 p-4",children:v.jsxs(Rr,{className:"mx-auto max-w-4xl border-2 shadow-lg",children:[v.jsxs(Yr,{className:"pb-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-2",children:[v.jsx(pP,{className:"h-5 w-5 text-primary"}),v.jsx(Jr,{className:"text-lg",children:"Cookie Preferences"})]}),v.jsx(on,{variant:"ghost",size:"sm",onClick:i,className:"h-8 w-8 p-0",children:v.jsx(t1,{className:"h-4 w-4"})})]}),v.jsx(_s,{children:"We use cookies to enhance your experience, analyze site traffic, and for marketing purposes. You can customize your preferences or accept all cookies."})]}),v.jsx(Qr,{className:"space-y-4",children:v.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[v.jsxs("div",{className:"flex gap-2",children:[v.jsx(on,{onClick:b,className:"flex-1 sm:flex-none",children:"Accept All"}),v.jsx(on,{variant:"outline",onClick:i,className:"flex-1 sm:flex-none",children:"Reject All"})]}),v.jsxs(ol,{children:[v.jsx(MT,{asChild:!0,children:v.jsxs(on,{variant:"outline",className:"flex items-center gap-2",children:[v.jsx(yP,{className:"h-4 w-4"}),"Customize"]})}),v.jsxs(Fa,{className:"max-w-md",children:[v.jsx(Ba,{children:v.jsx(Va,{children:"Cookie Preferences"})}),v.jsxs("div",{className:"space-y-6",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"space-y-1",children:[v.jsx(rn,{htmlFor:"necessary",children:"Necessary Cookies"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Essential for the website to function properly"})]}),v.jsx(Sy,{id:"necessary",checked:s.necessary,disabled:!0})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"space-y-1",children:[v.jsx(rn,{htmlFor:"analytics",children:"Analytics Cookies"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Help us understand how visitors interact with our website"})]}),v.jsx(Sy,{id:"analytics",checked:s.analytics,onCheckedChange:D=>P("analytics",D)})]}),v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"space-y-1",children:[v.jsx(rn,{htmlFor:"marketing",children:"Marketing Cookies"}),v.jsx("p",{className:"text-sm text-muted-foreground",children:"Used to deliver relevant advertisements"})]}),v.jsx(Sy,{id:"marketing",checked:s.marketing,onCheckedChange:D=>P("marketing",D)})]}),v.jsx(on,{onClick:A,className:"w-full",children:"Save Preferences"})]})]})]})]})})]})}):null},FX=()=>v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsxs("div",{className:"container mx-auto px-4",children:[v.jsxs(Pi,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[v.jsx(pd,{className:"w-4 h-4"}),"Back to Home"]}),v.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Privacy Policy"}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"Your privacy is important to us. This policy explains how we collect, use, and protect your information."})]})}),v.jsx("section",{className:"py-16",children:v.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:v.jsxs("div",{className:"prose prose-lg max-w-none",children:[v.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information We Collect"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We collect information you provide directly to us when you use our services, contact us for support, or request information about our programs and offerings. This may include your name, email address, phone number, and other contact information relevant to the services you are requesting."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"How We Use Your Information"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We use the information we collect to:"}),v.jsxs("ul",{className:"text-gray-600 mb-6 space-y-2",children:[v.jsx("li",{children:" Provide and deliver the services you request"}),v.jsx("li",{children:" Process service applications and inquiries"}),v.jsx("li",{children:" Communicate with you about our services and programs"}),v.jsx("li",{children:" Send you important notices and updates"}),v.jsx("li",{children:" Improve our services and understand usage patterns"}),v.jsx("li",{children:" Respond to your questions and provide customer support"})]}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Information Sharing"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy or as required by law."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Data Security"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Cookies and Tracking"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We use cookies and similar technologies to enhance your experience, analyze usage, and provide personalized content. You can control cookie settings through your browser."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Your Rights"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"You have the right to request access to, correction of, or deletion of your personal information that we have collected through our services. You may also opt out of certain communications from us by contacting us directly."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Children's Privacy"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"Our services are not intended for children under 13. We do not knowingly collect personal information from children under 13."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to This Policy"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We may update this privacy policy from time to time. We will notify you of any changes by posting the new policy on this page."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Us"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"If you have any questions about this privacy policy, please contact us at:"}),v.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:v.jsxs("p",{className:"text-gray-600",children:["Email: hello@betawaves.io",v.jsx("br",{}),"Phone: +971 58 829 0773",v.jsx("br",{}),"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"]})})]})})})]}),BX=()=>v.jsxs("div",{className:"min-h-screen",children:[v.jsx("section",{className:"bg-gradient-to-r from-primary/10 via-blue-50 to-primary/5 py-20",children:v.jsxs("div",{className:"container mx-auto px-4",children:[v.jsxs(Pi,{to:"/",className:"inline-flex items-center gap-2 text-primary hover:text-primary/80 mb-8 transition-colors",children:[v.jsx(pd,{className:"w-4 h-4"}),"Back to Home"]}),v.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:"Terms of Service"}),v.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"These terms govern your use of our services and establish the agreement between you and our company."})]})}),v.jsx("section",{className:"py-16",children:v.jsx("div",{className:"container mx-auto px-4 max-w-4xl",children:v.jsxs("div",{className:"prose prose-lg max-w-none",children:[v.jsxs("p",{className:"text-gray-600 mb-8",children:["Last updated: ",new Date().toLocaleDateString()]}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Acceptance of Terms"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"By using our services, you agree to be bound by these Terms of Service. If you do not agree to these terms, please do not use our services."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Description of Services"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We provide professional services including consulting, programs, and solutions tailored to meet your business needs. Our services are delivered through various channels including in-person consultations, digital platforms, and project-based engagements."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Service Agreements"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"Specific terms for each service will be outlined in separate service agreements or statements of work. These documents will detail scope, deliverables, timelines, and payment terms for the specific services requested."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Payment Terms"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"Payment terms vary by service and will be specified in your service agreement. Generally, payment is due according to the schedule outlined in your agreement. Late payments may result in service suspension or termination."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Intellectual Property"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"All content, materials, and deliverables created specifically for you remain your property. Our proprietary methodologies, tools, and general knowledge remain our intellectual property. Specific ownership terms will be detailed in your service agreement."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Confidentiality"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We respect the confidentiality of your business information and maintain strict confidentiality protocols. We will not disclose your confidential information to third parties without your consent, except as required by law."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Limitation of Liability"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"Our liability is limited to the fees paid for the specific service. We are not liable for indirect, incidental, or consequential damages. This limitation applies to the fullest extent permitted by law."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Termination"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"Either party may terminate services according to the terms specified in the service agreement. Upon termination, you remain responsible for payment of services rendered up to the termination date."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Governing Law"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"These terms are governed by the laws of the jurisdiction in which our company operates. Any disputes will be resolved through binding arbitration or in the courts of that jurisdiction."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Changes to Terms"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"We may update these terms from time to time. Updated terms will be posted on our website and will take effect immediately upon posting. Continued use of our services constitutes acceptance of the updated terms."}),v.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Contact Information"}),v.jsx("p",{className:"text-gray-600 mb-6",children:"If you have questions about these terms, please contact us:"}),v.jsx("div",{className:"bg-gray-50 p-6 rounded-lg",children:v.jsxs("p",{className:"text-gray-600",children:["Email: hello@betawaves.io",v.jsx("br",{}),"Phone: +971 58 829 0773",v.jsx("br",{}),"Address: Level 1 Gate Avenue - South Zone, Dubai International Financial Centre, United Arab Emirates"]})})]})})})]}),VX=vx("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),tz=ee.forwardRef(({className:n,variant:t,...s},l)=>v.jsx("div",{ref:l,role:"alert",className:Ai(VX({variant:t}),n),...s}));tz.displayName="Alert";const UX=ee.forwardRef(({className:n,...t},s)=>v.jsx("h5",{ref:s,className:Ai("mb-1 font-medium leading-none tracking-tight",n),...t}));UX.displayName="AlertTitle";const nz=ee.forwardRef(({className:n,...t},s)=>v.jsx("div",{ref:s,className:Ai("text-sm [&_p]:leading-relaxed",n),...t}));nz.displayName="AlertDescription";const $X=()=>{const[n,t]=ee.useState({necessary:!0,analytics:!1,marketing:!1});ee.useEffect(()=>{const b=localStorage.getItem("cookie-consent");if(b){const i=JSON.parse(b);t(i),i.analytics&&(s(),l())}},[]);const s=()=>{const b="G-XXXXXXXXXX",i=document.createElement("script");i.async=!0,i.src=`https://www.googletagmanager.com/gtag/js?id=${b}`,document.head.appendChild(i),window.gtag=window.gtag||function(){(window.gtag.q=window.gtag.q||[]).push(arguments)},window.gtag("js",new Date),window.gtag("config",b)},l=()=>{const b=document.createElement("script");b.src="https://js.hs-scripts.com/your-hubspot-id.js",b.async=!0,document.body.appendChild(b)},h=(b,i)=>{const A={...n,[b]:i};t(A),localStorage.setItem("cookie-consent",JSON.stringify(A)),b==="analytics"&&i&&(s(),l())},m=[{id:"necessary",name:"Necessary Cookies",description:"Essential for the website to function properly. These cookies cannot be disabled as they are required for basic website operations.",icon:VB,required:!0,examples:["Session management","Security tokens","Cookie consent preferences"],duration:"Session / 1 year"},{id:"analytics",name:"Analytics Cookies",description:"Help us understand how visitors interact with our website by collecting and reporting information anonymously.",icon:wB,required:!1,examples:["Google Analytics","Page views","User behavior tracking"],duration:"2 years",thirdParty:"Google LLC"},{id:"marketing",name:"Marketing Cookies",description:"Used to deliver relevant advertisements and track the effectiveness of our marketing campaigns.",icon:HB,required:!1,examples:["Ad targeting","Conversion tracking","Remarketing"],duration:"1 year",thirdParty:"Various advertising partners"}];return v.jsx("div",{className:"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/5 py-12",children:v.jsx("div",{className:"container mx-auto px-4",children:v.jsxs(Rr,{className:"max-w-4xl mx-auto",children:[v.jsxs(Yr,{className:"text-center",children:[v.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[v.jsx(pP,{className:"h-8 w-8 text-primary"}),v.jsx(Jr,{className:"text-3xl font-bold text-primary",children:"Cookie Policy"})]}),v.jsxs(_s,{className:"text-lg",children:["Last updated: ",new Date().toLocaleDateString()]})]}),v.jsxs(Qr,{className:"space-y-8",children:[v.jsxs(tz,{children:[v.jsx(kB,{className:"h-4 w-4"}),v.jsx(nz,{children:"You can manage your cookie preferences at any time using the controls below. Changes will be applied immediately and saved to your browser."})]}),v.jsxs("section",{children:[v.jsxs("h2",{className:"text-2xl font-semibold text-primary mb-4 flex items-center gap-2",children:[v.jsx(yP,{className:"h-5 w-5"}),"Manage Your Cookie Preferences"]}),v.jsx("div",{className:"grid gap-6",children:m.map(b=>v.jsxs(Rr,{className:"border-2",children:[v.jsxs(Yr,{className:"pb-4",children:[v.jsxs("div",{className:"flex items-center justify-between",children:[v.jsxs("div",{className:"flex items-center gap-3",children:[v.jsx(b.icon,{className:"h-5 w-5 text-primary"}),v.jsx(Jr,{className:"text-lg",children:b.name}),b.required&&v.jsx(_a,{variant:"secondary",children:"Required"})]}),v.jsx(Sy,{checked:n[b.id],onCheckedChange:i=>h(b.id,i),disabled:b.required})]}),v.jsx(_s,{className:"text-sm",children:b.description})]}),v.jsx(Qr,{className:"pt-0",children:v.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[v.jsxs("div",{children:[v.jsx(rn,{className:"font-medium",children:"Examples:"}),v.jsx("ul",{className:"mt-1 space-y-1 text-muted-foreground",children:b.examples.map((i,A)=>v.jsxs("li",{children:[" ",i]},A))})]}),v.jsxs("div",{children:[v.jsx(rn,{className:"font-medium",children:"Duration:"}),v.jsx("p",{className:"mt-1 text-muted-foreground",children:b.duration})]}),b.thirdParty&&v.jsxs("div",{children:[v.jsx(rn,{className:"font-medium",children:"Third Party:"}),v.jsx("p",{className:"mt-1 text-muted-foreground",children:b.thirdParty})]})]})})]},b.id))})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"What Are Cookies"}),v.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Cookies are small text files placed on your device to improve your experience and help us deliver better services."})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"How We Use Cookies"}),v.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-muted-foreground",children:[v.jsx("li",{children:"To ensure our website functions properly and securely"}),v.jsx("li",{children:"To remember your cookie preferences and settings"}),v.jsx("li",{children:"To analyze website usage and improve performance"}),v.jsx("li",{children:"To support marketing and advertising efforts"})]})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Third-Party Services"}),v.jsxs("div",{className:"space-y-4",children:[v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Google Analytics"}),v.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"Google Analytics helps us understand user behavior anonymously. Data is aggregated and does not personally identify you."}),v.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",v.jsx("a",{href:"https://policies.google.com/technologies/cookies",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"Google Cookie Policy"})]})]}),v.jsxs("div",{children:[v.jsx("h3",{className:"font-semibold text-lg mb-2",children:"HubSpot"}),v.jsx("p",{className:"text-muted-foreground leading-relaxed",children:"We use HubSpot to manage customer relationships and marketing automation. HubSpot cookies help track conversions and personalize content."}),v.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Learn more:"," ",v.jsx("a",{href:"https://legal.hubspot.com/cookie-policy",className:"text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:"HubSpot Cookie Policy"})]})]})]})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Browser Settings"}),v.jsx("p",{className:"text-muted-foreground",children:"You can manage cookies in your browser settings. Disabling all cookies may affect your experience."})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Updates"}),v.jsx("p",{className:"text-muted-foreground",children:"This Cookie Policy may be updated occasionally. Please check back regularly for changes."})]}),v.jsxs("section",{children:[v.jsx("h2",{className:"text-2xl font-semibold text-primary mb-4",children:"Contact Us"}),v.jsx("p",{className:"text-muted-foreground",children:"For questions about our Cookie Policy, contact us through our contact page."})]})]})]})})})},HX=new ZV,GX=()=>v.jsx(QV,{client:HX,children:v.jsx(RV,{children:v.jsxs(pU,{children:[v.jsx(P4,{}),v.jsx(o5,{}),v.jsxs(uU,{children:[v.jsx(LX,{}),v.jsxs("div",{className:"min-h-screen flex flex-col",children:[v.jsx(gU,{}),v.jsx("main",{className:"flex-1",children:v.jsxs(rU,{children:[v.jsx(ga,{path:"/",element:v.jsx(R8,{})}),v.jsx(ga,{path:"/programs",element:v.jsx(d$,{})}),v.jsx(ga,{path:"/consultings",element:v.jsx(f$,{})}),v.jsx(ga,{path:"/products",element:v.jsx(p$,{})}),v.jsx(ga,{path:"/resources",element:v.jsx(g$,{})}),v.jsx(ga,{path:"/fund",element:v.jsx(b$,{})}),v.jsx(ga,{path:"/case-studies",element:v.jsx(w$,{})}),v.jsx(ga,{path:"/blog",element:v.jsx(S$,{})}),v.jsx(ga,{path:"/blog/:id",element:v.jsx(T$,{})}),v.jsx(ga,{path:"/events",element:v.jsx(E$,{})}),v.jsx(ga,{path:"/contact",element:v.jsx(C$,{})}),v.jsx(ga,{path:"/admin",element:v.jsx(OX,{})}),v.jsx(ga,{path:"/admin/dashboard",element:v.jsx(zX,{children:v.jsx(NX,{})})}),v.jsx(ga,{path:"/privacy-policy",element:v.jsx(FX,{})}),v.jsx(ga,{path:"/terms-of-service",element:v.jsx(BX,{})}),v.jsx(ga,{path:"/cookie-policy",element:v.jsx($X,{})}),v.jsx(ga,{path:"*",element:v.jsx(DX,{})})]})}),v.jsx(yU,{})]}),v.jsx(jX,{})]})]})})});xF.createRoot(document.getElementById("root")).render(v.jsx(GX,{}));
